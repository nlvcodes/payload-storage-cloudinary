"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/mongodb@6.16.0";
exports.ids = ["vendor-chunks/mongodb@6.16.0"];
exports.modules = {

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/admin.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/admin.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Admin = void 0;\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst list_databases_1 = __webpack_require__(/*! ./operations/list_databases */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_databases.js\");\nconst remove_user_1 = __webpack_require__(/*! ./operations/remove_user */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/remove_user.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js\");\nconst validate_collection_1 = __webpack_require__(/*! ./operations/validate_collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/validate_collection.js\");\n/**\n * The **Admin** class is an internal class that allows convenient access to\n * the admin functionality and commands for MongoDB.\n *\n * **ADMIN Cannot directly be instantiated**\n * @public\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * const client = new MongoClient('mongodb://localhost:27017');\n * const admin = client.db().admin();\n * const dbInfo = await admin.listDatabases();\n * for (const db of dbInfo.databases) {\n *   console.log(db.name);\n * }\n * ```\n */\nclass Admin {\n    /**\n     * Create a new Admin instance\n     * @internal\n     */\n    constructor(db) {\n        this.s = { db };\n    }\n    /**\n     * Execute a command\n     *\n     * The driver will ensure the following fields are attached to the command sent to the server:\n     * - `lsid` - sourced from an implicit session or options.session\n     * - `$readPreference` - defaults to primary or can be configured by options.readPreference\n     * - `$db` - sourced from the name of this database\n     *\n     * If the client has a serverApi setting:\n     * - `apiVersion`\n     * - `apiStrict`\n     * - `apiDeprecationErrors`\n     *\n     * When in a transaction:\n     * - `readConcern` - sourced from readConcern set on the TransactionOptions\n     * - `writeConcern` - sourced from writeConcern set on the TransactionOptions\n     *\n     * Attaching any of the above fields to the command will have no effect as the driver will overwrite the value.\n     *\n     * @param command - The command to execute\n     * @param options - Optional settings for the command\n     */\n    async command(command, options) {\n        return await (0, execute_operation_1.executeOperation)(this.s.db.client, new run_command_1.RunAdminCommandOperation(command, {\n            ...(0, bson_1.resolveBSONOptions)(options),\n            session: options?.session,\n            readPreference: options?.readPreference,\n            timeoutMS: options?.timeoutMS ?? this.s.db.timeoutMS\n        }));\n    }\n    /**\n     * Retrieve the server build information\n     *\n     * @param options - Optional settings for the command\n     */\n    async buildInfo(options) {\n        return await this.command({ buildinfo: 1 }, options);\n    }\n    /**\n     * Retrieve the server build information\n     *\n     * @param options - Optional settings for the command\n     */\n    async serverInfo(options) {\n        return await this.command({ buildinfo: 1 }, options);\n    }\n    /**\n     * Retrieve this db's server status.\n     *\n     * @param options - Optional settings for the command\n     */\n    async serverStatus(options) {\n        return await this.command({ serverStatus: 1 }, options);\n    }\n    /**\n     * Ping the MongoDB server and retrieve results\n     *\n     * @param options - Optional settings for the command\n     */\n    async ping(options) {\n        return await this.command({ ping: 1 }, options);\n    }\n    /**\n     * Remove a user from a database\n     *\n     * @param username - The username to remove\n     * @param options - Optional settings for the command\n     */\n    async removeUser(username, options) {\n        return await (0, execute_operation_1.executeOperation)(this.s.db.client, new remove_user_1.RemoveUserOperation(this.s.db, username, { dbName: 'admin', ...options }));\n    }\n    /**\n     * Validate an existing collection\n     *\n     * @param collectionName - The name of the collection to validate.\n     * @param options - Optional settings for the command\n     */\n    async validateCollection(collectionName, options = {}) {\n        return await (0, execute_operation_1.executeOperation)(this.s.db.client, new validate_collection_1.ValidateCollectionOperation(this, collectionName, options));\n    }\n    /**\n     * List the available databases\n     *\n     * @param options - Optional settings for the command\n     */\n    async listDatabases(options) {\n        return await (0, execute_operation_1.executeOperation)(this.s.db.client, new list_databases_1.ListDatabasesOperation(this.s.db, { timeoutMS: this.s.db.timeoutMS, ...options }));\n    }\n    /**\n     * Get ReplicaSet status\n     *\n     * @param options - Optional settings for the command\n     */\n    async replSetGetStatus(options) {\n        return await this.command({ replSetGetStatus: 1 }, options);\n    }\n}\nexports.Admin = Admin;\n//# sourceMappingURL=admin.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2FkbWluLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGFBQWE7QUFDYixlQUFlLG1CQUFPLENBQUMsMEZBQVE7QUFDL0IsNEJBQTRCLG1CQUFPLENBQUMsMElBQWdDO0FBQ3BFLHlCQUF5QixtQkFBTyxDQUFDLG9JQUE2QjtBQUM5RCxzQkFBc0IsbUJBQU8sQ0FBQyw4SEFBMEI7QUFDeEQsc0JBQXNCLG1CQUFPLENBQUMsOEhBQTBCO0FBQ3hELDhCQUE4QixtQkFBTyxDQUFDLDhJQUFrQztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGNBQWM7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsY0FBYztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxjQUFjO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLGlCQUFpQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxTQUFTO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4SUFBOEksNkJBQTZCO0FBQzNLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwSUFBMEksNENBQTRDO0FBQ3RMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLHFCQUFxQjtBQUN6RDtBQUNBO0FBQ0EsYUFBYTtBQUNiIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvYWRtaW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkFkbWluID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4vYnNvblwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgbGlzdF9kYXRhYmFzZXNfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvbGlzdF9kYXRhYmFzZXNcIik7XG5jb25zdCByZW1vdmVfdXNlcl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9yZW1vdmVfdXNlclwiKTtcbmNvbnN0IHJ1bl9jb21tYW5kXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3J1bl9jb21tYW5kXCIpO1xuY29uc3QgdmFsaWRhdGVfY29sbGVjdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy92YWxpZGF0ZV9jb2xsZWN0aW9uXCIpO1xuLyoqXG4gKiBUaGUgKipBZG1pbioqIGNsYXNzIGlzIGFuIGludGVybmFsIGNsYXNzIHRoYXQgYWxsb3dzIGNvbnZlbmllbnQgYWNjZXNzIHRvXG4gKiB0aGUgYWRtaW4gZnVuY3Rpb25hbGl0eSBhbmQgY29tbWFuZHMgZm9yIE1vbmdvREIuXG4gKlxuICogKipBRE1JTiBDYW5ub3QgZGlyZWN0bHkgYmUgaW5zdGFudGlhdGVkKipcbiAqIEBwdWJsaWNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG4gKlxuICogY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3Jyk7XG4gKiBjb25zdCBhZG1pbiA9IGNsaWVudC5kYigpLmFkbWluKCk7XG4gKiBjb25zdCBkYkluZm8gPSBhd2FpdCBhZG1pbi5saXN0RGF0YWJhc2VzKCk7XG4gKiBmb3IgKGNvbnN0IGRiIG9mIGRiSW5mby5kYXRhYmFzZXMpIHtcbiAqICAgY29uc29sZS5sb2coZGIubmFtZSk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuY2xhc3MgQWRtaW4ge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBZG1pbiBpbnN0YW5jZVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGRiKSB7XG4gICAgICAgIHRoaXMucyA9IHsgZGIgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhIGNvbW1hbmRcbiAgICAgKlxuICAgICAqIFRoZSBkcml2ZXIgd2lsbCBlbnN1cmUgdGhlIGZvbGxvd2luZyBmaWVsZHMgYXJlIGF0dGFjaGVkIHRvIHRoZSBjb21tYW5kIHNlbnQgdG8gdGhlIHNlcnZlcjpcbiAgICAgKiAtIGBsc2lkYCAtIHNvdXJjZWQgZnJvbSBhbiBpbXBsaWNpdCBzZXNzaW9uIG9yIG9wdGlvbnMuc2Vzc2lvblxuICAgICAqIC0gYCRyZWFkUHJlZmVyZW5jZWAgLSBkZWZhdWx0cyB0byBwcmltYXJ5IG9yIGNhbiBiZSBjb25maWd1cmVkIGJ5IG9wdGlvbnMucmVhZFByZWZlcmVuY2VcbiAgICAgKiAtIGAkZGJgIC0gc291cmNlZCBmcm9tIHRoZSBuYW1lIG9mIHRoaXMgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIElmIHRoZSBjbGllbnQgaGFzIGEgc2VydmVyQXBpIHNldHRpbmc6XG4gICAgICogLSBgYXBpVmVyc2lvbmBcbiAgICAgKiAtIGBhcGlTdHJpY3RgXG4gICAgICogLSBgYXBpRGVwcmVjYXRpb25FcnJvcnNgXG4gICAgICpcbiAgICAgKiBXaGVuIGluIGEgdHJhbnNhY3Rpb246XG4gICAgICogLSBgcmVhZENvbmNlcm5gIC0gc291cmNlZCBmcm9tIHJlYWRDb25jZXJuIHNldCBvbiB0aGUgVHJhbnNhY3Rpb25PcHRpb25zXG4gICAgICogLSBgd3JpdGVDb25jZXJuYCAtIHNvdXJjZWQgZnJvbSB3cml0ZUNvbmNlcm4gc2V0IG9uIHRoZSBUcmFuc2FjdGlvbk9wdGlvbnNcbiAgICAgKlxuICAgICAqIEF0dGFjaGluZyBhbnkgb2YgdGhlIGFib3ZlIGZpZWxkcyB0byB0aGUgY29tbWFuZCB3aWxsIGhhdmUgbm8gZWZmZWN0IGFzIHRoZSBkcml2ZXIgd2lsbCBvdmVyd3JpdGUgdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSBUaGUgY29tbWFuZCB0byBleGVjdXRlXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBjb21tYW5kKGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucy5kYi5jbGllbnQsIG5ldyBydW5fY29tbWFuZF8xLlJ1bkFkbWluQ29tbWFuZE9wZXJhdGlvbihjb21tYW5kLCB7XG4gICAgICAgICAgICAuLi4oMCwgYnNvbl8xLnJlc29sdmVCU09OT3B0aW9ucykob3B0aW9ucyksXG4gICAgICAgICAgICBzZXNzaW9uOiBvcHRpb25zPy5zZXNzaW9uLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IG9wdGlvbnM/LnJlYWRQcmVmZXJlbmNlLFxuICAgICAgICAgICAgdGltZW91dE1TOiBvcHRpb25zPy50aW1lb3V0TVMgPz8gdGhpcy5zLmRiLnRpbWVvdXRNU1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIHRoZSBzZXJ2ZXIgYnVpbGQgaW5mb3JtYXRpb25cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgYnVpbGRJbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbWFuZCh7IGJ1aWxkaW5mbzogMSB9LCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIHNlcnZlciBidWlsZCBpbmZvcm1hdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBzZXJ2ZXJJbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbWFuZCh7IGJ1aWxkaW5mbzogMSB9LCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhpcyBkYidzIHNlcnZlciBzdGF0dXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHNlcnZlclN0YXR1cyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbW1hbmQoeyBzZXJ2ZXJTdGF0dXM6IDEgfSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBpbmcgdGhlIE1vbmdvREIgc2VydmVyIGFuZCByZXRyaWV2ZSByZXN1bHRzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHBpbmcob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tYW5kKHsgcGluZzogMSB9LCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgdXNlciBmcm9tIGEgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VybmFtZSAtIFRoZSB1c2VybmFtZSB0byByZW1vdmVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlbW92ZVVzZXIodXNlcm5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucy5kYi5jbGllbnQsIG5ldyByZW1vdmVfdXNlcl8xLlJlbW92ZVVzZXJPcGVyYXRpb24odGhpcy5zLmRiLCB1c2VybmFtZSwgeyBkYk5hbWU6ICdhZG1pbicsIC4uLm9wdGlvbnMgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZSBhbiBleGlzdGluZyBjb2xsZWN0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29sbGVjdGlvbk5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgY29sbGVjdGlvbiB0byB2YWxpZGF0ZS5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHZhbGlkYXRlQ29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLnMuZGIuY2xpZW50LCBuZXcgdmFsaWRhdGVfY29sbGVjdGlvbl8xLlZhbGlkYXRlQ29sbGVjdGlvbk9wZXJhdGlvbih0aGlzLCBjb2xsZWN0aW9uTmFtZSwgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMaXN0IHRoZSBhdmFpbGFibGUgZGF0YWJhc2VzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGxpc3REYXRhYmFzZXMob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5zLmRiLmNsaWVudCwgbmV3IGxpc3RfZGF0YWJhc2VzXzEuTGlzdERhdGFiYXNlc09wZXJhdGlvbih0aGlzLnMuZGIsIHsgdGltZW91dE1TOiB0aGlzLnMuZGIudGltZW91dE1TLCAuLi5vcHRpb25zIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IFJlcGxpY2FTZXQgc3RhdHVzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlcGxTZXRHZXRTdGF0dXMob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tYW5kKHsgcmVwbFNldEdldFN0YXR1czogMSB9LCBvcHRpb25zKTtcbiAgICB9XG59XG5leHBvcnRzLkFkbWluID0gQWRtaW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZG1pbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/admin.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/beta.js":
/*!****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/beta.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\n__exportStar(__webpack_require__(/*! ./index */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/index.js\"), exports);\n/**\n * @internal\n *\n * Since we don't bundle tslib helpers, we need to polyfill this method.\n *\n * This is used in the generated JS.  Adapted from https://github.com/microsoft/TypeScript/blob/aafdfe5b3f76f5c41abeec412ce73c86da94c75f/src/compiler/factory/emitHelpers.ts#L1202.\n */\nfunction __exportStar(mod) {\n    for (const key of Object.keys(mod)) {\n        Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: function () {\n                return mod[key];\n            }\n        });\n    }\n}\n//# sourceMappingURL=beta.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2JldGEuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsYUFBYSxtQkFBTyxDQUFDLDRGQUFTO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvYmV0YS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbl9fZXhwb3J0U3RhcihyZXF1aXJlKFwiLi9pbmRleFwiKSwgZXhwb3J0cyk7XG4vKipcbiAqIEBpbnRlcm5hbFxuICpcbiAqIFNpbmNlIHdlIGRvbid0IGJ1bmRsZSB0c2xpYiBoZWxwZXJzLCB3ZSBuZWVkIHRvIHBvbHlmaWxsIHRoaXMgbWV0aG9kLlxuICpcbiAqIFRoaXMgaXMgdXNlZCBpbiB0aGUgZ2VuZXJhdGVkIEpTLiAgQWRhcHRlZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9ibG9iL2FhZmRmZTViM2Y3NmY1YzQxYWJlZWM0MTJjZTczYzg2ZGE5NGM3NWYvc3JjL2NvbXBpbGVyL2ZhY3RvcnkvZW1pdEhlbHBlcnMudHMjTDEyMDIuXG4gKi9cbmZ1bmN0aW9uIF9fZXhwb3J0U3Rhcihtb2QpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhtb2QpKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9kW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWJldGEuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/beta.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js":
/*!****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.toUTF8 = exports.getBigInt64LE = exports.getFloat64LE = exports.getInt32LE = exports.UUID = exports.Timestamp = exports.serialize = exports.ObjectId = exports.MinKey = exports.MaxKey = exports.Long = exports.Int32 = exports.EJSON = exports.Double = exports.deserialize = exports.Decimal128 = exports.DBRef = exports.Code = exports.calculateObjectSize = exports.BSONType = exports.BSONSymbol = exports.BSONRegExp = exports.BSONError = exports.BSON = exports.Binary = void 0;\nexports.parseToElementsToArray = parseToElementsToArray;\nexports.pluckBSONSerializeOptions = pluckBSONSerializeOptions;\nexports.resolveBSONOptions = resolveBSONOptions;\nexports.parseUtf8ValidationOption = parseUtf8ValidationOption;\n/* eslint-disable no-restricted-imports */\nconst bson_1 = __webpack_require__(/*! bson */ \"(rsc)/./node_modules/.pnpm/bson@6.10.4/node_modules/bson/lib/bson.cjs\");\nvar bson_2 = __webpack_require__(/*! bson */ \"(rsc)/./node_modules/.pnpm/bson@6.10.4/node_modules/bson/lib/bson.cjs\");\nObject.defineProperty(exports, \"Binary\", ({ enumerable: true, get: function () { return bson_2.Binary; } }));\nObject.defineProperty(exports, \"BSON\", ({ enumerable: true, get: function () { return bson_2.BSON; } }));\nObject.defineProperty(exports, \"BSONError\", ({ enumerable: true, get: function () { return bson_2.BSONError; } }));\nObject.defineProperty(exports, \"BSONRegExp\", ({ enumerable: true, get: function () { return bson_2.BSONRegExp; } }));\nObject.defineProperty(exports, \"BSONSymbol\", ({ enumerable: true, get: function () { return bson_2.BSONSymbol; } }));\nObject.defineProperty(exports, \"BSONType\", ({ enumerable: true, get: function () { return bson_2.BSONType; } }));\nObject.defineProperty(exports, \"calculateObjectSize\", ({ enumerable: true, get: function () { return bson_2.calculateObjectSize; } }));\nObject.defineProperty(exports, \"Code\", ({ enumerable: true, get: function () { return bson_2.Code; } }));\nObject.defineProperty(exports, \"DBRef\", ({ enumerable: true, get: function () { return bson_2.DBRef; } }));\nObject.defineProperty(exports, \"Decimal128\", ({ enumerable: true, get: function () { return bson_2.Decimal128; } }));\nObject.defineProperty(exports, \"deserialize\", ({ enumerable: true, get: function () { return bson_2.deserialize; } }));\nObject.defineProperty(exports, \"Double\", ({ enumerable: true, get: function () { return bson_2.Double; } }));\nObject.defineProperty(exports, \"EJSON\", ({ enumerable: true, get: function () { return bson_2.EJSON; } }));\nObject.defineProperty(exports, \"Int32\", ({ enumerable: true, get: function () { return bson_2.Int32; } }));\nObject.defineProperty(exports, \"Long\", ({ enumerable: true, get: function () { return bson_2.Long; } }));\nObject.defineProperty(exports, \"MaxKey\", ({ enumerable: true, get: function () { return bson_2.MaxKey; } }));\nObject.defineProperty(exports, \"MinKey\", ({ enumerable: true, get: function () { return bson_2.MinKey; } }));\nObject.defineProperty(exports, \"ObjectId\", ({ enumerable: true, get: function () { return bson_2.ObjectId; } }));\nObject.defineProperty(exports, \"serialize\", ({ enumerable: true, get: function () { return bson_2.serialize; } }));\nObject.defineProperty(exports, \"Timestamp\", ({ enumerable: true, get: function () { return bson_2.Timestamp; } }));\nObject.defineProperty(exports, \"UUID\", ({ enumerable: true, get: function () { return bson_2.UUID; } }));\nfunction parseToElementsToArray(bytes, offset) {\n    const res = bson_1.BSON.onDemand.parseToElements(bytes, offset);\n    return Array.isArray(res) ? res : [...res];\n}\nexports.getInt32LE = bson_1.BSON.onDemand.NumberUtils.getInt32LE;\nexports.getFloat64LE = bson_1.BSON.onDemand.NumberUtils.getFloat64LE;\nexports.getBigInt64LE = bson_1.BSON.onDemand.NumberUtils.getBigInt64LE;\nexports.toUTF8 = bson_1.BSON.onDemand.ByteUtils.toUTF8;\nfunction pluckBSONSerializeOptions(options) {\n    const { fieldsAsRaw, useBigInt64, promoteValues, promoteBuffers, promoteLongs, serializeFunctions, ignoreUndefined, bsonRegExp, raw, enableUtf8Validation } = options;\n    return {\n        fieldsAsRaw,\n        useBigInt64,\n        promoteValues,\n        promoteBuffers,\n        promoteLongs,\n        serializeFunctions,\n        ignoreUndefined,\n        bsonRegExp,\n        raw,\n        enableUtf8Validation\n    };\n}\n/**\n * Merge the given BSONSerializeOptions, preferring options over the parent's options, and\n * substituting defaults for values not set.\n *\n * @internal\n */\nfunction resolveBSONOptions(options, parent) {\n    const parentOptions = parent?.bsonOptions;\n    return {\n        raw: options?.raw ?? parentOptions?.raw ?? false,\n        useBigInt64: options?.useBigInt64 ?? parentOptions?.useBigInt64 ?? false,\n        promoteLongs: options?.promoteLongs ?? parentOptions?.promoteLongs ?? true,\n        promoteValues: options?.promoteValues ?? parentOptions?.promoteValues ?? true,\n        promoteBuffers: options?.promoteBuffers ?? parentOptions?.promoteBuffers ?? false,\n        ignoreUndefined: options?.ignoreUndefined ?? parentOptions?.ignoreUndefined ?? false,\n        bsonRegExp: options?.bsonRegExp ?? parentOptions?.bsonRegExp ?? false,\n        serializeFunctions: options?.serializeFunctions ?? parentOptions?.serializeFunctions ?? false,\n        fieldsAsRaw: options?.fieldsAsRaw ?? parentOptions?.fieldsAsRaw ?? {},\n        enableUtf8Validation: options?.enableUtf8Validation ?? parentOptions?.enableUtf8Validation ?? true\n    };\n}\n/** @internal */\nfunction parseUtf8ValidationOption(options) {\n    const enableUtf8Validation = options?.enableUtf8Validation;\n    if (enableUtf8Validation === false) {\n        return { utf8: false };\n    }\n    return { utf8: { writeErrors: false } };\n}\n//# sourceMappingURL=bson.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2Jzb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsY0FBYyxHQUFHLHFCQUFxQixHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLFlBQVksR0FBRyxpQkFBaUIsR0FBRyxpQkFBaUIsR0FBRyxnQkFBZ0IsR0FBRyxjQUFjLEdBQUcsY0FBYyxHQUFHLFlBQVksR0FBRyxhQUFhLEdBQUcsYUFBYSxHQUFHLGNBQWMsR0FBRyxtQkFBbUIsR0FBRyxrQkFBa0IsR0FBRyxhQUFhLEdBQUcsWUFBWSxHQUFHLDJCQUEyQixHQUFHLGdCQUFnQixHQUFHLGtCQUFrQixHQUFHLGtCQUFrQixHQUFHLGlCQUFpQixHQUFHLFlBQVksR0FBRyxjQUFjO0FBQ3ZkLDhCQUE4QjtBQUM5QixpQ0FBaUM7QUFDakMsMEJBQTBCO0FBQzFCLGlDQUFpQztBQUNqQztBQUNBLGVBQWUsbUJBQU8sQ0FBQyxtRkFBTTtBQUM3QixhQUFhLG1CQUFPLENBQUMsbUZBQU07QUFDM0IsMENBQXlDLEVBQUUscUNBQXFDLHlCQUF5QixFQUFDO0FBQzFHLHdDQUF1QyxFQUFFLHFDQUFxQyx1QkFBdUIsRUFBQztBQUN0Ryw2Q0FBNEMsRUFBRSxxQ0FBcUMsNEJBQTRCLEVBQUM7QUFDaEgsOENBQTZDLEVBQUUscUNBQXFDLDZCQUE2QixFQUFDO0FBQ2xILDhDQUE2QyxFQUFFLHFDQUFxQyw2QkFBNkIsRUFBQztBQUNsSCw0Q0FBMkMsRUFBRSxxQ0FBcUMsMkJBQTJCLEVBQUM7QUFDOUcsdURBQXNELEVBQUUscUNBQXFDLHNDQUFzQyxFQUFDO0FBQ3BJLHdDQUF1QyxFQUFFLHFDQUFxQyx1QkFBdUIsRUFBQztBQUN0Ryx5Q0FBd0MsRUFBRSxxQ0FBcUMsd0JBQXdCLEVBQUM7QUFDeEcsOENBQTZDLEVBQUUscUNBQXFDLDZCQUE2QixFQUFDO0FBQ2xILCtDQUE4QyxFQUFFLHFDQUFxQyw4QkFBOEIsRUFBQztBQUNwSCwwQ0FBeUMsRUFBRSxxQ0FBcUMseUJBQXlCLEVBQUM7QUFDMUcseUNBQXdDLEVBQUUscUNBQXFDLHdCQUF3QixFQUFDO0FBQ3hHLHlDQUF3QyxFQUFFLHFDQUFxQyx3QkFBd0IsRUFBQztBQUN4Ryx3Q0FBdUMsRUFBRSxxQ0FBcUMsdUJBQXVCLEVBQUM7QUFDdEcsMENBQXlDLEVBQUUscUNBQXFDLHlCQUF5QixFQUFDO0FBQzFHLDBDQUF5QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUMxRyw0Q0FBMkMsRUFBRSxxQ0FBcUMsMkJBQTJCLEVBQUM7QUFDOUcsNkNBQTRDLEVBQUUscUNBQXFDLDRCQUE0QixFQUFDO0FBQ2hILDZDQUE0QyxFQUFFLHFDQUFxQyw0QkFBNEIsRUFBQztBQUNoSCx3Q0FBdUMsRUFBRSxxQ0FBcUMsdUJBQXVCLEVBQUM7QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIsb0JBQW9CO0FBQ3BCLHFCQUFxQjtBQUNyQixjQUFjO0FBQ2Q7QUFDQSxZQUFZLG9KQUFvSjtBQUNoSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkU7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhLFFBQVE7QUFDckI7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2Jzb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnRvVVRGOCA9IGV4cG9ydHMuZ2V0QmlnSW50NjRMRSA9IGV4cG9ydHMuZ2V0RmxvYXQ2NExFID0gZXhwb3J0cy5nZXRJbnQzMkxFID0gZXhwb3J0cy5VVUlEID0gZXhwb3J0cy5UaW1lc3RhbXAgPSBleHBvcnRzLnNlcmlhbGl6ZSA9IGV4cG9ydHMuT2JqZWN0SWQgPSBleHBvcnRzLk1pbktleSA9IGV4cG9ydHMuTWF4S2V5ID0gZXhwb3J0cy5Mb25nID0gZXhwb3J0cy5JbnQzMiA9IGV4cG9ydHMuRUpTT04gPSBleHBvcnRzLkRvdWJsZSA9IGV4cG9ydHMuZGVzZXJpYWxpemUgPSBleHBvcnRzLkRlY2ltYWwxMjggPSBleHBvcnRzLkRCUmVmID0gZXhwb3J0cy5Db2RlID0gZXhwb3J0cy5jYWxjdWxhdGVPYmplY3RTaXplID0gZXhwb3J0cy5CU09OVHlwZSA9IGV4cG9ydHMuQlNPTlN5bWJvbCA9IGV4cG9ydHMuQlNPTlJlZ0V4cCA9IGV4cG9ydHMuQlNPTkVycm9yID0gZXhwb3J0cy5CU09OID0gZXhwb3J0cy5CaW5hcnkgPSB2b2lkIDA7XG5leHBvcnRzLnBhcnNlVG9FbGVtZW50c1RvQXJyYXkgPSBwYXJzZVRvRWxlbWVudHNUb0FycmF5O1xuZXhwb3J0cy5wbHVja0JTT05TZXJpYWxpemVPcHRpb25zID0gcGx1Y2tCU09OU2VyaWFsaXplT3B0aW9ucztcbmV4cG9ydHMucmVzb2x2ZUJTT05PcHRpb25zID0gcmVzb2x2ZUJTT05PcHRpb25zO1xuZXhwb3J0cy5wYXJzZVV0ZjhWYWxpZGF0aW9uT3B0aW9uID0gcGFyc2VVdGY4VmFsaWRhdGlvbk9wdGlvbjtcbi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtaW1wb3J0cyAqL1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcImJzb25cIik7XG52YXIgYnNvbl8yID0gcmVxdWlyZShcImJzb25cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCaW5hcnlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5CaW5hcnk7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuQlNPTjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJTT05FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJTT05FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJTT05SZWdFeHBcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5CU09OUmVnRXhwOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQlNPTlN5bWJvbFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJTT05TeW1ib2w7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OVHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJTT05UeXBlOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiY2FsY3VsYXRlT2JqZWN0U2l6ZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLmNhbGN1bGF0ZU9iamVjdFNpemU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb2RlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuQ29kZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkRCUmVmXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuREJSZWY7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEZWNpbWFsMTI4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuRGVjaW1hbDEyODsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImRlc2VyaWFsaXplXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuZGVzZXJpYWxpemU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEb3VibGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5Eb3VibGU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJFSlNPTlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkVKU09OOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiSW50MzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5JbnQzMjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkxvbmdcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5Mb25nOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTWF4S2V5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuTWF4S2V5OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTWluS2V5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuTWluS2V5OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiT2JqZWN0SWRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5PYmplY3RJZDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInNlcmlhbGl6ZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLnNlcmlhbGl6ZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRpbWVzdGFtcFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLlRpbWVzdGFtcDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlVVSURcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5VVUlEOyB9IH0pO1xuZnVuY3Rpb24gcGFyc2VUb0VsZW1lbnRzVG9BcnJheShieXRlcywgb2Zmc2V0KSB7XG4gICAgY29uc3QgcmVzID0gYnNvbl8xLkJTT04ub25EZW1hbmQucGFyc2VUb0VsZW1lbnRzKGJ5dGVzLCBvZmZzZXQpO1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHJlcykgPyByZXMgOiBbLi4ucmVzXTtcbn1cbmV4cG9ydHMuZ2V0SW50MzJMRSA9IGJzb25fMS5CU09OLm9uRGVtYW5kLk51bWJlclV0aWxzLmdldEludDMyTEU7XG5leHBvcnRzLmdldEZsb2F0NjRMRSA9IGJzb25fMS5CU09OLm9uRGVtYW5kLk51bWJlclV0aWxzLmdldEZsb2F0NjRMRTtcbmV4cG9ydHMuZ2V0QmlnSW50NjRMRSA9IGJzb25fMS5CU09OLm9uRGVtYW5kLk51bWJlclV0aWxzLmdldEJpZ0ludDY0TEU7XG5leHBvcnRzLnRvVVRGOCA9IGJzb25fMS5CU09OLm9uRGVtYW5kLkJ5dGVVdGlscy50b1VURjg7XG5mdW5jdGlvbiBwbHVja0JTT05TZXJpYWxpemVPcHRpb25zKG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGZpZWxkc0FzUmF3LCB1c2VCaWdJbnQ2NCwgcHJvbW90ZVZhbHVlcywgcHJvbW90ZUJ1ZmZlcnMsIHByb21vdGVMb25ncywgc2VyaWFsaXplRnVuY3Rpb25zLCBpZ25vcmVVbmRlZmluZWQsIGJzb25SZWdFeHAsIHJhdywgZW5hYmxlVXRmOFZhbGlkYXRpb24gfSA9IG9wdGlvbnM7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZmllbGRzQXNSYXcsXG4gICAgICAgIHVzZUJpZ0ludDY0LFxuICAgICAgICBwcm9tb3RlVmFsdWVzLFxuICAgICAgICBwcm9tb3RlQnVmZmVycyxcbiAgICAgICAgcHJvbW90ZUxvbmdzLFxuICAgICAgICBzZXJpYWxpemVGdW5jdGlvbnMsXG4gICAgICAgIGlnbm9yZVVuZGVmaW5lZCxcbiAgICAgICAgYnNvblJlZ0V4cCxcbiAgICAgICAgcmF3LFxuICAgICAgICBlbmFibGVVdGY4VmFsaWRhdGlvblxuICAgIH07XG59XG4vKipcbiAqIE1lcmdlIHRoZSBnaXZlbiBCU09OU2VyaWFsaXplT3B0aW9ucywgcHJlZmVycmluZyBvcHRpb25zIG92ZXIgdGhlIHBhcmVudCdzIG9wdGlvbnMsIGFuZFxuICogc3Vic3RpdHV0aW5nIGRlZmF1bHRzIGZvciB2YWx1ZXMgbm90IHNldC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gcmVzb2x2ZUJTT05PcHRpb25zKG9wdGlvbnMsIHBhcmVudCkge1xuICAgIGNvbnN0IHBhcmVudE9wdGlvbnMgPSBwYXJlbnQ/LmJzb25PcHRpb25zO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJhdzogb3B0aW9ucz8ucmF3ID8/IHBhcmVudE9wdGlvbnM/LnJhdyA/PyBmYWxzZSxcbiAgICAgICAgdXNlQmlnSW50NjQ6IG9wdGlvbnM/LnVzZUJpZ0ludDY0ID8/IHBhcmVudE9wdGlvbnM/LnVzZUJpZ0ludDY0ID8/IGZhbHNlLFxuICAgICAgICBwcm9tb3RlTG9uZ3M6IG9wdGlvbnM/LnByb21vdGVMb25ncyA/PyBwYXJlbnRPcHRpb25zPy5wcm9tb3RlTG9uZ3MgPz8gdHJ1ZSxcbiAgICAgICAgcHJvbW90ZVZhbHVlczogb3B0aW9ucz8ucHJvbW90ZVZhbHVlcyA/PyBwYXJlbnRPcHRpb25zPy5wcm9tb3RlVmFsdWVzID8/IHRydWUsXG4gICAgICAgIHByb21vdGVCdWZmZXJzOiBvcHRpb25zPy5wcm9tb3RlQnVmZmVycyA/PyBwYXJlbnRPcHRpb25zPy5wcm9tb3RlQnVmZmVycyA/PyBmYWxzZSxcbiAgICAgICAgaWdub3JlVW5kZWZpbmVkOiBvcHRpb25zPy5pZ25vcmVVbmRlZmluZWQgPz8gcGFyZW50T3B0aW9ucz8uaWdub3JlVW5kZWZpbmVkID8/IGZhbHNlLFxuICAgICAgICBic29uUmVnRXhwOiBvcHRpb25zPy5ic29uUmVnRXhwID8/IHBhcmVudE9wdGlvbnM/LmJzb25SZWdFeHAgPz8gZmFsc2UsXG4gICAgICAgIHNlcmlhbGl6ZUZ1bmN0aW9uczogb3B0aW9ucz8uc2VyaWFsaXplRnVuY3Rpb25zID8/IHBhcmVudE9wdGlvbnM/LnNlcmlhbGl6ZUZ1bmN0aW9ucyA/PyBmYWxzZSxcbiAgICAgICAgZmllbGRzQXNSYXc6IG9wdGlvbnM/LmZpZWxkc0FzUmF3ID8/IHBhcmVudE9wdGlvbnM/LmZpZWxkc0FzUmF3ID8/IHt9LFxuICAgICAgICBlbmFibGVVdGY4VmFsaWRhdGlvbjogb3B0aW9ucz8uZW5hYmxlVXRmOFZhbGlkYXRpb24gPz8gcGFyZW50T3B0aW9ucz8uZW5hYmxlVXRmOFZhbGlkYXRpb24gPz8gdHJ1ZVxuICAgIH07XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBwYXJzZVV0ZjhWYWxpZGF0aW9uT3B0aW9uKG9wdGlvbnMpIHtcbiAgICBjb25zdCBlbmFibGVVdGY4VmFsaWRhdGlvbiA9IG9wdGlvbnM/LmVuYWJsZVV0ZjhWYWxpZGF0aW9uO1xuICAgIGlmIChlbmFibGVVdGY4VmFsaWRhdGlvbiA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHsgdXRmODogZmFsc2UgfTtcbiAgICB9XG4gICAgcmV0dXJuIHsgdXRmODogeyB3cml0ZUVycm9yczogZmFsc2UgfSB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YnNvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.BulkOperationBase = exports.BulkWriteShimOperation = exports.FindOperators = exports.MongoBulkWriteError = exports.WriteError = exports.WriteConcernError = exports.BulkWriteResult = exports.Batch = exports.BatchType = void 0;\nexports.mergeBatchResults = mergeBatchResults;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst delete_1 = __webpack_require__(/*! ../operations/delete */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/delete.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst insert_1 = __webpack_require__(/*! ../operations/insert */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/insert.js\");\nconst operation_1 = __webpack_require__(/*! ../operations/operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\nconst update_1 = __webpack_require__(/*! ../operations/update */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/update.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\n/** @public */\nexports.BatchType = Object.freeze({\n    INSERT: 1,\n    UPDATE: 2,\n    DELETE: 3\n});\n/**\n * Keeps the state of a unordered batch so we can rewrite the results\n * correctly after command execution\n *\n * @public\n */\nclass Batch {\n    constructor(batchType, originalZeroIndex) {\n        this.originalZeroIndex = originalZeroIndex;\n        this.currentIndex = 0;\n        this.originalIndexes = [];\n        this.batchType = batchType;\n        this.operations = [];\n        this.size = 0;\n        this.sizeBytes = 0;\n    }\n}\nexports.Batch = Batch;\n/**\n * @public\n * The result of a bulk write.\n */\nclass BulkWriteResult {\n    static generateIdMap(ids) {\n        const idMap = {};\n        for (const doc of ids) {\n            idMap[doc.index] = doc._id;\n        }\n        return idMap;\n    }\n    /**\n     * Create a new BulkWriteResult instance\n     * @internal\n     */\n    constructor(bulkResult, isOrdered) {\n        this.result = bulkResult;\n        this.insertedCount = this.result.nInserted ?? 0;\n        this.matchedCount = this.result.nMatched ?? 0;\n        this.modifiedCount = this.result.nModified ?? 0;\n        this.deletedCount = this.result.nRemoved ?? 0;\n        this.upsertedCount = this.result.upserted.length ?? 0;\n        this.upsertedIds = BulkWriteResult.generateIdMap(this.result.upserted);\n        this.insertedIds = BulkWriteResult.generateIdMap(this.getSuccessfullyInsertedIds(bulkResult, isOrdered));\n        Object.defineProperty(this, 'result', { value: this.result, enumerable: false });\n    }\n    /** Evaluates to true if the bulk operation correctly executes */\n    get ok() {\n        return this.result.ok;\n    }\n    /**\n     * Returns document_ids that were actually inserted\n     * @internal\n     */\n    getSuccessfullyInsertedIds(bulkResult, isOrdered) {\n        if (bulkResult.writeErrors.length === 0)\n            return bulkResult.insertedIds;\n        if (isOrdered) {\n            return bulkResult.insertedIds.slice(0, bulkResult.writeErrors[0].index);\n        }\n        return bulkResult.insertedIds.filter(({ index }) => !bulkResult.writeErrors.some(writeError => index === writeError.index));\n    }\n    /** Returns the upserted id at the given index */\n    getUpsertedIdAt(index) {\n        return this.result.upserted[index];\n    }\n    /** Returns raw internal result */\n    getRawResponse() {\n        return this.result;\n    }\n    /** Returns true if the bulk operation contains a write error */\n    hasWriteErrors() {\n        return this.result.writeErrors.length > 0;\n    }\n    /** Returns the number of write errors off the bulk operation */\n    getWriteErrorCount() {\n        return this.result.writeErrors.length;\n    }\n    /** Returns a specific write error object */\n    getWriteErrorAt(index) {\n        return index < this.result.writeErrors.length ? this.result.writeErrors[index] : undefined;\n    }\n    /** Retrieve all write errors */\n    getWriteErrors() {\n        return this.result.writeErrors;\n    }\n    /** Retrieve the write concern error if one exists */\n    getWriteConcernError() {\n        if (this.result.writeConcernErrors.length === 0) {\n            return;\n        }\n        else if (this.result.writeConcernErrors.length === 1) {\n            // Return the error\n            return this.result.writeConcernErrors[0];\n        }\n        else {\n            // Combine the errors\n            let errmsg = '';\n            for (let i = 0; i < this.result.writeConcernErrors.length; i++) {\n                const err = this.result.writeConcernErrors[i];\n                errmsg = errmsg + err.errmsg;\n                // TODO: Something better\n                if (i === 0)\n                    errmsg = errmsg + ' and ';\n            }\n            return new WriteConcernError({ errmsg, code: error_1.MONGODB_ERROR_CODES.WriteConcernTimeout });\n        }\n    }\n    toString() {\n        return `BulkWriteResult(${bson_1.EJSON.stringify(this.result)})`;\n    }\n    isOk() {\n        return this.result.ok === 1;\n    }\n}\nexports.BulkWriteResult = BulkWriteResult;\n/**\n * An error representing a failure by the server to apply the requested write concern to the bulk operation.\n * @public\n * @category Error\n */\nclass WriteConcernError {\n    constructor(error) {\n        this.serverError = error;\n    }\n    /** Write concern error code. */\n    get code() {\n        return this.serverError.code;\n    }\n    /** Write concern error message. */\n    get errmsg() {\n        return this.serverError.errmsg;\n    }\n    /** Write concern error info. */\n    get errInfo() {\n        return this.serverError.errInfo;\n    }\n    toJSON() {\n        return this.serverError;\n    }\n    toString() {\n        return `WriteConcernError(${this.errmsg})`;\n    }\n}\nexports.WriteConcernError = WriteConcernError;\n/**\n * An error that occurred during a BulkWrite on the server.\n * @public\n * @category Error\n */\nclass WriteError {\n    constructor(err) {\n        this.err = err;\n    }\n    /** WriteError code. */\n    get code() {\n        return this.err.code;\n    }\n    /** WriteError original bulk operation index. */\n    get index() {\n        return this.err.index;\n    }\n    /** WriteError message. */\n    get errmsg() {\n        return this.err.errmsg;\n    }\n    /** WriteError details. */\n    get errInfo() {\n        return this.err.errInfo;\n    }\n    /** Returns the underlying operation that caused the error */\n    getOperation() {\n        return this.err.op;\n    }\n    toJSON() {\n        return { code: this.err.code, index: this.err.index, errmsg: this.err.errmsg, op: this.err.op };\n    }\n    toString() {\n        return `WriteError(${JSON.stringify(this.toJSON())})`;\n    }\n}\nexports.WriteError = WriteError;\n/** Merges results into shared data structure */\nfunction mergeBatchResults(batch, bulkResult, err, result) {\n    // If we have an error set the result to be the err object\n    if (err) {\n        result = err;\n    }\n    else if (result && result.result) {\n        result = result.result;\n    }\n    if (result == null) {\n        return;\n    }\n    // Do we have a top level error stop processing and return\n    if (result.ok === 0 && bulkResult.ok === 1) {\n        bulkResult.ok = 0;\n        const writeError = {\n            index: 0,\n            code: result.code || 0,\n            errmsg: result.message,\n            errInfo: result.errInfo,\n            op: batch.operations[0]\n        };\n        bulkResult.writeErrors.push(new WriteError(writeError));\n        return;\n    }\n    else if (result.ok === 0 && bulkResult.ok === 0) {\n        return;\n    }\n    // If we have an insert Batch type\n    if (isInsertBatch(batch) && result.n) {\n        bulkResult.nInserted = bulkResult.nInserted + result.n;\n    }\n    // If we have an insert Batch type\n    if (isDeleteBatch(batch) && result.n) {\n        bulkResult.nRemoved = bulkResult.nRemoved + result.n;\n    }\n    let nUpserted = 0;\n    // We have an array of upserted values, we need to rewrite the indexes\n    if (Array.isArray(result.upserted)) {\n        nUpserted = result.upserted.length;\n        for (let i = 0; i < result.upserted.length; i++) {\n            bulkResult.upserted.push({\n                index: result.upserted[i].index + batch.originalZeroIndex,\n                _id: result.upserted[i]._id\n            });\n        }\n    }\n    else if (result.upserted) {\n        nUpserted = 1;\n        bulkResult.upserted.push({\n            index: batch.originalZeroIndex,\n            _id: result.upserted\n        });\n    }\n    // If we have an update Batch type\n    if (isUpdateBatch(batch) && result.n) {\n        const nModified = result.nModified;\n        bulkResult.nUpserted = bulkResult.nUpserted + nUpserted;\n        bulkResult.nMatched = bulkResult.nMatched + (result.n - nUpserted);\n        if (typeof nModified === 'number') {\n            bulkResult.nModified = bulkResult.nModified + nModified;\n        }\n        else {\n            bulkResult.nModified = 0;\n        }\n    }\n    if (Array.isArray(result.writeErrors)) {\n        for (let i = 0; i < result.writeErrors.length; i++) {\n            const writeError = {\n                index: batch.originalIndexes[result.writeErrors[i].index],\n                code: result.writeErrors[i].code,\n                errmsg: result.writeErrors[i].errmsg,\n                errInfo: result.writeErrors[i].errInfo,\n                op: batch.operations[result.writeErrors[i].index]\n            };\n            bulkResult.writeErrors.push(new WriteError(writeError));\n        }\n    }\n    if (result.writeConcernError) {\n        bulkResult.writeConcernErrors.push(new WriteConcernError(result.writeConcernError));\n    }\n}\nasync function executeCommands(bulkOperation, options) {\n    if (bulkOperation.s.batches.length === 0) {\n        return new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered);\n    }\n    for (const batch of bulkOperation.s.batches) {\n        const finalOptions = (0, utils_1.resolveOptions)(bulkOperation, {\n            ...options,\n            ordered: bulkOperation.isOrdered\n        });\n        if (finalOptions.bypassDocumentValidation !== true) {\n            delete finalOptions.bypassDocumentValidation;\n        }\n        // Is the bypassDocumentValidation options specific\n        if (bulkOperation.s.bypassDocumentValidation === true) {\n            finalOptions.bypassDocumentValidation = true;\n        }\n        // Is the checkKeys option disabled\n        if (bulkOperation.s.checkKeys === false) {\n            finalOptions.checkKeys = false;\n        }\n        if (finalOptions.retryWrites) {\n            if (isUpdateBatch(batch)) {\n                finalOptions.retryWrites =\n                    finalOptions.retryWrites && !batch.operations.some(op => op.multi);\n            }\n            if (isDeleteBatch(batch)) {\n                finalOptions.retryWrites =\n                    finalOptions.retryWrites && !batch.operations.some(op => op.limit === 0);\n            }\n        }\n        const operation = isInsertBatch(batch)\n            ? new insert_1.InsertOperation(bulkOperation.s.namespace, batch.operations, finalOptions)\n            : isUpdateBatch(batch)\n                ? new update_1.UpdateOperation(bulkOperation.s.namespace, batch.operations, finalOptions)\n                : isDeleteBatch(batch)\n                    ? new delete_1.DeleteOperation(bulkOperation.s.namespace, batch.operations, finalOptions)\n                    : null;\n        if (operation == null)\n            throw new error_1.MongoRuntimeError(`Unknown batchType: ${batch.batchType}`);\n        let thrownError = null;\n        let result;\n        try {\n            result = await (0, execute_operation_1.executeOperation)(bulkOperation.s.collection.client, operation, finalOptions.timeoutContext);\n        }\n        catch (error) {\n            thrownError = error;\n        }\n        if (thrownError != null) {\n            if (thrownError instanceof error_1.MongoWriteConcernError) {\n                mergeBatchResults(batch, bulkOperation.s.bulkResult, thrownError, result);\n                const writeResult = new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered);\n                throw new MongoBulkWriteError({\n                    message: thrownError.result.writeConcernError.errmsg,\n                    code: thrownError.result.writeConcernError.code\n                }, writeResult);\n            }\n            else {\n                // Error is a driver related error not a bulk op error, return early\n                throw new MongoBulkWriteError(thrownError, new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered));\n            }\n        }\n        mergeBatchResults(batch, bulkOperation.s.bulkResult, thrownError, result);\n        const writeResult = new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered);\n        bulkOperation.handleWriteError(writeResult);\n    }\n    bulkOperation.s.batches.length = 0;\n    const writeResult = new BulkWriteResult(bulkOperation.s.bulkResult, bulkOperation.isOrdered);\n    bulkOperation.handleWriteError(writeResult);\n    return writeResult;\n}\n/**\n * An error indicating an unsuccessful Bulk Write\n * @public\n * @category Error\n */\nclass MongoBulkWriteError extends error_1.MongoServerError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(error, result) {\n        super(error);\n        this.writeErrors = [];\n        if (error instanceof WriteConcernError)\n            this.err = error;\n        else if (!(error instanceof Error)) {\n            this.message = error.message;\n            this.code = error.code;\n            this.writeErrors = error.writeErrors ?? [];\n        }\n        this.result = result;\n        Object.assign(this, error);\n    }\n    get name() {\n        return 'MongoBulkWriteError';\n    }\n    /** Number of documents inserted. */\n    get insertedCount() {\n        return this.result.insertedCount;\n    }\n    /** Number of documents matched for update. */\n    get matchedCount() {\n        return this.result.matchedCount;\n    }\n    /** Number of documents modified. */\n    get modifiedCount() {\n        return this.result.modifiedCount;\n    }\n    /** Number of documents deleted. */\n    get deletedCount() {\n        return this.result.deletedCount;\n    }\n    /** Number of documents upserted. */\n    get upsertedCount() {\n        return this.result.upsertedCount;\n    }\n    /** Inserted document generated Id's, hash key is the index of the originating operation */\n    get insertedIds() {\n        return this.result.insertedIds;\n    }\n    /** Upserted document generated Id's, hash key is the index of the originating operation */\n    get upsertedIds() {\n        return this.result.upsertedIds;\n    }\n}\nexports.MongoBulkWriteError = MongoBulkWriteError;\n/**\n * A builder object that is returned from {@link BulkOperationBase#find}.\n * Is used to build a write operation that involves a query filter.\n *\n * @public\n */\nclass FindOperators {\n    /**\n     * Creates a new FindOperators object.\n     * @internal\n     */\n    constructor(bulkOperation) {\n        this.bulkOperation = bulkOperation;\n    }\n    /** Add a multiple update operation to the bulk operation */\n    update(updateDocument) {\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.UPDATE, (0, update_1.makeUpdateStatement)(currentOp.selector, updateDocument, {\n            ...currentOp,\n            multi: true\n        }));\n    }\n    /** Add a single update operation to the bulk operation */\n    updateOne(updateDocument) {\n        if (!(0, utils_1.hasAtomicOperators)(updateDocument)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.UPDATE, (0, update_1.makeUpdateStatement)(currentOp.selector, updateDocument, { ...currentOp, multi: false }));\n    }\n    /** Add a replace one operation to the bulk operation */\n    replaceOne(replacement) {\n        if ((0, utils_1.hasAtomicOperators)(replacement)) {\n            throw new error_1.MongoInvalidArgumentError('Replacement document must not use atomic operators');\n        }\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.UPDATE, (0, update_1.makeUpdateStatement)(currentOp.selector, replacement, { ...currentOp, multi: false }));\n    }\n    /** Add a delete one operation to the bulk operation */\n    deleteOne() {\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(currentOp.selector, { ...currentOp, limit: 1 }));\n    }\n    /** Add a delete many operation to the bulk operation */\n    delete() {\n        const currentOp = buildCurrentOp(this.bulkOperation);\n        return this.bulkOperation.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(currentOp.selector, { ...currentOp, limit: 0 }));\n    }\n    /** Upsert modifier for update bulk operation, noting that this operation is an upsert. */\n    upsert() {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.upsert = true;\n        return this;\n    }\n    /** Specifies the collation for the query condition. */\n    collation(collation) {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.collation = collation;\n        return this;\n    }\n    /** Specifies arrayFilters for UpdateOne or UpdateMany bulk operations. */\n    arrayFilters(arrayFilters) {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.arrayFilters = arrayFilters;\n        return this;\n    }\n    /** Specifies hint for the bulk operation. */\n    hint(hint) {\n        if (!this.bulkOperation.s.currentOp) {\n            this.bulkOperation.s.currentOp = {};\n        }\n        this.bulkOperation.s.currentOp.hint = hint;\n        return this;\n    }\n}\nexports.FindOperators = FindOperators;\n/**\n * TODO(NODE-4063)\n * BulkWrites merge complexity is implemented in executeCommands\n * This provides a vehicle to treat bulkOperations like any other operation (hence \"shim\")\n * We would like this logic to simply live inside the BulkWriteOperation class\n * @internal\n */\nclass BulkWriteShimOperation extends operation_1.AbstractOperation {\n    constructor(bulkOperation, options) {\n        super(options);\n        this.bulkOperation = bulkOperation;\n    }\n    get commandName() {\n        return 'bulkWrite';\n    }\n    async execute(_server, session, timeoutContext) {\n        if (this.options.session == null) {\n            // An implicit session could have been created by 'executeOperation'\n            // So if we stick it on finalOptions here, each bulk operation\n            // will use this same session, it'll be passed in the same way\n            // an explicit session would be\n            this.options.session = session;\n        }\n        return await executeCommands(this.bulkOperation, { ...this.options, timeoutContext });\n    }\n}\nexports.BulkWriteShimOperation = BulkWriteShimOperation;\n/** @public */\nclass BulkOperationBase {\n    /**\n     * Create a new OrderedBulkOperation or UnorderedBulkOperation instance\n     * @internal\n     */\n    constructor(collection, options, isOrdered) {\n        this.collection = collection;\n        // determine whether bulkOperation is ordered or unordered\n        this.isOrdered = isOrdered;\n        const topology = (0, utils_1.getTopology)(collection);\n        options = options == null ? {} : options;\n        // TODO Bring from driver information in hello\n        // Get the namespace for the write operations\n        const namespace = collection.s.namespace;\n        // Used to mark operation as executed\n        const executed = false;\n        // Current item\n        const currentOp = undefined;\n        // Set max byte size\n        const hello = topology.lastHello();\n        // If we have autoEncryption on, batch-splitting must be done on 2mb chunks, but single documents\n        // over 2mb are still allowed\n        const usingAutoEncryption = !!(topology.s.options && topology.s.options.autoEncrypter);\n        const maxBsonObjectSize = hello && hello.maxBsonObjectSize ? hello.maxBsonObjectSize : 1024 * 1024 * 16;\n        const maxBatchSizeBytes = usingAutoEncryption ? 1024 * 1024 * 2 : maxBsonObjectSize;\n        const maxWriteBatchSize = hello && hello.maxWriteBatchSize ? hello.maxWriteBatchSize : 1000;\n        // Calculates the largest possible size of an Array key, represented as a BSON string\n        // element. This calculation:\n        //     1 byte for BSON type\n        //     # of bytes = length of (string representation of (maxWriteBatchSize - 1))\n        //   + 1 bytes for null terminator\n        const maxKeySize = (maxWriteBatchSize - 1).toString(10).length + 2;\n        // Final options for retryable writes\n        let finalOptions = Object.assign({}, options);\n        finalOptions = (0, utils_1.applyRetryableWrites)(finalOptions, collection.s.db);\n        // Final results\n        const bulkResult = {\n            ok: 1,\n            writeErrors: [],\n            writeConcernErrors: [],\n            insertedIds: [],\n            nInserted: 0,\n            nUpserted: 0,\n            nMatched: 0,\n            nModified: 0,\n            nRemoved: 0,\n            upserted: []\n        };\n        // Internal state\n        this.s = {\n            // Final result\n            bulkResult,\n            // Current batch state\n            currentBatch: undefined,\n            currentIndex: 0,\n            // ordered specific\n            currentBatchSize: 0,\n            currentBatchSizeBytes: 0,\n            // unordered specific\n            currentInsertBatch: undefined,\n            currentUpdateBatch: undefined,\n            currentRemoveBatch: undefined,\n            batches: [],\n            // Write concern\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options),\n            // Max batch size options\n            maxBsonObjectSize,\n            maxBatchSizeBytes,\n            maxWriteBatchSize,\n            maxKeySize,\n            // Namespace\n            namespace,\n            // Topology\n            topology,\n            // Options\n            options: finalOptions,\n            // BSON options\n            bsonOptions: (0, bson_1.resolveBSONOptions)(options),\n            // Current operation\n            currentOp,\n            // Executed\n            executed,\n            // Collection\n            collection,\n            // Fundamental error\n            err: undefined,\n            // check keys\n            checkKeys: typeof options.checkKeys === 'boolean' ? options.checkKeys : false\n        };\n        // bypass Validation\n        if (options.bypassDocumentValidation === true) {\n            this.s.bypassDocumentValidation = true;\n        }\n    }\n    /**\n     * Add a single insert document to the bulk operation\n     *\n     * @example\n     * ```ts\n     * const bulkOp = collection.initializeOrderedBulkOp();\n     *\n     * // Adds three inserts to the bulkOp.\n     * bulkOp\n     *   .insert({ a: 1 })\n     *   .insert({ b: 2 })\n     *   .insert({ c: 3 });\n     * await bulkOp.execute();\n     * ```\n     */\n    insert(document) {\n        (0, utils_1.maybeAddIdToDocuments)(this.collection, document, {\n            forceServerObjectId: this.shouldForceServerObjectId()\n        });\n        return this.addToOperationsList(exports.BatchType.INSERT, document);\n    }\n    /**\n     * Builds a find operation for an update/updateOne/delete/deleteOne/replaceOne.\n     * Returns a builder object used to complete the definition of the operation.\n     *\n     * @example\n     * ```ts\n     * const bulkOp = collection.initializeOrderedBulkOp();\n     *\n     * // Add an updateOne to the bulkOp\n     * bulkOp.find({ a: 1 }).updateOne({ $set: { b: 2 } });\n     *\n     * // Add an updateMany to the bulkOp\n     * bulkOp.find({ c: 3 }).update({ $set: { d: 4 } });\n     *\n     * // Add an upsert\n     * bulkOp.find({ e: 5 }).upsert().updateOne({ $set: { f: 6 } });\n     *\n     * // Add a deletion\n     * bulkOp.find({ g: 7 }).deleteOne();\n     *\n     * // Add a multi deletion\n     * bulkOp.find({ h: 8 }).delete();\n     *\n     * // Add a replaceOne\n     * bulkOp.find({ i: 9 }).replaceOne({writeConcern: { j: 10 }});\n     *\n     * // Update using a pipeline (requires Mongodb 4.2 or higher)\n     * bulk.find({ k: 11, y: { $exists: true }, z: { $exists: true } }).updateOne([\n     *   { $set: { total: { $sum: [ '$y', '$z' ] } } }\n     * ]);\n     *\n     * // All of the ops will now be executed\n     * await bulkOp.execute();\n     * ```\n     */\n    find(selector) {\n        if (!selector) {\n            throw new error_1.MongoInvalidArgumentError('Bulk find operation must specify a selector');\n        }\n        // Save a current selector\n        this.s.currentOp = {\n            selector: selector\n        };\n        return new FindOperators(this);\n    }\n    /** Specifies a raw operation to perform in the bulk write. */\n    raw(op) {\n        if (op == null || typeof op !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Operation must be an object with an operation key');\n        }\n        if ('insertOne' in op) {\n            const forceServerObjectId = this.shouldForceServerObjectId();\n            const document = op.insertOne && op.insertOne.document == null\n                ? // TODO(NODE-6003): remove support for omitting the `documents` subdocument in bulk inserts\n                    op.insertOne\n                : op.insertOne.document;\n            (0, utils_1.maybeAddIdToDocuments)(this.collection, document, { forceServerObjectId });\n            return this.addToOperationsList(exports.BatchType.INSERT, document);\n        }\n        if ('replaceOne' in op || 'updateOne' in op || 'updateMany' in op) {\n            if ('replaceOne' in op) {\n                if ('q' in op.replaceOne) {\n                    throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n                }\n                const updateStatement = (0, update_1.makeUpdateStatement)(op.replaceOne.filter, op.replaceOne.replacement, { ...op.replaceOne, multi: false });\n                if ((0, utils_1.hasAtomicOperators)(updateStatement.u)) {\n                    throw new error_1.MongoInvalidArgumentError('Replacement document must not use atomic operators');\n                }\n                return this.addToOperationsList(exports.BatchType.UPDATE, updateStatement);\n            }\n            if ('updateOne' in op) {\n                if ('q' in op.updateOne) {\n                    throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n                }\n                const updateStatement = (0, update_1.makeUpdateStatement)(op.updateOne.filter, op.updateOne.update, {\n                    ...op.updateOne,\n                    multi: false\n                });\n                if (!(0, utils_1.hasAtomicOperators)(updateStatement.u)) {\n                    throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n                }\n                return this.addToOperationsList(exports.BatchType.UPDATE, updateStatement);\n            }\n            if ('updateMany' in op) {\n                if ('q' in op.updateMany) {\n                    throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n                }\n                const updateStatement = (0, update_1.makeUpdateStatement)(op.updateMany.filter, op.updateMany.update, {\n                    ...op.updateMany,\n                    multi: true\n                });\n                if (!(0, utils_1.hasAtomicOperators)(updateStatement.u)) {\n                    throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n                }\n                return this.addToOperationsList(exports.BatchType.UPDATE, updateStatement);\n            }\n        }\n        if ('deleteOne' in op) {\n            if ('q' in op.deleteOne) {\n                throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n            }\n            return this.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(op.deleteOne.filter, { ...op.deleteOne, limit: 1 }));\n        }\n        if ('deleteMany' in op) {\n            if ('q' in op.deleteMany) {\n                throw new error_1.MongoInvalidArgumentError('Raw operations are not allowed');\n            }\n            return this.addToOperationsList(exports.BatchType.DELETE, (0, delete_1.makeDeleteStatement)(op.deleteMany.filter, { ...op.deleteMany, limit: 0 }));\n        }\n        // otherwise an unknown operation was provided\n        throw new error_1.MongoInvalidArgumentError('bulkWrite only supports insertOne, updateOne, updateMany, deleteOne, deleteMany');\n    }\n    get length() {\n        return this.s.currentIndex;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    get writeConcern() {\n        return this.s.writeConcern;\n    }\n    get batches() {\n        const batches = [...this.s.batches];\n        if (this.isOrdered) {\n            if (this.s.currentBatch)\n                batches.push(this.s.currentBatch);\n        }\n        else {\n            if (this.s.currentInsertBatch)\n                batches.push(this.s.currentInsertBatch);\n            if (this.s.currentUpdateBatch)\n                batches.push(this.s.currentUpdateBatch);\n            if (this.s.currentRemoveBatch)\n                batches.push(this.s.currentRemoveBatch);\n        }\n        return batches;\n    }\n    async execute(options = {}) {\n        if (this.s.executed) {\n            throw new error_1.MongoBatchReExecutionError();\n        }\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        if (writeConcern) {\n            this.s.writeConcern = writeConcern;\n        }\n        // If we have current batch\n        if (this.isOrdered) {\n            if (this.s.currentBatch)\n                this.s.batches.push(this.s.currentBatch);\n        }\n        else {\n            if (this.s.currentInsertBatch)\n                this.s.batches.push(this.s.currentInsertBatch);\n            if (this.s.currentUpdateBatch)\n                this.s.batches.push(this.s.currentUpdateBatch);\n            if (this.s.currentRemoveBatch)\n                this.s.batches.push(this.s.currentRemoveBatch);\n        }\n        // If we have no operations in the bulk raise an error\n        if (this.s.batches.length === 0) {\n            throw new error_1.MongoInvalidArgumentError('Invalid BulkOperation, Batch cannot be empty');\n        }\n        this.s.executed = true;\n        const finalOptions = { ...this.s.options, ...options };\n        const operation = new BulkWriteShimOperation(this, finalOptions);\n        return await (0, execute_operation_1.executeOperation)(this.s.collection.client, operation, finalOptions.timeoutContext);\n    }\n    /**\n     * Handles the write error before executing commands\n     * @internal\n     */\n    handleWriteError(writeResult) {\n        if (this.s.bulkResult.writeErrors.length > 0) {\n            const msg = this.s.bulkResult.writeErrors[0].errmsg\n                ? this.s.bulkResult.writeErrors[0].errmsg\n                : 'write operation failed';\n            throw new MongoBulkWriteError({\n                message: msg,\n                code: this.s.bulkResult.writeErrors[0].code,\n                writeErrors: this.s.bulkResult.writeErrors\n            }, writeResult);\n        }\n        const writeConcernError = writeResult.getWriteConcernError();\n        if (writeConcernError) {\n            throw new MongoBulkWriteError(writeConcernError, writeResult);\n        }\n    }\n    shouldForceServerObjectId() {\n        return (this.s.options.forceServerObjectId === true ||\n            this.s.collection.s.db.options?.forceServerObjectId === true);\n    }\n}\nexports.BulkOperationBase = BulkOperationBase;\nfunction isInsertBatch(batch) {\n    return batch.batchType === exports.BatchType.INSERT;\n}\nfunction isUpdateBatch(batch) {\n    return batch.batchType === exports.BatchType.UPDATE;\n}\nfunction isDeleteBatch(batch) {\n    return batch.batchType === exports.BatchType.DELETE;\n}\nfunction buildCurrentOp(bulkOp) {\n    let { currentOp } = bulkOp.s;\n    bulkOp.s.currentOp = undefined;\n    if (!currentOp)\n        currentOp = {};\n    return currentOp;\n}\n//# sourceMappingURL=common.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2J1bGsvY29tbW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QixHQUFHLDhCQUE4QixHQUFHLHFCQUFxQixHQUFHLDJCQUEyQixHQUFHLGtCQUFrQixHQUFHLHlCQUF5QixHQUFHLHVCQUF1QixHQUFHLGFBQWEsR0FBRyxpQkFBaUI7QUFDL04seUJBQXlCO0FBQ3pCLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxpQkFBaUIsbUJBQU8sQ0FBQyxxSEFBc0I7QUFDL0MsNEJBQTRCLG1CQUFPLENBQUMsMklBQWlDO0FBQ3JFLGlCQUFpQixtQkFBTyxDQUFDLHFIQUFzQjtBQUMvQyxvQkFBb0IsbUJBQU8sQ0FBQywySEFBeUI7QUFDckQsaUJBQWlCLG1CQUFPLENBQUMscUhBQXNCO0FBQy9DLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLHdCQUF3QixtQkFBTyxDQUFDLDZHQUFrQjtBQUNsRDtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCx1Q0FBdUM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELE9BQU87QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkNBQTJDO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQywrREFBK0Q7QUFDMUc7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLG9DQUFvQztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFlBQVk7QUFDaEQ7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLDZCQUE2Qiw4QkFBOEI7QUFDM0Q7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qiw0QkFBNEI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsK0JBQStCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0UsZ0JBQWdCO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0EsMkNBQTJDLDZCQUE2QjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3SkFBd0osNEJBQTRCO0FBQ3BMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUpBQXFKLDRCQUE0QjtBQUNqTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdJQUF3SSx3QkFBd0I7QUFDaEs7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3SUFBd0ksd0JBQXdCO0FBQ2hLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsaUNBQWlDO0FBQzVGO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsTUFBTTtBQUN6QixtQkFBbUIsTUFBTTtBQUN6QixtQkFBbUIsTUFBTTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixNQUFNLGNBQWMsUUFBUSxRQUFRO0FBQ3pEO0FBQ0E7QUFDQSxxQkFBcUIsTUFBTSxXQUFXLFFBQVEsUUFBUTtBQUN0RDtBQUNBO0FBQ0EscUJBQXFCLE1BQU0sdUJBQXVCLFFBQVEsUUFBUTtBQUNsRTtBQUNBO0FBQ0EscUJBQXFCLE1BQU07QUFDM0I7QUFDQTtBQUNBLHFCQUFxQixNQUFNO0FBQzNCO0FBQ0E7QUFDQSxxQkFBcUIsTUFBTSxjQUFjLGdCQUFnQixRQUFRO0FBQ2pFO0FBQ0E7QUFDQSxtQkFBbUIsWUFBWSxlQUFlLE9BQU8saUJBQWlCO0FBQ3RFLFdBQVcsUUFBUSxTQUFTO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSxxQkFBcUI7QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2SEFBNkgsZ0NBQWdDO0FBQzdKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrSEFBK0gsMkJBQTJCO0FBQzFKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnSUFBZ0ksNEJBQTRCO0FBQzVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsWUFBWTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9idWxrL2NvbW1vbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQnVsa09wZXJhdGlvbkJhc2UgPSBleHBvcnRzLkJ1bGtXcml0ZVNoaW1PcGVyYXRpb24gPSBleHBvcnRzLkZpbmRPcGVyYXRvcnMgPSBleHBvcnRzLk1vbmdvQnVsa1dyaXRlRXJyb3IgPSBleHBvcnRzLldyaXRlRXJyb3IgPSBleHBvcnRzLldyaXRlQ29uY2VybkVycm9yID0gZXhwb3J0cy5CdWxrV3JpdGVSZXN1bHQgPSBleHBvcnRzLkJhdGNoID0gZXhwb3J0cy5CYXRjaFR5cGUgPSB2b2lkIDA7XG5leHBvcnRzLm1lcmdlQmF0Y2hSZXN1bHRzID0gbWVyZ2VCYXRjaFJlc3VsdHM7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBkZWxldGVfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2RlbGV0ZVwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IGluc2VydF8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvaW5zZXJ0XCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9vcGVyYXRpb25cIik7XG5jb25zdCB1cGRhdGVfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL3VwZGF0ZVwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi4vd3JpdGVfY29uY2VyblwiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLkJhdGNoVHlwZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIElOU0VSVDogMSxcbiAgICBVUERBVEU6IDIsXG4gICAgREVMRVRFOiAzXG59KTtcbi8qKlxuICogS2VlcHMgdGhlIHN0YXRlIG9mIGEgdW5vcmRlcmVkIGJhdGNoIHNvIHdlIGNhbiByZXdyaXRlIHRoZSByZXN1bHRzXG4gKiBjb3JyZWN0bHkgYWZ0ZXIgY29tbWFuZCBleGVjdXRpb25cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEJhdGNoIHtcbiAgICBjb25zdHJ1Y3RvcihiYXRjaFR5cGUsIG9yaWdpbmFsWmVyb0luZGV4KSB7XG4gICAgICAgIHRoaXMub3JpZ2luYWxaZXJvSW5kZXggPSBvcmlnaW5hbFplcm9JbmRleDtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSAwO1xuICAgICAgICB0aGlzLm9yaWdpbmFsSW5kZXhlcyA9IFtdO1xuICAgICAgICB0aGlzLmJhdGNoVHlwZSA9IGJhdGNoVHlwZTtcbiAgICAgICAgdGhpcy5vcGVyYXRpb25zID0gW107XG4gICAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgICAgIHRoaXMuc2l6ZUJ5dGVzID0gMDtcbiAgICB9XG59XG5leHBvcnRzLkJhdGNoID0gQmF0Y2g7XG4vKipcbiAqIEBwdWJsaWNcbiAqIFRoZSByZXN1bHQgb2YgYSBidWxrIHdyaXRlLlxuICovXG5jbGFzcyBCdWxrV3JpdGVSZXN1bHQge1xuICAgIHN0YXRpYyBnZW5lcmF0ZUlkTWFwKGlkcykge1xuICAgICAgICBjb25zdCBpZE1hcCA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IGRvYyBvZiBpZHMpIHtcbiAgICAgICAgICAgIGlkTWFwW2RvYy5pbmRleF0gPSBkb2MuX2lkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpZE1hcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEJ1bGtXcml0ZVJlc3VsdCBpbnN0YW5jZVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGJ1bGtSZXN1bHQsIGlzT3JkZXJlZCkge1xuICAgICAgICB0aGlzLnJlc3VsdCA9IGJ1bGtSZXN1bHQ7XG4gICAgICAgIHRoaXMuaW5zZXJ0ZWRDb3VudCA9IHRoaXMucmVzdWx0Lm5JbnNlcnRlZCA/PyAwO1xuICAgICAgICB0aGlzLm1hdGNoZWRDb3VudCA9IHRoaXMucmVzdWx0Lm5NYXRjaGVkID8/IDA7XG4gICAgICAgIHRoaXMubW9kaWZpZWRDb3VudCA9IHRoaXMucmVzdWx0Lm5Nb2RpZmllZCA/PyAwO1xuICAgICAgICB0aGlzLmRlbGV0ZWRDb3VudCA9IHRoaXMucmVzdWx0Lm5SZW1vdmVkID8/IDA7XG4gICAgICAgIHRoaXMudXBzZXJ0ZWRDb3VudCA9IHRoaXMucmVzdWx0LnVwc2VydGVkLmxlbmd0aCA/PyAwO1xuICAgICAgICB0aGlzLnVwc2VydGVkSWRzID0gQnVsa1dyaXRlUmVzdWx0LmdlbmVyYXRlSWRNYXAodGhpcy5yZXN1bHQudXBzZXJ0ZWQpO1xuICAgICAgICB0aGlzLmluc2VydGVkSWRzID0gQnVsa1dyaXRlUmVzdWx0LmdlbmVyYXRlSWRNYXAodGhpcy5nZXRTdWNjZXNzZnVsbHlJbnNlcnRlZElkcyhidWxrUmVzdWx0LCBpc09yZGVyZWQpKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdyZXN1bHQnLCB7IHZhbHVlOiB0aGlzLnJlc3VsdCwgZW51bWVyYWJsZTogZmFsc2UgfSk7XG4gICAgfVxuICAgIC8qKiBFdmFsdWF0ZXMgdG8gdHJ1ZSBpZiB0aGUgYnVsayBvcGVyYXRpb24gY29ycmVjdGx5IGV4ZWN1dGVzICovXG4gICAgZ2V0IG9rKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQub2s7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgZG9jdW1lbnRfaWRzIHRoYXQgd2VyZSBhY3R1YWxseSBpbnNlcnRlZFxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGdldFN1Y2Nlc3NmdWxseUluc2VydGVkSWRzKGJ1bGtSZXN1bHQsIGlzT3JkZXJlZCkge1xuICAgICAgICBpZiAoYnVsa1Jlc3VsdC53cml0ZUVycm9ycy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gYnVsa1Jlc3VsdC5pbnNlcnRlZElkcztcbiAgICAgICAgaWYgKGlzT3JkZXJlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGJ1bGtSZXN1bHQuaW5zZXJ0ZWRJZHMuc2xpY2UoMCwgYnVsa1Jlc3VsdC53cml0ZUVycm9yc1swXS5pbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1bGtSZXN1bHQuaW5zZXJ0ZWRJZHMuZmlsdGVyKCh7IGluZGV4IH0pID0+ICFidWxrUmVzdWx0LndyaXRlRXJyb3JzLnNvbWUod3JpdGVFcnJvciA9PiBpbmRleCA9PT0gd3JpdGVFcnJvci5pbmRleCkpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgdXBzZXJ0ZWQgaWQgYXQgdGhlIGdpdmVuIGluZGV4ICovXG4gICAgZ2V0VXBzZXJ0ZWRJZEF0KGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC51cHNlcnRlZFtpbmRleF07XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHJhdyBpbnRlcm5hbCByZXN1bHQgKi9cbiAgICBnZXRSYXdSZXNwb25zZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIHRoZSBidWxrIG9wZXJhdGlvbiBjb250YWlucyBhIHdyaXRlIGVycm9yICovXG4gICAgaGFzV3JpdGVFcnJvcnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC53cml0ZUVycm9ycy5sZW5ndGggPiAwO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHdyaXRlIGVycm9ycyBvZmYgdGhlIGJ1bGsgb3BlcmF0aW9uICovXG4gICAgZ2V0V3JpdGVFcnJvckNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQud3JpdGVFcnJvcnMubGVuZ3RoO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIHNwZWNpZmljIHdyaXRlIGVycm9yIG9iamVjdCAqL1xuICAgIGdldFdyaXRlRXJyb3JBdChpbmRleCkge1xuICAgICAgICByZXR1cm4gaW5kZXggPCB0aGlzLnJlc3VsdC53cml0ZUVycm9ycy5sZW5ndGggPyB0aGlzLnJlc3VsdC53cml0ZUVycm9yc1tpbmRleF0gOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKiBSZXRyaWV2ZSBhbGwgd3JpdGUgZXJyb3JzICovXG4gICAgZ2V0V3JpdGVFcnJvcnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC53cml0ZUVycm9ycztcbiAgICB9XG4gICAgLyoqIFJldHJpZXZlIHRoZSB3cml0ZSBjb25jZXJuIGVycm9yIGlmIG9uZSBleGlzdHMgKi9cbiAgICBnZXRXcml0ZUNvbmNlcm5FcnJvcigpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzdWx0LndyaXRlQ29uY2VybkVycm9ycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnJlc3VsdC53cml0ZUNvbmNlcm5FcnJvcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGVycm9yXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQud3JpdGVDb25jZXJuRXJyb3JzWzBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gQ29tYmluZSB0aGUgZXJyb3JzXG4gICAgICAgICAgICBsZXQgZXJybXNnID0gJyc7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucmVzdWx0LndyaXRlQ29uY2VybkVycm9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVyciA9IHRoaXMucmVzdWx0LndyaXRlQ29uY2VybkVycm9yc1tpXTtcbiAgICAgICAgICAgICAgICBlcnJtc2cgPSBlcnJtc2cgKyBlcnIuZXJybXNnO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IFNvbWV0aGluZyBiZXR0ZXJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgZXJybXNnID0gZXJybXNnICsgJyBhbmQgJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgV3JpdGVDb25jZXJuRXJyb3IoeyBlcnJtc2csIGNvZGU6IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5Xcml0ZUNvbmNlcm5UaW1lb3V0IH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYEJ1bGtXcml0ZVJlc3VsdCgke2Jzb25fMS5FSlNPTi5zdHJpbmdpZnkodGhpcy5yZXN1bHQpfSlgO1xuICAgIH1cbiAgICBpc09rKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQub2sgPT09IDE7XG4gICAgfVxufVxuZXhwb3J0cy5CdWxrV3JpdGVSZXN1bHQgPSBCdWxrV3JpdGVSZXN1bHQ7XG4vKipcbiAqIEFuIGVycm9yIHJlcHJlc2VudGluZyBhIGZhaWx1cmUgYnkgdGhlIHNlcnZlciB0byBhcHBseSB0aGUgcmVxdWVzdGVkIHdyaXRlIGNvbmNlcm4gdG8gdGhlIGJ1bGsgb3BlcmF0aW9uLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIFdyaXRlQ29uY2VybkVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihlcnJvcikge1xuICAgICAgICB0aGlzLnNlcnZlckVycm9yID0gZXJyb3I7XG4gICAgfVxuICAgIC8qKiBXcml0ZSBjb25jZXJuIGVycm9yIGNvZGUuICovXG4gICAgZ2V0IGNvZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZlckVycm9yLmNvZGU7XG4gICAgfVxuICAgIC8qKiBXcml0ZSBjb25jZXJuIGVycm9yIG1lc3NhZ2UuICovXG4gICAgZ2V0IGVycm1zZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VydmVyRXJyb3IuZXJybXNnO1xuICAgIH1cbiAgICAvKiogV3JpdGUgY29uY2VybiBlcnJvciBpbmZvLiAqL1xuICAgIGdldCBlcnJJbmZvKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2ZXJFcnJvci5lcnJJbmZvO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZlckVycm9yO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBXcml0ZUNvbmNlcm5FcnJvcigke3RoaXMuZXJybXNnfSlgO1xuICAgIH1cbn1cbmV4cG9ydHMuV3JpdGVDb25jZXJuRXJyb3IgPSBXcml0ZUNvbmNlcm5FcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdGhhdCBvY2N1cnJlZCBkdXJpbmcgYSBCdWxrV3JpdGUgb24gdGhlIHNlcnZlci5cbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBXcml0ZUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihlcnIpIHtcbiAgICAgICAgdGhpcy5lcnIgPSBlcnI7XG4gICAgfVxuICAgIC8qKiBXcml0ZUVycm9yIGNvZGUuICovXG4gICAgZ2V0IGNvZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVyci5jb2RlO1xuICAgIH1cbiAgICAvKiogV3JpdGVFcnJvciBvcmlnaW5hbCBidWxrIG9wZXJhdGlvbiBpbmRleC4gKi9cbiAgICBnZXQgaW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVyci5pbmRleDtcbiAgICB9XG4gICAgLyoqIFdyaXRlRXJyb3IgbWVzc2FnZS4gKi9cbiAgICBnZXQgZXJybXNnKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnIuZXJybXNnO1xuICAgIH1cbiAgICAvKiogV3JpdGVFcnJvciBkZXRhaWxzLiAqL1xuICAgIGdldCBlcnJJbmZvKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnIuZXJySW5mbztcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIHVuZGVybHlpbmcgb3BlcmF0aW9uIHRoYXQgY2F1c2VkIHRoZSBlcnJvciAqL1xuICAgIGdldE9wZXJhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXJyLm9wO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7IGNvZGU6IHRoaXMuZXJyLmNvZGUsIGluZGV4OiB0aGlzLmVyci5pbmRleCwgZXJybXNnOiB0aGlzLmVyci5lcnJtc2csIG9wOiB0aGlzLmVyci5vcCB9O1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBXcml0ZUVycm9yKCR7SlNPTi5zdHJpbmdpZnkodGhpcy50b0pTT04oKSl9KWA7XG4gICAgfVxufVxuZXhwb3J0cy5Xcml0ZUVycm9yID0gV3JpdGVFcnJvcjtcbi8qKiBNZXJnZXMgcmVzdWx0cyBpbnRvIHNoYXJlZCBkYXRhIHN0cnVjdHVyZSAqL1xuZnVuY3Rpb24gbWVyZ2VCYXRjaFJlc3VsdHMoYmF0Y2gsIGJ1bGtSZXN1bHQsIGVyciwgcmVzdWx0KSB7XG4gICAgLy8gSWYgd2UgaGF2ZSBhbiBlcnJvciBzZXQgdGhlIHJlc3VsdCB0byBiZSB0aGUgZXJyIG9iamVjdFxuICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmVzdWx0ID0gZXJyO1xuICAgIH1cbiAgICBlbHNlIGlmIChyZXN1bHQgJiYgcmVzdWx0LnJlc3VsdCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQucmVzdWx0O1xuICAgIH1cbiAgICBpZiAocmVzdWx0ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBEbyB3ZSBoYXZlIGEgdG9wIGxldmVsIGVycm9yIHN0b3AgcHJvY2Vzc2luZyBhbmQgcmV0dXJuXG4gICAgaWYgKHJlc3VsdC5vayA9PT0gMCAmJiBidWxrUmVzdWx0Lm9rID09PSAxKSB7XG4gICAgICAgIGJ1bGtSZXN1bHQub2sgPSAwO1xuICAgICAgICBjb25zdCB3cml0ZUVycm9yID0ge1xuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgICAgICBjb2RlOiByZXN1bHQuY29kZSB8fCAwLFxuICAgICAgICAgICAgZXJybXNnOiByZXN1bHQubWVzc2FnZSxcbiAgICAgICAgICAgIGVyckluZm86IHJlc3VsdC5lcnJJbmZvLFxuICAgICAgICAgICAgb3A6IGJhdGNoLm9wZXJhdGlvbnNbMF1cbiAgICAgICAgfTtcbiAgICAgICAgYnVsa1Jlc3VsdC53cml0ZUVycm9ycy5wdXNoKG5ldyBXcml0ZUVycm9yKHdyaXRlRXJyb3IpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbHNlIGlmIChyZXN1bHQub2sgPT09IDAgJiYgYnVsa1Jlc3VsdC5vayA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIElmIHdlIGhhdmUgYW4gaW5zZXJ0IEJhdGNoIHR5cGVcbiAgICBpZiAoaXNJbnNlcnRCYXRjaChiYXRjaCkgJiYgcmVzdWx0Lm4pIHtcbiAgICAgICAgYnVsa1Jlc3VsdC5uSW5zZXJ0ZWQgPSBidWxrUmVzdWx0Lm5JbnNlcnRlZCArIHJlc3VsdC5uO1xuICAgIH1cbiAgICAvLyBJZiB3ZSBoYXZlIGFuIGluc2VydCBCYXRjaCB0eXBlXG4gICAgaWYgKGlzRGVsZXRlQmF0Y2goYmF0Y2gpICYmIHJlc3VsdC5uKSB7XG4gICAgICAgIGJ1bGtSZXN1bHQublJlbW92ZWQgPSBidWxrUmVzdWx0Lm5SZW1vdmVkICsgcmVzdWx0Lm47XG4gICAgfVxuICAgIGxldCBuVXBzZXJ0ZWQgPSAwO1xuICAgIC8vIFdlIGhhdmUgYW4gYXJyYXkgb2YgdXBzZXJ0ZWQgdmFsdWVzLCB3ZSBuZWVkIHRvIHJld3JpdGUgdGhlIGluZGV4ZXNcbiAgICBpZiAoQXJyYXkuaXNBcnJheShyZXN1bHQudXBzZXJ0ZWQpKSB7XG4gICAgICAgIG5VcHNlcnRlZCA9IHJlc3VsdC51cHNlcnRlZC5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0LnVwc2VydGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBidWxrUmVzdWx0LnVwc2VydGVkLnB1c2goe1xuICAgICAgICAgICAgICAgIGluZGV4OiByZXN1bHQudXBzZXJ0ZWRbaV0uaW5kZXggKyBiYXRjaC5vcmlnaW5hbFplcm9JbmRleCxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC51cHNlcnRlZFtpXS5faWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlc3VsdC51cHNlcnRlZCkge1xuICAgICAgICBuVXBzZXJ0ZWQgPSAxO1xuICAgICAgICBidWxrUmVzdWx0LnVwc2VydGVkLnB1c2goe1xuICAgICAgICAgICAgaW5kZXg6IGJhdGNoLm9yaWdpbmFsWmVyb0luZGV4LFxuICAgICAgICAgICAgX2lkOiByZXN1bHQudXBzZXJ0ZWRcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIElmIHdlIGhhdmUgYW4gdXBkYXRlIEJhdGNoIHR5cGVcbiAgICBpZiAoaXNVcGRhdGVCYXRjaChiYXRjaCkgJiYgcmVzdWx0Lm4pIHtcbiAgICAgICAgY29uc3Qgbk1vZGlmaWVkID0gcmVzdWx0Lm5Nb2RpZmllZDtcbiAgICAgICAgYnVsa1Jlc3VsdC5uVXBzZXJ0ZWQgPSBidWxrUmVzdWx0Lm5VcHNlcnRlZCArIG5VcHNlcnRlZDtcbiAgICAgICAgYnVsa1Jlc3VsdC5uTWF0Y2hlZCA9IGJ1bGtSZXN1bHQubk1hdGNoZWQgKyAocmVzdWx0Lm4gLSBuVXBzZXJ0ZWQpO1xuICAgICAgICBpZiAodHlwZW9mIG5Nb2RpZmllZCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGJ1bGtSZXN1bHQubk1vZGlmaWVkID0gYnVsa1Jlc3VsdC5uTW9kaWZpZWQgKyBuTW9kaWZpZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBidWxrUmVzdWx0Lm5Nb2RpZmllZCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkocmVzdWx0LndyaXRlRXJyb3JzKSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdC53cml0ZUVycm9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgd3JpdGVFcnJvciA9IHtcbiAgICAgICAgICAgICAgICBpbmRleDogYmF0Y2gub3JpZ2luYWxJbmRleGVzW3Jlc3VsdC53cml0ZUVycm9yc1tpXS5pbmRleF0sXG4gICAgICAgICAgICAgICAgY29kZTogcmVzdWx0LndyaXRlRXJyb3JzW2ldLmNvZGUsXG4gICAgICAgICAgICAgICAgZXJybXNnOiByZXN1bHQud3JpdGVFcnJvcnNbaV0uZXJybXNnLFxuICAgICAgICAgICAgICAgIGVyckluZm86IHJlc3VsdC53cml0ZUVycm9yc1tpXS5lcnJJbmZvLFxuICAgICAgICAgICAgICAgIG9wOiBiYXRjaC5vcGVyYXRpb25zW3Jlc3VsdC53cml0ZUVycm9yc1tpXS5pbmRleF1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBidWxrUmVzdWx0LndyaXRlRXJyb3JzLnB1c2gobmV3IFdyaXRlRXJyb3Iod3JpdGVFcnJvcikpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChyZXN1bHQud3JpdGVDb25jZXJuRXJyb3IpIHtcbiAgICAgICAgYnVsa1Jlc3VsdC53cml0ZUNvbmNlcm5FcnJvcnMucHVzaChuZXcgV3JpdGVDb25jZXJuRXJyb3IocmVzdWx0LndyaXRlQ29uY2VybkVycm9yKSk7XG4gICAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUNvbW1hbmRzKGJ1bGtPcGVyYXRpb24sIG9wdGlvbnMpIHtcbiAgICBpZiAoYnVsa09wZXJhdGlvbi5zLmJhdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVsa1dyaXRlUmVzdWx0KGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCBidWxrT3BlcmF0aW9uLmlzT3JkZXJlZCk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgYmF0Y2ggb2YgYnVsa09wZXJhdGlvbi5zLmJhdGNoZXMpIHtcbiAgICAgICAgY29uc3QgZmluYWxPcHRpb25zID0gKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKGJ1bGtPcGVyYXRpb24sIHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBvcmRlcmVkOiBidWxrT3BlcmF0aW9uLmlzT3JkZXJlZFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGZpbmFsT3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gIT09IHRydWUpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBmaW5hbE9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIElzIHRoZSBieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gb3B0aW9ucyBzcGVjaWZpY1xuICAgICAgICBpZiAoYnVsa09wZXJhdGlvbi5zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZmluYWxPcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSXMgdGhlIGNoZWNrS2V5cyBvcHRpb24gZGlzYWJsZWRcbiAgICAgICAgaWYgKGJ1bGtPcGVyYXRpb24ucy5jaGVja0tleXMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBmaW5hbE9wdGlvbnMuY2hlY2tLZXlzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbmFsT3B0aW9ucy5yZXRyeVdyaXRlcykge1xuICAgICAgICAgICAgaWYgKGlzVXBkYXRlQmF0Y2goYmF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzID1cbiAgICAgICAgICAgICAgICAgICAgZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzICYmICFiYXRjaC5vcGVyYXRpb25zLnNvbWUob3AgPT4gb3AubXVsdGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRGVsZXRlQmF0Y2goYmF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzID1cbiAgICAgICAgICAgICAgICAgICAgZmluYWxPcHRpb25zLnJldHJ5V3JpdGVzICYmICFiYXRjaC5vcGVyYXRpb25zLnNvbWUob3AgPT4gb3AubGltaXQgPT09IDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGlzSW5zZXJ0QmF0Y2goYmF0Y2gpXG4gICAgICAgICAgICA/IG5ldyBpbnNlcnRfMS5JbnNlcnRPcGVyYXRpb24oYnVsa09wZXJhdGlvbi5zLm5hbWVzcGFjZSwgYmF0Y2gub3BlcmF0aW9ucywgZmluYWxPcHRpb25zKVxuICAgICAgICAgICAgOiBpc1VwZGF0ZUJhdGNoKGJhdGNoKVxuICAgICAgICAgICAgICAgID8gbmV3IHVwZGF0ZV8xLlVwZGF0ZU9wZXJhdGlvbihidWxrT3BlcmF0aW9uLnMubmFtZXNwYWNlLCBiYXRjaC5vcGVyYXRpb25zLCBmaW5hbE9wdGlvbnMpXG4gICAgICAgICAgICAgICAgOiBpc0RlbGV0ZUJhdGNoKGJhdGNoKVxuICAgICAgICAgICAgICAgICAgICA/IG5ldyBkZWxldGVfMS5EZWxldGVPcGVyYXRpb24oYnVsa09wZXJhdGlvbi5zLm5hbWVzcGFjZSwgYmF0Y2gub3BlcmF0aW9ucywgZmluYWxPcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIGlmIChvcGVyYXRpb24gPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBVbmtub3duIGJhdGNoVHlwZTogJHtiYXRjaC5iYXRjaFR5cGV9YCk7XG4gICAgICAgIGxldCB0aHJvd25FcnJvciA9IG51bGw7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXN1bHQgPSBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKShidWxrT3BlcmF0aW9uLnMuY29sbGVjdGlvbi5jbGllbnQsIG9wZXJhdGlvbiwgZmluYWxPcHRpb25zLnRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93bkVycm9yID0gZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRocm93bkVycm9yICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0aHJvd25FcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcikge1xuICAgICAgICAgICAgICAgIG1lcmdlQmF0Y2hSZXN1bHRzKGJhdGNoLCBidWxrT3BlcmF0aW9uLnMuYnVsa1Jlc3VsdCwgdGhyb3duRXJyb3IsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVSZXN1bHQgPSBuZXcgQnVsa1dyaXRlUmVzdWx0KGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCBidWxrT3BlcmF0aW9uLmlzT3JkZXJlZCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1vbmdvQnVsa1dyaXRlRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB0aHJvd25FcnJvci5yZXN1bHQud3JpdGVDb25jZXJuRXJyb3IuZXJybXNnLFxuICAgICAgICAgICAgICAgICAgICBjb2RlOiB0aHJvd25FcnJvci5yZXN1bHQud3JpdGVDb25jZXJuRXJyb3IuY29kZVxuICAgICAgICAgICAgICAgIH0sIHdyaXRlUmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEVycm9yIGlzIGEgZHJpdmVyIHJlbGF0ZWQgZXJyb3Igbm90IGEgYnVsayBvcCBlcnJvciwgcmV0dXJuIGVhcmx5XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1vbmdvQnVsa1dyaXRlRXJyb3IodGhyb3duRXJyb3IsIG5ldyBCdWxrV3JpdGVSZXN1bHQoYnVsa09wZXJhdGlvbi5zLmJ1bGtSZXN1bHQsIGJ1bGtPcGVyYXRpb24uaXNPcmRlcmVkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbWVyZ2VCYXRjaFJlc3VsdHMoYmF0Y2gsIGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCB0aHJvd25FcnJvciwgcmVzdWx0KTtcbiAgICAgICAgY29uc3Qgd3JpdGVSZXN1bHQgPSBuZXcgQnVsa1dyaXRlUmVzdWx0KGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCBidWxrT3BlcmF0aW9uLmlzT3JkZXJlZCk7XG4gICAgICAgIGJ1bGtPcGVyYXRpb24uaGFuZGxlV3JpdGVFcnJvcih3cml0ZVJlc3VsdCk7XG4gICAgfVxuICAgIGJ1bGtPcGVyYXRpb24ucy5iYXRjaGVzLmxlbmd0aCA9IDA7XG4gICAgY29uc3Qgd3JpdGVSZXN1bHQgPSBuZXcgQnVsa1dyaXRlUmVzdWx0KGJ1bGtPcGVyYXRpb24ucy5idWxrUmVzdWx0LCBidWxrT3BlcmF0aW9uLmlzT3JkZXJlZCk7XG4gICAgYnVsa09wZXJhdGlvbi5oYW5kbGVXcml0ZUVycm9yKHdyaXRlUmVzdWx0KTtcbiAgICByZXR1cm4gd3JpdGVSZXN1bHQ7XG59XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgYW4gdW5zdWNjZXNzZnVsIEJ1bGsgV3JpdGVcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0J1bGtXcml0ZUVycm9yIGV4dGVuZHMgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IoZXJyb3IsIHJlc3VsdCkge1xuICAgICAgICBzdXBlcihlcnJvcik7XG4gICAgICAgIHRoaXMud3JpdGVFcnJvcnMgPSBbXTtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV3JpdGVDb25jZXJuRXJyb3IpXG4gICAgICAgICAgICB0aGlzLmVyciA9IGVycm9yO1xuICAgICAgICBlbHNlIGlmICghKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpKSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgdGhpcy5jb2RlID0gZXJyb3IuY29kZTtcbiAgICAgICAgICAgIHRoaXMud3JpdGVFcnJvcnMgPSBlcnJvci53cml0ZUVycm9ycyA/PyBbXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBlcnJvcik7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQnVsa1dyaXRlRXJyb3InO1xuICAgIH1cbiAgICAvKiogTnVtYmVyIG9mIGRvY3VtZW50cyBpbnNlcnRlZC4gKi9cbiAgICBnZXQgaW5zZXJ0ZWRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0Lmluc2VydGVkQ291bnQ7XG4gICAgfVxuICAgIC8qKiBOdW1iZXIgb2YgZG9jdW1lbnRzIG1hdGNoZWQgZm9yIHVwZGF0ZS4gKi9cbiAgICBnZXQgbWF0Y2hlZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQubWF0Y2hlZENvdW50O1xuICAgIH1cbiAgICAvKiogTnVtYmVyIG9mIGRvY3VtZW50cyBtb2RpZmllZC4gKi9cbiAgICBnZXQgbW9kaWZpZWRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0Lm1vZGlmaWVkQ291bnQ7XG4gICAgfVxuICAgIC8qKiBOdW1iZXIgb2YgZG9jdW1lbnRzIGRlbGV0ZWQuICovXG4gICAgZ2V0IGRlbGV0ZWRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0LmRlbGV0ZWRDb3VudDtcbiAgICB9XG4gICAgLyoqIE51bWJlciBvZiBkb2N1bWVudHMgdXBzZXJ0ZWQuICovXG4gICAgZ2V0IHVwc2VydGVkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC51cHNlcnRlZENvdW50O1xuICAgIH1cbiAgICAvKiogSW5zZXJ0ZWQgZG9jdW1lbnQgZ2VuZXJhdGVkIElkJ3MsIGhhc2gga2V5IGlzIHRoZSBpbmRleCBvZiB0aGUgb3JpZ2luYXRpbmcgb3BlcmF0aW9uICovXG4gICAgZ2V0IGluc2VydGVkSWRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQuaW5zZXJ0ZWRJZHM7XG4gICAgfVxuICAgIC8qKiBVcHNlcnRlZCBkb2N1bWVudCBnZW5lcmF0ZWQgSWQncywgaGFzaCBrZXkgaXMgdGhlIGluZGV4IG9mIHRoZSBvcmlnaW5hdGluZyBvcGVyYXRpb24gKi9cbiAgICBnZXQgdXBzZXJ0ZWRJZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC51cHNlcnRlZElkcztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQnVsa1dyaXRlRXJyb3IgPSBNb25nb0J1bGtXcml0ZUVycm9yO1xuLyoqXG4gKiBBIGJ1aWxkZXIgb2JqZWN0IHRoYXQgaXMgcmV0dXJuZWQgZnJvbSB7QGxpbmsgQnVsa09wZXJhdGlvbkJhc2UjZmluZH0uXG4gKiBJcyB1c2VkIHRvIGJ1aWxkIGEgd3JpdGUgb3BlcmF0aW9uIHRoYXQgaW52b2x2ZXMgYSBxdWVyeSBmaWx0ZXIuXG4gKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBGaW5kT3BlcmF0b3JzIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IEZpbmRPcGVyYXRvcnMgb2JqZWN0LlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGJ1bGtPcGVyYXRpb24pIHtcbiAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uID0gYnVsa09wZXJhdGlvbjtcbiAgICB9XG4gICAgLyoqIEFkZCBhIG11bHRpcGxlIHVwZGF0ZSBvcGVyYXRpb24gdG8gdGhlIGJ1bGsgb3BlcmF0aW9uICovXG4gICAgdXBkYXRlKHVwZGF0ZURvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRPcCA9IGJ1aWxkQ3VycmVudE9wKHRoaXMuYnVsa09wZXJhdGlvbik7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1bGtPcGVyYXRpb24uYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5VUERBVEUsICgwLCB1cGRhdGVfMS5tYWtlVXBkYXRlU3RhdGVtZW50KShjdXJyZW50T3Auc2VsZWN0b3IsIHVwZGF0ZURvY3VtZW50LCB7XG4gICAgICAgICAgICAuLi5jdXJyZW50T3AsXG4gICAgICAgICAgICBtdWx0aTogdHJ1ZVxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBzaW5nbGUgdXBkYXRlIG9wZXJhdGlvbiB0byB0aGUgYnVsayBvcGVyYXRpb24gKi9cbiAgICB1cGRhdGVPbmUodXBkYXRlRG9jdW1lbnQpIHtcbiAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5oYXNBdG9taWNPcGVyYXRvcnMpKHVwZGF0ZURvY3VtZW50KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignVXBkYXRlIGRvY3VtZW50IHJlcXVpcmVzIGF0b21pYyBvcGVyYXRvcnMnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50T3AgPSBidWlsZEN1cnJlbnRPcCh0aGlzLmJ1bGtPcGVyYXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5idWxrT3BlcmF0aW9uLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuVVBEQVRFLCAoMCwgdXBkYXRlXzEubWFrZVVwZGF0ZVN0YXRlbWVudCkoY3VycmVudE9wLnNlbGVjdG9yLCB1cGRhdGVEb2N1bWVudCwgeyAuLi5jdXJyZW50T3AsIG11bHRpOiBmYWxzZSB9KSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSByZXBsYWNlIG9uZSBvcGVyYXRpb24gdG8gdGhlIGJ1bGsgb3BlcmF0aW9uICovXG4gICAgcmVwbGFjZU9uZShyZXBsYWNlbWVudCkge1xuICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKShyZXBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JlcGxhY2VtZW50IGRvY3VtZW50IG11c3Qgbm90IHVzZSBhdG9taWMgb3BlcmF0b3JzJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY3VycmVudE9wID0gYnVpbGRDdXJyZW50T3AodGhpcy5idWxrT3BlcmF0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVsa09wZXJhdGlvbi5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLlVQREFURSwgKDAsIHVwZGF0ZV8xLm1ha2VVcGRhdGVTdGF0ZW1lbnQpKGN1cnJlbnRPcC5zZWxlY3RvciwgcmVwbGFjZW1lbnQsIHsgLi4uY3VycmVudE9wLCBtdWx0aTogZmFsc2UgfSkpO1xuICAgIH1cbiAgICAvKiogQWRkIGEgZGVsZXRlIG9uZSBvcGVyYXRpb24gdG8gdGhlIGJ1bGsgb3BlcmF0aW9uICovXG4gICAgZGVsZXRlT25lKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50T3AgPSBidWlsZEN1cnJlbnRPcCh0aGlzLmJ1bGtPcGVyYXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5idWxrT3BlcmF0aW9uLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuREVMRVRFLCAoMCwgZGVsZXRlXzEubWFrZURlbGV0ZVN0YXRlbWVudCkoY3VycmVudE9wLnNlbGVjdG9yLCB7IC4uLmN1cnJlbnRPcCwgbGltaXQ6IDEgfSkpO1xuICAgIH1cbiAgICAvKiogQWRkIGEgZGVsZXRlIG1hbnkgb3BlcmF0aW9uIHRvIHRoZSBidWxrIG9wZXJhdGlvbiAqL1xuICAgIGRlbGV0ZSgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudE9wID0gYnVpbGRDdXJyZW50T3AodGhpcy5idWxrT3BlcmF0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVsa09wZXJhdGlvbi5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLkRFTEVURSwgKDAsIGRlbGV0ZV8xLm1ha2VEZWxldGVTdGF0ZW1lbnQpKGN1cnJlbnRPcC5zZWxlY3RvciwgeyAuLi5jdXJyZW50T3AsIGxpbWl0OiAwIH0pKTtcbiAgICB9XG4gICAgLyoqIFVwc2VydCBtb2RpZmllciBmb3IgdXBkYXRlIGJ1bGsgb3BlcmF0aW9uLCBub3RpbmcgdGhhdCB0aGlzIG9wZXJhdGlvbiBpcyBhbiB1cHNlcnQuICovXG4gICAgdXBzZXJ0KCkge1xuICAgICAgICBpZiAoIXRoaXMuYnVsa09wZXJhdGlvbi5zLmN1cnJlbnRPcCkge1xuICAgICAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wLnVwc2VydCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogU3BlY2lmaWVzIHRoZSBjb2xsYXRpb24gZm9yIHRoZSBxdWVyeSBjb25kaXRpb24uICovXG4gICAgY29sbGF0aW9uKGNvbGxhdGlvbikge1xuICAgICAgICBpZiAoIXRoaXMuYnVsa09wZXJhdGlvbi5zLmN1cnJlbnRPcCkge1xuICAgICAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wLmNvbGxhdGlvbiA9IGNvbGxhdGlvbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBTcGVjaWZpZXMgYXJyYXlGaWx0ZXJzIGZvciBVcGRhdGVPbmUgb3IgVXBkYXRlTWFueSBidWxrIG9wZXJhdGlvbnMuICovXG4gICAgYXJyYXlGaWx0ZXJzKGFycmF5RmlsdGVycykge1xuICAgICAgICBpZiAoIXRoaXMuYnVsa09wZXJhdGlvbi5zLmN1cnJlbnRPcCkge1xuICAgICAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wLmFycmF5RmlsdGVycyA9IGFycmF5RmlsdGVycztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBTcGVjaWZpZXMgaGludCBmb3IgdGhlIGJ1bGsgb3BlcmF0aW9uLiAqL1xuICAgIGhpbnQoaGludCkge1xuICAgICAgICBpZiAoIXRoaXMuYnVsa09wZXJhdGlvbi5zLmN1cnJlbnRPcCkge1xuICAgICAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idWxrT3BlcmF0aW9uLnMuY3VycmVudE9wLmhpbnQgPSBoaW50O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG5leHBvcnRzLkZpbmRPcGVyYXRvcnMgPSBGaW5kT3BlcmF0b3JzO1xuLyoqXG4gKiBUT0RPKE5PREUtNDA2MylcbiAqIEJ1bGtXcml0ZXMgbWVyZ2UgY29tcGxleGl0eSBpcyBpbXBsZW1lbnRlZCBpbiBleGVjdXRlQ29tbWFuZHNcbiAqIFRoaXMgcHJvdmlkZXMgYSB2ZWhpY2xlIHRvIHRyZWF0IGJ1bGtPcGVyYXRpb25zIGxpa2UgYW55IG90aGVyIG9wZXJhdGlvbiAoaGVuY2UgXCJzaGltXCIpXG4gKiBXZSB3b3VsZCBsaWtlIHRoaXMgbG9naWMgdG8gc2ltcGx5IGxpdmUgaW5zaWRlIHRoZSBCdWxrV3JpdGVPcGVyYXRpb24gY2xhc3NcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBCdWxrV3JpdGVTaGltT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGJ1bGtPcGVyYXRpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMuYnVsa09wZXJhdGlvbiA9IGJ1bGtPcGVyYXRpb247XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdidWxrV3JpdGUnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKF9zZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2Vzc2lvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBBbiBpbXBsaWNpdCBzZXNzaW9uIGNvdWxkIGhhdmUgYmVlbiBjcmVhdGVkIGJ5ICdleGVjdXRlT3BlcmF0aW9uJ1xuICAgICAgICAgICAgLy8gU28gaWYgd2Ugc3RpY2sgaXQgb24gZmluYWxPcHRpb25zIGhlcmUsIGVhY2ggYnVsayBvcGVyYXRpb25cbiAgICAgICAgICAgIC8vIHdpbGwgdXNlIHRoaXMgc2FtZSBzZXNzaW9uLCBpdCdsbCBiZSBwYXNzZWQgaW4gdGhlIHNhbWUgd2F5XG4gICAgICAgICAgICAvLyBhbiBleHBsaWNpdCBzZXNzaW9uIHdvdWxkIGJlXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGVDb21tYW5kcyh0aGlzLmJ1bGtPcGVyYXRpb24sIHsgLi4udGhpcy5vcHRpb25zLCB0aW1lb3V0Q29udGV4dCB9KTtcbiAgICB9XG59XG5leHBvcnRzLkJ1bGtXcml0ZVNoaW1PcGVyYXRpb24gPSBCdWxrV3JpdGVTaGltT3BlcmF0aW9uO1xuLyoqIEBwdWJsaWMgKi9cbmNsYXNzIEJ1bGtPcGVyYXRpb25CYXNlIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgT3JkZXJlZEJ1bGtPcGVyYXRpb24gb3IgVW5vcmRlcmVkQnVsa09wZXJhdGlvbiBpbnN0YW5jZVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG9wdGlvbnMsIGlzT3JkZXJlZCkge1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciBidWxrT3BlcmF0aW9uIGlzIG9yZGVyZWQgb3IgdW5vcmRlcmVkXG4gICAgICAgIHRoaXMuaXNPcmRlcmVkID0gaXNPcmRlcmVkO1xuICAgICAgICBjb25zdCB0b3BvbG9neSA9ICgwLCB1dGlsc18xLmdldFRvcG9sb2d5KShjb2xsZWN0aW9uKTtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPT0gbnVsbCA/IHt9IDogb3B0aW9ucztcbiAgICAgICAgLy8gVE9ETyBCcmluZyBmcm9tIGRyaXZlciBpbmZvcm1hdGlvbiBpbiBoZWxsb1xuICAgICAgICAvLyBHZXQgdGhlIG5hbWVzcGFjZSBmb3IgdGhlIHdyaXRlIG9wZXJhdGlvbnNcbiAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gY29sbGVjdGlvbi5zLm5hbWVzcGFjZTtcbiAgICAgICAgLy8gVXNlZCB0byBtYXJrIG9wZXJhdGlvbiBhcyBleGVjdXRlZFxuICAgICAgICBjb25zdCBleGVjdXRlZCA9IGZhbHNlO1xuICAgICAgICAvLyBDdXJyZW50IGl0ZW1cbiAgICAgICAgY29uc3QgY3VycmVudE9wID0gdW5kZWZpbmVkO1xuICAgICAgICAvLyBTZXQgbWF4IGJ5dGUgc2l6ZVxuICAgICAgICBjb25zdCBoZWxsbyA9IHRvcG9sb2d5Lmxhc3RIZWxsbygpO1xuICAgICAgICAvLyBJZiB3ZSBoYXZlIGF1dG9FbmNyeXB0aW9uIG9uLCBiYXRjaC1zcGxpdHRpbmcgbXVzdCBiZSBkb25lIG9uIDJtYiBjaHVua3MsIGJ1dCBzaW5nbGUgZG9jdW1lbnRzXG4gICAgICAgIC8vIG92ZXIgMm1iIGFyZSBzdGlsbCBhbGxvd2VkXG4gICAgICAgIGNvbnN0IHVzaW5nQXV0b0VuY3J5cHRpb24gPSAhISh0b3BvbG9neS5zLm9wdGlvbnMgJiYgdG9wb2xvZ3kucy5vcHRpb25zLmF1dG9FbmNyeXB0ZXIpO1xuICAgICAgICBjb25zdCBtYXhCc29uT2JqZWN0U2l6ZSA9IGhlbGxvICYmIGhlbGxvLm1heEJzb25PYmplY3RTaXplID8gaGVsbG8ubWF4QnNvbk9iamVjdFNpemUgOiAxMDI0ICogMTAyNCAqIDE2O1xuICAgICAgICBjb25zdCBtYXhCYXRjaFNpemVCeXRlcyA9IHVzaW5nQXV0b0VuY3J5cHRpb24gPyAxMDI0ICogMTAyNCAqIDIgOiBtYXhCc29uT2JqZWN0U2l6ZTtcbiAgICAgICAgY29uc3QgbWF4V3JpdGVCYXRjaFNpemUgPSBoZWxsbyAmJiBoZWxsby5tYXhXcml0ZUJhdGNoU2l6ZSA/IGhlbGxvLm1heFdyaXRlQmF0Y2hTaXplIDogMTAwMDtcbiAgICAgICAgLy8gQ2FsY3VsYXRlcyB0aGUgbGFyZ2VzdCBwb3NzaWJsZSBzaXplIG9mIGFuIEFycmF5IGtleSwgcmVwcmVzZW50ZWQgYXMgYSBCU09OIHN0cmluZ1xuICAgICAgICAvLyBlbGVtZW50LiBUaGlzIGNhbGN1bGF0aW9uOlxuICAgICAgICAvLyAgICAgMSBieXRlIGZvciBCU09OIHR5cGVcbiAgICAgICAgLy8gICAgICMgb2YgYnl0ZXMgPSBsZW5ndGggb2YgKHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiAobWF4V3JpdGVCYXRjaFNpemUgLSAxKSlcbiAgICAgICAgLy8gICArIDEgYnl0ZXMgZm9yIG51bGwgdGVybWluYXRvclxuICAgICAgICBjb25zdCBtYXhLZXlTaXplID0gKG1heFdyaXRlQmF0Y2hTaXplIC0gMSkudG9TdHJpbmcoMTApLmxlbmd0aCArIDI7XG4gICAgICAgIC8vIEZpbmFsIG9wdGlvbnMgZm9yIHJldHJ5YWJsZSB3cml0ZXNcbiAgICAgICAgbGV0IGZpbmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuICAgICAgICBmaW5hbE9wdGlvbnMgPSAoMCwgdXRpbHNfMS5hcHBseVJldHJ5YWJsZVdyaXRlcykoZmluYWxPcHRpb25zLCBjb2xsZWN0aW9uLnMuZGIpO1xuICAgICAgICAvLyBGaW5hbCByZXN1bHRzXG4gICAgICAgIGNvbnN0IGJ1bGtSZXN1bHQgPSB7XG4gICAgICAgICAgICBvazogMSxcbiAgICAgICAgICAgIHdyaXRlRXJyb3JzOiBbXSxcbiAgICAgICAgICAgIHdyaXRlQ29uY2VybkVycm9yczogW10sXG4gICAgICAgICAgICBpbnNlcnRlZElkczogW10sXG4gICAgICAgICAgICBuSW5zZXJ0ZWQ6IDAsXG4gICAgICAgICAgICBuVXBzZXJ0ZWQ6IDAsXG4gICAgICAgICAgICBuTWF0Y2hlZDogMCxcbiAgICAgICAgICAgIG5Nb2RpZmllZDogMCxcbiAgICAgICAgICAgIG5SZW1vdmVkOiAwLFxuICAgICAgICAgICAgdXBzZXJ0ZWQ6IFtdXG4gICAgICAgIH07XG4gICAgICAgIC8vIEludGVybmFsIHN0YXRlXG4gICAgICAgIHRoaXMucyA9IHtcbiAgICAgICAgICAgIC8vIEZpbmFsIHJlc3VsdFxuICAgICAgICAgICAgYnVsa1Jlc3VsdCxcbiAgICAgICAgICAgIC8vIEN1cnJlbnQgYmF0Y2ggc3RhdGVcbiAgICAgICAgICAgIGN1cnJlbnRCYXRjaDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgY3VycmVudEluZGV4OiAwLFxuICAgICAgICAgICAgLy8gb3JkZXJlZCBzcGVjaWZpY1xuICAgICAgICAgICAgY3VycmVudEJhdGNoU2l6ZTogMCxcbiAgICAgICAgICAgIGN1cnJlbnRCYXRjaFNpemVCeXRlczogMCxcbiAgICAgICAgICAgIC8vIHVub3JkZXJlZCBzcGVjaWZpY1xuICAgICAgICAgICAgY3VycmVudEluc2VydEJhdGNoOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBjdXJyZW50VXBkYXRlQmF0Y2g6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGN1cnJlbnRSZW1vdmVCYXRjaDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYmF0Y2hlczogW10sXG4gICAgICAgICAgICAvLyBXcml0ZSBjb25jZXJuXG4gICAgICAgICAgICB3cml0ZUNvbmNlcm46IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucyksXG4gICAgICAgICAgICAvLyBNYXggYmF0Y2ggc2l6ZSBvcHRpb25zXG4gICAgICAgICAgICBtYXhCc29uT2JqZWN0U2l6ZSxcbiAgICAgICAgICAgIG1heEJhdGNoU2l6ZUJ5dGVzLFxuICAgICAgICAgICAgbWF4V3JpdGVCYXRjaFNpemUsXG4gICAgICAgICAgICBtYXhLZXlTaXplLFxuICAgICAgICAgICAgLy8gTmFtZXNwYWNlXG4gICAgICAgICAgICBuYW1lc3BhY2UsXG4gICAgICAgICAgICAvLyBUb3BvbG9neVxuICAgICAgICAgICAgdG9wb2xvZ3ksXG4gICAgICAgICAgICAvLyBPcHRpb25zXG4gICAgICAgICAgICBvcHRpb25zOiBmaW5hbE9wdGlvbnMsXG4gICAgICAgICAgICAvLyBCU09OIG9wdGlvbnNcbiAgICAgICAgICAgIGJzb25PcHRpb25zOiAoMCwgYnNvbl8xLnJlc29sdmVCU09OT3B0aW9ucykob3B0aW9ucyksXG4gICAgICAgICAgICAvLyBDdXJyZW50IG9wZXJhdGlvblxuICAgICAgICAgICAgY3VycmVudE9wLFxuICAgICAgICAgICAgLy8gRXhlY3V0ZWRcbiAgICAgICAgICAgIGV4ZWN1dGVkLFxuICAgICAgICAgICAgLy8gQ29sbGVjdGlvblxuICAgICAgICAgICAgY29sbGVjdGlvbixcbiAgICAgICAgICAgIC8vIEZ1bmRhbWVudGFsIGVycm9yXG4gICAgICAgICAgICBlcnI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIC8vIGNoZWNrIGtleXNcbiAgICAgICAgICAgIGNoZWNrS2V5czogdHlwZW9mIG9wdGlvbnMuY2hlY2tLZXlzID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNoZWNrS2V5cyA6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIC8vIGJ5cGFzcyBWYWxpZGF0aW9uXG4gICAgICAgIGlmIChvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGEgc2luZ2xlIGluc2VydCBkb2N1bWVudCB0byB0aGUgYnVsayBvcGVyYXRpb25cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiBjb25zdCBidWxrT3AgPSBjb2xsZWN0aW9uLmluaXRpYWxpemVPcmRlcmVkQnVsa09wKCk7XG4gICAgICpcbiAgICAgKiAvLyBBZGRzIHRocmVlIGluc2VydHMgdG8gdGhlIGJ1bGtPcC5cbiAgICAgKiBidWxrT3BcbiAgICAgKiAgIC5pbnNlcnQoeyBhOiAxIH0pXG4gICAgICogICAuaW5zZXJ0KHsgYjogMiB9KVxuICAgICAqICAgLmluc2VydCh7IGM6IDMgfSk7XG4gICAgICogYXdhaXQgYnVsa09wLmV4ZWN1dGUoKTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBpbnNlcnQoZG9jdW1lbnQpIHtcbiAgICAgICAgKDAsIHV0aWxzXzEubWF5YmVBZGRJZFRvRG9jdW1lbnRzKSh0aGlzLmNvbGxlY3Rpb24sIGRvY3VtZW50LCB7XG4gICAgICAgICAgICBmb3JjZVNlcnZlck9iamVjdElkOiB0aGlzLnNob3VsZEZvcmNlU2VydmVyT2JqZWN0SWQoKVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkVG9PcGVyYXRpb25zTGlzdChleHBvcnRzLkJhdGNoVHlwZS5JTlNFUlQsIGRvY3VtZW50KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVpbGRzIGEgZmluZCBvcGVyYXRpb24gZm9yIGFuIHVwZGF0ZS91cGRhdGVPbmUvZGVsZXRlL2RlbGV0ZU9uZS9yZXBsYWNlT25lLlxuICAgICAqIFJldHVybnMgYSBidWlsZGVyIG9iamVjdCB1c2VkIHRvIGNvbXBsZXRlIHRoZSBkZWZpbml0aW9uIG9mIHRoZSBvcGVyYXRpb24uXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogY29uc3QgYnVsa09wID0gY29sbGVjdGlvbi5pbml0aWFsaXplT3JkZXJlZEJ1bGtPcCgpO1xuICAgICAqXG4gICAgICogLy8gQWRkIGFuIHVwZGF0ZU9uZSB0byB0aGUgYnVsa09wXG4gICAgICogYnVsa09wLmZpbmQoeyBhOiAxIH0pLnVwZGF0ZU9uZSh7ICRzZXQ6IHsgYjogMiB9IH0pO1xuICAgICAqXG4gICAgICogLy8gQWRkIGFuIHVwZGF0ZU1hbnkgdG8gdGhlIGJ1bGtPcFxuICAgICAqIGJ1bGtPcC5maW5kKHsgYzogMyB9KS51cGRhdGUoeyAkc2V0OiB7IGQ6IDQgfSB9KTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhbiB1cHNlcnRcbiAgICAgKiBidWxrT3AuZmluZCh7IGU6IDUgfSkudXBzZXJ0KCkudXBkYXRlT25lKHsgJHNldDogeyBmOiA2IH0gfSk7XG4gICAgICpcbiAgICAgKiAvLyBBZGQgYSBkZWxldGlvblxuICAgICAqIGJ1bGtPcC5maW5kKHsgZzogNyB9KS5kZWxldGVPbmUoKTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhIG11bHRpIGRlbGV0aW9uXG4gICAgICogYnVsa09wLmZpbmQoeyBoOiA4IH0pLmRlbGV0ZSgpO1xuICAgICAqXG4gICAgICogLy8gQWRkIGEgcmVwbGFjZU9uZVxuICAgICAqIGJ1bGtPcC5maW5kKHsgaTogOSB9KS5yZXBsYWNlT25lKHt3cml0ZUNvbmNlcm46IHsgajogMTAgfX0pO1xuICAgICAqXG4gICAgICogLy8gVXBkYXRlIHVzaW5nIGEgcGlwZWxpbmUgKHJlcXVpcmVzIE1vbmdvZGIgNC4yIG9yIGhpZ2hlcilcbiAgICAgKiBidWxrLmZpbmQoeyBrOiAxMSwgeTogeyAkZXhpc3RzOiB0cnVlIH0sIHo6IHsgJGV4aXN0czogdHJ1ZSB9IH0pLnVwZGF0ZU9uZShbXG4gICAgICogICB7ICRzZXQ6IHsgdG90YWw6IHsgJHN1bTogWyAnJHknLCAnJHonIF0gfSB9IH1cbiAgICAgKiBdKTtcbiAgICAgKlxuICAgICAqIC8vIEFsbCBvZiB0aGUgb3BzIHdpbGwgbm93IGJlIGV4ZWN1dGVkXG4gICAgICogYXdhaXQgYnVsa09wLmV4ZWN1dGUoKTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBmaW5kKHNlbGVjdG9yKSB7XG4gICAgICAgIGlmICghc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0J1bGsgZmluZCBvcGVyYXRpb24gbXVzdCBzcGVjaWZ5IGEgc2VsZWN0b3InKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTYXZlIGEgY3VycmVudCBzZWxlY3RvclxuICAgICAgICB0aGlzLnMuY3VycmVudE9wID0ge1xuICAgICAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBuZXcgRmluZE9wZXJhdG9ycyh0aGlzKTtcbiAgICB9XG4gICAgLyoqIFNwZWNpZmllcyBhIHJhdyBvcGVyYXRpb24gdG8gcGVyZm9ybSBpbiB0aGUgYnVsayB3cml0ZS4gKi9cbiAgICByYXcob3ApIHtcbiAgICAgICAgaWYgKG9wID09IG51bGwgfHwgdHlwZW9mIG9wICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3BlcmF0aW9uIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggYW4gb3BlcmF0aW9uIGtleScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgnaW5zZXJ0T25lJyBpbiBvcCkge1xuICAgICAgICAgICAgY29uc3QgZm9yY2VTZXJ2ZXJPYmplY3RJZCA9IHRoaXMuc2hvdWxkRm9yY2VTZXJ2ZXJPYmplY3RJZCgpO1xuICAgICAgICAgICAgY29uc3QgZG9jdW1lbnQgPSBvcC5pbnNlcnRPbmUgJiYgb3AuaW5zZXJ0T25lLmRvY3VtZW50ID09IG51bGxcbiAgICAgICAgICAgICAgICA/IC8vIFRPRE8oTk9ERS02MDAzKTogcmVtb3ZlIHN1cHBvcnQgZm9yIG9taXR0aW5nIHRoZSBgZG9jdW1lbnRzYCBzdWJkb2N1bWVudCBpbiBidWxrIGluc2VydHNcbiAgICAgICAgICAgICAgICAgICAgb3AuaW5zZXJ0T25lXG4gICAgICAgICAgICAgICAgOiBvcC5pbnNlcnRPbmUuZG9jdW1lbnQ7XG4gICAgICAgICAgICAoMCwgdXRpbHNfMS5tYXliZUFkZElkVG9Eb2N1bWVudHMpKHRoaXMuY29sbGVjdGlvbiwgZG9jdW1lbnQsIHsgZm9yY2VTZXJ2ZXJPYmplY3RJZCB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuSU5TRVJULCBkb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCdyZXBsYWNlT25lJyBpbiBvcCB8fCAndXBkYXRlT25lJyBpbiBvcCB8fCAndXBkYXRlTWFueScgaW4gb3ApIHtcbiAgICAgICAgICAgIGlmICgncmVwbGFjZU9uZScgaW4gb3ApIHtcbiAgICAgICAgICAgICAgICBpZiAoJ3EnIGluIG9wLnJlcGxhY2VPbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUmF3IG9wZXJhdGlvbnMgYXJlIG5vdCBhbGxvd2VkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVN0YXRlbWVudCA9ICgwLCB1cGRhdGVfMS5tYWtlVXBkYXRlU3RhdGVtZW50KShvcC5yZXBsYWNlT25lLmZpbHRlciwgb3AucmVwbGFjZU9uZS5yZXBsYWNlbWVudCwgeyAuLi5vcC5yZXBsYWNlT25lLCBtdWx0aTogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykodXBkYXRlU3RhdGVtZW50LnUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JlcGxhY2VtZW50IGRvY3VtZW50IG11c3Qgbm90IHVzZSBhdG9taWMgb3BlcmF0b3JzJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuVVBEQVRFLCB1cGRhdGVTdGF0ZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCd1cGRhdGVPbmUnIGluIG9wKSB7XG4gICAgICAgICAgICAgICAgaWYgKCdxJyBpbiBvcC51cGRhdGVPbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUmF3IG9wZXJhdGlvbnMgYXJlIG5vdCBhbGxvd2VkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVN0YXRlbWVudCA9ICgwLCB1cGRhdGVfMS5tYWtlVXBkYXRlU3RhdGVtZW50KShvcC51cGRhdGVPbmUuZmlsdGVyLCBvcC51cGRhdGVPbmUudXBkYXRlLCB7XG4gICAgICAgICAgICAgICAgICAgIC4uLm9wLnVwZGF0ZU9uZSxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGk6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5oYXNBdG9taWNPcGVyYXRvcnMpKHVwZGF0ZVN0YXRlbWVudC51KSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVcGRhdGUgZG9jdW1lbnQgcmVxdWlyZXMgYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRUb09wZXJhdGlvbnNMaXN0KGV4cG9ydHMuQmF0Y2hUeXBlLlVQREFURSwgdXBkYXRlU3RhdGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgndXBkYXRlTWFueScgaW4gb3ApIHtcbiAgICAgICAgICAgICAgICBpZiAoJ3EnIGluIG9wLnVwZGF0ZU1hbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUmF3IG9wZXJhdGlvbnMgYXJlIG5vdCBhbGxvd2VkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVN0YXRlbWVudCA9ICgwLCB1cGRhdGVfMS5tYWtlVXBkYXRlU3RhdGVtZW50KShvcC51cGRhdGVNYW55LmZpbHRlciwgb3AudXBkYXRlTWFueS51cGRhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3AudXBkYXRlTWFueSxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGk6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoISgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykodXBkYXRlU3RhdGVtZW50LnUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VwZGF0ZSBkb2N1bWVudCByZXF1aXJlcyBhdG9taWMgb3BlcmF0b3JzJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuVVBEQVRFLCB1cGRhdGVTdGF0ZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICgnZGVsZXRlT25lJyBpbiBvcCkge1xuICAgICAgICAgICAgaWYgKCdxJyBpbiBvcC5kZWxldGVPbmUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSYXcgb3BlcmF0aW9ucyBhcmUgbm90IGFsbG93ZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuREVMRVRFLCAoMCwgZGVsZXRlXzEubWFrZURlbGV0ZVN0YXRlbWVudCkob3AuZGVsZXRlT25lLmZpbHRlciwgeyAuLi5vcC5kZWxldGVPbmUsIGxpbWl0OiAxIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJ2RlbGV0ZU1hbnknIGluIG9wKSB7XG4gICAgICAgICAgICBpZiAoJ3EnIGluIG9wLmRlbGV0ZU1hbnkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSYXcgb3BlcmF0aW9ucyBhcmUgbm90IGFsbG93ZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFRvT3BlcmF0aW9uc0xpc3QoZXhwb3J0cy5CYXRjaFR5cGUuREVMRVRFLCAoMCwgZGVsZXRlXzEubWFrZURlbGV0ZVN0YXRlbWVudCkob3AuZGVsZXRlTWFueS5maWx0ZXIsIHsgLi4ub3AuZGVsZXRlTWFueSwgbGltaXQ6IDAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIG90aGVyd2lzZSBhbiB1bmtub3duIG9wZXJhdGlvbiB3YXMgcHJvdmlkZWRcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignYnVsa1dyaXRlIG9ubHkgc3VwcG9ydHMgaW5zZXJ0T25lLCB1cGRhdGVPbmUsIHVwZGF0ZU1hbnksIGRlbGV0ZU9uZSwgZGVsZXRlTWFueScpO1xuICAgIH1cbiAgICBnZXQgbGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmN1cnJlbnRJbmRleDtcbiAgICB9XG4gICAgZ2V0IGJzb25PcHRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmJzb25PcHRpb25zO1xuICAgIH1cbiAgICBnZXQgd3JpdGVDb25jZXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLndyaXRlQ29uY2VybjtcbiAgICB9XG4gICAgZ2V0IGJhdGNoZXMoKSB7XG4gICAgICAgIGNvbnN0IGJhdGNoZXMgPSBbLi4udGhpcy5zLmJhdGNoZXNdO1xuICAgICAgICBpZiAodGhpcy5pc09yZGVyZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudEJhdGNoKVxuICAgICAgICAgICAgICAgIGJhdGNoZXMucHVzaCh0aGlzLnMuY3VycmVudEJhdGNoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudEluc2VydEJhdGNoKVxuICAgICAgICAgICAgICAgIGJhdGNoZXMucHVzaCh0aGlzLnMuY3VycmVudEluc2VydEJhdGNoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudFVwZGF0ZUJhdGNoKVxuICAgICAgICAgICAgICAgIGJhdGNoZXMucHVzaCh0aGlzLnMuY3VycmVudFVwZGF0ZUJhdGNoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudFJlbW92ZUJhdGNoKVxuICAgICAgICAgICAgICAgIGJhdGNoZXMucHVzaCh0aGlzLnMuY3VycmVudFJlbW92ZUJhdGNoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmF0Y2hlcztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShvcHRpb25zID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMucy5leGVjdXRlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3cml0ZUNvbmNlcm4gPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICBpZiAod3JpdGVDb25jZXJuKSB7XG4gICAgICAgICAgICB0aGlzLnMud3JpdGVDb25jZXJuID0gd3JpdGVDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGhhdmUgY3VycmVudCBiYXRjaFxuICAgICAgICBpZiAodGhpcy5pc09yZGVyZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudEJhdGNoKVxuICAgICAgICAgICAgICAgIHRoaXMucy5iYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRCYXRjaCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaClcbiAgICAgICAgICAgICAgICB0aGlzLnMuYmF0Y2hlcy5wdXNoKHRoaXMucy5jdXJyZW50SW5zZXJ0QmF0Y2gpO1xuICAgICAgICAgICAgaWYgKHRoaXMucy5jdXJyZW50VXBkYXRlQmF0Y2gpXG4gICAgICAgICAgICAgICAgdGhpcy5zLmJhdGNoZXMucHVzaCh0aGlzLnMuY3VycmVudFVwZGF0ZUJhdGNoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnMuY3VycmVudFJlbW92ZUJhdGNoKVxuICAgICAgICAgICAgICAgIHRoaXMucy5iYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRSZW1vdmVCYXRjaCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBubyBvcGVyYXRpb25zIGluIHRoZSBidWxrIHJhaXNlIGFuIGVycm9yXG4gICAgICAgIGlmICh0aGlzLnMuYmF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0ludmFsaWQgQnVsa09wZXJhdGlvbiwgQmF0Y2ggY2Fubm90IGJlIGVtcHR5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zLmV4ZWN1dGVkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgZmluYWxPcHRpb25zID0geyAuLi50aGlzLnMub3B0aW9ucywgLi4ub3B0aW9ucyB9O1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgQnVsa1dyaXRlU2hpbU9wZXJhdGlvbih0aGlzLCBmaW5hbE9wdGlvbnMpO1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5zLmNvbGxlY3Rpb24uY2xpZW50LCBvcGVyYXRpb24sIGZpbmFsT3B0aW9ucy50aW1lb3V0Q29udGV4dCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgdGhlIHdyaXRlIGVycm9yIGJlZm9yZSBleGVjdXRpbmcgY29tbWFuZHNcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBoYW5kbGVXcml0ZUVycm9yKHdyaXRlUmVzdWx0KSB7XG4gICAgICAgIGlmICh0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSB0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9yc1swXS5lcnJtc2dcbiAgICAgICAgICAgICAgICA/IHRoaXMucy5idWxrUmVzdWx0LndyaXRlRXJyb3JzWzBdLmVycm1zZ1xuICAgICAgICAgICAgICAgIDogJ3dyaXRlIG9wZXJhdGlvbiBmYWlsZWQnO1xuICAgICAgICAgICAgdGhyb3cgbmV3IE1vbmdvQnVsa1dyaXRlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1zZyxcbiAgICAgICAgICAgICAgICBjb2RlOiB0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9yc1swXS5jb2RlLFxuICAgICAgICAgICAgICAgIHdyaXRlRXJyb3JzOiB0aGlzLnMuYnVsa1Jlc3VsdC53cml0ZUVycm9yc1xuICAgICAgICAgICAgfSwgd3JpdGVSZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdyaXRlQ29uY2VybkVycm9yID0gd3JpdGVSZXN1bHQuZ2V0V3JpdGVDb25jZXJuRXJyb3IoKTtcbiAgICAgICAgaWYgKHdyaXRlQ29uY2VybkVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTW9uZ29CdWxrV3JpdGVFcnJvcih3cml0ZUNvbmNlcm5FcnJvciwgd3JpdGVSZXN1bHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNob3VsZEZvcmNlU2VydmVyT2JqZWN0SWQoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5zLm9wdGlvbnMuZm9yY2VTZXJ2ZXJPYmplY3RJZCA9PT0gdHJ1ZSB8fFxuICAgICAgICAgICAgdGhpcy5zLmNvbGxlY3Rpb24ucy5kYi5vcHRpb25zPy5mb3JjZVNlcnZlck9iamVjdElkID09PSB0cnVlKTtcbiAgICB9XG59XG5leHBvcnRzLkJ1bGtPcGVyYXRpb25CYXNlID0gQnVsa09wZXJhdGlvbkJhc2U7XG5mdW5jdGlvbiBpc0luc2VydEJhdGNoKGJhdGNoKSB7XG4gICAgcmV0dXJuIGJhdGNoLmJhdGNoVHlwZSA9PT0gZXhwb3J0cy5CYXRjaFR5cGUuSU5TRVJUO1xufVxuZnVuY3Rpb24gaXNVcGRhdGVCYXRjaChiYXRjaCkge1xuICAgIHJldHVybiBiYXRjaC5iYXRjaFR5cGUgPT09IGV4cG9ydHMuQmF0Y2hUeXBlLlVQREFURTtcbn1cbmZ1bmN0aW9uIGlzRGVsZXRlQmF0Y2goYmF0Y2gpIHtcbiAgICByZXR1cm4gYmF0Y2guYmF0Y2hUeXBlID09PSBleHBvcnRzLkJhdGNoVHlwZS5ERUxFVEU7XG59XG5mdW5jdGlvbiBidWlsZEN1cnJlbnRPcChidWxrT3ApIHtcbiAgICBsZXQgeyBjdXJyZW50T3AgfSA9IGJ1bGtPcC5zO1xuICAgIGJ1bGtPcC5zLmN1cnJlbnRPcCA9IHVuZGVmaW5lZDtcbiAgICBpZiAoIWN1cnJlbnRPcClcbiAgICAgICAgY3VycmVudE9wID0ge307XG4gICAgcmV0dXJuIGN1cnJlbnRPcDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1vbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/ordered.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/ordered.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OrderedBulkOperation = void 0;\nconst BSON = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js\");\n/** @public */\nclass OrderedBulkOperation extends common_1.BulkOperationBase {\n    /** @internal */\n    constructor(collection, options) {\n        super(collection, options, true);\n    }\n    addToOperationsList(batchType, document) {\n        // Get the bsonSize\n        const bsonSize = BSON.calculateObjectSize(document, {\n            checkKeys: false,\n            // Since we don't know what the user selected for BSON options here,\n            // err on the safe side, and check the size with ignoreUndefined: false.\n            ignoreUndefined: false\n        });\n        // Throw error if the doc is bigger than the max BSON size\n        if (bsonSize >= this.s.maxBsonObjectSize)\n            // TODO(NODE-3483): Change this to MongoBSONError\n            throw new error_1.MongoInvalidArgumentError(`Document is larger than the maximum size ${this.s.maxBsonObjectSize}`);\n        // Create a new batch object if we don't have a current one\n        if (this.s.currentBatch == null) {\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n        }\n        const maxKeySize = this.s.maxKeySize;\n        // Check if we need to create a new batch\n        if (\n        // New batch if we exceed the max batch op size\n        this.s.currentBatchSize + 1 >= this.s.maxWriteBatchSize ||\n            // New batch if we exceed the maxBatchSizeBytes. Only matters if batch already has a doc,\n            // since we can't sent an empty batch\n            (this.s.currentBatchSize > 0 &&\n                this.s.currentBatchSizeBytes + maxKeySize + bsonSize >= this.s.maxBatchSizeBytes) ||\n            // New batch if the new op does not have the same op type as the current batch\n            this.s.currentBatch.batchType !== batchType) {\n            // Save the batch to the execution stack\n            this.s.batches.push(this.s.currentBatch);\n            // Create a new batch\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n            // Reset the current size trackers\n            this.s.currentBatchSize = 0;\n            this.s.currentBatchSizeBytes = 0;\n        }\n        if (batchType === common_1.BatchType.INSERT) {\n            this.s.bulkResult.insertedIds.push({\n                index: this.s.currentIndex,\n                _id: document._id\n            });\n        }\n        // We have an array of documents\n        if (Array.isArray(document)) {\n            throw new error_1.MongoInvalidArgumentError('Operation passed in cannot be an Array');\n        }\n        this.s.currentBatch.originalIndexes.push(this.s.currentIndex);\n        this.s.currentBatch.operations.push(document);\n        this.s.currentBatchSize += 1;\n        this.s.currentBatchSizeBytes += maxKeySize + bsonSize;\n        this.s.currentIndex += 1;\n        return this;\n    }\n}\nexports.OrderedBulkOperation = OrderedBulkOperation;\n//# sourceMappingURL=ordered.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2J1bGsvb3JkZXJlZC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw0QkFBNEI7QUFDNUIsYUFBYSxtQkFBTyxDQUFDLDJGQUFTO0FBQzlCLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGlCQUFpQixtQkFBTyxDQUFDLG1HQUFVO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLG9HQUFvRyx5QkFBeUI7QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvYnVsay9vcmRlcmVkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PcmRlcmVkQnVsa09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IEJTT04gPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2NvbW1vblwiKTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBPcmRlcmVkQnVsa09wZXJhdGlvbiBleHRlbmRzIGNvbW1vbl8xLkJ1bGtPcGVyYXRpb25CYXNlIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zLCB0cnVlKTtcbiAgICB9XG4gICAgYWRkVG9PcGVyYXRpb25zTGlzdChiYXRjaFR5cGUsIGRvY3VtZW50KSB7XG4gICAgICAgIC8vIEdldCB0aGUgYnNvblNpemVcbiAgICAgICAgY29uc3QgYnNvblNpemUgPSBCU09OLmNhbGN1bGF0ZU9iamVjdFNpemUoZG9jdW1lbnQsIHtcbiAgICAgICAgICAgIGNoZWNrS2V5czogZmFsc2UsXG4gICAgICAgICAgICAvLyBTaW5jZSB3ZSBkb24ndCBrbm93IHdoYXQgdGhlIHVzZXIgc2VsZWN0ZWQgZm9yIEJTT04gb3B0aW9ucyBoZXJlLFxuICAgICAgICAgICAgLy8gZXJyIG9uIHRoZSBzYWZlIHNpZGUsIGFuZCBjaGVjayB0aGUgc2l6ZSB3aXRoIGlnbm9yZVVuZGVmaW5lZDogZmFsc2UuXG4gICAgICAgICAgICBpZ25vcmVVbmRlZmluZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUaHJvdyBlcnJvciBpZiB0aGUgZG9jIGlzIGJpZ2dlciB0aGFuIHRoZSBtYXggQlNPTiBzaXplXG4gICAgICAgIGlmIChic29uU2l6ZSA+PSB0aGlzLnMubWF4QnNvbk9iamVjdFNpemUpXG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IENoYW5nZSB0aGlzIHRvIE1vbmdvQlNPTkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBEb2N1bWVudCBpcyBsYXJnZXIgdGhhbiB0aGUgbWF4aW11bSBzaXplICR7dGhpcy5zLm1heEJzb25PYmplY3RTaXplfWApO1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgYmF0Y2ggb2JqZWN0IGlmIHdlIGRvbid0IGhhdmUgYSBjdXJyZW50IG9uZVxuICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRCYXRjaCA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gbmV3IGNvbW1vbl8xLkJhdGNoKGJhdGNoVHlwZSwgdGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF4S2V5U2l6ZSA9IHRoaXMucy5tYXhLZXlTaXplO1xuICAgICAgICAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIGNyZWF0ZSBhIG5ldyBiYXRjaFxuICAgICAgICBpZiAoXG4gICAgICAgIC8vIE5ldyBiYXRjaCBpZiB3ZSBleGNlZWQgdGhlIG1heCBiYXRjaCBvcCBzaXplXG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2hTaXplICsgMSA+PSB0aGlzLnMubWF4V3JpdGVCYXRjaFNpemUgfHxcbiAgICAgICAgICAgIC8vIE5ldyBiYXRjaCBpZiB3ZSBleGNlZWQgdGhlIG1heEJhdGNoU2l6ZUJ5dGVzLiBPbmx5IG1hdHRlcnMgaWYgYmF0Y2ggYWxyZWFkeSBoYXMgYSBkb2MsXG4gICAgICAgICAgICAvLyBzaW5jZSB3ZSBjYW4ndCBzZW50IGFuIGVtcHR5IGJhdGNoXG4gICAgICAgICAgICAodGhpcy5zLmN1cnJlbnRCYXRjaFNpemUgPiAwICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaFNpemVCeXRlcyArIG1heEtleVNpemUgKyBic29uU2l6ZSA+PSB0aGlzLnMubWF4QmF0Y2hTaXplQnl0ZXMpIHx8XG4gICAgICAgICAgICAvLyBOZXcgYmF0Y2ggaWYgdGhlIG5ldyBvcCBkb2VzIG5vdCBoYXZlIHRoZSBzYW1lIG9wIHR5cGUgYXMgdGhlIGN1cnJlbnQgYmF0Y2hcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2guYmF0Y2hUeXBlICE9PSBiYXRjaFR5cGUpIHtcbiAgICAgICAgICAgIC8vIFNhdmUgdGhlIGJhdGNoIHRvIHRoZSBleGVjdXRpb24gc3RhY2tcbiAgICAgICAgICAgIHRoaXMucy5iYXRjaGVzLnB1c2godGhpcy5zLmN1cnJlbnRCYXRjaCk7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBuZXcgYmF0Y2hcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2ggPSBuZXcgY29tbW9uXzEuQmF0Y2goYmF0Y2hUeXBlLCB0aGlzLnMuY3VycmVudEluZGV4KTtcbiAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBjdXJyZW50IHNpemUgdHJhY2tlcnNcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2hTaXplID0gMDtcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2hTaXplQnl0ZXMgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChiYXRjaFR5cGUgPT09IGNvbW1vbl8xLkJhdGNoVHlwZS5JTlNFUlQpIHtcbiAgICAgICAgICAgIHRoaXMucy5idWxrUmVzdWx0Lmluc2VydGVkSWRzLnB1c2goe1xuICAgICAgICAgICAgICAgIGluZGV4OiB0aGlzLnMuY3VycmVudEluZGV4LFxuICAgICAgICAgICAgICAgIF9pZDogZG9jdW1lbnQuX2lkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBoYXZlIGFuIGFycmF5IG9mIGRvY3VtZW50c1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkb2N1bWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ09wZXJhdGlvbiBwYXNzZWQgaW4gY2Fubm90IGJlIGFuIEFycmF5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5vcmlnaW5hbEluZGV4ZXMucHVzaCh0aGlzLnMuY3VycmVudEluZGV4KTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5vcGVyYXRpb25zLnB1c2goZG9jdW1lbnQpO1xuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoU2l6ZSArPSAxO1xuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoU2l6ZUJ5dGVzICs9IG1heEtleVNpemUgKyBic29uU2l6ZTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRJbmRleCArPSAxO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG5leHBvcnRzLk9yZGVyZWRCdWxrT3BlcmF0aW9uID0gT3JkZXJlZEJ1bGtPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1vcmRlcmVkLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/ordered.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/unordered.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/unordered.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.UnorderedBulkOperation = void 0;\nconst BSON = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js\");\n/** @public */\nclass UnorderedBulkOperation extends common_1.BulkOperationBase {\n    /** @internal */\n    constructor(collection, options) {\n        super(collection, options, false);\n    }\n    handleWriteError(writeResult) {\n        if (this.s.batches.length) {\n            return;\n        }\n        return super.handleWriteError(writeResult);\n    }\n    addToOperationsList(batchType, document) {\n        // Get the bsonSize\n        const bsonSize = BSON.calculateObjectSize(document, {\n            checkKeys: false,\n            // Since we don't know what the user selected for BSON options here,\n            // err on the safe side, and check the size with ignoreUndefined: false.\n            ignoreUndefined: false\n        });\n        // Throw error if the doc is bigger than the max BSON size\n        if (bsonSize >= this.s.maxBsonObjectSize) {\n            // TODO(NODE-3483): Change this to MongoBSONError\n            throw new error_1.MongoInvalidArgumentError(`Document is larger than the maximum size ${this.s.maxBsonObjectSize}`);\n        }\n        // Holds the current batch\n        this.s.currentBatch = undefined;\n        // Get the right type of batch\n        if (batchType === common_1.BatchType.INSERT) {\n            this.s.currentBatch = this.s.currentInsertBatch;\n        }\n        else if (batchType === common_1.BatchType.UPDATE) {\n            this.s.currentBatch = this.s.currentUpdateBatch;\n        }\n        else if (batchType === common_1.BatchType.DELETE) {\n            this.s.currentBatch = this.s.currentRemoveBatch;\n        }\n        const maxKeySize = this.s.maxKeySize;\n        // Create a new batch object if we don't have a current one\n        if (this.s.currentBatch == null) {\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n        }\n        // Check if we need to create a new batch\n        if (\n        // New batch if we exceed the max batch op size\n        this.s.currentBatch.size + 1 >= this.s.maxWriteBatchSize ||\n            // New batch if we exceed the maxBatchSizeBytes. Only matters if batch already has a doc,\n            // since we can't sent an empty batch\n            (this.s.currentBatch.size > 0 &&\n                this.s.currentBatch.sizeBytes + maxKeySize + bsonSize >= this.s.maxBatchSizeBytes) ||\n            // New batch if the new op does not have the same op type as the current batch\n            this.s.currentBatch.batchType !== batchType) {\n            // Save the batch to the execution stack\n            this.s.batches.push(this.s.currentBatch);\n            // Create a new batch\n            this.s.currentBatch = new common_1.Batch(batchType, this.s.currentIndex);\n        }\n        // We have an array of documents\n        if (Array.isArray(document)) {\n            throw new error_1.MongoInvalidArgumentError('Operation passed in cannot be an Array');\n        }\n        this.s.currentBatch.operations.push(document);\n        this.s.currentBatch.originalIndexes.push(this.s.currentIndex);\n        this.s.currentIndex = this.s.currentIndex + 1;\n        // Save back the current Batch to the right type\n        if (batchType === common_1.BatchType.INSERT) {\n            this.s.currentInsertBatch = this.s.currentBatch;\n            this.s.bulkResult.insertedIds.push({\n                index: this.s.bulkResult.insertedIds.length,\n                _id: document._id\n            });\n        }\n        else if (batchType === common_1.BatchType.UPDATE) {\n            this.s.currentUpdateBatch = this.s.currentBatch;\n        }\n        else if (batchType === common_1.BatchType.DELETE) {\n            this.s.currentRemoveBatch = this.s.currentBatch;\n        }\n        // Update current batch size\n        this.s.currentBatch.size += 1;\n        this.s.currentBatch.sizeBytes += maxKeySize + bsonSize;\n        return this;\n    }\n}\nexports.UnorderedBulkOperation = UnorderedBulkOperation;\n//# sourceMappingURL=unordered.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2J1bGsvdW5vcmRlcmVkLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDhCQUE4QjtBQUM5QixhQUFhLG1CQUFPLENBQUMsMkZBQVM7QUFDOUIsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMsbUdBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0Esb0dBQW9HLHlCQUF5QjtBQUM3SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2J1bGsvdW5vcmRlcmVkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Vbm9yZGVyZWRCdWxrT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgQlNPTiA9IHJlcXVpcmUoXCIuLi9ic29uXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4vY29tbW9uXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmNsYXNzIFVub3JkZXJlZEJ1bGtPcGVyYXRpb24gZXh0ZW5kcyBjb21tb25fMS5CdWxrT3BlcmF0aW9uQmFzZSB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucywgZmFsc2UpO1xuICAgIH1cbiAgICBoYW5kbGVXcml0ZUVycm9yKHdyaXRlUmVzdWx0KSB7XG4gICAgICAgIGlmICh0aGlzLnMuYmF0Y2hlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwZXIuaGFuZGxlV3JpdGVFcnJvcih3cml0ZVJlc3VsdCk7XG4gICAgfVxuICAgIGFkZFRvT3BlcmF0aW9uc0xpc3QoYmF0Y2hUeXBlLCBkb2N1bWVudCkge1xuICAgICAgICAvLyBHZXQgdGhlIGJzb25TaXplXG4gICAgICAgIGNvbnN0IGJzb25TaXplID0gQlNPTi5jYWxjdWxhdGVPYmplY3RTaXplKGRvY3VtZW50LCB7XG4gICAgICAgICAgICBjaGVja0tleXM6IGZhbHNlLFxuICAgICAgICAgICAgLy8gU2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IHRoZSB1c2VyIHNlbGVjdGVkIGZvciBCU09OIG9wdGlvbnMgaGVyZSxcbiAgICAgICAgICAgIC8vIGVyciBvbiB0aGUgc2FmZSBzaWRlLCBhbmQgY2hlY2sgdGhlIHNpemUgd2l0aCBpZ25vcmVVbmRlZmluZWQ6IGZhbHNlLlxuICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhyb3cgZXJyb3IgaWYgdGhlIGRvYyBpcyBiaWdnZXIgdGhhbiB0aGUgbWF4IEJTT04gc2l6ZVxuICAgICAgICBpZiAoYnNvblNpemUgPj0gdGhpcy5zLm1heEJzb25PYmplY3RTaXplKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IENoYW5nZSB0aGlzIHRvIE1vbmdvQlNPTkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBEb2N1bWVudCBpcyBsYXJnZXIgdGhhbiB0aGUgbWF4aW11bSBzaXplICR7dGhpcy5zLm1heEJzb25PYmplY3RTaXplfWApO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhvbGRzIHRoZSBjdXJyZW50IGJhdGNoXG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2ggPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIEdldCB0aGUgcmlnaHQgdHlwZSBvZiBiYXRjaFxuICAgICAgICBpZiAoYmF0Y2hUeXBlID09PSBjb21tb25fMS5CYXRjaFR5cGUuSU5TRVJUKSB7XG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gdGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYXRjaFR5cGUgPT09IGNvbW1vbl8xLkJhdGNoVHlwZS5VUERBVEUpIHtcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2ggPSB0aGlzLnMuY3VycmVudFVwZGF0ZUJhdGNoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJhdGNoVHlwZSA9PT0gY29tbW9uXzEuQmF0Y2hUeXBlLkRFTEVURSkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaCA9IHRoaXMucy5jdXJyZW50UmVtb3ZlQmF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF4S2V5U2l6ZSA9IHRoaXMucy5tYXhLZXlTaXplO1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgYmF0Y2ggb2JqZWN0IGlmIHdlIGRvbid0IGhhdmUgYSBjdXJyZW50IG9uZVxuICAgICAgICBpZiAodGhpcy5zLmN1cnJlbnRCYXRjaCA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gbmV3IGNvbW1vbl8xLkJhdGNoKGJhdGNoVHlwZSwgdGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBjcmVhdGUgYSBuZXcgYmF0Y2hcbiAgICAgICAgaWYgKFxuICAgICAgICAvLyBOZXcgYmF0Y2ggaWYgd2UgZXhjZWVkIHRoZSBtYXggYmF0Y2ggb3Agc2l6ZVxuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLnNpemUgKyAxID49IHRoaXMucy5tYXhXcml0ZUJhdGNoU2l6ZSB8fFxuICAgICAgICAgICAgLy8gTmV3IGJhdGNoIGlmIHdlIGV4Y2VlZCB0aGUgbWF4QmF0Y2hTaXplQnl0ZXMuIE9ubHkgbWF0dGVycyBpZiBiYXRjaCBhbHJlYWR5IGhhcyBhIGRvYyxcbiAgICAgICAgICAgIC8vIHNpbmNlIHdlIGNhbid0IHNlbnQgYW4gZW1wdHkgYmF0Y2hcbiAgICAgICAgICAgICh0aGlzLnMuY3VycmVudEJhdGNoLnNpemUgPiAwICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5zaXplQnl0ZXMgKyBtYXhLZXlTaXplICsgYnNvblNpemUgPj0gdGhpcy5zLm1heEJhdGNoU2l6ZUJ5dGVzKSB8fFxuICAgICAgICAgICAgLy8gTmV3IGJhdGNoIGlmIHRoZSBuZXcgb3AgZG9lcyBub3QgaGF2ZSB0aGUgc2FtZSBvcCB0eXBlIGFzIHRoZSBjdXJyZW50IGJhdGNoXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLmJhdGNoVHlwZSAhPT0gYmF0Y2hUeXBlKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBiYXRjaCB0byB0aGUgZXhlY3V0aW9uIHN0YWNrXG4gICAgICAgICAgICB0aGlzLnMuYmF0Y2hlcy5wdXNoKHRoaXMucy5jdXJyZW50QmF0Y2gpO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGJhdGNoXG4gICAgICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoID0gbmV3IGNvbW1vbl8xLkJhdGNoKGJhdGNoVHlwZSwgdGhpcy5zLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgaGF2ZSBhbiBhcnJheSBvZiBkb2N1bWVudHNcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZG9jdW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcGVyYXRpb24gcGFzc2VkIGluIGNhbm5vdCBiZSBhbiBBcnJheScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucy5jdXJyZW50QmF0Y2gub3BlcmF0aW9ucy5wdXNoKGRvY3VtZW50KTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5vcmlnaW5hbEluZGV4ZXMucHVzaCh0aGlzLnMuY3VycmVudEluZGV4KTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRJbmRleCA9IHRoaXMucy5jdXJyZW50SW5kZXggKyAxO1xuICAgICAgICAvLyBTYXZlIGJhY2sgdGhlIGN1cnJlbnQgQmF0Y2ggdG8gdGhlIHJpZ2h0IHR5cGVcbiAgICAgICAgaWYgKGJhdGNoVHlwZSA9PT0gY29tbW9uXzEuQmF0Y2hUeXBlLklOU0VSVCkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRJbnNlcnRCYXRjaCA9IHRoaXMucy5jdXJyZW50QmF0Y2g7XG4gICAgICAgICAgICB0aGlzLnMuYnVsa1Jlc3VsdC5pbnNlcnRlZElkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpbmRleDogdGhpcy5zLmJ1bGtSZXN1bHQuaW5zZXJ0ZWRJZHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIF9pZDogZG9jdW1lbnQuX2lkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYXRjaFR5cGUgPT09IGNvbW1vbl8xLkJhdGNoVHlwZS5VUERBVEUpIHtcbiAgICAgICAgICAgIHRoaXMucy5jdXJyZW50VXBkYXRlQmF0Y2ggPSB0aGlzLnMuY3VycmVudEJhdGNoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJhdGNoVHlwZSA9PT0gY29tbW9uXzEuQmF0Y2hUeXBlLkRFTEVURSkge1xuICAgICAgICAgICAgdGhpcy5zLmN1cnJlbnRSZW1vdmVCYXRjaCA9IHRoaXMucy5jdXJyZW50QmF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIGN1cnJlbnQgYmF0Y2ggc2l6ZVxuICAgICAgICB0aGlzLnMuY3VycmVudEJhdGNoLnNpemUgKz0gMTtcbiAgICAgICAgdGhpcy5zLmN1cnJlbnRCYXRjaC5zaXplQnl0ZXMgKz0gbWF4S2V5U2l6ZSArIGJzb25TaXplO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG5leHBvcnRzLlVub3JkZXJlZEJ1bGtPcGVyYXRpb24gPSBVbm9yZGVyZWRCdWxrT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dW5vcmRlcmVkLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/unordered.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ChangeStream = void 0;\nconst collection_1 = __webpack_require__(/*! ./collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nconst change_stream_cursor_1 = __webpack_require__(/*! ./cursor/change_stream_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/change_stream_cursor.js\");\nconst db_1 = __webpack_require__(/*! ./db */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/db.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst resource_management_1 = __webpack_require__(/*! ./resource_management */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js\");\nconst timeout_1 = __webpack_require__(/*! ./timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst CHANGE_STREAM_OPTIONS = [\n    'resumeAfter',\n    'startAfter',\n    'startAtOperationTime',\n    'fullDocument',\n    'fullDocumentBeforeChange',\n    'showExpandedEvents'\n];\nconst CHANGE_DOMAIN_TYPES = {\n    COLLECTION: Symbol('Collection'),\n    DATABASE: Symbol('Database'),\n    CLUSTER: Symbol('Cluster')\n};\nconst CHANGE_STREAM_EVENTS = [constants_1.RESUME_TOKEN_CHANGED, constants_1.END, constants_1.CLOSE];\nconst NO_RESUME_TOKEN_ERROR = 'A change stream document has been received that lacks a resume token (_id).';\nconst CHANGESTREAM_CLOSED_ERROR = 'ChangeStream is closed';\n/**\n * Creates a new Change Stream instance. Normally created using {@link Collection#watch|Collection.watch()}.\n * @public\n */\nclass ChangeStream extends mongo_types_1.TypedEventEmitter {\n    /** @internal */\n    async asyncDispose() {\n        await this.close();\n    }\n    /**\n     * @internal\n     *\n     * @param parent - The parent object that created this change stream\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents\n     */\n    constructor(parent, pipeline = [], options = {}) {\n        super();\n        this.pipeline = pipeline;\n        this.options = { ...options };\n        let serverSelectionTimeoutMS;\n        delete this.options.writeConcern;\n        if (parent instanceof collection_1.Collection) {\n            this.type = CHANGE_DOMAIN_TYPES.COLLECTION;\n            serverSelectionTimeoutMS = parent.s.db.client.options.serverSelectionTimeoutMS;\n        }\n        else if (parent instanceof db_1.Db) {\n            this.type = CHANGE_DOMAIN_TYPES.DATABASE;\n            serverSelectionTimeoutMS = parent.client.options.serverSelectionTimeoutMS;\n        }\n        else if (parent instanceof mongo_client_1.MongoClient) {\n            this.type = CHANGE_DOMAIN_TYPES.CLUSTER;\n            serverSelectionTimeoutMS = parent.options.serverSelectionTimeoutMS;\n        }\n        else {\n            throw new error_1.MongoChangeStreamError('Parent provided to ChangeStream constructor must be an instance of Collection, Db, or MongoClient');\n        }\n        this.contextOwner = Symbol();\n        this.parent = parent;\n        this.namespace = parent.s.namespace;\n        if (!this.options.readPreference && parent.readPreference) {\n            this.options.readPreference = parent.readPreference;\n        }\n        // Create contained Change Stream cursor\n        this.cursor = this._createChangeStreamCursor(options);\n        this.isClosed = false;\n        this.mode = false;\n        // Listen for any `change` listeners being added to ChangeStream\n        this.on('newListener', eventName => {\n            if (eventName === 'change' && this.cursor && this.listenerCount('change') === 0) {\n                this._streamEvents(this.cursor);\n            }\n        });\n        this.on('removeListener', eventName => {\n            if (eventName === 'change' && this.listenerCount('change') === 0 && this.cursor) {\n                this.cursorStream?.removeAllListeners('data');\n            }\n        });\n        if (this.options.timeoutMS != null) {\n            this.timeoutContext = new timeout_1.CSOTTimeoutContext({\n                timeoutMS: this.options.timeoutMS,\n                serverSelectionTimeoutMS\n            });\n        }\n    }\n    /** The cached resume token that is used to resume after the most recently returned change. */\n    get resumeToken() {\n        return this.cursor?.resumeToken;\n    }\n    /** Check if there is any document still available in the Change Stream */\n    async hasNext() {\n        this._setIsIterator();\n        // Change streams must resume indefinitely while each resume event succeeds.\n        // This loop continues until either a change event is received or until a resume attempt\n        // fails.\n        this.timeoutContext?.refresh();\n        try {\n            while (true) {\n                try {\n                    const hasNext = await this.cursor.hasNext();\n                    return hasNext;\n                }\n                catch (error) {\n                    try {\n                        await this._processErrorIteratorMode(error, this.cursor.id != null);\n                    }\n                    catch (error) {\n                        if (error instanceof error_1.MongoOperationTimeoutError && this.cursor.id == null) {\n                            throw error;\n                        }\n                        try {\n                            await this.close();\n                        }\n                        catch (error) {\n                            (0, utils_1.squashError)(error);\n                        }\n                        throw error;\n                    }\n                }\n            }\n        }\n        finally {\n            this.timeoutContext?.clear();\n        }\n    }\n    /** Get the next available document from the Change Stream. */\n    async next() {\n        this._setIsIterator();\n        // Change streams must resume indefinitely while each resume event succeeds.\n        // This loop continues until either a change event is received or until a resume attempt\n        // fails.\n        this.timeoutContext?.refresh();\n        try {\n            while (true) {\n                try {\n                    const change = await this.cursor.next();\n                    const processedChange = this._processChange(change ?? null);\n                    return processedChange;\n                }\n                catch (error) {\n                    try {\n                        await this._processErrorIteratorMode(error, this.cursor.id != null);\n                    }\n                    catch (error) {\n                        if (error instanceof error_1.MongoOperationTimeoutError && this.cursor.id == null) {\n                            throw error;\n                        }\n                        try {\n                            await this.close();\n                        }\n                        catch (error) {\n                            (0, utils_1.squashError)(error);\n                        }\n                        throw error;\n                    }\n                }\n            }\n        }\n        finally {\n            this.timeoutContext?.clear();\n        }\n    }\n    /**\n     * Try to get the next available document from the Change Stream's cursor or `null` if an empty batch is returned\n     */\n    async tryNext() {\n        this._setIsIterator();\n        // Change streams must resume indefinitely while each resume event succeeds.\n        // This loop continues until either a change event is received or until a resume attempt\n        // fails.\n        this.timeoutContext?.refresh();\n        try {\n            while (true) {\n                try {\n                    const change = await this.cursor.tryNext();\n                    return change ?? null;\n                }\n                catch (error) {\n                    try {\n                        await this._processErrorIteratorMode(error, this.cursor.id != null);\n                    }\n                    catch (error) {\n                        if (error instanceof error_1.MongoOperationTimeoutError && this.cursor.id == null)\n                            throw error;\n                        try {\n                            await this.close();\n                        }\n                        catch (error) {\n                            (0, utils_1.squashError)(error);\n                        }\n                        throw error;\n                    }\n                }\n            }\n        }\n        finally {\n            this.timeoutContext?.clear();\n        }\n    }\n    async *[Symbol.asyncIterator]() {\n        if (this.closed) {\n            return;\n        }\n        try {\n            // Change streams run indefinitely as long as errors are resumable\n            // So the only loop breaking condition is if `next()` throws\n            while (true) {\n                yield await this.next();\n            }\n        }\n        finally {\n            try {\n                await this.close();\n            }\n            catch (error) {\n                (0, utils_1.squashError)(error);\n            }\n        }\n    }\n    /** Is the cursor closed */\n    get closed() {\n        return this.isClosed || this.cursor.closed;\n    }\n    /**\n     * Frees the internal resources used by the change stream.\n     */\n    async close() {\n        this.timeoutContext?.clear();\n        this.timeoutContext = undefined;\n        this.isClosed = true;\n        const cursor = this.cursor;\n        try {\n            await cursor.close();\n        }\n        finally {\n            this._endStream();\n        }\n    }\n    /**\n     * Return a modified Readable stream including a possible transform method.\n     *\n     * NOTE: When using a Stream to process change stream events, the stream will\n     * NOT automatically resume in the case a resumable error is encountered.\n     *\n     * @throws MongoChangeStreamError if the underlying cursor or the change stream is closed\n     */\n    stream(options) {\n        if (this.closed) {\n            throw new error_1.MongoChangeStreamError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        this.streamOptions = options;\n        return this.cursor.stream(options);\n    }\n    /** @internal */\n    _setIsEmitter() {\n        if (this.mode === 'iterator') {\n            // TODO(NODE-3485): Replace with MongoChangeStreamModeError\n            throw new error_1.MongoAPIError('ChangeStream cannot be used as an EventEmitter after being used as an iterator');\n        }\n        this.mode = 'emitter';\n    }\n    /** @internal */\n    _setIsIterator() {\n        if (this.mode === 'emitter') {\n            // TODO(NODE-3485): Replace with MongoChangeStreamModeError\n            throw new error_1.MongoAPIError('ChangeStream cannot be used as an iterator after being used as an EventEmitter');\n        }\n        this.mode = 'iterator';\n    }\n    /**\n     * Create a new change stream cursor based on self's configuration\n     * @internal\n     */\n    _createChangeStreamCursor(options) {\n        const changeStreamStageOptions = (0, utils_1.filterOptions)(options, CHANGE_STREAM_OPTIONS);\n        if (this.type === CHANGE_DOMAIN_TYPES.CLUSTER) {\n            changeStreamStageOptions.allChangesForCluster = true;\n        }\n        const pipeline = [{ $changeStream: changeStreamStageOptions }, ...this.pipeline];\n        const client = this.type === CHANGE_DOMAIN_TYPES.CLUSTER\n            ? this.parent\n            : this.type === CHANGE_DOMAIN_TYPES.DATABASE\n                ? this.parent.client\n                : this.type === CHANGE_DOMAIN_TYPES.COLLECTION\n                    ? this.parent.client\n                    : null;\n        if (client == null) {\n            // This should never happen because of the assertion in the constructor\n            throw new error_1.MongoRuntimeError(`Changestream type should only be one of cluster, database, collection. Found ${this.type.toString()}`);\n        }\n        const changeStreamCursor = new change_stream_cursor_1.ChangeStreamCursor(client, this.namespace, pipeline, {\n            ...options,\n            timeoutContext: this.timeoutContext\n                ? new abstract_cursor_1.CursorTimeoutContext(this.timeoutContext, this.contextOwner)\n                : undefined\n        });\n        for (const event of CHANGE_STREAM_EVENTS) {\n            changeStreamCursor.on(event, e => this.emit(event, e));\n        }\n        if (this.listenerCount(ChangeStream.CHANGE) > 0) {\n            this._streamEvents(changeStreamCursor);\n        }\n        return changeStreamCursor;\n    }\n    /** @internal */\n    _closeEmitterModeWithError(error) {\n        this.emit(ChangeStream.ERROR, error);\n        this.close().then(undefined, utils_1.squashError);\n    }\n    /** @internal */\n    _streamEvents(cursor) {\n        this._setIsEmitter();\n        const stream = this.cursorStream ?? cursor.stream();\n        this.cursorStream = stream;\n        stream.on('data', change => {\n            try {\n                const processedChange = this._processChange(change);\n                this.emit(ChangeStream.CHANGE, processedChange);\n            }\n            catch (error) {\n                this.emit(ChangeStream.ERROR, error);\n            }\n            this.timeoutContext?.refresh();\n        });\n        stream.on('error', error => this._processErrorStreamMode(error, this.cursor.id != null));\n    }\n    /** @internal */\n    _endStream() {\n        this.cursorStream?.removeAllListeners('data');\n        this.cursorStream?.removeAllListeners('close');\n        this.cursorStream?.removeAllListeners('end');\n        this.cursorStream?.destroy();\n        this.cursorStream = undefined;\n    }\n    /** @internal */\n    _processChange(change) {\n        if (this.isClosed) {\n            // TODO(NODE-3485): Replace with MongoChangeStreamClosedError\n            throw new error_1.MongoAPIError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        // a null change means the cursor has been notified, implicitly closing the change stream\n        if (change == null) {\n            // TODO(NODE-3485): Replace with MongoChangeStreamClosedError\n            throw new error_1.MongoRuntimeError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        if (change && !change._id) {\n            throw new error_1.MongoChangeStreamError(NO_RESUME_TOKEN_ERROR);\n        }\n        // cache the resume token\n        this.cursor.cacheResumeToken(change._id);\n        // wipe the startAtOperationTime if there was one so that there won't be a conflict\n        // between resumeToken and startAtOperationTime if we need to reconnect the cursor\n        this.options.startAtOperationTime = undefined;\n        return change;\n    }\n    /** @internal */\n    _processErrorStreamMode(changeStreamError, cursorInitialized) {\n        // If the change stream has been closed explicitly, do not process error.\n        if (this.isClosed)\n            return;\n        if (cursorInitialized &&\n            ((0, error_1.isResumableError)(changeStreamError, this.cursor.maxWireVersion) ||\n                changeStreamError instanceof error_1.MongoOperationTimeoutError)) {\n            this._endStream();\n            this.cursor\n                .close()\n                .then(() => this._resume(changeStreamError), e => {\n                (0, utils_1.squashError)(e);\n                return this._resume(changeStreamError);\n            })\n                .then(() => {\n                if (changeStreamError instanceof error_1.MongoOperationTimeoutError)\n                    this.emit(ChangeStream.ERROR, changeStreamError);\n            }, () => this._closeEmitterModeWithError(changeStreamError));\n        }\n        else {\n            this._closeEmitterModeWithError(changeStreamError);\n        }\n    }\n    /** @internal */\n    async _processErrorIteratorMode(changeStreamError, cursorInitialized) {\n        if (this.isClosed) {\n            // TODO(NODE-3485): Replace with MongoChangeStreamClosedError\n            throw new error_1.MongoAPIError(CHANGESTREAM_CLOSED_ERROR);\n        }\n        if (cursorInitialized &&\n            ((0, error_1.isResumableError)(changeStreamError, this.cursor.maxWireVersion) ||\n                changeStreamError instanceof error_1.MongoOperationTimeoutError)) {\n            try {\n                await this.cursor.close();\n            }\n            catch (error) {\n                (0, utils_1.squashError)(error);\n            }\n            await this._resume(changeStreamError);\n            if (changeStreamError instanceof error_1.MongoOperationTimeoutError)\n                throw changeStreamError;\n        }\n        else {\n            try {\n                await this.close();\n            }\n            catch (error) {\n                (0, utils_1.squashError)(error);\n            }\n            throw changeStreamError;\n        }\n    }\n    async _resume(changeStreamError) {\n        this.timeoutContext?.refresh();\n        const topology = (0, utils_1.getTopology)(this.parent);\n        try {\n            await topology.selectServer(this.cursor.readPreference, {\n                operationName: 'reconnect topology in change stream',\n                timeoutContext: this.timeoutContext\n            });\n            this.cursor = this._createChangeStreamCursor(this.cursor.resumeOptions);\n        }\n        catch {\n            // if the topology can't reconnect, close the stream\n            await this.close();\n            throw changeStreamError;\n        }\n    }\n}\nexports.ChangeStream = ChangeStream;\n/** @event */\nChangeStream.RESPONSE = constants_1.RESPONSE;\n/** @event */\nChangeStream.MORE = constants_1.MORE;\n/** @event */\nChangeStream.INIT = constants_1.INIT;\n/** @event */\nChangeStream.CLOSE = constants_1.CLOSE;\n/**\n * Fired for each new matching change in the specified namespace. Attaching a `change`\n * event listener to a Change Stream will switch the stream into flowing mode. Data will\n * then be passed as soon as it is available.\n * @event\n */\nChangeStream.CHANGE = constants_1.CHANGE;\n/** @event */\nChangeStream.END = constants_1.END;\n/** @event */\nChangeStream.ERROR = constants_1.ERROR;\n/**\n * Emitted each time the change stream stores a new resume token.\n * @event\n */\nChangeStream.RESUME_TOKEN_CHANGED = constants_1.RESUME_TOKEN_CHANGED;\n(0, resource_management_1.configureResourceManagement)(ChangeStream.prototype);\n//# sourceMappingURL=change_stream.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NoYW5nZV9zdHJlYW0uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsb0JBQW9CO0FBQ3BCLHFCQUFxQixtQkFBTyxDQUFDLHNHQUFjO0FBQzNDLG9CQUFvQixtQkFBTyxDQUFDLG9HQUFhO0FBQ3pDLDBCQUEwQixtQkFBTyxDQUFDLDhIQUEwQjtBQUM1RCwrQkFBK0IsbUJBQU8sQ0FBQyx3SUFBK0I7QUFDdEUsYUFBYSxtQkFBTyxDQUFDLHNGQUFNO0FBQzNCLGdCQUFnQixtQkFBTyxDQUFDLDRGQUFTO0FBQ2pDLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQyxzQkFBc0IsbUJBQU8sQ0FBQyx3R0FBZTtBQUM3Qyw4QkFBOEIsbUJBQU8sQ0FBQyx3SEFBdUI7QUFDN0Qsa0JBQWtCLG1CQUFPLENBQUMsZ0dBQVc7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSwwQ0FBMEM7QUFDM0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxnSEFBZ0g7QUFDdEo7QUFDQSxtREFBbUQ7QUFDbkQ7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qix5Q0FBeUM7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0lBQWdJLHFCQUFxQjtBQUNySjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NoYW5nZV9zdHJlYW0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNoYW5nZVN0cmVhbSA9IHZvaWQgMDtcbmNvbnN0IGNvbGxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuL2NvbGxlY3Rpb25cIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2Fic3RyYWN0X2N1cnNvclwiKTtcbmNvbnN0IGNoYW5nZV9zdHJlYW1fY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvY2hhbmdlX3N0cmVhbV9jdXJzb3JcIik7XG5jb25zdCBkYl8xID0gcmVxdWlyZShcIi4vZGJcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBtb25nb19jbGllbnRfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2NsaWVudFwiKTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi9tb25nb190eXBlc1wiKTtcbmNvbnN0IHJlc291cmNlX21hbmFnZW1lbnRfMSA9IHJlcXVpcmUoXCIuL3Jlc291cmNlX21hbmFnZW1lbnRcIik7XG5jb25zdCB0aW1lb3V0XzEgPSByZXF1aXJlKFwiLi90aW1lb3V0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuL3V0aWxzXCIpO1xuY29uc3QgQ0hBTkdFX1NUUkVBTV9PUFRJT05TID0gW1xuICAgICdyZXN1bWVBZnRlcicsXG4gICAgJ3N0YXJ0QWZ0ZXInLFxuICAgICdzdGFydEF0T3BlcmF0aW9uVGltZScsXG4gICAgJ2Z1bGxEb2N1bWVudCcsXG4gICAgJ2Z1bGxEb2N1bWVudEJlZm9yZUNoYW5nZScsXG4gICAgJ3Nob3dFeHBhbmRlZEV2ZW50cydcbl07XG5jb25zdCBDSEFOR0VfRE9NQUlOX1RZUEVTID0ge1xuICAgIENPTExFQ1RJT046IFN5bWJvbCgnQ29sbGVjdGlvbicpLFxuICAgIERBVEFCQVNFOiBTeW1ib2woJ0RhdGFiYXNlJyksXG4gICAgQ0xVU1RFUjogU3ltYm9sKCdDbHVzdGVyJylcbn07XG5jb25zdCBDSEFOR0VfU1RSRUFNX0VWRU5UUyA9IFtjb25zdGFudHNfMS5SRVNVTUVfVE9LRU5fQ0hBTkdFRCwgY29uc3RhbnRzXzEuRU5ELCBjb25zdGFudHNfMS5DTE9TRV07XG5jb25zdCBOT19SRVNVTUVfVE9LRU5fRVJST1IgPSAnQSBjaGFuZ2Ugc3RyZWFtIGRvY3VtZW50IGhhcyBiZWVuIHJlY2VpdmVkIHRoYXQgbGFja3MgYSByZXN1bWUgdG9rZW4gKF9pZCkuJztcbmNvbnN0IENIQU5HRVNUUkVBTV9DTE9TRURfRVJST1IgPSAnQ2hhbmdlU3RyZWFtIGlzIGNsb3NlZCc7XG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgQ2hhbmdlIFN0cmVhbSBpbnN0YW5jZS4gTm9ybWFsbHkgY3JlYXRlZCB1c2luZyB7QGxpbmsgQ29sbGVjdGlvbiN3YXRjaHxDb2xsZWN0aW9uLndhdGNoKCl9LlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBDaGFuZ2VTdHJlYW0gZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgYXN5bmMgYXN5bmNEaXNwb3NlKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogQHBhcmFtIHBhcmVudCAtIFRoZSBwYXJlbnQgb2JqZWN0IHRoYXQgY3JlYXRlZCB0aGlzIGNoYW5nZSBzdHJlYW1cbiAgICAgKiBAcGFyYW0gcGlwZWxpbmUgLSBBbiBhcnJheSBvZiB7QGxpbmsgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL2FnZ3JlZ2F0aW9uLXBpcGVsaW5lL3xhZ2dyZWdhdGlvbiBwaXBlbGluZSBzdGFnZXN9IHRocm91Z2ggd2hpY2ggdG8gcGFzcyBjaGFuZ2Ugc3RyZWFtIGRvY3VtZW50c1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgcGlwZWxpbmUgPSBbXSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucGlwZWxpbmUgPSBwaXBlbGluZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5vcHRpb25zIH07XG4gICAgICAgIGxldCBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM7XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMud3JpdGVDb25jZXJuO1xuICAgICAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgY29sbGVjdGlvbl8xLkNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IENIQU5HRV9ET01BSU5fVFlQRVMuQ09MTEVDVElPTjtcbiAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyA9IHBhcmVudC5zLmRiLmNsaWVudC5vcHRpb25zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBkYl8xLkRiKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSBDSEFOR0VfRE9NQUlOX1RZUEVTLkRBVEFCQVNFO1xuICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TID0gcGFyZW50LmNsaWVudC5vcHRpb25zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBtb25nb19jbGllbnRfMS5Nb25nb0NsaWVudCkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gQ0hBTkdFX0RPTUFJTl9UWVBFUy5DTFVTVEVSO1xuICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TID0gcGFyZW50Lm9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29DaGFuZ2VTdHJlYW1FcnJvcignUGFyZW50IHByb3ZpZGVkIHRvIENoYW5nZVN0cmVhbSBjb25zdHJ1Y3RvciBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIENvbGxlY3Rpb24sIERiLCBvciBNb25nb0NsaWVudCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGV4dE93bmVyID0gU3ltYm9sKCk7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB0aGlzLm5hbWVzcGFjZSA9IHBhcmVudC5zLm5hbWVzcGFjZTtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucmVhZFByZWZlcmVuY2UgJiYgcGFyZW50LnJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVhZFByZWZlcmVuY2UgPSBwYXJlbnQucmVhZFByZWZlcmVuY2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIGNvbnRhaW5lZCBDaGFuZ2UgU3RyZWFtIGN1cnNvclxuICAgICAgICB0aGlzLmN1cnNvciA9IHRoaXMuX2NyZWF0ZUNoYW5nZVN0cmVhbUN1cnNvcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5pc0Nsb3NlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1vZGUgPSBmYWxzZTtcbiAgICAgICAgLy8gTGlzdGVuIGZvciBhbnkgYGNoYW5nZWAgbGlzdGVuZXJzIGJlaW5nIGFkZGVkIHRvIENoYW5nZVN0cmVhbVxuICAgICAgICB0aGlzLm9uKCduZXdMaXN0ZW5lcicsIGV2ZW50TmFtZSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnROYW1lID09PSAnY2hhbmdlJyAmJiB0aGlzLmN1cnNvciAmJiB0aGlzLmxpc3RlbmVyQ291bnQoJ2NoYW5nZScpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RyZWFtRXZlbnRzKHRoaXMuY3Vyc29yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ3JlbW92ZUxpc3RlbmVyJywgZXZlbnROYW1lID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudE5hbWUgPT09ICdjaGFuZ2UnICYmIHRoaXMubGlzdGVuZXJDb3VudCgnY2hhbmdlJykgPT09IDAgJiYgdGhpcy5jdXJzb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnNvclN0cmVhbT8ucmVtb3ZlQWxsTGlzdGVuZXJzKCdkYXRhJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRpbWVvdXRNUyAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0ID0gbmV3IHRpbWVvdXRfMS5DU09UVGltZW91dENvbnRleHQoe1xuICAgICAgICAgICAgICAgIHRpbWVvdXRNUzogdGhpcy5vcHRpb25zLnRpbWVvdXRNUyxcbiAgICAgICAgICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBUaGUgY2FjaGVkIHJlc3VtZSB0b2tlbiB0aGF0IGlzIHVzZWQgdG8gcmVzdW1lIGFmdGVyIHRoZSBtb3N0IHJlY2VudGx5IHJldHVybmVkIGNoYW5nZS4gKi9cbiAgICBnZXQgcmVzdW1lVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnNvcj8ucmVzdW1lVG9rZW47XG4gICAgfVxuICAgIC8qKiBDaGVjayBpZiB0aGVyZSBpcyBhbnkgZG9jdW1lbnQgc3RpbGwgYXZhaWxhYmxlIGluIHRoZSBDaGFuZ2UgU3RyZWFtICovXG4gICAgYXN5bmMgaGFzTmV4dCgpIHtcbiAgICAgICAgdGhpcy5fc2V0SXNJdGVyYXRvcigpO1xuICAgICAgICAvLyBDaGFuZ2Ugc3RyZWFtcyBtdXN0IHJlc3VtZSBpbmRlZmluaXRlbHkgd2hpbGUgZWFjaCByZXN1bWUgZXZlbnQgc3VjY2VlZHMuXG4gICAgICAgIC8vIFRoaXMgbG9vcCBjb250aW51ZXMgdW50aWwgZWl0aGVyIGEgY2hhbmdlIGV2ZW50IGlzIHJlY2VpdmVkIG9yIHVudGlsIGEgcmVzdW1lIGF0dGVtcHRcbiAgICAgICAgLy8gZmFpbHMuXG4gICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LnJlZnJlc2goKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzTmV4dCA9IGF3YWl0IHRoaXMuY3Vyc29yLmhhc05leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhc05leHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fcHJvY2Vzc0Vycm9ySXRlcmF0b3JNb2RlKGVycm9yLCB0aGlzLmN1cnNvci5pZCAhPSBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgJiYgdGhpcy5jdXJzb3IuaWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5zcXVhc2hFcnJvcikoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0Py5jbGVhcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBHZXQgdGhlIG5leHQgYXZhaWxhYmxlIGRvY3VtZW50IGZyb20gdGhlIENoYW5nZSBTdHJlYW0uICovXG4gICAgYXN5bmMgbmV4dCgpIHtcbiAgICAgICAgdGhpcy5fc2V0SXNJdGVyYXRvcigpO1xuICAgICAgICAvLyBDaGFuZ2Ugc3RyZWFtcyBtdXN0IHJlc3VtZSBpbmRlZmluaXRlbHkgd2hpbGUgZWFjaCByZXN1bWUgZXZlbnQgc3VjY2VlZHMuXG4gICAgICAgIC8vIFRoaXMgbG9vcCBjb250aW51ZXMgdW50aWwgZWl0aGVyIGEgY2hhbmdlIGV2ZW50IGlzIHJlY2VpdmVkIG9yIHVudGlsIGEgcmVzdW1lIGF0dGVtcHRcbiAgICAgICAgLy8gZmFpbHMuXG4gICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LnJlZnJlc2goKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhbmdlID0gYXdhaXQgdGhpcy5jdXJzb3IubmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzZWRDaGFuZ2UgPSB0aGlzLl9wcm9jZXNzQ2hhbmdlKGNoYW5nZSA/PyBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NlZENoYW5nZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9wcm9jZXNzRXJyb3JJdGVyYXRvck1vZGUoZXJyb3IsIHRoaXMuY3Vyc29yLmlkICE9IG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvciAmJiB0aGlzLmN1cnNvci5pZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LmNsZWFyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJ5IHRvIGdldCB0aGUgbmV4dCBhdmFpbGFibGUgZG9jdW1lbnQgZnJvbSB0aGUgQ2hhbmdlIFN0cmVhbSdzIGN1cnNvciBvciBgbnVsbGAgaWYgYW4gZW1wdHkgYmF0Y2ggaXMgcmV0dXJuZWRcbiAgICAgKi9cbiAgICBhc3luYyB0cnlOZXh0KCkge1xuICAgICAgICB0aGlzLl9zZXRJc0l0ZXJhdG9yKCk7XG4gICAgICAgIC8vIENoYW5nZSBzdHJlYW1zIG11c3QgcmVzdW1lIGluZGVmaW5pdGVseSB3aGlsZSBlYWNoIHJlc3VtZSBldmVudCBzdWNjZWVkcy5cbiAgICAgICAgLy8gVGhpcyBsb29wIGNvbnRpbnVlcyB1bnRpbCBlaXRoZXIgYSBjaGFuZ2UgZXZlbnQgaXMgcmVjZWl2ZWQgb3IgdW50aWwgYSByZXN1bWUgYXR0ZW1wdFxuICAgICAgICAvLyBmYWlscy5cbiAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dD8ucmVmcmVzaCgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFuZ2UgPSBhd2FpdCB0aGlzLmN1cnNvci50cnlOZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGFuZ2UgPz8gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9wcm9jZXNzRXJyb3JJdGVyYXRvck1vZGUoZXJyb3IsIHRoaXMuY3Vyc29yLmlkICE9IG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvciAmJiB0aGlzLmN1cnNvci5pZCA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5zcXVhc2hFcnJvcikoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0Py5jbGVhcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jICpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ2hhbmdlIHN0cmVhbXMgcnVuIGluZGVmaW5pdGVseSBhcyBsb25nIGFzIGVycm9ycyBhcmUgcmVzdW1hYmxlXG4gICAgICAgICAgICAvLyBTbyB0aGUgb25seSBsb29wIGJyZWFraW5nIGNvbmRpdGlvbiBpcyBpZiBgbmV4dCgpYCB0aHJvd3NcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgYXdhaXQgdGhpcy5uZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIElzIHRoZSBjdXJzb3IgY2xvc2VkICovXG4gICAgZ2V0IGNsb3NlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNDbG9zZWQgfHwgdGhpcy5jdXJzb3IuY2xvc2VkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGcmVlcyB0aGUgaW50ZXJuYWwgcmVzb3VyY2VzIHVzZWQgYnkgdGhlIGNoYW5nZSBzdHJlYW0uXG4gICAgICovXG4gICAgYXN5bmMgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LmNsZWFyKCk7XG4gICAgICAgIHRoaXMudGltZW91dENvbnRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXNDbG9zZWQgPSB0cnVlO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmN1cnNvcjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5fZW5kU3RyZWFtKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJuIGEgbW9kaWZpZWQgUmVhZGFibGUgc3RyZWFtIGluY2x1ZGluZyBhIHBvc3NpYmxlIHRyYW5zZm9ybSBtZXRob2QuXG4gICAgICpcbiAgICAgKiBOT1RFOiBXaGVuIHVzaW5nIGEgU3RyZWFtIHRvIHByb2Nlc3MgY2hhbmdlIHN0cmVhbSBldmVudHMsIHRoZSBzdHJlYW0gd2lsbFxuICAgICAqIE5PVCBhdXRvbWF0aWNhbGx5IHJlc3VtZSBpbiB0aGUgY2FzZSBhIHJlc3VtYWJsZSBlcnJvciBpcyBlbmNvdW50ZXJlZC5cbiAgICAgKlxuICAgICAqIEB0aHJvd3MgTW9uZ29DaGFuZ2VTdHJlYW1FcnJvciBpZiB0aGUgdW5kZXJseWluZyBjdXJzb3Igb3IgdGhlIGNoYW5nZSBzdHJlYW0gaXMgY2xvc2VkXG4gICAgICovXG4gICAgc3RyZWFtKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NoYW5nZVN0cmVhbUVycm9yKENIQU5HRVNUUkVBTV9DTE9TRURfRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RyZWFtT3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnNvci5zdHJlYW0ob3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfc2V0SXNFbWl0dGVyKCkge1xuICAgICAgICBpZiAodGhpcy5tb2RlID09PSAnaXRlcmF0b3InKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4NSk6IFJlcGxhY2Ugd2l0aCBNb25nb0NoYW5nZVN0cmVhbU1vZGVFcnJvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignQ2hhbmdlU3RyZWFtIGNhbm5vdCBiZSB1c2VkIGFzIGFuIEV2ZW50RW1pdHRlciBhZnRlciBiZWluZyB1c2VkIGFzIGFuIGl0ZXJhdG9yJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb2RlID0gJ2VtaXR0ZXInO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX3NldElzSXRlcmF0b3IoKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdlbWl0dGVyJykge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHdpdGggTW9uZ29DaGFuZ2VTdHJlYW1Nb2RlRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0NoYW5nZVN0cmVhbSBjYW5ub3QgYmUgdXNlZCBhcyBhbiBpdGVyYXRvciBhZnRlciBiZWluZyB1c2VkIGFzIGFuIEV2ZW50RW1pdHRlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9kZSA9ICdpdGVyYXRvcic7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBjaGFuZ2Ugc3RyZWFtIGN1cnNvciBiYXNlZCBvbiBzZWxmJ3MgY29uZmlndXJhdGlvblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIF9jcmVhdGVDaGFuZ2VTdHJlYW1DdXJzb3Iob3B0aW9ucykge1xuICAgICAgICBjb25zdCBjaGFuZ2VTdHJlYW1TdGFnZU9wdGlvbnMgPSAoMCwgdXRpbHNfMS5maWx0ZXJPcHRpb25zKShvcHRpb25zLCBDSEFOR0VfU1RSRUFNX09QVElPTlMpO1xuICAgICAgICBpZiAodGhpcy50eXBlID09PSBDSEFOR0VfRE9NQUlOX1RZUEVTLkNMVVNURVIpIHtcbiAgICAgICAgICAgIGNoYW5nZVN0cmVhbVN0YWdlT3B0aW9ucy5hbGxDaGFuZ2VzRm9yQ2x1c3RlciA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGlwZWxpbmUgPSBbeyAkY2hhbmdlU3RyZWFtOiBjaGFuZ2VTdHJlYW1TdGFnZU9wdGlvbnMgfSwgLi4udGhpcy5waXBlbGluZV07XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IHRoaXMudHlwZSA9PT0gQ0hBTkdFX0RPTUFJTl9UWVBFUy5DTFVTVEVSXG4gICAgICAgICAgICA/IHRoaXMucGFyZW50XG4gICAgICAgICAgICA6IHRoaXMudHlwZSA9PT0gQ0hBTkdFX0RPTUFJTl9UWVBFUy5EQVRBQkFTRVxuICAgICAgICAgICAgICAgID8gdGhpcy5wYXJlbnQuY2xpZW50XG4gICAgICAgICAgICAgICAgOiB0aGlzLnR5cGUgPT09IENIQU5HRV9ET01BSU5fVFlQRVMuQ09MTEVDVElPTlxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMucGFyZW50LmNsaWVudFxuICAgICAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIGlmIChjbGllbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuIGJlY2F1c2Ugb2YgdGhlIGFzc2VydGlvbiBpbiB0aGUgY29uc3RydWN0b3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBDaGFuZ2VzdHJlYW0gdHlwZSBzaG91bGQgb25seSBiZSBvbmUgb2YgY2x1c3RlciwgZGF0YWJhc2UsIGNvbGxlY3Rpb24uIEZvdW5kICR7dGhpcy50eXBlLnRvU3RyaW5nKCl9YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbmdlU3RyZWFtQ3Vyc29yID0gbmV3IGNoYW5nZV9zdHJlYW1fY3Vyc29yXzEuQ2hhbmdlU3RyZWFtQ3Vyc29yKGNsaWVudCwgdGhpcy5uYW1lc3BhY2UsIHBpcGVsaW5lLCB7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgdGltZW91dENvbnRleHQ6IHRoaXMudGltZW91dENvbnRleHRcbiAgICAgICAgICAgICAgICA/IG5ldyBhYnN0cmFjdF9jdXJzb3JfMS5DdXJzb3JUaW1lb3V0Q29udGV4dCh0aGlzLnRpbWVvdXRDb250ZXh0LCB0aGlzLmNvbnRleHRPd25lcilcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZFxuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiBDSEFOR0VfU1RSRUFNX0VWRU5UUykge1xuICAgICAgICAgICAgY2hhbmdlU3RyZWFtQ3Vyc29yLm9uKGV2ZW50LCBlID0+IHRoaXMuZW1pdChldmVudCwgZSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxpc3RlbmVyQ291bnQoQ2hhbmdlU3RyZWFtLkNIQU5HRSkgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl9zdHJlYW1FdmVudHMoY2hhbmdlU3RyZWFtQ3Vyc29yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hhbmdlU3RyZWFtQ3Vyc29yO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2Nsb3NlRW1pdHRlck1vZGVXaXRoRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lbWl0KENoYW5nZVN0cmVhbS5FUlJPUiwgZXJyb3IpO1xuICAgICAgICB0aGlzLmNsb3NlKCkudGhlbih1bmRlZmluZWQsIHV0aWxzXzEuc3F1YXNoRXJyb3IpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX3N0cmVhbUV2ZW50cyhjdXJzb3IpIHtcbiAgICAgICAgdGhpcy5fc2V0SXNFbWl0dGVyKCk7XG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuY3Vyc29yU3RyZWFtID8/IGN1cnNvci5zdHJlYW0oKTtcbiAgICAgICAgdGhpcy5jdXJzb3JTdHJlYW0gPSBzdHJlYW07XG4gICAgICAgIHN0cmVhbS5vbignZGF0YScsIGNoYW5nZSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZENoYW5nZSA9IHRoaXMuX3Byb2Nlc3NDaGFuZ2UoY2hhbmdlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoQ2hhbmdlU3RyZWFtLkNIQU5HRSwgcHJvY2Vzc2VkQ2hhbmdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdChDaGFuZ2VTdHJlYW0uRVJST1IsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LnJlZnJlc2goKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHN0cmVhbS5vbignZXJyb3InLCBlcnJvciA9PiB0aGlzLl9wcm9jZXNzRXJyb3JTdHJlYW1Nb2RlKGVycm9yLCB0aGlzLmN1cnNvci5pZCAhPSBudWxsKSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZW5kU3RyZWFtKCkge1xuICAgICAgICB0aGlzLmN1cnNvclN0cmVhbT8ucmVtb3ZlQWxsTGlzdGVuZXJzKCdkYXRhJyk7XG4gICAgICAgIHRoaXMuY3Vyc29yU3RyZWFtPy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2Nsb3NlJyk7XG4gICAgICAgIHRoaXMuY3Vyc29yU3RyZWFtPy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2VuZCcpO1xuICAgICAgICB0aGlzLmN1cnNvclN0cmVhbT8uZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmN1cnNvclN0cmVhbSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9wcm9jZXNzQ2hhbmdlKGNoYW5nZSkge1xuICAgICAgICBpZiAodGhpcy5pc0Nsb3NlZCkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHdpdGggTW9uZ29DaGFuZ2VTdHJlYW1DbG9zZWRFcnJvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcihDSEFOR0VTVFJFQU1fQ0xPU0VEX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBhIG51bGwgY2hhbmdlIG1lYW5zIHRoZSBjdXJzb3IgaGFzIGJlZW4gbm90aWZpZWQsIGltcGxpY2l0bHkgY2xvc2luZyB0aGUgY2hhbmdlIHN0cmVhbVxuICAgICAgICBpZiAoY2hhbmdlID09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvQ2hhbmdlU3RyZWFtQ2xvc2VkRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKENIQU5HRVNUUkVBTV9DTE9TRURfRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2UgJiYgIWNoYW5nZS5faWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ2hhbmdlU3RyZWFtRXJyb3IoTk9fUkVTVU1FX1RPS0VOX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjYWNoZSB0aGUgcmVzdW1lIHRva2VuXG4gICAgICAgIHRoaXMuY3Vyc29yLmNhY2hlUmVzdW1lVG9rZW4oY2hhbmdlLl9pZCk7XG4gICAgICAgIC8vIHdpcGUgdGhlIHN0YXJ0QXRPcGVyYXRpb25UaW1lIGlmIHRoZXJlIHdhcyBvbmUgc28gdGhhdCB0aGVyZSB3b24ndCBiZSBhIGNvbmZsaWN0XG4gICAgICAgIC8vIGJldHdlZW4gcmVzdW1lVG9rZW4gYW5kIHN0YXJ0QXRPcGVyYXRpb25UaW1lIGlmIHdlIG5lZWQgdG8gcmVjb25uZWN0IHRoZSBjdXJzb3JcbiAgICAgICAgdGhpcy5vcHRpb25zLnN0YXJ0QXRPcGVyYXRpb25UaW1lID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gY2hhbmdlO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX3Byb2Nlc3NFcnJvclN0cmVhbU1vZGUoY2hhbmdlU3RyZWFtRXJyb3IsIGN1cnNvckluaXRpYWxpemVkKSB7XG4gICAgICAgIC8vIElmIHRoZSBjaGFuZ2Ugc3RyZWFtIGhhcyBiZWVuIGNsb3NlZCBleHBsaWNpdGx5LCBkbyBub3QgcHJvY2VzcyBlcnJvci5cbiAgICAgICAgaWYgKHRoaXMuaXNDbG9zZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChjdXJzb3JJbml0aWFsaXplZCAmJlxuICAgICAgICAgICAgKCgwLCBlcnJvcl8xLmlzUmVzdW1hYmxlRXJyb3IpKGNoYW5nZVN0cmVhbUVycm9yLCB0aGlzLmN1cnNvci5tYXhXaXJlVmVyc2lvbikgfHxcbiAgICAgICAgICAgICAgICBjaGFuZ2VTdHJlYW1FcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IpKSB7XG4gICAgICAgICAgICB0aGlzLl9lbmRTdHJlYW0oKTtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yXG4gICAgICAgICAgICAgICAgLmNsb3NlKClcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLl9yZXN1bWUoY2hhbmdlU3RyZWFtRXJyb3IpLCBlID0+IHtcbiAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5zcXVhc2hFcnJvcikoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VtZShjaGFuZ2VTdHJlYW1FcnJvcik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlU3RyZWFtRXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoQ2hhbmdlU3RyZWFtLkVSUk9SLCBjaGFuZ2VTdHJlYW1FcnJvcik7XG4gICAgICAgICAgICB9LCAoKSA9PiB0aGlzLl9jbG9zZUVtaXR0ZXJNb2RlV2l0aEVycm9yKGNoYW5nZVN0cmVhbUVycm9yKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jbG9zZUVtaXR0ZXJNb2RlV2l0aEVycm9yKGNoYW5nZVN0cmVhbUVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYXN5bmMgX3Byb2Nlc3NFcnJvckl0ZXJhdG9yTW9kZShjaGFuZ2VTdHJlYW1FcnJvciwgY3Vyc29ySW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDbG9zZWQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvQ2hhbmdlU3RyZWFtQ2xvc2VkRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoQ0hBTkdFU1RSRUFNX0NMT1NFRF9FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnNvckluaXRpYWxpemVkICYmXG4gICAgICAgICAgICAoKDAsIGVycm9yXzEuaXNSZXN1bWFibGVFcnJvcikoY2hhbmdlU3RyZWFtRXJyb3IsIHRoaXMuY3Vyc29yLm1heFdpcmVWZXJzaW9uKSB8fFxuICAgICAgICAgICAgICAgIGNoYW5nZVN0cmVhbUVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcikpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jdXJzb3IuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9yZXN1bWUoY2hhbmdlU3RyZWFtRXJyb3IpO1xuICAgICAgICAgICAgaWYgKGNoYW5nZVN0cmVhbUVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcilcbiAgICAgICAgICAgICAgICB0aHJvdyBjaGFuZ2VTdHJlYW1FcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgKDAsIHV0aWxzXzEuc3F1YXNoRXJyb3IpKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGNoYW5nZVN0cmVhbUVycm9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIF9yZXN1bWUoY2hhbmdlU3RyZWFtRXJyb3IpIHtcbiAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dD8ucmVmcmVzaCgpO1xuICAgICAgICBjb25zdCB0b3BvbG9neSA9ICgwLCB1dGlsc18xLmdldFRvcG9sb2d5KSh0aGlzLnBhcmVudCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0b3BvbG9neS5zZWxlY3RTZXJ2ZXIodGhpcy5jdXJzb3IucmVhZFByZWZlcmVuY2UsIHtcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25OYW1lOiAncmVjb25uZWN0IHRvcG9sb2d5IGluIGNoYW5nZSBzdHJlYW0nLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRDb250ZXh0OiB0aGlzLnRpbWVvdXRDb250ZXh0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yID0gdGhpcy5fY3JlYXRlQ2hhbmdlU3RyZWFtQ3Vyc29yKHRoaXMuY3Vyc29yLnJlc3VtZU9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZSB0b3BvbG9neSBjYW4ndCByZWNvbm5lY3QsIGNsb3NlIHRoZSBzdHJlYW1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIHRocm93IGNoYW5nZVN0cmVhbUVycm9yO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5DaGFuZ2VTdHJlYW0gPSBDaGFuZ2VTdHJlYW07XG4vKiogQGV2ZW50ICovXG5DaGFuZ2VTdHJlYW0uUkVTUE9OU0UgPSBjb25zdGFudHNfMS5SRVNQT05TRTtcbi8qKiBAZXZlbnQgKi9cbkNoYW5nZVN0cmVhbS5NT1JFID0gY29uc3RhbnRzXzEuTU9SRTtcbi8qKiBAZXZlbnQgKi9cbkNoYW5nZVN0cmVhbS5JTklUID0gY29uc3RhbnRzXzEuSU5JVDtcbi8qKiBAZXZlbnQgKi9cbkNoYW5nZVN0cmVhbS5DTE9TRSA9IGNvbnN0YW50c18xLkNMT1NFO1xuLyoqXG4gKiBGaXJlZCBmb3IgZWFjaCBuZXcgbWF0Y2hpbmcgY2hhbmdlIGluIHRoZSBzcGVjaWZpZWQgbmFtZXNwYWNlLiBBdHRhY2hpbmcgYSBgY2hhbmdlYFxuICogZXZlbnQgbGlzdGVuZXIgdG8gYSBDaGFuZ2UgU3RyZWFtIHdpbGwgc3dpdGNoIHRoZSBzdHJlYW0gaW50byBmbG93aW5nIG1vZGUuIERhdGEgd2lsbFxuICogdGhlbiBiZSBwYXNzZWQgYXMgc29vbiBhcyBpdCBpcyBhdmFpbGFibGUuXG4gKiBAZXZlbnRcbiAqL1xuQ2hhbmdlU3RyZWFtLkNIQU5HRSA9IGNvbnN0YW50c18xLkNIQU5HRTtcbi8qKiBAZXZlbnQgKi9cbkNoYW5nZVN0cmVhbS5FTkQgPSBjb25zdGFudHNfMS5FTkQ7XG4vKiogQGV2ZW50ICovXG5DaGFuZ2VTdHJlYW0uRVJST1IgPSBjb25zdGFudHNfMS5FUlJPUjtcbi8qKlxuICogRW1pdHRlZCBlYWNoIHRpbWUgdGhlIGNoYW5nZSBzdHJlYW0gc3RvcmVzIGEgbmV3IHJlc3VtZSB0b2tlbi5cbiAqIEBldmVudFxuICovXG5DaGFuZ2VTdHJlYW0uUkVTVU1FX1RPS0VOX0NIQU5HRUQgPSBjb25zdGFudHNfMS5SRVNVTUVfVE9LRU5fQ0hBTkdFRDtcbigwLCByZXNvdXJjZV9tYW5hZ2VtZW50XzEuY29uZmlndXJlUmVzb3VyY2VNYW5hZ2VtZW50KShDaGFuZ2VTdHJlYW0ucHJvdG90eXBlKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNoYW5nZV9zdHJlYW0uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/auto_encrypter.js":
/*!*************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/auto_encrypter.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nvar _a;\nObject.defineProperty(exports, \"__esModule\", ({\n    value: true\n}));\nexports.AutoEncrypter = exports.AutoEncryptionLoggerLevel = void 0;\nconst net = __webpack_require__(/*! net */ \"net\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst deps_1 = __webpack_require__(/*! ../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ../mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst client_encryption_1 = __webpack_require__(/*! ./client_encryption */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/client_encryption.js\");\nconst cryptoCallbacks = __webpack_require__(/*! ./crypto_callbacks */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/crypto_callbacks.js\");\nconst errors_1 = __webpack_require__(/*! ./errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js\");\nconst mongocryptd_manager_1 = __webpack_require__(/*! ./mongocryptd_manager */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/mongocryptd_manager.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/index.js\");\nconst state_machine_1 = __webpack_require__(/*! ./state_machine */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/state_machine.js\");\n/** @public */ exports.AutoEncryptionLoggerLevel = Object.freeze({\n    FatalError: 0,\n    Error: 1,\n    Warning: 2,\n    Info: 3,\n    Trace: 4\n});\n/**\n * @internal An internal class to be used by the driver for auto encryption\n * **NOTE**: Not meant to be instantiated directly, this is for internal use only.\n */ class AutoEncrypter {\n    /** @internal */ static getMongoCrypt() {\n        const encryption = (0, deps_1.getMongoDBClientEncryption)();\n        if ('kModuleError' in encryption) {\n            throw encryption.kModuleError;\n        }\n        return encryption.MongoCrypt;\n    }\n    /**\n     * Create an AutoEncrypter\n     *\n     * **Note**: Do not instantiate this class directly. Rather, supply the relevant options to a MongoClient\n     *\n     * **Note**: Supplying `options.schemaMap` provides more security than relying on JSON Schemas obtained from the server.\n     * It protects against a malicious server advertising a false JSON Schema, which could trick the client into sending unencrypted data that should be encrypted.\n     * Schemas supplied in the schemaMap only apply to configuring automatic encryption for Client-Side Field Level Encryption.\n     * Other validation rules in the JSON schema will not be enforced by the driver and will result in an error.\n     *\n     * @example <caption>Create an AutoEncrypter that makes use of mongocryptd</caption>\n     * ```ts\n     * // Enabling autoEncryption via a MongoClient using mongocryptd\n     * const { MongoClient } = require('mongodb');\n     * const client = new MongoClient(URL, {\n     *   autoEncryption: {\n     *     kmsProviders: {\n     *       aws: {\n     *         accessKeyId: AWS_ACCESS_KEY,\n     *         secretAccessKey: AWS_SECRET_KEY\n     *       }\n     *     }\n     *   }\n     * });\n     * ```\n     *\n     * await client.connect();\n     * // From here on, the client will be encrypting / decrypting automatically\n     * @example <caption>Create an AutoEncrypter that makes use of libmongocrypt's CSFLE shared library</caption>\n     * ```ts\n     * // Enabling autoEncryption via a MongoClient using CSFLE shared library\n     * const { MongoClient } = require('mongodb');\n     * const client = new MongoClient(URL, {\n     *   autoEncryption: {\n     *     kmsProviders: {\n     *       aws: {}\n     *     },\n     *     extraOptions: {\n     *       cryptSharedLibPath: '/path/to/local/crypt/shared/lib',\n     *       cryptSharedLibRequired: true\n     *     }\n     *   }\n     * });\n     * ```\n     *\n     * await client.connect();\n     * // From here on, the client will be encrypting / decrypting automatically\n     */ constructor(client, options){\n        /**\n         * Used by devtools to enable decorating decryption results.\n         *\n         * When set and enabled, `decrypt` will automatically recursively\n         * traverse a decrypted document and if a field has been decrypted,\n         * it will mark it as decrypted.  Compass uses this to determine which\n         * fields were decrypted.\n         */ this[_a] = false;\n        this._client = client;\n        this._bypassEncryption = options.bypassAutoEncryption === true;\n        this._keyVaultNamespace = options.keyVaultNamespace || 'admin.datakeys';\n        this._keyVaultClient = options.keyVaultClient || client;\n        this._metaDataClient = options.metadataClient || client;\n        this._proxyOptions = options.proxyOptions || {};\n        this._tlsOptions = options.tlsOptions || {};\n        this._kmsProviders = options.kmsProviders || {};\n        this._credentialProviders = options.credentialProviders;\n        if (options.credentialProviders?.aws && !(0, providers_1.isEmptyCredentials)('aws', this._kmsProviders)) {\n            throw new errors_1.MongoCryptInvalidArgumentError('Can only provide a custom AWS credential provider when the state machine is configured for automatic AWS credential fetching');\n        }\n        const mongoCryptOptions = {\n            enableMultipleCollinfo: true,\n            cryptoCallbacks\n        };\n        if (options.schemaMap) {\n            mongoCryptOptions.schemaMap = Buffer.isBuffer(options.schemaMap) ? options.schemaMap : (0, bson_1.serialize)(options.schemaMap);\n        }\n        if (options.encryptedFieldsMap) {\n            mongoCryptOptions.encryptedFieldsMap = Buffer.isBuffer(options.encryptedFieldsMap) ? options.encryptedFieldsMap : (0, bson_1.serialize)(options.encryptedFieldsMap);\n        }\n        mongoCryptOptions.kmsProviders = !Buffer.isBuffer(this._kmsProviders) ? (0, bson_1.serialize)(this._kmsProviders) : this._kmsProviders;\n        if (options.options?.logger) {\n            mongoCryptOptions.logger = options.options.logger;\n        }\n        if (options.extraOptions && options.extraOptions.cryptSharedLibPath) {\n            mongoCryptOptions.cryptSharedLibPath = options.extraOptions.cryptSharedLibPath;\n        }\n        if (options.bypassQueryAnalysis) {\n            mongoCryptOptions.bypassQueryAnalysis = options.bypassQueryAnalysis;\n        }\n        this._bypassMongocryptdAndCryptShared = this._bypassEncryption || !!options.bypassQueryAnalysis;\n        if (options.extraOptions && options.extraOptions.cryptSharedLibSearchPaths) {\n            // Only for driver testing\n            mongoCryptOptions.cryptSharedLibSearchPaths = options.extraOptions.cryptSharedLibSearchPaths;\n        } else if (!this._bypassMongocryptdAndCryptShared) {\n            mongoCryptOptions.cryptSharedLibSearchPaths = [\n                '$SYSTEM'\n            ];\n        }\n        const MongoCrypt = AutoEncrypter.getMongoCrypt();\n        this._mongocrypt = new MongoCrypt(mongoCryptOptions);\n        this._contextCounter = 0;\n        if (options.extraOptions && options.extraOptions.cryptSharedLibRequired && !this.cryptSharedLibVersionInfo) {\n            throw new errors_1.MongoCryptInvalidArgumentError('`cryptSharedLibRequired` set but no crypt_shared library loaded');\n        }\n        // Only instantiate mongocryptd manager/client once we know for sure\n        // that we are not using the CSFLE shared library.\n        if (!this._bypassMongocryptdAndCryptShared && !this.cryptSharedLibVersionInfo) {\n            this._mongocryptdManager = new mongocryptd_manager_1.MongocryptdManager(options.extraOptions);\n            const clientOptions = {\n                serverSelectionTimeoutMS: 10000\n            };\n            if ((options.extraOptions == null || typeof options.extraOptions.mongocryptdURI !== 'string') && !net.getDefaultAutoSelectFamily) {\n                // Only set family if autoSelectFamily options are not supported.\n                clientOptions.family = 4;\n            }\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore: TS complains as this always returns true on versions where it is present.\n            if (net.getDefaultAutoSelectFamily) {\n                // AutoEncrypter is made inside of MongoClient constructor while options are being parsed,\n                // we do not have access to the options that are in progress.\n                // TODO(NODE-6449): AutoEncrypter does not use client options for autoSelectFamily\n                Object.assign(clientOptions, (0, client_encryption_1.autoSelectSocketOptions)(this._client.s?.options ?? {}));\n            }\n            this._mongocryptdClient = new mongo_client_1.MongoClient(this._mongocryptdManager.uri, clientOptions);\n        }\n    }\n    /**\n     * Initializes the auto encrypter by spawning a mongocryptd and connecting to it.\n     *\n     * This function is a no-op when bypassSpawn is set or the crypt shared library is used.\n     */ async init() {\n        if (this._bypassMongocryptdAndCryptShared || this.cryptSharedLibVersionInfo) {\n            return;\n        }\n        if (!this._mongocryptdManager) {\n            throw new error_1.MongoRuntimeError('Reached impossible state: mongocryptdManager is undefined when neither bypassSpawn nor the shared lib are specified.');\n        }\n        if (!this._mongocryptdClient) {\n            throw new error_1.MongoRuntimeError('Reached impossible state: mongocryptdClient is undefined when neither bypassSpawn nor the shared lib are specified.');\n        }\n        if (!this._mongocryptdManager.bypassSpawn) {\n            await this._mongocryptdManager.spawn();\n        }\n        try {\n            const client = await this._mongocryptdClient.connect();\n            return client;\n        } catch (error) {\n            throw new error_1.MongoRuntimeError('Unable to connect to `mongocryptd`, please make sure it is running or in your PATH for auto-spawn', {\n                cause: error\n            });\n        }\n    }\n    /**\n     * Cleans up the `_mongocryptdClient`, if present.\n     */ async teardown(force) {\n        await this._mongocryptdClient?.close(force);\n    }\n    /**\n     * Encrypt a command for a given namespace.\n     */ async encrypt(ns, cmd, options = {}) {\n        options.signal?.throwIfAborted();\n        if (this._bypassEncryption) {\n            // If `bypassAutoEncryption` has been specified, don't encrypt\n            return cmd;\n        }\n        const commandBuffer = Buffer.isBuffer(cmd) ? cmd : (0, bson_1.serialize)(cmd, options);\n        const context = this._mongocrypt.makeEncryptionContext(utils_1.MongoDBCollectionNamespace.fromString(ns).db, commandBuffer);\n        context.id = this._contextCounter++;\n        context.ns = ns;\n        context.document = cmd;\n        const stateMachine = new state_machine_1.StateMachine({\n            promoteValues: false,\n            promoteLongs: false,\n            proxyOptions: this._proxyOptions,\n            tlsOptions: this._tlsOptions,\n            socketOptions: (0, client_encryption_1.autoSelectSocketOptions)(this._client.s.options)\n        });\n        return (0, bson_1.deserialize)(await stateMachine.execute(this, context, options), {\n            promoteValues: false,\n            promoteLongs: false\n        });\n    }\n    /**\n     * Decrypt a command response\n     */ async decrypt(response, options = {}) {\n        options.signal?.throwIfAborted();\n        const context = this._mongocrypt.makeDecryptionContext(response);\n        context.id = this._contextCounter++;\n        const stateMachine = new state_machine_1.StateMachine({\n            ...options,\n            proxyOptions: this._proxyOptions,\n            tlsOptions: this._tlsOptions,\n            socketOptions: (0, client_encryption_1.autoSelectSocketOptions)(this._client.s.options)\n        });\n        return await stateMachine.execute(this, context, options);\n    }\n    /**\n     * Ask the user for KMS credentials.\n     *\n     * This returns anything that looks like the kmsProviders original input\n     * option. It can be empty, and any provider specified here will override\n     * the original ones.\n     */ async askForKMSCredentials() {\n        return await (0, providers_1.refreshKMSCredentials)(this._kmsProviders, this._credentialProviders);\n    }\n    /**\n     * Return the current libmongocrypt's CSFLE shared library version\n     * as `{ version: bigint, versionStr: string }`, or `null` if no CSFLE\n     * shared library was loaded.\n     */ get cryptSharedLibVersionInfo() {\n        return this._mongocrypt.cryptSharedLibVersionInfo;\n    }\n    static get libmongocryptVersion() {\n        return AutoEncrypter.getMongoCrypt().libmongocryptVersion;\n    }\n}\nexports.AutoEncrypter = AutoEncrypter;\n_a = constants_1.kDecorateResult; //# sourceMappingURL=auto_encrypter.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vYXV0b19lbmNyeXB0ZXIuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0Esa0RBQTJCO0FBRTNCLGdJQUFnRTtBQUVoRSwrSUFBK0M7QUFDL0MsZ0lBQXFEO0FBQ3JELG1JQUE2QztBQUM3Qyx3SkFBdUU7QUFFdkUsbUlBQXNEO0FBQ3RELDZMQUE4RDtBQUM5RCx1TEFBc0Q7QUFDdEQsNEpBQTBEO0FBQzFELG1NQUEyRDtBQUMzRCwyS0FLcUI7QUFDckIsaUxBQXdFO0FBa0d4RSxjQUFjLENBQ0QsaUNBQXlCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNyRCxVQUFVLEVBQUUsQ0FBQztJQUNiLEtBQUssRUFBRSxDQUFDO0lBQ1IsT0FBTyxFQUFFLENBQUM7SUFDVixJQUFJLEVBQUUsQ0FBQztJQUNQLEtBQUssRUFBRSxDQUFDO0NBQ0EsQ0FBQyxDQUFDO0FBaUJaOzs7R0FHRyxDQUNILE1BQWEsYUFBYTtJQTZCeEIsZ0JBQWdCLENBQ2hCLE1BQU0sQ0FBQyxhQUFhO1FBQ2xCLE1BQU0sVUFBVSxHQUFHLHdDQUE0QixDQUFDO1FBQ2hELElBQUksY0FBYyxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQ2pDLE1BQU0sVUFBVSxDQUFDLFlBQVksQ0FBQztRQUNoQyxDQUFDO1FBQ0QsT0FBTyxVQUFVLENBQUMsVUFBVSxDQUFDO0lBQy9CLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0ErQ0csQ0FDSCxZQUFZLE1BQW1CLEVBQUUsT0FBOEI7UUFuRS9EOzs7Ozs7O1dBT0csQ0FDSCxRQUFpQixHQUFHLEtBQUssQ0FBQztRQTREeEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsS0FBSyxJQUFJLENBQUM7UUFFL0QsSUFBSSxDQUFDLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsSUFBSSxnQkFBZ0IsQ0FBQztRQUN4RSxJQUFJLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxjQUFjLElBQUksTUFBTSxDQUFDO1FBQ3hELElBQUksQ0FBQyxlQUFlLEdBQUcsT0FBTyxDQUFDLGNBQWMsSUFBSSxNQUFNLENBQUM7UUFDeEQsSUFBSSxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUMsWUFBWSxJQUFJLEVBQUUsQ0FBQztRQUNoRCxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDO1FBQzVDLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUM7UUFDaEQsSUFBSSxDQUFDLG9CQUFvQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztRQUV4RCxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLElBQUksQ0FBQyxvQ0FBbUIsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO1lBQ3ZGLE1BQU0sSUFBSSx1Q0FBOEIsQ0FDdEMsOEhBQThILENBQy9ILENBQUM7UUFDSixDQUFDO1FBRUQsTUFBTSxpQkFBaUIsR0FBc0I7WUFDM0Msc0JBQXNCLEVBQUUsSUFBSTtZQUM1QixlQUFlO1NBQ2hCLENBQUM7UUFDRixJQUFJLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixpQkFBaUIsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQzVELE9BQU8sQ0FBQyxTQUFTLEdBQ2hCLHNCQUFVLE9BQU8sQ0FBQyxTQUFTLENBQVksQ0FBQztRQUMvQyxDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMvQixpQkFBaUIsQ0FBQyxrQkFBa0IsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxHQUM5RSxPQUFPLENBQUMsa0JBQWtCLEdBQ3pCLHNCQUFVLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBWSxDQUFDO1FBQ3hELENBQUM7UUFFRCxpQkFBaUIsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FDaEUsc0JBQVUsSUFBSSxDQUFDLGFBQWEsQ0FBWSxHQUN6QyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBRXZCLElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUM1QixpQkFBaUIsQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDcEQsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLFlBQVksSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDcEUsaUJBQWlCLENBQUMsa0JBQWtCLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQztRQUNqRixDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUNoQyxpQkFBaUIsQ0FBQyxtQkFBbUIsR0FBRyxPQUFPLENBQUMsbUJBQW1CLENBQUM7UUFDdEUsQ0FBQztRQUVELElBQUksQ0FBQyxnQ0FBZ0MsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztRQUVoRyxJQUFJLE9BQU8sQ0FBQyxZQUFZLElBQUksT0FBTyxDQUFDLFlBQVksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1lBQzNFLDBCQUEwQjtZQUMxQixpQkFBaUIsQ0FBQyx5QkFBeUIsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLHlCQUF5QixDQUFDO1FBQy9GLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLENBQUM7WUFDbEQsaUJBQWlCLENBQUMseUJBQXlCLEdBQUc7Z0JBQUMsU0FBUzthQUFDLENBQUM7UUFDNUQsQ0FBQztRQUVELE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNqRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7UUFFekIsSUFDRSxPQUFPLENBQUMsWUFBWSxJQUNwQixPQUFPLENBQUMsWUFBWSxDQUFDLHNCQUFzQixJQUMzQyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFDL0IsQ0FBQztZQUNELE1BQU0sSUFBSSx1Q0FBOEIsQ0FDdEMsaUVBQWlFLENBQ2xFLENBQUM7UUFDSixDQUFDO1FBRUQsb0VBQW9FO1FBQ3BFLGtEQUFrRDtRQUNsRCxJQUFJLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxJQUFJLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUM7WUFDOUUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksd0NBQWtCLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sYUFBYSxHQUF1QjtnQkFDeEMsd0JBQXdCLEVBQUUsS0FBSzthQUNoQyxDQUFDO1lBRUYsSUFDRSxDQUFDLE9BQU8sQ0FBQyxZQUFZLElBQUksSUFBSSxJQUFJLE9BQU8sT0FBTyxDQUFDLFlBQVksQ0FBQyxjQUFjLEtBQUssU0FBUSxDQUFDLEdBQ3pGLENBQUMsR0FBRyxDQUFDLDBCQUEwQixFQUMvQixDQUFDO2dCQUNELGlFQUFpRTtnQkFDakUsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDM0IsQ0FBQztZQUVELDZEQUE2RDtZQUM3RCx3RkFBd0Y7WUFDeEYsSUFBSSxHQUFHLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztnQkFDbkMsMEZBQTBGO2dCQUMxRiw2REFBNkQ7Z0JBQzdELGtGQUFrRjtnQkFDbEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsaURBQXdCLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3ZGLENBQUM7WUFFRCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSwwQkFBVyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDekYsQ0FBQztJQUNILENBQUM7SUFFRDs7OztPQUlHLENBQ0gsS0FBSyxDQUFDLElBQUk7UUFDUixJQUFJLElBQUksQ0FBQyxnQ0FBZ0MsSUFBSSxJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQztZQUM1RSxPQUFPO1FBQ1QsQ0FBQztRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUM5QixNQUFNLElBQUkseUJBQWlCLENBQ3pCLHNIQUFzSCxDQUN2SCxDQUFDO1FBQ0osQ0FBQztRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUM3QixNQUFNLElBQUkseUJBQWlCLENBQ3pCLHFIQUFxSCxDQUN0SCxDQUFDO1FBQ0osQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDMUMsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDekMsQ0FBQztRQUVELElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3ZELE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsTUFBTSxJQUFJLHlCQUFpQixDQUN6QixtR0FBbUcsRUFDbkc7Z0JBQUUsS0FBSyxFQUFFLEtBQUs7WUFBQSxDQUFFLENBQ2pCLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHLENBQ0gsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFjO1FBQzNCLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQ7O09BRUcsQ0FDSCxLQUFLLENBQUMsT0FBTyxDQUNYLEVBQVUsRUFDVixHQUFhLEVBQ2IsVUFBc0MsRUFBRTtRQUV4QyxPQUFPLENBQUMsTUFBTSxFQUFFLGNBQWMsRUFBRSxDQUFDO1FBRWpDLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDM0IsOERBQThEO1lBQzlELE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQztRQUVELE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsc0JBQVUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRTNFLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMscUJBQXFCLENBQ3BELGtDQUEwQixDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQzVDLGFBQWEsQ0FDZCxDQUFDO1FBRUYsT0FBTyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDcEMsT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDaEIsT0FBTyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7UUFFdkIsTUFBTSxZQUFZLEdBQUcsSUFBSSw0QkFBWSxDQUFDO1lBQ3BDLGFBQWEsRUFBRSxLQUFLO1lBQ3BCLFlBQVksRUFBRSxLQUFLO1lBQ25CLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYTtZQUNoQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFdBQVc7WUFDNUIsYUFBYSxFQUFFLGlEQUF3QixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7U0FDL0QsQ0FBQyxDQUFDO1FBRUgsT0FBTyx3QkFBWSxNQUFNLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBRTtZQUNyRSxhQUFhLEVBQUUsS0FBSztZQUNwQixZQUFZLEVBQUUsS0FBSztTQUNwQixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUcsQ0FDSCxLQUFLLENBQUMsT0FBTyxDQUNYLFFBQW9CLEVBQ3BCLFVBQXNDLEVBQUU7UUFFeEMsT0FBTyxDQUFDLE1BQU0sRUFBRSxjQUFjLEVBQUUsQ0FBQztRQUVqQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRWpFLE9BQU8sQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRXBDLE1BQU0sWUFBWSxHQUFHLElBQUksNEJBQVksQ0FBQztZQUNwQyxHQUFHLE9BQU87WUFDVixZQUFZLEVBQUUsSUFBSSxDQUFDLGFBQWE7WUFDaEMsVUFBVSxFQUFFLElBQUksQ0FBQyxXQUFXO1lBQzVCLGFBQWEsRUFBRSxpREFBd0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1NBQy9ELENBQUMsQ0FBQztRQUVILE9BQU8sTUFBTSxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVEOzs7Ozs7T0FNRyxDQUNILEtBQUssQ0FBQyxvQkFBb0I7UUFDeEIsT0FBTyxNQUFNLHVDQUFzQixJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQ3BGLENBQUM7SUFFRDs7OztPQUlHLENBQ0gsSUFBSSx5QkFBeUI7UUFDM0IsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLHlCQUF5QixDQUFDO0lBQ3BELENBQUM7SUFFRCxNQUFNLEtBQUssb0JBQW9CO1FBQzdCLE9BQU8sYUFBYSxDQUFDLGFBQWEsRUFBRSxDQUFDLG9CQUFvQixDQUFDO0lBQzVELENBQUM7Q0FDRjtBQTVURCxzQ0E0VEM7S0FqU0UsMkJBQWUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9zcmMvY2xpZW50LXNpZGUtZW5jcnlwdGlvbi9hdXRvX2VuY3J5cHRlci50cyJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/auto_encrypter.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/client_encryption.js":
/*!****************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/client_encryption.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ClientEncryption = void 0;\nexports.autoSelectSocketOptions = autoSelectSocketOptions;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst deps_1 = __webpack_require__(/*! ../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst cryptoCallbacks = __webpack_require__(/*! ./crypto_callbacks */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/crypto_callbacks.js\");\nconst errors_1 = __webpack_require__(/*! ./errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js\");\nconst index_1 = __webpack_require__(/*! ./providers/index */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/index.js\");\nconst state_machine_1 = __webpack_require__(/*! ./state_machine */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/state_machine.js\");\n/**\n * @public\n * The public interface for explicit in-use encryption\n */\nclass ClientEncryption {\n    /** @internal */\n    static getMongoCrypt() {\n        const encryption = (0, deps_1.getMongoDBClientEncryption)();\n        if ('kModuleError' in encryption) {\n            throw encryption.kModuleError;\n        }\n        return encryption.MongoCrypt;\n    }\n    /**\n     * Create a new encryption instance\n     *\n     * @example\n     * ```ts\n     * new ClientEncryption(mongoClient, {\n     *   keyVaultNamespace: 'client.encryption',\n     *   kmsProviders: {\n     *     local: {\n     *       key: masterKey // The master key used for encryption/decryption. A 96-byte long Buffer\n     *     }\n     *   }\n     * });\n     * ```\n     *\n     * @example\n     * ```ts\n     * new ClientEncryption(mongoClient, {\n     *   keyVaultNamespace: 'client.encryption',\n     *   kmsProviders: {\n     *     aws: {\n     *       accessKeyId: AWS_ACCESS_KEY,\n     *       secretAccessKey: AWS_SECRET_KEY\n     *     }\n     *   }\n     * });\n     * ```\n     */\n    constructor(client, options) {\n        this._client = client;\n        this._proxyOptions = options.proxyOptions ?? {};\n        this._tlsOptions = options.tlsOptions ?? {};\n        this._kmsProviders = options.kmsProviders || {};\n        const { timeoutMS } = (0, utils_1.resolveTimeoutOptions)(client, options);\n        this._timeoutMS = timeoutMS;\n        this._credentialProviders = options.credentialProviders;\n        if (options.credentialProviders?.aws && !(0, index_1.isEmptyCredentials)('aws', this._kmsProviders)) {\n            throw new errors_1.MongoCryptInvalidArgumentError('Can only provide a custom AWS credential provider when the state machine is configured for automatic AWS credential fetching');\n        }\n        if (options.keyVaultNamespace == null) {\n            throw new errors_1.MongoCryptInvalidArgumentError('Missing required option `keyVaultNamespace`');\n        }\n        const mongoCryptOptions = {\n            ...options,\n            cryptoCallbacks,\n            kmsProviders: !Buffer.isBuffer(this._kmsProviders)\n                ? (0, bson_1.serialize)(this._kmsProviders)\n                : this._kmsProviders\n        };\n        this._keyVaultNamespace = options.keyVaultNamespace;\n        this._keyVaultClient = options.keyVaultClient || client;\n        const MongoCrypt = ClientEncryption.getMongoCrypt();\n        this._mongoCrypt = new MongoCrypt(mongoCryptOptions);\n    }\n    /**\n     * Creates a data key used for explicit encryption and inserts it into the key vault namespace\n     *\n     * @example\n     * ```ts\n     * // Using async/await to create a local key\n     * const dataKeyId = await clientEncryption.createDataKey('local');\n     * ```\n     *\n     * @example\n     * ```ts\n     * // Using async/await to create an aws key\n     * const dataKeyId = await clientEncryption.createDataKey('aws', {\n     *   masterKey: {\n     *     region: 'us-east-1',\n     *     key: 'xxxxxxxxxxxxxx' // CMK ARN here\n     *   }\n     * });\n     * ```\n     *\n     * @example\n     * ```ts\n     * // Using async/await to create an aws key with a keyAltName\n     * const dataKeyId = await clientEncryption.createDataKey('aws', {\n     *   masterKey: {\n     *     region: 'us-east-1',\n     *     key: 'xxxxxxxxxxxxxx' // CMK ARN here\n     *   },\n     *   keyAltNames: [ 'mySpecialKey' ]\n     * });\n     * ```\n     */\n    async createDataKey(provider, options = {}) {\n        if (options.keyAltNames && !Array.isArray(options.keyAltNames)) {\n            throw new errors_1.MongoCryptInvalidArgumentError(`Option \"keyAltNames\" must be an array of strings, but was of type ${typeof options.keyAltNames}.`);\n        }\n        let keyAltNames = undefined;\n        if (options.keyAltNames && options.keyAltNames.length > 0) {\n            keyAltNames = options.keyAltNames.map((keyAltName, i) => {\n                if (typeof keyAltName !== 'string') {\n                    throw new errors_1.MongoCryptInvalidArgumentError(`Option \"keyAltNames\" must be an array of strings, but item at index ${i} was of type ${typeof keyAltName}`);\n                }\n                return (0, bson_1.serialize)({ keyAltName });\n            });\n        }\n        let keyMaterial = undefined;\n        if (options.keyMaterial) {\n            keyMaterial = (0, bson_1.serialize)({ keyMaterial: options.keyMaterial });\n        }\n        const dataKeyBson = (0, bson_1.serialize)({\n            provider,\n            ...options.masterKey\n        });\n        const context = this._mongoCrypt.makeDataKeyContext(dataKeyBson, {\n            keyAltNames,\n            keyMaterial\n        });\n        const stateMachine = new state_machine_1.StateMachine({\n            proxyOptions: this._proxyOptions,\n            tlsOptions: this._tlsOptions,\n            socketOptions: autoSelectSocketOptions(this._client.s.options)\n        });\n        const timeoutContext = options?.timeoutContext ??\n            timeout_1.TimeoutContext.create((0, utils_1.resolveTimeoutOptions)(this._client, { timeoutMS: this._timeoutMS }));\n        const dataKey = (0, bson_1.deserialize)(await stateMachine.execute(this, context, { timeoutContext }));\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        const { insertedId } = await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .insertOne(dataKey, {\n            writeConcern: { w: 'majority' },\n            timeoutMS: timeoutContext?.csotEnabled()\n                ? timeoutContext?.getRemainingTimeMSOrThrow()\n                : undefined\n        });\n        return insertedId;\n    }\n    /**\n     * Searches the keyvault for any data keys matching the provided filter.  If there are matches, rewrapManyDataKey then attempts to re-wrap the data keys using the provided options.\n     *\n     * If no matches are found, then no bulk write is performed.\n     *\n     * @example\n     * ```ts\n     * // rewrapping all data data keys (using a filter that matches all documents)\n     * const filter = {};\n     *\n     * const result = await clientEncryption.rewrapManyDataKey(filter);\n     * if (result.bulkWriteResult != null) {\n     *  // keys were re-wrapped, results will be available in the bulkWrite object.\n     * }\n     * ```\n     *\n     * @example\n     * ```ts\n     * // attempting to rewrap all data keys with no matches\n     * const filter = { _id: new Binary() } // assume _id matches no documents in the database\n     * const result = await clientEncryption.rewrapManyDataKey(filter);\n     *\n     * if (result.bulkWriteResult == null) {\n     *  // no keys matched, `bulkWriteResult` does not exist on the result object\n     * }\n     * ```\n     */\n    async rewrapManyDataKey(filter, options) {\n        let keyEncryptionKeyBson = undefined;\n        if (options) {\n            const keyEncryptionKey = Object.assign({ provider: options.provider }, options.masterKey);\n            keyEncryptionKeyBson = (0, bson_1.serialize)(keyEncryptionKey);\n        }\n        const filterBson = (0, bson_1.serialize)(filter);\n        const context = this._mongoCrypt.makeRewrapManyDataKeyContext(filterBson, keyEncryptionKeyBson);\n        const stateMachine = new state_machine_1.StateMachine({\n            proxyOptions: this._proxyOptions,\n            tlsOptions: this._tlsOptions,\n            socketOptions: autoSelectSocketOptions(this._client.s.options)\n        });\n        const timeoutContext = timeout_1.TimeoutContext.create((0, utils_1.resolveTimeoutOptions)(this._client, { timeoutMS: this._timeoutMS }));\n        const { v: dataKeys } = (0, bson_1.deserialize)(await stateMachine.execute(this, context, { timeoutContext }));\n        if (dataKeys.length === 0) {\n            return {};\n        }\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        const replacements = dataKeys.map((key) => ({\n            updateOne: {\n                filter: { _id: key._id },\n                update: {\n                    $set: {\n                        masterKey: key.masterKey,\n                        keyMaterial: key.keyMaterial\n                    },\n                    $currentDate: {\n                        updateDate: true\n                    }\n                }\n            }\n        }));\n        const result = await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .bulkWrite(replacements, {\n            writeConcern: { w: 'majority' },\n            timeoutMS: timeoutContext.csotEnabled() ? timeoutContext?.remainingTimeMS : undefined\n        });\n        return { bulkWriteResult: result };\n    }\n    /**\n     * Deletes the key with the provided id from the keyvault, if it exists.\n     *\n     * @example\n     * ```ts\n     * // delete a key by _id\n     * const id = new Binary(); // id is a bson binary subtype 4 object\n     * const { deletedCount } = await clientEncryption.deleteKey(id);\n     *\n     * if (deletedCount != null && deletedCount > 0) {\n     *   // successful deletion\n     * }\n     * ```\n     *\n     */\n    async deleteKey(_id) {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        return await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .deleteOne({ _id }, { writeConcern: { w: 'majority' }, timeoutMS: this._timeoutMS });\n    }\n    /**\n     * Finds all the keys currently stored in the keyvault.\n     *\n     * This method will not throw.\n     *\n     * @returns a FindCursor over all keys in the keyvault.\n     * @example\n     * ```ts\n     * // fetching all keys\n     * const keys = await clientEncryption.getKeys().toArray();\n     * ```\n     */\n    getKeys() {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        return this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .find({}, { readConcern: { level: 'majority' }, timeoutMS: this._timeoutMS });\n    }\n    /**\n     * Finds a key in the keyvault with the specified _id.\n     *\n     * Returns a promise that either resolves to a {@link DataKey} if a document matches the key or null if no documents\n     * match the id.  The promise rejects with an error if an error is thrown.\n     * @example\n     * ```ts\n     * // getting a key by id\n     * const id = new Binary(); // id is a bson binary subtype 4 object\n     * const key = await clientEncryption.getKey(id);\n     * if (!key) {\n     *  // key is null if there was no matching key\n     * }\n     * ```\n     */\n    async getKey(_id) {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        return await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .findOne({ _id }, { readConcern: { level: 'majority' }, timeoutMS: this._timeoutMS });\n    }\n    /**\n     * Finds a key in the keyvault which has the specified keyAltName.\n     *\n     * @param keyAltName - a keyAltName to search for a key\n     * @returns Returns a promise that either resolves to a {@link DataKey} if a document matches the key or null if no documents\n     * match the keyAltName.  The promise rejects with an error if an error is thrown.\n     * @example\n     * ```ts\n     * // get a key by alt name\n     * const keyAltName = 'keyAltName';\n     * const key = await clientEncryption.getKeyByAltName(keyAltName);\n     * if (!key) {\n     *  // key is null if there is no matching key\n     * }\n     * ```\n     */\n    async getKeyByAltName(keyAltName) {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        return await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .findOne({ keyAltNames: keyAltName }, { readConcern: { level: 'majority' }, timeoutMS: this._timeoutMS });\n    }\n    /**\n     * Adds a keyAltName to a key identified by the provided _id.\n     *\n     * This method resolves to/returns the *old* key value (prior to adding the new altKeyName).\n     *\n     * @param _id - The id of the document to update.\n     * @param keyAltName - a keyAltName to search for a key\n     * @returns Returns a promise that either resolves to a {@link DataKey} if a document matches the key or null if no documents\n     * match the id.  The promise rejects with an error if an error is thrown.\n     * @example\n     * ```ts\n     * // adding an keyAltName to a data key\n     * const id = new Binary();  // id is a bson binary subtype 4 object\n     * const keyAltName = 'keyAltName';\n     * const oldKey = await clientEncryption.addKeyAltName(id, keyAltName);\n     * if (!oldKey) {\n     *  // null is returned if there is no matching document with an id matching the supplied id\n     * }\n     * ```\n     */\n    async addKeyAltName(_id, keyAltName) {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        const value = await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .findOneAndUpdate({ _id }, { $addToSet: { keyAltNames: keyAltName } }, { writeConcern: { w: 'majority' }, returnDocument: 'before', timeoutMS: this._timeoutMS });\n        return value;\n    }\n    /**\n     * Adds a keyAltName to a key identified by the provided _id.\n     *\n     * This method resolves to/returns the *old* key value (prior to removing the new altKeyName).\n     *\n     * If the removed keyAltName is the last keyAltName for that key, the `altKeyNames` property is unset from the document.\n     *\n     * @param _id - The id of the document to update.\n     * @param keyAltName - a keyAltName to search for a key\n     * @returns Returns a promise that either resolves to a {@link DataKey} if a document matches the key or null if no documents\n     * match the id.  The promise rejects with an error if an error is thrown.\n     * @example\n     * ```ts\n     * // removing a key alt name from a data key\n     * const id = new Binary();  // id is a bson binary subtype 4 object\n     * const keyAltName = 'keyAltName';\n     * const oldKey = await clientEncryption.removeKeyAltName(id, keyAltName);\n     *\n     * if (!oldKey) {\n     *  // null is returned if there is no matching document with an id matching the supplied id\n     * }\n     * ```\n     */\n    async removeKeyAltName(_id, keyAltName) {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(this._keyVaultNamespace);\n        const pipeline = [\n            {\n                $set: {\n                    keyAltNames: {\n                        $cond: [\n                            {\n                                $eq: ['$keyAltNames', [keyAltName]]\n                            },\n                            '$$REMOVE',\n                            {\n                                $filter: {\n                                    input: '$keyAltNames',\n                                    cond: {\n                                        $ne: ['$$this', keyAltName]\n                                    }\n                                }\n                            }\n                        ]\n                    }\n                }\n            }\n        ];\n        const value = await this._keyVaultClient\n            .db(dbName)\n            .collection(collectionName)\n            .findOneAndUpdate({ _id }, pipeline, {\n            writeConcern: { w: 'majority' },\n            returnDocument: 'before',\n            timeoutMS: this._timeoutMS\n        });\n        return value;\n    }\n    /**\n     * A convenience method for creating an encrypted collection.\n     * This method will create data keys for any encryptedFields that do not have a `keyId` defined\n     * and then create a new collection with the full set of encryptedFields.\n     *\n     * @param db - A Node.js driver Db object with which to create the collection\n     * @param name - The name of the collection to be created\n     * @param options - Options for createDataKey and for createCollection\n     * @returns created collection and generated encryptedFields\n     * @throws MongoCryptCreateDataKeyError - If part way through the process a createDataKey invocation fails, an error will be rejected that has the partial `encryptedFields` that were created.\n     * @throws MongoCryptCreateEncryptedCollectionError - If creating the collection fails, an error will be rejected that has the entire `encryptedFields` that were created.\n     */\n    async createEncryptedCollection(db, name, options) {\n        const { provider, masterKey, createCollectionOptions: { encryptedFields: { ...encryptedFields }, ...createCollectionOptions } } = options;\n        const timeoutContext = this._timeoutMS != null\n            ? timeout_1.TimeoutContext.create((0, utils_1.resolveTimeoutOptions)(this._client, { timeoutMS: this._timeoutMS }))\n            : undefined;\n        if (Array.isArray(encryptedFields.fields)) {\n            const createDataKeyPromises = encryptedFields.fields.map(async (field) => field == null || typeof field !== 'object' || field.keyId != null\n                ? field\n                : {\n                    ...field,\n                    keyId: await this.createDataKey(provider, {\n                        masterKey,\n                        // clone the timeoutContext\n                        // in order to avoid sharing the same timeout for server selection and connection checkout across different concurrent operations\n                        timeoutContext: timeoutContext?.csotEnabled() ? timeoutContext?.clone() : undefined\n                    })\n                });\n            const createDataKeyResolutions = await Promise.allSettled(createDataKeyPromises);\n            encryptedFields.fields = createDataKeyResolutions.map((resolution, index) => resolution.status === 'fulfilled' ? resolution.value : encryptedFields.fields[index]);\n            const rejection = createDataKeyResolutions.find((result) => result.status === 'rejected');\n            if (rejection != null) {\n                throw new errors_1.MongoCryptCreateDataKeyError(encryptedFields, { cause: rejection.reason });\n            }\n        }\n        try {\n            const collection = await db.createCollection(name, {\n                ...createCollectionOptions,\n                encryptedFields,\n                timeoutMS: timeoutContext?.csotEnabled()\n                    ? timeoutContext?.getRemainingTimeMSOrThrow()\n                    : undefined\n            });\n            return { collection, encryptedFields };\n        }\n        catch (cause) {\n            throw new errors_1.MongoCryptCreateEncryptedCollectionError(encryptedFields, { cause });\n        }\n    }\n    /**\n     * Explicitly encrypt a provided value. Note that either `options.keyId` or `options.keyAltName` must\n     * be specified. Specifying both `options.keyId` and `options.keyAltName` is considered an error.\n     *\n     * @param value - The value that you wish to serialize. Must be of a type that can be serialized into BSON\n     * @param options -\n     * @returns a Promise that either resolves with the encrypted value, or rejects with an error.\n     *\n     * @example\n     * ```ts\n     * // Encryption with async/await api\n     * async function encryptMyData(value) {\n     *   const keyId = await clientEncryption.createDataKey('local');\n     *   return clientEncryption.encrypt(value, { keyId, algorithm: 'AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic' });\n     * }\n     * ```\n     *\n     * @example\n     * ```ts\n     * // Encryption using a keyAltName\n     * async function encryptMyData(value) {\n     *   await clientEncryption.createDataKey('local', { keyAltNames: 'mySpecialKey' });\n     *   return clientEncryption.encrypt(value, { keyAltName: 'mySpecialKey', algorithm: 'AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic' });\n     * }\n     * ```\n     */\n    async encrypt(value, options) {\n        return await this._encrypt(value, false, options);\n    }\n    /**\n     * Encrypts a Match Expression or Aggregate Expression to query a range index.\n     *\n     * Only supported when queryType is \"range\" and algorithm is \"Range\".\n     *\n     * @param expression - a BSON document of one of the following forms:\n     *  1. A Match Expression of this form:\n     *      `{$and: [{<field>: {$gt: <value1>}}, {<field>: {$lt: <value2> }}]}`\n     *  2. An Aggregate Expression of this form:\n     *      `{$and: [{$gt: [<fieldpath>, <value1>]}, {$lt: [<fieldpath>, <value2>]}]}`\n     *\n     *    `$gt` may also be `$gte`. `$lt` may also be `$lte`.\n     *\n     * @param options -\n     * @returns Returns a Promise that either resolves with the encrypted value or rejects with an error.\n     */\n    async encryptExpression(expression, options) {\n        return await this._encrypt(expression, true, options);\n    }\n    /**\n     * Explicitly decrypt a provided encrypted value\n     *\n     * @param value - An encrypted value\n     * @returns a Promise that either resolves with the decrypted value, or rejects with an error\n     *\n     * @example\n     * ```ts\n     * // Decrypting value with async/await API\n     * async function decryptMyValue(value) {\n     *   return clientEncryption.decrypt(value);\n     * }\n     * ```\n     */\n    async decrypt(value) {\n        const valueBuffer = (0, bson_1.serialize)({ v: value });\n        const context = this._mongoCrypt.makeExplicitDecryptionContext(valueBuffer);\n        const stateMachine = new state_machine_1.StateMachine({\n            proxyOptions: this._proxyOptions,\n            tlsOptions: this._tlsOptions,\n            socketOptions: autoSelectSocketOptions(this._client.s.options)\n        });\n        const timeoutContext = this._timeoutMS != null\n            ? timeout_1.TimeoutContext.create((0, utils_1.resolveTimeoutOptions)(this._client, { timeoutMS: this._timeoutMS }))\n            : undefined;\n        const { v } = (0, bson_1.deserialize)(await stateMachine.execute(this, context, { timeoutContext }));\n        return v;\n    }\n    /**\n     * @internal\n     * Ask the user for KMS credentials.\n     *\n     * This returns anything that looks like the kmsProviders original input\n     * option. It can be empty, and any provider specified here will override\n     * the original ones.\n     */\n    async askForKMSCredentials() {\n        return await (0, index_1.refreshKMSCredentials)(this._kmsProviders, this._credentialProviders);\n    }\n    static get libmongocryptVersion() {\n        return ClientEncryption.getMongoCrypt().libmongocryptVersion;\n    }\n    /**\n     * @internal\n     * A helper that perform explicit encryption of values and expressions.\n     * Explicitly encrypt a provided value. Note that either `options.keyId` or `options.keyAltName` must\n     * be specified. Specifying both `options.keyId` and `options.keyAltName` is considered an error.\n     *\n     * @param value - The value that you wish to encrypt. Must be of a type that can be serialized into BSON\n     * @param expressionMode - a boolean that indicates whether or not to encrypt the value as an expression\n     * @param options - options to pass to encrypt\n     * @returns the raw result of the call to stateMachine.execute().  When expressionMode is set to true, the return\n     *          value will be a bson document.  When false, the value will be a BSON Binary.\n     *\n     */\n    async _encrypt(value, expressionMode, options) {\n        const { algorithm, keyId, keyAltName, contentionFactor, queryType, rangeOptions } = options;\n        const contextOptions = {\n            expressionMode,\n            algorithm\n        };\n        if (keyId) {\n            contextOptions.keyId = keyId.buffer;\n        }\n        if (keyAltName) {\n            if (keyId) {\n                throw new errors_1.MongoCryptInvalidArgumentError(`\"options\" cannot contain both \"keyId\" and \"keyAltName\"`);\n            }\n            if (typeof keyAltName !== 'string') {\n                throw new errors_1.MongoCryptInvalidArgumentError(`\"options.keyAltName\" must be of type string, but was of type ${typeof keyAltName}`);\n            }\n            contextOptions.keyAltName = (0, bson_1.serialize)({ keyAltName });\n        }\n        if (typeof contentionFactor === 'number' || typeof contentionFactor === 'bigint') {\n            contextOptions.contentionFactor = contentionFactor;\n        }\n        if (typeof queryType === 'string') {\n            contextOptions.queryType = queryType;\n        }\n        if (typeof rangeOptions === 'object') {\n            contextOptions.rangeOptions = (0, bson_1.serialize)(rangeOptions);\n        }\n        const valueBuffer = (0, bson_1.serialize)({ v: value });\n        const stateMachine = new state_machine_1.StateMachine({\n            proxyOptions: this._proxyOptions,\n            tlsOptions: this._tlsOptions,\n            socketOptions: autoSelectSocketOptions(this._client.s.options)\n        });\n        const context = this._mongoCrypt.makeExplicitEncryptionContext(valueBuffer, contextOptions);\n        const timeoutContext = this._timeoutMS != null\n            ? timeout_1.TimeoutContext.create((0, utils_1.resolveTimeoutOptions)(this._client, { timeoutMS: this._timeoutMS }))\n            : undefined;\n        const { v } = (0, bson_1.deserialize)(await stateMachine.execute(this, context, { timeoutContext }));\n        return v;\n    }\n}\nexports.ClientEncryption = ClientEncryption;\n/**\n * Get the socket options from the client.\n * @param baseOptions - The mongo client options.\n * @returns ClientEncryptionSocketOptions\n */\nfunction autoSelectSocketOptions(baseOptions) {\n    const options = { autoSelectFamily: true };\n    if ('autoSelectFamily' in baseOptions) {\n        options.autoSelectFamily = baseOptions.autoSelectFamily;\n    }\n    if ('autoSelectFamilyAttemptTimeout' in baseOptions) {\n        options.autoSelectFamilyAttemptTimeout = baseOptions.autoSelectFamilyAttemptTimeout;\n    }\n    return options;\n}\n//# sourceMappingURL=client_encryption.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vY2xpZW50X2VuY3J5cHRpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLCtCQUErQjtBQUMvQixlQUFlLG1CQUFPLENBQUMsMkZBQVM7QUFDaEMsZUFBZSxtQkFBTyxDQUFDLDJGQUFTO0FBQ2hDLGtCQUFrQixtQkFBTyxDQUFDLGlHQUFZO0FBQ3RDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLHdCQUF3QixtQkFBTyxDQUFDLHlJQUFvQjtBQUNwRCxpQkFBaUIsbUJBQU8sQ0FBQyxxSEFBVTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyx1SUFBbUI7QUFDM0Msd0JBQXdCLG1CQUFPLENBQUMsbUlBQWlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixZQUFZO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0EsbUlBQW1JLDJCQUEyQjtBQUM5SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNklBQTZJLEdBQUcsY0FBYyxrQkFBa0I7QUFDaEw7QUFDQSwrQ0FBK0MsWUFBWTtBQUMzRCxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELGtDQUFrQztBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSwrRkFBK0YsNEJBQTRCO0FBQzNILDRGQUE0RixnQkFBZ0I7QUFDNUcsZ0JBQWdCLHlDQUF5QztBQUN6RCxnQkFBZ0IsYUFBYTtBQUM3QjtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsZUFBZTtBQUMzQztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9CQUFvQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCw0QkFBNEI7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxrSEFBa0gsNEJBQTRCO0FBQzlJLGdCQUFnQixjQUFjLHNFQUFzRSxnQkFBZ0I7QUFDcEg7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlDQUF5QztBQUN6RDtBQUNBO0FBQ0EsMEJBQTBCLGNBQWM7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixlQUFlO0FBQzNDO0FBQ0EsU0FBUztBQUNULGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQyxlQUFlLGVBQWU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5Q0FBeUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLEtBQUssSUFBSSxnQkFBZ0IsZUFBZSw4QkFBOEI7QUFDL0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5Q0FBeUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLElBQUksZUFBZSxtQkFBbUIsOEJBQThCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELGVBQWU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IseUNBQXlDO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixLQUFLLElBQUksZUFBZSxtQkFBbUIsOEJBQThCO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQsZUFBZTtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IseUNBQXlDO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix5QkFBeUIsSUFBSSxlQUFlLG1CQUFtQiw4QkFBOEI7QUFDcEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxlQUFlO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IseUNBQXlDO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxLQUFLLElBQUksYUFBYSwyQkFBMkIsSUFBSSxnQkFBZ0IsZUFBZSx3REFBd0Q7QUFDNUs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxlQUFlO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5Q0FBeUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxLQUFLO0FBQ3JDLDRCQUE0QixlQUFlO0FBQzNDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGdEQUFnRCxtQkFBbUIsb0JBQW9CLGlDQUFpQztBQUN4STtBQUNBLGlHQUFpRyw0QkFBNEI7QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRkFBbUYseUJBQXlCO0FBQzVHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixxQkFBcUI7QUFDckI7QUFDQTtBQUNBLDJGQUEyRixPQUFPO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxpRUFBaUU7QUFDbkg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsNkJBQTZCO0FBQ3RGLGtEQUFrRCxzRkFBc0Y7QUFDeEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLFFBQVEsVUFBVSxlQUFlLEdBQUcsVUFBVSxnQkFBZ0IsRUFBRTtBQUM5RTtBQUNBLGNBQWMsUUFBUSw2QkFBNkIsR0FBRyw2QkFBNkIsRUFBRTtBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsVUFBVTtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsaUdBQWlHLDRCQUE0QjtBQUM3SDtBQUNBLGdCQUFnQixJQUFJLHNFQUFzRSxnQkFBZ0I7QUFDMUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBFQUEwRTtBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrSUFBa0ksa0JBQWtCO0FBQ3BKO0FBQ0EsZ0VBQWdFLFlBQVk7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsVUFBVTtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsaUdBQWlHLDRCQUE0QjtBQUM3SDtBQUNBLGdCQUFnQixJQUFJLHNFQUFzRSxnQkFBZ0I7QUFDMUc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbGllbnQtc2lkZS1lbmNyeXB0aW9uL2NsaWVudF9lbmNyeXB0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DbGllbnRFbmNyeXB0aW9uID0gdm9pZCAwO1xuZXhwb3J0cy5hdXRvU2VsZWN0U29ja2V0T3B0aW9ucyA9IGF1dG9TZWxlY3RTb2NrZXRPcHRpb25zO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vZGVwc1wiKTtcbmNvbnN0IHRpbWVvdXRfMSA9IHJlcXVpcmUoXCIuLi90aW1lb3V0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNyeXB0b0NhbGxiYWNrcyA9IHJlcXVpcmUoXCIuL2NyeXB0b19jYWxsYmFja3NcIik7XG5jb25zdCBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuL2Vycm9yc1wiKTtcbmNvbnN0IGluZGV4XzEgPSByZXF1aXJlKFwiLi9wcm92aWRlcnMvaW5kZXhcIik7XG5jb25zdCBzdGF0ZV9tYWNoaW5lXzEgPSByZXF1aXJlKFwiLi9zdGF0ZV9tYWNoaW5lXCIpO1xuLyoqXG4gKiBAcHVibGljXG4gKiBUaGUgcHVibGljIGludGVyZmFjZSBmb3IgZXhwbGljaXQgaW4tdXNlIGVuY3J5cHRpb25cbiAqL1xuY2xhc3MgQ2xpZW50RW5jcnlwdGlvbiB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBnZXRNb25nb0NyeXB0KCkge1xuICAgICAgICBjb25zdCBlbmNyeXB0aW9uID0gKDAsIGRlcHNfMS5nZXRNb25nb0RCQ2xpZW50RW5jcnlwdGlvbikoKTtcbiAgICAgICAgaWYgKCdrTW9kdWxlRXJyb3InIGluIGVuY3J5cHRpb24pIHtcbiAgICAgICAgICAgIHRocm93IGVuY3J5cHRpb24ua01vZHVsZUVycm9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbmNyeXB0aW9uLk1vbmdvQ3J5cHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBlbmNyeXB0aW9uIGluc3RhbmNlXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogbmV3IENsaWVudEVuY3J5cHRpb24obW9uZ29DbGllbnQsIHtcbiAgICAgKiAgIGtleVZhdWx0TmFtZXNwYWNlOiAnY2xpZW50LmVuY3J5cHRpb24nLFxuICAgICAqICAga21zUHJvdmlkZXJzOiB7XG4gICAgICogICAgIGxvY2FsOiB7XG4gICAgICogICAgICAga2V5OiBtYXN0ZXJLZXkgLy8gVGhlIG1hc3RlciBrZXkgdXNlZCBmb3IgZW5jcnlwdGlvbi9kZWNyeXB0aW9uLiBBIDk2LWJ5dGUgbG9uZyBCdWZmZXJcbiAgICAgKiAgICAgfVxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIG5ldyBDbGllbnRFbmNyeXB0aW9uKG1vbmdvQ2xpZW50LCB7XG4gICAgICogICBrZXlWYXVsdE5hbWVzcGFjZTogJ2NsaWVudC5lbmNyeXB0aW9uJyxcbiAgICAgKiAgIGttc1Byb3ZpZGVyczoge1xuICAgICAqICAgICBhd3M6IHtcbiAgICAgKiAgICAgICBhY2Nlc3NLZXlJZDogQVdTX0FDQ0VTU19LRVksXG4gICAgICogICAgICAgc2VjcmV0QWNjZXNzS2V5OiBBV1NfU0VDUkVUX0tFWVxuICAgICAqICAgICB9XG4gICAgICogICB9XG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2xpZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX2NsaWVudCA9IGNsaWVudDtcbiAgICAgICAgdGhpcy5fcHJveHlPcHRpb25zID0gb3B0aW9ucy5wcm94eU9wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuX3Rsc09wdGlvbnMgPSBvcHRpb25zLnRsc09wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuX2ttc1Byb3ZpZGVycyA9IG9wdGlvbnMua21zUHJvdmlkZXJzIHx8IHt9O1xuICAgICAgICBjb25zdCB7IHRpbWVvdXRNUyB9ID0gKDAsIHV0aWxzXzEucmVzb2x2ZVRpbWVvdXRPcHRpb25zKShjbGllbnQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLl90aW1lb3V0TVMgPSB0aW1lb3V0TVM7XG4gICAgICAgIHRoaXMuX2NyZWRlbnRpYWxQcm92aWRlcnMgPSBvcHRpb25zLmNyZWRlbnRpYWxQcm92aWRlcnM7XG4gICAgICAgIGlmIChvcHRpb25zLmNyZWRlbnRpYWxQcm92aWRlcnM/LmF3cyAmJiAhKDAsIGluZGV4XzEuaXNFbXB0eUNyZWRlbnRpYWxzKSgnYXdzJywgdGhpcy5fa21zUHJvdmlkZXJzKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRJbnZhbGlkQXJndW1lbnRFcnJvcignQ2FuIG9ubHkgcHJvdmlkZSBhIGN1c3RvbSBBV1MgY3JlZGVudGlhbCBwcm92aWRlciB3aGVuIHRoZSBzdGF0ZSBtYWNoaW5lIGlzIGNvbmZpZ3VyZWQgZm9yIGF1dG9tYXRpYyBBV1MgY3JlZGVudGlhbCBmZXRjaGluZycpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmtleVZhdWx0TmFtZXNwYWNlID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcnNfMS5Nb25nb0NyeXB0SW52YWxpZEFyZ3VtZW50RXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgb3B0aW9uIGBrZXlWYXVsdE5hbWVzcGFjZWAnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtb25nb0NyeXB0T3B0aW9ucyA9IHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBjcnlwdG9DYWxsYmFja3MsXG4gICAgICAgICAgICBrbXNQcm92aWRlcnM6ICFCdWZmZXIuaXNCdWZmZXIodGhpcy5fa21zUHJvdmlkZXJzKVxuICAgICAgICAgICAgICAgID8gKDAsIGJzb25fMS5zZXJpYWxpemUpKHRoaXMuX2ttc1Byb3ZpZGVycylcbiAgICAgICAgICAgICAgICA6IHRoaXMuX2ttc1Byb3ZpZGVyc1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9rZXlWYXVsdE5hbWVzcGFjZSA9IG9wdGlvbnMua2V5VmF1bHROYW1lc3BhY2U7XG4gICAgICAgIHRoaXMuX2tleVZhdWx0Q2xpZW50ID0gb3B0aW9ucy5rZXlWYXVsdENsaWVudCB8fCBjbGllbnQ7XG4gICAgICAgIGNvbnN0IE1vbmdvQ3J5cHQgPSBDbGllbnRFbmNyeXB0aW9uLmdldE1vbmdvQ3J5cHQoKTtcbiAgICAgICAgdGhpcy5fbW9uZ29DcnlwdCA9IG5ldyBNb25nb0NyeXB0KG1vbmdvQ3J5cHRPcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGRhdGEga2V5IHVzZWQgZm9yIGV4cGxpY2l0IGVuY3J5cHRpb24gYW5kIGluc2VydHMgaXQgaW50byB0aGUga2V5IHZhdWx0IG5hbWVzcGFjZVxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIC8vIFVzaW5nIGFzeW5jL2F3YWl0IHRvIGNyZWF0ZSBhIGxvY2FsIGtleVxuICAgICAqIGNvbnN0IGRhdGFLZXlJZCA9IGF3YWl0IGNsaWVudEVuY3J5cHRpb24uY3JlYXRlRGF0YUtleSgnbG9jYWwnKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiAvLyBVc2luZyBhc3luYy9hd2FpdCB0byBjcmVhdGUgYW4gYXdzIGtleVxuICAgICAqIGNvbnN0IGRhdGFLZXlJZCA9IGF3YWl0IGNsaWVudEVuY3J5cHRpb24uY3JlYXRlRGF0YUtleSgnYXdzJywge1xuICAgICAqICAgbWFzdGVyS2V5OiB7XG4gICAgICogICAgIHJlZ2lvbjogJ3VzLWVhc3QtMScsXG4gICAgICogICAgIGtleTogJ3h4eHh4eHh4eHh4eHh4JyAvLyBDTUsgQVJOIGhlcmVcbiAgICAgKiAgIH1cbiAgICAgKiB9KTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiAvLyBVc2luZyBhc3luYy9hd2FpdCB0byBjcmVhdGUgYW4gYXdzIGtleSB3aXRoIGEga2V5QWx0TmFtZVxuICAgICAqIGNvbnN0IGRhdGFLZXlJZCA9IGF3YWl0IGNsaWVudEVuY3J5cHRpb24uY3JlYXRlRGF0YUtleSgnYXdzJywge1xuICAgICAqICAgbWFzdGVyS2V5OiB7XG4gICAgICogICAgIHJlZ2lvbjogJ3VzLWVhc3QtMScsXG4gICAgICogICAgIGtleTogJ3h4eHh4eHh4eHh4eHh4JyAvLyBDTUsgQVJOIGhlcmVcbiAgICAgKiAgIH0sXG4gICAgICogICBrZXlBbHROYW1lczogWyAnbXlTcGVjaWFsS2V5JyBdXG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlRGF0YUtleShwcm92aWRlciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGlmIChvcHRpb25zLmtleUFsdE5hbWVzICYmICFBcnJheS5pc0FycmF5KG9wdGlvbnMua2V5QWx0TmFtZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yKGBPcHRpb24gXCJrZXlBbHROYW1lc1wiIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncywgYnV0IHdhcyBvZiB0eXBlICR7dHlwZW9mIG9wdGlvbnMua2V5QWx0TmFtZXN9LmApO1xuICAgICAgICB9XG4gICAgICAgIGxldCBrZXlBbHROYW1lcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG9wdGlvbnMua2V5QWx0TmFtZXMgJiYgb3B0aW9ucy5rZXlBbHROYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBrZXlBbHROYW1lcyA9IG9wdGlvbnMua2V5QWx0TmFtZXMubWFwKChrZXlBbHROYW1lLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXlBbHROYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yKGBPcHRpb24gXCJrZXlBbHROYW1lc1wiIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncywgYnV0IGl0ZW0gYXQgaW5kZXggJHtpfSB3YXMgb2YgdHlwZSAke3R5cGVvZiBrZXlBbHROYW1lfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIGJzb25fMS5zZXJpYWxpemUpKHsga2V5QWx0TmFtZSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGxldCBrZXlNYXRlcmlhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG9wdGlvbnMua2V5TWF0ZXJpYWwpIHtcbiAgICAgICAgICAgIGtleU1hdGVyaWFsID0gKDAsIGJzb25fMS5zZXJpYWxpemUpKHsga2V5TWF0ZXJpYWw6IG9wdGlvbnMua2V5TWF0ZXJpYWwgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0YUtleUJzb24gPSAoMCwgYnNvbl8xLnNlcmlhbGl6ZSkoe1xuICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAuLi5vcHRpb25zLm1hc3RlcktleVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXMuX21vbmdvQ3J5cHQubWFrZURhdGFLZXlDb250ZXh0KGRhdGFLZXlCc29uLCB7XG4gICAgICAgICAgICBrZXlBbHROYW1lcyxcbiAgICAgICAgICAgIGtleU1hdGVyaWFsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzdGF0ZU1hY2hpbmUgPSBuZXcgc3RhdGVfbWFjaGluZV8xLlN0YXRlTWFjaGluZSh7XG4gICAgICAgICAgICBwcm94eU9wdGlvbnM6IHRoaXMuX3Byb3h5T3B0aW9ucyxcbiAgICAgICAgICAgIHRsc09wdGlvbnM6IHRoaXMuX3Rsc09wdGlvbnMsXG4gICAgICAgICAgICBzb2NrZXRPcHRpb25zOiBhdXRvU2VsZWN0U29ja2V0T3B0aW9ucyh0aGlzLl9jbGllbnQucy5vcHRpb25zKVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdGltZW91dENvbnRleHQgPSBvcHRpb25zPy50aW1lb3V0Q29udGV4dCA/P1xuICAgICAgICAgICAgdGltZW91dF8xLlRpbWVvdXRDb250ZXh0LmNyZWF0ZSgoMCwgdXRpbHNfMS5yZXNvbHZlVGltZW91dE9wdGlvbnMpKHRoaXMuX2NsaWVudCwgeyB0aW1lb3V0TVM6IHRoaXMuX3RpbWVvdXRNUyB9KSk7XG4gICAgICAgIGNvbnN0IGRhdGFLZXkgPSAoMCwgYnNvbl8xLmRlc2VyaWFsaXplKShhd2FpdCBzdGF0ZU1hY2hpbmUuZXhlY3V0ZSh0aGlzLCBjb250ZXh0LCB7IHRpbWVvdXRDb250ZXh0IH0pKTtcbiAgICAgICAgY29uc3QgeyBkYjogZGJOYW1lLCBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uTmFtZSB9ID0gdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZS5mcm9tU3RyaW5nKHRoaXMuX2tleVZhdWx0TmFtZXNwYWNlKTtcbiAgICAgICAgY29uc3QgeyBpbnNlcnRlZElkIH0gPSBhd2FpdCB0aGlzLl9rZXlWYXVsdENsaWVudFxuICAgICAgICAgICAgLmRiKGRiTmFtZSlcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lKVxuICAgICAgICAgICAgLmluc2VydE9uZShkYXRhS2V5LCB7XG4gICAgICAgICAgICB3cml0ZUNvbmNlcm46IHsgdzogJ21ham9yaXR5JyB9LFxuICAgICAgICAgICAgdGltZW91dE1TOiB0aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKVxuICAgICAgICAgICAgICAgID8gdGltZW91dENvbnRleHQ/LmdldFJlbWFpbmluZ1RpbWVNU09yVGhyb3coKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW5zZXJ0ZWRJZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VhcmNoZXMgdGhlIGtleXZhdWx0IGZvciBhbnkgZGF0YSBrZXlzIG1hdGNoaW5nIHRoZSBwcm92aWRlZCBmaWx0ZXIuICBJZiB0aGVyZSBhcmUgbWF0Y2hlcywgcmV3cmFwTWFueURhdGFLZXkgdGhlbiBhdHRlbXB0cyB0byByZS13cmFwIHRoZSBkYXRhIGtleXMgdXNpbmcgdGhlIHByb3ZpZGVkIG9wdGlvbnMuXG4gICAgICpcbiAgICAgKiBJZiBubyBtYXRjaGVzIGFyZSBmb3VuZCwgdGhlbiBubyBidWxrIHdyaXRlIGlzIHBlcmZvcm1lZC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiAvLyByZXdyYXBwaW5nIGFsbCBkYXRhIGRhdGEga2V5cyAodXNpbmcgYSBmaWx0ZXIgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMpXG4gICAgICogY29uc3QgZmlsdGVyID0ge307XG4gICAgICpcbiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnRFbmNyeXB0aW9uLnJld3JhcE1hbnlEYXRhS2V5KGZpbHRlcik7XG4gICAgICogaWYgKHJlc3VsdC5idWxrV3JpdGVSZXN1bHQgIT0gbnVsbCkge1xuICAgICAqICAvLyBrZXlzIHdlcmUgcmUtd3JhcHBlZCwgcmVzdWx0cyB3aWxsIGJlIGF2YWlsYWJsZSBpbiB0aGUgYnVsa1dyaXRlIG9iamVjdC5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gYXR0ZW1wdGluZyB0byByZXdyYXAgYWxsIGRhdGEga2V5cyB3aXRoIG5vIG1hdGNoZXNcbiAgICAgKiBjb25zdCBmaWx0ZXIgPSB7IF9pZDogbmV3IEJpbmFyeSgpIH0gLy8gYXNzdW1lIF9pZCBtYXRjaGVzIG5vIGRvY3VtZW50cyBpbiB0aGUgZGF0YWJhc2VcbiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnRFbmNyeXB0aW9uLnJld3JhcE1hbnlEYXRhS2V5KGZpbHRlcik7XG4gICAgICpcbiAgICAgKiBpZiAocmVzdWx0LmJ1bGtXcml0ZVJlc3VsdCA9PSBudWxsKSB7XG4gICAgICogIC8vIG5vIGtleXMgbWF0Y2hlZCwgYGJ1bGtXcml0ZVJlc3VsdGAgZG9lcyBub3QgZXhpc3Qgb24gdGhlIHJlc3VsdCBvYmplY3RcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYXN5bmMgcmV3cmFwTWFueURhdGFLZXkoZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIGxldCBrZXlFbmNyeXB0aW9uS2V5QnNvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleUVuY3J5cHRpb25LZXkgPSBPYmplY3QuYXNzaWduKHsgcHJvdmlkZXI6IG9wdGlvbnMucHJvdmlkZXIgfSwgb3B0aW9ucy5tYXN0ZXJLZXkpO1xuICAgICAgICAgICAga2V5RW5jcnlwdGlvbktleUJzb24gPSAoMCwgYnNvbl8xLnNlcmlhbGl6ZSkoa2V5RW5jcnlwdGlvbktleSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsdGVyQnNvbiA9ICgwLCBic29uXzEuc2VyaWFsaXplKShmaWx0ZXIpO1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5fbW9uZ29DcnlwdC5tYWtlUmV3cmFwTWFueURhdGFLZXlDb250ZXh0KGZpbHRlckJzb24sIGtleUVuY3J5cHRpb25LZXlCc29uKTtcbiAgICAgICAgY29uc3Qgc3RhdGVNYWNoaW5lID0gbmV3IHN0YXRlX21hY2hpbmVfMS5TdGF0ZU1hY2hpbmUoe1xuICAgICAgICAgICAgcHJveHlPcHRpb25zOiB0aGlzLl9wcm94eU9wdGlvbnMsXG4gICAgICAgICAgICB0bHNPcHRpb25zOiB0aGlzLl90bHNPcHRpb25zLFxuICAgICAgICAgICAgc29ja2V0T3B0aW9uczogYXV0b1NlbGVjdFNvY2tldE9wdGlvbnModGhpcy5fY2xpZW50LnMub3B0aW9ucylcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRDb250ZXh0ID0gdGltZW91dF8xLlRpbWVvdXRDb250ZXh0LmNyZWF0ZSgoMCwgdXRpbHNfMS5yZXNvbHZlVGltZW91dE9wdGlvbnMpKHRoaXMuX2NsaWVudCwgeyB0aW1lb3V0TVM6IHRoaXMuX3RpbWVvdXRNUyB9KSk7XG4gICAgICAgIGNvbnN0IHsgdjogZGF0YUtleXMgfSA9ICgwLCBic29uXzEuZGVzZXJpYWxpemUpKGF3YWl0IHN0YXRlTWFjaGluZS5leGVjdXRlKHRoaXMsIGNvbnRleHQsIHsgdGltZW91dENvbnRleHQgfSkpO1xuICAgICAgICBpZiAoZGF0YUtleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBkYjogZGJOYW1lLCBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uTmFtZSB9ID0gdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZS5mcm9tU3RyaW5nKHRoaXMuX2tleVZhdWx0TmFtZXNwYWNlKTtcbiAgICAgICAgY29uc3QgcmVwbGFjZW1lbnRzID0gZGF0YUtleXMubWFwKChrZXkpID0+ICh7XG4gICAgICAgICAgICB1cGRhdGVPbmU6IHtcbiAgICAgICAgICAgICAgICBmaWx0ZXI6IHsgX2lkOiBrZXkuX2lkIH0sXG4gICAgICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICRzZXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hc3RlcktleToga2V5Lm1hc3RlcktleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleU1hdGVyaWFsOiBrZXkua2V5TWF0ZXJpYWxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnREYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVEYXRlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fa2V5VmF1bHRDbGllbnRcbiAgICAgICAgICAgIC5kYihkYk5hbWUpXG4gICAgICAgICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSlcbiAgICAgICAgICAgIC5idWxrV3JpdGUocmVwbGFjZW1lbnRzLCB7XG4gICAgICAgICAgICB3cml0ZUNvbmNlcm46IHsgdzogJ21ham9yaXR5JyB9LFxuICAgICAgICAgICAgdGltZW91dE1TOiB0aW1lb3V0Q29udGV4dC5jc290RW5hYmxlZCgpID8gdGltZW91dENvbnRleHQ/LnJlbWFpbmluZ1RpbWVNUyA6IHVuZGVmaW5lZFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgYnVsa1dyaXRlUmVzdWx0OiByZXN1bHQgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlcyB0aGUga2V5IHdpdGggdGhlIHByb3ZpZGVkIGlkIGZyb20gdGhlIGtleXZhdWx0LCBpZiBpdCBleGlzdHMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gZGVsZXRlIGEga2V5IGJ5IF9pZFxuICAgICAqIGNvbnN0IGlkID0gbmV3IEJpbmFyeSgpOyAvLyBpZCBpcyBhIGJzb24gYmluYXJ5IHN1YnR5cGUgNCBvYmplY3RcbiAgICAgKiBjb25zdCB7IGRlbGV0ZWRDb3VudCB9ID0gYXdhaXQgY2xpZW50RW5jcnlwdGlvbi5kZWxldGVLZXkoaWQpO1xuICAgICAqXG4gICAgICogaWYgKGRlbGV0ZWRDb3VudCAhPSBudWxsICYmIGRlbGV0ZWRDb3VudCA+IDApIHtcbiAgICAgKiAgIC8vIHN1Y2Nlc3NmdWwgZGVsZXRpb25cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKi9cbiAgICBhc3luYyBkZWxldGVLZXkoX2lkKSB7XG4gICAgICAgIGNvbnN0IHsgZGI6IGRiTmFtZSwgY29sbGVjdGlvbjogY29sbGVjdGlvbk5hbWUgfSA9IHV0aWxzXzEuTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UuZnJvbVN0cmluZyh0aGlzLl9rZXlWYXVsdE5hbWVzcGFjZSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9rZXlWYXVsdENsaWVudFxuICAgICAgICAgICAgLmRiKGRiTmFtZSlcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lKVxuICAgICAgICAgICAgLmRlbGV0ZU9uZSh7IF9pZCB9LCB7IHdyaXRlQ29uY2VybjogeyB3OiAnbWFqb3JpdHknIH0sIHRpbWVvdXRNUzogdGhpcy5fdGltZW91dE1TIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5kcyBhbGwgdGhlIGtleXMgY3VycmVudGx5IHN0b3JlZCBpbiB0aGUga2V5dmF1bHQuXG4gICAgICpcbiAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIG5vdCB0aHJvdy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEgRmluZEN1cnNvciBvdmVyIGFsbCBrZXlzIGluIHRoZSBrZXl2YXVsdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gZmV0Y2hpbmcgYWxsIGtleXNcbiAgICAgKiBjb25zdCBrZXlzID0gYXdhaXQgY2xpZW50RW5jcnlwdGlvbi5nZXRLZXlzKCkudG9BcnJheSgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGdldEtleXMoKSB7XG4gICAgICAgIGNvbnN0IHsgZGI6IGRiTmFtZSwgY29sbGVjdGlvbjogY29sbGVjdGlvbk5hbWUgfSA9IHV0aWxzXzEuTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UuZnJvbVN0cmluZyh0aGlzLl9rZXlWYXVsdE5hbWVzcGFjZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXlWYXVsdENsaWVudFxuICAgICAgICAgICAgLmRiKGRiTmFtZSlcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lKVxuICAgICAgICAgICAgLmZpbmQoe30sIHsgcmVhZENvbmNlcm46IHsgbGV2ZWw6ICdtYWpvcml0eScgfSwgdGltZW91dE1TOiB0aGlzLl90aW1lb3V0TVMgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpbmRzIGEga2V5IGluIHRoZSBrZXl2YXVsdCB3aXRoIHRoZSBzcGVjaWZpZWQgX2lkLlxuICAgICAqXG4gICAgICogUmV0dXJucyBhIHByb21pc2UgdGhhdCBlaXRoZXIgcmVzb2x2ZXMgdG8gYSB7QGxpbmsgRGF0YUtleX0gaWYgYSBkb2N1bWVudCBtYXRjaGVzIHRoZSBrZXkgb3IgbnVsbCBpZiBubyBkb2N1bWVudHNcbiAgICAgKiBtYXRjaCB0aGUgaWQuICBUaGUgcHJvbWlzZSByZWplY3RzIHdpdGggYW4gZXJyb3IgaWYgYW4gZXJyb3IgaXMgdGhyb3duLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiAvLyBnZXR0aW5nIGEga2V5IGJ5IGlkXG4gICAgICogY29uc3QgaWQgPSBuZXcgQmluYXJ5KCk7IC8vIGlkIGlzIGEgYnNvbiBiaW5hcnkgc3VidHlwZSA0IG9iamVjdFxuICAgICAqIGNvbnN0IGtleSA9IGF3YWl0IGNsaWVudEVuY3J5cHRpb24uZ2V0S2V5KGlkKTtcbiAgICAgKiBpZiAoIWtleSkge1xuICAgICAqICAvLyBrZXkgaXMgbnVsbCBpZiB0aGVyZSB3YXMgbm8gbWF0Y2hpbmcga2V5XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFzeW5jIGdldEtleShfaWQpIHtcbiAgICAgICAgY29uc3QgeyBkYjogZGJOYW1lLCBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uTmFtZSB9ID0gdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZS5mcm9tU3RyaW5nKHRoaXMuX2tleVZhdWx0TmFtZXNwYWNlKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2tleVZhdWx0Q2xpZW50XG4gICAgICAgICAgICAuZGIoZGJOYW1lKVxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpXG4gICAgICAgICAgICAuZmluZE9uZSh7IF9pZCB9LCB7IHJlYWRDb25jZXJuOiB7IGxldmVsOiAnbWFqb3JpdHknIH0sIHRpbWVvdXRNUzogdGhpcy5fdGltZW91dE1TIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5kcyBhIGtleSBpbiB0aGUga2V5dmF1bHQgd2hpY2ggaGFzIHRoZSBzcGVjaWZpZWQga2V5QWx0TmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBrZXlBbHROYW1lIC0gYSBrZXlBbHROYW1lIHRvIHNlYXJjaCBmb3IgYSBrZXlcbiAgICAgKiBAcmV0dXJucyBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IGVpdGhlciByZXNvbHZlcyB0byBhIHtAbGluayBEYXRhS2V5fSBpZiBhIGRvY3VtZW50IG1hdGNoZXMgdGhlIGtleSBvciBudWxsIGlmIG5vIGRvY3VtZW50c1xuICAgICAqIG1hdGNoIHRoZSBrZXlBbHROYW1lLiAgVGhlIHByb21pc2UgcmVqZWN0cyB3aXRoIGFuIGVycm9yIGlmIGFuIGVycm9yIGlzIHRocm93bi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gZ2V0IGEga2V5IGJ5IGFsdCBuYW1lXG4gICAgICogY29uc3Qga2V5QWx0TmFtZSA9ICdrZXlBbHROYW1lJztcbiAgICAgKiBjb25zdCBrZXkgPSBhd2FpdCBjbGllbnRFbmNyeXB0aW9uLmdldEtleUJ5QWx0TmFtZShrZXlBbHROYW1lKTtcbiAgICAgKiBpZiAoIWtleSkge1xuICAgICAqICAvLyBrZXkgaXMgbnVsbCBpZiB0aGVyZSBpcyBubyBtYXRjaGluZyBrZXlcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYXN5bmMgZ2V0S2V5QnlBbHROYW1lKGtleUFsdE5hbWUpIHtcbiAgICAgICAgY29uc3QgeyBkYjogZGJOYW1lLCBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uTmFtZSB9ID0gdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZS5mcm9tU3RyaW5nKHRoaXMuX2tleVZhdWx0TmFtZXNwYWNlKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2tleVZhdWx0Q2xpZW50XG4gICAgICAgICAgICAuZGIoZGJOYW1lKVxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpXG4gICAgICAgICAgICAuZmluZE9uZSh7IGtleUFsdE5hbWVzOiBrZXlBbHROYW1lIH0sIHsgcmVhZENvbmNlcm46IHsgbGV2ZWw6ICdtYWpvcml0eScgfSwgdGltZW91dE1TOiB0aGlzLl90aW1lb3V0TVMgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBrZXlBbHROYW1lIHRvIGEga2V5IGlkZW50aWZpZWQgYnkgdGhlIHByb3ZpZGVkIF9pZC5cbiAgICAgKlxuICAgICAqIFRoaXMgbWV0aG9kIHJlc29sdmVzIHRvL3JldHVybnMgdGhlICpvbGQqIGtleSB2YWx1ZSAocHJpb3IgdG8gYWRkaW5nIHRoZSBuZXcgYWx0S2V5TmFtZSkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gX2lkIC0gVGhlIGlkIG9mIHRoZSBkb2N1bWVudCB0byB1cGRhdGUuXG4gICAgICogQHBhcmFtIGtleUFsdE5hbWUgLSBhIGtleUFsdE5hbWUgdG8gc2VhcmNoIGZvciBhIGtleVxuICAgICAqIEByZXR1cm5zIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZWl0aGVyIHJlc29sdmVzIHRvIGEge0BsaW5rIERhdGFLZXl9IGlmIGEgZG9jdW1lbnQgbWF0Y2hlcyB0aGUga2V5IG9yIG51bGwgaWYgbm8gZG9jdW1lbnRzXG4gICAgICogbWF0Y2ggdGhlIGlkLiAgVGhlIHByb21pc2UgcmVqZWN0cyB3aXRoIGFuIGVycm9yIGlmIGFuIGVycm9yIGlzIHRocm93bi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gYWRkaW5nIGFuIGtleUFsdE5hbWUgdG8gYSBkYXRhIGtleVxuICAgICAqIGNvbnN0IGlkID0gbmV3IEJpbmFyeSgpOyAgLy8gaWQgaXMgYSBic29uIGJpbmFyeSBzdWJ0eXBlIDQgb2JqZWN0XG4gICAgICogY29uc3Qga2V5QWx0TmFtZSA9ICdrZXlBbHROYW1lJztcbiAgICAgKiBjb25zdCBvbGRLZXkgPSBhd2FpdCBjbGllbnRFbmNyeXB0aW9uLmFkZEtleUFsdE5hbWUoaWQsIGtleUFsdE5hbWUpO1xuICAgICAqIGlmICghb2xkS2V5KSB7XG4gICAgICogIC8vIG51bGwgaXMgcmV0dXJuZWQgaWYgdGhlcmUgaXMgbm8gbWF0Y2hpbmcgZG9jdW1lbnQgd2l0aCBhbiBpZCBtYXRjaGluZyB0aGUgc3VwcGxpZWQgaWRcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYXN5bmMgYWRkS2V5QWx0TmFtZShfaWQsIGtleUFsdE5hbWUpIHtcbiAgICAgICAgY29uc3QgeyBkYjogZGJOYW1lLCBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uTmFtZSB9ID0gdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZS5mcm9tU3RyaW5nKHRoaXMuX2tleVZhdWx0TmFtZXNwYWNlKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLl9rZXlWYXVsdENsaWVudFxuICAgICAgICAgICAgLmRiKGRiTmFtZSlcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lKVxuICAgICAgICAgICAgLmZpbmRPbmVBbmRVcGRhdGUoeyBfaWQgfSwgeyAkYWRkVG9TZXQ6IHsga2V5QWx0TmFtZXM6IGtleUFsdE5hbWUgfSB9LCB7IHdyaXRlQ29uY2VybjogeyB3OiAnbWFqb3JpdHknIH0sIHJldHVybkRvY3VtZW50OiAnYmVmb3JlJywgdGltZW91dE1TOiB0aGlzLl90aW1lb3V0TVMgfSk7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIGtleUFsdE5hbWUgdG8gYSBrZXkgaWRlbnRpZmllZCBieSB0aGUgcHJvdmlkZWQgX2lkLlxuICAgICAqXG4gICAgICogVGhpcyBtZXRob2QgcmVzb2x2ZXMgdG8vcmV0dXJucyB0aGUgKm9sZCoga2V5IHZhbHVlIChwcmlvciB0byByZW1vdmluZyB0aGUgbmV3IGFsdEtleU5hbWUpLlxuICAgICAqXG4gICAgICogSWYgdGhlIHJlbW92ZWQga2V5QWx0TmFtZSBpcyB0aGUgbGFzdCBrZXlBbHROYW1lIGZvciB0aGF0IGtleSwgdGhlIGBhbHRLZXlOYW1lc2AgcHJvcGVydHkgaXMgdW5zZXQgZnJvbSB0aGUgZG9jdW1lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gX2lkIC0gVGhlIGlkIG9mIHRoZSBkb2N1bWVudCB0byB1cGRhdGUuXG4gICAgICogQHBhcmFtIGtleUFsdE5hbWUgLSBhIGtleUFsdE5hbWUgdG8gc2VhcmNoIGZvciBhIGtleVxuICAgICAqIEByZXR1cm5zIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZWl0aGVyIHJlc29sdmVzIHRvIGEge0BsaW5rIERhdGFLZXl9IGlmIGEgZG9jdW1lbnQgbWF0Y2hlcyB0aGUga2V5IG9yIG51bGwgaWYgbm8gZG9jdW1lbnRzXG4gICAgICogbWF0Y2ggdGhlIGlkLiAgVGhlIHByb21pc2UgcmVqZWN0cyB3aXRoIGFuIGVycm9yIGlmIGFuIGVycm9yIGlzIHRocm93bi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gcmVtb3ZpbmcgYSBrZXkgYWx0IG5hbWUgZnJvbSBhIGRhdGEga2V5XG4gICAgICogY29uc3QgaWQgPSBuZXcgQmluYXJ5KCk7ICAvLyBpZCBpcyBhIGJzb24gYmluYXJ5IHN1YnR5cGUgNCBvYmplY3RcbiAgICAgKiBjb25zdCBrZXlBbHROYW1lID0gJ2tleUFsdE5hbWUnO1xuICAgICAqIGNvbnN0IG9sZEtleSA9IGF3YWl0IGNsaWVudEVuY3J5cHRpb24ucmVtb3ZlS2V5QWx0TmFtZShpZCwga2V5QWx0TmFtZSk7XG4gICAgICpcbiAgICAgKiBpZiAoIW9sZEtleSkge1xuICAgICAqICAvLyBudWxsIGlzIHJldHVybmVkIGlmIHRoZXJlIGlzIG5vIG1hdGNoaW5nIGRvY3VtZW50IHdpdGggYW4gaWQgbWF0Y2hpbmcgdGhlIHN1cHBsaWVkIGlkXG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFzeW5jIHJlbW92ZUtleUFsdE5hbWUoX2lkLCBrZXlBbHROYW1lKSB7XG4gICAgICAgIGNvbnN0IHsgZGI6IGRiTmFtZSwgY29sbGVjdGlvbjogY29sbGVjdGlvbk5hbWUgfSA9IHV0aWxzXzEuTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UuZnJvbVN0cmluZyh0aGlzLl9rZXlWYXVsdE5hbWVzcGFjZSk7XG4gICAgICAgIGNvbnN0IHBpcGVsaW5lID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICRzZXQ6IHtcbiAgICAgICAgICAgICAgICAgICAga2V5QWx0TmFtZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb25kOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXE6IFsnJGtleUFsdE5hbWVzJywgW2tleUFsdE5hbWVdXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyQkUkVNT1ZFJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiAnJGtleUFsdE5hbWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmU6IFsnJCR0aGlzJywga2V5QWx0TmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLl9rZXlWYXVsdENsaWVudFxuICAgICAgICAgICAgLmRiKGRiTmFtZSlcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lKVxuICAgICAgICAgICAgLmZpbmRPbmVBbmRVcGRhdGUoeyBfaWQgfSwgcGlwZWxpbmUsIHtcbiAgICAgICAgICAgIHdyaXRlQ29uY2VybjogeyB3OiAnbWFqb3JpdHknIH0sXG4gICAgICAgICAgICByZXR1cm5Eb2N1bWVudDogJ2JlZm9yZScsXG4gICAgICAgICAgICB0aW1lb3V0TVM6IHRoaXMuX3RpbWVvdXRNU1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIGNvbnZlbmllbmNlIG1ldGhvZCBmb3IgY3JlYXRpbmcgYW4gZW5jcnlwdGVkIGNvbGxlY3Rpb24uXG4gICAgICogVGhpcyBtZXRob2Qgd2lsbCBjcmVhdGUgZGF0YSBrZXlzIGZvciBhbnkgZW5jcnlwdGVkRmllbGRzIHRoYXQgZG8gbm90IGhhdmUgYSBga2V5SWRgIGRlZmluZWRcbiAgICAgKiBhbmQgdGhlbiBjcmVhdGUgYSBuZXcgY29sbGVjdGlvbiB3aXRoIHRoZSBmdWxsIHNldCBvZiBlbmNyeXB0ZWRGaWVsZHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGIgLSBBIE5vZGUuanMgZHJpdmVyIERiIG9iamVjdCB3aXRoIHdoaWNoIHRvIGNyZWF0ZSB0aGUgY29sbGVjdGlvblxuICAgICAqIEBwYXJhbSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGNvbGxlY3Rpb24gdG8gYmUgY3JlYXRlZFxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgY3JlYXRlRGF0YUtleSBhbmQgZm9yIGNyZWF0ZUNvbGxlY3Rpb25cbiAgICAgKiBAcmV0dXJucyBjcmVhdGVkIGNvbGxlY3Rpb24gYW5kIGdlbmVyYXRlZCBlbmNyeXB0ZWRGaWVsZHNcbiAgICAgKiBAdGhyb3dzIE1vbmdvQ3J5cHRDcmVhdGVEYXRhS2V5RXJyb3IgLSBJZiBwYXJ0IHdheSB0aHJvdWdoIHRoZSBwcm9jZXNzIGEgY3JlYXRlRGF0YUtleSBpbnZvY2F0aW9uIGZhaWxzLCBhbiBlcnJvciB3aWxsIGJlIHJlamVjdGVkIHRoYXQgaGFzIHRoZSBwYXJ0aWFsIGBlbmNyeXB0ZWRGaWVsZHNgIHRoYXQgd2VyZSBjcmVhdGVkLlxuICAgICAqIEB0aHJvd3MgTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvciAtIElmIGNyZWF0aW5nIHRoZSBjb2xsZWN0aW9uIGZhaWxzLCBhbiBlcnJvciB3aWxsIGJlIHJlamVjdGVkIHRoYXQgaGFzIHRoZSBlbnRpcmUgYGVuY3J5cHRlZEZpZWxkc2AgdGhhdCB3ZXJlIGNyZWF0ZWQuXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlRW5jcnlwdGVkQ29sbGVjdGlvbihkYiwgbmFtZSwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCB7IHByb3ZpZGVyLCBtYXN0ZXJLZXksIGNyZWF0ZUNvbGxlY3Rpb25PcHRpb25zOiB7IGVuY3J5cHRlZEZpZWxkczogeyAuLi5lbmNyeXB0ZWRGaWVsZHMgfSwgLi4uY3JlYXRlQ29sbGVjdGlvbk9wdGlvbnMgfSB9ID0gb3B0aW9ucztcbiAgICAgICAgY29uc3QgdGltZW91dENvbnRleHQgPSB0aGlzLl90aW1lb3V0TVMgIT0gbnVsbFxuICAgICAgICAgICAgPyB0aW1lb3V0XzEuVGltZW91dENvbnRleHQuY3JlYXRlKCgwLCB1dGlsc18xLnJlc29sdmVUaW1lb3V0T3B0aW9ucykodGhpcy5fY2xpZW50LCB7IHRpbWVvdXRNUzogdGhpcy5fdGltZW91dE1TIH0pKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGVuY3J5cHRlZEZpZWxkcy5maWVsZHMpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVEYXRhS2V5UHJvbWlzZXMgPSBlbmNyeXB0ZWRGaWVsZHMuZmllbGRzLm1hcChhc3luYyAoZmllbGQpID0+IGZpZWxkID09IG51bGwgfHwgdHlwZW9mIGZpZWxkICE9PSAnb2JqZWN0JyB8fCBmaWVsZC5rZXlJZCAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBmaWVsZFxuICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAga2V5SWQ6IGF3YWl0IHRoaXMuY3JlYXRlRGF0YUtleShwcm92aWRlciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFzdGVyS2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvbmUgdGhlIHRpbWVvdXRDb250ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbiBvcmRlciB0byBhdm9pZCBzaGFyaW5nIHRoZSBzYW1lIHRpbWVvdXQgZm9yIHNlcnZlciBzZWxlY3Rpb24gYW5kIGNvbm5lY3Rpb24gY2hlY2tvdXQgYWNyb3NzIGRpZmZlcmVudCBjb25jdXJyZW50IG9wZXJhdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRDb250ZXh0OiB0aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKSA/IHRpbWVvdXRDb250ZXh0Py5jbG9uZSgpIDogdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVEYXRhS2V5UmVzb2x1dGlvbnMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoY3JlYXRlRGF0YUtleVByb21pc2VzKTtcbiAgICAgICAgICAgIGVuY3J5cHRlZEZpZWxkcy5maWVsZHMgPSBjcmVhdGVEYXRhS2V5UmVzb2x1dGlvbnMubWFwKChyZXNvbHV0aW9uLCBpbmRleCkgPT4gcmVzb2x1dGlvbi5zdGF0dXMgPT09ICdmdWxmaWxsZWQnID8gcmVzb2x1dGlvbi52YWx1ZSA6IGVuY3J5cHRlZEZpZWxkcy5maWVsZHNbaW5kZXhdKTtcbiAgICAgICAgICAgIGNvbnN0IHJlamVjdGlvbiA9IGNyZWF0ZURhdGFLZXlSZXNvbHV0aW9ucy5maW5kKChyZXN1bHQpID0+IHJlc3VsdC5zdGF0dXMgPT09ICdyZWplY3RlZCcpO1xuICAgICAgICAgICAgaWYgKHJlamVjdGlvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRDcmVhdGVEYXRhS2V5RXJyb3IoZW5jcnlwdGVkRmllbGRzLCB7IGNhdXNlOiByZWplY3Rpb24ucmVhc29uIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZGIuY3JlYXRlQ29sbGVjdGlvbihuYW1lLCB7XG4gICAgICAgICAgICAgICAgLi4uY3JlYXRlQ29sbGVjdGlvbk9wdGlvbnMsXG4gICAgICAgICAgICAgICAgZW5jcnlwdGVkRmllbGRzLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRNUzogdGltZW91dENvbnRleHQ/LmNzb3RFbmFibGVkKClcbiAgICAgICAgICAgICAgICAgICAgPyB0aW1lb3V0Q29udGV4dD8uZ2V0UmVtYWluaW5nVGltZU1TT3JUaHJvdygpXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB7IGNvbGxlY3Rpb24sIGVuY3J5cHRlZEZpZWxkcyB9O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRDcmVhdGVFbmNyeXB0ZWRDb2xsZWN0aW9uRXJyb3IoZW5jcnlwdGVkRmllbGRzLCB7IGNhdXNlIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4cGxpY2l0bHkgZW5jcnlwdCBhIHByb3ZpZGVkIHZhbHVlLiBOb3RlIHRoYXQgZWl0aGVyIGBvcHRpb25zLmtleUlkYCBvciBgb3B0aW9ucy5rZXlBbHROYW1lYCBtdXN0XG4gICAgICogYmUgc3BlY2lmaWVkLiBTcGVjaWZ5aW5nIGJvdGggYG9wdGlvbnMua2V5SWRgIGFuZCBgb3B0aW9ucy5rZXlBbHROYW1lYCBpcyBjb25zaWRlcmVkIGFuIGVycm9yLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRoYXQgeW91IHdpc2ggdG8gc2VyaWFsaXplLiBNdXN0IGJlIG9mIGEgdHlwZSB0aGF0IGNhbiBiZSBzZXJpYWxpemVkIGludG8gQlNPTlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC1cbiAgICAgKiBAcmV0dXJucyBhIFByb21pc2UgdGhhdCBlaXRoZXIgcmVzb2x2ZXMgd2l0aCB0aGUgZW5jcnlwdGVkIHZhbHVlLCBvciByZWplY3RzIHdpdGggYW4gZXJyb3IuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogLy8gRW5jcnlwdGlvbiB3aXRoIGFzeW5jL2F3YWl0IGFwaVxuICAgICAqIGFzeW5jIGZ1bmN0aW9uIGVuY3J5cHRNeURhdGEodmFsdWUpIHtcbiAgICAgKiAgIGNvbnN0IGtleUlkID0gYXdhaXQgY2xpZW50RW5jcnlwdGlvbi5jcmVhdGVEYXRhS2V5KCdsb2NhbCcpO1xuICAgICAqICAgcmV0dXJuIGNsaWVudEVuY3J5cHRpb24uZW5jcnlwdCh2YWx1ZSwgeyBrZXlJZCwgYWxnb3JpdGhtOiAnQUVBRF9BRVNfMjU2X0NCQ19ITUFDX1NIQV81MTItRGV0ZXJtaW5pc3RpYycgfSk7XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIC8vIEVuY3J5cHRpb24gdXNpbmcgYSBrZXlBbHROYW1lXG4gICAgICogYXN5bmMgZnVuY3Rpb24gZW5jcnlwdE15RGF0YSh2YWx1ZSkge1xuICAgICAqICAgYXdhaXQgY2xpZW50RW5jcnlwdGlvbi5jcmVhdGVEYXRhS2V5KCdsb2NhbCcsIHsga2V5QWx0TmFtZXM6ICdteVNwZWNpYWxLZXknIH0pO1xuICAgICAqICAgcmV0dXJuIGNsaWVudEVuY3J5cHRpb24uZW5jcnlwdCh2YWx1ZSwgeyBrZXlBbHROYW1lOiAnbXlTcGVjaWFsS2V5JywgYWxnb3JpdGhtOiAnQUVBRF9BRVNfMjU2X0NCQ19ITUFDX1NIQV81MTItRGV0ZXJtaW5pc3RpYycgfSk7XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFzeW5jIGVuY3J5cHQodmFsdWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2VuY3J5cHQodmFsdWUsIGZhbHNlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5jcnlwdHMgYSBNYXRjaCBFeHByZXNzaW9uIG9yIEFnZ3JlZ2F0ZSBFeHByZXNzaW9uIHRvIHF1ZXJ5IGEgcmFuZ2UgaW5kZXguXG4gICAgICpcbiAgICAgKiBPbmx5IHN1cHBvcnRlZCB3aGVuIHF1ZXJ5VHlwZSBpcyBcInJhbmdlXCIgYW5kIGFsZ29yaXRobSBpcyBcIlJhbmdlXCIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXhwcmVzc2lvbiAtIGEgQlNPTiBkb2N1bWVudCBvZiBvbmUgb2YgdGhlIGZvbGxvd2luZyBmb3JtczpcbiAgICAgKiAgMS4gQSBNYXRjaCBFeHByZXNzaW9uIG9mIHRoaXMgZm9ybTpcbiAgICAgKiAgICAgIGB7JGFuZDogW3s8ZmllbGQ+OiB7JGd0OiA8dmFsdWUxPn19LCB7PGZpZWxkPjogeyRsdDogPHZhbHVlMj4gfX1dfWBcbiAgICAgKiAgMi4gQW4gQWdncmVnYXRlIEV4cHJlc3Npb24gb2YgdGhpcyBmb3JtOlxuICAgICAqICAgICAgYHskYW5kOiBbeyRndDogWzxmaWVsZHBhdGg+LCA8dmFsdWUxPl19LCB7JGx0OiBbPGZpZWxkcGF0aD4sIDx2YWx1ZTI+XX1dfWBcbiAgICAgKlxuICAgICAqICAgIGAkZ3RgIG1heSBhbHNvIGJlIGAkZ3RlYC4gYCRsdGAgbWF5IGFsc28gYmUgYCRsdGVgLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLVxuICAgICAqIEByZXR1cm5zIFJldHVybnMgYSBQcm9taXNlIHRoYXQgZWl0aGVyIHJlc29sdmVzIHdpdGggdGhlIGVuY3J5cHRlZCB2YWx1ZSBvciByZWplY3RzIHdpdGggYW4gZXJyb3IuXG4gICAgICovXG4gICAgYXN5bmMgZW5jcnlwdEV4cHJlc3Npb24oZXhwcmVzc2lvbiwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZW5jcnlwdChleHByZXNzaW9uLCB0cnVlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhwbGljaXRseSBkZWNyeXB0IGEgcHJvdmlkZWQgZW5jcnlwdGVkIHZhbHVlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBBbiBlbmNyeXB0ZWQgdmFsdWVcbiAgICAgKiBAcmV0dXJucyBhIFByb21pc2UgdGhhdCBlaXRoZXIgcmVzb2x2ZXMgd2l0aCB0aGUgZGVjcnlwdGVkIHZhbHVlLCBvciByZWplY3RzIHdpdGggYW4gZXJyb3JcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiAvLyBEZWNyeXB0aW5nIHZhbHVlIHdpdGggYXN5bmMvYXdhaXQgQVBJXG4gICAgICogYXN5bmMgZnVuY3Rpb24gZGVjcnlwdE15VmFsdWUodmFsdWUpIHtcbiAgICAgKiAgIHJldHVybiBjbGllbnRFbmNyeXB0aW9uLmRlY3J5cHQodmFsdWUpO1xuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBhc3luYyBkZWNyeXB0KHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlQnVmZmVyID0gKDAsIGJzb25fMS5zZXJpYWxpemUpKHsgdjogdmFsdWUgfSk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLl9tb25nb0NyeXB0Lm1ha2VFeHBsaWNpdERlY3J5cHRpb25Db250ZXh0KHZhbHVlQnVmZmVyKTtcbiAgICAgICAgY29uc3Qgc3RhdGVNYWNoaW5lID0gbmV3IHN0YXRlX21hY2hpbmVfMS5TdGF0ZU1hY2hpbmUoe1xuICAgICAgICAgICAgcHJveHlPcHRpb25zOiB0aGlzLl9wcm94eU9wdGlvbnMsXG4gICAgICAgICAgICB0bHNPcHRpb25zOiB0aGlzLl90bHNPcHRpb25zLFxuICAgICAgICAgICAgc29ja2V0T3B0aW9uczogYXV0b1NlbGVjdFNvY2tldE9wdGlvbnModGhpcy5fY2xpZW50LnMub3B0aW9ucylcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRDb250ZXh0ID0gdGhpcy5fdGltZW91dE1TICE9IG51bGxcbiAgICAgICAgICAgID8gdGltZW91dF8xLlRpbWVvdXRDb250ZXh0LmNyZWF0ZSgoMCwgdXRpbHNfMS5yZXNvbHZlVGltZW91dE9wdGlvbnMpKHRoaXMuX2NsaWVudCwgeyB0aW1lb3V0TVM6IHRoaXMuX3RpbWVvdXRNUyB9KSlcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCB7IHYgfSA9ICgwLCBic29uXzEuZGVzZXJpYWxpemUpKGF3YWl0IHN0YXRlTWFjaGluZS5leGVjdXRlKHRoaXMsIGNvbnRleHQsIHsgdGltZW91dENvbnRleHQgfSkpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICogQXNrIHRoZSB1c2VyIGZvciBLTVMgY3JlZGVudGlhbHMuXG4gICAgICpcbiAgICAgKiBUaGlzIHJldHVybnMgYW55dGhpbmcgdGhhdCBsb29rcyBsaWtlIHRoZSBrbXNQcm92aWRlcnMgb3JpZ2luYWwgaW5wdXRcbiAgICAgKiBvcHRpb24uIEl0IGNhbiBiZSBlbXB0eSwgYW5kIGFueSBwcm92aWRlciBzcGVjaWZpZWQgaGVyZSB3aWxsIG92ZXJyaWRlXG4gICAgICogdGhlIG9yaWdpbmFsIG9uZXMuXG4gICAgICovXG4gICAgYXN5bmMgYXNrRm9yS01TQ3JlZGVudGlhbHMoKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgaW5kZXhfMS5yZWZyZXNoS01TQ3JlZGVudGlhbHMpKHRoaXMuX2ttc1Byb3ZpZGVycywgdGhpcy5fY3JlZGVudGlhbFByb3ZpZGVycyk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgbGlibW9uZ29jcnlwdFZlcnNpb24oKSB7XG4gICAgICAgIHJldHVybiBDbGllbnRFbmNyeXB0aW9uLmdldE1vbmdvQ3J5cHQoKS5saWJtb25nb2NyeXB0VmVyc2lvbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICogQSBoZWxwZXIgdGhhdCBwZXJmb3JtIGV4cGxpY2l0IGVuY3J5cHRpb24gb2YgdmFsdWVzIGFuZCBleHByZXNzaW9ucy5cbiAgICAgKiBFeHBsaWNpdGx5IGVuY3J5cHQgYSBwcm92aWRlZCB2YWx1ZS4gTm90ZSB0aGF0IGVpdGhlciBgb3B0aW9ucy5rZXlJZGAgb3IgYG9wdGlvbnMua2V5QWx0TmFtZWAgbXVzdFxuICAgICAqIGJlIHNwZWNpZmllZC4gU3BlY2lmeWluZyBib3RoIGBvcHRpb25zLmtleUlkYCBhbmQgYG9wdGlvbnMua2V5QWx0TmFtZWAgaXMgY29uc2lkZXJlZCBhbiBlcnJvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0aGF0IHlvdSB3aXNoIHRvIGVuY3J5cHQuIE11c3QgYmUgb2YgYSB0eXBlIHRoYXQgY2FuIGJlIHNlcmlhbGl6ZWQgaW50byBCU09OXG4gICAgICogQHBhcmFtIGV4cHJlc3Npb25Nb2RlIC0gYSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIGVuY3J5cHQgdGhlIHZhbHVlIGFzIGFuIGV4cHJlc3Npb25cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIG9wdGlvbnMgdG8gcGFzcyB0byBlbmNyeXB0XG4gICAgICogQHJldHVybnMgdGhlIHJhdyByZXN1bHQgb2YgdGhlIGNhbGwgdG8gc3RhdGVNYWNoaW5lLmV4ZWN1dGUoKS4gIFdoZW4gZXhwcmVzc2lvbk1vZGUgaXMgc2V0IHRvIHRydWUsIHRoZSByZXR1cm5cbiAgICAgKiAgICAgICAgICB2YWx1ZSB3aWxsIGJlIGEgYnNvbiBkb2N1bWVudC4gIFdoZW4gZmFsc2UsIHRoZSB2YWx1ZSB3aWxsIGJlIGEgQlNPTiBCaW5hcnkuXG4gICAgICpcbiAgICAgKi9cbiAgICBhc3luYyBfZW5jcnlwdCh2YWx1ZSwgZXhwcmVzc2lvbk1vZGUsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgeyBhbGdvcml0aG0sIGtleUlkLCBrZXlBbHROYW1lLCBjb250ZW50aW9uRmFjdG9yLCBxdWVyeVR5cGUsIHJhbmdlT3B0aW9ucyB9ID0gb3B0aW9ucztcbiAgICAgICAgY29uc3QgY29udGV4dE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBleHByZXNzaW9uTW9kZSxcbiAgICAgICAgICAgIGFsZ29yaXRobVxuICAgICAgICB9O1xuICAgICAgICBpZiAoa2V5SWQpIHtcbiAgICAgICAgICAgIGNvbnRleHRPcHRpb25zLmtleUlkID0ga2V5SWQuYnVmZmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlBbHROYW1lKSB7XG4gICAgICAgICAgICBpZiAoa2V5SWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yKGBcIm9wdGlvbnNcIiBjYW5ub3QgY29udGFpbiBib3RoIFwia2V5SWRcIiBhbmQgXCJrZXlBbHROYW1lXCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Yga2V5QWx0TmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yKGBcIm9wdGlvbnMua2V5QWx0TmFtZVwiIG11c3QgYmUgb2YgdHlwZSBzdHJpbmcsIGJ1dCB3YXMgb2YgdHlwZSAke3R5cGVvZiBrZXlBbHROYW1lfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGV4dE9wdGlvbnMua2V5QWx0TmFtZSA9ICgwLCBic29uXzEuc2VyaWFsaXplKSh7IGtleUFsdE5hbWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjb250ZW50aW9uRmFjdG9yID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgY29udGVudGlvbkZhY3RvciA9PT0gJ2JpZ2ludCcpIHtcbiAgICAgICAgICAgIGNvbnRleHRPcHRpb25zLmNvbnRlbnRpb25GYWN0b3IgPSBjb250ZW50aW9uRmFjdG9yO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcXVlcnlUeXBlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29udGV4dE9wdGlvbnMucXVlcnlUeXBlID0gcXVlcnlUeXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcmFuZ2VPcHRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgY29udGV4dE9wdGlvbnMucmFuZ2VPcHRpb25zID0gKDAsIGJzb25fMS5zZXJpYWxpemUpKHJhbmdlT3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWVCdWZmZXIgPSAoMCwgYnNvbl8xLnNlcmlhbGl6ZSkoeyB2OiB2YWx1ZSB9KTtcbiAgICAgICAgY29uc3Qgc3RhdGVNYWNoaW5lID0gbmV3IHN0YXRlX21hY2hpbmVfMS5TdGF0ZU1hY2hpbmUoe1xuICAgICAgICAgICAgcHJveHlPcHRpb25zOiB0aGlzLl9wcm94eU9wdGlvbnMsXG4gICAgICAgICAgICB0bHNPcHRpb25zOiB0aGlzLl90bHNPcHRpb25zLFxuICAgICAgICAgICAgc29ja2V0T3B0aW9uczogYXV0b1NlbGVjdFNvY2tldE9wdGlvbnModGhpcy5fY2xpZW50LnMub3B0aW9ucylcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLl9tb25nb0NyeXB0Lm1ha2VFeHBsaWNpdEVuY3J5cHRpb25Db250ZXh0KHZhbHVlQnVmZmVyLCBjb250ZXh0T3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRDb250ZXh0ID0gdGhpcy5fdGltZW91dE1TICE9IG51bGxcbiAgICAgICAgICAgID8gdGltZW91dF8xLlRpbWVvdXRDb250ZXh0LmNyZWF0ZSgoMCwgdXRpbHNfMS5yZXNvbHZlVGltZW91dE9wdGlvbnMpKHRoaXMuX2NsaWVudCwgeyB0aW1lb3V0TVM6IHRoaXMuX3RpbWVvdXRNUyB9KSlcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCB7IHYgfSA9ICgwLCBic29uXzEuZGVzZXJpYWxpemUpKGF3YWl0IHN0YXRlTWFjaGluZS5leGVjdXRlKHRoaXMsIGNvbnRleHQsIHsgdGltZW91dENvbnRleHQgfSkpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9XG59XG5leHBvcnRzLkNsaWVudEVuY3J5cHRpb24gPSBDbGllbnRFbmNyeXB0aW9uO1xuLyoqXG4gKiBHZXQgdGhlIHNvY2tldCBvcHRpb25zIGZyb20gdGhlIGNsaWVudC5cbiAqIEBwYXJhbSBiYXNlT3B0aW9ucyAtIFRoZSBtb25nbyBjbGllbnQgb3B0aW9ucy5cbiAqIEByZXR1cm5zIENsaWVudEVuY3J5cHRpb25Tb2NrZXRPcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGF1dG9TZWxlY3RTb2NrZXRPcHRpb25zKGJhc2VPcHRpb25zKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgYXV0b1NlbGVjdEZhbWlseTogdHJ1ZSB9O1xuICAgIGlmICgnYXV0b1NlbGVjdEZhbWlseScgaW4gYmFzZU9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucy5hdXRvU2VsZWN0RmFtaWx5ID0gYmFzZU9wdGlvbnMuYXV0b1NlbGVjdEZhbWlseTtcbiAgICB9XG4gICAgaWYgKCdhdXRvU2VsZWN0RmFtaWx5QXR0ZW1wdFRpbWVvdXQnIGluIGJhc2VPcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMuYXV0b1NlbGVjdEZhbWlseUF0dGVtcHRUaW1lb3V0ID0gYmFzZU9wdGlvbnMuYXV0b1NlbGVjdEZhbWlseUF0dGVtcHRUaW1lb3V0O1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9ucztcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNsaWVudF9lbmNyeXB0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/client_encryption.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/crypto_callbacks.js":
/*!***************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/crypto_callbacks.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.hmacSha256Hook = exports.hmacSha512Hook = exports.aes256CtrDecryptHook = exports.aes256CtrEncryptHook = exports.aes256CbcDecryptHook = exports.aes256CbcEncryptHook = void 0;\nexports.makeAES256Hook = makeAES256Hook;\nexports.randomHook = randomHook;\nexports.sha256Hook = sha256Hook;\nexports.makeHmacHook = makeHmacHook;\nexports.signRsaSha256Hook = signRsaSha256Hook;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nfunction makeAES256Hook(method, mode) {\n    return function (key, iv, input, output) {\n        let result;\n        try {\n            const cipher = crypto[method](mode, key, iv);\n            cipher.setAutoPadding(false);\n            result = cipher.update(input);\n            const final = cipher.final();\n            if (final.length > 0) {\n                result = Buffer.concat([result, final]);\n            }\n        }\n        catch (e) {\n            return e;\n        }\n        result.copy(output);\n        return result.length;\n    };\n}\nfunction randomHook(buffer, count) {\n    try {\n        crypto.randomFillSync(buffer, 0, count);\n    }\n    catch (e) {\n        return e;\n    }\n    return count;\n}\nfunction sha256Hook(input, output) {\n    let result;\n    try {\n        result = crypto.createHash('sha256').update(input).digest();\n    }\n    catch (e) {\n        return e;\n    }\n    result.copy(output);\n    return result.length;\n}\nfunction makeHmacHook(algorithm) {\n    return (key, input, output) => {\n        let result;\n        try {\n            result = crypto.createHmac(algorithm, key).update(input).digest();\n        }\n        catch (e) {\n            return e;\n        }\n        result.copy(output);\n        return result.length;\n    };\n}\nfunction signRsaSha256Hook(key, input, output) {\n    let result;\n    try {\n        const signer = crypto.createSign('sha256WithRSAEncryption');\n        const privateKey = Buffer.from(`-----BEGIN PRIVATE KEY-----\\n${key.toString('base64')}\\n-----END PRIVATE KEY-----\\n`);\n        result = signer.update(input).end().sign(privateKey);\n    }\n    catch (e) {\n        return e;\n    }\n    result.copy(output);\n    return result.length;\n}\nexports.aes256CbcEncryptHook = makeAES256Hook('createCipheriv', 'aes-256-cbc');\nexports.aes256CbcDecryptHook = makeAES256Hook('createDecipheriv', 'aes-256-cbc');\nexports.aes256CtrEncryptHook = makeAES256Hook('createCipheriv', 'aes-256-ctr');\nexports.aes256CtrDecryptHook = makeAES256Hook('createDecipheriv', 'aes-256-ctr');\nexports.hmacSha512Hook = makeHmacHook('sha512');\nexports.hmacSha256Hook = makeHmacHook('sha256');\n//# sourceMappingURL=crypto_callbacks.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vY3J5cHRvX2NhbGxiYWNrcy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxzQkFBc0IsR0FBRyxzQkFBc0IsR0FBRyw0QkFBNEIsR0FBRyw0QkFBNEIsR0FBRyw0QkFBNEIsR0FBRyw0QkFBNEI7QUFDM0ssc0JBQXNCO0FBQ3RCLGtCQUFrQjtBQUNsQixrQkFBa0I7QUFDbEIsb0JBQW9CO0FBQ3BCLHlCQUF5QjtBQUN6QixlQUFlLG1CQUFPLENBQUMsc0JBQVE7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RSx1QkFBdUI7QUFDOUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1Qiw0QkFBNEI7QUFDNUIsNEJBQTRCO0FBQzVCLDRCQUE0QjtBQUM1QixzQkFBc0I7QUFDdEIsc0JBQXNCO0FBQ3RCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY2xpZW50LXNpZGUtZW5jcnlwdGlvbi9jcnlwdG9fY2FsbGJhY2tzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5obWFjU2hhMjU2SG9vayA9IGV4cG9ydHMuaG1hY1NoYTUxMkhvb2sgPSBleHBvcnRzLmFlczI1NkN0ckRlY3J5cHRIb29rID0gZXhwb3J0cy5hZXMyNTZDdHJFbmNyeXB0SG9vayA9IGV4cG9ydHMuYWVzMjU2Q2JjRGVjcnlwdEhvb2sgPSBleHBvcnRzLmFlczI1NkNiY0VuY3J5cHRIb29rID0gdm9pZCAwO1xuZXhwb3J0cy5tYWtlQUVTMjU2SG9vayA9IG1ha2VBRVMyNTZIb29rO1xuZXhwb3J0cy5yYW5kb21Ib29rID0gcmFuZG9tSG9vaztcbmV4cG9ydHMuc2hhMjU2SG9vayA9IHNoYTI1Nkhvb2s7XG5leHBvcnRzLm1ha2VIbWFjSG9vayA9IG1ha2VIbWFjSG9vaztcbmV4cG9ydHMuc2lnblJzYVNoYTI1Nkhvb2sgPSBzaWduUnNhU2hhMjU2SG9vaztcbmNvbnN0IGNyeXB0byA9IHJlcXVpcmUoXCJjcnlwdG9cIik7XG5mdW5jdGlvbiBtYWtlQUVTMjU2SG9vayhtZXRob2QsIG1vZGUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGtleSwgaXYsIGlucHV0LCBvdXRwdXQpIHtcbiAgICAgICAgbGV0IHJlc3VsdDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNpcGhlciA9IGNyeXB0b1ttZXRob2RdKG1vZGUsIGtleSwgaXYpO1xuICAgICAgICAgICAgY2lwaGVyLnNldEF1dG9QYWRkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIHJlc3VsdCA9IGNpcGhlci51cGRhdGUoaW5wdXQpO1xuICAgICAgICAgICAgY29uc3QgZmluYWwgPSBjaXBoZXIuZmluYWwoKTtcbiAgICAgICAgICAgIGlmIChmaW5hbC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gQnVmZmVyLmNvbmNhdChbcmVzdWx0LCBmaW5hbF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQuY29weShvdXRwdXQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aDtcbiAgICB9O1xufVxuZnVuY3Rpb24gcmFuZG9tSG9vayhidWZmZXIsIGNvdW50KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY3J5cHRvLnJhbmRvbUZpbGxTeW5jKGJ1ZmZlciwgMCwgY291bnQpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgcmV0dXJuIGNvdW50O1xufVxuZnVuY3Rpb24gc2hhMjU2SG9vayhpbnB1dCwgb3V0cHV0KSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgICByZXN1bHQgPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKGlucHV0KS5kaWdlc3QoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIHJlc3VsdC5jb3B5KG91dHB1dCk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGg7XG59XG5mdW5jdGlvbiBtYWtlSG1hY0hvb2soYWxnb3JpdGhtKSB7XG4gICAgcmV0dXJuIChrZXksIGlucHV0LCBvdXRwdXQpID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGNyeXB0by5jcmVhdGVIbWFjKGFsZ29yaXRobSwga2V5KS51cGRhdGUoaW5wdXQpLmRpZ2VzdCgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQuY29weShvdXRwdXQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aDtcbiAgICB9O1xufVxuZnVuY3Rpb24gc2lnblJzYVNoYTI1Nkhvb2soa2V5LCBpbnB1dCwgb3V0cHV0KSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBzaWduZXIgPSBjcnlwdG8uY3JlYXRlU2lnbignc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nKTtcbiAgICAgICAgY29uc3QgcHJpdmF0ZUtleSA9IEJ1ZmZlci5mcm9tKGAtLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cXG4ke2tleS50b1N0cmluZygnYmFzZTY0Jyl9XFxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxcbmApO1xuICAgICAgICByZXN1bHQgPSBzaWduZXIudXBkYXRlKGlucHV0KS5lbmQoKS5zaWduKHByaXZhdGVLZXkpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgcmVzdWx0LmNvcHkob3V0cHV0KTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aDtcbn1cbmV4cG9ydHMuYWVzMjU2Q2JjRW5jcnlwdEhvb2sgPSBtYWtlQUVTMjU2SG9vaygnY3JlYXRlQ2lwaGVyaXYnLCAnYWVzLTI1Ni1jYmMnKTtcbmV4cG9ydHMuYWVzMjU2Q2JjRGVjcnlwdEhvb2sgPSBtYWtlQUVTMjU2SG9vaygnY3JlYXRlRGVjaXBoZXJpdicsICdhZXMtMjU2LWNiYycpO1xuZXhwb3J0cy5hZXMyNTZDdHJFbmNyeXB0SG9vayA9IG1ha2VBRVMyNTZIb29rKCdjcmVhdGVDaXBoZXJpdicsICdhZXMtMjU2LWN0cicpO1xuZXhwb3J0cy5hZXMyNTZDdHJEZWNyeXB0SG9vayA9IG1ha2VBRVMyNTZIb29rKCdjcmVhdGVEZWNpcGhlcml2JywgJ2Flcy0yNTYtY3RyJyk7XG5leHBvcnRzLmhtYWNTaGE1MTJIb29rID0gbWFrZUhtYWNIb29rKCdzaGE1MTInKTtcbmV4cG9ydHMuaG1hY1NoYTI1Nkhvb2sgPSBtYWtlSG1hY0hvb2soJ3NoYTI1NicpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y3J5cHRvX2NhbGxiYWNrcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/crypto_callbacks.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js":
/*!*****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js ***!
  \*****************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoCryptKMSRequestNetworkTimeoutError = exports.MongoCryptAzureKMSRequestError = exports.MongoCryptCreateEncryptedCollectionError = exports.MongoCryptCreateDataKeyError = exports.MongoCryptInvalidArgumentError = exports.MongoCryptError = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/**\n * @public\n * An error indicating that something went wrong specifically with MongoDB Client Encryption\n */\nclass MongoCryptError extends error_1.MongoError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options = {}) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoCryptError';\n    }\n}\nexports.MongoCryptError = MongoCryptError;\n/**\n * @public\n *\n * An error indicating an invalid argument was provided to an encryption API.\n */\nclass MongoCryptInvalidArgumentError extends MongoCryptError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoCryptInvalidArgumentError';\n    }\n}\nexports.MongoCryptInvalidArgumentError = MongoCryptInvalidArgumentError;\n/**\n * @public\n * An error indicating that `ClientEncryption.createEncryptedCollection()` failed to create data keys\n */\nclass MongoCryptCreateDataKeyError extends MongoCryptError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(encryptedFields, { cause }) {\n        super(`Unable to complete creating data keys: ${cause.message}`, { cause });\n        this.encryptedFields = encryptedFields;\n    }\n    get name() {\n        return 'MongoCryptCreateDataKeyError';\n    }\n}\nexports.MongoCryptCreateDataKeyError = MongoCryptCreateDataKeyError;\n/**\n * @public\n * An error indicating that `ClientEncryption.createEncryptedCollection()` failed to create a collection\n */\nclass MongoCryptCreateEncryptedCollectionError extends MongoCryptError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(encryptedFields, { cause }) {\n        super(`Unable to create collection: ${cause.message}`, { cause });\n        this.encryptedFields = encryptedFields;\n    }\n    get name() {\n        return 'MongoCryptCreateEncryptedCollectionError';\n    }\n}\nexports.MongoCryptCreateEncryptedCollectionError = MongoCryptCreateEncryptedCollectionError;\n/**\n * @public\n * An error indicating that mongodb-client-encryption failed to auto-refresh Azure KMS credentials.\n */\nclass MongoCryptAzureKMSRequestError extends MongoCryptError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, body) {\n        super(message);\n        this.body = body;\n    }\n    get name() {\n        return 'MongoCryptAzureKMSRequestError';\n    }\n}\nexports.MongoCryptAzureKMSRequestError = MongoCryptAzureKMSRequestError;\n/** @public */\nclass MongoCryptKMSRequestNetworkTimeoutError extends MongoCryptError {\n    get name() {\n        return 'MongoCryptKMSRequestNetworkTimeoutError';\n    }\n}\nexports.MongoCryptKMSRequestNetworkTimeoutError = MongoCryptKMSRequestNetworkTimeoutError;\n//# sourceMappingURL=errors.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vZXJyb3JzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELCtDQUErQyxHQUFHLHNDQUFzQyxHQUFHLGdEQUFnRCxHQUFHLG9DQUFvQyxHQUFHLHNDQUFzQyxHQUFHLHVCQUF1QjtBQUNyUCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLE9BQU87QUFDMUMsd0RBQXdELGNBQWMsS0FBSyxPQUFPO0FBQ2xGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxPQUFPO0FBQzFDLDhDQUE4QyxjQUFjLEtBQUssT0FBTztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQztBQUMvQyIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vZXJyb3JzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Nb25nb0NyeXB0S01TUmVxdWVzdE5ldHdvcmtUaW1lb3V0RXJyb3IgPSBleHBvcnRzLk1vbmdvQ3J5cHRBenVyZUtNU1JlcXVlc3RFcnJvciA9IGV4cG9ydHMuTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvciA9IGV4cG9ydHMuTW9uZ29DcnlwdENyZWF0ZURhdGFLZXlFcnJvciA9IGV4cG9ydHMuTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yID0gZXhwb3J0cy5Nb25nb0NyeXB0RXJyb3IgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuLyoqXG4gKiBAcHVibGljXG4gKiBBbiBlcnJvciBpbmRpY2F0aW5nIHRoYXQgc29tZXRoaW5nIHdlbnQgd3Jvbmcgc3BlY2lmaWNhbGx5IHdpdGggTW9uZ29EQiBDbGllbnQgRW5jcnlwdGlvblxuICovXG5jbGFzcyBNb25nb0NyeXB0RXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQ3J5cHRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NyeXB0RXJyb3IgPSBNb25nb0NyeXB0RXJyb3I7XG4vKipcbiAqIEBwdWJsaWNcbiAqXG4gKiBBbiBlcnJvciBpbmRpY2F0aW5nIGFuIGludmFsaWQgYXJndW1lbnQgd2FzIHByb3ZpZGVkIHRvIGFuIGVuY3J5cHRpb24gQVBJLlxuICovXG5jbGFzcyBNb25nb0NyeXB0SW52YWxpZEFyZ3VtZW50RXJyb3IgZXh0ZW5kcyBNb25nb0NyeXB0RXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0NyeXB0SW52YWxpZEFyZ3VtZW50RXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yID0gTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yO1xuLyoqXG4gKiBAcHVibGljXG4gKiBBbiBlcnJvciBpbmRpY2F0aW5nIHRoYXQgYENsaWVudEVuY3J5cHRpb24uY3JlYXRlRW5jcnlwdGVkQ29sbGVjdGlvbigpYCBmYWlsZWQgdG8gY3JlYXRlIGRhdGEga2V5c1xuICovXG5jbGFzcyBNb25nb0NyeXB0Q3JlYXRlRGF0YUtleUVycm9yIGV4dGVuZHMgTW9uZ29DcnlwdEVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IoZW5jcnlwdGVkRmllbGRzLCB7IGNhdXNlIH0pIHtcbiAgICAgICAgc3VwZXIoYFVuYWJsZSB0byBjb21wbGV0ZSBjcmVhdGluZyBkYXRhIGtleXM6ICR7Y2F1c2UubWVzc2FnZX1gLCB7IGNhdXNlIH0pO1xuICAgICAgICB0aGlzLmVuY3J5cHRlZEZpZWxkcyA9IGVuY3J5cHRlZEZpZWxkcztcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29DcnlwdENyZWF0ZURhdGFLZXlFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NyeXB0Q3JlYXRlRGF0YUtleUVycm9yID0gTW9uZ29DcnlwdENyZWF0ZURhdGFLZXlFcnJvcjtcbi8qKlxuICogQHB1YmxpY1xuICogQW4gZXJyb3IgaW5kaWNhdGluZyB0aGF0IGBDbGllbnRFbmNyeXB0aW9uLmNyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb24oKWAgZmFpbGVkIHRvIGNyZWF0ZSBhIGNvbGxlY3Rpb25cbiAqL1xuY2xhc3MgTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvciBleHRlbmRzIE1vbmdvQ3J5cHRFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKGVuY3J5cHRlZEZpZWxkcywgeyBjYXVzZSB9KSB7XG4gICAgICAgIHN1cGVyKGBVbmFibGUgdG8gY3JlYXRlIGNvbGxlY3Rpb246ICR7Y2F1c2UubWVzc2FnZX1gLCB7IGNhdXNlIH0pO1xuICAgICAgICB0aGlzLmVuY3J5cHRlZEZpZWxkcyA9IGVuY3J5cHRlZEZpZWxkcztcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NyeXB0Q3JlYXRlRW5jcnlwdGVkQ29sbGVjdGlvbkVycm9yID0gTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvcjtcbi8qKlxuICogQHB1YmxpY1xuICogQW4gZXJyb3IgaW5kaWNhdGluZyB0aGF0IG1vbmdvZGItY2xpZW50LWVuY3J5cHRpb24gZmFpbGVkIHRvIGF1dG8tcmVmcmVzaCBBenVyZSBLTVMgY3JlZGVudGlhbHMuXG4gKi9cbmNsYXNzIE1vbmdvQ3J5cHRBenVyZUtNU1JlcXVlc3RFcnJvciBleHRlbmRzIE1vbmdvQ3J5cHRFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGJvZHkpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIHRoaXMuYm9keSA9IGJvZHk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQ3J5cHRBenVyZUtNU1JlcXVlc3RFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NyeXB0QXp1cmVLTVNSZXF1ZXN0RXJyb3IgPSBNb25nb0NyeXB0QXp1cmVLTVNSZXF1ZXN0RXJyb3I7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgTW9uZ29DcnlwdEtNU1JlcXVlc3ROZXR3b3JrVGltZW91dEVycm9yIGV4dGVuZHMgTW9uZ29DcnlwdEVycm9yIHtcbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0NyeXB0S01TUmVxdWVzdE5ldHdvcmtUaW1lb3V0RXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29DcnlwdEtNU1JlcXVlc3ROZXR3b3JrVGltZW91dEVycm9yID0gTW9uZ29DcnlwdEtNU1JlcXVlc3ROZXR3b3JrVGltZW91dEVycm9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXJyb3JzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/mongocryptd_manager.js":
/*!******************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/mongocryptd_manager.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongocryptdManager = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/**\n * @internal\n * An internal class that handles spawning a mongocryptd.\n */\nclass MongocryptdManager {\n    constructor(extraOptions = {}) {\n        this.spawnPath = '';\n        this.spawnArgs = [];\n        this.uri =\n            typeof extraOptions.mongocryptdURI === 'string' && extraOptions.mongocryptdURI.length > 0\n                ? extraOptions.mongocryptdURI\n                : MongocryptdManager.DEFAULT_MONGOCRYPTD_URI;\n        this.bypassSpawn = !!extraOptions.mongocryptdBypassSpawn;\n        if (Object.hasOwn(extraOptions, 'mongocryptdSpawnPath') && extraOptions.mongocryptdSpawnPath) {\n            this.spawnPath = extraOptions.mongocryptdSpawnPath;\n        }\n        if (Object.hasOwn(extraOptions, 'mongocryptdSpawnArgs') &&\n            Array.isArray(extraOptions.mongocryptdSpawnArgs)) {\n            this.spawnArgs = this.spawnArgs.concat(extraOptions.mongocryptdSpawnArgs);\n        }\n        if (this.spawnArgs\n            .filter(arg => typeof arg === 'string')\n            .every(arg => arg.indexOf('--idleShutdownTimeoutSecs') < 0)) {\n            this.spawnArgs.push('--idleShutdownTimeoutSecs', '60');\n        }\n    }\n    /**\n     * Will check to see if a mongocryptd is up. If it is not up, it will attempt\n     * to spawn a mongocryptd in a detached process, and then wait for it to be up.\n     */\n    async spawn() {\n        const cmdName = this.spawnPath || 'mongocryptd';\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        const { spawn } = __webpack_require__(/*! child_process */ \"child_process\");\n        // Spawned with stdio: ignore and detached: true\n        // to ensure child can outlive parent.\n        this._child = spawn(cmdName, this.spawnArgs, {\n            stdio: 'ignore',\n            detached: true\n        });\n        this._child.on('error', () => {\n            // From the FLE spec:\n            // \"The stdout and stderr of the spawned process MUST not be exposed in the driver\n            // (e.g. redirect to /dev/null). Users can pass the argument --logpath to\n            // extraOptions.mongocryptdSpawnArgs if they need to inspect mongocryptd logs.\n            // If spawning is necessary, the driver MUST spawn mongocryptd whenever server\n            // selection on the MongoClient to mongocryptd fails. If the MongoClient fails to\n            // connect after spawning, the server selection error is propagated to the user.\"\n            // The AutoEncrypter and MongoCryptdManager should work together to spawn\n            // mongocryptd whenever necessary.  Additionally, the `mongocryptd` intentionally\n            // shuts down after 60s and gets respawned when necessary.  We rely on server\n            // selection timeouts when connecting to the `mongocryptd` to inform users that something\n            // has been configured incorrectly.  For those reasons, we suppress stderr from\n            // the `mongocryptd` process and immediately unref the process.\n        });\n        // unref child to remove handle from event loop\n        this._child.unref();\n    }\n    /**\n     * @returns the result of `fn` or rejects with an error.\n     */\n    async withRespawn(fn) {\n        try {\n            const result = await fn();\n            return result;\n        }\n        catch (err) {\n            // If we are not bypassing spawning, then we should retry once on a MongoTimeoutError (server selection error)\n            const shouldSpawn = err instanceof error_1.MongoNetworkTimeoutError && !this.bypassSpawn;\n            if (!shouldSpawn) {\n                throw err;\n            }\n        }\n        await this.spawn();\n        const result = await fn();\n        return result;\n    }\n}\nexports.MongocryptdManager = MongocryptdManager;\nMongocryptdManager.DEFAULT_MONGOCRYPTD_URI = 'mongodb://localhost:27020';\n//# sourceMappingURL=mongocryptd_manager.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vbW9uZ29jcnlwdGRfbWFuYWdlci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEI7QUFDMUIsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsUUFBUSxFQUFFLG1CQUFPLENBQUMsb0NBQWU7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vbW9uZ29jcnlwdGRfbWFuYWdlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29jcnlwdGRNYW5hZ2VyID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbi8qKlxuICogQGludGVybmFsXG4gKiBBbiBpbnRlcm5hbCBjbGFzcyB0aGF0IGhhbmRsZXMgc3Bhd25pbmcgYSBtb25nb2NyeXB0ZC5cbiAqL1xuY2xhc3MgTW9uZ29jcnlwdGRNYW5hZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcihleHRyYU9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLnNwYXduUGF0aCA9ICcnO1xuICAgICAgICB0aGlzLnNwYXduQXJncyA9IFtdO1xuICAgICAgICB0aGlzLnVyaSA9XG4gICAgICAgICAgICB0eXBlb2YgZXh0cmFPcHRpb25zLm1vbmdvY3J5cHRkVVJJID09PSAnc3RyaW5nJyAmJiBleHRyYU9wdGlvbnMubW9uZ29jcnlwdGRVUkkubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgID8gZXh0cmFPcHRpb25zLm1vbmdvY3J5cHRkVVJJXG4gICAgICAgICAgICAgICAgOiBNb25nb2NyeXB0ZE1hbmFnZXIuREVGQVVMVF9NT05HT0NSWVBURF9VUkk7XG4gICAgICAgIHRoaXMuYnlwYXNzU3Bhd24gPSAhIWV4dHJhT3B0aW9ucy5tb25nb2NyeXB0ZEJ5cGFzc1NwYXduO1xuICAgICAgICBpZiAoT2JqZWN0Lmhhc093bihleHRyYU9wdGlvbnMsICdtb25nb2NyeXB0ZFNwYXduUGF0aCcpICYmIGV4dHJhT3B0aW9ucy5tb25nb2NyeXB0ZFNwYXduUGF0aCkge1xuICAgICAgICAgICAgdGhpcy5zcGF3blBhdGggPSBleHRyYU9wdGlvbnMubW9uZ29jcnlwdGRTcGF3blBhdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKE9iamVjdC5oYXNPd24oZXh0cmFPcHRpb25zLCAnbW9uZ29jcnlwdGRTcGF3bkFyZ3MnKSAmJlxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShleHRyYU9wdGlvbnMubW9uZ29jcnlwdGRTcGF3bkFyZ3MpKSB7XG4gICAgICAgICAgICB0aGlzLnNwYXduQXJncyA9IHRoaXMuc3Bhd25BcmdzLmNvbmNhdChleHRyYU9wdGlvbnMubW9uZ29jcnlwdGRTcGF3bkFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNwYXduQXJnc1xuICAgICAgICAgICAgLmZpbHRlcihhcmcgPT4gdHlwZW9mIGFyZyA9PT0gJ3N0cmluZycpXG4gICAgICAgICAgICAuZXZlcnkoYXJnID0+IGFyZy5pbmRleE9mKCctLWlkbGVTaHV0ZG93blRpbWVvdXRTZWNzJykgPCAwKSkge1xuICAgICAgICAgICAgdGhpcy5zcGF3bkFyZ3MucHVzaCgnLS1pZGxlU2h1dGRvd25UaW1lb3V0U2VjcycsICc2MCcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdpbGwgY2hlY2sgdG8gc2VlIGlmIGEgbW9uZ29jcnlwdGQgaXMgdXAuIElmIGl0IGlzIG5vdCB1cCwgaXQgd2lsbCBhdHRlbXB0XG4gICAgICogdG8gc3Bhd24gYSBtb25nb2NyeXB0ZCBpbiBhIGRldGFjaGVkIHByb2Nlc3MsIGFuZCB0aGVuIHdhaXQgZm9yIGl0IHRvIGJlIHVwLlxuICAgICAqL1xuICAgIGFzeW5jIHNwYXduKCkge1xuICAgICAgICBjb25zdCBjbWROYW1lID0gdGhpcy5zcGF3blBhdGggfHwgJ21vbmdvY3J5cHRkJztcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHNcbiAgICAgICAgY29uc3QgeyBzcGF3biB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuICAgICAgICAvLyBTcGF3bmVkIHdpdGggc3RkaW86IGlnbm9yZSBhbmQgZGV0YWNoZWQ6IHRydWVcbiAgICAgICAgLy8gdG8gZW5zdXJlIGNoaWxkIGNhbiBvdXRsaXZlIHBhcmVudC5cbiAgICAgICAgdGhpcy5fY2hpbGQgPSBzcGF3bihjbWROYW1lLCB0aGlzLnNwYXduQXJncywge1xuICAgICAgICAgICAgc3RkaW86ICdpZ25vcmUnLFxuICAgICAgICAgICAgZGV0YWNoZWQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2NoaWxkLm9uKCdlcnJvcicsICgpID0+IHtcbiAgICAgICAgICAgIC8vIEZyb20gdGhlIEZMRSBzcGVjOlxuICAgICAgICAgICAgLy8gXCJUaGUgc3Rkb3V0IGFuZCBzdGRlcnIgb2YgdGhlIHNwYXduZWQgcHJvY2VzcyBNVVNUIG5vdCBiZSBleHBvc2VkIGluIHRoZSBkcml2ZXJcbiAgICAgICAgICAgIC8vIChlLmcuIHJlZGlyZWN0IHRvIC9kZXYvbnVsbCkuIFVzZXJzIGNhbiBwYXNzIHRoZSBhcmd1bWVudCAtLWxvZ3BhdGggdG9cbiAgICAgICAgICAgIC8vIGV4dHJhT3B0aW9ucy5tb25nb2NyeXB0ZFNwYXduQXJncyBpZiB0aGV5IG5lZWQgdG8gaW5zcGVjdCBtb25nb2NyeXB0ZCBsb2dzLlxuICAgICAgICAgICAgLy8gSWYgc3Bhd25pbmcgaXMgbmVjZXNzYXJ5LCB0aGUgZHJpdmVyIE1VU1Qgc3Bhd24gbW9uZ29jcnlwdGQgd2hlbmV2ZXIgc2VydmVyXG4gICAgICAgICAgICAvLyBzZWxlY3Rpb24gb24gdGhlIE1vbmdvQ2xpZW50IHRvIG1vbmdvY3J5cHRkIGZhaWxzLiBJZiB0aGUgTW9uZ29DbGllbnQgZmFpbHMgdG9cbiAgICAgICAgICAgIC8vIGNvbm5lY3QgYWZ0ZXIgc3Bhd25pbmcsIHRoZSBzZXJ2ZXIgc2VsZWN0aW9uIGVycm9yIGlzIHByb3BhZ2F0ZWQgdG8gdGhlIHVzZXIuXCJcbiAgICAgICAgICAgIC8vIFRoZSBBdXRvRW5jcnlwdGVyIGFuZCBNb25nb0NyeXB0ZE1hbmFnZXIgc2hvdWxkIHdvcmsgdG9nZXRoZXIgdG8gc3Bhd25cbiAgICAgICAgICAgIC8vIG1vbmdvY3J5cHRkIHdoZW5ldmVyIG5lY2Vzc2FyeS4gIEFkZGl0aW9uYWxseSwgdGhlIGBtb25nb2NyeXB0ZGAgaW50ZW50aW9uYWxseVxuICAgICAgICAgICAgLy8gc2h1dHMgZG93biBhZnRlciA2MHMgYW5kIGdldHMgcmVzcGF3bmVkIHdoZW4gbmVjZXNzYXJ5LiAgV2UgcmVseSBvbiBzZXJ2ZXJcbiAgICAgICAgICAgIC8vIHNlbGVjdGlvbiB0aW1lb3V0cyB3aGVuIGNvbm5lY3RpbmcgdG8gdGhlIGBtb25nb2NyeXB0ZGAgdG8gaW5mb3JtIHVzZXJzIHRoYXQgc29tZXRoaW5nXG4gICAgICAgICAgICAvLyBoYXMgYmVlbiBjb25maWd1cmVkIGluY29ycmVjdGx5LiAgRm9yIHRob3NlIHJlYXNvbnMsIHdlIHN1cHByZXNzIHN0ZGVyciBmcm9tXG4gICAgICAgICAgICAvLyB0aGUgYG1vbmdvY3J5cHRkYCBwcm9jZXNzIGFuZCBpbW1lZGlhdGVseSB1bnJlZiB0aGUgcHJvY2Vzcy5cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIHVucmVmIGNoaWxkIHRvIHJlbW92ZSBoYW5kbGUgZnJvbSBldmVudCBsb29wXG4gICAgICAgIHRoaXMuX2NoaWxkLnVucmVmKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHRoZSByZXN1bHQgb2YgYGZuYCBvciByZWplY3RzIHdpdGggYW4gZXJyb3IuXG4gICAgICovXG4gICAgYXN5bmMgd2l0aFJlc3Bhd24oZm4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuKCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGFyZSBub3QgYnlwYXNzaW5nIHNwYXduaW5nLCB0aGVuIHdlIHNob3VsZCByZXRyeSBvbmNlIG9uIGEgTW9uZ29UaW1lb3V0RXJyb3IgKHNlcnZlciBzZWxlY3Rpb24gZXJyb3IpXG4gICAgICAgICAgICBjb25zdCBzaG91bGRTcGF3biA9IGVyciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yICYmICF0aGlzLmJ5cGFzc1NwYXduO1xuICAgICAgICAgICAgaWYgKCFzaG91bGRTcGF3bikge1xuICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLnNwYXduKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuKCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb2NyeXB0ZE1hbmFnZXIgPSBNb25nb2NyeXB0ZE1hbmFnZXI7XG5Nb25nb2NyeXB0ZE1hbmFnZXIuREVGQVVMVF9NT05HT0NSWVBURF9VUkkgPSAnbW9uZ29kYjovL2xvY2FsaG9zdDoyNzAyMCc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb25nb2NyeXB0ZF9tYW5hZ2VyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/mongocryptd_manager.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/aws.js":
/*!************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/aws.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.loadAWSCredentials = loadAWSCredentials;\nconst aws_temporary_credentials_1 = __webpack_require__(/*! ../../cmap/auth/aws_temporary_credentials */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/aws_temporary_credentials.js\");\n/**\n * @internal\n */\nasync function loadAWSCredentials(kmsProviders, provider) {\n    const credentialProvider = new aws_temporary_credentials_1.AWSSDKCredentialProvider(provider);\n    // We shouldn't ever receive a response from the AWS SDK that doesn't have a `SecretAccessKey`\n    // or `AccessKeyId`.  However, TS says these fields are optional.  We provide empty strings\n    // and let libmongocrypt error if we're unable to fetch the required keys.\n    const { SecretAccessKey = '', AccessKeyId = '', Token } = await credentialProvider.getCredentials();\n    const aws = {\n        secretAccessKey: SecretAccessKey,\n        accessKeyId: AccessKeyId\n    };\n    // the AWS session token is only required for temporary credentials so only attach it to the\n    // result if it's present in the response from the aws sdk\n    Token != null && (aws.sessionToken = Token);\n    return { ...kmsProviders, aws };\n}\n//# sourceMappingURL=aws.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vcHJvdmlkZXJzL2F3cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEI7QUFDMUIsb0NBQW9DLG1CQUFPLENBQUMsNEpBQTJDO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGdEQUFnRDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY2xpZW50LXNpZGUtZW5jcnlwdGlvbi9wcm92aWRlcnMvYXdzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5sb2FkQVdTQ3JlZGVudGlhbHMgPSBsb2FkQVdTQ3JlZGVudGlhbHM7XG5jb25zdCBhd3NfdGVtcG9yYXJ5X2NyZWRlbnRpYWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vY21hcC9hdXRoL2F3c190ZW1wb3JhcnlfY3JlZGVudGlhbHNcIik7XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5hc3luYyBmdW5jdGlvbiBsb2FkQVdTQ3JlZGVudGlhbHMoa21zUHJvdmlkZXJzLCBwcm92aWRlcikge1xuICAgIGNvbnN0IGNyZWRlbnRpYWxQcm92aWRlciA9IG5ldyBhd3NfdGVtcG9yYXJ5X2NyZWRlbnRpYWxzXzEuQVdTU0RLQ3JlZGVudGlhbFByb3ZpZGVyKHByb3ZpZGVyKTtcbiAgICAvLyBXZSBzaG91bGRuJ3QgZXZlciByZWNlaXZlIGEgcmVzcG9uc2UgZnJvbSB0aGUgQVdTIFNESyB0aGF0IGRvZXNuJ3QgaGF2ZSBhIGBTZWNyZXRBY2Nlc3NLZXlgXG4gICAgLy8gb3IgYEFjY2Vzc0tleUlkYC4gIEhvd2V2ZXIsIFRTIHNheXMgdGhlc2UgZmllbGRzIGFyZSBvcHRpb25hbC4gIFdlIHByb3ZpZGUgZW1wdHkgc3RyaW5nc1xuICAgIC8vIGFuZCBsZXQgbGlibW9uZ29jcnlwdCBlcnJvciBpZiB3ZSdyZSB1bmFibGUgdG8gZmV0Y2ggdGhlIHJlcXVpcmVkIGtleXMuXG4gICAgY29uc3QgeyBTZWNyZXRBY2Nlc3NLZXkgPSAnJywgQWNjZXNzS2V5SWQgPSAnJywgVG9rZW4gfSA9IGF3YWl0IGNyZWRlbnRpYWxQcm92aWRlci5nZXRDcmVkZW50aWFscygpO1xuICAgIGNvbnN0IGF3cyA9IHtcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiBTZWNyZXRBY2Nlc3NLZXksXG4gICAgICAgIGFjY2Vzc0tleUlkOiBBY2Nlc3NLZXlJZFxuICAgIH07XG4gICAgLy8gdGhlIEFXUyBzZXNzaW9uIHRva2VuIGlzIG9ubHkgcmVxdWlyZWQgZm9yIHRlbXBvcmFyeSBjcmVkZW50aWFscyBzbyBvbmx5IGF0dGFjaCBpdCB0byB0aGVcbiAgICAvLyByZXN1bHQgaWYgaXQncyBwcmVzZW50IGluIHRoZSByZXNwb25zZSBmcm9tIHRoZSBhd3Mgc2RrXG4gICAgVG9rZW4gIT0gbnVsbCAmJiAoYXdzLnNlc3Npb25Ub2tlbiA9IFRva2VuKTtcbiAgICByZXR1cm4geyAuLi5rbXNQcm92aWRlcnMsIGF3cyB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXdzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/aws.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/azure.js":
/*!**************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/azure.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.tokenCache = exports.AzureCredentialCache = exports.AZURE_BASE_URL = void 0;\nexports.addAzureParams = addAzureParams;\nexports.prepareRequest = prepareRequest;\nexports.fetchAzureKMSToken = fetchAzureKMSToken;\nexports.loadAzureCredentials = loadAzureCredentials;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst errors_1 = __webpack_require__(/*! ../errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js\");\nconst MINIMUM_TOKEN_REFRESH_IN_MILLISECONDS = 6000;\n/** Base URL for getting Azure tokens. */\nexports.AZURE_BASE_URL = 'http://169.254.169.254/metadata/identity/oauth2/token?';\n/**\n * @internal\n */\nclass AzureCredentialCache {\n    constructor() {\n        this.cachedToken = null;\n    }\n    async getToken() {\n        if (this.cachedToken == null || this.needsRefresh(this.cachedToken)) {\n            this.cachedToken = await this._getToken();\n        }\n        return { accessToken: this.cachedToken.accessToken };\n    }\n    needsRefresh(token) {\n        const timeUntilExpirationMS = token.expiresOnTimestamp - Date.now();\n        return timeUntilExpirationMS <= MINIMUM_TOKEN_REFRESH_IN_MILLISECONDS;\n    }\n    /**\n     * exposed for testing\n     */\n    resetCache() {\n        this.cachedToken = null;\n    }\n    /**\n     * exposed for testing\n     */\n    _getToken() {\n        return fetchAzureKMSToken();\n    }\n}\nexports.AzureCredentialCache = AzureCredentialCache;\n/** @internal */\nexports.tokenCache = new AzureCredentialCache();\n/** @internal */\nasync function parseResponse(response) {\n    const { status, body: rawBody } = response;\n    const body = (() => {\n        try {\n            return JSON.parse(rawBody);\n        }\n        catch {\n            throw new errors_1.MongoCryptAzureKMSRequestError('Malformed JSON body in GET request.');\n        }\n    })();\n    if (status !== 200) {\n        throw new errors_1.MongoCryptAzureKMSRequestError('Unable to complete request.', body);\n    }\n    if (!body.access_token) {\n        throw new errors_1.MongoCryptAzureKMSRequestError('Malformed response body - missing field `access_token`.');\n    }\n    if (!body.expires_in) {\n        throw new errors_1.MongoCryptAzureKMSRequestError('Malformed response body - missing field `expires_in`.');\n    }\n    const expiresInMS = Number(body.expires_in) * 1000;\n    if (Number.isNaN(expiresInMS)) {\n        throw new errors_1.MongoCryptAzureKMSRequestError('Malformed response body - unable to parse int from `expires_in` field.');\n    }\n    return {\n        accessToken: body.access_token,\n        expiresOnTimestamp: Date.now() + expiresInMS\n    };\n}\n/**\n * @internal\n * Get the Azure endpoint URL.\n */\nfunction addAzureParams(url, resource, username) {\n    url.searchParams.append('api-version', '2018-02-01');\n    url.searchParams.append('resource', resource);\n    if (username) {\n        url.searchParams.append('client_id', username);\n    }\n    return url;\n}\n/**\n * @internal\n *\n * parses any options provided by prose tests to `fetchAzureKMSToken` and merges them with\n * the default values for headers and the request url.\n */\nfunction prepareRequest(options) {\n    const url = new URL(options.url?.toString() ?? exports.AZURE_BASE_URL);\n    addAzureParams(url, 'https://vault.azure.net');\n    const headers = { ...options.headers, 'Content-Type': 'application/json', Metadata: true };\n    return { headers, url };\n}\n/**\n * @internal\n *\n * `AzureKMSRequestOptions` allows prose tests to modify the http request sent to the idms\n * servers.  This is required to simulate different server conditions.  No options are expected to\n * be set outside of tests.\n *\n * exposed for CSFLE\n * [prose test 18](https://github.com/mongodb/specifications/tree/master/source/client-side-encryption/tests#azure-imds-credentials)\n */\nasync function fetchAzureKMSToken(options = {}) {\n    const { headers, url } = prepareRequest(options);\n    try {\n        const response = await (0, utils_1.get)(url, { headers });\n        return await parseResponse(response);\n    }\n    catch (error) {\n        if (error instanceof error_1.MongoNetworkTimeoutError) {\n            throw new errors_1.MongoCryptAzureKMSRequestError(`[Azure KMS] ${error.message}`);\n        }\n        throw error;\n    }\n}\n/**\n * @internal\n *\n * @throws Will reject with a `MongoCryptError` if the http request fails or the http response is malformed.\n */\nasync function loadAzureCredentials(kmsProviders) {\n    const azure = await exports.tokenCache.getToken();\n    return { ...kmsProviders, azure };\n}\n//# sourceMappingURL=azure.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vcHJvdmlkZXJzL2F6dXJlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGtCQUFrQixHQUFHLDRCQUE0QixHQUFHLHNCQUFzQjtBQUMxRSxzQkFBc0I7QUFDdEIsc0JBQXNCO0FBQ3RCLDBCQUEwQjtBQUMxQiw0QkFBNEI7QUFDNUIsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsaUJBQWlCLG1CQUFPLENBQUMsc0hBQVc7QUFDcEM7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsWUFBWSx3QkFBd0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDLFlBQVksZUFBZTtBQUMzQjtBQUNBLHVEQUF1RCxTQUFTO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLGNBQWM7QUFDM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY2xpZW50LXNpZGUtZW5jcnlwdGlvbi9wcm92aWRlcnMvYXp1cmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnRva2VuQ2FjaGUgPSBleHBvcnRzLkF6dXJlQ3JlZGVudGlhbENhY2hlID0gZXhwb3J0cy5BWlVSRV9CQVNFX1VSTCA9IHZvaWQgMDtcbmV4cG9ydHMuYWRkQXp1cmVQYXJhbXMgPSBhZGRBenVyZVBhcmFtcztcbmV4cG9ydHMucHJlcGFyZVJlcXVlc3QgPSBwcmVwYXJlUmVxdWVzdDtcbmV4cG9ydHMuZmV0Y2hBenVyZUtNU1Rva2VuID0gZmV0Y2hBenVyZUtNU1Rva2VuO1xuZXhwb3J0cy5sb2FkQXp1cmVDcmVkZW50aWFscyA9IGxvYWRBenVyZUNyZWRlbnRpYWxzO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG5jb25zdCBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuLi9lcnJvcnNcIik7XG5jb25zdCBNSU5JTVVNX1RPS0VOX1JFRlJFU0hfSU5fTUlMTElTRUNPTkRTID0gNjAwMDtcbi8qKiBCYXNlIFVSTCBmb3IgZ2V0dGluZyBBenVyZSB0b2tlbnMuICovXG5leHBvcnRzLkFaVVJFX0JBU0VfVVJMID0gJ2h0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbWV0YWRhdGEvaWRlbnRpdHkvb2F1dGgyL3Rva2VuPyc7XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBBenVyZUNyZWRlbnRpYWxDYWNoZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY2FjaGVkVG9rZW4gPSBudWxsO1xuICAgIH1cbiAgICBhc3luYyBnZXRUb2tlbigpIHtcbiAgICAgICAgaWYgKHRoaXMuY2FjaGVkVG9rZW4gPT0gbnVsbCB8fCB0aGlzLm5lZWRzUmVmcmVzaCh0aGlzLmNhY2hlZFRva2VuKSkge1xuICAgICAgICAgICAgdGhpcy5jYWNoZWRUb2tlbiA9IGF3YWl0IHRoaXMuX2dldFRva2VuKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgYWNjZXNzVG9rZW46IHRoaXMuY2FjaGVkVG9rZW4uYWNjZXNzVG9rZW4gfTtcbiAgICB9XG4gICAgbmVlZHNSZWZyZXNoKHRva2VuKSB7XG4gICAgICAgIGNvbnN0IHRpbWVVbnRpbEV4cGlyYXRpb25NUyA9IHRva2VuLmV4cGlyZXNPblRpbWVzdGFtcCAtIERhdGUubm93KCk7XG4gICAgICAgIHJldHVybiB0aW1lVW50aWxFeHBpcmF0aW9uTVMgPD0gTUlOSU1VTV9UT0tFTl9SRUZSRVNIX0lOX01JTExJU0VDT05EUztcbiAgICB9XG4gICAgLyoqXG4gICAgICogZXhwb3NlZCBmb3IgdGVzdGluZ1xuICAgICAqL1xuICAgIHJlc2V0Q2FjaGUoKSB7XG4gICAgICAgIHRoaXMuY2FjaGVkVG9rZW4gPSBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBleHBvc2VkIGZvciB0ZXN0aW5nXG4gICAgICovXG4gICAgX2dldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gZmV0Y2hBenVyZUtNU1Rva2VuKCk7XG4gICAgfVxufVxuZXhwb3J0cy5BenVyZUNyZWRlbnRpYWxDYWNoZSA9IEF6dXJlQ3JlZGVudGlhbENhY2hlO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy50b2tlbkNhY2hlID0gbmV3IEF6dXJlQ3JlZGVudGlhbENhY2hlKCk7XG4vKiogQGludGVybmFsICovXG5hc3luYyBmdW5jdGlvbiBwYXJzZVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgY29uc3QgeyBzdGF0dXMsIGJvZHk6IHJhd0JvZHkgfSA9IHJlc3BvbnNlO1xuICAgIGNvbnN0IGJvZHkgPSAoKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmF3Qm9keSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRBenVyZUtNU1JlcXVlc3RFcnJvcignTWFsZm9ybWVkIEpTT04gYm9keSBpbiBHRVQgcmVxdWVzdC4nKTtcbiAgICAgICAgfVxuICAgIH0pKCk7XG4gICAgaWYgKHN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnNfMS5Nb25nb0NyeXB0QXp1cmVLTVNSZXF1ZXN0RXJyb3IoJ1VuYWJsZSB0byBjb21wbGV0ZSByZXF1ZXN0LicsIGJvZHkpO1xuICAgIH1cbiAgICBpZiAoIWJvZHkuYWNjZXNzX3Rva2VuKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnNfMS5Nb25nb0NyeXB0QXp1cmVLTVNSZXF1ZXN0RXJyb3IoJ01hbGZvcm1lZCByZXNwb25zZSBib2R5IC0gbWlzc2luZyBmaWVsZCBgYWNjZXNzX3Rva2VuYC4nKTtcbiAgICB9XG4gICAgaWYgKCFib2R5LmV4cGlyZXNfaW4pIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRBenVyZUtNU1JlcXVlc3RFcnJvcignTWFsZm9ybWVkIHJlc3BvbnNlIGJvZHkgLSBtaXNzaW5nIGZpZWxkIGBleHBpcmVzX2luYC4nKTtcbiAgICB9XG4gICAgY29uc3QgZXhwaXJlc0luTVMgPSBOdW1iZXIoYm9keS5leHBpcmVzX2luKSAqIDEwMDA7XG4gICAgaWYgKE51bWJlci5pc05hTihleHBpcmVzSW5NUykpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRBenVyZUtNU1JlcXVlc3RFcnJvcignTWFsZm9ybWVkIHJlc3BvbnNlIGJvZHkgLSB1bmFibGUgdG8gcGFyc2UgaW50IGZyb20gYGV4cGlyZXNfaW5gIGZpZWxkLicpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBhY2Nlc3NUb2tlbjogYm9keS5hY2Nlc3NfdG9rZW4sXG4gICAgICAgIGV4cGlyZXNPblRpbWVzdGFtcDogRGF0ZS5ub3coKSArIGV4cGlyZXNJbk1TXG4gICAgfTtcbn1cbi8qKlxuICogQGludGVybmFsXG4gKiBHZXQgdGhlIEF6dXJlIGVuZHBvaW50IFVSTC5cbiAqL1xuZnVuY3Rpb24gYWRkQXp1cmVQYXJhbXModXJsLCByZXNvdXJjZSwgdXNlcm5hbWUpIHtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLmFwcGVuZCgnYXBpLXZlcnNpb24nLCAnMjAxOC0wMi0wMScpO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCdyZXNvdXJjZScsIHJlc291cmNlKTtcbiAgICBpZiAodXNlcm5hbWUpIHtcbiAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoJ2NsaWVudF9pZCcsIHVzZXJuYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIHVybDtcbn1cbi8qKlxuICogQGludGVybmFsXG4gKlxuICogcGFyc2VzIGFueSBvcHRpb25zIHByb3ZpZGVkIGJ5IHByb3NlIHRlc3RzIHRvIGBmZXRjaEF6dXJlS01TVG9rZW5gIGFuZCBtZXJnZXMgdGhlbSB3aXRoXG4gKiB0aGUgZGVmYXVsdCB2YWx1ZXMgZm9yIGhlYWRlcnMgYW5kIHRoZSByZXF1ZXN0IHVybC5cbiAqL1xuZnVuY3Rpb24gcHJlcGFyZVJlcXVlc3Qob3B0aW9ucykge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwob3B0aW9ucy51cmw/LnRvU3RyaW5nKCkgPz8gZXhwb3J0cy5BWlVSRV9CQVNFX1VSTCk7XG4gICAgYWRkQXp1cmVQYXJhbXModXJsLCAnaHR0cHM6Ly92YXVsdC5henVyZS5uZXQnKTtcbiAgICBjb25zdCBoZWFkZXJzID0geyAuLi5vcHRpb25zLmhlYWRlcnMsICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsIE1ldGFkYXRhOiB0cnVlIH07XG4gICAgcmV0dXJuIHsgaGVhZGVycywgdXJsIH07XG59XG4vKipcbiAqIEBpbnRlcm5hbFxuICpcbiAqIGBBenVyZUtNU1JlcXVlc3RPcHRpb25zYCBhbGxvd3MgcHJvc2UgdGVzdHMgdG8gbW9kaWZ5IHRoZSBodHRwIHJlcXVlc3Qgc2VudCB0byB0aGUgaWRtc1xuICogc2VydmVycy4gIFRoaXMgaXMgcmVxdWlyZWQgdG8gc2ltdWxhdGUgZGlmZmVyZW50IHNlcnZlciBjb25kaXRpb25zLiAgTm8gb3B0aW9ucyBhcmUgZXhwZWN0ZWQgdG9cbiAqIGJlIHNldCBvdXRzaWRlIG9mIHRlc3RzLlxuICpcbiAqIGV4cG9zZWQgZm9yIENTRkxFXG4gKiBbcHJvc2UgdGVzdCAxOF0oaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvdHJlZS9tYXN0ZXIvc291cmNlL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vdGVzdHMjYXp1cmUtaW1kcy1jcmVkZW50aWFscylcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZmV0Y2hBenVyZUtNU1Rva2VuKG9wdGlvbnMgPSB7fSkge1xuICAgIGNvbnN0IHsgaGVhZGVycywgdXJsIH0gPSBwcmVwYXJlUmVxdWVzdChvcHRpb25zKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0ICgwLCB1dGlsc18xLmdldCkodXJsLCB7IGhlYWRlcnMgfSk7XG4gICAgICAgIHJldHVybiBhd2FpdCBwYXJzZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEF6dXJlS01TUmVxdWVzdEVycm9yKGBbQXp1cmUgS01TXSAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxufVxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqXG4gKiBAdGhyb3dzIFdpbGwgcmVqZWN0IHdpdGggYSBgTW9uZ29DcnlwdEVycm9yYCBpZiB0aGUgaHR0cCByZXF1ZXN0IGZhaWxzIG9yIHRoZSBodHRwIHJlc3BvbnNlIGlzIG1hbGZvcm1lZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbG9hZEF6dXJlQ3JlZGVudGlhbHMoa21zUHJvdmlkZXJzKSB7XG4gICAgY29uc3QgYXp1cmUgPSBhd2FpdCBleHBvcnRzLnRva2VuQ2FjaGUuZ2V0VG9rZW4oKTtcbiAgICByZXR1cm4geyAuLi5rbXNQcm92aWRlcnMsIGF6dXJlIH07XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1henVyZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/azure.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/gcp.js":
/*!************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/gcp.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.loadGCPCredentials = loadGCPCredentials;\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\n/** @internal */\nasync function loadGCPCredentials(kmsProviders) {\n    const gcpMetadata = (0, deps_1.getGcpMetadata)();\n    if ('kModuleError' in gcpMetadata) {\n        return kmsProviders;\n    }\n    const { access_token: accessToken } = await gcpMetadata.instance({\n        property: 'service-accounts/default/token'\n    });\n    return { ...kmsProviders, gcp: { accessToken } };\n}\n//# sourceMappingURL=gcp.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vcHJvdmlkZXJzL2djcC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEI7QUFDMUIsZUFBZSxtQkFBTyxDQUFDLDhGQUFZO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNEJBQTRCO0FBQ3hDO0FBQ0EsS0FBSztBQUNMLGFBQWEsd0JBQXdCO0FBQ3JDO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbGllbnQtc2lkZS1lbmNyeXB0aW9uL3Byb3ZpZGVycy9nY3AuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmxvYWRHQ1BDcmVkZW50aWFscyA9IGxvYWRHQ1BDcmVkZW50aWFscztcbmNvbnN0IGRlcHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9kZXBzXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuYXN5bmMgZnVuY3Rpb24gbG9hZEdDUENyZWRlbnRpYWxzKGttc1Byb3ZpZGVycykge1xuICAgIGNvbnN0IGdjcE1ldGFkYXRhID0gKDAsIGRlcHNfMS5nZXRHY3BNZXRhZGF0YSkoKTtcbiAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4gZ2NwTWV0YWRhdGEpIHtcbiAgICAgICAgcmV0dXJuIGttc1Byb3ZpZGVycztcbiAgICB9XG4gICAgY29uc3QgeyBhY2Nlc3NfdG9rZW46IGFjY2Vzc1Rva2VuIH0gPSBhd2FpdCBnY3BNZXRhZGF0YS5pbnN0YW5jZSh7XG4gICAgICAgIHByb3BlcnR5OiAnc2VydmljZS1hY2NvdW50cy9kZWZhdWx0L3Rva2VuJ1xuICAgIH0pO1xuICAgIHJldHVybiB7IC4uLmttc1Byb3ZpZGVycywgZ2NwOiB7IGFjY2Vzc1Rva2VuIH0gfTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWdjcC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/gcp.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/index.js":
/*!**************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/index.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.isEmptyCredentials = isEmptyCredentials;\nexports.refreshKMSCredentials = refreshKMSCredentials;\nconst aws_1 = __webpack_require__(/*! ./aws */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/aws.js\");\nconst azure_1 = __webpack_require__(/*! ./azure */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/azure.js\");\nconst gcp_1 = __webpack_require__(/*! ./gcp */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/gcp.js\");\n/**\n * Auto credential fetching should only occur when the provider is defined on the kmsProviders map\n * and the settings are an empty object.\n *\n * This is distinct from a nullish provider key.\n *\n * @internal - exposed for testing purposes only\n */\nfunction isEmptyCredentials(providerName, kmsProviders) {\n    const provider = kmsProviders[providerName];\n    if (provider == null) {\n        return false;\n    }\n    return typeof provider === 'object' && Object.keys(provider).length === 0;\n}\n/**\n * Load cloud provider credentials for the user provided KMS providers.\n * Credentials will only attempt to get loaded if they do not exist\n * and no existing credentials will get overwritten.\n *\n * @internal\n */\nasync function refreshKMSCredentials(kmsProviders, credentialProviders) {\n    let finalKMSProviders = kmsProviders;\n    if (isEmptyCredentials('aws', kmsProviders)) {\n        finalKMSProviders = await (0, aws_1.loadAWSCredentials)(finalKMSProviders, credentialProviders?.aws);\n    }\n    if (isEmptyCredentials('gcp', kmsProviders)) {\n        finalKMSProviders = await (0, gcp_1.loadGCPCredentials)(finalKMSProviders);\n    }\n    if (isEmptyCredentials('azure', kmsProviders)) {\n        finalKMSProviders = await (0, azure_1.loadAzureCredentials)(finalKMSProviders);\n    }\n    return finalKMSProviders;\n}\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vcHJvdmlkZXJzL2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDBCQUEwQjtBQUMxQiw2QkFBNkI7QUFDN0IsY0FBYyxtQkFBTyxDQUFDLHlIQUFPO0FBQzdCLGdCQUFnQixtQkFBTyxDQUFDLDZIQUFTO0FBQ2pDLGNBQWMsbUJBQU8sQ0FBQyx5SEFBTztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbGllbnQtc2lkZS1lbmNyeXB0aW9uL3Byb3ZpZGVycy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaXNFbXB0eUNyZWRlbnRpYWxzID0gaXNFbXB0eUNyZWRlbnRpYWxzO1xuZXhwb3J0cy5yZWZyZXNoS01TQ3JlZGVudGlhbHMgPSByZWZyZXNoS01TQ3JlZGVudGlhbHM7XG5jb25zdCBhd3NfMSA9IHJlcXVpcmUoXCIuL2F3c1wiKTtcbmNvbnN0IGF6dXJlXzEgPSByZXF1aXJlKFwiLi9henVyZVwiKTtcbmNvbnN0IGdjcF8xID0gcmVxdWlyZShcIi4vZ2NwXCIpO1xuLyoqXG4gKiBBdXRvIGNyZWRlbnRpYWwgZmV0Y2hpbmcgc2hvdWxkIG9ubHkgb2NjdXIgd2hlbiB0aGUgcHJvdmlkZXIgaXMgZGVmaW5lZCBvbiB0aGUga21zUHJvdmlkZXJzIG1hcFxuICogYW5kIHRoZSBzZXR0aW5ncyBhcmUgYW4gZW1wdHkgb2JqZWN0LlxuICpcbiAqIFRoaXMgaXMgZGlzdGluY3QgZnJvbSBhIG51bGxpc2ggcHJvdmlkZXIga2V5LlxuICpcbiAqIEBpbnRlcm5hbCAtIGV4cG9zZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMgb25seVxuICovXG5mdW5jdGlvbiBpc0VtcHR5Q3JlZGVudGlhbHMocHJvdmlkZXJOYW1lLCBrbXNQcm92aWRlcnMpIHtcbiAgICBjb25zdCBwcm92aWRlciA9IGttc1Byb3ZpZGVyc1twcm92aWRlck5hbWVdO1xuICAgIGlmIChwcm92aWRlciA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHR5cGVvZiBwcm92aWRlciA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXMocHJvdmlkZXIpLmxlbmd0aCA9PT0gMDtcbn1cbi8qKlxuICogTG9hZCBjbG91ZCBwcm92aWRlciBjcmVkZW50aWFscyBmb3IgdGhlIHVzZXIgcHJvdmlkZWQgS01TIHByb3ZpZGVycy5cbiAqIENyZWRlbnRpYWxzIHdpbGwgb25seSBhdHRlbXB0IHRvIGdldCBsb2FkZWQgaWYgdGhleSBkbyBub3QgZXhpc3RcbiAqIGFuZCBubyBleGlzdGluZyBjcmVkZW50aWFscyB3aWxsIGdldCBvdmVyd3JpdHRlbi5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVmcmVzaEtNU0NyZWRlbnRpYWxzKGttc1Byb3ZpZGVycywgY3JlZGVudGlhbFByb3ZpZGVycykge1xuICAgIGxldCBmaW5hbEtNU1Byb3ZpZGVycyA9IGttc1Byb3ZpZGVycztcbiAgICBpZiAoaXNFbXB0eUNyZWRlbnRpYWxzKCdhd3MnLCBrbXNQcm92aWRlcnMpKSB7XG4gICAgICAgIGZpbmFsS01TUHJvdmlkZXJzID0gYXdhaXQgKDAsIGF3c18xLmxvYWRBV1NDcmVkZW50aWFscykoZmluYWxLTVNQcm92aWRlcnMsIGNyZWRlbnRpYWxQcm92aWRlcnM/LmF3cyk7XG4gICAgfVxuICAgIGlmIChpc0VtcHR5Q3JlZGVudGlhbHMoJ2djcCcsIGttc1Byb3ZpZGVycykpIHtcbiAgICAgICAgZmluYWxLTVNQcm92aWRlcnMgPSBhd2FpdCAoMCwgZ2NwXzEubG9hZEdDUENyZWRlbnRpYWxzKShmaW5hbEtNU1Byb3ZpZGVycyk7XG4gICAgfVxuICAgIGlmIChpc0VtcHR5Q3JlZGVudGlhbHMoJ2F6dXJlJywga21zUHJvdmlkZXJzKSkge1xuICAgICAgICBmaW5hbEtNU1Byb3ZpZGVycyA9IGF3YWl0ICgwLCBhenVyZV8xLmxvYWRBenVyZUNyZWRlbnRpYWxzKShmaW5hbEtNU1Byb3ZpZGVycyk7XG4gICAgfVxuICAgIHJldHVybiBmaW5hbEtNU1Byb3ZpZGVycztcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/state_machine.js":
/*!************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/state_machine.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.StateMachine = void 0;\nconst fs = __webpack_require__(/*! fs/promises */ \"fs/promises\");\nconst net = __webpack_require__(/*! net */ \"net\");\nconst tls = __webpack_require__(/*! tls */ \"tls\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ../cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nconst deps_1 = __webpack_require__(/*! ../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst client_encryption_1 = __webpack_require__(/*! ./client_encryption */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/client_encryption.js\");\nconst errors_1 = __webpack_require__(/*! ./errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js\");\nlet socks = null;\nfunction loadSocks() {\n    if (socks == null) {\n        const socksImport = (0, deps_1.getSocks)();\n        if ('kModuleError' in socksImport) {\n            throw socksImport.kModuleError;\n        }\n        socks = socksImport;\n    }\n    return socks;\n}\n// libmongocrypt states\nconst MONGOCRYPT_CTX_ERROR = 0;\nconst MONGOCRYPT_CTX_NEED_MONGO_COLLINFO = 1;\nconst MONGOCRYPT_CTX_NEED_MONGO_MARKINGS = 2;\nconst MONGOCRYPT_CTX_NEED_MONGO_KEYS = 3;\nconst MONGOCRYPT_CTX_NEED_KMS_CREDENTIALS = 7;\nconst MONGOCRYPT_CTX_NEED_KMS = 4;\nconst MONGOCRYPT_CTX_READY = 5;\nconst MONGOCRYPT_CTX_DONE = 6;\nconst HTTPS_PORT = 443;\nconst stateToString = new Map([\n    [MONGOCRYPT_CTX_ERROR, 'MONGOCRYPT_CTX_ERROR'],\n    [MONGOCRYPT_CTX_NEED_MONGO_COLLINFO, 'MONGOCRYPT_CTX_NEED_MONGO_COLLINFO'],\n    [MONGOCRYPT_CTX_NEED_MONGO_MARKINGS, 'MONGOCRYPT_CTX_NEED_MONGO_MARKINGS'],\n    [MONGOCRYPT_CTX_NEED_MONGO_KEYS, 'MONGOCRYPT_CTX_NEED_MONGO_KEYS'],\n    [MONGOCRYPT_CTX_NEED_KMS_CREDENTIALS, 'MONGOCRYPT_CTX_NEED_KMS_CREDENTIALS'],\n    [MONGOCRYPT_CTX_NEED_KMS, 'MONGOCRYPT_CTX_NEED_KMS'],\n    [MONGOCRYPT_CTX_READY, 'MONGOCRYPT_CTX_READY'],\n    [MONGOCRYPT_CTX_DONE, 'MONGOCRYPT_CTX_DONE']\n]);\nconst INSECURE_TLS_OPTIONS = [\n    'tlsInsecure',\n    'tlsAllowInvalidCertificates',\n    'tlsAllowInvalidHostnames',\n    // These options are disallowed by the spec, so we explicitly filter them out if provided, even\n    // though the StateMachine does not declare support for these options.\n    'tlsDisableOCSPEndpointCheck',\n    'tlsDisableCertificateRevocationCheck'\n];\n/**\n * Helper function for logging. Enabled by setting the environment flag MONGODB_CRYPT_DEBUG.\n * @param msg - Anything you want to be logged.\n */\nfunction debug(msg) {\n    if (process.env.MONGODB_CRYPT_DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error(msg);\n    }\n}\n/**\n * This is kind of a hack.  For `rewrapManyDataKey`, we have tests that\n * guarantee that when there are no matching keys, `rewrapManyDataKey` returns\n * nothing.  We also have tests for auto encryption that guarantee for `encrypt`\n * we return an error when there are no matching keys.  This error is generated in\n * subsequent iterations of the state machine.\n * Some apis (`encrypt`) throw if there are no filter matches and others (`rewrapManyDataKey`)\n * do not.  We set the result manually here, and let the state machine continue.  `libmongocrypt`\n * will inform us if we need to error by setting the state to `MONGOCRYPT_CTX_ERROR` but\n * otherwise we'll return `{ v: [] }`.\n */\nlet EMPTY_V;\n/**\n * @internal\n * An internal class that executes across a MongoCryptContext until either\n * a finishing state or an error is reached. Do not instantiate directly.\n */\n// TODO(DRIVERS-2671): clarify CSOT behavior for FLE APIs\nclass StateMachine {\n    constructor(options, bsonOptions = (0, bson_1.pluckBSONSerializeOptions)(options)) {\n        this.options = options;\n        this.bsonOptions = bsonOptions;\n    }\n    /**\n     * Executes the state machine according to the specification\n     */\n    async execute(executor, context, options) {\n        const keyVaultNamespace = executor._keyVaultNamespace;\n        const keyVaultClient = executor._keyVaultClient;\n        const metaDataClient = executor._metaDataClient;\n        const mongocryptdClient = executor._mongocryptdClient;\n        const mongocryptdManager = executor._mongocryptdManager;\n        let result = null;\n        // Typescript treats getters just like properties: Once you've tested it for equality\n        // it cannot change. Which is exactly the opposite of what we use state and status for.\n        // Every call to at least `addMongoOperationResponse` and `finalize` can change the state.\n        // These wrappers let us write code more naturally and not add compiler exceptions\n        // to conditions checks inside the state machine.\n        const getStatus = () => context.status;\n        const getState = () => context.state;\n        while (getState() !== MONGOCRYPT_CTX_DONE && getState() !== MONGOCRYPT_CTX_ERROR) {\n            options.signal?.throwIfAborted();\n            debug(`[context#${context.id}] ${stateToString.get(getState()) || getState()}`);\n            switch (getState()) {\n                case MONGOCRYPT_CTX_NEED_MONGO_COLLINFO: {\n                    const filter = (0, bson_1.deserialize)(context.nextMongoOperation());\n                    if (!metaDataClient) {\n                        throw new errors_1.MongoCryptError('unreachable state machine state: entered MONGOCRYPT_CTX_NEED_MONGO_COLLINFO but metadata client is undefined');\n                    }\n                    const collInfoCursor = this.fetchCollectionInfo(metaDataClient, context.ns, filter, options);\n                    for await (const collInfo of collInfoCursor) {\n                        context.addMongoOperationResponse((0, bson_1.serialize)(collInfo));\n                        if (getState() === MONGOCRYPT_CTX_ERROR)\n                            break;\n                    }\n                    if (getState() === MONGOCRYPT_CTX_ERROR)\n                        break;\n                    context.finishMongoOperation();\n                    break;\n                }\n                case MONGOCRYPT_CTX_NEED_MONGO_MARKINGS: {\n                    const command = context.nextMongoOperation();\n                    if (getState() === MONGOCRYPT_CTX_ERROR)\n                        break;\n                    if (!mongocryptdClient) {\n                        throw new errors_1.MongoCryptError('unreachable state machine state: entered MONGOCRYPT_CTX_NEED_MONGO_MARKINGS but mongocryptdClient is undefined');\n                    }\n                    // When we are using the shared library, we don't have a mongocryptd manager.\n                    const markedCommand = mongocryptdManager\n                        ? await mongocryptdManager.withRespawn(this.markCommand.bind(this, mongocryptdClient, context.ns, command, options))\n                        : await this.markCommand(mongocryptdClient, context.ns, command, options);\n                    context.addMongoOperationResponse(markedCommand);\n                    context.finishMongoOperation();\n                    break;\n                }\n                case MONGOCRYPT_CTX_NEED_MONGO_KEYS: {\n                    const filter = context.nextMongoOperation();\n                    const keys = await this.fetchKeys(keyVaultClient, keyVaultNamespace, filter, options);\n                    if (keys.length === 0) {\n                        // See docs on EMPTY_V\n                        result = EMPTY_V ??= (0, bson_1.serialize)({ v: [] });\n                    }\n                    for await (const key of keys) {\n                        context.addMongoOperationResponse((0, bson_1.serialize)(key));\n                    }\n                    context.finishMongoOperation();\n                    break;\n                }\n                case MONGOCRYPT_CTX_NEED_KMS_CREDENTIALS: {\n                    const kmsProviders = await executor.askForKMSCredentials();\n                    context.provideKMSProviders((0, bson_1.serialize)(kmsProviders));\n                    break;\n                }\n                case MONGOCRYPT_CTX_NEED_KMS: {\n                    await Promise.all(this.requests(context, options));\n                    context.finishKMSRequests();\n                    break;\n                }\n                case MONGOCRYPT_CTX_READY: {\n                    const finalizedContext = context.finalize();\n                    if (getState() === MONGOCRYPT_CTX_ERROR) {\n                        const message = getStatus().message || 'Finalization error';\n                        throw new errors_1.MongoCryptError(message);\n                    }\n                    result = finalizedContext;\n                    break;\n                }\n                default:\n                    throw new errors_1.MongoCryptError(`Unknown state: ${getState()}`);\n            }\n        }\n        if (getState() === MONGOCRYPT_CTX_ERROR || result == null) {\n            const message = getStatus().message;\n            if (!message) {\n                debug(`unidentifiable error in MongoCrypt - received an error status from \\`libmongocrypt\\` but received no error message.`);\n            }\n            throw new errors_1.MongoCryptError(message ??\n                'unidentifiable error in MongoCrypt - received an error status from `libmongocrypt` but received no error message.');\n        }\n        return result;\n    }\n    /**\n     * Handles the request to the KMS service. Exposed for testing purposes. Do not directly invoke.\n     * @param kmsContext - A C++ KMS context returned from the bindings\n     * @returns A promise that resolves when the KMS reply has be fully parsed\n     */\n    async kmsRequest(request, options) {\n        const parsedUrl = request.endpoint.split(':');\n        const port = parsedUrl[1] != null ? Number.parseInt(parsedUrl[1], 10) : HTTPS_PORT;\n        const socketOptions = {\n            host: parsedUrl[0],\n            servername: parsedUrl[0],\n            port,\n            ...(0, client_encryption_1.autoSelectSocketOptions)(this.options.socketOptions || {})\n        };\n        const message = request.message;\n        const buffer = new utils_1.BufferPool();\n        let netSocket;\n        let socket;\n        function destroySockets() {\n            for (const sock of [socket, netSocket]) {\n                if (sock) {\n                    sock.destroy();\n                }\n            }\n        }\n        function onerror(cause) {\n            return new errors_1.MongoCryptError('KMS request failed', { cause });\n        }\n        function onclose() {\n            return new errors_1.MongoCryptError('KMS request closed');\n        }\n        const tlsOptions = this.options.tlsOptions;\n        if (tlsOptions) {\n            const kmsProvider = request.kmsProvider;\n            const providerTlsOptions = tlsOptions[kmsProvider];\n            if (providerTlsOptions) {\n                const error = this.validateTlsOptions(kmsProvider, providerTlsOptions);\n                if (error) {\n                    throw error;\n                }\n                try {\n                    await this.setTlsOptions(providerTlsOptions, socketOptions);\n                }\n                catch (err) {\n                    throw onerror(err);\n                }\n            }\n        }\n        let abortListener;\n        try {\n            if (this.options.proxyOptions && this.options.proxyOptions.proxyHost) {\n                netSocket = new net.Socket();\n                const { promise: willConnect, reject: rejectOnNetSocketError, resolve: resolveOnNetSocketConnect } = (0, utils_1.promiseWithResolvers)();\n                netSocket\n                    .once('error', err => rejectOnNetSocketError(onerror(err)))\n                    .once('close', () => rejectOnNetSocketError(onclose()))\n                    .once('connect', () => resolveOnNetSocketConnect());\n                const netSocketOptions = {\n                    ...socketOptions,\n                    host: this.options.proxyOptions.proxyHost,\n                    port: this.options.proxyOptions.proxyPort || 1080\n                };\n                netSocket.connect(netSocketOptions);\n                await willConnect;\n                try {\n                    socks ??= loadSocks();\n                    socketOptions.socket = (await socks.SocksClient.createConnection({\n                        existing_socket: netSocket,\n                        command: 'connect',\n                        destination: { host: socketOptions.host, port: socketOptions.port },\n                        proxy: {\n                            // host and port are ignored because we pass existing_socket\n                            host: 'iLoveJavaScript',\n                            port: 0,\n                            type: 5,\n                            userId: this.options.proxyOptions.proxyUsername,\n                            password: this.options.proxyOptions.proxyPassword\n                        }\n                    })).socket;\n                }\n                catch (err) {\n                    throw onerror(err);\n                }\n            }\n            socket = tls.connect(socketOptions, () => {\n                socket.write(message);\n            });\n            const { promise: willResolveKmsRequest, reject: rejectOnTlsSocketError, resolve } = (0, utils_1.promiseWithResolvers)();\n            abortListener = (0, utils_1.addAbortListener)(options?.signal, function () {\n                destroySockets();\n                rejectOnTlsSocketError(this.reason);\n            });\n            socket\n                .once('error', err => rejectOnTlsSocketError(onerror(err)))\n                .once('close', () => rejectOnTlsSocketError(onclose()))\n                .on('data', data => {\n                buffer.append(data);\n                while (request.bytesNeeded > 0 && buffer.length) {\n                    const bytesNeeded = Math.min(request.bytesNeeded, buffer.length);\n                    request.addResponse(buffer.read(bytesNeeded));\n                }\n                if (request.bytesNeeded <= 0) {\n                    resolve();\n                }\n            });\n            await (options?.timeoutContext?.csotEnabled()\n                ? Promise.all([\n                    willResolveKmsRequest,\n                    timeout_1.Timeout.expires(options.timeoutContext?.remainingTimeMS)\n                ])\n                : willResolveKmsRequest);\n        }\n        catch (error) {\n            if (error instanceof timeout_1.TimeoutError)\n                throw new error_1.MongoOperationTimeoutError('KMS request timed out');\n            throw error;\n        }\n        finally {\n            // There's no need for any more activity on this socket at this point.\n            destroySockets();\n            abortListener?.[utils_1.kDispose]();\n        }\n    }\n    *requests(context, options) {\n        for (let request = context.nextKMSRequest(); request != null; request = context.nextKMSRequest()) {\n            yield this.kmsRequest(request, options);\n        }\n    }\n    /**\n     * Validates the provided TLS options are secure.\n     *\n     * @param kmsProvider - The KMS provider name.\n     * @param tlsOptions - The client TLS options for the provider.\n     *\n     * @returns An error if any option is invalid.\n     */\n    validateTlsOptions(kmsProvider, tlsOptions) {\n        const tlsOptionNames = Object.keys(tlsOptions);\n        for (const option of INSECURE_TLS_OPTIONS) {\n            if (tlsOptionNames.includes(option)) {\n                return new errors_1.MongoCryptError(`Insecure TLS options prohibited for ${kmsProvider}: ${option}`);\n            }\n        }\n    }\n    /**\n     * Sets only the valid secure TLS options.\n     *\n     * @param tlsOptions - The client TLS options for the provider.\n     * @param options - The existing connection options.\n     */\n    async setTlsOptions(tlsOptions, options) {\n        if (tlsOptions.tlsCertificateKeyFile) {\n            const cert = await fs.readFile(tlsOptions.tlsCertificateKeyFile);\n            options.cert = options.key = cert;\n        }\n        if (tlsOptions.tlsCAFile) {\n            options.ca = await fs.readFile(tlsOptions.tlsCAFile);\n        }\n        if (tlsOptions.tlsCertificateKeyFilePassword) {\n            options.passphrase = tlsOptions.tlsCertificateKeyFilePassword;\n        }\n    }\n    /**\n     * Fetches collection info for a provided namespace, when libmongocrypt\n     * enters the `MONGOCRYPT_CTX_NEED_MONGO_COLLINFO` state. The result is\n     * used to inform libmongocrypt of the schema associated with this\n     * namespace. Exposed for testing purposes. Do not directly invoke.\n     *\n     * @param client - A MongoClient connected to the topology\n     * @param ns - The namespace to list collections from\n     * @param filter - A filter for the listCollections command\n     * @param callback - Invoked with the info of the requested collection, or with an error\n     */\n    fetchCollectionInfo(client, ns, filter, options) {\n        const { db } = utils_1.MongoDBCollectionNamespace.fromString(ns);\n        const cursor = client.db(db).listCollections(filter, {\n            promoteLongs: false,\n            promoteValues: false,\n            timeoutContext: options?.timeoutContext && new abstract_cursor_1.CursorTimeoutContext(options?.timeoutContext, Symbol()),\n            signal: options?.signal,\n            nameOnly: false\n        });\n        return cursor;\n    }\n    /**\n     * Calls to the mongocryptd to provide markings for a command.\n     * Exposed for testing purposes. Do not directly invoke.\n     * @param client - A MongoClient connected to a mongocryptd\n     * @param ns - The namespace (database.collection) the command is being executed on\n     * @param command - The command to execute.\n     * @param callback - Invoked with the serialized and marked bson command, or with an error\n     */\n    async markCommand(client, ns, command, options) {\n        const { db } = utils_1.MongoDBCollectionNamespace.fromString(ns);\n        const bsonOptions = { promoteLongs: false, promoteValues: false };\n        const rawCommand = (0, bson_1.deserialize)(command, bsonOptions);\n        const commandOptions = {\n            timeoutMS: undefined,\n            signal: undefined\n        };\n        if (options?.timeoutContext?.csotEnabled()) {\n            commandOptions.timeoutMS = options.timeoutContext.remainingTimeMS;\n        }\n        if (options?.signal) {\n            commandOptions.signal = options.signal;\n        }\n        const response = await client.db(db).command(rawCommand, {\n            ...bsonOptions,\n            ...commandOptions\n        });\n        return (0, bson_1.serialize)(response, this.bsonOptions);\n    }\n    /**\n     * Requests keys from the keyVault collection on the topology.\n     * Exposed for testing purposes. Do not directly invoke.\n     * @param client - A MongoClient connected to the topology\n     * @param keyVaultNamespace - The namespace (database.collection) of the keyVault Collection\n     * @param filter - The filter for the find query against the keyVault Collection\n     * @param callback - Invoked with the found keys, or with an error\n     */\n    fetchKeys(client, keyVaultNamespace, filter, options) {\n        const { db: dbName, collection: collectionName } = utils_1.MongoDBCollectionNamespace.fromString(keyVaultNamespace);\n        const commandOptions = {\n            timeoutContext: undefined,\n            signal: undefined\n        };\n        if (options?.timeoutContext != null) {\n            commandOptions.timeoutContext = new abstract_cursor_1.CursorTimeoutContext(options.timeoutContext, Symbol());\n        }\n        if (options?.signal != null) {\n            commandOptions.signal = options.signal;\n        }\n        return client\n            .db(dbName)\n            .collection(collectionName, { readConcern: { level: 'majority' } })\n            .find((0, bson_1.deserialize)(filter), commandOptions)\n            .toArray();\n    }\n}\nexports.StateMachine = StateMachine;\n//# sourceMappingURL=state_machine.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vc3RhdGVfbWFjaGluZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxvQkFBb0I7QUFDcEIsV0FBVyxtQkFBTyxDQUFDLGdDQUFhO0FBQ2hDLFlBQVksbUJBQU8sQ0FBQyxnQkFBSztBQUN6QixZQUFZLG1CQUFPLENBQUMsZ0JBQUs7QUFDekIsZUFBZSxtQkFBTyxDQUFDLDJGQUFTO0FBQ2hDLDBCQUEwQixtQkFBTyxDQUFDLCtIQUEyQjtBQUM3RCxlQUFlLG1CQUFPLENBQUMsMkZBQVM7QUFDaEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsNEJBQTRCLG1CQUFPLENBQUMsMklBQXFCO0FBQ3pELGlCQUFpQixtQkFBTyxDQUFDLHFIQUFVO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsT0FBTztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFdBQVcsSUFBSSw0Q0FBNEM7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRUFBcUUsT0FBTztBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RUFBeUUsV0FBVztBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnR0FBZ0c7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsT0FBTztBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwyRkFBMkY7QUFDbkg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsb0RBQW9EO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2Isb0JBQW9CLDBFQUEwRTtBQUM5RjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELGlCQUFpQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyRkFBMkYsWUFBWSxJQUFJLE9BQU87QUFDbEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLEtBQUs7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsS0FBSztBQUNyQiw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlDQUF5QztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsZUFBZSxxQkFBcUI7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbGllbnQtc2lkZS1lbmNyeXB0aW9uL3N0YXRlX21hY2hpbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlN0YXRlTWFjaGluZSA9IHZvaWQgMDtcbmNvbnN0IGZzID0gcmVxdWlyZShcImZzL3Byb21pc2VzXCIpO1xuY29uc3QgbmV0ID0gcmVxdWlyZShcIm5ldFwiKTtcbmNvbnN0IHRscyA9IHJlcXVpcmUoXCJ0bHNcIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4uL2N1cnNvci9hYnN0cmFjdF9jdXJzb3JcIik7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vZGVwc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB0aW1lb3V0XzEgPSByZXF1aXJlKFwiLi4vdGltZW91dFwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjbGllbnRfZW5jcnlwdGlvbl8xID0gcmVxdWlyZShcIi4vY2xpZW50X2VuY3J5cHRpb25cIik7XG5jb25zdCBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuL2Vycm9yc1wiKTtcbmxldCBzb2NrcyA9IG51bGw7XG5mdW5jdGlvbiBsb2FkU29ja3MoKSB7XG4gICAgaWYgKHNvY2tzID09IG51bGwpIHtcbiAgICAgICAgY29uc3Qgc29ja3NJbXBvcnQgPSAoMCwgZGVwc18xLmdldFNvY2tzKSgpO1xuICAgICAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4gc29ja3NJbXBvcnQpIHtcbiAgICAgICAgICAgIHRocm93IHNvY2tzSW1wb3J0LmtNb2R1bGVFcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBzb2NrcyA9IHNvY2tzSW1wb3J0O1xuICAgIH1cbiAgICByZXR1cm4gc29ja3M7XG59XG4vLyBsaWJtb25nb2NyeXB0IHN0YXRlc1xuY29uc3QgTU9OR09DUllQVF9DVFhfRVJST1IgPSAwO1xuY29uc3QgTU9OR09DUllQVF9DVFhfTkVFRF9NT05HT19DT0xMSU5GTyA9IDE7XG5jb25zdCBNT05HT0NSWVBUX0NUWF9ORUVEX01PTkdPX01BUktJTkdTID0gMjtcbmNvbnN0IE1PTkdPQ1JZUFRfQ1RYX05FRURfTU9OR09fS0VZUyA9IDM7XG5jb25zdCBNT05HT0NSWVBUX0NUWF9ORUVEX0tNU19DUkVERU5USUFMUyA9IDc7XG5jb25zdCBNT05HT0NSWVBUX0NUWF9ORUVEX0tNUyA9IDQ7XG5jb25zdCBNT05HT0NSWVBUX0NUWF9SRUFEWSA9IDU7XG5jb25zdCBNT05HT0NSWVBUX0NUWF9ET05FID0gNjtcbmNvbnN0IEhUVFBTX1BPUlQgPSA0NDM7XG5jb25zdCBzdGF0ZVRvU3RyaW5nID0gbmV3IE1hcChbXG4gICAgW01PTkdPQ1JZUFRfQ1RYX0VSUk9SLCAnTU9OR09DUllQVF9DVFhfRVJST1InXSxcbiAgICBbTU9OR09DUllQVF9DVFhfTkVFRF9NT05HT19DT0xMSU5GTywgJ01PTkdPQ1JZUFRfQ1RYX05FRURfTU9OR09fQ09MTElORk8nXSxcbiAgICBbTU9OR09DUllQVF9DVFhfTkVFRF9NT05HT19NQVJLSU5HUywgJ01PTkdPQ1JZUFRfQ1RYX05FRURfTU9OR09fTUFSS0lOR1MnXSxcbiAgICBbTU9OR09DUllQVF9DVFhfTkVFRF9NT05HT19LRVlTLCAnTU9OR09DUllQVF9DVFhfTkVFRF9NT05HT19LRVlTJ10sXG4gICAgW01PTkdPQ1JZUFRfQ1RYX05FRURfS01TX0NSRURFTlRJQUxTLCAnTU9OR09DUllQVF9DVFhfTkVFRF9LTVNfQ1JFREVOVElBTFMnXSxcbiAgICBbTU9OR09DUllQVF9DVFhfTkVFRF9LTVMsICdNT05HT0NSWVBUX0NUWF9ORUVEX0tNUyddLFxuICAgIFtNT05HT0NSWVBUX0NUWF9SRUFEWSwgJ01PTkdPQ1JZUFRfQ1RYX1JFQURZJ10sXG4gICAgW01PTkdPQ1JZUFRfQ1RYX0RPTkUsICdNT05HT0NSWVBUX0NUWF9ET05FJ11cbl0pO1xuY29uc3QgSU5TRUNVUkVfVExTX09QVElPTlMgPSBbXG4gICAgJ3Rsc0luc2VjdXJlJyxcbiAgICAndGxzQWxsb3dJbnZhbGlkQ2VydGlmaWNhdGVzJyxcbiAgICAndGxzQWxsb3dJbnZhbGlkSG9zdG5hbWVzJyxcbiAgICAvLyBUaGVzZSBvcHRpb25zIGFyZSBkaXNhbGxvd2VkIGJ5IHRoZSBzcGVjLCBzbyB3ZSBleHBsaWNpdGx5IGZpbHRlciB0aGVtIG91dCBpZiBwcm92aWRlZCwgZXZlblxuICAgIC8vIHRob3VnaCB0aGUgU3RhdGVNYWNoaW5lIGRvZXMgbm90IGRlY2xhcmUgc3VwcG9ydCBmb3IgdGhlc2Ugb3B0aW9ucy5cbiAgICAndGxzRGlzYWJsZU9DU1BFbmRwb2ludENoZWNrJyxcbiAgICAndGxzRGlzYWJsZUNlcnRpZmljYXRlUmV2b2NhdGlvbkNoZWNrJ1xuXTtcbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBsb2dnaW5nLiBFbmFibGVkIGJ5IHNldHRpbmcgdGhlIGVudmlyb25tZW50IGZsYWcgTU9OR09EQl9DUllQVF9ERUJVRy5cbiAqIEBwYXJhbSBtc2cgLSBBbnl0aGluZyB5b3Ugd2FudCB0byBiZSBsb2dnZWQuXG4gKi9cbmZ1bmN0aW9uIGRlYnVnKG1zZykge1xuICAgIGlmIChwcm9jZXNzLmVudi5NT05HT0RCX0NSWVBUX0RFQlVHKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IobXNnKTtcbiAgICB9XG59XG4vKipcbiAqIFRoaXMgaXMga2luZCBvZiBhIGhhY2suICBGb3IgYHJld3JhcE1hbnlEYXRhS2V5YCwgd2UgaGF2ZSB0ZXN0cyB0aGF0XG4gKiBndWFyYW50ZWUgdGhhdCB3aGVuIHRoZXJlIGFyZSBubyBtYXRjaGluZyBrZXlzLCBgcmV3cmFwTWFueURhdGFLZXlgIHJldHVybnNcbiAqIG5vdGhpbmcuICBXZSBhbHNvIGhhdmUgdGVzdHMgZm9yIGF1dG8gZW5jcnlwdGlvbiB0aGF0IGd1YXJhbnRlZSBmb3IgYGVuY3J5cHRgXG4gKiB3ZSByZXR1cm4gYW4gZXJyb3Igd2hlbiB0aGVyZSBhcmUgbm8gbWF0Y2hpbmcga2V5cy4gIFRoaXMgZXJyb3IgaXMgZ2VuZXJhdGVkIGluXG4gKiBzdWJzZXF1ZW50IGl0ZXJhdGlvbnMgb2YgdGhlIHN0YXRlIG1hY2hpbmUuXG4gKiBTb21lIGFwaXMgKGBlbmNyeXB0YCkgdGhyb3cgaWYgdGhlcmUgYXJlIG5vIGZpbHRlciBtYXRjaGVzIGFuZCBvdGhlcnMgKGByZXdyYXBNYW55RGF0YUtleWApXG4gKiBkbyBub3QuICBXZSBzZXQgdGhlIHJlc3VsdCBtYW51YWxseSBoZXJlLCBhbmQgbGV0IHRoZSBzdGF0ZSBtYWNoaW5lIGNvbnRpbnVlLiAgYGxpYm1vbmdvY3J5cHRgXG4gKiB3aWxsIGluZm9ybSB1cyBpZiB3ZSBuZWVkIHRvIGVycm9yIGJ5IHNldHRpbmcgdGhlIHN0YXRlIHRvIGBNT05HT0NSWVBUX0NUWF9FUlJPUmAgYnV0XG4gKiBvdGhlcndpc2Ugd2UnbGwgcmV0dXJuIGB7IHY6IFtdIH1gLlxuICovXG5sZXQgRU1QVFlfVjtcbi8qKlxuICogQGludGVybmFsXG4gKiBBbiBpbnRlcm5hbCBjbGFzcyB0aGF0IGV4ZWN1dGVzIGFjcm9zcyBhIE1vbmdvQ3J5cHRDb250ZXh0IHVudGlsIGVpdGhlclxuICogYSBmaW5pc2hpbmcgc3RhdGUgb3IgYW4gZXJyb3IgaXMgcmVhY2hlZC4gRG8gbm90IGluc3RhbnRpYXRlIGRpcmVjdGx5LlxuICovXG4vLyBUT0RPKERSSVZFUlMtMjY3MSk6IGNsYXJpZnkgQ1NPVCBiZWhhdmlvciBmb3IgRkxFIEFQSXNcbmNsYXNzIFN0YXRlTWFjaGluZSB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucywgYnNvbk9wdGlvbnMgPSAoMCwgYnNvbl8xLnBsdWNrQlNPTlNlcmlhbGl6ZU9wdGlvbnMpKG9wdGlvbnMpKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuYnNvbk9wdGlvbnMgPSBic29uT3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZXMgdGhlIHN0YXRlIG1hY2hpbmUgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZShleGVjdXRvciwgY29udGV4dCwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBrZXlWYXVsdE5hbWVzcGFjZSA9IGV4ZWN1dG9yLl9rZXlWYXVsdE5hbWVzcGFjZTtcbiAgICAgICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBleGVjdXRvci5fa2V5VmF1bHRDbGllbnQ7XG4gICAgICAgIGNvbnN0IG1ldGFEYXRhQ2xpZW50ID0gZXhlY3V0b3IuX21ldGFEYXRhQ2xpZW50O1xuICAgICAgICBjb25zdCBtb25nb2NyeXB0ZENsaWVudCA9IGV4ZWN1dG9yLl9tb25nb2NyeXB0ZENsaWVudDtcbiAgICAgICAgY29uc3QgbW9uZ29jcnlwdGRNYW5hZ2VyID0gZXhlY3V0b3IuX21vbmdvY3J5cHRkTWFuYWdlcjtcbiAgICAgICAgbGV0IHJlc3VsdCA9IG51bGw7XG4gICAgICAgIC8vIFR5cGVzY3JpcHQgdHJlYXRzIGdldHRlcnMganVzdCBsaWtlIHByb3BlcnRpZXM6IE9uY2UgeW91J3ZlIHRlc3RlZCBpdCBmb3IgZXF1YWxpdHlcbiAgICAgICAgLy8gaXQgY2Fubm90IGNoYW5nZS4gV2hpY2ggaXMgZXhhY3RseSB0aGUgb3Bwb3NpdGUgb2Ygd2hhdCB3ZSB1c2Ugc3RhdGUgYW5kIHN0YXR1cyBmb3IuXG4gICAgICAgIC8vIEV2ZXJ5IGNhbGwgdG8gYXQgbGVhc3QgYGFkZE1vbmdvT3BlcmF0aW9uUmVzcG9uc2VgIGFuZCBgZmluYWxpemVgIGNhbiBjaGFuZ2UgdGhlIHN0YXRlLlxuICAgICAgICAvLyBUaGVzZSB3cmFwcGVycyBsZXQgdXMgd3JpdGUgY29kZSBtb3JlIG5hdHVyYWxseSBhbmQgbm90IGFkZCBjb21waWxlciBleGNlcHRpb25zXG4gICAgICAgIC8vIHRvIGNvbmRpdGlvbnMgY2hlY2tzIGluc2lkZSB0aGUgc3RhdGUgbWFjaGluZS5cbiAgICAgICAgY29uc3QgZ2V0U3RhdHVzID0gKCkgPT4gY29udGV4dC5zdGF0dXM7XG4gICAgICAgIGNvbnN0IGdldFN0YXRlID0gKCkgPT4gY29udGV4dC5zdGF0ZTtcbiAgICAgICAgd2hpbGUgKGdldFN0YXRlKCkgIT09IE1PTkdPQ1JZUFRfQ1RYX0RPTkUgJiYgZ2V0U3RhdGUoKSAhPT0gTU9OR09DUllQVF9DVFhfRVJST1IpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuc2lnbmFsPy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICAgICAgZGVidWcoYFtjb250ZXh0IyR7Y29udGV4dC5pZH1dICR7c3RhdGVUb1N0cmluZy5nZXQoZ2V0U3RhdGUoKSkgfHwgZ2V0U3RhdGUoKX1gKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZ2V0U3RhdGUoKSkge1xuICAgICAgICAgICAgICAgIGNhc2UgTU9OR09DUllQVF9DVFhfTkVFRF9NT05HT19DT0xMSU5GTzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSAoMCwgYnNvbl8xLmRlc2VyaWFsaXplKShjb250ZXh0Lm5leHRNb25nb09wZXJhdGlvbigpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXRhRGF0YUNsaWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRFcnJvcigndW5yZWFjaGFibGUgc3RhdGUgbWFjaGluZSBzdGF0ZTogZW50ZXJlZCBNT05HT0NSWVBUX0NUWF9ORUVEX01PTkdPX0NPTExJTkZPIGJ1dCBtZXRhZGF0YSBjbGllbnQgaXMgdW5kZWZpbmVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sbEluZm9DdXJzb3IgPSB0aGlzLmZldGNoQ29sbGVjdGlvbkluZm8obWV0YURhdGFDbGllbnQsIGNvbnRleHQubnMsIGZpbHRlciwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgY29sbEluZm8gb2YgY29sbEluZm9DdXJzb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuYWRkTW9uZ29PcGVyYXRpb25SZXNwb25zZSgoMCwgYnNvbl8xLnNlcmlhbGl6ZSkoY29sbEluZm8pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRTdGF0ZSgpID09PSBNT05HT0NSWVBUX0NUWF9FUlJPUilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0U3RhdGUoKSA9PT0gTU9OR09DUllQVF9DVFhfRVJST1IpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5maW5pc2hNb25nb09wZXJhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBNT05HT0NSWVBUX0NUWF9ORUVEX01PTkdPX01BUktJTkdTOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjb250ZXh0Lm5leHRNb25nb09wZXJhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0U3RhdGUoKSA9PT0gTU9OR09DUllQVF9DVFhfRVJST1IpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtb25nb2NyeXB0ZENsaWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRFcnJvcigndW5yZWFjaGFibGUgc3RhdGUgbWFjaGluZSBzdGF0ZTogZW50ZXJlZCBNT05HT0NSWVBUX0NUWF9ORUVEX01PTkdPX01BUktJTkdTIGJ1dCBtb25nb2NyeXB0ZENsaWVudCBpcyB1bmRlZmluZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSB1c2luZyB0aGUgc2hhcmVkIGxpYnJhcnksIHdlIGRvbid0IGhhdmUgYSBtb25nb2NyeXB0ZCBtYW5hZ2VyLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXJrZWRDb21tYW5kID0gbW9uZ29jcnlwdGRNYW5hZ2VyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGF3YWl0IG1vbmdvY3J5cHRkTWFuYWdlci53aXRoUmVzcGF3bih0aGlzLm1hcmtDb21tYW5kLmJpbmQodGhpcywgbW9uZ29jcnlwdGRDbGllbnQsIGNvbnRleHQubnMsIGNvbW1hbmQsIG9wdGlvbnMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBhd2FpdCB0aGlzLm1hcmtDb21tYW5kKG1vbmdvY3J5cHRkQ2xpZW50LCBjb250ZXh0Lm5zLCBjb21tYW5kLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5hZGRNb25nb09wZXJhdGlvblJlc3BvbnNlKG1hcmtlZENvbW1hbmQpO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmZpbmlzaE1vbmdvT3BlcmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIE1PTkdPQ1JZUFRfQ1RYX05FRURfTU9OR09fS0VZUzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBjb250ZXh0Lm5leHRNb25nb09wZXJhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXlzID0gYXdhaXQgdGhpcy5mZXRjaEtleXMoa2V5VmF1bHRDbGllbnQsIGtleVZhdWx0TmFtZXNwYWNlLCBmaWx0ZXIsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlZSBkb2NzIG9uIEVNUFRZX1ZcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IEVNUFRZX1YgPz89ICgwLCBic29uXzEuc2VyaWFsaXplKSh7IHY6IFtdIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuYWRkTW9uZ29PcGVyYXRpb25SZXNwb25zZSgoMCwgYnNvbl8xLnNlcmlhbGl6ZSkoa2V5KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5maW5pc2hNb25nb09wZXJhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBNT05HT0NSWVBUX0NUWF9ORUVEX0tNU19DUkVERU5USUFMUzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrbXNQcm92aWRlcnMgPSBhd2FpdCBleGVjdXRvci5hc2tGb3JLTVNDcmVkZW50aWFscygpO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnByb3ZpZGVLTVNQcm92aWRlcnMoKDAsIGJzb25fMS5zZXJpYWxpemUpKGttc1Byb3ZpZGVycykpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBNT05HT0NSWVBUX0NUWF9ORUVEX0tNUzoge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLnJlcXVlc3RzKGNvbnRleHQsIG9wdGlvbnMpKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5maW5pc2hLTVNSZXF1ZXN0cygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBNT05HT0NSWVBUX0NUWF9SRUFEWToge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbGl6ZWRDb250ZXh0ID0gY29udGV4dC5maW5hbGl6ZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0U3RhdGUoKSA9PT0gTU9OR09DUllQVF9DVFhfRVJST1IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRTdGF0dXMoKS5tZXNzYWdlIHx8ICdGaW5hbGl6YXRpb24gZXJyb3InO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRFcnJvcihtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmaW5hbGl6ZWRDb250ZXh0O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRFcnJvcihgVW5rbm93biBzdGF0ZTogJHtnZXRTdGF0ZSgpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChnZXRTdGF0ZSgpID09PSBNT05HT0NSWVBUX0NUWF9FUlJPUiB8fCByZXN1bHQgPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFN0YXR1cygpLm1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBkZWJ1ZyhgdW5pZGVudGlmaWFibGUgZXJyb3IgaW4gTW9uZ29DcnlwdCAtIHJlY2VpdmVkIGFuIGVycm9yIHN0YXR1cyBmcm9tIFxcYGxpYm1vbmdvY3J5cHRcXGAgYnV0IHJlY2VpdmVkIG5vIGVycm9yIG1lc3NhZ2UuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEVycm9yKG1lc3NhZ2UgPz9cbiAgICAgICAgICAgICAgICAndW5pZGVudGlmaWFibGUgZXJyb3IgaW4gTW9uZ29DcnlwdCAtIHJlY2VpdmVkIGFuIGVycm9yIHN0YXR1cyBmcm9tIGBsaWJtb25nb2NyeXB0YCBidXQgcmVjZWl2ZWQgbm8gZXJyb3IgbWVzc2FnZS4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHRoZSByZXF1ZXN0IHRvIHRoZSBLTVMgc2VydmljZS4gRXhwb3NlZCBmb3IgdGVzdGluZyBwdXJwb3Nlcy4gRG8gbm90IGRpcmVjdGx5IGludm9rZS5cbiAgICAgKiBAcGFyYW0ga21zQ29udGV4dCAtIEEgQysrIEtNUyBjb250ZXh0IHJldHVybmVkIGZyb20gdGhlIGJpbmRpbmdzXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgS01TIHJlcGx5IGhhcyBiZSBmdWxseSBwYXJzZWRcbiAgICAgKi9cbiAgICBhc3luYyBrbXNSZXF1ZXN0KHJlcXVlc3QsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgcGFyc2VkVXJsID0gcmVxdWVzdC5lbmRwb2ludC5zcGxpdCgnOicpO1xuICAgICAgICBjb25zdCBwb3J0ID0gcGFyc2VkVXJsWzFdICE9IG51bGwgPyBOdW1iZXIucGFyc2VJbnQocGFyc2VkVXJsWzFdLCAxMCkgOiBIVFRQU19QT1JUO1xuICAgICAgICBjb25zdCBzb2NrZXRPcHRpb25zID0ge1xuICAgICAgICAgICAgaG9zdDogcGFyc2VkVXJsWzBdLFxuICAgICAgICAgICAgc2VydmVybmFtZTogcGFyc2VkVXJsWzBdLFxuICAgICAgICAgICAgcG9ydCxcbiAgICAgICAgICAgIC4uLigwLCBjbGllbnRfZW5jcnlwdGlvbl8xLmF1dG9TZWxlY3RTb2NrZXRPcHRpb25zKSh0aGlzLm9wdGlvbnMuc29ja2V0T3B0aW9ucyB8fCB7fSlcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHJlcXVlc3QubWVzc2FnZTtcbiAgICAgICAgY29uc3QgYnVmZmVyID0gbmV3IHV0aWxzXzEuQnVmZmVyUG9vbCgpO1xuICAgICAgICBsZXQgbmV0U29ja2V0O1xuICAgICAgICBsZXQgc29ja2V0O1xuICAgICAgICBmdW5jdGlvbiBkZXN0cm95U29ja2V0cygpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc29jayBvZiBbc29ja2V0LCBuZXRTb2NrZXRdKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNvY2spIHtcbiAgICAgICAgICAgICAgICAgICAgc29jay5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIG9uZXJyb3IoY2F1c2UpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEVycm9yKCdLTVMgcmVxdWVzdCBmYWlsZWQnLCB7IGNhdXNlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIG9uY2xvc2UoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVycm9yc18xLk1vbmdvQ3J5cHRFcnJvcignS01TIHJlcXVlc3QgY2xvc2VkJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGxzT3B0aW9ucyA9IHRoaXMub3B0aW9ucy50bHNPcHRpb25zO1xuICAgICAgICBpZiAodGxzT3B0aW9ucykge1xuICAgICAgICAgICAgY29uc3Qga21zUHJvdmlkZXIgPSByZXF1ZXN0Lmttc1Byb3ZpZGVyO1xuICAgICAgICAgICAgY29uc3QgcHJvdmlkZXJUbHNPcHRpb25zID0gdGxzT3B0aW9uc1trbXNQcm92aWRlcl07XG4gICAgICAgICAgICBpZiAocHJvdmlkZXJUbHNPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB0aGlzLnZhbGlkYXRlVGxzT3B0aW9ucyhrbXNQcm92aWRlciwgcHJvdmlkZXJUbHNPcHRpb25zKTtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2V0VGxzT3B0aW9ucyhwcm92aWRlclRsc09wdGlvbnMsIHNvY2tldE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG9uZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGFib3J0TGlzdGVuZXI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnByb3h5T3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMucHJveHlPcHRpb25zLnByb3h5SG9zdCkge1xuICAgICAgICAgICAgICAgIG5ldFNvY2tldCA9IG5ldyBuZXQuU29ja2V0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwcm9taXNlOiB3aWxsQ29ubmVjdCwgcmVqZWN0OiByZWplY3RPbk5ldFNvY2tldEVycm9yLCByZXNvbHZlOiByZXNvbHZlT25OZXRTb2NrZXRDb25uZWN0IH0gPSAoMCwgdXRpbHNfMS5wcm9taXNlV2l0aFJlc29sdmVycykoKTtcbiAgICAgICAgICAgICAgICBuZXRTb2NrZXRcbiAgICAgICAgICAgICAgICAgICAgLm9uY2UoJ2Vycm9yJywgZXJyID0+IHJlamVjdE9uTmV0U29ja2V0RXJyb3Iob25lcnJvcihlcnIpKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uY2UoJ2Nsb3NlJywgKCkgPT4gcmVqZWN0T25OZXRTb2NrZXRFcnJvcihvbmNsb3NlKCkpKVxuICAgICAgICAgICAgICAgICAgICAub25jZSgnY29ubmVjdCcsICgpID0+IHJlc29sdmVPbk5ldFNvY2tldENvbm5lY3QoKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV0U29ja2V0T3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uc29ja2V0T3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgaG9zdDogdGhpcy5vcHRpb25zLnByb3h5T3B0aW9ucy5wcm94eUhvc3QsXG4gICAgICAgICAgICAgICAgICAgIHBvcnQ6IHRoaXMub3B0aW9ucy5wcm94eU9wdGlvbnMucHJveHlQb3J0IHx8IDEwODBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIG5ldFNvY2tldC5jb25uZWN0KG5ldFNvY2tldE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGF3YWl0IHdpbGxDb25uZWN0O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHNvY2tzID8/PSBsb2FkU29ja3MoKTtcbiAgICAgICAgICAgICAgICAgICAgc29ja2V0T3B0aW9ucy5zb2NrZXQgPSAoYXdhaXQgc29ja3MuU29ja3NDbGllbnQuY3JlYXRlQ29ubmVjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ19zb2NrZXQ6IG5ldFNvY2tldCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQ6ICdjb25uZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB7IGhvc3Q6IHNvY2tldE9wdGlvbnMuaG9zdCwgcG9ydDogc29ja2V0T3B0aW9ucy5wb3J0IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm94eToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhvc3QgYW5kIHBvcnQgYXJlIGlnbm9yZWQgYmVjYXVzZSB3ZSBwYXNzIGV4aXN0aW5nX3NvY2tldFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3Q6ICdpTG92ZUphdmFTY3JpcHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHRoaXMub3B0aW9ucy5wcm94eU9wdGlvbnMucHJveHlVc2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5vcHRpb25zLnByb3h5T3B0aW9ucy5wcm94eVBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pKS5zb2NrZXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNvY2tldCA9IHRscy5jb25uZWN0KHNvY2tldE9wdGlvbnMsICgpID0+IHtcbiAgICAgICAgICAgICAgICBzb2NrZXQud3JpdGUobWVzc2FnZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHsgcHJvbWlzZTogd2lsbFJlc29sdmVLbXNSZXF1ZXN0LCByZWplY3Q6IHJlamVjdE9uVGxzU29ja2V0RXJyb3IsIHJlc29sdmUgfSA9ICgwLCB1dGlsc18xLnByb21pc2VXaXRoUmVzb2x2ZXJzKSgpO1xuICAgICAgICAgICAgYWJvcnRMaXN0ZW5lciA9ICgwLCB1dGlsc18xLmFkZEFib3J0TGlzdGVuZXIpKG9wdGlvbnM/LnNpZ25hbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGRlc3Ryb3lTb2NrZXRzKCk7XG4gICAgICAgICAgICAgICAgcmVqZWN0T25UbHNTb2NrZXRFcnJvcih0aGlzLnJlYXNvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNvY2tldFxuICAgICAgICAgICAgICAgIC5vbmNlKCdlcnJvcicsIGVyciA9PiByZWplY3RPblRsc1NvY2tldEVycm9yKG9uZXJyb3IoZXJyKSkpXG4gICAgICAgICAgICAgICAgLm9uY2UoJ2Nsb3NlJywgKCkgPT4gcmVqZWN0T25UbHNTb2NrZXRFcnJvcihvbmNsb3NlKCkpKVxuICAgICAgICAgICAgICAgIC5vbignZGF0YScsIGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGJ1ZmZlci5hcHBlbmQoZGF0YSk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHJlcXVlc3QuYnl0ZXNOZWVkZWQgPiAwICYmIGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnl0ZXNOZWVkZWQgPSBNYXRoLm1pbihyZXF1ZXN0LmJ5dGVzTmVlZGVkLCBidWZmZXIubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5hZGRSZXNwb25zZShidWZmZXIucmVhZChieXRlc05lZWRlZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5ieXRlc05lZWRlZCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGF3YWl0IChvcHRpb25zPy50aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKVxuICAgICAgICAgICAgICAgID8gUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgICAgICAgICB3aWxsUmVzb2x2ZUttc1JlcXVlc3QsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXRfMS5UaW1lb3V0LmV4cGlyZXMob3B0aW9ucy50aW1lb3V0Q29udGV4dD8ucmVtYWluaW5nVGltZU1TKVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgOiB3aWxsUmVzb2x2ZUttc1JlcXVlc3QpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgdGltZW91dF8xLlRpbWVvdXRFcnJvcilcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcignS01TIHJlcXVlc3QgdGltZWQgb3V0Jyk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIC8vIFRoZXJlJ3Mgbm8gbmVlZCBmb3IgYW55IG1vcmUgYWN0aXZpdHkgb24gdGhpcyBzb2NrZXQgYXQgdGhpcyBwb2ludC5cbiAgICAgICAgICAgIGRlc3Ryb3lTb2NrZXRzKCk7XG4gICAgICAgICAgICBhYm9ydExpc3RlbmVyPy5bdXRpbHNfMS5rRGlzcG9zZV0oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAqcmVxdWVzdHMoY29udGV4dCwgb3B0aW9ucykge1xuICAgICAgICBmb3IgKGxldCByZXF1ZXN0ID0gY29udGV4dC5uZXh0S01TUmVxdWVzdCgpOyByZXF1ZXN0ICE9IG51bGw7IHJlcXVlc3QgPSBjb250ZXh0Lm5leHRLTVNSZXF1ZXN0KCkpIHtcbiAgICAgICAgICAgIHlpZWxkIHRoaXMua21zUmVxdWVzdChyZXF1ZXN0LCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgdGhlIHByb3ZpZGVkIFRMUyBvcHRpb25zIGFyZSBzZWN1cmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ga21zUHJvdmlkZXIgLSBUaGUgS01TIHByb3ZpZGVyIG5hbWUuXG4gICAgICogQHBhcmFtIHRsc09wdGlvbnMgLSBUaGUgY2xpZW50IFRMUyBvcHRpb25zIGZvciB0aGUgcHJvdmlkZXIuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBbiBlcnJvciBpZiBhbnkgb3B0aW9uIGlzIGludmFsaWQuXG4gICAgICovXG4gICAgdmFsaWRhdGVUbHNPcHRpb25zKGttc1Byb3ZpZGVyLCB0bHNPcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHRsc09wdGlvbk5hbWVzID0gT2JqZWN0LmtleXModGxzT3B0aW9ucyk7XG4gICAgICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIElOU0VDVVJFX1RMU19PUFRJT05TKSB7XG4gICAgICAgICAgICBpZiAodGxzT3B0aW9uTmFtZXMuaW5jbHVkZXMob3B0aW9uKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZXJyb3JzXzEuTW9uZ29DcnlwdEVycm9yKGBJbnNlY3VyZSBUTFMgb3B0aW9ucyBwcm9oaWJpdGVkIGZvciAke2ttc1Byb3ZpZGVyfTogJHtvcHRpb259YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyBvbmx5IHRoZSB2YWxpZCBzZWN1cmUgVExTIG9wdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGxzT3B0aW9ucyAtIFRoZSBjbGllbnQgVExTIG9wdGlvbnMgZm9yIHRoZSBwcm92aWRlci5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIFRoZSBleGlzdGluZyBjb25uZWN0aW9uIG9wdGlvbnMuXG4gICAgICovXG4gICAgYXN5bmMgc2V0VGxzT3B0aW9ucyh0bHNPcHRpb25zLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICh0bHNPcHRpb25zLnRsc0NlcnRpZmljYXRlS2V5RmlsZSkge1xuICAgICAgICAgICAgY29uc3QgY2VydCA9IGF3YWl0IGZzLnJlYWRGaWxlKHRsc09wdGlvbnMudGxzQ2VydGlmaWNhdGVLZXlGaWxlKTtcbiAgICAgICAgICAgIG9wdGlvbnMuY2VydCA9IG9wdGlvbnMua2V5ID0gY2VydDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGxzT3B0aW9ucy50bHNDQUZpbGUpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuY2EgPSBhd2FpdCBmcy5yZWFkRmlsZSh0bHNPcHRpb25zLnRsc0NBRmlsZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRsc09wdGlvbnMudGxzQ2VydGlmaWNhdGVLZXlGaWxlUGFzc3dvcmQpIHtcbiAgICAgICAgICAgIG9wdGlvbnMucGFzc3BocmFzZSA9IHRsc09wdGlvbnMudGxzQ2VydGlmaWNhdGVLZXlGaWxlUGFzc3dvcmQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyBjb2xsZWN0aW9uIGluZm8gZm9yIGEgcHJvdmlkZWQgbmFtZXNwYWNlLCB3aGVuIGxpYm1vbmdvY3J5cHRcbiAgICAgKiBlbnRlcnMgdGhlIGBNT05HT0NSWVBUX0NUWF9ORUVEX01PTkdPX0NPTExJTkZPYCBzdGF0ZS4gVGhlIHJlc3VsdCBpc1xuICAgICAqIHVzZWQgdG8gaW5mb3JtIGxpYm1vbmdvY3J5cHQgb2YgdGhlIHNjaGVtYSBhc3NvY2lhdGVkIHdpdGggdGhpc1xuICAgICAqIG5hbWVzcGFjZS4gRXhwb3NlZCBmb3IgdGVzdGluZyBwdXJwb3Nlcy4gRG8gbm90IGRpcmVjdGx5IGludm9rZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjbGllbnQgLSBBIE1vbmdvQ2xpZW50IGNvbm5lY3RlZCB0byB0aGUgdG9wb2xvZ3lcbiAgICAgKiBAcGFyYW0gbnMgLSBUaGUgbmFtZXNwYWNlIHRvIGxpc3QgY29sbGVjdGlvbnMgZnJvbVxuICAgICAqIEBwYXJhbSBmaWx0ZXIgLSBBIGZpbHRlciBmb3IgdGhlIGxpc3RDb2xsZWN0aW9ucyBjb21tYW5kXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIC0gSW52b2tlZCB3aXRoIHRoZSBpbmZvIG9mIHRoZSByZXF1ZXN0ZWQgY29sbGVjdGlvbiwgb3Igd2l0aCBhbiBlcnJvclxuICAgICAqL1xuICAgIGZldGNoQ29sbGVjdGlvbkluZm8oY2xpZW50LCBucywgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHsgZGIgfSA9IHV0aWxzXzEuTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UuZnJvbVN0cmluZyhucyk7XG4gICAgICAgIGNvbnN0IGN1cnNvciA9IGNsaWVudC5kYihkYikubGlzdENvbGxlY3Rpb25zKGZpbHRlciwge1xuICAgICAgICAgICAgcHJvbW90ZUxvbmdzOiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVWYWx1ZXM6IGZhbHNlLFxuICAgICAgICAgICAgdGltZW91dENvbnRleHQ6IG9wdGlvbnM/LnRpbWVvdXRDb250ZXh0ICYmIG5ldyBhYnN0cmFjdF9jdXJzb3JfMS5DdXJzb3JUaW1lb3V0Q29udGV4dChvcHRpb25zPy50aW1lb3V0Q29udGV4dCwgU3ltYm9sKCkpLFxuICAgICAgICAgICAgc2lnbmFsOiBvcHRpb25zPy5zaWduYWwsXG4gICAgICAgICAgICBuYW1lT25seTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjdXJzb3I7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGxzIHRvIHRoZSBtb25nb2NyeXB0ZCB0byBwcm92aWRlIG1hcmtpbmdzIGZvciBhIGNvbW1hbmQuXG4gICAgICogRXhwb3NlZCBmb3IgdGVzdGluZyBwdXJwb3Nlcy4gRG8gbm90IGRpcmVjdGx5IGludm9rZS5cbiAgICAgKiBAcGFyYW0gY2xpZW50IC0gQSBNb25nb0NsaWVudCBjb25uZWN0ZWQgdG8gYSBtb25nb2NyeXB0ZFxuICAgICAqIEBwYXJhbSBucyAtIFRoZSBuYW1lc3BhY2UgKGRhdGFiYXNlLmNvbGxlY3Rpb24pIHRoZSBjb21tYW5kIGlzIGJlaW5nIGV4ZWN1dGVkIG9uXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSBUaGUgY29tbWFuZCB0byBleGVjdXRlLlxuICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIEludm9rZWQgd2l0aCB0aGUgc2VyaWFsaXplZCBhbmQgbWFya2VkIGJzb24gY29tbWFuZCwgb3Igd2l0aCBhbiBlcnJvclxuICAgICAqL1xuICAgIGFzeW5jIG1hcmtDb21tYW5kKGNsaWVudCwgbnMsIGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgeyBkYiB9ID0gdXRpbHNfMS5Nb25nb0RCQ29sbGVjdGlvbk5hbWVzcGFjZS5mcm9tU3RyaW5nKG5zKTtcbiAgICAgICAgY29uc3QgYnNvbk9wdGlvbnMgPSB7IHByb21vdGVMb25nczogZmFsc2UsIHByb21vdGVWYWx1ZXM6IGZhbHNlIH07XG4gICAgICAgIGNvbnN0IHJhd0NvbW1hbmQgPSAoMCwgYnNvbl8xLmRlc2VyaWFsaXplKShjb21tYW5kLCBic29uT3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZW91dE1TOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBzaWduYWw6IHVuZGVmaW5lZFxuICAgICAgICB9O1xuICAgICAgICBpZiAob3B0aW9ucz8udGltZW91dENvbnRleHQ/LmNzb3RFbmFibGVkKCkpIHtcbiAgICAgICAgICAgIGNvbW1hbmRPcHRpb25zLnRpbWVvdXRNUyA9IG9wdGlvbnMudGltZW91dENvbnRleHQucmVtYWluaW5nVGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zPy5zaWduYWwpIHtcbiAgICAgICAgICAgIGNvbW1hbmRPcHRpb25zLnNpZ25hbCA9IG9wdGlvbnMuc2lnbmFsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LmRiKGRiKS5jb21tYW5kKHJhd0NvbW1hbmQsIHtcbiAgICAgICAgICAgIC4uLmJzb25PcHRpb25zLFxuICAgICAgICAgICAgLi4uY29tbWFuZE9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAoMCwgYnNvbl8xLnNlcmlhbGl6ZSkocmVzcG9uc2UsIHRoaXMuYnNvbk9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXF1ZXN0cyBrZXlzIGZyb20gdGhlIGtleVZhdWx0IGNvbGxlY3Rpb24gb24gdGhlIHRvcG9sb2d5LlxuICAgICAqIEV4cG9zZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMuIERvIG5vdCBkaXJlY3RseSBpbnZva2UuXG4gICAgICogQHBhcmFtIGNsaWVudCAtIEEgTW9uZ29DbGllbnQgY29ubmVjdGVkIHRvIHRoZSB0b3BvbG9neVxuICAgICAqIEBwYXJhbSBrZXlWYXVsdE5hbWVzcGFjZSAtIFRoZSBuYW1lc3BhY2UgKGRhdGFiYXNlLmNvbGxlY3Rpb24pIG9mIHRoZSBrZXlWYXVsdCBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgZm9yIHRoZSBmaW5kIHF1ZXJ5IGFnYWluc3QgdGhlIGtleVZhdWx0IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgLSBJbnZva2VkIHdpdGggdGhlIGZvdW5kIGtleXMsIG9yIHdpdGggYW4gZXJyb3JcbiAgICAgKi9cbiAgICBmZXRjaEtleXMoY2xpZW50LCBrZXlWYXVsdE5hbWVzcGFjZSwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHsgZGI6IGRiTmFtZSwgY29sbGVjdGlvbjogY29sbGVjdGlvbk5hbWUgfSA9IHV0aWxzXzEuTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UuZnJvbVN0cmluZyhrZXlWYXVsdE5hbWVzcGFjZSk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZW91dENvbnRleHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNpZ25hbDogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvcHRpb25zPy50aW1lb3V0Q29udGV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb21tYW5kT3B0aW9ucy50aW1lb3V0Q29udGV4dCA9IG5ldyBhYnN0cmFjdF9jdXJzb3JfMS5DdXJzb3JUaW1lb3V0Q29udGV4dChvcHRpb25zLnRpbWVvdXRDb250ZXh0LCBTeW1ib2woKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnM/LnNpZ25hbCAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb21tYW5kT3B0aW9ucy5zaWduYWwgPSBvcHRpb25zLnNpZ25hbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2xpZW50XG4gICAgICAgICAgICAuZGIoZGJOYW1lKVxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUsIHsgcmVhZENvbmNlcm46IHsgbGV2ZWw6ICdtYWpvcml0eScgfSB9KVxuICAgICAgICAgICAgLmZpbmQoKDAsIGJzb25fMS5kZXNlcmlhbGl6ZSkoZmlsdGVyKSwgY29tbWFuZE9wdGlvbnMpXG4gICAgICAgICAgICAudG9BcnJheSgpO1xuICAgIH1cbn1cbmV4cG9ydHMuU3RhdGVNYWNoaW5lID0gU3RhdGVNYWNoaW5lO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RhdGVfbWFjaGluZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/state_machine.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AuthProvider = exports.AuthContext = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/**\n * Context used during authentication\n * @internal\n */\nclass AuthContext {\n    constructor(connection, credentials, options) {\n        /** If the context is for reauthentication. */\n        this.reauthenticating = false;\n        this.connection = connection;\n        this.credentials = credentials;\n        this.options = options;\n    }\n}\nexports.AuthContext = AuthContext;\n/**\n * Provider used during authentication.\n * @internal\n */\nclass AuthProvider {\n    /**\n     * Prepare the handshake document before the initial handshake.\n     *\n     * @param handshakeDoc - The document used for the initial handshake on a connection\n     * @param authContext - Context for authentication flow\n     */\n    async prepare(handshakeDoc, _authContext) {\n        return handshakeDoc;\n    }\n    /**\n     * Reauthenticate.\n     * @param context - The shared auth context.\n     */\n    async reauth(context) {\n        if (context.reauthenticating) {\n            throw new error_1.MongoRuntimeError('Reauthentication already in progress.');\n        }\n        try {\n            context.reauthenticating = true;\n            await this.auth(context);\n        }\n        finally {\n            context.reauthenticating = false;\n        }\n    }\n}\nexports.AuthProvider = AuthProvider;\n//# sourceMappingURL=auth_provider.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9hdXRoX3Byb3ZpZGVyLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG9CQUFvQixHQUFHLG1CQUFtQjtBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9hdXRoX3Byb3ZpZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BdXRoUHJvdmlkZXIgPSBleHBvcnRzLkF1dGhDb250ZXh0ID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbi8qKlxuICogQ29udGV4dCB1c2VkIGR1cmluZyBhdXRoZW50aWNhdGlvblxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIEF1dGhDb250ZXh0IHtcbiAgICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgb3B0aW9ucykge1xuICAgICAgICAvKiogSWYgdGhlIGNvbnRleHQgaXMgZm9yIHJlYXV0aGVudGljYXRpb24uICovXG4gICAgICAgIHRoaXMucmVhdXRoZW50aWNhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHM7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxufVxuZXhwb3J0cy5BdXRoQ29udGV4dCA9IEF1dGhDb250ZXh0O1xuLyoqXG4gKiBQcm92aWRlciB1c2VkIGR1cmluZyBhdXRoZW50aWNhdGlvbi5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBBdXRoUHJvdmlkZXIge1xuICAgIC8qKlxuICAgICAqIFByZXBhcmUgdGhlIGhhbmRzaGFrZSBkb2N1bWVudCBiZWZvcmUgdGhlIGluaXRpYWwgaGFuZHNoYWtlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGhhbmRzaGFrZURvYyAtIFRoZSBkb2N1bWVudCB1c2VkIGZvciB0aGUgaW5pdGlhbCBoYW5kc2hha2Ugb24gYSBjb25uZWN0aW9uXG4gICAgICogQHBhcmFtIGF1dGhDb250ZXh0IC0gQ29udGV4dCBmb3IgYXV0aGVudGljYXRpb24gZmxvd1xuICAgICAqL1xuICAgIGFzeW5jIHByZXBhcmUoaGFuZHNoYWtlRG9jLCBfYXV0aENvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIGhhbmRzaGFrZURvYztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhdXRoZW50aWNhdGUuXG4gICAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgc2hhcmVkIGF1dGggY29udGV4dC5cbiAgICAgKi9cbiAgICBhc3luYyByZWF1dGgoY29udGV4dCkge1xuICAgICAgICBpZiAoY29udGV4dC5yZWF1dGhlbnRpY2F0aW5nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignUmVhdXRoZW50aWNhdGlvbiBhbHJlYWR5IGluIHByb2dyZXNzLicpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb250ZXh0LnJlYXV0aGVudGljYXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoKGNvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgY29udGV4dC5yZWF1dGhlbnRpY2F0aW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkF1dGhQcm92aWRlciA9IEF1dGhQcm92aWRlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1dGhfcHJvdmlkZXIuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/aws_temporary_credentials.js":
/*!***********************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/aws_temporary_credentials.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.LegacyAWSTemporaryCredentialProvider = exports.AWSSDKCredentialProvider = exports.AWSTemporaryCredentialProvider = void 0;\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst AWS_RELATIVE_URI = 'http://169.254.170.2';\nconst AWS_EC2_URI = 'http://169.254.169.254';\nconst AWS_EC2_PATH = '/latest/meta-data/iam/security-credentials';\n/**\n * @internal\n *\n * Fetches temporary AWS credentials.\n */\nclass AWSTemporaryCredentialProvider {\n    static get awsSDK() {\n        AWSTemporaryCredentialProvider._awsSDK ??= (0, deps_1.getAwsCredentialProvider)();\n        return AWSTemporaryCredentialProvider._awsSDK;\n    }\n    static get isAWSSDKInstalled() {\n        return !('kModuleError' in AWSTemporaryCredentialProvider.awsSDK);\n    }\n}\nexports.AWSTemporaryCredentialProvider = AWSTemporaryCredentialProvider;\n/** @internal */\nclass AWSSDKCredentialProvider extends AWSTemporaryCredentialProvider {\n    /**\n     * Create the SDK credentials provider.\n     * @param credentialsProvider - The credentials provider.\n     */\n    constructor(credentialsProvider) {\n        super();\n        if (credentialsProvider) {\n            this._provider = credentialsProvider;\n        }\n    }\n    /**\n     * The AWS SDK caches credentials automatically and handles refresh when the credentials have expired.\n     * To ensure this occurs, we need to cache the `provider` returned by the AWS sdk and re-use it when fetching credentials.\n     */\n    get provider() {\n        if ('kModuleError' in AWSTemporaryCredentialProvider.awsSDK) {\n            throw AWSTemporaryCredentialProvider.awsSDK.kModuleError;\n        }\n        if (this._provider) {\n            return this._provider;\n        }\n        let { AWS_STS_REGIONAL_ENDPOINTS = '', AWS_REGION = '' } = process.env;\n        AWS_STS_REGIONAL_ENDPOINTS = AWS_STS_REGIONAL_ENDPOINTS.toLowerCase();\n        AWS_REGION = AWS_REGION.toLowerCase();\n        /** The option setting should work only for users who have explicit settings in their environment, the driver should not encode \"defaults\" */\n        const awsRegionSettingsExist = AWS_REGION.length !== 0 && AWS_STS_REGIONAL_ENDPOINTS.length !== 0;\n        /**\n         * The following regions use the global AWS STS endpoint, sts.amazonaws.com, by default\n         * https://docs.aws.amazon.com/sdkref/latest/guide/feature-sts-regionalized-endpoints.html\n         */\n        const LEGACY_REGIONS = new Set([\n            'ap-northeast-1',\n            'ap-south-1',\n            'ap-southeast-1',\n            'ap-southeast-2',\n            'aws-global',\n            'ca-central-1',\n            'eu-central-1',\n            'eu-north-1',\n            'eu-west-1',\n            'eu-west-2',\n            'eu-west-3',\n            'sa-east-1',\n            'us-east-1',\n            'us-east-2',\n            'us-west-1',\n            'us-west-2'\n        ]);\n        /**\n         * If AWS_STS_REGIONAL_ENDPOINTS is set to regional, users are opting into the new behavior of respecting the region settings\n         *\n         * If AWS_STS_REGIONAL_ENDPOINTS is set to legacy, then \"old\" regions need to keep using the global setting.\n         * Technically the SDK gets this wrong, it reaches out to 'sts.us-east-1.amazonaws.com' when it should be 'sts.amazonaws.com'.\n         * That is not our bug to fix here. We leave that up to the SDK.\n         */\n        const useRegionalSts = AWS_STS_REGIONAL_ENDPOINTS === 'regional' ||\n            (AWS_STS_REGIONAL_ENDPOINTS === 'legacy' && !LEGACY_REGIONS.has(AWS_REGION));\n        this._provider =\n            awsRegionSettingsExist && useRegionalSts\n                ? AWSTemporaryCredentialProvider.awsSDK.fromNodeProviderChain({\n                    clientConfig: { region: AWS_REGION }\n                })\n                : AWSTemporaryCredentialProvider.awsSDK.fromNodeProviderChain();\n        return this._provider;\n    }\n    async getCredentials() {\n        /*\n         * Creates a credential provider that will attempt to find credentials from the\n         * following sources (listed in order of precedence):\n         *\n         * - Environment variables exposed via process.env\n         * - SSO credentials from token cache\n         * - Web identity token credentials\n         * - Shared credentials and config ini files\n         * - The EC2/ECS Instance Metadata Service\n         */\n        try {\n            const creds = await this.provider();\n            return {\n                AccessKeyId: creds.accessKeyId,\n                SecretAccessKey: creds.secretAccessKey,\n                Token: creds.sessionToken,\n                Expiration: creds.expiration\n            };\n        }\n        catch (error) {\n            throw new error_1.MongoAWSError(error.message, { cause: error });\n        }\n    }\n}\nexports.AWSSDKCredentialProvider = AWSSDKCredentialProvider;\n/**\n * @internal\n * Fetches credentials manually (without the AWS SDK), as outlined in the [Obtaining Credentials](https://github.com/mongodb/specifications/blob/master/source/auth/auth.md#obtaining-credentials)\n * section of the Auth spec.\n */\nclass LegacyAWSTemporaryCredentialProvider extends AWSTemporaryCredentialProvider {\n    async getCredentials() {\n        // If the environment variable AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\n        // is set then drivers MUST assume that it was set by an AWS ECS agent\n        if (process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI) {\n            return await (0, utils_1.request)(`${AWS_RELATIVE_URI}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`);\n        }\n        // Otherwise assume we are on an EC2 instance\n        // get a token\n        const token = await (0, utils_1.request)(`${AWS_EC2_URI}/latest/api/token`, {\n            method: 'PUT',\n            json: false,\n            headers: { 'X-aws-ec2-metadata-token-ttl-seconds': 30 }\n        });\n        // get role name\n        const roleName = await (0, utils_1.request)(`${AWS_EC2_URI}/${AWS_EC2_PATH}`, {\n            json: false,\n            headers: { 'X-aws-ec2-metadata-token': token }\n        });\n        // get temp credentials\n        const creds = await (0, utils_1.request)(`${AWS_EC2_URI}/${AWS_EC2_PATH}/${roleName}`, {\n            headers: { 'X-aws-ec2-metadata-token': token }\n        });\n        return creds;\n    }\n}\nexports.LegacyAWSTemporaryCredentialProvider = LegacyAWSTemporaryCredentialProvider;\n//# sourceMappingURL=aws_temporary_credentials.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9hd3NfdGVtcG9yYXJ5X2NyZWRlbnRpYWxzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDRDQUE0QyxHQUFHLGdDQUFnQyxHQUFHLHNDQUFzQztBQUN4SCxlQUFlLG1CQUFPLENBQUMsOEZBQVk7QUFDbkMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxtREFBbUQ7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQyxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELGNBQWM7QUFDM0U7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGlCQUFpQixFQUFFLG1EQUFtRDtBQUN2SDtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsWUFBWTtBQUNoRTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCLFNBQVM7QUFDVDtBQUNBLHVEQUF1RCxZQUFZLEdBQUcsYUFBYTtBQUNuRjtBQUNBLHVCQUF1QjtBQUN2QixTQUFTO0FBQ1Q7QUFDQSxvREFBb0QsWUFBWSxHQUFHLGFBQWEsR0FBRyxTQUFTO0FBQzVGLHVCQUF1QjtBQUN2QixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9hdXRoL2F3c190ZW1wb3JhcnlfY3JlZGVudGlhbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxlZ2FjeUFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlciA9IGV4cG9ydHMuQVdTU0RLQ3JlZGVudGlhbFByb3ZpZGVyID0gZXhwb3J0cy5BV1NUZW1wb3JhcnlDcmVkZW50aWFsUHJvdmlkZXIgPSB2b2lkIDA7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vLi4vZGVwc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuY29uc3QgQVdTX1JFTEFUSVZFX1VSSSA9ICdodHRwOi8vMTY5LjI1NC4xNzAuMic7XG5jb25zdCBBV1NfRUMyX1VSSSA9ICdodHRwOi8vMTY5LjI1NC4xNjkuMjU0JztcbmNvbnN0IEFXU19FQzJfUEFUSCA9ICcvbGF0ZXN0L21ldGEtZGF0YS9pYW0vc2VjdXJpdHktY3JlZGVudGlhbHMnO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqXG4gKiBGZXRjaGVzIHRlbXBvcmFyeSBBV1MgY3JlZGVudGlhbHMuXG4gKi9cbmNsYXNzIEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlciB7XG4gICAgc3RhdGljIGdldCBhd3NTREsoKSB7XG4gICAgICAgIEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlci5fYXdzU0RLID8/PSAoMCwgZGVwc18xLmdldEF3c0NyZWRlbnRpYWxQcm92aWRlcikoKTtcbiAgICAgICAgcmV0dXJuIEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlci5fYXdzU0RLO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IGlzQVdTU0RLSW5zdGFsbGVkKCkge1xuICAgICAgICByZXR1cm4gISgna01vZHVsZUVycm9yJyBpbiBBV1NUZW1wb3JhcnlDcmVkZW50aWFsUHJvdmlkZXIuYXdzU0RLKTtcbiAgICB9XG59XG5leHBvcnRzLkFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlciA9IEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlcjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEFXU1NES0NyZWRlbnRpYWxQcm92aWRlciBleHRlbmRzIEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSBTREsgY3JlZGVudGlhbHMgcHJvdmlkZXIuXG4gICAgICogQHBhcmFtIGNyZWRlbnRpYWxzUHJvdmlkZXIgLSBUaGUgY3JlZGVudGlhbHMgcHJvdmlkZXIuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY3JlZGVudGlhbHNQcm92aWRlcikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBpZiAoY3JlZGVudGlhbHNQcm92aWRlcikge1xuICAgICAgICAgICAgdGhpcy5fcHJvdmlkZXIgPSBjcmVkZW50aWFsc1Byb3ZpZGVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBBV1MgU0RLIGNhY2hlcyBjcmVkZW50aWFscyBhdXRvbWF0aWNhbGx5IGFuZCBoYW5kbGVzIHJlZnJlc2ggd2hlbiB0aGUgY3JlZGVudGlhbHMgaGF2ZSBleHBpcmVkLlxuICAgICAqIFRvIGVuc3VyZSB0aGlzIG9jY3Vycywgd2UgbmVlZCB0byBjYWNoZSB0aGUgYHByb3ZpZGVyYCByZXR1cm5lZCBieSB0aGUgQVdTIHNkayBhbmQgcmUtdXNlIGl0IHdoZW4gZmV0Y2hpbmcgY3JlZGVudGlhbHMuXG4gICAgICovXG4gICAgZ2V0IHByb3ZpZGVyKCkge1xuICAgICAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4gQVdTVGVtcG9yYXJ5Q3JlZGVudGlhbFByb3ZpZGVyLmF3c1NESykge1xuICAgICAgICAgICAgdGhyb3cgQVdTVGVtcG9yYXJ5Q3JlZGVudGlhbFByb3ZpZGVyLmF3c1NESy5rTW9kdWxlRXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3Byb3ZpZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvdmlkZXI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHsgQVdTX1NUU19SRUdJT05BTF9FTkRQT0lOVFMgPSAnJywgQVdTX1JFR0lPTiA9ICcnIH0gPSBwcm9jZXNzLmVudjtcbiAgICAgICAgQVdTX1NUU19SRUdJT05BTF9FTkRQT0lOVFMgPSBBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBBV1NfUkVHSU9OID0gQVdTX1JFR0lPTi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAvKiogVGhlIG9wdGlvbiBzZXR0aW5nIHNob3VsZCB3b3JrIG9ubHkgZm9yIHVzZXJzIHdobyBoYXZlIGV4cGxpY2l0IHNldHRpbmdzIGluIHRoZWlyIGVudmlyb25tZW50LCB0aGUgZHJpdmVyIHNob3VsZCBub3QgZW5jb2RlIFwiZGVmYXVsdHNcIiAqL1xuICAgICAgICBjb25zdCBhd3NSZWdpb25TZXR0aW5nc0V4aXN0ID0gQVdTX1JFR0lPTi5sZW5ndGggIT09IDAgJiYgQVdTX1NUU19SRUdJT05BTF9FTkRQT0lOVFMubGVuZ3RoICE9PSAwO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbGxvd2luZyByZWdpb25zIHVzZSB0aGUgZ2xvYmFsIEFXUyBTVFMgZW5kcG9pbnQsIHN0cy5hbWF6b25hd3MuY29tLCBieSBkZWZhdWx0XG4gICAgICAgICAqIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9zZGtyZWYvbGF0ZXN0L2d1aWRlL2ZlYXR1cmUtc3RzLXJlZ2lvbmFsaXplZC1lbmRwb2ludHMuaHRtbFxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgTEVHQUNZX1JFR0lPTlMgPSBuZXcgU2V0KFtcbiAgICAgICAgICAgICdhcC1ub3J0aGVhc3QtMScsXG4gICAgICAgICAgICAnYXAtc291dGgtMScsXG4gICAgICAgICAgICAnYXAtc291dGhlYXN0LTEnLFxuICAgICAgICAgICAgJ2FwLXNvdXRoZWFzdC0yJyxcbiAgICAgICAgICAgICdhd3MtZ2xvYmFsJyxcbiAgICAgICAgICAgICdjYS1jZW50cmFsLTEnLFxuICAgICAgICAgICAgJ2V1LWNlbnRyYWwtMScsXG4gICAgICAgICAgICAnZXUtbm9ydGgtMScsXG4gICAgICAgICAgICAnZXUtd2VzdC0xJyxcbiAgICAgICAgICAgICdldS13ZXN0LTInLFxuICAgICAgICAgICAgJ2V1LXdlc3QtMycsXG4gICAgICAgICAgICAnc2EtZWFzdC0xJyxcbiAgICAgICAgICAgICd1cy1lYXN0LTEnLFxuICAgICAgICAgICAgJ3VzLWVhc3QtMicsXG4gICAgICAgICAgICAndXMtd2VzdC0xJyxcbiAgICAgICAgICAgICd1cy13ZXN0LTInXG4gICAgICAgIF0pO1xuICAgICAgICAvKipcbiAgICAgICAgICogSWYgQVdTX1NUU19SRUdJT05BTF9FTkRQT0lOVFMgaXMgc2V0IHRvIHJlZ2lvbmFsLCB1c2VycyBhcmUgb3B0aW5nIGludG8gdGhlIG5ldyBiZWhhdmlvciBvZiByZXNwZWN0aW5nIHRoZSByZWdpb24gc2V0dGluZ3NcbiAgICAgICAgICpcbiAgICAgICAgICogSWYgQVdTX1NUU19SRUdJT05BTF9FTkRQT0lOVFMgaXMgc2V0IHRvIGxlZ2FjeSwgdGhlbiBcIm9sZFwiIHJlZ2lvbnMgbmVlZCB0byBrZWVwIHVzaW5nIHRoZSBnbG9iYWwgc2V0dGluZy5cbiAgICAgICAgICogVGVjaG5pY2FsbHkgdGhlIFNESyBnZXRzIHRoaXMgd3JvbmcsIGl0IHJlYWNoZXMgb3V0IHRvICdzdHMudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20nIHdoZW4gaXQgc2hvdWxkIGJlICdzdHMuYW1hem9uYXdzLmNvbScuXG4gICAgICAgICAqIFRoYXQgaXMgbm90IG91ciBidWcgdG8gZml4IGhlcmUuIFdlIGxlYXZlIHRoYXQgdXAgdG8gdGhlIFNESy5cbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IHVzZVJlZ2lvbmFsU3RzID0gQVdTX1NUU19SRUdJT05BTF9FTkRQT0lOVFMgPT09ICdyZWdpb25hbCcgfHxcbiAgICAgICAgICAgIChBV1NfU1RTX1JFR0lPTkFMX0VORFBPSU5UUyA9PT0gJ2xlZ2FjeScgJiYgIUxFR0FDWV9SRUdJT05TLmhhcyhBV1NfUkVHSU9OKSk7XG4gICAgICAgIHRoaXMuX3Byb3ZpZGVyID1cbiAgICAgICAgICAgIGF3c1JlZ2lvblNldHRpbmdzRXhpc3QgJiYgdXNlUmVnaW9uYWxTdHNcbiAgICAgICAgICAgICAgICA/IEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlci5hd3NTREsuZnJvbU5vZGVQcm92aWRlckNoYWluKHtcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnOiB7IHJlZ2lvbjogQVdTX1JFR0lPTiB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6IEFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlci5hd3NTREsuZnJvbU5vZGVQcm92aWRlckNoYWluKCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9wcm92aWRlcjtcbiAgICB9XG4gICAgYXN5bmMgZ2V0Q3JlZGVudGlhbHMoKSB7XG4gICAgICAgIC8qXG4gICAgICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIHByb3ZpZGVyIHRoYXQgd2lsbCBhdHRlbXB0IHRvIGZpbmQgY3JlZGVudGlhbHMgZnJvbSB0aGVcbiAgICAgICAgICogZm9sbG93aW5nIHNvdXJjZXMgKGxpc3RlZCBpbiBvcmRlciBvZiBwcmVjZWRlbmNlKTpcbiAgICAgICAgICpcbiAgICAgICAgICogLSBFbnZpcm9ubWVudCB2YXJpYWJsZXMgZXhwb3NlZCB2aWEgcHJvY2Vzcy5lbnZcbiAgICAgICAgICogLSBTU08gY3JlZGVudGlhbHMgZnJvbSB0b2tlbiBjYWNoZVxuICAgICAgICAgKiAtIFdlYiBpZGVudGl0eSB0b2tlbiBjcmVkZW50aWFsc1xuICAgICAgICAgKiAtIFNoYXJlZCBjcmVkZW50aWFscyBhbmQgY29uZmlnIGluaSBmaWxlc1xuICAgICAgICAgKiAtIFRoZSBFQzIvRUNTIEluc3RhbmNlIE1ldGFkYXRhIFNlcnZpY2VcbiAgICAgICAgICovXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBjcmVkcyA9IGF3YWl0IHRoaXMucHJvdmlkZXIoKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgQWNjZXNzS2V5SWQ6IGNyZWRzLmFjY2Vzc0tleUlkLFxuICAgICAgICAgICAgICAgIFNlY3JldEFjY2Vzc0tleTogY3JlZHMuc2VjcmV0QWNjZXNzS2V5LFxuICAgICAgICAgICAgICAgIFRva2VuOiBjcmVkcy5zZXNzaW9uVG9rZW4sXG4gICAgICAgICAgICAgICAgRXhwaXJhdGlvbjogY3JlZHMuZXhwaXJhdGlvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVdTRXJyb3IoZXJyb3IubWVzc2FnZSwgeyBjYXVzZTogZXJyb3IgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkFXU1NES0NyZWRlbnRpYWxQcm92aWRlciA9IEFXU1NES0NyZWRlbnRpYWxQcm92aWRlcjtcbi8qKlxuICogQGludGVybmFsXG4gKiBGZXRjaGVzIGNyZWRlbnRpYWxzIG1hbnVhbGx5ICh3aXRob3V0IHRoZSBBV1MgU0RLKSwgYXMgb3V0bGluZWQgaW4gdGhlIFtPYnRhaW5pbmcgQ3JlZGVudGlhbHNdKGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9hdXRoL2F1dGgubWQjb2J0YWluaW5nLWNyZWRlbnRpYWxzKVxuICogc2VjdGlvbiBvZiB0aGUgQXV0aCBzcGVjLlxuICovXG5jbGFzcyBMZWdhY3lBV1NUZW1wb3JhcnlDcmVkZW50aWFsUHJvdmlkZXIgZXh0ZW5kcyBBV1NUZW1wb3JhcnlDcmVkZW50aWFsUHJvdmlkZXIge1xuICAgIGFzeW5jIGdldENyZWRlbnRpYWxzKCkge1xuICAgICAgICAvLyBJZiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGUgQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19SRUxBVElWRV9VUklcbiAgICAgICAgLy8gaXMgc2V0IHRoZW4gZHJpdmVycyBNVVNUIGFzc3VtZSB0aGF0IGl0IHdhcyBzZXQgYnkgYW4gQVdTIEVDUyBhZ2VudFxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19SRUxBVElWRV9VUkkpIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCAoMCwgdXRpbHNfMS5yZXF1ZXN0KShgJHtBV1NfUkVMQVRJVkVfVVJJfSR7cHJvY2Vzcy5lbnYuQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19SRUxBVElWRV9VUkl9YCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3RoZXJ3aXNlIGFzc3VtZSB3ZSBhcmUgb24gYW4gRUMyIGluc3RhbmNlXG4gICAgICAgIC8vIGdldCBhIHRva2VuXG4gICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgKDAsIHV0aWxzXzEucmVxdWVzdCkoYCR7QVdTX0VDMl9VUkl9L2xhdGVzdC9hcGkvdG9rZW5gLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAganNvbjogZmFsc2UsXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdYLWF3cy1lYzItbWV0YWRhdGEtdG9rZW4tdHRsLXNlY29uZHMnOiAzMCB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBnZXQgcm9sZSBuYW1lXG4gICAgICAgIGNvbnN0IHJvbGVOYW1lID0gYXdhaXQgKDAsIHV0aWxzXzEucmVxdWVzdCkoYCR7QVdTX0VDMl9VUkl9LyR7QVdTX0VDMl9QQVRIfWAsIHtcbiAgICAgICAgICAgIGpzb246IGZhbHNlLFxuICAgICAgICAgICAgaGVhZGVyczogeyAnWC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuJzogdG9rZW4gfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZ2V0IHRlbXAgY3JlZGVudGlhbHNcbiAgICAgICAgY29uc3QgY3JlZHMgPSBhd2FpdCAoMCwgdXRpbHNfMS5yZXF1ZXN0KShgJHtBV1NfRUMyX1VSSX0vJHtBV1NfRUMyX1BBVEh9LyR7cm9sZU5hbWV9YCwge1xuICAgICAgICAgICAgaGVhZGVyczogeyAnWC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuJzogdG9rZW4gfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNyZWRzO1xuICAgIH1cbn1cbmV4cG9ydHMuTGVnYWN5QVdTVGVtcG9yYXJ5Q3JlZGVudGlhbFByb3ZpZGVyID0gTGVnYWN5QVdTVGVtcG9yYXJ5Q3JlZGVudGlhbFByb3ZpZGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXdzX3RlbXBvcmFyeV9jcmVkZW50aWFscy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/aws_temporary_credentials.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/gssapi.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/gssapi.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GSSAPI = exports.GSSAPICanonicalizationValue = void 0;\nexports.performGSSAPICanonicalizeHostName = performGSSAPICanonicalizeHostName;\nexports.resolveCname = resolveCname;\nconst dns = __webpack_require__(/*! dns */ \"dns\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\n/** @public */\nexports.GSSAPICanonicalizationValue = Object.freeze({\n    on: true,\n    off: false,\n    none: 'none',\n    forward: 'forward',\n    forwardAndReverse: 'forwardAndReverse'\n});\nasync function externalCommand(connection, command) {\n    const response = await connection.command((0, utils_1.ns)('$external.$cmd'), command);\n    return response;\n}\nlet krb;\nclass GSSAPI extends auth_provider_1.AuthProvider {\n    async auth(authContext) {\n        const { connection, credentials } = authContext;\n        if (credentials == null) {\n            throw new error_1.MongoMissingCredentialsError('Credentials required for GSSAPI authentication');\n        }\n        const { username } = credentials;\n        const client = await makeKerberosClient(authContext);\n        const payload = await client.step('');\n        const saslStartResponse = await externalCommand(connection, saslStart(payload));\n        const negotiatedPayload = await negotiate(client, 10, saslStartResponse.payload);\n        const saslContinueResponse = await externalCommand(connection, saslContinue(negotiatedPayload, saslStartResponse.conversationId));\n        const finalizePayload = await finalize(client, username, saslContinueResponse.payload);\n        await externalCommand(connection, {\n            saslContinue: 1,\n            conversationId: saslContinueResponse.conversationId,\n            payload: finalizePayload\n        });\n    }\n}\nexports.GSSAPI = GSSAPI;\nasync function makeKerberosClient(authContext) {\n    const { hostAddress } = authContext.options;\n    const { credentials } = authContext;\n    if (!hostAddress || typeof hostAddress.host !== 'string' || !credentials) {\n        throw new error_1.MongoInvalidArgumentError('Connection must have host and port and credentials defined.');\n    }\n    loadKrb();\n    if ('kModuleError' in krb) {\n        throw krb['kModuleError'];\n    }\n    const { initializeClient } = krb;\n    const { username, password } = credentials;\n    const mechanismProperties = credentials.mechanismProperties;\n    const serviceName = mechanismProperties.SERVICE_NAME ?? 'mongodb';\n    const host = await performGSSAPICanonicalizeHostName(hostAddress.host, mechanismProperties);\n    const initOptions = {};\n    if (password != null) {\n        // TODO(NODE-5139): These do not match the typescript options in initializeClient\n        Object.assign(initOptions, { user: username, password: password });\n    }\n    const spnHost = mechanismProperties.SERVICE_HOST ?? host;\n    let spn = `${serviceName}${process.platform === 'win32' ? '/' : '@'}${spnHost}`;\n    if ('SERVICE_REALM' in mechanismProperties) {\n        spn = `${spn}@${mechanismProperties.SERVICE_REALM}`;\n    }\n    return await initializeClient(spn, initOptions);\n}\nfunction saslStart(payload) {\n    return {\n        saslStart: 1,\n        mechanism: 'GSSAPI',\n        payload,\n        autoAuthorize: 1\n    };\n}\nfunction saslContinue(payload, conversationId) {\n    return {\n        saslContinue: 1,\n        conversationId,\n        payload\n    };\n}\nasync function negotiate(client, retries, payload) {\n    try {\n        const response = await client.step(payload);\n        return response || '';\n    }\n    catch (error) {\n        if (retries === 0) {\n            // Retries exhausted, raise error\n            throw error;\n        }\n        // Adjust number of retries and call step again\n        return await negotiate(client, retries - 1, payload);\n    }\n}\nasync function finalize(client, user, payload) {\n    // GSS Client Unwrap\n    const response = await client.unwrap(payload);\n    return await client.wrap(response || '', { user });\n}\nasync function performGSSAPICanonicalizeHostName(host, mechanismProperties) {\n    const mode = mechanismProperties.CANONICALIZE_HOST_NAME;\n    if (!mode || mode === exports.GSSAPICanonicalizationValue.none) {\n        return host;\n    }\n    // If forward and reverse or true\n    if (mode === exports.GSSAPICanonicalizationValue.on ||\n        mode === exports.GSSAPICanonicalizationValue.forwardAndReverse) {\n        // Perform the lookup of the ip address.\n        const { address } = await dns.promises.lookup(host);\n        try {\n            // Perform a reverse ptr lookup on the ip address.\n            const results = await dns.promises.resolvePtr(address);\n            // If the ptr did not error but had no results, return the host.\n            return results.length > 0 ? results[0] : host;\n        }\n        catch {\n            // This can error as ptr records may not exist for all ips. In this case\n            // fallback to a cname lookup as dns.lookup() does not return the\n            // cname.\n            return await resolveCname(host);\n        }\n    }\n    else {\n        // The case for forward is just to resolve the cname as dns.lookup()\n        // will not return it.\n        return await resolveCname(host);\n    }\n}\nasync function resolveCname(host) {\n    // Attempt to resolve the host name\n    try {\n        const results = await dns.promises.resolveCname(host);\n        // Get the first resolved host id\n        return results.length > 0 ? results[0] : host;\n    }\n    catch {\n        return host;\n    }\n}\n/**\n * Load the Kerberos library.\n */\nfunction loadKrb() {\n    if (!krb) {\n        krb = (0, deps_1.getKerberos)();\n    }\n}\n//# sourceMappingURL=gssapi.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9nc3NhcGkuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsY0FBYyxHQUFHLG1DQUFtQztBQUNwRCx5Q0FBeUM7QUFDekMsb0JBQW9CO0FBQ3BCLFlBQVksbUJBQU8sQ0FBQyxnQkFBSztBQUN6QixlQUFlLG1CQUFPLENBQUMsOEZBQVk7QUFDbkMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsd0JBQXdCLG1CQUFPLENBQUMsc0hBQWlCO0FBQ2pEO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMEJBQTBCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixXQUFXO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxZQUFZLGNBQWM7QUFDMUIsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtQkFBbUI7QUFDL0IsWUFBWSxxQkFBcUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLG9DQUFvQztBQUN6RTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVksRUFBRSx5Q0FBeUMsRUFBRSxRQUFRO0FBQ2xGO0FBQ0EsaUJBQWlCLElBQUksR0FBRyxrQ0FBa0M7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxNQUFNO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9hdXRoL2dzc2FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuR1NTQVBJID0gZXhwb3J0cy5HU1NBUElDYW5vbmljYWxpemF0aW9uVmFsdWUgPSB2b2lkIDA7XG5leHBvcnRzLnBlcmZvcm1HU1NBUElDYW5vbmljYWxpemVIb3N0TmFtZSA9IHBlcmZvcm1HU1NBUElDYW5vbmljYWxpemVIb3N0TmFtZTtcbmV4cG9ydHMucmVzb2x2ZUNuYW1lID0gcmVzb2x2ZUNuYW1lO1xuY29uc3QgZG5zID0gcmVxdWlyZShcImRuc1wiKTtcbmNvbnN0IGRlcHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9kZXBzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG5jb25zdCBhdXRoX3Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9hdXRoX3Byb3ZpZGVyXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgb246IHRydWUsXG4gICAgb2ZmOiBmYWxzZSxcbiAgICBub25lOiAnbm9uZScsXG4gICAgZm9yd2FyZDogJ2ZvcndhcmQnLFxuICAgIGZvcndhcmRBbmRSZXZlcnNlOiAnZm9yd2FyZEFuZFJldmVyc2UnXG59KTtcbmFzeW5jIGZ1bmN0aW9uIGV4dGVybmFsQ29tbWFuZChjb25uZWN0aW9uLCBjb21tYW5kKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKCckZXh0ZXJuYWwuJGNtZCcpLCBjb21tYW5kKTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5sZXQga3JiO1xuY2xhc3MgR1NTQVBJIGV4dGVuZHMgYXV0aF9wcm92aWRlcl8xLkF1dGhQcm92aWRlciB7XG4gICAgYXN5bmMgYXV0aChhdXRoQ29udGV4dCkge1xuICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzIH0gPSBhdXRoQ29udGV4dDtcbiAgICAgICAgaWYgKGNyZWRlbnRpYWxzID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoJ0NyZWRlbnRpYWxzIHJlcXVpcmVkIGZvciBHU1NBUEkgYXV0aGVudGljYXRpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHVzZXJuYW1lIH0gPSBjcmVkZW50aWFscztcbiAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgbWFrZUtlcmJlcm9zQ2xpZW50KGF1dGhDb250ZXh0KTtcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IGNsaWVudC5zdGVwKCcnKTtcbiAgICAgICAgY29uc3Qgc2FzbFN0YXJ0UmVzcG9uc2UgPSBhd2FpdCBleHRlcm5hbENvbW1hbmQoY29ubmVjdGlvbiwgc2FzbFN0YXJ0KHBheWxvYWQpKTtcbiAgICAgICAgY29uc3QgbmVnb3RpYXRlZFBheWxvYWQgPSBhd2FpdCBuZWdvdGlhdGUoY2xpZW50LCAxMCwgc2FzbFN0YXJ0UmVzcG9uc2UucGF5bG9hZCk7XG4gICAgICAgIGNvbnN0IHNhc2xDb250aW51ZVJlc3BvbnNlID0gYXdhaXQgZXh0ZXJuYWxDb21tYW5kKGNvbm5lY3Rpb24sIHNhc2xDb250aW51ZShuZWdvdGlhdGVkUGF5bG9hZCwgc2FzbFN0YXJ0UmVzcG9uc2UuY29udmVyc2F0aW9uSWQpKTtcbiAgICAgICAgY29uc3QgZmluYWxpemVQYXlsb2FkID0gYXdhaXQgZmluYWxpemUoY2xpZW50LCB1c2VybmFtZSwgc2FzbENvbnRpbnVlUmVzcG9uc2UucGF5bG9hZCk7XG4gICAgICAgIGF3YWl0IGV4dGVybmFsQ29tbWFuZChjb25uZWN0aW9uLCB7XG4gICAgICAgICAgICBzYXNsQ29udGludWU6IDEsXG4gICAgICAgICAgICBjb252ZXJzYXRpb25JZDogc2FzbENvbnRpbnVlUmVzcG9uc2UuY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgICBwYXlsb2FkOiBmaW5hbGl6ZVBheWxvYWRcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5HU1NBUEkgPSBHU1NBUEk7XG5hc3luYyBmdW5jdGlvbiBtYWtlS2VyYmVyb3NDbGllbnQoYXV0aENvbnRleHQpIHtcbiAgICBjb25zdCB7IGhvc3RBZGRyZXNzIH0gPSBhdXRoQ29udGV4dC5vcHRpb25zO1xuICAgIGNvbnN0IHsgY3JlZGVudGlhbHMgfSA9IGF1dGhDb250ZXh0O1xuICAgIGlmICghaG9zdEFkZHJlc3MgfHwgdHlwZW9mIGhvc3RBZGRyZXNzLmhvc3QgIT09ICdzdHJpbmcnIHx8ICFjcmVkZW50aWFscykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDb25uZWN0aW9uIG11c3QgaGF2ZSBob3N0IGFuZCBwb3J0IGFuZCBjcmVkZW50aWFscyBkZWZpbmVkLicpO1xuICAgIH1cbiAgICBsb2FkS3JiKCk7XG4gICAgaWYgKCdrTW9kdWxlRXJyb3InIGluIGtyYikge1xuICAgICAgICB0aHJvdyBrcmJbJ2tNb2R1bGVFcnJvciddO1xuICAgIH1cbiAgICBjb25zdCB7IGluaXRpYWxpemVDbGllbnQgfSA9IGtyYjtcbiAgICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gY3JlZGVudGlhbHM7XG4gICAgY29uc3QgbWVjaGFuaXNtUHJvcGVydGllcyA9IGNyZWRlbnRpYWxzLm1lY2hhbmlzbVByb3BlcnRpZXM7XG4gICAgY29uc3Qgc2VydmljZU5hbWUgPSBtZWNoYW5pc21Qcm9wZXJ0aWVzLlNFUlZJQ0VfTkFNRSA/PyAnbW9uZ29kYic7XG4gICAgY29uc3QgaG9zdCA9IGF3YWl0IHBlcmZvcm1HU1NBUElDYW5vbmljYWxpemVIb3N0TmFtZShob3N0QWRkcmVzcy5ob3N0LCBtZWNoYW5pc21Qcm9wZXJ0aWVzKTtcbiAgICBjb25zdCBpbml0T3B0aW9ucyA9IHt9O1xuICAgIGlmIChwYXNzd29yZCAhPSBudWxsKSB7XG4gICAgICAgIC8vIFRPRE8oTk9ERS01MTM5KTogVGhlc2UgZG8gbm90IG1hdGNoIHRoZSB0eXBlc2NyaXB0IG9wdGlvbnMgaW4gaW5pdGlhbGl6ZUNsaWVudFxuICAgICAgICBPYmplY3QuYXNzaWduKGluaXRPcHRpb25zLCB7IHVzZXI6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmQgfSk7XG4gICAgfVxuICAgIGNvbnN0IHNwbkhvc3QgPSBtZWNoYW5pc21Qcm9wZXJ0aWVzLlNFUlZJQ0VfSE9TVCA/PyBob3N0O1xuICAgIGxldCBzcG4gPSBgJHtzZXJ2aWNlTmFtZX0ke3Byb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicgPyAnLycgOiAnQCd9JHtzcG5Ib3N0fWA7XG4gICAgaWYgKCdTRVJWSUNFX1JFQUxNJyBpbiBtZWNoYW5pc21Qcm9wZXJ0aWVzKSB7XG4gICAgICAgIHNwbiA9IGAke3Nwbn1AJHttZWNoYW5pc21Qcm9wZXJ0aWVzLlNFUlZJQ0VfUkVBTE19YDtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IGluaXRpYWxpemVDbGllbnQoc3BuLCBpbml0T3B0aW9ucyk7XG59XG5mdW5jdGlvbiBzYXNsU3RhcnQocGF5bG9hZCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHNhc2xTdGFydDogMSxcbiAgICAgICAgbWVjaGFuaXNtOiAnR1NTQVBJJyxcbiAgICAgICAgcGF5bG9hZCxcbiAgICAgICAgYXV0b0F1dGhvcml6ZTogMVxuICAgIH07XG59XG5mdW5jdGlvbiBzYXNsQ29udGludWUocGF5bG9hZCwgY29udmVyc2F0aW9uSWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBzYXNsQ29udGludWU6IDEsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgICBwYXlsb2FkXG4gICAgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIG5lZ290aWF0ZShjbGllbnQsIHJldHJpZXMsIHBheWxvYWQpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5zdGVwKHBheWxvYWQpO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJyc7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAocmV0cmllcyA9PT0gMCkge1xuICAgICAgICAgICAgLy8gUmV0cmllcyBleGhhdXN0ZWQsIHJhaXNlIGVycm9yXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICAvLyBBZGp1c3QgbnVtYmVyIG9mIHJldHJpZXMgYW5kIGNhbGwgc3RlcCBhZ2FpblxuICAgICAgICByZXR1cm4gYXdhaXQgbmVnb3RpYXRlKGNsaWVudCwgcmV0cmllcyAtIDEsIHBheWxvYWQpO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIGZpbmFsaXplKGNsaWVudCwgdXNlciwgcGF5bG9hZCkge1xuICAgIC8vIEdTUyBDbGllbnQgVW53cmFwXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQudW53cmFwKHBheWxvYWQpO1xuICAgIHJldHVybiBhd2FpdCBjbGllbnQud3JhcChyZXNwb25zZSB8fCAnJywgeyB1c2VyIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUdTU0FQSUNhbm9uaWNhbGl6ZUhvc3ROYW1lKGhvc3QsIG1lY2hhbmlzbVByb3BlcnRpZXMpIHtcbiAgICBjb25zdCBtb2RlID0gbWVjaGFuaXNtUHJvcGVydGllcy5DQU5PTklDQUxJWkVfSE9TVF9OQU1FO1xuICAgIGlmICghbW9kZSB8fCBtb2RlID09PSBleHBvcnRzLkdTU0FQSUNhbm9uaWNhbGl6YXRpb25WYWx1ZS5ub25lKSB7XG4gICAgICAgIHJldHVybiBob3N0O1xuICAgIH1cbiAgICAvLyBJZiBmb3J3YXJkIGFuZCByZXZlcnNlIG9yIHRydWVcbiAgICBpZiAobW9kZSA9PT0gZXhwb3J0cy5HU1NBUElDYW5vbmljYWxpemF0aW9uVmFsdWUub24gfHxcbiAgICAgICAgbW9kZSA9PT0gZXhwb3J0cy5HU1NBUElDYW5vbmljYWxpemF0aW9uVmFsdWUuZm9yd2FyZEFuZFJldmVyc2UpIHtcbiAgICAgICAgLy8gUGVyZm9ybSB0aGUgbG9va3VwIG9mIHRoZSBpcCBhZGRyZXNzLlxuICAgICAgICBjb25zdCB7IGFkZHJlc3MgfSA9IGF3YWl0IGRucy5wcm9taXNlcy5sb29rdXAoaG9zdCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBQZXJmb3JtIGEgcmV2ZXJzZSBwdHIgbG9va3VwIG9uIHRoZSBpcCBhZGRyZXNzLlxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGRucy5wcm9taXNlcy5yZXNvbHZlUHRyKGFkZHJlc3MpO1xuICAgICAgICAgICAgLy8gSWYgdGhlIHB0ciBkaWQgbm90IGVycm9yIGJ1dCBoYWQgbm8gcmVzdWx0cywgcmV0dXJuIHRoZSBob3N0LlxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoID4gMCA/IHJlc3VsdHNbMF0gOiBob3N0O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgIC8vIFRoaXMgY2FuIGVycm9yIGFzIHB0ciByZWNvcmRzIG1heSBub3QgZXhpc3QgZm9yIGFsbCBpcHMuIEluIHRoaXMgY2FzZVxuICAgICAgICAgICAgLy8gZmFsbGJhY2sgdG8gYSBjbmFtZSBsb29rdXAgYXMgZG5zLmxvb2t1cCgpIGRvZXMgbm90IHJldHVybiB0aGVcbiAgICAgICAgICAgIC8vIGNuYW1lLlxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlc29sdmVDbmFtZShob3N0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gVGhlIGNhc2UgZm9yIGZvcndhcmQgaXMganVzdCB0byByZXNvbHZlIHRoZSBjbmFtZSBhcyBkbnMubG9va3VwKClcbiAgICAgICAgLy8gd2lsbCBub3QgcmV0dXJuIGl0LlxuICAgICAgICByZXR1cm4gYXdhaXQgcmVzb2x2ZUNuYW1lKGhvc3QpO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHJlc29sdmVDbmFtZShob3N0KSB7XG4gICAgLy8gQXR0ZW1wdCB0byByZXNvbHZlIHRoZSBob3N0IG5hbWVcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZG5zLnByb21pc2VzLnJlc29sdmVDbmFtZShob3N0KTtcbiAgICAgICAgLy8gR2V0IHRoZSBmaXJzdCByZXNvbHZlZCBob3N0IGlkXG4gICAgICAgIHJldHVybiByZXN1bHRzLmxlbmd0aCA+IDAgPyByZXN1bHRzWzBdIDogaG9zdDtcbiAgICB9XG4gICAgY2F0Y2gge1xuICAgICAgICByZXR1cm4gaG9zdDtcbiAgICB9XG59XG4vKipcbiAqIExvYWQgdGhlIEtlcmJlcm9zIGxpYnJhcnkuXG4gKi9cbmZ1bmN0aW9uIGxvYWRLcmIoKSB7XG4gICAgaWYgKCFrcmIpIHtcbiAgICAgICAga3JiID0gKDAsIGRlcHNfMS5nZXRLZXJiZXJvcykoKTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1nc3NhcGkuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/gssapi.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoCredentials = exports.DEFAULT_ALLOWED_HOSTS = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst gssapi_1 = __webpack_require__(/*! ./gssapi */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/gssapi.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\n/**\n * @see https://github.com/mongodb/specifications/blob/master/source/auth/auth.md\n */\nfunction getDefaultAuthMechanism(hello) {\n    if (hello) {\n        // If hello contains saslSupportedMechs, use scram-sha-256\n        // if it is available, else scram-sha-1\n        if (Array.isArray(hello.saslSupportedMechs)) {\n            return hello.saslSupportedMechs.includes(providers_1.AuthMechanism.MONGODB_SCRAM_SHA256)\n                ? providers_1.AuthMechanism.MONGODB_SCRAM_SHA256\n                : providers_1.AuthMechanism.MONGODB_SCRAM_SHA1;\n        }\n    }\n    // Default auth mechanism for 4.0 and higher.\n    return providers_1.AuthMechanism.MONGODB_SCRAM_SHA256;\n}\nconst ALLOWED_ENVIRONMENT_NAMES = [\n    'test',\n    'azure',\n    'gcp',\n    'k8s'\n];\nconst ALLOWED_HOSTS_ERROR = 'Auth mechanism property ALLOWED_HOSTS must be an array of strings.';\n/** @internal */\nexports.DEFAULT_ALLOWED_HOSTS = [\n    '*.mongodb.net',\n    '*.mongodb-qa.net',\n    '*.mongodb-dev.net',\n    '*.mongodbgov.net',\n    'localhost',\n    '127.0.0.1',\n    '::1'\n];\n/** Error for when the token audience is missing in the environment. */\nconst TOKEN_RESOURCE_MISSING_ERROR = 'TOKEN_RESOURCE must be set in the auth mechanism properties when ENVIRONMENT is azure or gcp.';\n/**\n * A representation of the credentials used by MongoDB\n * @public\n */\nclass MongoCredentials {\n    constructor(options) {\n        this.username = options.username ?? '';\n        this.password = options.password;\n        this.source = options.source;\n        if (!this.source && options.db) {\n            this.source = options.db;\n        }\n        this.mechanism = options.mechanism || providers_1.AuthMechanism.MONGODB_DEFAULT;\n        this.mechanismProperties = options.mechanismProperties || {};\n        if (this.mechanism.match(/MONGODB-AWS/i)) {\n            if (!this.username && process.env.AWS_ACCESS_KEY_ID) {\n                this.username = process.env.AWS_ACCESS_KEY_ID;\n            }\n            if (!this.password && process.env.AWS_SECRET_ACCESS_KEY) {\n                this.password = process.env.AWS_SECRET_ACCESS_KEY;\n            }\n            if (this.mechanismProperties.AWS_SESSION_TOKEN == null &&\n                process.env.AWS_SESSION_TOKEN != null) {\n                this.mechanismProperties = {\n                    ...this.mechanismProperties,\n                    AWS_SESSION_TOKEN: process.env.AWS_SESSION_TOKEN\n                };\n            }\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_OIDC && !this.mechanismProperties.ALLOWED_HOSTS) {\n            this.mechanismProperties = {\n                ...this.mechanismProperties,\n                ALLOWED_HOSTS: exports.DEFAULT_ALLOWED_HOSTS\n            };\n        }\n        Object.freeze(this.mechanismProperties);\n        Object.freeze(this);\n    }\n    /** Determines if two MongoCredentials objects are equivalent */\n    equals(other) {\n        return (this.mechanism === other.mechanism &&\n            this.username === other.username &&\n            this.password === other.password &&\n            this.source === other.source);\n    }\n    /**\n     * If the authentication mechanism is set to \"default\", resolves the authMechanism\n     * based on the server version and server supported sasl mechanisms.\n     *\n     * @param hello - A hello response from the server\n     */\n    resolveAuthMechanism(hello) {\n        // If the mechanism is not \"default\", then it does not need to be resolved\n        if (this.mechanism.match(/DEFAULT/i)) {\n            return new MongoCredentials({\n                username: this.username,\n                password: this.password,\n                source: this.source,\n                mechanism: getDefaultAuthMechanism(hello),\n                mechanismProperties: this.mechanismProperties\n            });\n        }\n        return this;\n    }\n    validate() {\n        if ((this.mechanism === providers_1.AuthMechanism.MONGODB_GSSAPI ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_PLAIN ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_SCRAM_SHA1 ||\n            this.mechanism === providers_1.AuthMechanism.MONGODB_SCRAM_SHA256) &&\n            !this.username) {\n            throw new error_1.MongoMissingCredentialsError(`Username required for mechanism '${this.mechanism}'`);\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_OIDC) {\n            if (this.username &&\n                this.mechanismProperties.ENVIRONMENT &&\n                this.mechanismProperties.ENVIRONMENT !== 'azure') {\n                throw new error_1.MongoInvalidArgumentError(`username and ENVIRONMENT '${this.mechanismProperties.ENVIRONMENT}' may not be used together for mechanism '${this.mechanism}'.`);\n            }\n            if (this.username && this.password) {\n                throw new error_1.MongoInvalidArgumentError(`No password is allowed in ENVIRONMENT '${this.mechanismProperties.ENVIRONMENT}' for '${this.mechanism}'.`);\n            }\n            if ((this.mechanismProperties.ENVIRONMENT === 'azure' ||\n                this.mechanismProperties.ENVIRONMENT === 'gcp') &&\n                !this.mechanismProperties.TOKEN_RESOURCE) {\n                throw new error_1.MongoInvalidArgumentError(TOKEN_RESOURCE_MISSING_ERROR);\n            }\n            if (this.mechanismProperties.ENVIRONMENT &&\n                !ALLOWED_ENVIRONMENT_NAMES.includes(this.mechanismProperties.ENVIRONMENT)) {\n                throw new error_1.MongoInvalidArgumentError(`Currently only a ENVIRONMENT in ${ALLOWED_ENVIRONMENT_NAMES.join(',')} is supported for mechanism '${this.mechanism}'.`);\n            }\n            if (!this.mechanismProperties.ENVIRONMENT &&\n                !this.mechanismProperties.OIDC_CALLBACK &&\n                !this.mechanismProperties.OIDC_HUMAN_CALLBACK) {\n                throw new error_1.MongoInvalidArgumentError(`Either a ENVIRONMENT, OIDC_CALLBACK, or OIDC_HUMAN_CALLBACK must be specified for mechanism '${this.mechanism}'.`);\n            }\n            if (this.mechanismProperties.ALLOWED_HOSTS) {\n                const hosts = this.mechanismProperties.ALLOWED_HOSTS;\n                if (!Array.isArray(hosts)) {\n                    throw new error_1.MongoInvalidArgumentError(ALLOWED_HOSTS_ERROR);\n                }\n                for (const host of hosts) {\n                    if (typeof host !== 'string') {\n                        throw new error_1.MongoInvalidArgumentError(ALLOWED_HOSTS_ERROR);\n                    }\n                }\n            }\n        }\n        if (providers_1.AUTH_MECHS_AUTH_SRC_EXTERNAL.has(this.mechanism)) {\n            if (this.source != null && this.source !== '$external') {\n                // TODO(NODE-3485): Replace this with a MongoAuthValidationError\n                throw new error_1.MongoAPIError(`Invalid source '${this.source}' for mechanism '${this.mechanism}' specified.`);\n            }\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_PLAIN && this.source == null) {\n            // TODO(NODE-3485): Replace this with a MongoAuthValidationError\n            throw new error_1.MongoAPIError('PLAIN Authentication Mechanism needs an auth source');\n        }\n        if (this.mechanism === providers_1.AuthMechanism.MONGODB_X509 && this.password != null) {\n            if (this.password === '') {\n                Reflect.set(this, 'password', undefined);\n                return;\n            }\n            // TODO(NODE-3485): Replace this with a MongoAuthValidationError\n            throw new error_1.MongoAPIError(`Password not allowed for mechanism MONGODB-X509`);\n        }\n        const canonicalization = this.mechanismProperties.CANONICALIZE_HOST_NAME ?? false;\n        if (!Object.values(gssapi_1.GSSAPICanonicalizationValue).includes(canonicalization)) {\n            throw new error_1.MongoAPIError(`Invalid CANONICALIZE_HOST_NAME value: ${canonicalization}`);\n        }\n    }\n    static merge(creds, options) {\n        return new MongoCredentials({\n            username: options.username ?? creds?.username ?? '',\n            password: options.password ?? creds?.password ?? '',\n            mechanism: options.mechanism ?? creds?.mechanism ?? providers_1.AuthMechanism.MONGODB_DEFAULT,\n            mechanismProperties: options.mechanismProperties ?? creds?.mechanismProperties ?? {},\n            source: options.source ?? options.db ?? creds?.source ?? 'admin'\n        });\n    }\n}\nexports.MongoCredentials = MongoCredentials;\n//# sourceMappingURL=mongo_credentials.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb19jcmVkZW50aWFscy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx3QkFBd0IsR0FBRyw2QkFBNkI7QUFDeEQsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsaUJBQWlCLG1CQUFPLENBQUMsd0dBQVU7QUFDbkMsb0JBQW9CLG1CQUFPLENBQUMsOEdBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtGQUErRixlQUFlO0FBQzlHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RkFBeUYscUNBQXFDLDRDQUE0QyxlQUFlO0FBQ3pMO0FBQ0E7QUFDQSxzR0FBc0cscUNBQXFDLFNBQVMsZUFBZTtBQUNuSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0ZBQStGLHFDQUFxQyw4QkFBOEIsZUFBZTtBQUNqTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRKQUE0SixlQUFlO0FBQzNLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLFlBQVksbUJBQW1CLGVBQWU7QUFDakg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRkFBcUYsaUJBQWlCO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29fY3JlZGVudGlhbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vbmdvQ3JlZGVudGlhbHMgPSBleHBvcnRzLkRFRkFVTFRfQUxMT1dFRF9IT1NUUyA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCBnc3NhcGlfMSA9IHJlcXVpcmUoXCIuL2dzc2FwaVwiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vcHJvdmlkZXJzXCIpO1xuLyoqXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9hdXRoL2F1dGgubWRcbiAqL1xuZnVuY3Rpb24gZ2V0RGVmYXVsdEF1dGhNZWNoYW5pc20oaGVsbG8pIHtcbiAgICBpZiAoaGVsbG8pIHtcbiAgICAgICAgLy8gSWYgaGVsbG8gY29udGFpbnMgc2FzbFN1cHBvcnRlZE1lY2hzLCB1c2Ugc2NyYW0tc2hhLTI1NlxuICAgICAgICAvLyBpZiBpdCBpcyBhdmFpbGFibGUsIGVsc2Ugc2NyYW0tc2hhLTFcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaGVsbG8uc2FzbFN1cHBvcnRlZE1lY2hzKSkge1xuICAgICAgICAgICAgcmV0dXJuIGhlbGxvLnNhc2xTdXBwb3J0ZWRNZWNocy5pbmNsdWRlcyhwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfU0NSQU1fU0hBMjU2KVxuICAgICAgICAgICAgICAgID8gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1NlxuICAgICAgICAgICAgICAgIDogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRGVmYXVsdCBhdXRoIG1lY2hhbmlzbSBmb3IgNC4wIGFuZCBoaWdoZXIuXG4gICAgcmV0dXJuIHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEEyNTY7XG59XG5jb25zdCBBTExPV0VEX0VOVklST05NRU5UX05BTUVTID0gW1xuICAgICd0ZXN0JyxcbiAgICAnYXp1cmUnLFxuICAgICdnY3AnLFxuICAgICdrOHMnXG5dO1xuY29uc3QgQUxMT1dFRF9IT1NUU19FUlJPUiA9ICdBdXRoIG1lY2hhbmlzbSBwcm9wZXJ0eSBBTExPV0VEX0hPU1RTIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncy4nO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5ERUZBVUxUX0FMTE9XRURfSE9TVFMgPSBbXG4gICAgJyoubW9uZ29kYi5uZXQnLFxuICAgICcqLm1vbmdvZGItcWEubmV0JyxcbiAgICAnKi5tb25nb2RiLWRldi5uZXQnLFxuICAgICcqLm1vbmdvZGJnb3YubmV0JyxcbiAgICAnbG9jYWxob3N0JyxcbiAgICAnMTI3LjAuMC4xJyxcbiAgICAnOjoxJ1xuXTtcbi8qKiBFcnJvciBmb3Igd2hlbiB0aGUgdG9rZW4gYXVkaWVuY2UgaXMgbWlzc2luZyBpbiB0aGUgZW52aXJvbm1lbnQuICovXG5jb25zdCBUT0tFTl9SRVNPVVJDRV9NSVNTSU5HX0VSUk9SID0gJ1RPS0VOX1JFU09VUkNFIG11c3QgYmUgc2V0IGluIHRoZSBhdXRoIG1lY2hhbmlzbSBwcm9wZXJ0aWVzIHdoZW4gRU5WSVJPTk1FTlQgaXMgYXp1cmUgb3IgZ2NwLic7XG4vKipcbiAqIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNyZWRlbnRpYWxzIHVzZWQgYnkgTW9uZ29EQlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBNb25nb0NyZWRlbnRpYWxzIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSBvcHRpb25zLnVzZXJuYW1lID8/ICcnO1xuICAgICAgICB0aGlzLnBhc3N3b3JkID0gb3B0aW9ucy5wYXNzd29yZDtcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBvcHRpb25zLnNvdXJjZTtcbiAgICAgICAgaWYgKCF0aGlzLnNvdXJjZSAmJiBvcHRpb25zLmRiKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9IG9wdGlvbnMuZGI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tZWNoYW5pc20gPSBvcHRpb25zLm1lY2hhbmlzbSB8fCBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfREVGQVVMVDtcbiAgICAgICAgdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzID0gb3B0aW9ucy5tZWNoYW5pc21Qcm9wZXJ0aWVzIHx8IHt9O1xuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20ubWF0Y2goL01PTkdPREItQVdTL2kpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMudXNlcm5hbWUgJiYgcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXJuYW1lID0gcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMucGFzc3dvcmQgJiYgcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXNzd29yZCA9IHByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuQVdTX1NFU1NJT05fVE9LRU4gPT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52LkFXU19TRVNTSU9OX1RPS0VOICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMubWVjaGFuaXNtUHJvcGVydGllcyxcbiAgICAgICAgICAgICAgICAgICAgQVdTX1NFU1NJT05fVE9LRU46IHByb2Nlc3MuZW52LkFXU19TRVNTSU9OX1RPS0VOXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9PSURDICYmICF0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuQUxMT1dFRF9IT1NUUykge1xuICAgICAgICAgICAgdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzID0ge1xuICAgICAgICAgICAgICAgIC4uLnRoaXMubWVjaGFuaXNtUHJvcGVydGllcyxcbiAgICAgICAgICAgICAgICBBTExPV0VEX0hPU1RTOiBleHBvcnRzLkRFRkFVTFRfQUxMT1dFRF9IT1NUU1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3QuZnJlZXplKHRoaXMubWVjaGFuaXNtUHJvcGVydGllcyk7XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcyk7XG4gICAgfVxuICAgIC8qKiBEZXRlcm1pbmVzIGlmIHR3byBNb25nb0NyZWRlbnRpYWxzIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQgKi9cbiAgICBlcXVhbHMob3RoZXIpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLm1lY2hhbmlzbSA9PT0gb3RoZXIubWVjaGFuaXNtICYmXG4gICAgICAgICAgICB0aGlzLnVzZXJuYW1lID09PSBvdGhlci51c2VybmFtZSAmJlxuICAgICAgICAgICAgdGhpcy5wYXNzd29yZCA9PT0gb3RoZXIucGFzc3dvcmQgJiZcbiAgICAgICAgICAgIHRoaXMuc291cmNlID09PSBvdGhlci5zb3VyY2UpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJZiB0aGUgYXV0aGVudGljYXRpb24gbWVjaGFuaXNtIGlzIHNldCB0byBcImRlZmF1bHRcIiwgcmVzb2x2ZXMgdGhlIGF1dGhNZWNoYW5pc21cbiAgICAgKiBiYXNlZCBvbiB0aGUgc2VydmVyIHZlcnNpb24gYW5kIHNlcnZlciBzdXBwb3J0ZWQgc2FzbCBtZWNoYW5pc21zLlxuICAgICAqXG4gICAgICogQHBhcmFtIGhlbGxvIC0gQSBoZWxsbyByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXJcbiAgICAgKi9cbiAgICByZXNvbHZlQXV0aE1lY2hhbmlzbShoZWxsbykge1xuICAgICAgICAvLyBJZiB0aGUgbWVjaGFuaXNtIGlzIG5vdCBcImRlZmF1bHRcIiwgdGhlbiBpdCBkb2VzIG5vdCBuZWVkIHRvIGJlIHJlc29sdmVkXG4gICAgICAgIGlmICh0aGlzLm1lY2hhbmlzbS5tYXRjaCgvREVGQVVMVC9pKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNb25nb0NyZWRlbnRpYWxzKHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdGhpcy51c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLFxuICAgICAgICAgICAgICAgIG1lY2hhbmlzbTogZ2V0RGVmYXVsdEF1dGhNZWNoYW5pc20oaGVsbG8pLFxuICAgICAgICAgICAgICAgIG1lY2hhbmlzbVByb3BlcnRpZXM6IHRoaXMubWVjaGFuaXNtUHJvcGVydGllc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHZhbGlkYXRlKCkge1xuICAgICAgICBpZiAoKHRoaXMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfR1NTQVBJIHx8XG4gICAgICAgICAgICB0aGlzLm1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1BMQUlOIHx8XG4gICAgICAgICAgICB0aGlzLm1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTEgfHxcbiAgICAgICAgICAgIHRoaXMubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfU0NSQU1fU0hBMjU2KSAmJlxuICAgICAgICAgICAgIXRoaXMudXNlcm5hbWUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoYFVzZXJuYW1lIHJlcXVpcmVkIGZvciBtZWNoYW5pc20gJyR7dGhpcy5tZWNoYW5pc219J2ApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX09JREMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZXJuYW1lICYmXG4gICAgICAgICAgICAgICAgdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkVOVklST05NRU5UICYmXG4gICAgICAgICAgICAgICAgdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkVOVklST05NRU5UICE9PSAnYXp1cmUnKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgdXNlcm5hbWUgYW5kIEVOVklST05NRU5UICcke3RoaXMubWVjaGFuaXNtUHJvcGVydGllcy5FTlZJUk9OTUVOVH0nIG1heSBub3QgYmUgdXNlZCB0b2dldGhlciBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfScuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy51c2VybmFtZSAmJiB0aGlzLnBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgTm8gcGFzc3dvcmQgaXMgYWxsb3dlZCBpbiBFTlZJUk9OTUVOVCAnJHt0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuRU5WSVJPTk1FTlR9JyBmb3IgJyR7dGhpcy5tZWNoYW5pc219Jy5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgodGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkVOVklST05NRU5UID09PSAnYXp1cmUnIHx8XG4gICAgICAgICAgICAgICAgdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkVOVklST05NRU5UID09PSAnZ2NwJykgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlRPS0VOX1JFU09VUkNFKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihUT0tFTl9SRVNPVVJDRV9NSVNTSU5HX0VSUk9SKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuRU5WSVJPTk1FTlQgJiZcbiAgICAgICAgICAgICAgICAhQUxMT1dFRF9FTlZJUk9OTUVOVF9OQU1FUy5pbmNsdWRlcyh0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuRU5WSVJPTk1FTlQpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgQ3VycmVudGx5IG9ubHkgYSBFTlZJUk9OTUVOVCBpbiAke0FMTE9XRURfRU5WSVJPTk1FTlRfTkFNRVMuam9pbignLCcpfSBpcyBzdXBwb3J0ZWQgZm9yIG1lY2hhbmlzbSAnJHt0aGlzLm1lY2hhbmlzbX0nLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuRU5WSVJPTk1FTlQgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLk9JRENfQ0FMTEJBQ0sgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLk9JRENfSFVNQU5fQ0FMTEJBQ0spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBFaXRoZXIgYSBFTlZJUk9OTUVOVCwgT0lEQ19DQUxMQkFDSywgb3IgT0lEQ19IVU1BTl9DQUxMQkFDSyBtdXN0IGJlIHNwZWNpZmllZCBmb3IgbWVjaGFuaXNtICcke3RoaXMubWVjaGFuaXNtfScuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tZWNoYW5pc21Qcm9wZXJ0aWVzLkFMTE9XRURfSE9TVFMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBob3N0cyA9IHRoaXMubWVjaGFuaXNtUHJvcGVydGllcy5BTExPV0VEX0hPU1RTO1xuICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShob3N0cykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihBTExPV0VEX0hPU1RTX0VSUk9SKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBob3N0IG9mIGhvc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaG9zdCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoQUxMT1dFRF9IT1NUU19FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByb3ZpZGVyc18xLkFVVEhfTUVDSFNfQVVUSF9TUkNfRVhURVJOQUwuaGFzKHRoaXMubWVjaGFuaXNtKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc291cmNlICE9IG51bGwgJiYgdGhpcy5zb3VyY2UgIT09ICckZXh0ZXJuYWwnKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHRoaXMgd2l0aCBhIE1vbmdvQXV0aFZhbGlkYXRpb25FcnJvclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYEludmFsaWQgc291cmNlICcke3RoaXMuc291cmNlfScgZm9yIG1lY2hhbmlzbSAnJHt0aGlzLm1lY2hhbmlzbX0nIHNwZWNpZmllZC5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9QTEFJTiAmJiB0aGlzLnNvdXJjZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4NSk6IFJlcGxhY2UgdGhpcyB3aXRoIGEgTW9uZ29BdXRoVmFsaWRhdGlvbkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdQTEFJTiBBdXRoZW50aWNhdGlvbiBNZWNoYW5pc20gbmVlZHMgYW4gYXV0aCBzb3VyY2UnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9YNTA5ICYmIHRoaXMucGFzc3dvcmQgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFzc3dvcmQgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgUmVmbGVjdC5zZXQodGhpcywgJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4NSk6IFJlcGxhY2UgdGhpcyB3aXRoIGEgTW9uZ29BdXRoVmFsaWRhdGlvbkVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBQYXNzd29yZCBub3QgYWxsb3dlZCBmb3IgbWVjaGFuaXNtIE1PTkdPREItWDUwOWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbm9uaWNhbGl6YXRpb24gPSB0aGlzLm1lY2hhbmlzbVByb3BlcnRpZXMuQ0FOT05JQ0FMSVpFX0hPU1RfTkFNRSA/PyBmYWxzZTtcbiAgICAgICAgaWYgKCFPYmplY3QudmFsdWVzKGdzc2FwaV8xLkdTU0FQSUNhbm9uaWNhbGl6YXRpb25WYWx1ZSkuaW5jbHVkZXMoY2Fub25pY2FsaXphdGlvbikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYEludmFsaWQgQ0FOT05JQ0FMSVpFX0hPU1RfTkFNRSB2YWx1ZTogJHtjYW5vbmljYWxpemF0aW9ufWApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBtZXJnZShjcmVkcywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IE1vbmdvQ3JlZGVudGlhbHMoe1xuICAgICAgICAgICAgdXNlcm5hbWU6IG9wdGlvbnMudXNlcm5hbWUgPz8gY3JlZHM/LnVzZXJuYW1lID8/ICcnLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IG9wdGlvbnMucGFzc3dvcmQgPz8gY3JlZHM/LnBhc3N3b3JkID8/ICcnLFxuICAgICAgICAgICAgbWVjaGFuaXNtOiBvcHRpb25zLm1lY2hhbmlzbSA/PyBjcmVkcz8ubWVjaGFuaXNtID8/IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9ERUZBVUxULFxuICAgICAgICAgICAgbWVjaGFuaXNtUHJvcGVydGllczogb3B0aW9ucy5tZWNoYW5pc21Qcm9wZXJ0aWVzID8/IGNyZWRzPy5tZWNoYW5pc21Qcm9wZXJ0aWVzID8/IHt9LFxuICAgICAgICAgICAgc291cmNlOiBvcHRpb25zLnNvdXJjZSA/PyBvcHRpb25zLmRiID8/IGNyZWRzPy5zb3VyY2UgPz8gJ2FkbWluJ1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ3JlZGVudGlhbHMgPSBNb25nb0NyZWRlbnRpYWxzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9uZ29fY3JlZGVudGlhbHMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js ***!
  \*********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoDBAWS = void 0;\nconst BSON = __webpack_require__(/*! ../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst aws_temporary_credentials_1 = __webpack_require__(/*! ./aws_temporary_credentials */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/aws_temporary_credentials.js\");\nconst mongo_credentials_1 = __webpack_require__(/*! ./mongo_credentials */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst ASCII_N = 110;\nconst bsonOptions = {\n    useBigInt64: false,\n    promoteLongs: true,\n    promoteValues: true,\n    promoteBuffers: false,\n    bsonRegExp: false\n};\nclass MongoDBAWS extends auth_provider_1.AuthProvider {\n    constructor(credentialProvider) {\n        super();\n        this.credentialProvider = credentialProvider;\n        this.credentialFetcher = aws_temporary_credentials_1.AWSTemporaryCredentialProvider.isAWSSDKInstalled\n            ? new aws_temporary_credentials_1.AWSSDKCredentialProvider(credentialProvider)\n            : new aws_temporary_credentials_1.LegacyAWSTemporaryCredentialProvider();\n    }\n    async auth(authContext) {\n        const { connection } = authContext;\n        if (!authContext.credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        if ('kModuleError' in deps_1.aws4) {\n            throw deps_1.aws4['kModuleError'];\n        }\n        const { sign } = deps_1.aws4;\n        if ((0, utils_1.maxWireVersion)(connection) < 9) {\n            throw new error_1.MongoCompatibilityError('MONGODB-AWS authentication requires MongoDB version 4.4 or later');\n        }\n        if (!authContext.credentials.username) {\n            authContext.credentials = await makeTempCredentials(authContext.credentials, this.credentialFetcher);\n        }\n        const { credentials } = authContext;\n        const accessKeyId = credentials.username;\n        const secretAccessKey = credentials.password;\n        // Allow the user to specify an AWS session token for authentication with temporary credentials.\n        const sessionToken = credentials.mechanismProperties.AWS_SESSION_TOKEN;\n        // If all three defined, include sessionToken, else include username and pass, else no credentials\n        const awsCredentials = accessKeyId && secretAccessKey && sessionToken\n            ? { accessKeyId, secretAccessKey, sessionToken }\n            : accessKeyId && secretAccessKey\n                ? { accessKeyId, secretAccessKey }\n                : undefined;\n        const db = credentials.source;\n        const nonce = await (0, utils_1.randomBytes)(32);\n        // All messages between MongoDB clients and servers are sent as BSON objects\n        // in the payload field of saslStart and saslContinue.\n        const saslStart = {\n            saslStart: 1,\n            mechanism: 'MONGODB-AWS',\n            payload: BSON.serialize({ r: nonce, p: ASCII_N }, bsonOptions)\n        };\n        const saslStartResponse = await connection.command((0, utils_1.ns)(`${db}.$cmd`), saslStart, undefined);\n        const serverResponse = BSON.deserialize(saslStartResponse.payload.buffer, bsonOptions);\n        const host = serverResponse.h;\n        const serverNonce = serverResponse.s.buffer;\n        if (serverNonce.length !== 64) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError(`Invalid server nonce length ${serverNonce.length}, expected 64`);\n        }\n        if (!utils_1.ByteUtils.equals(serverNonce.subarray(0, nonce.byteLength), nonce)) {\n            // throw because the serverNonce's leading 32 bytes must equal the client nonce's 32 bytes\n            // https://github.com/mongodb/specifications/blob/master/source/auth/auth.md#conversation-5\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError('Server nonce does not begin with client nonce');\n        }\n        if (host.length < 1 || host.length > 255 || host.indexOf('..') !== -1) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError(`Server returned an invalid host: \"${host}\"`);\n        }\n        const body = 'Action=GetCallerIdentity&Version=2011-06-15';\n        const options = sign({\n            method: 'POST',\n            host,\n            region: deriveRegion(serverResponse.h),\n            service: 'sts',\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n                'Content-Length': body.length,\n                'X-MongoDB-Server-Nonce': utils_1.ByteUtils.toBase64(serverNonce),\n                'X-MongoDB-GS2-CB-Flag': 'n'\n            },\n            path: '/',\n            body\n        }, awsCredentials);\n        const payload = {\n            a: options.headers.Authorization,\n            d: options.headers['X-Amz-Date']\n        };\n        if (sessionToken) {\n            payload.t = sessionToken;\n        }\n        const saslContinue = {\n            saslContinue: 1,\n            conversationId: saslStartResponse.conversationId,\n            payload: BSON.serialize(payload, bsonOptions)\n        };\n        await connection.command((0, utils_1.ns)(`${db}.$cmd`), saslContinue, undefined);\n    }\n}\nexports.MongoDBAWS = MongoDBAWS;\nasync function makeTempCredentials(credentials, awsCredentialFetcher) {\n    function makeMongoCredentialsFromAWSTemp(creds) {\n        // The AWS session token (creds.Token) may or may not be set.\n        if (!creds.AccessKeyId || !creds.SecretAccessKey) {\n            throw new error_1.MongoMissingCredentialsError('Could not obtain temporary MONGODB-AWS credentials');\n        }\n        return new mongo_credentials_1.MongoCredentials({\n            username: creds.AccessKeyId,\n            password: creds.SecretAccessKey,\n            source: credentials.source,\n            mechanism: providers_1.AuthMechanism.MONGODB_AWS,\n            mechanismProperties: {\n                AWS_SESSION_TOKEN: creds.Token\n            }\n        });\n    }\n    const temporaryCredentials = await awsCredentialFetcher.getCredentials();\n    return makeMongoCredentialsFromAWSTemp(temporaryCredentials);\n}\nfunction deriveRegion(host) {\n    const parts = host.split('.');\n    if (parts.length === 1 || parts[1] === 'amazonaws') {\n        return 'us-east-1';\n    }\n    return parts[1];\n}\n//# sourceMappingURL=mongodb_aws.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX2F3cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQkFBa0I7QUFDbEIsYUFBYSxtQkFBTyxDQUFDLDhGQUFZO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQyw4RkFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyxzSEFBaUI7QUFDakQsb0NBQW9DLG1CQUFPLENBQUMsOElBQTZCO0FBQ3pFLDRCQUE0QixtQkFBTyxDQUFDLDhIQUFxQjtBQUN6RCxvQkFBb0IsbUJBQU8sQ0FBQyw4R0FBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGFBQWE7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE9BQU87QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGNBQWM7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0Msc0JBQXNCO0FBQzVEO0FBQ0EsOEVBQThFLEdBQUc7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSxtQkFBbUI7QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUZBQXFGLEtBQUs7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELEdBQUc7QUFDdkQ7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX2F3cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29EQkFXUyA9IHZvaWQgMDtcbmNvbnN0IEJTT04gPSByZXF1aXJlKFwiLi4vLi4vYnNvblwiKTtcbmNvbnN0IGRlcHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9kZXBzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG5jb25zdCBhdXRoX3Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9hdXRoX3Byb3ZpZGVyXCIpO1xuY29uc3QgYXdzX3RlbXBvcmFyeV9jcmVkZW50aWFsc18xID0gcmVxdWlyZShcIi4vYXdzX3RlbXBvcmFyeV9jcmVkZW50aWFsc1wiKTtcbmNvbnN0IG1vbmdvX2NyZWRlbnRpYWxzXzEgPSByZXF1aXJlKFwiLi9tb25nb19jcmVkZW50aWFsc1wiKTtcbmNvbnN0IHByb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vcHJvdmlkZXJzXCIpO1xuY29uc3QgQVNDSUlfTiA9IDExMDtcbmNvbnN0IGJzb25PcHRpb25zID0ge1xuICAgIHVzZUJpZ0ludDY0OiBmYWxzZSxcbiAgICBwcm9tb3RlTG9uZ3M6IHRydWUsXG4gICAgcHJvbW90ZVZhbHVlczogdHJ1ZSxcbiAgICBwcm9tb3RlQnVmZmVyczogZmFsc2UsXG4gICAgYnNvblJlZ0V4cDogZmFsc2Vcbn07XG5jbGFzcyBNb25nb0RCQVdTIGV4dGVuZHMgYXV0aF9wcm92aWRlcl8xLkF1dGhQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoY3JlZGVudGlhbFByb3ZpZGVyKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuY3JlZGVudGlhbFByb3ZpZGVyID0gY3JlZGVudGlhbFByb3ZpZGVyO1xuICAgICAgICB0aGlzLmNyZWRlbnRpYWxGZXRjaGVyID0gYXdzX3RlbXBvcmFyeV9jcmVkZW50aWFsc18xLkFXU1RlbXBvcmFyeUNyZWRlbnRpYWxQcm92aWRlci5pc0FXU1NES0luc3RhbGxlZFxuICAgICAgICAgICAgPyBuZXcgYXdzX3RlbXBvcmFyeV9jcmVkZW50aWFsc18xLkFXU1NES0NyZWRlbnRpYWxQcm92aWRlcihjcmVkZW50aWFsUHJvdmlkZXIpXG4gICAgICAgICAgICA6IG5ldyBhd3NfdGVtcG9yYXJ5X2NyZWRlbnRpYWxzXzEuTGVnYWN5QVdTVGVtcG9yYXJ5Q3JlZGVudGlhbFByb3ZpZGVyKCk7XG4gICAgfVxuICAgIGFzeW5jIGF1dGgoYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uIH0gPSBhdXRoQ29udGV4dDtcbiAgICAgICAgaWYgKCFhdXRoQ29udGV4dC5jcmVkZW50aWFscykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcignQXV0aENvbnRleHQgbXVzdCBwcm92aWRlIGNyZWRlbnRpYWxzLicpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgna01vZHVsZUVycm9yJyBpbiBkZXBzXzEuYXdzNCkge1xuICAgICAgICAgICAgdGhyb3cgZGVwc18xLmF3czRbJ2tNb2R1bGVFcnJvciddO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgc2lnbiB9ID0gZGVwc18xLmF3czQ7XG4gICAgICAgIGlmICgoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikoY29ubmVjdGlvbikgPCA5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcignTU9OR09EQi1BV1MgYXV0aGVudGljYXRpb24gcmVxdWlyZXMgTW9uZ29EQiB2ZXJzaW9uIDQuNCBvciBsYXRlcicpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYXV0aENvbnRleHQuY3JlZGVudGlhbHMudXNlcm5hbWUpIHtcbiAgICAgICAgICAgIGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzID0gYXdhaXQgbWFrZVRlbXBDcmVkZW50aWFscyhhdXRoQ29udGV4dC5jcmVkZW50aWFscywgdGhpcy5jcmVkZW50aWFsRmV0Y2hlcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgICAgIGNvbnN0IGFjY2Vzc0tleUlkID0gY3JlZGVudGlhbHMudXNlcm5hbWU7XG4gICAgICAgIGNvbnN0IHNlY3JldEFjY2Vzc0tleSA9IGNyZWRlbnRpYWxzLnBhc3N3b3JkO1xuICAgICAgICAvLyBBbGxvdyB0aGUgdXNlciB0byBzcGVjaWZ5IGFuIEFXUyBzZXNzaW9uIHRva2VuIGZvciBhdXRoZW50aWNhdGlvbiB3aXRoIHRlbXBvcmFyeSBjcmVkZW50aWFscy5cbiAgICAgICAgY29uc3Qgc2Vzc2lvblRva2VuID0gY3JlZGVudGlhbHMubWVjaGFuaXNtUHJvcGVydGllcy5BV1NfU0VTU0lPTl9UT0tFTjtcbiAgICAgICAgLy8gSWYgYWxsIHRocmVlIGRlZmluZWQsIGluY2x1ZGUgc2Vzc2lvblRva2VuLCBlbHNlIGluY2x1ZGUgdXNlcm5hbWUgYW5kIHBhc3MsIGVsc2Ugbm8gY3JlZGVudGlhbHNcbiAgICAgICAgY29uc3QgYXdzQ3JlZGVudGlhbHMgPSBhY2Nlc3NLZXlJZCAmJiBzZWNyZXRBY2Nlc3NLZXkgJiYgc2Vzc2lvblRva2VuXG4gICAgICAgICAgICA/IHsgYWNjZXNzS2V5SWQsIHNlY3JldEFjY2Vzc0tleSwgc2Vzc2lvblRva2VuIH1cbiAgICAgICAgICAgIDogYWNjZXNzS2V5SWQgJiYgc2VjcmV0QWNjZXNzS2V5XG4gICAgICAgICAgICAgICAgPyB7IGFjY2Vzc0tleUlkLCBzZWNyZXRBY2Nlc3NLZXkgfVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBkYiA9IGNyZWRlbnRpYWxzLnNvdXJjZTtcbiAgICAgICAgY29uc3Qgbm9uY2UgPSBhd2FpdCAoMCwgdXRpbHNfMS5yYW5kb21CeXRlcykoMzIpO1xuICAgICAgICAvLyBBbGwgbWVzc2FnZXMgYmV0d2VlbiBNb25nb0RCIGNsaWVudHMgYW5kIHNlcnZlcnMgYXJlIHNlbnQgYXMgQlNPTiBvYmplY3RzXG4gICAgICAgIC8vIGluIHRoZSBwYXlsb2FkIGZpZWxkIG9mIHNhc2xTdGFydCBhbmQgc2FzbENvbnRpbnVlLlxuICAgICAgICBjb25zdCBzYXNsU3RhcnQgPSB7XG4gICAgICAgICAgICBzYXNsU3RhcnQ6IDEsXG4gICAgICAgICAgICBtZWNoYW5pc206ICdNT05HT0RCLUFXUycsXG4gICAgICAgICAgICBwYXlsb2FkOiBCU09OLnNlcmlhbGl6ZSh7IHI6IG5vbmNlLCBwOiBBU0NJSV9OIH0sIGJzb25PcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzYXNsU3RhcnRSZXNwb25zZSA9IGF3YWl0IGNvbm5lY3Rpb24uY29tbWFuZCgoMCwgdXRpbHNfMS5ucykoYCR7ZGJ9LiRjbWRgKSwgc2FzbFN0YXJ0LCB1bmRlZmluZWQpO1xuICAgICAgICBjb25zdCBzZXJ2ZXJSZXNwb25zZSA9IEJTT04uZGVzZXJpYWxpemUoc2FzbFN0YXJ0UmVzcG9uc2UucGF5bG9hZC5idWZmZXIsIGJzb25PcHRpb25zKTtcbiAgICAgICAgY29uc3QgaG9zdCA9IHNlcnZlclJlc3BvbnNlLmg7XG4gICAgICAgIGNvbnN0IHNlcnZlck5vbmNlID0gc2VydmVyUmVzcG9uc2Uucy5idWZmZXI7XG4gICAgICAgIGlmIChzZXJ2ZXJOb25jZS5sZW5ndGggIT09IDY0KSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBJbnZhbGlkIHNlcnZlciBub25jZSBsZW5ndGggJHtzZXJ2ZXJOb25jZS5sZW5ndGh9LCBleHBlY3RlZCA2NGApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdXRpbHNfMS5CeXRlVXRpbHMuZXF1YWxzKHNlcnZlck5vbmNlLnN1YmFycmF5KDAsIG5vbmNlLmJ5dGVMZW5ndGgpLCBub25jZSkpIHtcbiAgICAgICAgICAgIC8vIHRocm93IGJlY2F1c2UgdGhlIHNlcnZlck5vbmNlJ3MgbGVhZGluZyAzMiBieXRlcyBtdXN0IGVxdWFsIHRoZSBjbGllbnQgbm9uY2UncyAzMiBieXRlc1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9tYXN0ZXIvc291cmNlL2F1dGgvYXV0aC5tZCNjb252ZXJzYXRpb24tNVxuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignU2VydmVyIG5vbmNlIGRvZXMgbm90IGJlZ2luIHdpdGggY2xpZW50IG5vbmNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhvc3QubGVuZ3RoIDwgMSB8fCBob3N0Lmxlbmd0aCA+IDI1NSB8fCBob3N0LmluZGV4T2YoJy4uJykgIT09IC0xKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBTZXJ2ZXIgcmV0dXJuZWQgYW4gaW52YWxpZCBob3N0OiBcIiR7aG9zdH1cImApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJvZHkgPSAnQWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSc7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzaWduKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaG9zdCxcbiAgICAgICAgICAgIHJlZ2lvbjogZGVyaXZlUmVnaW9uKHNlcnZlclJlc3BvbnNlLmgpLFxuICAgICAgICAgICAgc2VydmljZTogJ3N0cycsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgICAgICAgICAgICdDb250ZW50LUxlbmd0aCc6IGJvZHkubGVuZ3RoLFxuICAgICAgICAgICAgICAgICdYLU1vbmdvREItU2VydmVyLU5vbmNlJzogdXRpbHNfMS5CeXRlVXRpbHMudG9CYXNlNjQoc2VydmVyTm9uY2UpLFxuICAgICAgICAgICAgICAgICdYLU1vbmdvREItR1MyLUNCLUZsYWcnOiAnbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXRoOiAnLycsXG4gICAgICAgICAgICBib2R5XG4gICAgICAgIH0sIGF3c0NyZWRlbnRpYWxzKTtcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgIGE6IG9wdGlvbnMuaGVhZGVycy5BdXRob3JpemF0aW9uLFxuICAgICAgICAgICAgZDogb3B0aW9ucy5oZWFkZXJzWydYLUFtei1EYXRlJ11cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHNlc3Npb25Ub2tlbikge1xuICAgICAgICAgICAgcGF5bG9hZC50ID0gc2Vzc2lvblRva2VuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNhc2xDb250aW51ZSA9IHtcbiAgICAgICAgICAgIHNhc2xDb250aW51ZTogMSxcbiAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiBzYXNsU3RhcnRSZXNwb25zZS5jb252ZXJzYXRpb25JZCxcbiAgICAgICAgICAgIHBheWxvYWQ6IEJTT04uc2VyaWFsaXplKHBheWxvYWQsIGJzb25PcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKGAke2RifS4kY21kYCksIHNhc2xDb250aW51ZSwgdW5kZWZpbmVkKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvREJBV1MgPSBNb25nb0RCQVdTO1xuYXN5bmMgZnVuY3Rpb24gbWFrZVRlbXBDcmVkZW50aWFscyhjcmVkZW50aWFscywgYXdzQ3JlZGVudGlhbEZldGNoZXIpIHtcbiAgICBmdW5jdGlvbiBtYWtlTW9uZ29DcmVkZW50aWFsc0Zyb21BV1NUZW1wKGNyZWRzKSB7XG4gICAgICAgIC8vIFRoZSBBV1Mgc2Vzc2lvbiB0b2tlbiAoY3JlZHMuVG9rZW4pIG1heSBvciBtYXkgbm90IGJlIHNldC5cbiAgICAgICAgaWYgKCFjcmVkcy5BY2Nlc3NLZXlJZCB8fCAhY3JlZHMuU2VjcmV0QWNjZXNzS2V5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdDb3VsZCBub3Qgb2J0YWluIHRlbXBvcmFyeSBNT05HT0RCLUFXUyBjcmVkZW50aWFscycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgbW9uZ29fY3JlZGVudGlhbHNfMS5Nb25nb0NyZWRlbnRpYWxzKHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiBjcmVkcy5BY2Nlc3NLZXlJZCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBjcmVkcy5TZWNyZXRBY2Nlc3NLZXksXG4gICAgICAgICAgICBzb3VyY2U6IGNyZWRlbnRpYWxzLnNvdXJjZSxcbiAgICAgICAgICAgIG1lY2hhbmlzbTogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0FXUyxcbiAgICAgICAgICAgIG1lY2hhbmlzbVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICBBV1NfU0VTU0lPTl9UT0tFTjogY3JlZHMuVG9rZW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHRlbXBvcmFyeUNyZWRlbnRpYWxzID0gYXdhaXQgYXdzQ3JlZGVudGlhbEZldGNoZXIuZ2V0Q3JlZGVudGlhbHMoKTtcbiAgICByZXR1cm4gbWFrZU1vbmdvQ3JlZGVudGlhbHNGcm9tQVdTVGVtcCh0ZW1wb3JhcnlDcmVkZW50aWFscyk7XG59XG5mdW5jdGlvbiBkZXJpdmVSZWdpb24oaG9zdCkge1xuICAgIGNvbnN0IHBhcnRzID0gaG9zdC5zcGxpdCgnLicpO1xuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDEgfHwgcGFydHNbMV0gPT09ICdhbWF6b25hd3MnKSB7XG4gICAgICAgIHJldHVybiAndXMtZWFzdC0xJztcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzWzFdO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9uZ29kYl9hd3MuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoDBOIDC = exports.OIDC_WORKFLOWS = exports.OIDC_VERSION = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst azure_machine_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/azure_machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_machine_workflow.js\");\nconst gcp_machine_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/gcp_machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/gcp_machine_workflow.js\");\nconst k8s_machine_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/k8s_machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/k8s_machine_workflow.js\");\nconst token_cache_1 = __webpack_require__(/*! ./mongodb_oidc/token_cache */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_cache.js\");\nconst token_machine_workflow_1 = __webpack_require__(/*! ./mongodb_oidc/token_machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_machine_workflow.js\");\n/** Error when credentials are missing. */\nconst MISSING_CREDENTIALS_ERROR = 'AuthContext must provide credentials.';\n/** The current version of OIDC implementation. */\nexports.OIDC_VERSION = 1;\n/** @internal */\nexports.OIDC_WORKFLOWS = new Map();\nexports.OIDC_WORKFLOWS.set('test', () => new token_machine_workflow_1.TokenMachineWorkflow(new token_cache_1.TokenCache()));\nexports.OIDC_WORKFLOWS.set('azure', () => new azure_machine_workflow_1.AzureMachineWorkflow(new token_cache_1.TokenCache()));\nexports.OIDC_WORKFLOWS.set('gcp', () => new gcp_machine_workflow_1.GCPMachineWorkflow(new token_cache_1.TokenCache()));\nexports.OIDC_WORKFLOWS.set('k8s', () => new k8s_machine_workflow_1.K8SMachineWorkflow(new token_cache_1.TokenCache()));\n/**\n * OIDC auth provider.\n */\nclass MongoDBOIDC extends auth_provider_1.AuthProvider {\n    /**\n     * Instantiate the auth provider.\n     */\n    constructor(workflow) {\n        super();\n        if (!workflow) {\n            throw new error_1.MongoInvalidArgumentError('No workflow provided to the OIDC auth provider.');\n        }\n        this.workflow = workflow;\n    }\n    /**\n     * Authenticate using OIDC\n     */\n    async auth(authContext) {\n        const { connection, reauthenticating, response } = authContext;\n        if (response?.speculativeAuthenticate?.done && !reauthenticating) {\n            return;\n        }\n        const credentials = getCredentials(authContext);\n        if (reauthenticating) {\n            await this.workflow.reauthenticate(connection, credentials);\n        }\n        else {\n            await this.workflow.execute(connection, credentials, response);\n        }\n    }\n    /**\n     * Add the speculative auth for the initial handshake.\n     */\n    async prepare(handshakeDoc, authContext) {\n        const { connection } = authContext;\n        const credentials = getCredentials(authContext);\n        const result = await this.workflow.speculativeAuth(connection, credentials);\n        return { ...handshakeDoc, ...result };\n    }\n}\nexports.MongoDBOIDC = MongoDBOIDC;\n/**\n * Get credentials from the auth context, throwing if they do not exist.\n */\nfunction getCredentials(authContext) {\n    const { credentials } = authContext;\n    if (!credentials) {\n        throw new error_1.MongoMissingCredentialsError(MISSING_CREDENTIALS_ERROR);\n    }\n    return credentials;\n}\n//# sourceMappingURL=mongodb_oidc.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUJBQW1CLEdBQUcsc0JBQXNCLEdBQUcsb0JBQW9CO0FBQ25FLGdCQUFnQixtQkFBTyxDQUFDLGdHQUFhO0FBQ3JDLHdCQUF3QixtQkFBTyxDQUFDLHNIQUFpQjtBQUNqRCxpQ0FBaUMsbUJBQU8sQ0FBQyxrS0FBdUM7QUFDaEYsK0JBQStCLG1CQUFPLENBQUMsOEpBQXFDO0FBQzVFLCtCQUErQixtQkFBTyxDQUFDLDhKQUFxQztBQUM1RSxzQkFBc0IsbUJBQU8sQ0FBQyw0SUFBNEI7QUFDMUQsaUNBQWlDLG1CQUFPLENBQUMsa0tBQXVDO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5Q0FBeUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGFBQWE7QUFDN0I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vbmdvREJPSURDID0gZXhwb3J0cy5PSURDX1dPUktGTE9XUyA9IGV4cG9ydHMuT0lEQ19WRVJTSU9OID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IGF1dGhfcHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuL2F1dGhfcHJvdmlkZXJcIik7XG5jb25zdCBhenVyZV9tYWNoaW5lX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9tb25nb2RiX29pZGMvYXp1cmVfbWFjaGluZV93b3JrZmxvd1wiKTtcbmNvbnN0IGdjcF9tYWNoaW5lX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9tb25nb2RiX29pZGMvZ2NwX21hY2hpbmVfd29ya2Zsb3dcIik7XG5jb25zdCBrOHNfbWFjaGluZV93b3JrZmxvd18xID0gcmVxdWlyZShcIi4vbW9uZ29kYl9vaWRjL2s4c19tYWNoaW5lX3dvcmtmbG93XCIpO1xuY29uc3QgdG9rZW5fY2FjaGVfMSA9IHJlcXVpcmUoXCIuL21vbmdvZGJfb2lkYy90b2tlbl9jYWNoZVwiKTtcbmNvbnN0IHRva2VuX21hY2hpbmVfd29ya2Zsb3dfMSA9IHJlcXVpcmUoXCIuL21vbmdvZGJfb2lkYy90b2tlbl9tYWNoaW5lX3dvcmtmbG93XCIpO1xuLyoqIEVycm9yIHdoZW4gY3JlZGVudGlhbHMgYXJlIG1pc3NpbmcuICovXG5jb25zdCBNSVNTSU5HX0NSRURFTlRJQUxTX0VSUk9SID0gJ0F1dGhDb250ZXh0IG11c3QgcHJvdmlkZSBjcmVkZW50aWFscy4nO1xuLyoqIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgT0lEQyBpbXBsZW1lbnRhdGlvbi4gKi9cbmV4cG9ydHMuT0lEQ19WRVJTSU9OID0gMTtcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuT0lEQ19XT1JLRkxPV1MgPSBuZXcgTWFwKCk7XG5leHBvcnRzLk9JRENfV09SS0ZMT1dTLnNldCgndGVzdCcsICgpID0+IG5ldyB0b2tlbl9tYWNoaW5lX3dvcmtmbG93XzEuVG9rZW5NYWNoaW5lV29ya2Zsb3cobmV3IHRva2VuX2NhY2hlXzEuVG9rZW5DYWNoZSgpKSk7XG5leHBvcnRzLk9JRENfV09SS0ZMT1dTLnNldCgnYXp1cmUnLCAoKSA9PiBuZXcgYXp1cmVfbWFjaGluZV93b3JrZmxvd18xLkF6dXJlTWFjaGluZVdvcmtmbG93KG5ldyB0b2tlbl9jYWNoZV8xLlRva2VuQ2FjaGUoKSkpO1xuZXhwb3J0cy5PSURDX1dPUktGTE9XUy5zZXQoJ2djcCcsICgpID0+IG5ldyBnY3BfbWFjaGluZV93b3JrZmxvd18xLkdDUE1hY2hpbmVXb3JrZmxvdyhuZXcgdG9rZW5fY2FjaGVfMS5Ub2tlbkNhY2hlKCkpKTtcbmV4cG9ydHMuT0lEQ19XT1JLRkxPV1Muc2V0KCdrOHMnLCAoKSA9PiBuZXcgazhzX21hY2hpbmVfd29ya2Zsb3dfMS5LOFNNYWNoaW5lV29ya2Zsb3cobmV3IHRva2VuX2NhY2hlXzEuVG9rZW5DYWNoZSgpKSk7XG4vKipcbiAqIE9JREMgYXV0aCBwcm92aWRlci5cbiAqL1xuY2xhc3MgTW9uZ29EQk9JREMgZXh0ZW5kcyBhdXRoX3Byb3ZpZGVyXzEuQXV0aFByb3ZpZGVyIHtcbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgYXV0aCBwcm92aWRlci5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih3b3JrZmxvdykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBpZiAoIXdvcmtmbG93KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdObyB3b3JrZmxvdyBwcm92aWRlZCB0byB0aGUgT0lEQyBhdXRoIHByb3ZpZGVyLicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud29ya2Zsb3cgPSB3b3JrZmxvdztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXV0aGVudGljYXRlIHVzaW5nIE9JRENcbiAgICAgKi9cbiAgICBhc3luYyBhdXRoKGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiwgcmVhdXRoZW50aWNhdGluZywgcmVzcG9uc2UgfSA9IGF1dGhDb250ZXh0O1xuICAgICAgICBpZiAocmVzcG9uc2U/LnNwZWN1bGF0aXZlQXV0aGVudGljYXRlPy5kb25lICYmICFyZWF1dGhlbnRpY2F0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY3JlZGVudGlhbHMgPSBnZXRDcmVkZW50aWFscyhhdXRoQ29udGV4dCk7XG4gICAgICAgIGlmIChyZWF1dGhlbnRpY2F0aW5nKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLndvcmtmbG93LnJlYXV0aGVudGljYXRlKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMud29ya2Zsb3cuZXhlY3V0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscywgcmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCB0aGUgc3BlY3VsYXRpdmUgYXV0aCBmb3IgdGhlIGluaXRpYWwgaGFuZHNoYWtlLlxuICAgICAqL1xuICAgIGFzeW5jIHByZXBhcmUoaGFuZHNoYWtlRG9jLCBhdXRoQ29udGV4dCkge1xuICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24gfSA9IGF1dGhDb250ZXh0O1xuICAgICAgICBjb25zdCBjcmVkZW50aWFscyA9IGdldENyZWRlbnRpYWxzKGF1dGhDb250ZXh0KTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy53b3JrZmxvdy5zcGVjdWxhdGl2ZUF1dGgoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgICAgICByZXR1cm4geyAuLi5oYW5kc2hha2VEb2MsIC4uLnJlc3VsdCB9O1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29EQk9JREMgPSBNb25nb0RCT0lEQztcbi8qKlxuICogR2V0IGNyZWRlbnRpYWxzIGZyb20gdGhlIGF1dGggY29udGV4dCwgdGhyb3dpbmcgaWYgdGhleSBkbyBub3QgZXhpc3QuXG4gKi9cbmZ1bmN0aW9uIGdldENyZWRlbnRpYWxzKGF1dGhDb250ZXh0KSB7XG4gICAgY29uc3QgeyBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKE1JU1NJTkdfQ1JFREVOVElBTFNfRVJST1IpO1xuICAgIH1cbiAgICByZXR1cm4gY3JlZGVudGlhbHM7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb25nb2RiX29pZGMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/automated_callback_workflow.js":
/*!**************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/automated_callback_workflow.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AutomatedCallbackWorkflow = void 0;\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst timeout_1 = __webpack_require__(/*! ../../../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst mongodb_oidc_1 = __webpack_require__(/*! ../mongodb_oidc */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js\");\nconst callback_workflow_1 = __webpack_require__(/*! ./callback_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js\");\n/**\n * Class implementing behaviour for the non human callback workflow.\n * @internal\n */\nclass AutomatedCallbackWorkflow extends callback_workflow_1.CallbackWorkflow {\n    /**\n     * Instantiate the human callback workflow.\n     */\n    constructor(cache, callback) {\n        super(cache, callback);\n    }\n    /**\n     * Execute the OIDC callback workflow.\n     */\n    async execute(connection, credentials) {\n        // If there is a cached access token, try to authenticate with it. If\n        // authentication fails with an Authentication error (18),\n        // invalidate the access token, fetch a new access token, and try\n        // to authenticate again.\n        // If the server fails for any other reason, do not clear the cache.\n        if (this.cache.hasAccessToken) {\n            const token = this.cache.getAccessToken();\n            try {\n                return await this.finishAuthentication(connection, credentials, token);\n            }\n            catch (error) {\n                if (error instanceof error_1.MongoError &&\n                    error.code === error_1.MONGODB_ERROR_CODES.AuthenticationFailed) {\n                    this.cache.removeAccessToken();\n                    return await this.execute(connection, credentials);\n                }\n                else {\n                    throw error;\n                }\n            }\n        }\n        const response = await this.fetchAccessToken(credentials);\n        this.cache.put(response);\n        connection.accessToken = response.accessToken;\n        await this.finishAuthentication(connection, credentials, response.accessToken);\n    }\n    /**\n     * Fetches the access token using the callback.\n     */\n    async fetchAccessToken(credentials) {\n        const controller = new AbortController();\n        const params = {\n            timeoutContext: controller.signal,\n            version: mongodb_oidc_1.OIDC_VERSION\n        };\n        if (credentials.username) {\n            params.username = credentials.username;\n        }\n        const timeout = timeout_1.Timeout.expires(callback_workflow_1.AUTOMATED_TIMEOUT_MS);\n        try {\n            return await Promise.race([this.executeAndValidateCallback(params), timeout]);\n        }\n        catch (error) {\n            if (timeout_1.TimeoutError.is(error)) {\n                controller.abort();\n                throw new error_1.MongoOIDCError(`OIDC callback timed out after ${callback_workflow_1.AUTOMATED_TIMEOUT_MS}ms.`);\n            }\n            throw error;\n        }\n        finally {\n            timeout.clear();\n        }\n    }\n}\nexports.AutomatedCallbackWorkflow = AutomatedCallbackWorkflow;\n//# sourceMappingURL=automated_callback_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvYXV0b21hdGVkX2NhbGxiYWNrX3dvcmtmbG93LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlDQUFpQztBQUNqQyxnQkFBZ0IsbUJBQU8sQ0FBQyxtR0FBZ0I7QUFDeEMsa0JBQWtCLG1CQUFPLENBQUMsdUdBQWtCO0FBQzVDLHVCQUF1QixtQkFBTyxDQUFDLHFIQUFpQjtBQUNoRCw0QkFBNEIsbUJBQU8sQ0FBQywySUFBcUI7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0ZBQWtGLHlDQUF5QztBQUMzSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9hdXRoL21vbmdvZGJfb2lkYy9hdXRvbWF0ZWRfY2FsbGJhY2tfd29ya2Zsb3cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkF1dG9tYXRlZENhbGxiYWNrV29ya2Zsb3cgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdGltZW91dF8xID0gcmVxdWlyZShcIi4uLy4uLy4uL3RpbWVvdXRcIik7XG5jb25zdCBtb25nb2RiX29pZGNfMSA9IHJlcXVpcmUoXCIuLi9tb25nb2RiX29pZGNcIik7XG5jb25zdCBjYWxsYmFja193b3JrZmxvd18xID0gcmVxdWlyZShcIi4vY2FsbGJhY2tfd29ya2Zsb3dcIik7XG4vKipcbiAqIENsYXNzIGltcGxlbWVudGluZyBiZWhhdmlvdXIgZm9yIHRoZSBub24gaHVtYW4gY2FsbGJhY2sgd29ya2Zsb3cuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQXV0b21hdGVkQ2FsbGJhY2tXb3JrZmxvdyBleHRlbmRzIGNhbGxiYWNrX3dvcmtmbG93XzEuQ2FsbGJhY2tXb3JrZmxvdyB7XG4gICAgLyoqXG4gICAgICogSW5zdGFudGlhdGUgdGhlIGh1bWFuIGNhbGxiYWNrIHdvcmtmbG93LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNhY2hlLCBjYWxsYmFjaykge1xuICAgICAgICBzdXBlcihjYWNoZSwgY2FsbGJhY2spO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIHRoZSBPSURDIGNhbGxiYWNrIHdvcmtmbG93LlxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGUoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBjYWNoZWQgYWNjZXNzIHRva2VuLCB0cnkgdG8gYXV0aGVudGljYXRlIHdpdGggaXQuIElmXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIGZhaWxzIHdpdGggYW4gQXV0aGVudGljYXRpb24gZXJyb3IgKDE4KSxcbiAgICAgICAgLy8gaW52YWxpZGF0ZSB0aGUgYWNjZXNzIHRva2VuLCBmZXRjaCBhIG5ldyBhY2Nlc3MgdG9rZW4sIGFuZCB0cnlcbiAgICAgICAgLy8gdG8gYXV0aGVudGljYXRlIGFnYWluLlxuICAgICAgICAvLyBJZiB0aGUgc2VydmVyIGZhaWxzIGZvciBhbnkgb3RoZXIgcmVhc29uLCBkbyBub3QgY2xlYXIgdGhlIGNhY2hlLlxuICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXNBY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmNhY2hlLmdldEFjY2Vzc1Rva2VuKCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmZpbmlzaEF1dGhlbnRpY2F0aW9uKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzLCB0b2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IgJiZcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IuY29kZSA9PT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLkF1dGhlbnRpY2F0aW9uRmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FjaGUucmVtb3ZlQWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmZldGNoQWNjZXNzVG9rZW4oY3JlZGVudGlhbHMpO1xuICAgICAgICB0aGlzLmNhY2hlLnB1dChyZXNwb25zZSk7XG4gICAgICAgIGNvbm5lY3Rpb24uYWNjZXNzVG9rZW4gPSByZXNwb25zZS5hY2Nlc3NUb2tlbjtcbiAgICAgICAgYXdhaXQgdGhpcy5maW5pc2hBdXRoZW50aWNhdGlvbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgcmVzcG9uc2UuYWNjZXNzVG9rZW4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaGVzIHRoZSBhY2Nlc3MgdG9rZW4gdXNpbmcgdGhlIGNhbGxiYWNrLlxuICAgICAqL1xuICAgIGFzeW5jIGZldGNoQWNjZXNzVG9rZW4oY3JlZGVudGlhbHMpIHtcbiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgdGltZW91dENvbnRleHQ6IGNvbnRyb2xsZXIuc2lnbmFsLFxuICAgICAgICAgICAgdmVyc2lvbjogbW9uZ29kYl9vaWRjXzEuT0lEQ19WRVJTSU9OXG4gICAgICAgIH07XG4gICAgICAgIGlmIChjcmVkZW50aWFscy51c2VybmFtZSkge1xuICAgICAgICAgICAgcGFyYW1zLnVzZXJuYW1lID0gY3JlZGVudGlhbHMudXNlcm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGltZW91dCA9IHRpbWVvdXRfMS5UaW1lb3V0LmV4cGlyZXMoY2FsbGJhY2tfd29ya2Zsb3dfMS5BVVRPTUFURURfVElNRU9VVF9NUyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5yYWNlKFt0aGlzLmV4ZWN1dGVBbmRWYWxpZGF0ZUNhbGxiYWNrKHBhcmFtcyksIHRpbWVvdXRdKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICh0aW1lb3V0XzEuVGltZW91dEVycm9yLmlzKGVycm9yKSkge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb09JRENFcnJvcihgT0lEQyBjYWxsYmFjayB0aW1lZCBvdXQgYWZ0ZXIgJHtjYWxsYmFja193b3JrZmxvd18xLkFVVE9NQVRFRF9USU1FT1VUX01TfW1zLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aW1lb3V0LmNsZWFyKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkF1dG9tYXRlZENhbGxiYWNrV29ya2Zsb3cgPSBBdXRvbWF0ZWRDYWxsYmFja1dvcmtmbG93O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXV0b21hdGVkX2NhbGxiYWNrX3dvcmtmbG93LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/automated_callback_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_machine_workflow.js":
/*!*********************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_machine_workflow.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AzureMachineWorkflow = void 0;\nconst azure_1 = __webpack_require__(/*! ../../../client-side-encryption/providers/azure */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/providers/azure.js\");\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst machine_workflow_1 = __webpack_require__(/*! ./machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js\");\n/** Azure request headers. */\nconst AZURE_HEADERS = Object.freeze({ Metadata: 'true', Accept: 'application/json' });\n/** Invalid endpoint result error. */\nconst ENDPOINT_RESULT_ERROR = 'Azure endpoint did not return a value with only access_token and expires_in properties';\n/** Error for when the token audience is missing in the environment. */\nconst TOKEN_RESOURCE_MISSING_ERROR = 'TOKEN_RESOURCE must be set in the auth mechanism properties when ENVIRONMENT is azure.';\n/**\n * Device workflow implementation for Azure.\n *\n * @internal\n */\nclass AzureMachineWorkflow extends machine_workflow_1.MachineWorkflow {\n    /**\n     * Instantiate the machine workflow.\n     */\n    constructor(cache) {\n        super(cache);\n    }\n    /**\n     * Get the token from the environment.\n     */\n    async getToken(credentials) {\n        const tokenAudience = credentials?.mechanismProperties.TOKEN_RESOURCE;\n        const username = credentials?.username;\n        if (!tokenAudience) {\n            throw new error_1.MongoAzureError(TOKEN_RESOURCE_MISSING_ERROR);\n        }\n        const response = await getAzureTokenData(tokenAudience, username);\n        if (!isEndpointResultValid(response)) {\n            throw new error_1.MongoAzureError(ENDPOINT_RESULT_ERROR);\n        }\n        return response;\n    }\n}\nexports.AzureMachineWorkflow = AzureMachineWorkflow;\n/**\n * Hit the Azure endpoint to get the token data.\n */\nasync function getAzureTokenData(tokenAudience, username) {\n    const url = new URL(azure_1.AZURE_BASE_URL);\n    (0, azure_1.addAzureParams)(url, tokenAudience, username);\n    const response = await (0, utils_1.get)(url, {\n        headers: AZURE_HEADERS\n    });\n    if (response.status !== 200) {\n        throw new error_1.MongoAzureError(`Status code ${response.status} returned from the Azure endpoint. Response body: ${response.body}`);\n    }\n    const result = JSON.parse(response.body);\n    return {\n        access_token: result.access_token,\n        expires_in: Number(result.expires_in)\n    };\n}\n/**\n * Determines if a result returned from the endpoint is valid.\n * This means the result is not nullish, contains the access_token required field\n * and the expires_in required field.\n */\nfunction isEndpointResultValid(token) {\n    if (token == null || typeof token !== 'object')\n        return false;\n    return ('access_token' in token &&\n        typeof token.access_token === 'string' &&\n        'expires_in' in token &&\n        typeof token.expires_in === 'number');\n}\n//# sourceMappingURL=azure_machine_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvYXp1cmVfbWFjaGluZV93b3JrZmxvdy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw0QkFBNEI7QUFDNUIsZ0JBQWdCLG1CQUFPLENBQUMscUtBQWlEO0FBQ3pFLGdCQUFnQixtQkFBTyxDQUFDLG1HQUFnQjtBQUN4QyxnQkFBZ0IsbUJBQU8sQ0FBQyxtR0FBZ0I7QUFDeEMsMkJBQTJCLG1CQUFPLENBQUMseUlBQW9CO0FBQ3ZEO0FBQ0Esc0NBQXNDLDhDQUE4QztBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx5REFBeUQsaUJBQWlCLG1EQUFtRCxjQUFjO0FBQzNJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvYXp1cmVfbWFjaGluZV93b3JrZmxvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQXp1cmVNYWNoaW5lV29ya2Zsb3cgPSB2b2lkIDA7XG5jb25zdCBhenVyZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vcHJvdmlkZXJzL2F6dXJlXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vdXRpbHNcIik7XG5jb25zdCBtYWNoaW5lX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9tYWNoaW5lX3dvcmtmbG93XCIpO1xuLyoqIEF6dXJlIHJlcXVlc3QgaGVhZGVycy4gKi9cbmNvbnN0IEFaVVJFX0hFQURFUlMgPSBPYmplY3QuZnJlZXplKHsgTWV0YWRhdGE6ICd0cnVlJywgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicgfSk7XG4vKiogSW52YWxpZCBlbmRwb2ludCByZXN1bHQgZXJyb3IuICovXG5jb25zdCBFTkRQT0lOVF9SRVNVTFRfRVJST1IgPSAnQXp1cmUgZW5kcG9pbnQgZGlkIG5vdCByZXR1cm4gYSB2YWx1ZSB3aXRoIG9ubHkgYWNjZXNzX3Rva2VuIGFuZCBleHBpcmVzX2luIHByb3BlcnRpZXMnO1xuLyoqIEVycm9yIGZvciB3aGVuIHRoZSB0b2tlbiBhdWRpZW5jZSBpcyBtaXNzaW5nIGluIHRoZSBlbnZpcm9ubWVudC4gKi9cbmNvbnN0IFRPS0VOX1JFU09VUkNFX01JU1NJTkdfRVJST1IgPSAnVE9LRU5fUkVTT1VSQ0UgbXVzdCBiZSBzZXQgaW4gdGhlIGF1dGggbWVjaGFuaXNtIHByb3BlcnRpZXMgd2hlbiBFTlZJUk9OTUVOVCBpcyBhenVyZS4nO1xuLyoqXG4gKiBEZXZpY2Ugd29ya2Zsb3cgaW1wbGVtZW50YXRpb24gZm9yIEF6dXJlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBBenVyZU1hY2hpbmVXb3JrZmxvdyBleHRlbmRzIG1hY2hpbmVfd29ya2Zsb3dfMS5NYWNoaW5lV29ya2Zsb3cge1xuICAgIC8qKlxuICAgICAqIEluc3RhbnRpYXRlIHRoZSBtYWNoaW5lIHdvcmtmbG93LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNhY2hlKSB7XG4gICAgICAgIHN1cGVyKGNhY2hlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB0b2tlbiBmcm9tIHRoZSBlbnZpcm9ubWVudC5cbiAgICAgKi9cbiAgICBhc3luYyBnZXRUb2tlbihjcmVkZW50aWFscykge1xuICAgICAgICBjb25zdCB0b2tlbkF1ZGllbmNlID0gY3JlZGVudGlhbHM/Lm1lY2hhbmlzbVByb3BlcnRpZXMuVE9LRU5fUkVTT1VSQ0U7XG4gICAgICAgIGNvbnN0IHVzZXJuYW1lID0gY3JlZGVudGlhbHM/LnVzZXJuYW1lO1xuICAgICAgICBpZiAoIXRva2VuQXVkaWVuY2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQXp1cmVFcnJvcihUT0tFTl9SRVNPVVJDRV9NSVNTSU5HX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldEF6dXJlVG9rZW5EYXRhKHRva2VuQXVkaWVuY2UsIHVzZXJuYW1lKTtcbiAgICAgICAgaWYgKCFpc0VuZHBvaW50UmVzdWx0VmFsaWQocmVzcG9uc2UpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0F6dXJlRXJyb3IoRU5EUE9JTlRfUkVTVUxUX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxufVxuZXhwb3J0cy5BenVyZU1hY2hpbmVXb3JrZmxvdyA9IEF6dXJlTWFjaGluZVdvcmtmbG93O1xuLyoqXG4gKiBIaXQgdGhlIEF6dXJlIGVuZHBvaW50IHRvIGdldCB0aGUgdG9rZW4gZGF0YS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QXp1cmVUb2tlbkRhdGEodG9rZW5BdWRpZW5jZSwgdXNlcm5hbWUpIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGF6dXJlXzEuQVpVUkVfQkFTRV9VUkwpO1xuICAgICgwLCBhenVyZV8xLmFkZEF6dXJlUGFyYW1zKSh1cmwsIHRva2VuQXVkaWVuY2UsIHVzZXJuYW1lKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0ICgwLCB1dGlsc18xLmdldCkodXJsLCB7XG4gICAgICAgIGhlYWRlcnM6IEFaVVJFX0hFQURFUlNcbiAgICB9KTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BenVyZUVycm9yKGBTdGF0dXMgY29kZSAke3Jlc3BvbnNlLnN0YXR1c30gcmV0dXJuZWQgZnJvbSB0aGUgQXp1cmUgZW5kcG9pbnQuIFJlc3BvbnNlIGJvZHk6ICR7cmVzcG9uc2UuYm9keX1gKTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS5ib2R5KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhY2Nlc3NfdG9rZW46IHJlc3VsdC5hY2Nlc3NfdG9rZW4sXG4gICAgICAgIGV4cGlyZXNfaW46IE51bWJlcihyZXN1bHQuZXhwaXJlc19pbilcbiAgICB9O1xufVxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIGEgcmVzdWx0IHJldHVybmVkIGZyb20gdGhlIGVuZHBvaW50IGlzIHZhbGlkLlxuICogVGhpcyBtZWFucyB0aGUgcmVzdWx0IGlzIG5vdCBudWxsaXNoLCBjb250YWlucyB0aGUgYWNjZXNzX3Rva2VuIHJlcXVpcmVkIGZpZWxkXG4gKiBhbmQgdGhlIGV4cGlyZXNfaW4gcmVxdWlyZWQgZmllbGQuXG4gKi9cbmZ1bmN0aW9uIGlzRW5kcG9pbnRSZXN1bHRWYWxpZCh0b2tlbikge1xuICAgIGlmICh0b2tlbiA9PSBudWxsIHx8IHR5cGVvZiB0b2tlbiAhPT0gJ29iamVjdCcpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gKCdhY2Nlc3NfdG9rZW4nIGluIHRva2VuICYmXG4gICAgICAgIHR5cGVvZiB0b2tlbi5hY2Nlc3NfdG9rZW4gPT09ICdzdHJpbmcnICYmXG4gICAgICAgICdleHBpcmVzX2luJyBpbiB0b2tlbiAmJlxuICAgICAgICB0eXBlb2YgdG9rZW4uZXhwaXJlc19pbiA9PT0gJ251bWJlcicpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXp1cmVfbWFjaGluZV93b3JrZmxvdy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/azure_machine_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js":
/*!****************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CallbackWorkflow = exports.AUTOMATED_TIMEOUT_MS = exports.HUMAN_TIMEOUT_MS = void 0;\nconst promises_1 = __webpack_require__(/*! timers/promises */ \"timers/promises\");\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_builders_1 = __webpack_require__(/*! ./command_builders */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/command_builders.js\");\n/** 5 minutes in milliseconds */\nexports.HUMAN_TIMEOUT_MS = 300000;\n/** 1 minute in milliseconds */\nexports.AUTOMATED_TIMEOUT_MS = 60000;\n/** Properties allowed on results of callbacks. */\nconst RESULT_PROPERTIES = ['accessToken', 'expiresInSeconds', 'refreshToken'];\n/** Error message when the callback result is invalid. */\nconst CALLBACK_RESULT_ERROR = 'User provided OIDC callbacks must return a valid object with an accessToken.';\n/** The time to throttle callback calls. */\nconst THROTTLE_MS = 100;\n/**\n * OIDC implementation of a callback based workflow.\n * @internal\n */\nclass CallbackWorkflow {\n    /**\n     * Instantiate the callback workflow.\n     */\n    constructor(cache, callback) {\n        this.cache = cache;\n        this.callback = this.withLock(callback);\n        this.lastExecutionTime = Date.now() - THROTTLE_MS;\n    }\n    /**\n     * Get the document to add for speculative authentication. This also needs\n     * to add a db field from the credentials source.\n     */\n    async speculativeAuth(connection, credentials) {\n        // Check if the Client Cache has an access token.\n        // If it does, cache the access token in the Connection Cache and send a JwtStepRequest\n        // with the cached access token in the speculative authentication SASL payload.\n        if (this.cache.hasAccessToken) {\n            const accessToken = this.cache.getAccessToken();\n            connection.accessToken = accessToken;\n            const document = (0, command_builders_1.finishCommandDocument)(accessToken);\n            document.db = credentials.source;\n            return { speculativeAuthenticate: document };\n        }\n        return {};\n    }\n    /**\n     * Reauthenticate the callback workflow. For this we invalidated the access token\n     * in the cache and run the authentication steps again. No initial handshake needs\n     * to be sent.\n     */\n    async reauthenticate(connection, credentials) {\n        if (this.cache.hasAccessToken) {\n            // Reauthentication implies the token has expired.\n            if (connection.accessToken === this.cache.getAccessToken()) {\n                // If connection's access token is the same as the cache's, remove\n                // the token from the cache and connection.\n                this.cache.removeAccessToken();\n                delete connection.accessToken;\n            }\n            else {\n                // If the connection's access token is different from the cache's, set\n                // the cache's token on the connection and do not remove from the\n                // cache.\n                connection.accessToken = this.cache.getAccessToken();\n            }\n        }\n        await this.execute(connection, credentials);\n    }\n    /**\n     * Starts the callback authentication process. If there is a speculative\n     * authentication document from the initial handshake, then we will use that\n     * value to get the issuer, otherwise we will send the saslStart command.\n     */\n    async startAuthentication(connection, credentials, response) {\n        let result;\n        if (response?.speculativeAuthenticate) {\n            result = response.speculativeAuthenticate;\n        }\n        else {\n            result = await connection.command((0, utils_1.ns)(credentials.source), (0, command_builders_1.startCommandDocument)(credentials), undefined);\n        }\n        return result;\n    }\n    /**\n     * Finishes the callback authentication process.\n     */\n    async finishAuthentication(connection, credentials, token, conversationId) {\n        await connection.command((0, utils_1.ns)(credentials.source), (0, command_builders_1.finishCommandDocument)(token, conversationId), undefined);\n    }\n    /**\n     * Executes the callback and validates the output.\n     */\n    async executeAndValidateCallback(params) {\n        const result = await this.callback(params);\n        // Validate that the result returned by the callback is acceptable. If it is not\n        // we must clear the token result from the cache.\n        if (isCallbackResultInvalid(result)) {\n            throw new error_1.MongoMissingCredentialsError(CALLBACK_RESULT_ERROR);\n        }\n        return result;\n    }\n    /**\n     * Ensure the callback is only executed one at a time and throttles the calls\n     * to every 100ms.\n     */\n    withLock(callback) {\n        let lock = Promise.resolve();\n        return async (params) => {\n            // We do this to ensure that we would never return the result of the\n            // previous lock, only the current callback's value would get returned.\n            await lock;\n            lock = lock\n                .catch(() => null)\n                .then(async () => {\n                const difference = Date.now() - this.lastExecutionTime;\n                if (difference <= THROTTLE_MS) {\n                    await (0, promises_1.setTimeout)(THROTTLE_MS - difference, { signal: params.timeoutContext });\n                }\n                this.lastExecutionTime = Date.now();\n                return await callback(params);\n            });\n            return await lock;\n        };\n    }\n}\nexports.CallbackWorkflow = CallbackWorkflow;\n/**\n * Determines if a result returned from a request or refresh callback\n * function is invalid. This means the result is nullish, doesn't contain\n * the accessToken required field, and does not contain extra fields.\n */\nfunction isCallbackResultInvalid(tokenResult) {\n    if (tokenResult == null || typeof tokenResult !== 'object')\n        return true;\n    if (!('accessToken' in tokenResult))\n        return true;\n    return !Object.getOwnPropertyNames(tokenResult).every(prop => RESULT_PROPERTIES.includes(prop));\n}\n//# sourceMappingURL=callback_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvY2FsbGJhY2tfd29ya2Zsb3cuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCLEdBQUcsNEJBQTRCLEdBQUcsd0JBQXdCO0FBQ2xGLG1CQUFtQixtQkFBTyxDQUFDLHdDQUFpQjtBQUM1QyxnQkFBZ0IsbUJBQU8sQ0FBQyxtR0FBZ0I7QUFDeEMsZ0JBQWdCLG1CQUFPLENBQUMsbUdBQWdCO0FBQ3hDLDJCQUEyQixtQkFBTyxDQUFDLHlJQUFvQjtBQUN2RDtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsK0JBQStCO0FBQ2hIO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvY2FsbGJhY2tfd29ya2Zsb3cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhbGxiYWNrV29ya2Zsb3cgPSBleHBvcnRzLkFVVE9NQVRFRF9USU1FT1VUX01TID0gZXhwb3J0cy5IVU1BTl9USU1FT1VUX01TID0gdm9pZCAwO1xuY29uc3QgcHJvbWlzZXNfMSA9IHJlcXVpcmUoXCJ0aW1lcnMvcHJvbWlzZXNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1hbmRfYnVpbGRlcnNfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRfYnVpbGRlcnNcIik7XG4vKiogNSBtaW51dGVzIGluIG1pbGxpc2Vjb25kcyAqL1xuZXhwb3J0cy5IVU1BTl9USU1FT1VUX01TID0gMzAwMDAwO1xuLyoqIDEgbWludXRlIGluIG1pbGxpc2Vjb25kcyAqL1xuZXhwb3J0cy5BVVRPTUFURURfVElNRU9VVF9NUyA9IDYwMDAwO1xuLyoqIFByb3BlcnRpZXMgYWxsb3dlZCBvbiByZXN1bHRzIG9mIGNhbGxiYWNrcy4gKi9cbmNvbnN0IFJFU1VMVF9QUk9QRVJUSUVTID0gWydhY2Nlc3NUb2tlbicsICdleHBpcmVzSW5TZWNvbmRzJywgJ3JlZnJlc2hUb2tlbiddO1xuLyoqIEVycm9yIG1lc3NhZ2Ugd2hlbiB0aGUgY2FsbGJhY2sgcmVzdWx0IGlzIGludmFsaWQuICovXG5jb25zdCBDQUxMQkFDS19SRVNVTFRfRVJST1IgPSAnVXNlciBwcm92aWRlZCBPSURDIGNhbGxiYWNrcyBtdXN0IHJldHVybiBhIHZhbGlkIG9iamVjdCB3aXRoIGFuIGFjY2Vzc1Rva2VuLic7XG4vKiogVGhlIHRpbWUgdG8gdGhyb3R0bGUgY2FsbGJhY2sgY2FsbHMuICovXG5jb25zdCBUSFJPVFRMRV9NUyA9IDEwMDtcbi8qKlxuICogT0lEQyBpbXBsZW1lbnRhdGlvbiBvZiBhIGNhbGxiYWNrIGJhc2VkIHdvcmtmbG93LlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIENhbGxiYWNrV29ya2Zsb3cge1xuICAgIC8qKlxuICAgICAqIEluc3RhbnRpYXRlIHRoZSBjYWxsYmFjayB3b3JrZmxvdy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjYWNoZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jYWNoZSA9IGNhY2hlO1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gdGhpcy53aXRoTG9jayhjYWxsYmFjayk7XG4gICAgICAgIHRoaXMubGFzdEV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gVEhST1RUTEVfTVM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgZG9jdW1lbnQgdG8gYWRkIGZvciBzcGVjdWxhdGl2ZSBhdXRoZW50aWNhdGlvbi4gVGhpcyBhbHNvIG5lZWRzXG4gICAgICogdG8gYWRkIGEgZGIgZmllbGQgZnJvbSB0aGUgY3JlZGVudGlhbHMgc291cmNlLlxuICAgICAqL1xuICAgIGFzeW5jIHNwZWN1bGF0aXZlQXV0aChjb25uZWN0aW9uLCBjcmVkZW50aWFscykge1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgQ2xpZW50IENhY2hlIGhhcyBhbiBhY2Nlc3MgdG9rZW4uXG4gICAgICAgIC8vIElmIGl0IGRvZXMsIGNhY2hlIHRoZSBhY2Nlc3MgdG9rZW4gaW4gdGhlIENvbm5lY3Rpb24gQ2FjaGUgYW5kIHNlbmQgYSBKd3RTdGVwUmVxdWVzdFxuICAgICAgICAvLyB3aXRoIHRoZSBjYWNoZWQgYWNjZXNzIHRva2VuIGluIHRoZSBzcGVjdWxhdGl2ZSBhdXRoZW50aWNhdGlvbiBTQVNMIHBheWxvYWQuXG4gICAgICAgIGlmICh0aGlzLmNhY2hlLmhhc0FjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRoaXMuY2FjaGUuZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGNvbnN0IGRvY3VtZW50ID0gKDAsIGNvbW1hbmRfYnVpbGRlcnNfMS5maW5pc2hDb21tYW5kRG9jdW1lbnQpKGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmRiID0gY3JlZGVudGlhbHMuc291cmNlO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3BlY3VsYXRpdmVBdXRoZW50aWNhdGU6IGRvY3VtZW50IH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWF1dGhlbnRpY2F0ZSB0aGUgY2FsbGJhY2sgd29ya2Zsb3cuIEZvciB0aGlzIHdlIGludmFsaWRhdGVkIHRoZSBhY2Nlc3MgdG9rZW5cbiAgICAgKiBpbiB0aGUgY2FjaGUgYW5kIHJ1biB0aGUgYXV0aGVudGljYXRpb24gc3RlcHMgYWdhaW4uIE5vIGluaXRpYWwgaGFuZHNoYWtlIG5lZWRzXG4gICAgICogdG8gYmUgc2VudC5cbiAgICAgKi9cbiAgICBhc3luYyByZWF1dGhlbnRpY2F0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscykge1xuICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXNBY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgLy8gUmVhdXRoZW50aWNhdGlvbiBpbXBsaWVzIHRoZSB0b2tlbiBoYXMgZXhwaXJlZC5cbiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uLmFjY2Vzc1Rva2VuID09PSB0aGlzLmNhY2hlLmdldEFjY2Vzc1Rva2VuKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBjb25uZWN0aW9uJ3MgYWNjZXNzIHRva2VuIGlzIHRoZSBzYW1lIGFzIHRoZSBjYWNoZSdzLCByZW1vdmVcbiAgICAgICAgICAgICAgICAvLyB0aGUgdG9rZW4gZnJvbSB0aGUgY2FjaGUgYW5kIGNvbm5lY3Rpb24uXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5yZW1vdmVBY2Nlc3NUb2tlbigpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25uZWN0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIGNvbm5lY3Rpb24ncyBhY2Nlc3MgdG9rZW4gaXMgZGlmZmVyZW50IGZyb20gdGhlIGNhY2hlJ3MsIHNldFxuICAgICAgICAgICAgICAgIC8vIHRoZSBjYWNoZSdzIHRva2VuIG9uIHRoZSBjb25uZWN0aW9uIGFuZCBkbyBub3QgcmVtb3ZlIGZyb20gdGhlXG4gICAgICAgICAgICAgICAgLy8gY2FjaGUuXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5hY2Nlc3NUb2tlbiA9IHRoaXMuY2FjaGUuZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGUoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydHMgdGhlIGNhbGxiYWNrIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MuIElmIHRoZXJlIGlzIGEgc3BlY3VsYXRpdmVcbiAgICAgKiBhdXRoZW50aWNhdGlvbiBkb2N1bWVudCBmcm9tIHRoZSBpbml0aWFsIGhhbmRzaGFrZSwgdGhlbiB3ZSB3aWxsIHVzZSB0aGF0XG4gICAgICogdmFsdWUgdG8gZ2V0IHRoZSBpc3N1ZXIsIG90aGVyd2lzZSB3ZSB3aWxsIHNlbmQgdGhlIHNhc2xTdGFydCBjb21tYW5kLlxuICAgICAqL1xuICAgIGFzeW5jIHN0YXJ0QXV0aGVudGljYXRpb24oY29ubmVjdGlvbiwgY3JlZGVudGlhbHMsIHJlc3BvbnNlKSB7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGlmIChyZXNwb25zZT8uc3BlY3VsYXRpdmVBdXRoZW50aWNhdGUpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLnNwZWN1bGF0aXZlQXV0aGVudGljYXRlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kKCgwLCB1dGlsc18xLm5zKShjcmVkZW50aWFscy5zb3VyY2UpLCAoMCwgY29tbWFuZF9idWlsZGVyc18xLnN0YXJ0Q29tbWFuZERvY3VtZW50KShjcmVkZW50aWFscyksIHVuZGVmaW5lZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmluaXNoZXMgdGhlIGNhbGxiYWNrIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MuXG4gICAgICovXG4gICAgYXN5bmMgZmluaXNoQXV0aGVudGljYXRpb24oY29ubmVjdGlvbiwgY3JlZGVudGlhbHMsIHRva2VuLCBjb252ZXJzYXRpb25JZCkge1xuICAgICAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKGNyZWRlbnRpYWxzLnNvdXJjZSksICgwLCBjb21tYW5kX2J1aWxkZXJzXzEuZmluaXNoQ29tbWFuZERvY3VtZW50KSh0b2tlbiwgY29udmVyc2F0aW9uSWQpLCB1bmRlZmluZWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlcyB0aGUgY2FsbGJhY2sgYW5kIHZhbGlkYXRlcyB0aGUgb3V0cHV0LlxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGVBbmRWYWxpZGF0ZUNhbGxiYWNrKHBhcmFtcykge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNhbGxiYWNrKHBhcmFtcyk7XG4gICAgICAgIC8vIFZhbGlkYXRlIHRoYXQgdGhlIHJlc3VsdCByZXR1cm5lZCBieSB0aGUgY2FsbGJhY2sgaXMgYWNjZXB0YWJsZS4gSWYgaXQgaXMgbm90XG4gICAgICAgIC8vIHdlIG11c3QgY2xlYXIgdGhlIHRva2VuIHJlc3VsdCBmcm9tIHRoZSBjYWNoZS5cbiAgICAgICAgaWYgKGlzQ2FsbGJhY2tSZXN1bHRJbnZhbGlkKHJlc3VsdCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoQ0FMTEJBQ0tfUkVTVUxUX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnN1cmUgdGhlIGNhbGxiYWNrIGlzIG9ubHkgZXhlY3V0ZWQgb25lIGF0IGEgdGltZSBhbmQgdGhyb3R0bGVzIHRoZSBjYWxsc1xuICAgICAqIHRvIGV2ZXJ5IDEwMG1zLlxuICAgICAqL1xuICAgIHdpdGhMb2NrKGNhbGxiYWNrKSB7XG4gICAgICAgIGxldCBsb2NrID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIHJldHVybiBhc3luYyAocGFyYW1zKSA9PiB7XG4gICAgICAgICAgICAvLyBXZSBkbyB0aGlzIHRvIGVuc3VyZSB0aGF0IHdlIHdvdWxkIG5ldmVyIHJldHVybiB0aGUgcmVzdWx0IG9mIHRoZVxuICAgICAgICAgICAgLy8gcHJldmlvdXMgbG9jaywgb25seSB0aGUgY3VycmVudCBjYWxsYmFjaydzIHZhbHVlIHdvdWxkIGdldCByZXR1cm5lZC5cbiAgICAgICAgICAgIGF3YWl0IGxvY2s7XG4gICAgICAgICAgICBsb2NrID0gbG9ja1xuICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBudWxsKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkaWZmZXJlbmNlID0gRGF0ZS5ub3coKSAtIHRoaXMubGFzdEV4ZWN1dGlvblRpbWU7XG4gICAgICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UgPD0gVEhST1RUTEVfTVMpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgKDAsIHByb21pc2VzXzEuc2V0VGltZW91dCkoVEhST1RUTEVfTVMgLSBkaWZmZXJlbmNlLCB7IHNpZ25hbDogcGFyYW1zLnRpbWVvdXRDb250ZXh0IH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RFeGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgY2FsbGJhY2socGFyYW1zKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGxvY2s7XG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5DYWxsYmFja1dvcmtmbG93ID0gQ2FsbGJhY2tXb3JrZmxvdztcbi8qKlxuICogRGV0ZXJtaW5lcyBpZiBhIHJlc3VsdCByZXR1cm5lZCBmcm9tIGEgcmVxdWVzdCBvciByZWZyZXNoIGNhbGxiYWNrXG4gKiBmdW5jdGlvbiBpcyBpbnZhbGlkLiBUaGlzIG1lYW5zIHRoZSByZXN1bHQgaXMgbnVsbGlzaCwgZG9lc24ndCBjb250YWluXG4gKiB0aGUgYWNjZXNzVG9rZW4gcmVxdWlyZWQgZmllbGQsIGFuZCBkb2VzIG5vdCBjb250YWluIGV4dHJhIGZpZWxkcy5cbiAqL1xuZnVuY3Rpb24gaXNDYWxsYmFja1Jlc3VsdEludmFsaWQodG9rZW5SZXN1bHQpIHtcbiAgICBpZiAodG9rZW5SZXN1bHQgPT0gbnVsbCB8fCB0eXBlb2YgdG9rZW5SZXN1bHQgIT09ICdvYmplY3QnKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoISgnYWNjZXNzVG9rZW4nIGluIHRva2VuUmVzdWx0KSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuICFPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0b2tlblJlc3VsdCkuZXZlcnkocHJvcCA9PiBSRVNVTFRfUFJPUEVSVElFUy5pbmNsdWRlcyhwcm9wKSk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYWxsYmFja193b3JrZmxvdy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/command_builders.js":
/*!***************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/command_builders.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.finishCommandDocument = finishCommandDocument;\nexports.startCommandDocument = startCommandDocument;\nconst bson_1 = __webpack_require__(/*! ../../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst providers_1 = __webpack_require__(/*! ../providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\n/**\n * Generate the finishing command document for authentication. Will be a\n * saslStart or saslContinue depending on the presence of a conversation id.\n */\nfunction finishCommandDocument(token, conversationId) {\n    if (conversationId != null) {\n        return {\n            saslContinue: 1,\n            conversationId: conversationId,\n            payload: new bson_1.Binary(bson_1.BSON.serialize({ jwt: token }))\n        };\n    }\n    // saslContinue requires a conversationId in the command to be valid so in this\n    // case the server allows \"step two\" to actually be a saslStart with the token\n    // as the jwt since the use of the cached value has no correlating conversating\n    // on the particular connection.\n    return {\n        saslStart: 1,\n        mechanism: providers_1.AuthMechanism.MONGODB_OIDC,\n        payload: new bson_1.Binary(bson_1.BSON.serialize({ jwt: token }))\n    };\n}\n/**\n * Generate the saslStart command document.\n */\nfunction startCommandDocument(credentials) {\n    const payload = {};\n    if (credentials.username) {\n        payload.n = credentials.username;\n    }\n    return {\n        saslStart: 1,\n        autoAuthorize: 1,\n        mechanism: providers_1.AuthMechanism.MONGODB_OIDC,\n        payload: new bson_1.Binary(bson_1.BSON.serialize(payload))\n    };\n}\n//# sourceMappingURL=command_builders.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvY29tbWFuZF9idWlsZGVycy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw2QkFBNkI7QUFDN0IsNEJBQTRCO0FBQzVCLGVBQWUsbUJBQU8sQ0FBQyxpR0FBZTtBQUN0QyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0QsWUFBWTtBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsWUFBWTtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2NvbW1hbmRfYnVpbGRlcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmZpbmlzaENvbW1hbmREb2N1bWVudCA9IGZpbmlzaENvbW1hbmREb2N1bWVudDtcbmV4cG9ydHMuc3RhcnRDb21tYW5kRG9jdW1lbnQgPSBzdGFydENvbW1hbmREb2N1bWVudDtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9ic29uXCIpO1xuY29uc3QgcHJvdmlkZXJzXzEgPSByZXF1aXJlKFwiLi4vcHJvdmlkZXJzXCIpO1xuLyoqXG4gKiBHZW5lcmF0ZSB0aGUgZmluaXNoaW5nIGNvbW1hbmQgZG9jdW1lbnQgZm9yIGF1dGhlbnRpY2F0aW9uLiBXaWxsIGJlIGFcbiAqIHNhc2xTdGFydCBvciBzYXNsQ29udGludWUgZGVwZW5kaW5nIG9uIHRoZSBwcmVzZW5jZSBvZiBhIGNvbnZlcnNhdGlvbiBpZC5cbiAqL1xuZnVuY3Rpb24gZmluaXNoQ29tbWFuZERvY3VtZW50KHRva2VuLCBjb252ZXJzYXRpb25JZCkge1xuICAgIGlmIChjb252ZXJzYXRpb25JZCAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzYXNsQ29udGludWU6IDEsXG4gICAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgICBwYXlsb2FkOiBuZXcgYnNvbl8xLkJpbmFyeShic29uXzEuQlNPTi5zZXJpYWxpemUoeyBqd3Q6IHRva2VuIH0pKVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBzYXNsQ29udGludWUgcmVxdWlyZXMgYSBjb252ZXJzYXRpb25JZCBpbiB0aGUgY29tbWFuZCB0byBiZSB2YWxpZCBzbyBpbiB0aGlzXG4gICAgLy8gY2FzZSB0aGUgc2VydmVyIGFsbG93cyBcInN0ZXAgdHdvXCIgdG8gYWN0dWFsbHkgYmUgYSBzYXNsU3RhcnQgd2l0aCB0aGUgdG9rZW5cbiAgICAvLyBhcyB0aGUgand0IHNpbmNlIHRoZSB1c2Ugb2YgdGhlIGNhY2hlZCB2YWx1ZSBoYXMgbm8gY29ycmVsYXRpbmcgY29udmVyc2F0aW5nXG4gICAgLy8gb24gdGhlIHBhcnRpY3VsYXIgY29ubmVjdGlvbi5cbiAgICByZXR1cm4ge1xuICAgICAgICBzYXNsU3RhcnQ6IDEsXG4gICAgICAgIG1lY2hhbmlzbTogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX09JREMsXG4gICAgICAgIHBheWxvYWQ6IG5ldyBic29uXzEuQmluYXJ5KGJzb25fMS5CU09OLnNlcmlhbGl6ZSh7IGp3dDogdG9rZW4gfSkpXG4gICAgfTtcbn1cbi8qKlxuICogR2VuZXJhdGUgdGhlIHNhc2xTdGFydCBjb21tYW5kIGRvY3VtZW50LlxuICovXG5mdW5jdGlvbiBzdGFydENvbW1hbmREb2N1bWVudChjcmVkZW50aWFscykge1xuICAgIGNvbnN0IHBheWxvYWQgPSB7fTtcbiAgICBpZiAoY3JlZGVudGlhbHMudXNlcm5hbWUpIHtcbiAgICAgICAgcGF5bG9hZC5uID0gY3JlZGVudGlhbHMudXNlcm5hbWU7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHNhc2xTdGFydDogMSxcbiAgICAgICAgYXV0b0F1dGhvcml6ZTogMSxcbiAgICAgICAgbWVjaGFuaXNtOiBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQyxcbiAgICAgICAgcGF5bG9hZDogbmV3IGJzb25fMS5CaW5hcnkoYnNvbl8xLkJTT04uc2VyaWFsaXplKHBheWxvYWQpKVxuICAgIH07XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tYW5kX2J1aWxkZXJzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/command_builders.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/gcp_machine_workflow.js":
/*!*******************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/gcp_machine_workflow.js ***!
  \*******************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GCPMachineWorkflow = void 0;\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst machine_workflow_1 = __webpack_require__(/*! ./machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js\");\n/** GCP base URL. */\nconst GCP_BASE_URL = 'http://metadata/computeMetadata/v1/instance/service-accounts/default/identity';\n/** GCP request headers. */\nconst GCP_HEADERS = Object.freeze({ 'Metadata-Flavor': 'Google' });\n/** Error for when the token audience is missing in the environment. */\nconst TOKEN_RESOURCE_MISSING_ERROR = 'TOKEN_RESOURCE must be set in the auth mechanism properties when ENVIRONMENT is gcp.';\nclass GCPMachineWorkflow extends machine_workflow_1.MachineWorkflow {\n    /**\n     * Instantiate the machine workflow.\n     */\n    constructor(cache) {\n        super(cache);\n    }\n    /**\n     * Get the token from the environment.\n     */\n    async getToken(credentials) {\n        const tokenAudience = credentials?.mechanismProperties.TOKEN_RESOURCE;\n        if (!tokenAudience) {\n            throw new error_1.MongoGCPError(TOKEN_RESOURCE_MISSING_ERROR);\n        }\n        return await getGcpTokenData(tokenAudience);\n    }\n}\nexports.GCPMachineWorkflow = GCPMachineWorkflow;\n/**\n * Hit the GCP endpoint to get the token data.\n */\nasync function getGcpTokenData(tokenAudience) {\n    const url = new URL(GCP_BASE_URL);\n    url.searchParams.append('audience', tokenAudience);\n    const response = await (0, utils_1.get)(url, {\n        headers: GCP_HEADERS\n    });\n    if (response.status !== 200) {\n        throw new error_1.MongoGCPError(`Status code ${response.status} returned from the GCP endpoint. Response body: ${response.body}`);\n    }\n    return { access_token: response.body };\n}\n//# sourceMappingURL=gcp_machine_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvZ2NwX21hY2hpbmVfd29ya2Zsb3cuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMEJBQTBCO0FBQzFCLGdCQUFnQixtQkFBTyxDQUFDLG1HQUFnQjtBQUN4QyxnQkFBZ0IsbUJBQU8sQ0FBQyxtR0FBZ0I7QUFDeEMsMkJBQTJCLG1CQUFPLENBQUMseUlBQW9CO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyw2QkFBNkI7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsdURBQXVELGlCQUFpQixpREFBaUQsY0FBYztBQUN2STtBQUNBLGFBQWE7QUFDYjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9hdXRoL21vbmdvZGJfb2lkYy9nY3BfbWFjaGluZV93b3JrZmxvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuR0NQTWFjaGluZVdvcmtmbG93ID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vdXRpbHNcIik7XG5jb25zdCBtYWNoaW5lX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9tYWNoaW5lX3dvcmtmbG93XCIpO1xuLyoqIEdDUCBiYXNlIFVSTC4gKi9cbmNvbnN0IEdDUF9CQVNFX1VSTCA9ICdodHRwOi8vbWV0YWRhdGEvY29tcHV0ZU1ldGFkYXRhL3YxL2luc3RhbmNlL3NlcnZpY2UtYWNjb3VudHMvZGVmYXVsdC9pZGVudGl0eSc7XG4vKiogR0NQIHJlcXVlc3QgaGVhZGVycy4gKi9cbmNvbnN0IEdDUF9IRUFERVJTID0gT2JqZWN0LmZyZWV6ZSh7ICdNZXRhZGF0YS1GbGF2b3InOiAnR29vZ2xlJyB9KTtcbi8qKiBFcnJvciBmb3Igd2hlbiB0aGUgdG9rZW4gYXVkaWVuY2UgaXMgbWlzc2luZyBpbiB0aGUgZW52aXJvbm1lbnQuICovXG5jb25zdCBUT0tFTl9SRVNPVVJDRV9NSVNTSU5HX0VSUk9SID0gJ1RPS0VOX1JFU09VUkNFIG11c3QgYmUgc2V0IGluIHRoZSBhdXRoIG1lY2hhbmlzbSBwcm9wZXJ0aWVzIHdoZW4gRU5WSVJPTk1FTlQgaXMgZ2NwLic7XG5jbGFzcyBHQ1BNYWNoaW5lV29ya2Zsb3cgZXh0ZW5kcyBtYWNoaW5lX3dvcmtmbG93XzEuTWFjaGluZVdvcmtmbG93IHtcbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgbWFjaGluZSB3b3JrZmxvdy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjYWNoZSkge1xuICAgICAgICBzdXBlcihjYWNoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdG9rZW4gZnJvbSB0aGUgZW52aXJvbm1lbnQuXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VG9rZW4oY3JlZGVudGlhbHMpIHtcbiAgICAgICAgY29uc3QgdG9rZW5BdWRpZW5jZSA9IGNyZWRlbnRpYWxzPy5tZWNoYW5pc21Qcm9wZXJ0aWVzLlRPS0VOX1JFU09VUkNFO1xuICAgICAgICBpZiAoIXRva2VuQXVkaWVuY2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvR0NQRXJyb3IoVE9LRU5fUkVTT1VSQ0VfTUlTU0lOR19FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldEdjcFRva2VuRGF0YSh0b2tlbkF1ZGllbmNlKTtcbiAgICB9XG59XG5leHBvcnRzLkdDUE1hY2hpbmVXb3JrZmxvdyA9IEdDUE1hY2hpbmVXb3JrZmxvdztcbi8qKlxuICogSGl0IHRoZSBHQ1AgZW5kcG9pbnQgdG8gZ2V0IHRoZSB0b2tlbiBkYXRhLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRHY3BUb2tlbkRhdGEodG9rZW5BdWRpZW5jZSkge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoR0NQX0JBU0VfVVJMKTtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLmFwcGVuZCgnYXVkaWVuY2UnLCB0b2tlbkF1ZGllbmNlKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0ICgwLCB1dGlsc18xLmdldCkodXJsLCB7XG4gICAgICAgIGhlYWRlcnM6IEdDUF9IRUFERVJTXG4gICAgfSk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvR0NQRXJyb3IoYFN0YXR1cyBjb2RlICR7cmVzcG9uc2Uuc3RhdHVzfSByZXR1cm5lZCBmcm9tIHRoZSBHQ1AgZW5kcG9pbnQuIFJlc3BvbnNlIGJvZHk6ICR7cmVzcG9uc2UuYm9keX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgYWNjZXNzX3Rva2VuOiByZXNwb25zZS5ib2R5IH07XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1nY3BfbWFjaGluZV93b3JrZmxvdy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/gcp_machine_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/human_callback_workflow.js":
/*!**********************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/human_callback_workflow.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.HumanCallbackWorkflow = void 0;\nconst bson_1 = __webpack_require__(/*! ../../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst timeout_1 = __webpack_require__(/*! ../../../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst mongodb_oidc_1 = __webpack_require__(/*! ../mongodb_oidc */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js\");\nconst callback_workflow_1 = __webpack_require__(/*! ./callback_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/callback_workflow.js\");\n/**\n * Class implementing behaviour for the non human callback workflow.\n * @internal\n */\nclass HumanCallbackWorkflow extends callback_workflow_1.CallbackWorkflow {\n    /**\n     * Instantiate the human callback workflow.\n     */\n    constructor(cache, callback) {\n        super(cache, callback);\n    }\n    /**\n     * Execute the OIDC human callback workflow.\n     */\n    async execute(connection, credentials) {\n        // Check if the Client Cache has an access token.\n        // If it does, cache the access token in the Connection Cache and perform a One-Step SASL conversation\n        // using the access token. If the server returns an Authentication error (18),\n        // invalidate the access token token from the Client Cache, clear the Connection Cache,\n        // and restart the authentication flow. Raise any other errors to the user. On success, exit the algorithm.\n        if (this.cache.hasAccessToken) {\n            const token = this.cache.getAccessToken();\n            connection.accessToken = token;\n            try {\n                return await this.finishAuthentication(connection, credentials, token);\n            }\n            catch (error) {\n                if (error instanceof error_1.MongoError &&\n                    error.code === error_1.MONGODB_ERROR_CODES.AuthenticationFailed) {\n                    this.cache.removeAccessToken();\n                    delete connection.accessToken;\n                    return await this.execute(connection, credentials);\n                }\n                else {\n                    throw error;\n                }\n            }\n        }\n        // Check if the Client Cache has a refresh token.\n        // If it does, call the OIDC Human Callback with the cached refresh token and IdpInfo to get a\n        // new access token. Cache the new access token in the Client Cache and Connection Cache.\n        // Perform a One-Step SASL conversation using the new access token. If the the server returns\n        // an Authentication error (18), clear the refresh token, invalidate the access token from the\n        // Client Cache, clear the Connection Cache, and restart the authentication flow. Raise any other\n        // errors to the user. On success, exit the algorithm.\n        if (this.cache.hasRefreshToken) {\n            const refreshToken = this.cache.getRefreshToken();\n            const result = await this.fetchAccessToken(this.cache.getIdpInfo(), credentials, refreshToken);\n            this.cache.put(result);\n            connection.accessToken = result.accessToken;\n            try {\n                return await this.finishAuthentication(connection, credentials, result.accessToken);\n            }\n            catch (error) {\n                if (error instanceof error_1.MongoError &&\n                    error.code === error_1.MONGODB_ERROR_CODES.AuthenticationFailed) {\n                    this.cache.removeRefreshToken();\n                    delete connection.accessToken;\n                    return await this.execute(connection, credentials);\n                }\n                else {\n                    throw error;\n                }\n            }\n        }\n        // Start a new Two-Step SASL conversation.\n        // Run a PrincipalStepRequest to get the IdpInfo.\n        // Call the OIDC Human Callback with the new IdpInfo to get a new access token and optional refresh\n        // token. Drivers MUST NOT pass a cached refresh token to the callback when performing\n        // a new Two-Step conversation. Cache the new IdpInfo and refresh token in the Client Cache and the\n        // new access token in the Client Cache and Connection Cache.\n        // Attempt to authenticate using a JwtStepRequest with the new access token. Raise any errors to the user.\n        const startResponse = await this.startAuthentication(connection, credentials);\n        const conversationId = startResponse.conversationId;\n        const idpInfo = bson_1.BSON.deserialize(startResponse.payload.buffer);\n        const callbackResponse = await this.fetchAccessToken(idpInfo, credentials);\n        this.cache.put(callbackResponse, idpInfo);\n        connection.accessToken = callbackResponse.accessToken;\n        return await this.finishAuthentication(connection, credentials, callbackResponse.accessToken, conversationId);\n    }\n    /**\n     * Fetches an access token using the callback.\n     */\n    async fetchAccessToken(idpInfo, credentials, refreshToken) {\n        const controller = new AbortController();\n        const params = {\n            timeoutContext: controller.signal,\n            version: mongodb_oidc_1.OIDC_VERSION,\n            idpInfo: idpInfo\n        };\n        if (credentials.username) {\n            params.username = credentials.username;\n        }\n        if (refreshToken) {\n            params.refreshToken = refreshToken;\n        }\n        const timeout = timeout_1.Timeout.expires(callback_workflow_1.HUMAN_TIMEOUT_MS);\n        try {\n            return await Promise.race([this.executeAndValidateCallback(params), timeout]);\n        }\n        catch (error) {\n            if (timeout_1.TimeoutError.is(error)) {\n                controller.abort();\n                throw new error_1.MongoOIDCError(`OIDC callback timed out after ${callback_workflow_1.HUMAN_TIMEOUT_MS}ms.`);\n            }\n            throw error;\n        }\n        finally {\n            timeout.clear();\n        }\n    }\n}\nexports.HumanCallbackWorkflow = HumanCallbackWorkflow;\n//# sourceMappingURL=human_callback_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvaHVtYW5fY2FsbGJhY2tfd29ya2Zsb3cuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNkJBQTZCO0FBQzdCLGVBQWUsbUJBQU8sQ0FBQyxpR0FBZTtBQUN0QyxnQkFBZ0IsbUJBQU8sQ0FBQyxtR0FBZ0I7QUFDeEMsa0JBQWtCLG1CQUFPLENBQUMsdUdBQWtCO0FBQzVDLHVCQUF1QixtQkFBTyxDQUFDLHFIQUFpQjtBQUNoRCw0QkFBNEIsbUJBQU8sQ0FBQywySUFBcUI7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRkFBa0YscUNBQXFDO0FBQ3ZIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2h1bWFuX2NhbGxiYWNrX3dvcmtmbG93LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5IdW1hbkNhbGxiYWNrV29ya2Zsb3cgPSB2b2lkIDA7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vYnNvblwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vZXJyb3JcIik7XG5jb25zdCB0aW1lb3V0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vdGltZW91dFwiKTtcbmNvbnN0IG1vbmdvZGJfb2lkY18xID0gcmVxdWlyZShcIi4uL21vbmdvZGJfb2lkY1wiKTtcbmNvbnN0IGNhbGxiYWNrX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9jYWxsYmFja193b3JrZmxvd1wiKTtcbi8qKlxuICogQ2xhc3MgaW1wbGVtZW50aW5nIGJlaGF2aW91ciBmb3IgdGhlIG5vbiBodW1hbiBjYWxsYmFjayB3b3JrZmxvdy5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBIdW1hbkNhbGxiYWNrV29ya2Zsb3cgZXh0ZW5kcyBjYWxsYmFja193b3JrZmxvd18xLkNhbGxiYWNrV29ya2Zsb3cge1xuICAgIC8qKlxuICAgICAqIEluc3RhbnRpYXRlIHRoZSBodW1hbiBjYWxsYmFjayB3b3JrZmxvdy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjYWNoZSwgY2FsbGJhY2spIHtcbiAgICAgICAgc3VwZXIoY2FjaGUsIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSB0aGUgT0lEQyBodW1hbiBjYWxsYmFjayB3b3JrZmxvdy5cbiAgICAgKi9cbiAgICBhc3luYyBleGVjdXRlKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBDbGllbnQgQ2FjaGUgaGFzIGFuIGFjY2VzcyB0b2tlbi5cbiAgICAgICAgLy8gSWYgaXQgZG9lcywgY2FjaGUgdGhlIGFjY2VzcyB0b2tlbiBpbiB0aGUgQ29ubmVjdGlvbiBDYWNoZSBhbmQgcGVyZm9ybSBhIE9uZS1TdGVwIFNBU0wgY29udmVyc2F0aW9uXG4gICAgICAgIC8vIHVzaW5nIHRoZSBhY2Nlc3MgdG9rZW4uIElmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBBdXRoZW50aWNhdGlvbiBlcnJvciAoMTgpLFxuICAgICAgICAvLyBpbnZhbGlkYXRlIHRoZSBhY2Nlc3MgdG9rZW4gdG9rZW4gZnJvbSB0aGUgQ2xpZW50IENhY2hlLCBjbGVhciB0aGUgQ29ubmVjdGlvbiBDYWNoZSxcbiAgICAgICAgLy8gYW5kIHJlc3RhcnQgdGhlIGF1dGhlbnRpY2F0aW9uIGZsb3cuIFJhaXNlIGFueSBvdGhlciBlcnJvcnMgdG8gdGhlIHVzZXIuIE9uIHN1Y2Nlc3MsIGV4aXQgdGhlIGFsZ29yaXRobS5cbiAgICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzQWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5jYWNoZS5nZXRBY2Nlc3NUb2tlbigpO1xuICAgICAgICAgICAgY29ubmVjdGlvbi5hY2Nlc3NUb2tlbiA9IHRva2VuO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5maW5pc2hBdXRoZW50aWNhdGlvbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgdG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5BdXRoZW50aWNhdGlvbkZhaWxlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnJlbW92ZUFjY2Vzc1Rva2VuKCk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25uZWN0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBpZiB0aGUgQ2xpZW50IENhY2hlIGhhcyBhIHJlZnJlc2ggdG9rZW4uXG4gICAgICAgIC8vIElmIGl0IGRvZXMsIGNhbGwgdGhlIE9JREMgSHVtYW4gQ2FsbGJhY2sgd2l0aCB0aGUgY2FjaGVkIHJlZnJlc2ggdG9rZW4gYW5kIElkcEluZm8gdG8gZ2V0IGFcbiAgICAgICAgLy8gbmV3IGFjY2VzcyB0b2tlbi4gQ2FjaGUgdGhlIG5ldyBhY2Nlc3MgdG9rZW4gaW4gdGhlIENsaWVudCBDYWNoZSBhbmQgQ29ubmVjdGlvbiBDYWNoZS5cbiAgICAgICAgLy8gUGVyZm9ybSBhIE9uZS1TdGVwIFNBU0wgY29udmVyc2F0aW9uIHVzaW5nIHRoZSBuZXcgYWNjZXNzIHRva2VuLiBJZiB0aGUgdGhlIHNlcnZlciByZXR1cm5zXG4gICAgICAgIC8vIGFuIEF1dGhlbnRpY2F0aW9uIGVycm9yICgxOCksIGNsZWFyIHRoZSByZWZyZXNoIHRva2VuLCBpbnZhbGlkYXRlIHRoZSBhY2Nlc3MgdG9rZW4gZnJvbSB0aGVcbiAgICAgICAgLy8gQ2xpZW50IENhY2hlLCBjbGVhciB0aGUgQ29ubmVjdGlvbiBDYWNoZSwgYW5kIHJlc3RhcnQgdGhlIGF1dGhlbnRpY2F0aW9uIGZsb3cuIFJhaXNlIGFueSBvdGhlclxuICAgICAgICAvLyBlcnJvcnMgdG8gdGhlIHVzZXIuIE9uIHN1Y2Nlc3MsIGV4aXQgdGhlIGFsZ29yaXRobS5cbiAgICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzUmVmcmVzaFRva2VuKSB7XG4gICAgICAgICAgICBjb25zdCByZWZyZXNoVG9rZW4gPSB0aGlzLmNhY2hlLmdldFJlZnJlc2hUb2tlbigpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5mZXRjaEFjY2Vzc1Rva2VuKHRoaXMuY2FjaGUuZ2V0SWRwSW5mbygpLCBjcmVkZW50aWFscywgcmVmcmVzaFRva2VuKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUucHV0KHJlc3VsdCk7XG4gICAgICAgICAgICBjb25uZWN0aW9uLmFjY2Vzc1Rva2VuID0gcmVzdWx0LmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5maW5pc2hBdXRoZW50aWNhdGlvbihjb25uZWN0aW9uLCBjcmVkZW50aWFscywgcmVzdWx0LmFjY2Vzc1Rva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvciAmJlxuICAgICAgICAgICAgICAgICAgICBlcnJvci5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuQXV0aGVudGljYXRpb25GYWlsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5yZW1vdmVSZWZyZXNoVG9rZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbm5lY3Rpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGUoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFN0YXJ0IGEgbmV3IFR3by1TdGVwIFNBU0wgY29udmVyc2F0aW9uLlxuICAgICAgICAvLyBSdW4gYSBQcmluY2lwYWxTdGVwUmVxdWVzdCB0byBnZXQgdGhlIElkcEluZm8uXG4gICAgICAgIC8vIENhbGwgdGhlIE9JREMgSHVtYW4gQ2FsbGJhY2sgd2l0aCB0aGUgbmV3IElkcEluZm8gdG8gZ2V0IGEgbmV3IGFjY2VzcyB0b2tlbiBhbmQgb3B0aW9uYWwgcmVmcmVzaFxuICAgICAgICAvLyB0b2tlbi4gRHJpdmVycyBNVVNUIE5PVCBwYXNzIGEgY2FjaGVkIHJlZnJlc2ggdG9rZW4gdG8gdGhlIGNhbGxiYWNrIHdoZW4gcGVyZm9ybWluZ1xuICAgICAgICAvLyBhIG5ldyBUd28tU3RlcCBjb252ZXJzYXRpb24uIENhY2hlIHRoZSBuZXcgSWRwSW5mbyBhbmQgcmVmcmVzaCB0b2tlbiBpbiB0aGUgQ2xpZW50IENhY2hlIGFuZCB0aGVcbiAgICAgICAgLy8gbmV3IGFjY2VzcyB0b2tlbiBpbiB0aGUgQ2xpZW50IENhY2hlIGFuZCBDb25uZWN0aW9uIENhY2hlLlxuICAgICAgICAvLyBBdHRlbXB0IHRvIGF1dGhlbnRpY2F0ZSB1c2luZyBhIEp3dFN0ZXBSZXF1ZXN0IHdpdGggdGhlIG5ldyBhY2Nlc3MgdG9rZW4uIFJhaXNlIGFueSBlcnJvcnMgdG8gdGhlIHVzZXIuXG4gICAgICAgIGNvbnN0IHN0YXJ0UmVzcG9uc2UgPSBhd2FpdCB0aGlzLnN0YXJ0QXV0aGVudGljYXRpb24oY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgICAgICBjb25zdCBjb252ZXJzYXRpb25JZCA9IHN0YXJ0UmVzcG9uc2UuY29udmVyc2F0aW9uSWQ7XG4gICAgICAgIGNvbnN0IGlkcEluZm8gPSBic29uXzEuQlNPTi5kZXNlcmlhbGl6ZShzdGFydFJlc3BvbnNlLnBheWxvYWQuYnVmZmVyKTtcbiAgICAgICAgY29uc3QgY2FsbGJhY2tSZXNwb25zZSA9IGF3YWl0IHRoaXMuZmV0Y2hBY2Nlc3NUb2tlbihpZHBJbmZvLCBjcmVkZW50aWFscyk7XG4gICAgICAgIHRoaXMuY2FjaGUucHV0KGNhbGxiYWNrUmVzcG9uc2UsIGlkcEluZm8pO1xuICAgICAgICBjb25uZWN0aW9uLmFjY2Vzc1Rva2VuID0gY2FsbGJhY2tSZXNwb25zZS5hY2Nlc3NUb2tlbjtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZmluaXNoQXV0aGVudGljYXRpb24oY29ubmVjdGlvbiwgY3JlZGVudGlhbHMsIGNhbGxiYWNrUmVzcG9uc2UuYWNjZXNzVG9rZW4sIGNvbnZlcnNhdGlvbklkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyBhbiBhY2Nlc3MgdG9rZW4gdXNpbmcgdGhlIGNhbGxiYWNrLlxuICAgICAqL1xuICAgIGFzeW5jIGZldGNoQWNjZXNzVG9rZW4oaWRwSW5mbywgY3JlZGVudGlhbHMsIHJlZnJlc2hUb2tlbikge1xuICAgICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICB0aW1lb3V0Q29udGV4dDogY29udHJvbGxlci5zaWduYWwsXG4gICAgICAgICAgICB2ZXJzaW9uOiBtb25nb2RiX29pZGNfMS5PSURDX1ZFUlNJT04sXG4gICAgICAgICAgICBpZHBJbmZvOiBpZHBJbmZvXG4gICAgICAgIH07XG4gICAgICAgIGlmIChjcmVkZW50aWFscy51c2VybmFtZSkge1xuICAgICAgICAgICAgcGFyYW1zLnVzZXJuYW1lID0gY3JlZGVudGlhbHMudXNlcm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlZnJlc2hUb2tlbikge1xuICAgICAgICAgICAgcGFyYW1zLnJlZnJlc2hUb2tlbiA9IHJlZnJlc2hUb2tlbjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0aW1lb3V0ID0gdGltZW91dF8xLlRpbWVvdXQuZXhwaXJlcyhjYWxsYmFja193b3JrZmxvd18xLkhVTUFOX1RJTUVPVVRfTVMpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UucmFjZShbdGhpcy5leGVjdXRlQW5kVmFsaWRhdGVDYWxsYmFjayhwYXJhbXMpLCB0aW1lb3V0XSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGltZW91dF8xLlRpbWVvdXRFcnJvci5pcyhlcnJvcikpIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29PSURDRXJyb3IoYE9JREMgY2FsbGJhY2sgdGltZWQgb3V0IGFmdGVyICR7Y2FsbGJhY2tfd29ya2Zsb3dfMS5IVU1BTl9USU1FT1VUX01TfW1zLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aW1lb3V0LmNsZWFyKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkh1bWFuQ2FsbGJhY2tXb3JrZmxvdyA9IEh1bWFuQ2FsbGJhY2tXb3JrZmxvdztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWh1bWFuX2NhbGxiYWNrX3dvcmtmbG93LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/human_callback_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/k8s_machine_workflow.js":
/*!*******************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/k8s_machine_workflow.js ***!
  \*******************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.K8SMachineWorkflow = void 0;\nconst promises_1 = __webpack_require__(/*! fs/promises */ \"fs/promises\");\nconst machine_workflow_1 = __webpack_require__(/*! ./machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js\");\n/** The fallback file name */\nconst FALLBACK_FILENAME = '/var/run/secrets/kubernetes.io/serviceaccount/token';\n/** The azure environment variable for the file name. */\nconst AZURE_FILENAME = 'AZURE_FEDERATED_TOKEN_FILE';\n/** The AWS environment variable for the file name. */\nconst AWS_FILENAME = 'AWS_WEB_IDENTITY_TOKEN_FILE';\nclass K8SMachineWorkflow extends machine_workflow_1.MachineWorkflow {\n    /**\n     * Instantiate the machine workflow.\n     */\n    constructor(cache) {\n        super(cache);\n    }\n    /**\n     * Get the token from the environment.\n     */\n    async getToken() {\n        let filename;\n        if (process.env[AZURE_FILENAME]) {\n            filename = process.env[AZURE_FILENAME];\n        }\n        else if (process.env[AWS_FILENAME]) {\n            filename = process.env[AWS_FILENAME];\n        }\n        else {\n            filename = FALLBACK_FILENAME;\n        }\n        const token = await (0, promises_1.readFile)(filename, 'utf8');\n        return { access_token: token };\n    }\n}\nexports.K8SMachineWorkflow = K8SMachineWorkflow;\n//# sourceMappingURL=k8s_machine_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvazhzX21hY2hpbmVfd29ya2Zsb3cuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMEJBQTBCO0FBQzFCLG1CQUFtQixtQkFBTyxDQUFDLGdDQUFhO0FBQ3hDLDJCQUEyQixtQkFBTyxDQUFDLHlJQUFvQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9hdXRoL21vbmdvZGJfb2lkYy9rOHNfbWFjaGluZV93b3JrZmxvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSzhTTWFjaGluZVdvcmtmbG93ID0gdm9pZCAwO1xuY29uc3QgcHJvbWlzZXNfMSA9IHJlcXVpcmUoXCJmcy9wcm9taXNlc1wiKTtcbmNvbnN0IG1hY2hpbmVfd29ya2Zsb3dfMSA9IHJlcXVpcmUoXCIuL21hY2hpbmVfd29ya2Zsb3dcIik7XG4vKiogVGhlIGZhbGxiYWNrIGZpbGUgbmFtZSAqL1xuY29uc3QgRkFMTEJBQ0tfRklMRU5BTUUgPSAnL3Zhci9ydW4vc2VjcmV0cy9rdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3Rva2VuJztcbi8qKiBUaGUgYXp1cmUgZW52aXJvbm1lbnQgdmFyaWFibGUgZm9yIHRoZSBmaWxlIG5hbWUuICovXG5jb25zdCBBWlVSRV9GSUxFTkFNRSA9ICdBWlVSRV9GRURFUkFURURfVE9LRU5fRklMRSc7XG4vKiogVGhlIEFXUyBlbnZpcm9ubWVudCB2YXJpYWJsZSBmb3IgdGhlIGZpbGUgbmFtZS4gKi9cbmNvbnN0IEFXU19GSUxFTkFNRSA9ICdBV1NfV0VCX0lERU5USVRZX1RPS0VOX0ZJTEUnO1xuY2xhc3MgSzhTTWFjaGluZVdvcmtmbG93IGV4dGVuZHMgbWFjaGluZV93b3JrZmxvd18xLk1hY2hpbmVXb3JrZmxvdyB7XG4gICAgLyoqXG4gICAgICogSW5zdGFudGlhdGUgdGhlIG1hY2hpbmUgd29ya2Zsb3cuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2FjaGUpIHtcbiAgICAgICAgc3VwZXIoY2FjaGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRva2VuIGZyb20gdGhlIGVudmlyb25tZW50LlxuICAgICAqL1xuICAgIGFzeW5jIGdldFRva2VuKCkge1xuICAgICAgICBsZXQgZmlsZW5hbWU7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudltBWlVSRV9GSUxFTkFNRV0pIHtcbiAgICAgICAgICAgIGZpbGVuYW1lID0gcHJvY2Vzcy5lbnZbQVpVUkVfRklMRU5BTUVdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHByb2Nlc3MuZW52W0FXU19GSUxFTkFNRV0pIHtcbiAgICAgICAgICAgIGZpbGVuYW1lID0gcHJvY2Vzcy5lbnZbQVdTX0ZJTEVOQU1FXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZpbGVuYW1lID0gRkFMTEJBQ0tfRklMRU5BTUU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdG9rZW4gPSBhd2FpdCAoMCwgcHJvbWlzZXNfMS5yZWFkRmlsZSkoZmlsZW5hbWUsICd1dGY4Jyk7XG4gICAgICAgIHJldHVybiB7IGFjY2Vzc190b2tlbjogdG9rZW4gfTtcbiAgICB9XG59XG5leHBvcnRzLks4U01hY2hpbmVXb3JrZmxvdyA9IEs4U01hY2hpbmVXb3JrZmxvdztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWs4c19tYWNoaW5lX3dvcmtmbG93LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/k8s_machine_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js":
/*!***************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MachineWorkflow = void 0;\nconst promises_1 = __webpack_require__(/*! timers/promises */ \"timers/promises\");\nconst utils_1 = __webpack_require__(/*! ../../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_builders_1 = __webpack_require__(/*! ./command_builders */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/command_builders.js\");\n/** The time to throttle callback calls. */\nconst THROTTLE_MS = 100;\n/**\n * Common behaviour for OIDC machine workflows.\n * @internal\n */\nclass MachineWorkflow {\n    /**\n     * Instantiate the machine workflow.\n     */\n    constructor(cache) {\n        this.cache = cache;\n        this.callback = this.withLock(this.getToken.bind(this));\n        this.lastExecutionTime = Date.now() - THROTTLE_MS;\n    }\n    /**\n     * Execute the workflow. Gets the token from the subclass implementation.\n     */\n    async execute(connection, credentials) {\n        const token = await this.getTokenFromCacheOrEnv(connection, credentials);\n        const command = (0, command_builders_1.finishCommandDocument)(token);\n        await connection.command((0, utils_1.ns)(credentials.source), command, undefined);\n    }\n    /**\n     * Reauthenticate on a machine workflow just grabs the token again since the server\n     * has said the current access token is invalid or expired.\n     */\n    async reauthenticate(connection, credentials) {\n        if (this.cache.hasAccessToken) {\n            // Reauthentication implies the token has expired.\n            if (connection.accessToken === this.cache.getAccessToken()) {\n                // If connection's access token is the same as the cache's, remove\n                // the token from the cache and connection.\n                this.cache.removeAccessToken();\n                delete connection.accessToken;\n            }\n            else {\n                // If the connection's access token is different from the cache's, set\n                // the cache's token on the connection and do not remove from the\n                // cache.\n                connection.accessToken = this.cache.getAccessToken();\n            }\n        }\n        await this.execute(connection, credentials);\n    }\n    /**\n     * Get the document to add for speculative authentication.\n     */\n    async speculativeAuth(connection, credentials) {\n        // The spec states only cached access tokens can use speculative auth.\n        if (!this.cache.hasAccessToken) {\n            return {};\n        }\n        const token = await this.getTokenFromCacheOrEnv(connection, credentials);\n        const document = (0, command_builders_1.finishCommandDocument)(token);\n        document.db = credentials.source;\n        return { speculativeAuthenticate: document };\n    }\n    /**\n     * Get the token from the cache or environment.\n     */\n    async getTokenFromCacheOrEnv(connection, credentials) {\n        if (this.cache.hasAccessToken) {\n            const token = this.cache.getAccessToken();\n            // New connections won't have an access token so ensure we set here.\n            if (!connection.accessToken) {\n                connection.accessToken = token;\n            }\n            return token;\n        }\n        else {\n            const token = await this.callback(credentials);\n            this.cache.put({ accessToken: token.access_token, expiresInSeconds: token.expires_in });\n            // Put the access token on the connection as well.\n            connection.accessToken = token.access_token;\n            return token.access_token;\n        }\n    }\n    /**\n     * Ensure the callback is only executed one at a time, and throttled to\n     * only once per 100ms.\n     */\n    withLock(callback) {\n        let lock = Promise.resolve();\n        return async (credentials) => {\n            // We do this to ensure that we would never return the result of the\n            // previous lock, only the current callback's value would get returned.\n            await lock;\n            lock = lock\n                .catch(() => null)\n                .then(async () => {\n                const difference = Date.now() - this.lastExecutionTime;\n                if (difference <= THROTTLE_MS) {\n                    await (0, promises_1.setTimeout)(THROTTLE_MS - difference);\n                }\n                this.lastExecutionTime = Date.now();\n                return await callback(credentials);\n            });\n            return await lock;\n        };\n    }\n}\nexports.MachineWorkflow = MachineWorkflow;\n//# sourceMappingURL=machine_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvbWFjaGluZV93b3JrZmxvdy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx1QkFBdUI7QUFDdkIsbUJBQW1CLG1CQUFPLENBQUMsd0NBQWlCO0FBQzVDLGdCQUFnQixtQkFBTyxDQUFDLG1HQUFnQjtBQUN4QywyQkFBMkIsbUJBQU8sQ0FBQyx5SUFBb0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIscUVBQXFFO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvbWFjaGluZV93b3JrZmxvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFjaGluZVdvcmtmbG93ID0gdm9pZCAwO1xuY29uc3QgcHJvbWlzZXNfMSA9IHJlcXVpcmUoXCJ0aW1lcnMvcHJvbWlzZXNcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF9idWlsZGVyc18xID0gcmVxdWlyZShcIi4vY29tbWFuZF9idWlsZGVyc1wiKTtcbi8qKiBUaGUgdGltZSB0byB0aHJvdHRsZSBjYWxsYmFjayBjYWxscy4gKi9cbmNvbnN0IFRIUk9UVExFX01TID0gMTAwO1xuLyoqXG4gKiBDb21tb24gYmVoYXZpb3VyIGZvciBPSURDIG1hY2hpbmUgd29ya2Zsb3dzLlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIE1hY2hpbmVXb3JrZmxvdyB7XG4gICAgLyoqXG4gICAgICogSW5zdGFudGlhdGUgdGhlIG1hY2hpbmUgd29ya2Zsb3cuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2FjaGUpIHtcbiAgICAgICAgdGhpcy5jYWNoZSA9IGNhY2hlO1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gdGhpcy53aXRoTG9jayh0aGlzLmdldFRva2VuLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmxhc3RFeGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIFRIUk9UVExFX01TO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIHRoZSB3b3JrZmxvdy4gR2V0cyB0aGUgdG9rZW4gZnJvbSB0aGUgc3ViY2xhc3MgaW1wbGVtZW50YXRpb24uXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscykge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuZ2V0VG9rZW5Gcm9tQ2FjaGVPckVudihjb25uZWN0aW9uLCBjcmVkZW50aWFscyk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSAoMCwgY29tbWFuZF9idWlsZGVyc18xLmZpbmlzaENvbW1hbmREb2N1bWVudCkodG9rZW4pO1xuICAgICAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKGNyZWRlbnRpYWxzLnNvdXJjZSksIGNvbW1hbmQsIHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYXV0aGVudGljYXRlIG9uIGEgbWFjaGluZSB3b3JrZmxvdyBqdXN0IGdyYWJzIHRoZSB0b2tlbiBhZ2FpbiBzaW5jZSB0aGUgc2VydmVyXG4gICAgICogaGFzIHNhaWQgdGhlIGN1cnJlbnQgYWNjZXNzIHRva2VuIGlzIGludmFsaWQgb3IgZXhwaXJlZC5cbiAgICAgKi9cbiAgICBhc3luYyByZWF1dGhlbnRpY2F0ZShjb25uZWN0aW9uLCBjcmVkZW50aWFscykge1xuICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXNBY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgLy8gUmVhdXRoZW50aWNhdGlvbiBpbXBsaWVzIHRoZSB0b2tlbiBoYXMgZXhwaXJlZC5cbiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uLmFjY2Vzc1Rva2VuID09PSB0aGlzLmNhY2hlLmdldEFjY2Vzc1Rva2VuKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBjb25uZWN0aW9uJ3MgYWNjZXNzIHRva2VuIGlzIHRoZSBzYW1lIGFzIHRoZSBjYWNoZSdzLCByZW1vdmVcbiAgICAgICAgICAgICAgICAvLyB0aGUgdG9rZW4gZnJvbSB0aGUgY2FjaGUgYW5kIGNvbm5lY3Rpb24uXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5yZW1vdmVBY2Nlc3NUb2tlbigpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25uZWN0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIGNvbm5lY3Rpb24ncyBhY2Nlc3MgdG9rZW4gaXMgZGlmZmVyZW50IGZyb20gdGhlIGNhY2hlJ3MsIHNldFxuICAgICAgICAgICAgICAgIC8vIHRoZSBjYWNoZSdzIHRva2VuIG9uIHRoZSBjb25uZWN0aW9uIGFuZCBkbyBub3QgcmVtb3ZlIGZyb20gdGhlXG4gICAgICAgICAgICAgICAgLy8gY2FjaGUuXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5hY2Nlc3NUb2tlbiA9IHRoaXMuY2FjaGUuZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGUoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGRvY3VtZW50IHRvIGFkZCBmb3Igc3BlY3VsYXRpdmUgYXV0aGVudGljYXRpb24uXG4gICAgICovXG4gICAgYXN5bmMgc3BlY3VsYXRpdmVBdXRoKGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIC8vIFRoZSBzcGVjIHN0YXRlcyBvbmx5IGNhY2hlZCBhY2Nlc3MgdG9rZW5zIGNhbiB1c2Ugc3BlY3VsYXRpdmUgYXV0aC5cbiAgICAgICAgaWYgKCF0aGlzLmNhY2hlLmhhc0FjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdG9rZW4gPSBhd2FpdCB0aGlzLmdldFRva2VuRnJvbUNhY2hlT3JFbnYoY29ubmVjdGlvbiwgY3JlZGVudGlhbHMpO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9ICgwLCBjb21tYW5kX2J1aWxkZXJzXzEuZmluaXNoQ29tbWFuZERvY3VtZW50KSh0b2tlbik7XG4gICAgICAgIGRvY3VtZW50LmRiID0gY3JlZGVudGlhbHMuc291cmNlO1xuICAgICAgICByZXR1cm4geyBzcGVjdWxhdGl2ZUF1dGhlbnRpY2F0ZTogZG9jdW1lbnQgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB0b2tlbiBmcm9tIHRoZSBjYWNoZSBvciBlbnZpcm9ubWVudC5cbiAgICAgKi9cbiAgICBhc3luYyBnZXRUb2tlbkZyb21DYWNoZU9yRW52KGNvbm5lY3Rpb24sIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGlmICh0aGlzLmNhY2hlLmhhc0FjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IHRoaXMuY2FjaGUuZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICAgIC8vIE5ldyBjb25uZWN0aW9ucyB3b24ndCBoYXZlIGFuIGFjY2VzcyB0b2tlbiBzbyBlbnN1cmUgd2Ugc2V0IGhlcmUuXG4gICAgICAgICAgICBpZiAoIWNvbm5lY3Rpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLmFjY2Vzc1Rva2VuID0gdG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuY2FsbGJhY2soY3JlZGVudGlhbHMpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZS5wdXQoeyBhY2Nlc3NUb2tlbjogdG9rZW4uYWNjZXNzX3Rva2VuLCBleHBpcmVzSW5TZWNvbmRzOiB0b2tlbi5leHBpcmVzX2luIH0pO1xuICAgICAgICAgICAgLy8gUHV0IHRoZSBhY2Nlc3MgdG9rZW4gb24gdGhlIGNvbm5lY3Rpb24gYXMgd2VsbC5cbiAgICAgICAgICAgIGNvbm5lY3Rpb24uYWNjZXNzVG9rZW4gPSB0b2tlbi5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICByZXR1cm4gdG9rZW4uYWNjZXNzX3Rva2VuO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuc3VyZSB0aGUgY2FsbGJhY2sgaXMgb25seSBleGVjdXRlZCBvbmUgYXQgYSB0aW1lLCBhbmQgdGhyb3R0bGVkIHRvXG4gICAgICogb25seSBvbmNlIHBlciAxMDBtcy5cbiAgICAgKi9cbiAgICB3aXRoTG9jayhjYWxsYmFjaykge1xuICAgICAgICBsZXQgbG9jayA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICByZXR1cm4gYXN5bmMgKGNyZWRlbnRpYWxzKSA9PiB7XG4gICAgICAgICAgICAvLyBXZSBkbyB0aGlzIHRvIGVuc3VyZSB0aGF0IHdlIHdvdWxkIG5ldmVyIHJldHVybiB0aGUgcmVzdWx0IG9mIHRoZVxuICAgICAgICAgICAgLy8gcHJldmlvdXMgbG9jaywgb25seSB0aGUgY3VycmVudCBjYWxsYmFjaydzIHZhbHVlIHdvdWxkIGdldCByZXR1cm5lZC5cbiAgICAgICAgICAgIGF3YWl0IGxvY2s7XG4gICAgICAgICAgICBsb2NrID0gbG9ja1xuICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBudWxsKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkaWZmZXJlbmNlID0gRGF0ZS5ub3coKSAtIHRoaXMubGFzdEV4ZWN1dGlvblRpbWU7XG4gICAgICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UgPD0gVEhST1RUTEVfTVMpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgKDAsIHByb21pc2VzXzEuc2V0VGltZW91dCkoVEhST1RUTEVfTVMgLSBkaWZmZXJlbmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0RXhlY3V0aW9uVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGNhbGxiYWNrKGNyZWRlbnRpYWxzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGxvY2s7XG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5NYWNoaW5lV29ya2Zsb3cgPSBNYWNoaW5lV29ya2Zsb3c7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tYWNoaW5lX3dvcmtmbG93LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_cache.js":
/*!**********************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_cache.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TokenCache = void 0;\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nclass MongoOIDCError extends error_1.MongoDriverError {\n}\n/** @internal */\nclass TokenCache {\n    get hasAccessToken() {\n        return !!this.accessToken;\n    }\n    get hasRefreshToken() {\n        return !!this.refreshToken;\n    }\n    get hasIdpInfo() {\n        return !!this.idpInfo;\n    }\n    getAccessToken() {\n        if (!this.accessToken) {\n            throw new MongoOIDCError('Attempted to get an access token when none exists.');\n        }\n        return this.accessToken;\n    }\n    getRefreshToken() {\n        if (!this.refreshToken) {\n            throw new MongoOIDCError('Attempted to get a refresh token when none exists.');\n        }\n        return this.refreshToken;\n    }\n    getIdpInfo() {\n        if (!this.idpInfo) {\n            throw new MongoOIDCError('Attempted to get IDP information when none exists.');\n        }\n        return this.idpInfo;\n    }\n    put(response, idpInfo) {\n        this.accessToken = response.accessToken;\n        this.refreshToken = response.refreshToken;\n        this.expiresInSeconds = response.expiresInSeconds;\n        if (idpInfo) {\n            this.idpInfo = idpInfo;\n        }\n    }\n    removeAccessToken() {\n        this.accessToken = undefined;\n    }\n    removeRefreshToken() {\n        this.refreshToken = undefined;\n    }\n}\nexports.TokenCache = TokenCache;\n//# sourceMappingURL=token_cache.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvdG9rZW5fY2FjaGUuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCO0FBQ2xCLGdCQUFnQixtQkFBTyxDQUFDLG1HQUFnQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvdG9rZW5fY2FjaGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRva2VuQ2FjaGUgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2Vycm9yXCIpO1xuY2xhc3MgTW9uZ29PSURDRXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvRHJpdmVyRXJyb3Ige1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgVG9rZW5DYWNoZSB7XG4gICAgZ2V0IGhhc0FjY2Vzc1Rva2VuKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLmFjY2Vzc1Rva2VuO1xuICAgIH1cbiAgICBnZXQgaGFzUmVmcmVzaFRva2VuKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnJlZnJlc2hUb2tlbjtcbiAgICB9XG4gICAgZ2V0IGhhc0lkcEluZm8oKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuaWRwSW5mbztcbiAgICB9XG4gICAgZ2V0QWNjZXNzVG9rZW4oKSB7XG4gICAgICAgIGlmICghdGhpcy5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IE1vbmdvT0lEQ0Vycm9yKCdBdHRlbXB0ZWQgdG8gZ2V0IGFuIGFjY2VzcyB0b2tlbiB3aGVuIG5vbmUgZXhpc3RzLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuO1xuICAgIH1cbiAgICBnZXRSZWZyZXNoVG9rZW4oKSB7XG4gICAgICAgIGlmICghdGhpcy5yZWZyZXNoVG9rZW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBNb25nb09JRENFcnJvcignQXR0ZW1wdGVkIHRvIGdldCBhIHJlZnJlc2ggdG9rZW4gd2hlbiBub25lIGV4aXN0cy4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5yZWZyZXNoVG9rZW47XG4gICAgfVxuICAgIGdldElkcEluZm8oKSB7XG4gICAgICAgIGlmICghdGhpcy5pZHBJbmZvKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTW9uZ29PSURDRXJyb3IoJ0F0dGVtcHRlZCB0byBnZXQgSURQIGluZm9ybWF0aW9uIHdoZW4gbm9uZSBleGlzdHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaWRwSW5mbztcbiAgICB9XG4gICAgcHV0KHJlc3BvbnNlLCBpZHBJbmZvKSB7XG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSByZXNwb25zZS5hY2Nlc3NUb2tlbjtcbiAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSByZXNwb25zZS5yZWZyZXNoVG9rZW47XG4gICAgICAgIHRoaXMuZXhwaXJlc0luU2Vjb25kcyA9IHJlc3BvbnNlLmV4cGlyZXNJblNlY29uZHM7XG4gICAgICAgIGlmIChpZHBJbmZvKSB7XG4gICAgICAgICAgICB0aGlzLmlkcEluZm8gPSBpZHBJbmZvO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZUFjY2Vzc1Rva2VuKCkge1xuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZW1vdmVSZWZyZXNoVG9rZW4oKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gdW5kZWZpbmVkO1xuICAgIH1cbn1cbmV4cG9ydHMuVG9rZW5DYWNoZSA9IFRva2VuQ2FjaGU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD10b2tlbl9jYWNoZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_cache.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_machine_workflow.js":
/*!*********************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_machine_workflow.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TokenMachineWorkflow = void 0;\nconst fs = __webpack_require__(/*! fs */ \"fs\");\nconst error_1 = __webpack_require__(/*! ../../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst machine_workflow_1 = __webpack_require__(/*! ./machine_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/machine_workflow.js\");\n/** Error for when the token is missing in the environment. */\nconst TOKEN_MISSING_ERROR = 'OIDC_TOKEN_FILE must be set in the environment.';\n/**\n * Device workflow implementation for AWS.\n *\n * @internal\n */\nclass TokenMachineWorkflow extends machine_workflow_1.MachineWorkflow {\n    /**\n     * Instantiate the machine workflow.\n     */\n    constructor(cache) {\n        super(cache);\n    }\n    /**\n     * Get the token from the environment.\n     */\n    async getToken() {\n        const tokenFile = process.env.OIDC_TOKEN_FILE;\n        if (!tokenFile) {\n            throw new error_1.MongoAWSError(TOKEN_MISSING_ERROR);\n        }\n        const token = await fs.promises.readFile(tokenFile, 'utf8');\n        return { access_token: token };\n    }\n}\nexports.TokenMachineWorkflow = TokenMachineWorkflow;\n//# sourceMappingURL=token_machine_workflow.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvdG9rZW5fbWFjaGluZV93b3JrZmxvdy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw0QkFBNEI7QUFDNUIsV0FBVyxtQkFBTyxDQUFDLGNBQUk7QUFDdkIsZ0JBQWdCLG1CQUFPLENBQUMsbUdBQWdCO0FBQ3hDLDJCQUEyQixtQkFBTyxDQUFDLHlJQUFvQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL3Rva2VuX21hY2hpbmVfd29ya2Zsb3cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRva2VuTWFjaGluZVdvcmtmbG93ID0gdm9pZCAwO1xuY29uc3QgZnMgPSByZXF1aXJlKFwiZnNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2Vycm9yXCIpO1xuY29uc3QgbWFjaGluZV93b3JrZmxvd18xID0gcmVxdWlyZShcIi4vbWFjaGluZV93b3JrZmxvd1wiKTtcbi8qKiBFcnJvciBmb3Igd2hlbiB0aGUgdG9rZW4gaXMgbWlzc2luZyBpbiB0aGUgZW52aXJvbm1lbnQuICovXG5jb25zdCBUT0tFTl9NSVNTSU5HX0VSUk9SID0gJ09JRENfVE9LRU5fRklMRSBtdXN0IGJlIHNldCBpbiB0aGUgZW52aXJvbm1lbnQuJztcbi8qKlxuICogRGV2aWNlIHdvcmtmbG93IGltcGxlbWVudGF0aW9uIGZvciBBV1MuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIFRva2VuTWFjaGluZVdvcmtmbG93IGV4dGVuZHMgbWFjaGluZV93b3JrZmxvd18xLk1hY2hpbmVXb3JrZmxvdyB7XG4gICAgLyoqXG4gICAgICogSW5zdGFudGlhdGUgdGhlIG1hY2hpbmUgd29ya2Zsb3cuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2FjaGUpIHtcbiAgICAgICAgc3VwZXIoY2FjaGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRva2VuIGZyb20gdGhlIGVudmlyb25tZW50LlxuICAgICAqL1xuICAgIGFzeW5jIGdldFRva2VuKCkge1xuICAgICAgICBjb25zdCB0b2tlbkZpbGUgPSBwcm9jZXNzLmVudi5PSURDX1RPS0VOX0ZJTEU7XG4gICAgICAgIGlmICghdG9rZW5GaWxlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FXU0Vycm9yKFRPS0VOX01JU1NJTkdfRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUodG9rZW5GaWxlLCAndXRmOCcpO1xuICAgICAgICByZXR1cm4geyBhY2Nlc3NfdG9rZW46IHRva2VuIH07XG4gICAgfVxufVxuZXhwb3J0cy5Ub2tlbk1hY2hpbmVXb3JrZmxvdyA9IFRva2VuTWFjaGluZVdvcmtmbG93O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dG9rZW5fbWFjaGluZV93b3JrZmxvdy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_machine_workflow.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/plain.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/plain.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Plain = void 0;\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nclass Plain extends auth_provider_1.AuthProvider {\n    async auth(authContext) {\n        const { connection, credentials } = authContext;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        const { username, password } = credentials;\n        const payload = new bson_1.Binary(Buffer.from(`\\x00${username}\\x00${password}`));\n        const command = {\n            saslStart: 1,\n            mechanism: 'PLAIN',\n            payload: payload,\n            autoAuthorize: 1\n        };\n        await connection.command((0, utils_1.ns)('$external.$cmd'), command, undefined);\n    }\n}\nexports.Plain = Plain;\n//# sourceMappingURL=plain.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9wbGFpbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxhQUFhO0FBQ2IsZUFBZSxtQkFBTyxDQUFDLDhGQUFZO0FBQ25DLGdCQUFnQixtQkFBTyxDQUFDLGdHQUFhO0FBQ3JDLGdCQUFnQixtQkFBTyxDQUFDLGdHQUFhO0FBQ3JDLHdCQUF3QixtQkFBTyxDQUFDLHNIQUFpQjtBQUNqRDtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQjtBQUMxQztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IscUJBQXFCO0FBQ3JDLDZEQUE2RCxTQUFTLE1BQU0sU0FBUztBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvcGxhaW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBsYWluID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uLy4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsc1wiKTtcbmNvbnN0IGF1dGhfcHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuL2F1dGhfcHJvdmlkZXJcIik7XG5jbGFzcyBQbGFpbiBleHRlbmRzIGF1dGhfcHJvdmlkZXJfMS5BdXRoUHJvdmlkZXIge1xuICAgIGFzeW5jIGF1dGgoYXV0aENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uLCBjcmVkZW50aWFscyB9ID0gYXV0aENvbnRleHQ7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoJ0F1dGhDb250ZXh0IG11c3QgcHJvdmlkZSBjcmVkZW50aWFscy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gY3JlZGVudGlhbHM7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBuZXcgYnNvbl8xLkJpbmFyeShCdWZmZXIuZnJvbShgXFx4MDAke3VzZXJuYW1lfVxceDAwJHtwYXNzd29yZH1gKSk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBzYXNsU3RhcnQ6IDEsXG4gICAgICAgICAgICBtZWNoYW5pc206ICdQTEFJTicsXG4gICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkLFxuICAgICAgICAgICAgYXV0b0F1dGhvcml6ZTogMVxuICAgICAgICB9O1xuICAgICAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKCckZXh0ZXJuYWwuJGNtZCcpLCBjb21tYW5kLCB1bmRlZmluZWQpO1xuICAgIH1cbn1cbmV4cG9ydHMuUGxhaW4gPSBQbGFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBsYWluLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/plain.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AUTH_MECHS_AUTH_SRC_EXTERNAL = exports.AuthMechanism = void 0;\n/** @public */\nexports.AuthMechanism = Object.freeze({\n    MONGODB_AWS: 'MONGODB-AWS',\n    MONGODB_CR: 'MONGODB-CR',\n    MONGODB_DEFAULT: 'DEFAULT',\n    MONGODB_GSSAPI: 'GSSAPI',\n    MONGODB_PLAIN: 'PLAIN',\n    MONGODB_SCRAM_SHA1: 'SCRAM-SHA-1',\n    MONGODB_SCRAM_SHA256: 'SCRAM-SHA-256',\n    MONGODB_X509: 'MONGODB-X509',\n    MONGODB_OIDC: 'MONGODB-OIDC'\n});\n/** @internal */\nexports.AUTH_MECHS_AUTH_SRC_EXTERNAL = new Set([\n    exports.AuthMechanism.MONGODB_GSSAPI,\n    exports.AuthMechanism.MONGODB_AWS,\n    exports.AuthMechanism.MONGODB_OIDC,\n    exports.AuthMechanism.MONGODB_X509\n]);\n//# sourceMappingURL=providers.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9wcm92aWRlcnMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsb0NBQW9DLEdBQUcscUJBQXFCO0FBQzVEO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2F1dGgvcHJvdmlkZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BVVRIX01FQ0hTX0FVVEhfU1JDX0VYVEVSTkFMID0gZXhwb3J0cy5BdXRoTWVjaGFuaXNtID0gdm9pZCAwO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuQXV0aE1lY2hhbmlzbSA9IE9iamVjdC5mcmVlemUoe1xuICAgIE1PTkdPREJfQVdTOiAnTU9OR09EQi1BV1MnLFxuICAgIE1PTkdPREJfQ1I6ICdNT05HT0RCLUNSJyxcbiAgICBNT05HT0RCX0RFRkFVTFQ6ICdERUZBVUxUJyxcbiAgICBNT05HT0RCX0dTU0FQSTogJ0dTU0FQSScsXG4gICAgTU9OR09EQl9QTEFJTjogJ1BMQUlOJyxcbiAgICBNT05HT0RCX1NDUkFNX1NIQTE6ICdTQ1JBTS1TSEEtMScsXG4gICAgTU9OR09EQl9TQ1JBTV9TSEEyNTY6ICdTQ1JBTS1TSEEtMjU2JyxcbiAgICBNT05HT0RCX1g1MDk6ICdNT05HT0RCLVg1MDknLFxuICAgIE1PTkdPREJfT0lEQzogJ01PTkdPREItT0lEQydcbn0pO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5BVVRIX01FQ0hTX0FVVEhfU1JDX0VYVEVSTkFMID0gbmV3IFNldChbXG4gICAgZXhwb3J0cy5BdXRoTWVjaGFuaXNtLk1PTkdPREJfR1NTQVBJLFxuICAgIGV4cG9ydHMuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0FXUyxcbiAgICBleHBvcnRzLkF1dGhNZWNoYW5pc20uTU9OR09EQl9PSURDLFxuICAgIGV4cG9ydHMuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1g1MDlcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvdmlkZXJzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/scram.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/scram.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ScramSHA256 = exports.ScramSHA1 = void 0;\nconst saslprep_1 = __webpack_require__(/*! @mongodb-js/saslprep */ \"(rsc)/./node_modules/.pnpm/@mongodb-js+saslprep@1.3.0/node_modules/@mongodb-js/saslprep/dist/node.js\");\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst providers_1 = __webpack_require__(/*! ./providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nclass ScramSHA extends auth_provider_1.AuthProvider {\n    constructor(cryptoMethod) {\n        super();\n        this.cryptoMethod = cryptoMethod || 'sha1';\n    }\n    async prepare(handshakeDoc, authContext) {\n        const cryptoMethod = this.cryptoMethod;\n        const credentials = authContext.credentials;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        const nonce = await (0, utils_1.randomBytes)(24);\n        // store the nonce for later use\n        authContext.nonce = nonce;\n        const request = {\n            ...handshakeDoc,\n            speculativeAuthenticate: {\n                ...makeFirstMessage(cryptoMethod, credentials, nonce),\n                db: credentials.source\n            }\n        };\n        return request;\n    }\n    async auth(authContext) {\n        const { reauthenticating, response } = authContext;\n        if (response?.speculativeAuthenticate && !reauthenticating) {\n            return await continueScramConversation(this.cryptoMethod, response.speculativeAuthenticate, authContext);\n        }\n        return await executeScram(this.cryptoMethod, authContext);\n    }\n}\nfunction cleanUsername(username) {\n    return username.replace('=', '=3D').replace(',', '=2C');\n}\nfunction clientFirstMessageBare(username, nonce) {\n    // NOTE: This is done b/c Javascript uses UTF-16, but the server is hashing in UTF-8.\n    // Since the username is not sasl-prep-d, we need to do this here.\n    return Buffer.concat([\n        Buffer.from('n=', 'utf8'),\n        Buffer.from(username, 'utf8'),\n        Buffer.from(',r=', 'utf8'),\n        Buffer.from(nonce.toString('base64'), 'utf8')\n    ]);\n}\nfunction makeFirstMessage(cryptoMethod, credentials, nonce) {\n    const username = cleanUsername(credentials.username);\n    const mechanism = cryptoMethod === 'sha1' ? providers_1.AuthMechanism.MONGODB_SCRAM_SHA1 : providers_1.AuthMechanism.MONGODB_SCRAM_SHA256;\n    // NOTE: This is done b/c Javascript uses UTF-16, but the server is hashing in UTF-8.\n    // Since the username is not sasl-prep-d, we need to do this here.\n    return {\n        saslStart: 1,\n        mechanism,\n        payload: new bson_1.Binary(Buffer.concat([Buffer.from('n,,', 'utf8'), clientFirstMessageBare(username, nonce)])),\n        autoAuthorize: 1,\n        options: { skipEmptyExchange: true }\n    };\n}\nasync function executeScram(cryptoMethod, authContext) {\n    const { connection, credentials } = authContext;\n    if (!credentials) {\n        throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    if (!authContext.nonce) {\n        throw new error_1.MongoInvalidArgumentError('AuthContext must contain a valid nonce property');\n    }\n    const nonce = authContext.nonce;\n    const db = credentials.source;\n    const saslStartCmd = makeFirstMessage(cryptoMethod, credentials, nonce);\n    const response = await connection.command((0, utils_1.ns)(`${db}.$cmd`), saslStartCmd, undefined);\n    await continueScramConversation(cryptoMethod, response, authContext);\n}\nasync function continueScramConversation(cryptoMethod, response, authContext) {\n    const connection = authContext.connection;\n    const credentials = authContext.credentials;\n    if (!credentials) {\n        throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    if (!authContext.nonce) {\n        throw new error_1.MongoInvalidArgumentError('Unable to continue SCRAM without valid nonce');\n    }\n    const nonce = authContext.nonce;\n    const db = credentials.source;\n    const username = cleanUsername(credentials.username);\n    const password = credentials.password;\n    const processedPassword = cryptoMethod === 'sha256' ? (0, saslprep_1.saslprep)(password) : passwordDigest(username, password);\n    const payload = Buffer.isBuffer(response.payload)\n        ? new bson_1.Binary(response.payload)\n        : response.payload;\n    const dict = parsePayload(payload);\n    const iterations = parseInt(dict.i, 10);\n    if (iterations && iterations < 4096) {\n        // TODO(NODE-3483)\n        throw new error_1.MongoRuntimeError(`Server returned an invalid iteration count ${iterations}`);\n    }\n    const salt = dict.s;\n    const rnonce = dict.r;\n    if (rnonce.startsWith('nonce')) {\n        // TODO(NODE-3483)\n        throw new error_1.MongoRuntimeError(`Server returned an invalid nonce: ${rnonce}`);\n    }\n    // Set up start of proof\n    const withoutProof = `c=biws,r=${rnonce}`;\n    const saltedPassword = HI(processedPassword, Buffer.from(salt, 'base64'), iterations, cryptoMethod);\n    const clientKey = HMAC(cryptoMethod, saltedPassword, 'Client Key');\n    const serverKey = HMAC(cryptoMethod, saltedPassword, 'Server Key');\n    const storedKey = H(cryptoMethod, clientKey);\n    const authMessage = [\n        clientFirstMessageBare(username, nonce),\n        payload.toString('utf8'),\n        withoutProof\n    ].join(',');\n    const clientSignature = HMAC(cryptoMethod, storedKey, authMessage);\n    const clientProof = `p=${xor(clientKey, clientSignature)}`;\n    const clientFinal = [withoutProof, clientProof].join(',');\n    const serverSignature = HMAC(cryptoMethod, serverKey, authMessage);\n    const saslContinueCmd = {\n        saslContinue: 1,\n        conversationId: response.conversationId,\n        payload: new bson_1.Binary(Buffer.from(clientFinal))\n    };\n    const r = await connection.command((0, utils_1.ns)(`${db}.$cmd`), saslContinueCmd, undefined);\n    const parsedResponse = parsePayload(r.payload);\n    if (!compareDigest(Buffer.from(parsedResponse.v, 'base64'), serverSignature)) {\n        throw new error_1.MongoRuntimeError('Server returned an invalid signature');\n    }\n    if (r.done !== false) {\n        // If the server sends r.done === true we can save one RTT\n        return;\n    }\n    const retrySaslContinueCmd = {\n        saslContinue: 1,\n        conversationId: r.conversationId,\n        payload: Buffer.alloc(0)\n    };\n    await connection.command((0, utils_1.ns)(`${db}.$cmd`), retrySaslContinueCmd, undefined);\n}\nfunction parsePayload(payload) {\n    const payloadStr = payload.toString('utf8');\n    const dict = {};\n    const parts = payloadStr.split(',');\n    for (let i = 0; i < parts.length; i++) {\n        const valueParts = (parts[i].match(/^([^=]*)=(.*)$/) ?? []).slice(1);\n        dict[valueParts[0]] = valueParts[1];\n    }\n    return dict;\n}\nfunction passwordDigest(username, password) {\n    if (typeof username !== 'string') {\n        throw new error_1.MongoInvalidArgumentError('Username must be a string');\n    }\n    if (typeof password !== 'string') {\n        throw new error_1.MongoInvalidArgumentError('Password must be a string');\n    }\n    if (password.length === 0) {\n        throw new error_1.MongoInvalidArgumentError('Password cannot be empty');\n    }\n    let md5;\n    try {\n        md5 = crypto.createHash('md5');\n    }\n    catch (err) {\n        if (crypto.getFips()) {\n            // This error is (slightly) more helpful than what comes from OpenSSL directly, e.g.\n            // 'Error: error:060800C8:digital envelope routines:EVP_DigestInit_ex:disabled for FIPS'\n            throw new Error('Auth mechanism SCRAM-SHA-1 is not supported in FIPS mode');\n        }\n        throw err;\n    }\n    md5.update(`${username}:mongo:${password}`, 'utf8');\n    return md5.digest('hex');\n}\n// XOR two buffers\nfunction xor(a, b) {\n    if (!Buffer.isBuffer(a)) {\n        a = Buffer.from(a);\n    }\n    if (!Buffer.isBuffer(b)) {\n        b = Buffer.from(b);\n    }\n    const length = Math.max(a.length, b.length);\n    const res = [];\n    for (let i = 0; i < length; i += 1) {\n        res.push(a[i] ^ b[i]);\n    }\n    return Buffer.from(res).toString('base64');\n}\nfunction H(method, text) {\n    return crypto.createHash(method).update(text).digest();\n}\nfunction HMAC(method, key, text) {\n    return crypto.createHmac(method, key).update(text).digest();\n}\nlet _hiCache = {};\nlet _hiCacheCount = 0;\nfunction _hiCachePurge() {\n    _hiCache = {};\n    _hiCacheCount = 0;\n}\nconst hiLengthMap = {\n    sha256: 32,\n    sha1: 20\n};\nfunction HI(data, salt, iterations, cryptoMethod) {\n    // omit the work if already generated\n    const key = [data, salt.toString('base64'), iterations].join('_');\n    if (_hiCache[key] != null) {\n        return _hiCache[key];\n    }\n    // generate the salt\n    const saltedData = crypto.pbkdf2Sync(data, salt, iterations, hiLengthMap[cryptoMethod], cryptoMethod);\n    // cache a copy to speed up the next lookup, but prevent unbounded cache growth\n    if (_hiCacheCount >= 200) {\n        _hiCachePurge();\n    }\n    _hiCache[key] = saltedData;\n    _hiCacheCount += 1;\n    return saltedData;\n}\nfunction compareDigest(lhs, rhs) {\n    if (lhs.length !== rhs.length) {\n        return false;\n    }\n    if (typeof crypto.timingSafeEqual === 'function') {\n        return crypto.timingSafeEqual(lhs, rhs);\n    }\n    let result = 0;\n    for (let i = 0; i < lhs.length; i++) {\n        result |= lhs[i] ^ rhs[i];\n    }\n    return result === 0;\n}\nclass ScramSHA1 extends ScramSHA {\n    constructor() {\n        super('sha1');\n    }\n}\nexports.ScramSHA1 = ScramSHA1;\nclass ScramSHA256 extends ScramSHA {\n    constructor() {\n        super('sha256');\n    }\n}\nexports.ScramSHA256 = ScramSHA256;\n//# sourceMappingURL=scram.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9zY3JhbS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxtQkFBbUIsR0FBRyxpQkFBaUI7QUFDdkMsbUJBQW1CLG1CQUFPLENBQUMsa0lBQXNCO0FBQ2pELGVBQWUsbUJBQU8sQ0FBQyxzQkFBUTtBQUMvQixlQUFlLG1CQUFPLENBQUMsOEZBQVk7QUFDbkMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsd0JBQXdCLG1CQUFPLENBQUMsc0hBQWlCO0FBQ2pELG9CQUFvQixtQkFBTyxDQUFDLDhHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw2QkFBNkI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBCQUEwQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsR0FBRztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEZBQTBGLFdBQVc7QUFDckc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixPQUFPO0FBQ3hGO0FBQ0E7QUFDQSxxQ0FBcUMsT0FBTztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixnQ0FBZ0M7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsR0FBRztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxHQUFHO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isa0JBQWtCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFTLFNBQVMsU0FBUztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsWUFBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC9zY3JhbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU2NyYW1TSEEyNTYgPSBleHBvcnRzLlNjcmFtU0hBMSA9IHZvaWQgMDtcbmNvbnN0IHNhc2xwcmVwXzEgPSByZXF1aXJlKFwiQG1vbmdvZGItanMvc2FzbHByZXBcIik7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKFwiY3J5cHRvXCIpO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uLy4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsc1wiKTtcbmNvbnN0IGF1dGhfcHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuL2F1dGhfcHJvdmlkZXJcIik7XG5jb25zdCBwcm92aWRlcnNfMSA9IHJlcXVpcmUoXCIuL3Byb3ZpZGVyc1wiKTtcbmNsYXNzIFNjcmFtU0hBIGV4dGVuZHMgYXV0aF9wcm92aWRlcl8xLkF1dGhQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoY3J5cHRvTWV0aG9kKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuY3J5cHRvTWV0aG9kID0gY3J5cHRvTWV0aG9kIHx8ICdzaGExJztcbiAgICB9XG4gICAgYXN5bmMgcHJlcGFyZShoYW5kc2hha2VEb2MsIGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNyeXB0b01ldGhvZCA9IHRoaXMuY3J5cHRvTWV0aG9kO1xuICAgICAgICBjb25zdCBjcmVkZW50aWFscyA9IGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzO1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdBdXRoQ29udGV4dCBtdXN0IHByb3ZpZGUgY3JlZGVudGlhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgbm9uY2UgPSBhd2FpdCAoMCwgdXRpbHNfMS5yYW5kb21CeXRlcykoMjQpO1xuICAgICAgICAvLyBzdG9yZSB0aGUgbm9uY2UgZm9yIGxhdGVyIHVzZVxuICAgICAgICBhdXRoQ29udGV4dC5ub25jZSA9IG5vbmNlO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICAgICAgLi4uaGFuZHNoYWtlRG9jLFxuICAgICAgICAgICAgc3BlY3VsYXRpdmVBdXRoZW50aWNhdGU6IHtcbiAgICAgICAgICAgICAgICAuLi5tYWtlRmlyc3RNZXNzYWdlKGNyeXB0b01ldGhvZCwgY3JlZGVudGlhbHMsIG5vbmNlKSxcbiAgICAgICAgICAgICAgICBkYjogY3JlZGVudGlhbHMuc291cmNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiByZXF1ZXN0O1xuICAgIH1cbiAgICBhc3luYyBhdXRoKGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHsgcmVhdXRoZW50aWNhdGluZywgcmVzcG9uc2UgfSA9IGF1dGhDb250ZXh0O1xuICAgICAgICBpZiAocmVzcG9uc2U/LnNwZWN1bGF0aXZlQXV0aGVudGljYXRlICYmICFyZWF1dGhlbnRpY2F0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgY29udGludWVTY3JhbUNvbnZlcnNhdGlvbih0aGlzLmNyeXB0b01ldGhvZCwgcmVzcG9uc2Uuc3BlY3VsYXRpdmVBdXRoZW50aWNhdGUsIGF1dGhDb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgZXhlY3V0ZVNjcmFtKHRoaXMuY3J5cHRvTWV0aG9kLCBhdXRoQ29udGV4dCk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2xlYW5Vc2VybmFtZSh1c2VybmFtZSkge1xuICAgIHJldHVybiB1c2VybmFtZS5yZXBsYWNlKCc9JywgJz0zRCcpLnJlcGxhY2UoJywnLCAnPTJDJyk7XG59XG5mdW5jdGlvbiBjbGllbnRGaXJzdE1lc3NhZ2VCYXJlKHVzZXJuYW1lLCBub25jZSkge1xuICAgIC8vIE5PVEU6IFRoaXMgaXMgZG9uZSBiL2MgSmF2YXNjcmlwdCB1c2VzIFVURi0xNiwgYnV0IHRoZSBzZXJ2ZXIgaXMgaGFzaGluZyBpbiBVVEYtOC5cbiAgICAvLyBTaW5jZSB0aGUgdXNlcm5hbWUgaXMgbm90IHNhc2wtcHJlcC1kLCB3ZSBuZWVkIHRvIGRvIHRoaXMgaGVyZS5cbiAgICByZXR1cm4gQnVmZmVyLmNvbmNhdChbXG4gICAgICAgIEJ1ZmZlci5mcm9tKCduPScsICd1dGY4JyksXG4gICAgICAgIEJ1ZmZlci5mcm9tKHVzZXJuYW1lLCAndXRmOCcpLFxuICAgICAgICBCdWZmZXIuZnJvbSgnLHI9JywgJ3V0ZjgnKSxcbiAgICAgICAgQnVmZmVyLmZyb20obm9uY2UudG9TdHJpbmcoJ2Jhc2U2NCcpLCAndXRmOCcpXG4gICAgXSk7XG59XG5mdW5jdGlvbiBtYWtlRmlyc3RNZXNzYWdlKGNyeXB0b01ldGhvZCwgY3JlZGVudGlhbHMsIG5vbmNlKSB7XG4gICAgY29uc3QgdXNlcm5hbWUgPSBjbGVhblVzZXJuYW1lKGNyZWRlbnRpYWxzLnVzZXJuYW1lKTtcbiAgICBjb25zdCBtZWNoYW5pc20gPSBjcnlwdG9NZXRob2QgPT09ICdzaGExJyA/IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9TQ1JBTV9TSEExIDogcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1NjtcbiAgICAvLyBOT1RFOiBUaGlzIGlzIGRvbmUgYi9jIEphdmFzY3JpcHQgdXNlcyBVVEYtMTYsIGJ1dCB0aGUgc2VydmVyIGlzIGhhc2hpbmcgaW4gVVRGLTguXG4gICAgLy8gU2luY2UgdGhlIHVzZXJuYW1lIGlzIG5vdCBzYXNsLXByZXAtZCwgd2UgbmVlZCB0byBkbyB0aGlzIGhlcmUuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2FzbFN0YXJ0OiAxLFxuICAgICAgICBtZWNoYW5pc20sXG4gICAgICAgIHBheWxvYWQ6IG5ldyBic29uXzEuQmluYXJ5KEJ1ZmZlci5jb25jYXQoW0J1ZmZlci5mcm9tKCduLCwnLCAndXRmOCcpLCBjbGllbnRGaXJzdE1lc3NhZ2VCYXJlKHVzZXJuYW1lLCBub25jZSldKSksXG4gICAgICAgIGF1dG9BdXRob3JpemU6IDEsXG4gICAgICAgIG9wdGlvbnM6IHsgc2tpcEVtcHR5RXhjaGFuZ2U6IHRydWUgfVxuICAgIH07XG59XG5hc3luYyBmdW5jdGlvbiBleGVjdXRlU2NyYW0oY3J5cHRvTWV0aG9kLCBhdXRoQ29udGV4dCkge1xuICAgIGNvbnN0IHsgY29ubmVjdGlvbiwgY3JlZGVudGlhbHMgfSA9IGF1dGhDb250ZXh0O1xuICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcignQXV0aENvbnRleHQgbXVzdCBwcm92aWRlIGNyZWRlbnRpYWxzLicpO1xuICAgIH1cbiAgICBpZiAoIWF1dGhDb250ZXh0Lm5vbmNlKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0F1dGhDb250ZXh0IG11c3QgY29udGFpbiBhIHZhbGlkIG5vbmNlIHByb3BlcnR5Jyk7XG4gICAgfVxuICAgIGNvbnN0IG5vbmNlID0gYXV0aENvbnRleHQubm9uY2U7XG4gICAgY29uc3QgZGIgPSBjcmVkZW50aWFscy5zb3VyY2U7XG4gICAgY29uc3Qgc2FzbFN0YXJ0Q21kID0gbWFrZUZpcnN0TWVzc2FnZShjcnlwdG9NZXRob2QsIGNyZWRlbnRpYWxzLCBub25jZSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjb25uZWN0aW9uLmNvbW1hbmQoKDAsIHV0aWxzXzEubnMpKGAke2RifS4kY21kYCksIHNhc2xTdGFydENtZCwgdW5kZWZpbmVkKTtcbiAgICBhd2FpdCBjb250aW51ZVNjcmFtQ29udmVyc2F0aW9uKGNyeXB0b01ldGhvZCwgcmVzcG9uc2UsIGF1dGhDb250ZXh0KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGNvbnRpbnVlU2NyYW1Db252ZXJzYXRpb24oY3J5cHRvTWV0aG9kLCByZXNwb25zZSwgYXV0aENvbnRleHQpIHtcbiAgICBjb25zdCBjb25uZWN0aW9uID0gYXV0aENvbnRleHQuY29ubmVjdGlvbjtcbiAgICBjb25zdCBjcmVkZW50aWFscyA9IGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzO1xuICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcignQXV0aENvbnRleHQgbXVzdCBwcm92aWRlIGNyZWRlbnRpYWxzLicpO1xuICAgIH1cbiAgICBpZiAoIWF1dGhDb250ZXh0Lm5vbmNlKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VuYWJsZSB0byBjb250aW51ZSBTQ1JBTSB3aXRob3V0IHZhbGlkIG5vbmNlJyk7XG4gICAgfVxuICAgIGNvbnN0IG5vbmNlID0gYXV0aENvbnRleHQubm9uY2U7XG4gICAgY29uc3QgZGIgPSBjcmVkZW50aWFscy5zb3VyY2U7XG4gICAgY29uc3QgdXNlcm5hbWUgPSBjbGVhblVzZXJuYW1lKGNyZWRlbnRpYWxzLnVzZXJuYW1lKTtcbiAgICBjb25zdCBwYXNzd29yZCA9IGNyZWRlbnRpYWxzLnBhc3N3b3JkO1xuICAgIGNvbnN0IHByb2Nlc3NlZFBhc3N3b3JkID0gY3J5cHRvTWV0aG9kID09PSAnc2hhMjU2JyA/ICgwLCBzYXNscHJlcF8xLnNhc2xwcmVwKShwYXNzd29yZCkgOiBwYXNzd29yZERpZ2VzdCh1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgIGNvbnN0IHBheWxvYWQgPSBCdWZmZXIuaXNCdWZmZXIocmVzcG9uc2UucGF5bG9hZClcbiAgICAgICAgPyBuZXcgYnNvbl8xLkJpbmFyeShyZXNwb25zZS5wYXlsb2FkKVxuICAgICAgICA6IHJlc3BvbnNlLnBheWxvYWQ7XG4gICAgY29uc3QgZGljdCA9IHBhcnNlUGF5bG9hZChwYXlsb2FkKTtcbiAgICBjb25zdCBpdGVyYXRpb25zID0gcGFyc2VJbnQoZGljdC5pLCAxMCk7XG4gICAgaWYgKGl0ZXJhdGlvbnMgJiYgaXRlcmF0aW9ucyA8IDQwOTYpIHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBTZXJ2ZXIgcmV0dXJuZWQgYW4gaW52YWxpZCBpdGVyYXRpb24gY291bnQgJHtpdGVyYXRpb25zfWApO1xuICAgIH1cbiAgICBjb25zdCBzYWx0ID0gZGljdC5zO1xuICAgIGNvbnN0IHJub25jZSA9IGRpY3QucjtcbiAgICBpZiAocm5vbmNlLnN0YXJ0c1dpdGgoJ25vbmNlJykpIHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBTZXJ2ZXIgcmV0dXJuZWQgYW4gaW52YWxpZCBub25jZTogJHtybm9uY2V9YCk7XG4gICAgfVxuICAgIC8vIFNldCB1cCBzdGFydCBvZiBwcm9vZlxuICAgIGNvbnN0IHdpdGhvdXRQcm9vZiA9IGBjPWJpd3Mscj0ke3Jub25jZX1gO1xuICAgIGNvbnN0IHNhbHRlZFBhc3N3b3JkID0gSEkocHJvY2Vzc2VkUGFzc3dvcmQsIEJ1ZmZlci5mcm9tKHNhbHQsICdiYXNlNjQnKSwgaXRlcmF0aW9ucywgY3J5cHRvTWV0aG9kKTtcbiAgICBjb25zdCBjbGllbnRLZXkgPSBITUFDKGNyeXB0b01ldGhvZCwgc2FsdGVkUGFzc3dvcmQsICdDbGllbnQgS2V5Jyk7XG4gICAgY29uc3Qgc2VydmVyS2V5ID0gSE1BQyhjcnlwdG9NZXRob2QsIHNhbHRlZFBhc3N3b3JkLCAnU2VydmVyIEtleScpO1xuICAgIGNvbnN0IHN0b3JlZEtleSA9IEgoY3J5cHRvTWV0aG9kLCBjbGllbnRLZXkpO1xuICAgIGNvbnN0IGF1dGhNZXNzYWdlID0gW1xuICAgICAgICBjbGllbnRGaXJzdE1lc3NhZ2VCYXJlKHVzZXJuYW1lLCBub25jZSksXG4gICAgICAgIHBheWxvYWQudG9TdHJpbmcoJ3V0ZjgnKSxcbiAgICAgICAgd2l0aG91dFByb29mXG4gICAgXS5qb2luKCcsJyk7XG4gICAgY29uc3QgY2xpZW50U2lnbmF0dXJlID0gSE1BQyhjcnlwdG9NZXRob2QsIHN0b3JlZEtleSwgYXV0aE1lc3NhZ2UpO1xuICAgIGNvbnN0IGNsaWVudFByb29mID0gYHA9JHt4b3IoY2xpZW50S2V5LCBjbGllbnRTaWduYXR1cmUpfWA7XG4gICAgY29uc3QgY2xpZW50RmluYWwgPSBbd2l0aG91dFByb29mLCBjbGllbnRQcm9vZl0uam9pbignLCcpO1xuICAgIGNvbnN0IHNlcnZlclNpZ25hdHVyZSA9IEhNQUMoY3J5cHRvTWV0aG9kLCBzZXJ2ZXJLZXksIGF1dGhNZXNzYWdlKTtcbiAgICBjb25zdCBzYXNsQ29udGludWVDbWQgPSB7XG4gICAgICAgIHNhc2xDb250aW51ZTogMSxcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IHJlc3BvbnNlLmNvbnZlcnNhdGlvbklkLFxuICAgICAgICBwYXlsb2FkOiBuZXcgYnNvbl8xLkJpbmFyeShCdWZmZXIuZnJvbShjbGllbnRGaW5hbCkpXG4gICAgfTtcbiAgICBjb25zdCByID0gYXdhaXQgY29ubmVjdGlvbi5jb21tYW5kKCgwLCB1dGlsc18xLm5zKShgJHtkYn0uJGNtZGApLCBzYXNsQ29udGludWVDbWQsIHVuZGVmaW5lZCk7XG4gICAgY29uc3QgcGFyc2VkUmVzcG9uc2UgPSBwYXJzZVBheWxvYWQoci5wYXlsb2FkKTtcbiAgICBpZiAoIWNvbXBhcmVEaWdlc3QoQnVmZmVyLmZyb20ocGFyc2VkUmVzcG9uc2UudiwgJ2Jhc2U2NCcpLCBzZXJ2ZXJTaWduYXR1cmUpKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdTZXJ2ZXIgcmV0dXJuZWQgYW4gaW52YWxpZCBzaWduYXR1cmUnKTtcbiAgICB9XG4gICAgaWYgKHIuZG9uZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgLy8gSWYgdGhlIHNlcnZlciBzZW5kcyByLmRvbmUgPT09IHRydWUgd2UgY2FuIHNhdmUgb25lIFJUVFxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJldHJ5U2FzbENvbnRpbnVlQ21kID0ge1xuICAgICAgICBzYXNsQ29udGludWU6IDEsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiByLmNvbnZlcnNhdGlvbklkLFxuICAgICAgICBwYXlsb2FkOiBCdWZmZXIuYWxsb2MoMClcbiAgICB9O1xuICAgIGF3YWl0IGNvbm5lY3Rpb24uY29tbWFuZCgoMCwgdXRpbHNfMS5ucykoYCR7ZGJ9LiRjbWRgKSwgcmV0cnlTYXNsQ29udGludWVDbWQsIHVuZGVmaW5lZCk7XG59XG5mdW5jdGlvbiBwYXJzZVBheWxvYWQocGF5bG9hZCkge1xuICAgIGNvbnN0IHBheWxvYWRTdHIgPSBwYXlsb2FkLnRvU3RyaW5nKCd1dGY4Jyk7XG4gICAgY29uc3QgZGljdCA9IHt9O1xuICAgIGNvbnN0IHBhcnRzID0gcGF5bG9hZFN0ci5zcGxpdCgnLCcpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgdmFsdWVQYXJ0cyA9IChwYXJ0c1tpXS5tYXRjaCgvXihbXj1dKik9KC4qKSQvKSA/PyBbXSkuc2xpY2UoMSk7XG4gICAgICAgIGRpY3RbdmFsdWVQYXJ0c1swXV0gPSB2YWx1ZVBhcnRzWzFdO1xuICAgIH1cbiAgICByZXR1cm4gZGljdDtcbn1cbmZ1bmN0aW9uIHBhc3N3b3JkRGlnZXN0KHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIGlmICh0eXBlb2YgdXNlcm5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VzZXJuYW1lIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwYXNzd29yZCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUGFzc3dvcmQgbXVzdCBiZSBhIHN0cmluZycpO1xuICAgIH1cbiAgICBpZiAocGFzc3dvcmQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1Bhc3N3b3JkIGNhbm5vdCBiZSBlbXB0eScpO1xuICAgIH1cbiAgICBsZXQgbWQ1O1xuICAgIHRyeSB7XG4gICAgICAgIG1kNSA9IGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAoY3J5cHRvLmdldEZpcHMoKSkge1xuICAgICAgICAgICAgLy8gVGhpcyBlcnJvciBpcyAoc2xpZ2h0bHkpIG1vcmUgaGVscGZ1bCB0aGFuIHdoYXQgY29tZXMgZnJvbSBPcGVuU1NMIGRpcmVjdGx5LCBlLmcuXG4gICAgICAgICAgICAvLyAnRXJyb3I6IGVycm9yOjA2MDgwMEM4OmRpZ2l0YWwgZW52ZWxvcGUgcm91dGluZXM6RVZQX0RpZ2VzdEluaXRfZXg6ZGlzYWJsZWQgZm9yIEZJUFMnXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGggbWVjaGFuaXNtIFNDUkFNLVNIQS0xIGlzIG5vdCBzdXBwb3J0ZWQgaW4gRklQUyBtb2RlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBtZDUudXBkYXRlKGAke3VzZXJuYW1lfTptb25nbzoke3Bhc3N3b3JkfWAsICd1dGY4Jyk7XG4gICAgcmV0dXJuIG1kNS5kaWdlc3QoJ2hleCcpO1xufVxuLy8gWE9SIHR3byBidWZmZXJzXG5mdW5jdGlvbiB4b3IoYSwgYikge1xuICAgIGlmICghQnVmZmVyLmlzQnVmZmVyKGEpKSB7XG4gICAgICAgIGEgPSBCdWZmZXIuZnJvbShhKTtcbiAgICB9XG4gICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYikpIHtcbiAgICAgICAgYiA9IEJ1ZmZlci5mcm9tKGIpO1xuICAgIH1cbiAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1heChhLmxlbmd0aCwgYi5sZW5ndGgpO1xuICAgIGNvbnN0IHJlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgcmVzLnB1c2goYVtpXSBeIGJbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gQnVmZmVyLmZyb20ocmVzKS50b1N0cmluZygnYmFzZTY0Jyk7XG59XG5mdW5jdGlvbiBIKG1ldGhvZCwgdGV4dCkge1xuICAgIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaChtZXRob2QpLnVwZGF0ZSh0ZXh0KS5kaWdlc3QoKTtcbn1cbmZ1bmN0aW9uIEhNQUMobWV0aG9kLCBrZXksIHRleHQpIHtcbiAgICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhtYWMobWV0aG9kLCBrZXkpLnVwZGF0ZSh0ZXh0KS5kaWdlc3QoKTtcbn1cbmxldCBfaGlDYWNoZSA9IHt9O1xubGV0IF9oaUNhY2hlQ291bnQgPSAwO1xuZnVuY3Rpb24gX2hpQ2FjaGVQdXJnZSgpIHtcbiAgICBfaGlDYWNoZSA9IHt9O1xuICAgIF9oaUNhY2hlQ291bnQgPSAwO1xufVxuY29uc3QgaGlMZW5ndGhNYXAgPSB7XG4gICAgc2hhMjU2OiAzMixcbiAgICBzaGExOiAyMFxufTtcbmZ1bmN0aW9uIEhJKGRhdGEsIHNhbHQsIGl0ZXJhdGlvbnMsIGNyeXB0b01ldGhvZCkge1xuICAgIC8vIG9taXQgdGhlIHdvcmsgaWYgYWxyZWFkeSBnZW5lcmF0ZWRcbiAgICBjb25zdCBrZXkgPSBbZGF0YSwgc2FsdC50b1N0cmluZygnYmFzZTY0JyksIGl0ZXJhdGlvbnNdLmpvaW4oJ18nKTtcbiAgICBpZiAoX2hpQ2FjaGVba2V5XSAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBfaGlDYWNoZVtrZXldO1xuICAgIH1cbiAgICAvLyBnZW5lcmF0ZSB0aGUgc2FsdFxuICAgIGNvbnN0IHNhbHRlZERhdGEgPSBjcnlwdG8ucGJrZGYyU3luYyhkYXRhLCBzYWx0LCBpdGVyYXRpb25zLCBoaUxlbmd0aE1hcFtjcnlwdG9NZXRob2RdLCBjcnlwdG9NZXRob2QpO1xuICAgIC8vIGNhY2hlIGEgY29weSB0byBzcGVlZCB1cCB0aGUgbmV4dCBsb29rdXAsIGJ1dCBwcmV2ZW50IHVuYm91bmRlZCBjYWNoZSBncm93dGhcbiAgICBpZiAoX2hpQ2FjaGVDb3VudCA+PSAyMDApIHtcbiAgICAgICAgX2hpQ2FjaGVQdXJnZSgpO1xuICAgIH1cbiAgICBfaGlDYWNoZVtrZXldID0gc2FsdGVkRGF0YTtcbiAgICBfaGlDYWNoZUNvdW50ICs9IDE7XG4gICAgcmV0dXJuIHNhbHRlZERhdGE7XG59XG5mdW5jdGlvbiBjb21wYXJlRGlnZXN0KGxocywgcmhzKSB7XG4gICAgaWYgKGxocy5sZW5ndGggIT09IHJocy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNyeXB0by50aW1pbmdTYWZlRXF1YWwgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIGNyeXB0by50aW1pbmdTYWZlRXF1YWwobGhzLCByaHMpO1xuICAgIH1cbiAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxocy5sZW5ndGg7IGkrKykge1xuICAgICAgICByZXN1bHQgfD0gbGhzW2ldIF4gcmhzW2ldO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0ID09PSAwO1xufVxuY2xhc3MgU2NyYW1TSEExIGV4dGVuZHMgU2NyYW1TSEEge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignc2hhMScpO1xuICAgIH1cbn1cbmV4cG9ydHMuU2NyYW1TSEExID0gU2NyYW1TSEExO1xuY2xhc3MgU2NyYW1TSEEyNTYgZXh0ZW5kcyBTY3JhbVNIQSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdzaGEyNTYnKTtcbiAgICB9XG59XG5leHBvcnRzLlNjcmFtU0hBMjU2ID0gU2NyYW1TSEEyNTY7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zY3JhbS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/scram.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/x509.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/x509.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.X509 = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nclass X509 extends auth_provider_1.AuthProvider {\n    async prepare(handshakeDoc, authContext) {\n        const { credentials } = authContext;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        return { ...handshakeDoc, speculativeAuthenticate: x509AuthenticateCommand(credentials) };\n    }\n    async auth(authContext) {\n        const connection = authContext.connection;\n        const credentials = authContext.credentials;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n        }\n        const response = authContext.response;\n        if (response?.speculativeAuthenticate) {\n            return;\n        }\n        await connection.command((0, utils_1.ns)('$external.$cmd'), x509AuthenticateCommand(credentials), undefined);\n    }\n}\nexports.X509 = X509;\nfunction x509AuthenticateCommand(credentials) {\n    const command = { authenticate: 1, mechanism: 'MONGODB-X509' };\n    if (credentials.username) {\n        command.user = credentials.username;\n    }\n    return command;\n}\n//# sourceMappingURL=x509.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC94NTA5LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVk7QUFDWixnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQyx3QkFBd0IsbUJBQU8sQ0FBQyxzSEFBaUI7QUFDakQ7QUFDQTtBQUNBLGdCQUFnQixjQUFjO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvYXV0aC94NTA5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5YNTA5ID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG5jb25zdCBhdXRoX3Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9hdXRoX3Byb3ZpZGVyXCIpO1xuY2xhc3MgWDUwOSBleHRlbmRzIGF1dGhfcHJvdmlkZXJfMS5BdXRoUHJvdmlkZXIge1xuICAgIGFzeW5jIHByZXBhcmUoaGFuZHNoYWtlRG9jLCBhdXRoQ29udGV4dCkge1xuICAgICAgICBjb25zdCB7IGNyZWRlbnRpYWxzIH0gPSBhdXRoQ29udGV4dDtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcignQXV0aENvbnRleHQgbXVzdCBwcm92aWRlIGNyZWRlbnRpYWxzLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IC4uLmhhbmRzaGFrZURvYywgc3BlY3VsYXRpdmVBdXRoZW50aWNhdGU6IHg1MDlBdXRoZW50aWNhdGVDb21tYW5kKGNyZWRlbnRpYWxzKSB9O1xuICAgIH1cbiAgICBhc3luYyBhdXRoKGF1dGhDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhdXRoQ29udGV4dC5jb25uZWN0aW9uO1xuICAgICAgICBjb25zdCBjcmVkZW50aWFscyA9IGF1dGhDb250ZXh0LmNyZWRlbnRpYWxzO1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yKCdBdXRoQ29udGV4dCBtdXN0IHByb3ZpZGUgY3JlZGVudGlhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhdXRoQ29udGV4dC5yZXNwb25zZTtcbiAgICAgICAgaWYgKHJlc3BvbnNlPy5zcGVjdWxhdGl2ZUF1dGhlbnRpY2F0ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uY29tbWFuZCgoMCwgdXRpbHNfMS5ucykoJyRleHRlcm5hbC4kY21kJyksIHg1MDlBdXRoZW50aWNhdGVDb21tYW5kKGNyZWRlbnRpYWxzKSwgdW5kZWZpbmVkKTtcbiAgICB9XG59XG5leHBvcnRzLlg1MDkgPSBYNTA5O1xuZnVuY3Rpb24geDUwOUF1dGhlbnRpY2F0ZUNvbW1hbmQoY3JlZGVudGlhbHMpIHtcbiAgICBjb25zdCBjb21tYW5kID0geyBhdXRoZW50aWNhdGU6IDEsIG1lY2hhbmlzbTogJ01PTkdPREItWDUwOScgfTtcbiAgICBpZiAoY3JlZGVudGlhbHMudXNlcm5hbWUpIHtcbiAgICAgICAgY29tbWFuZC51c2VyID0gY3JlZGVudGlhbHMudXNlcm5hbWU7XG4gICAgfVxuICAgIHJldHVybiBjb21tYW5kO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9eDUwOS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/x509.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/command_monitoring_events.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/command_monitoring_events.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.SENSITIVE_COMMANDS = exports.CommandFailedEvent = exports.CommandSucceededEvent = exports.CommandStartedEvent = void 0;\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst commands_1 = __webpack_require__(/*! ./commands */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js\");\n/**\n * An event indicating the start of a given command\n * @public\n * @category Event\n */\nclass CommandStartedEvent {\n    /**\n     * Create a started event\n     *\n     * @internal\n     * @param pool - the pool that originated the command\n     * @param command - the command\n     */\n    constructor(connection, command, serverConnectionId) {\n        /** @internal */\n        this.name = constants_1.COMMAND_STARTED;\n        const cmd = extractCommand(command);\n        const commandName = extractCommandName(cmd);\n        const { address, connectionId, serviceId } = extractConnectionDetails(connection);\n        // TODO: remove in major revision, this is not spec behavior\n        if (exports.SENSITIVE_COMMANDS.has(commandName)) {\n            this.commandObj = {};\n            this.commandObj[commandName] = true;\n        }\n        this.address = address;\n        this.connectionId = connectionId;\n        this.serviceId = serviceId;\n        this.requestId = command.requestId;\n        this.databaseName = command.databaseName;\n        this.commandName = commandName;\n        this.command = maybeRedact(commandName, cmd, cmd);\n        this.serverConnectionId = serverConnectionId;\n    }\n    /* @internal */\n    get hasServiceId() {\n        return !!this.serviceId;\n    }\n}\nexports.CommandStartedEvent = CommandStartedEvent;\n/**\n * An event indicating the success of a given command\n * @public\n * @category Event\n */\nclass CommandSucceededEvent {\n    /**\n     * Create a succeeded event\n     *\n     * @internal\n     * @param pool - the pool that originated the command\n     * @param command - the command\n     * @param reply - the reply for this command from the server\n     * @param started - a high resolution tuple timestamp of when the command was first sent, to calculate duration\n     */\n    constructor(connection, command, reply, started, serverConnectionId) {\n        /** @internal */\n        this.name = constants_1.COMMAND_SUCCEEDED;\n        const cmd = extractCommand(command);\n        const commandName = extractCommandName(cmd);\n        const { address, connectionId, serviceId } = extractConnectionDetails(connection);\n        this.address = address;\n        this.connectionId = connectionId;\n        this.serviceId = serviceId;\n        this.requestId = command.requestId;\n        this.commandName = commandName;\n        this.duration = (0, utils_1.calculateDurationInMs)(started);\n        this.reply = maybeRedact(commandName, cmd, extractReply(reply));\n        this.serverConnectionId = serverConnectionId;\n    }\n    /* @internal */\n    get hasServiceId() {\n        return !!this.serviceId;\n    }\n}\nexports.CommandSucceededEvent = CommandSucceededEvent;\n/**\n * An event indicating the failure of a given command\n * @public\n * @category Event\n */\nclass CommandFailedEvent {\n    /**\n     * Create a failure event\n     *\n     * @internal\n     * @param pool - the pool that originated the command\n     * @param command - the command\n     * @param error - the generated error or a server error response\n     * @param started - a high resolution tuple timestamp of when the command was first sent, to calculate duration\n     */\n    constructor(connection, command, error, started, serverConnectionId) {\n        /** @internal */\n        this.name = constants_1.COMMAND_FAILED;\n        const cmd = extractCommand(command);\n        const commandName = extractCommandName(cmd);\n        const { address, connectionId, serviceId } = extractConnectionDetails(connection);\n        this.address = address;\n        this.connectionId = connectionId;\n        this.serviceId = serviceId;\n        this.requestId = command.requestId;\n        this.commandName = commandName;\n        this.duration = (0, utils_1.calculateDurationInMs)(started);\n        this.failure = maybeRedact(commandName, cmd, error);\n        this.serverConnectionId = serverConnectionId;\n    }\n    /* @internal */\n    get hasServiceId() {\n        return !!this.serviceId;\n    }\n}\nexports.CommandFailedEvent = CommandFailedEvent;\n/**\n * Commands that we want to redact because of the sensitive nature of their contents\n * @internal\n */\nexports.SENSITIVE_COMMANDS = new Set([\n    'authenticate',\n    'saslStart',\n    'saslContinue',\n    'getnonce',\n    'createUser',\n    'updateUser',\n    'copydbgetnonce',\n    'copydbsaslstart',\n    'copydb'\n]);\nconst HELLO_COMMANDS = new Set(['hello', constants_1.LEGACY_HELLO_COMMAND, constants_1.LEGACY_HELLO_COMMAND_CAMEL_CASE]);\n// helper methods\nconst extractCommandName = (commandDoc) => Object.keys(commandDoc)[0];\nconst collectionName = (command) => command.ns.split('.')[1];\nconst maybeRedact = (commandName, commandDoc, result) => exports.SENSITIVE_COMMANDS.has(commandName) ||\n    (HELLO_COMMANDS.has(commandName) && commandDoc.speculativeAuthenticate)\n    ? {}\n    : result;\nconst LEGACY_FIND_QUERY_MAP = {\n    $query: 'filter',\n    $orderby: 'sort',\n    $hint: 'hint',\n    $comment: 'comment',\n    $maxScan: 'maxScan',\n    $max: 'max',\n    $min: 'min',\n    $returnKey: 'returnKey',\n    $showDiskLoc: 'showRecordId',\n    $maxTimeMS: 'maxTimeMS',\n    $snapshot: 'snapshot'\n};\nconst LEGACY_FIND_OPTIONS_MAP = {\n    numberToSkip: 'skip',\n    numberToReturn: 'batchSize',\n    returnFieldSelector: 'projection'\n};\n/** Extract the actual command from the query, possibly up-converting if it's a legacy format */\nfunction extractCommand(command) {\n    if (command instanceof commands_1.OpMsgRequest) {\n        const cmd = { ...command.command };\n        // For OP_MSG with payload type 1 we need to pull the documents\n        // array out of the document sequence for monitoring.\n        if (cmd.ops instanceof commands_1.DocumentSequence) {\n            cmd.ops = cmd.ops.documents;\n        }\n        if (cmd.nsInfo instanceof commands_1.DocumentSequence) {\n            cmd.nsInfo = cmd.nsInfo.documents;\n        }\n        return cmd;\n    }\n    if (command.query?.$query) {\n        let result;\n        if (command.ns === 'admin.$cmd') {\n            // up-convert legacy command\n            result = Object.assign({}, command.query.$query);\n        }\n        else {\n            // up-convert legacy find command\n            result = { find: collectionName(command) };\n            Object.keys(LEGACY_FIND_QUERY_MAP).forEach(key => {\n                if (command.query[key] != null) {\n                    result[LEGACY_FIND_QUERY_MAP[key]] = { ...command.query[key] };\n                }\n            });\n        }\n        Object.keys(LEGACY_FIND_OPTIONS_MAP).forEach(key => {\n            const legacyKey = key;\n            if (command[legacyKey] != null) {\n                result[LEGACY_FIND_OPTIONS_MAP[legacyKey]] = command[legacyKey];\n            }\n        });\n        return result;\n    }\n    let clonedQuery = {};\n    const clonedCommand = { ...command };\n    if (command.query) {\n        clonedQuery = { ...command.query };\n        clonedCommand.query = clonedQuery;\n    }\n    return command.query ? clonedQuery : clonedCommand;\n}\nfunction extractReply(reply) {\n    if (!reply) {\n        return reply;\n    }\n    return reply.result ? reply.result : reply;\n}\nfunction extractConnectionDetails(connection) {\n    let connectionId;\n    if ('id' in connection) {\n        connectionId = connection.id;\n    }\n    return {\n        address: connection.address,\n        serviceId: connection.serviceId,\n        connectionId\n    };\n}\n//# sourceMappingURL=command_monitoring_events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEIsR0FBRywwQkFBMEIsR0FBRyw2QkFBNkIsR0FBRywyQkFBMkI7QUFDckgsb0JBQW9CLG1CQUFPLENBQUMscUdBQWM7QUFDMUMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsbUJBQW1CLG1CQUFPLENBQUMsdUdBQVk7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1DQUFtQztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1DQUFtQztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbUNBQW1DO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQSwyREFBMkQ7QUFDM0Q7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU0VOU0lUSVZFX0NPTU1BTkRTID0gZXhwb3J0cy5Db21tYW5kRmFpbGVkRXZlbnQgPSBleHBvcnRzLkNvbW1hbmRTdWNjZWVkZWRFdmVudCA9IGV4cG9ydHMuQ29tbWFuZFN0YXJ0ZWRFdmVudCA9IHZvaWQgMDtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kc18xID0gcmVxdWlyZShcIi4vY29tbWFuZHNcIik7XG4vKipcbiAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhlIHN0YXJ0IG9mIGEgZ2l2ZW4gY29tbWFuZFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbW1hbmRTdGFydGVkRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHN0YXJ0ZWQgZXZlbnRcbiAgICAgKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBwYXJhbSBwb29sIC0gdGhlIHBvb2wgdGhhdCBvcmlnaW5hdGVkIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5lY3Rpb24sIGNvbW1hbmQsIHNlcnZlckNvbm5lY3Rpb25JZCkge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTU1BTkRfU1RBUlRFRDtcbiAgICAgICAgY29uc3QgY21kID0gZXh0cmFjdENvbW1hbmQoY29tbWFuZCk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmROYW1lID0gZXh0cmFjdENvbW1hbmROYW1lKGNtZCk7XG4gICAgICAgIGNvbnN0IHsgYWRkcmVzcywgY29ubmVjdGlvbklkLCBzZXJ2aWNlSWQgfSA9IGV4dHJhY3RDb25uZWN0aW9uRGV0YWlscyhjb25uZWN0aW9uKTtcbiAgICAgICAgLy8gVE9ETzogcmVtb3ZlIGluIG1ham9yIHJldmlzaW9uLCB0aGlzIGlzIG5vdCBzcGVjIGJlaGF2aW9yXG4gICAgICAgIGlmIChleHBvcnRzLlNFTlNJVElWRV9DT01NQU5EUy5oYXMoY29tbWFuZE5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbW1hbmRPYmogPSB7fTtcbiAgICAgICAgICAgIHRoaXMuY29tbWFuZE9ialtjb21tYW5kTmFtZV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbklkO1xuICAgICAgICB0aGlzLnNlcnZpY2VJZCA9IHNlcnZpY2VJZDtcbiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSBjb21tYW5kLnJlcXVlc3RJZDtcbiAgICAgICAgdGhpcy5kYXRhYmFzZU5hbWUgPSBjb21tYW5kLmRhdGFiYXNlTmFtZTtcbiAgICAgICAgdGhpcy5jb21tYW5kTmFtZSA9IGNvbW1hbmROYW1lO1xuICAgICAgICB0aGlzLmNvbW1hbmQgPSBtYXliZVJlZGFjdChjb21tYW5kTmFtZSwgY21kLCBjbWQpO1xuICAgICAgICB0aGlzLnNlcnZlckNvbm5lY3Rpb25JZCA9IHNlcnZlckNvbm5lY3Rpb25JZDtcbiAgICB9XG4gICAgLyogQGludGVybmFsICovXG4gICAgZ2V0IGhhc1NlcnZpY2VJZCgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5zZXJ2aWNlSWQ7XG4gICAgfVxufVxuZXhwb3J0cy5Db21tYW5kU3RhcnRlZEV2ZW50ID0gQ29tbWFuZFN0YXJ0ZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGUgc3VjY2VzcyBvZiBhIGdpdmVuIGNvbW1hbmRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb21tYW5kU3VjY2VlZGVkRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHN1Y2NlZWRlZCBldmVudFxuICAgICAqXG4gICAgICogQGludGVybmFsXG4gICAgICogQHBhcmFtIHBvb2wgLSB0aGUgcG9vbCB0aGF0IG9yaWdpbmF0ZWQgdGhlIGNvbW1hbmRcbiAgICAgKiBAcGFyYW0gY29tbWFuZCAtIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIHJlcGx5IC0gdGhlIHJlcGx5IGZvciB0aGlzIGNvbW1hbmQgZnJvbSB0aGUgc2VydmVyXG4gICAgICogQHBhcmFtIHN0YXJ0ZWQgLSBhIGhpZ2ggcmVzb2x1dGlvbiB0dXBsZSB0aW1lc3RhbXAgb2Ygd2hlbiB0aGUgY29tbWFuZCB3YXMgZmlyc3Qgc2VudCwgdG8gY2FsY3VsYXRlIGR1cmF0aW9uXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY29ubmVjdGlvbiwgY29tbWFuZCwgcmVwbHksIHN0YXJ0ZWQsIHNlcnZlckNvbm5lY3Rpb25JZCkge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTU1BTkRfU1VDQ0VFREVEO1xuICAgICAgICBjb25zdCBjbWQgPSBleHRyYWN0Q29tbWFuZChjb21tYW5kKTtcbiAgICAgICAgY29uc3QgY29tbWFuZE5hbWUgPSBleHRyYWN0Q29tbWFuZE5hbWUoY21kKTtcbiAgICAgICAgY29uc3QgeyBhZGRyZXNzLCBjb25uZWN0aW9uSWQsIHNlcnZpY2VJZCB9ID0gZXh0cmFjdENvbm5lY3Rpb25EZXRhaWxzKGNvbm5lY3Rpb24pO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5zZXJ2aWNlSWQgPSBzZXJ2aWNlSWQ7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gY29tbWFuZC5yZXF1ZXN0SWQ7XG4gICAgICAgIHRoaXMuY29tbWFuZE5hbWUgPSBjb21tYW5kTmFtZTtcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnRlZCk7XG4gICAgICAgIHRoaXMucmVwbHkgPSBtYXliZVJlZGFjdChjb21tYW5kTmFtZSwgY21kLCBleHRyYWN0UmVwbHkocmVwbHkpKTtcbiAgICAgICAgdGhpcy5zZXJ2ZXJDb25uZWN0aW9uSWQgPSBzZXJ2ZXJDb25uZWN0aW9uSWQ7XG4gICAgfVxuICAgIC8qIEBpbnRlcm5hbCAqL1xuICAgIGdldCBoYXNTZXJ2aWNlSWQoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuc2VydmljZUlkO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29tbWFuZFN1Y2NlZWRlZEV2ZW50ID0gQ29tbWFuZFN1Y2NlZWRlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoZSBmYWlsdXJlIG9mIGEgZ2l2ZW4gY29tbWFuZFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbW1hbmRGYWlsZWRFdmVudCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgZmFpbHVyZSBldmVudFxuICAgICAqXG4gICAgICogQGludGVybmFsXG4gICAgICogQHBhcmFtIHBvb2wgLSB0aGUgcG9vbCB0aGF0IG9yaWdpbmF0ZWQgdGhlIGNvbW1hbmRcbiAgICAgKiBAcGFyYW0gY29tbWFuZCAtIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIGVycm9yIC0gdGhlIGdlbmVyYXRlZCBlcnJvciBvciBhIHNlcnZlciBlcnJvciByZXNwb25zZVxuICAgICAqIEBwYXJhbSBzdGFydGVkIC0gYSBoaWdoIHJlc29sdXRpb24gdHVwbGUgdGltZXN0YW1wIG9mIHdoZW4gdGhlIGNvbW1hbmQgd2FzIGZpcnN0IHNlbnQsIHRvIGNhbGN1bGF0ZSBkdXJhdGlvblxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5lY3Rpb24sIGNvbW1hbmQsIGVycm9yLCBzdGFydGVkLCBzZXJ2ZXJDb25uZWN0aW9uSWQpIHtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT01NQU5EX0ZBSUxFRDtcbiAgICAgICAgY29uc3QgY21kID0gZXh0cmFjdENvbW1hbmQoY29tbWFuZCk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmROYW1lID0gZXh0cmFjdENvbW1hbmROYW1lKGNtZCk7XG4gICAgICAgIGNvbnN0IHsgYWRkcmVzcywgY29ubmVjdGlvbklkLCBzZXJ2aWNlSWQgfSA9IGV4dHJhY3RDb25uZWN0aW9uRGV0YWlscyhjb25uZWN0aW9uKTtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uSWQ7XG4gICAgICAgIHRoaXMuc2VydmljZUlkID0gc2VydmljZUlkO1xuICAgICAgICB0aGlzLnJlcXVlc3RJZCA9IGNvbW1hbmQucmVxdWVzdElkO1xuICAgICAgICB0aGlzLmNvbW1hbmROYW1lID0gY29tbWFuZE5hbWU7XG4gICAgICAgIHRoaXMuZHVyYXRpb24gPSAoMCwgdXRpbHNfMS5jYWxjdWxhdGVEdXJhdGlvbkluTXMpKHN0YXJ0ZWQpO1xuICAgICAgICB0aGlzLmZhaWx1cmUgPSBtYXliZVJlZGFjdChjb21tYW5kTmFtZSwgY21kLCBlcnJvcik7XG4gICAgICAgIHRoaXMuc2VydmVyQ29ubmVjdGlvbklkID0gc2VydmVyQ29ubmVjdGlvbklkO1xuICAgIH1cbiAgICAvKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgaGFzU2VydmljZUlkKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnNlcnZpY2VJZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbW1hbmRGYWlsZWRFdmVudCA9IENvbW1hbmRGYWlsZWRFdmVudDtcbi8qKlxuICogQ29tbWFuZHMgdGhhdCB3ZSB3YW50IHRvIHJlZGFjdCBiZWNhdXNlIG9mIHRoZSBzZW5zaXRpdmUgbmF0dXJlIG9mIHRoZWlyIGNvbnRlbnRzXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0cy5TRU5TSVRJVkVfQ09NTUFORFMgPSBuZXcgU2V0KFtcbiAgICAnYXV0aGVudGljYXRlJyxcbiAgICAnc2FzbFN0YXJ0JyxcbiAgICAnc2FzbENvbnRpbnVlJyxcbiAgICAnZ2V0bm9uY2UnLFxuICAgICdjcmVhdGVVc2VyJyxcbiAgICAndXBkYXRlVXNlcicsXG4gICAgJ2NvcHlkYmdldG5vbmNlJyxcbiAgICAnY29weWRic2FzbHN0YXJ0JyxcbiAgICAnY29weWRiJ1xuXSk7XG5jb25zdCBIRUxMT19DT01NQU5EUyA9IG5ldyBTZXQoWydoZWxsbycsIGNvbnN0YW50c18xLkxFR0FDWV9IRUxMT19DT01NQU5ELCBjb25zdGFudHNfMS5MRUdBQ1lfSEVMTE9fQ09NTUFORF9DQU1FTF9DQVNFXSk7XG4vLyBoZWxwZXIgbWV0aG9kc1xuY29uc3QgZXh0cmFjdENvbW1hbmROYW1lID0gKGNvbW1hbmREb2MpID0+IE9iamVjdC5rZXlzKGNvbW1hbmREb2MpWzBdO1xuY29uc3QgY29sbGVjdGlvbk5hbWUgPSAoY29tbWFuZCkgPT4gY29tbWFuZC5ucy5zcGxpdCgnLicpWzFdO1xuY29uc3QgbWF5YmVSZWRhY3QgPSAoY29tbWFuZE5hbWUsIGNvbW1hbmREb2MsIHJlc3VsdCkgPT4gZXhwb3J0cy5TRU5TSVRJVkVfQ09NTUFORFMuaGFzKGNvbW1hbmROYW1lKSB8fFxuICAgIChIRUxMT19DT01NQU5EUy5oYXMoY29tbWFuZE5hbWUpICYmIGNvbW1hbmREb2Muc3BlY3VsYXRpdmVBdXRoZW50aWNhdGUpXG4gICAgPyB7fVxuICAgIDogcmVzdWx0O1xuY29uc3QgTEVHQUNZX0ZJTkRfUVVFUllfTUFQID0ge1xuICAgICRxdWVyeTogJ2ZpbHRlcicsXG4gICAgJG9yZGVyYnk6ICdzb3J0JyxcbiAgICAkaGludDogJ2hpbnQnLFxuICAgICRjb21tZW50OiAnY29tbWVudCcsXG4gICAgJG1heFNjYW46ICdtYXhTY2FuJyxcbiAgICAkbWF4OiAnbWF4JyxcbiAgICAkbWluOiAnbWluJyxcbiAgICAkcmV0dXJuS2V5OiAncmV0dXJuS2V5JyxcbiAgICAkc2hvd0Rpc2tMb2M6ICdzaG93UmVjb3JkSWQnLFxuICAgICRtYXhUaW1lTVM6ICdtYXhUaW1lTVMnLFxuICAgICRzbmFwc2hvdDogJ3NuYXBzaG90J1xufTtcbmNvbnN0IExFR0FDWV9GSU5EX09QVElPTlNfTUFQID0ge1xuICAgIG51bWJlclRvU2tpcDogJ3NraXAnLFxuICAgIG51bWJlclRvUmV0dXJuOiAnYmF0Y2hTaXplJyxcbiAgICByZXR1cm5GaWVsZFNlbGVjdG9yOiAncHJvamVjdGlvbidcbn07XG4vKiogRXh0cmFjdCB0aGUgYWN0dWFsIGNvbW1hbmQgZnJvbSB0aGUgcXVlcnksIHBvc3NpYmx5IHVwLWNvbnZlcnRpbmcgaWYgaXQncyBhIGxlZ2FjeSBmb3JtYXQgKi9cbmZ1bmN0aW9uIGV4dHJhY3RDb21tYW5kKGNvbW1hbmQpIHtcbiAgICBpZiAoY29tbWFuZCBpbnN0YW5jZW9mIGNvbW1hbmRzXzEuT3BNc2dSZXF1ZXN0KSB7XG4gICAgICAgIGNvbnN0IGNtZCA9IHsgLi4uY29tbWFuZC5jb21tYW5kIH07XG4gICAgICAgIC8vIEZvciBPUF9NU0cgd2l0aCBwYXlsb2FkIHR5cGUgMSB3ZSBuZWVkIHRvIHB1bGwgdGhlIGRvY3VtZW50c1xuICAgICAgICAvLyBhcnJheSBvdXQgb2YgdGhlIGRvY3VtZW50IHNlcXVlbmNlIGZvciBtb25pdG9yaW5nLlxuICAgICAgICBpZiAoY21kLm9wcyBpbnN0YW5jZW9mIGNvbW1hbmRzXzEuRG9jdW1lbnRTZXF1ZW5jZSkge1xuICAgICAgICAgICAgY21kLm9wcyA9IGNtZC5vcHMuZG9jdW1lbnRzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbWQubnNJbmZvIGluc3RhbmNlb2YgY29tbWFuZHNfMS5Eb2N1bWVudFNlcXVlbmNlKSB7XG4gICAgICAgICAgICBjbWQubnNJbmZvID0gY21kLm5zSW5mby5kb2N1bWVudHM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNtZDtcbiAgICB9XG4gICAgaWYgKGNvbW1hbmQucXVlcnk/LiRxdWVyeSkge1xuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICBpZiAoY29tbWFuZC5ucyA9PT0gJ2FkbWluLiRjbWQnKSB7XG4gICAgICAgICAgICAvLyB1cC1jb252ZXJ0IGxlZ2FjeSBjb21tYW5kXG4gICAgICAgICAgICByZXN1bHQgPSBPYmplY3QuYXNzaWduKHt9LCBjb21tYW5kLnF1ZXJ5LiRxdWVyeSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyB1cC1jb252ZXJ0IGxlZ2FjeSBmaW5kIGNvbW1hbmRcbiAgICAgICAgICAgIHJlc3VsdCA9IHsgZmluZDogY29sbGVjdGlvbk5hbWUoY29tbWFuZCkgfTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKExFR0FDWV9GSU5EX1FVRVJZX01BUCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb21tYW5kLnF1ZXJ5W2tleV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbTEVHQUNZX0ZJTkRfUVVFUllfTUFQW2tleV1dID0geyAuLi5jb21tYW5kLnF1ZXJ5W2tleV0gfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3Qua2V5cyhMRUdBQ1lfRklORF9PUFRJT05TX01BUCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGVnYWN5S2V5ID0ga2V5O1xuICAgICAgICAgICAgaWYgKGNvbW1hbmRbbGVnYWN5S2V5XSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0W0xFR0FDWV9GSU5EX09QVElPTlNfTUFQW2xlZ2FjeUtleV1dID0gY29tbWFuZFtsZWdhY3lLZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgbGV0IGNsb25lZFF1ZXJ5ID0ge307XG4gICAgY29uc3QgY2xvbmVkQ29tbWFuZCA9IHsgLi4uY29tbWFuZCB9O1xuICAgIGlmIChjb21tYW5kLnF1ZXJ5KSB7XG4gICAgICAgIGNsb25lZFF1ZXJ5ID0geyAuLi5jb21tYW5kLnF1ZXJ5IH07XG4gICAgICAgIGNsb25lZENvbW1hbmQucXVlcnkgPSBjbG9uZWRRdWVyeTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbW1hbmQucXVlcnkgPyBjbG9uZWRRdWVyeSA6IGNsb25lZENvbW1hbmQ7XG59XG5mdW5jdGlvbiBleHRyYWN0UmVwbHkocmVwbHkpIHtcbiAgICBpZiAoIXJlcGx5KSB7XG4gICAgICAgIHJldHVybiByZXBseTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcGx5LnJlc3VsdCA/IHJlcGx5LnJlc3VsdCA6IHJlcGx5O1xufVxuZnVuY3Rpb24gZXh0cmFjdENvbm5lY3Rpb25EZXRhaWxzKGNvbm5lY3Rpb24pIHtcbiAgICBsZXQgY29ubmVjdGlvbklkO1xuICAgIGlmICgnaWQnIGluIGNvbm5lY3Rpb24pIHtcbiAgICAgICAgY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWRkcmVzczogY29ubmVjdGlvbi5hZGRyZXNzLFxuICAgICAgICBzZXJ2aWNlSWQ6IGNvbm5lY3Rpb24uc2VydmljZUlkLFxuICAgICAgICBjb25uZWN0aW9uSWRcbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbWFuZF9tb25pdG9yaW5nX2V2ZW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/command_monitoring_events.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OpCompressedRequest = exports.OpMsgResponse = exports.OpMsgRequest = exports.DocumentSequence = exports.OpReply = exports.OpQueryRequest = void 0;\nconst BSON = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst compression_1 = __webpack_require__(/*! ./wire_protocol/compression */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nconst constants_1 = __webpack_require__(/*! ./wire_protocol/constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\n// Incrementing request id\nlet _requestId = 0;\n// Query flags\nconst OPTS_TAILABLE_CURSOR = 2;\nconst OPTS_SECONDARY = 4;\nconst OPTS_OPLOG_REPLAY = 8;\nconst OPTS_NO_CURSOR_TIMEOUT = 16;\nconst OPTS_AWAIT_DATA = 32;\nconst OPTS_EXHAUST = 64;\nconst OPTS_PARTIAL = 128;\n// Response flags\nconst CURSOR_NOT_FOUND = 1;\nconst QUERY_FAILURE = 2;\nconst SHARD_CONFIG_STALE = 4;\nconst AWAIT_CAPABLE = 8;\nconst encodeUTF8Into = BSON.BSON.onDemand.ByteUtils.encodeUTF8Into;\n/** @internal */\nclass OpQueryRequest {\n    constructor(databaseName, query, options) {\n        this.databaseName = databaseName;\n        this.query = query;\n        /** moreToCome is an OP_MSG only concept */\n        this.moreToCome = false;\n        // Basic options needed to be passed in\n        // TODO(NODE-3483): Replace with MongoCommandError\n        const ns = `${databaseName}.$cmd`;\n        if (typeof databaseName !== 'string') {\n            throw new error_1.MongoRuntimeError('Database name must be a string for a query');\n        }\n        // TODO(NODE-3483): Replace with MongoCommandError\n        if (query == null)\n            throw new error_1.MongoRuntimeError('A query document must be specified for query');\n        // Validate that we are not passing 0x00 in the collection name\n        if (ns.indexOf('\\x00') !== -1) {\n            // TODO(NODE-3483): Use MongoNamespace static method\n            throw new error_1.MongoRuntimeError('Namespace cannot contain a null character');\n        }\n        // Basic options\n        this.ns = ns;\n        // Additional options\n        this.numberToSkip = options.numberToSkip || 0;\n        this.numberToReturn = options.numberToReturn || 0;\n        this.returnFieldSelector = options.returnFieldSelector || undefined;\n        this.requestId = options.requestId ?? OpQueryRequest.getRequestId();\n        // special case for pre-3.2 find commands, delete ASAP\n        this.pre32Limit = options.pre32Limit;\n        // Serialization option\n        this.serializeFunctions =\n            typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n        this.ignoreUndefined =\n            typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n        this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n        this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n        this.batchSize = this.numberToReturn;\n        // Flags\n        this.tailable = false;\n        this.secondaryOk = typeof options.secondaryOk === 'boolean' ? options.secondaryOk : false;\n        this.oplogReplay = false;\n        this.noCursorTimeout = false;\n        this.awaitData = false;\n        this.exhaust = false;\n        this.partial = false;\n    }\n    /** Assign next request Id. */\n    incRequestId() {\n        this.requestId = _requestId++;\n    }\n    /** Peek next request Id. */\n    nextRequestId() {\n        return _requestId + 1;\n    }\n    /** Increment then return next request Id. */\n    static getRequestId() {\n        return ++_requestId;\n    }\n    // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n    toBin() {\n        const buffers = [];\n        let projection = null;\n        // Set up the flags\n        let flags = 0;\n        if (this.tailable) {\n            flags |= OPTS_TAILABLE_CURSOR;\n        }\n        if (this.secondaryOk) {\n            flags |= OPTS_SECONDARY;\n        }\n        if (this.oplogReplay) {\n            flags |= OPTS_OPLOG_REPLAY;\n        }\n        if (this.noCursorTimeout) {\n            flags |= OPTS_NO_CURSOR_TIMEOUT;\n        }\n        if (this.awaitData) {\n            flags |= OPTS_AWAIT_DATA;\n        }\n        if (this.exhaust) {\n            flags |= OPTS_EXHAUST;\n        }\n        if (this.partial) {\n            flags |= OPTS_PARTIAL;\n        }\n        // If batchSize is different to this.numberToReturn\n        if (this.batchSize !== this.numberToReturn)\n            this.numberToReturn = this.batchSize;\n        // Allocate write protocol header buffer\n        const header = Buffer.alloc(4 * 4 + // Header\n            4 + // Flags\n            Buffer.byteLength(this.ns) +\n            1 + // namespace\n            4 + // numberToSkip\n            4 // numberToReturn\n        );\n        // Add header to buffers\n        buffers.push(header);\n        // Serialize the query\n        const query = BSON.serialize(this.query, {\n            checkKeys: this.checkKeys,\n            serializeFunctions: this.serializeFunctions,\n            ignoreUndefined: this.ignoreUndefined\n        });\n        // Add query document\n        buffers.push(query);\n        if (this.returnFieldSelector && Object.keys(this.returnFieldSelector).length > 0) {\n            // Serialize the projection document\n            projection = BSON.serialize(this.returnFieldSelector, {\n                checkKeys: this.checkKeys,\n                serializeFunctions: this.serializeFunctions,\n                ignoreUndefined: this.ignoreUndefined\n            });\n            // Add projection document\n            buffers.push(projection);\n        }\n        // Total message size\n        const totalLength = header.length + query.length + (projection ? projection.length : 0);\n        // Set up the index\n        let index = 4;\n        // Write total document length\n        header[3] = (totalLength >> 24) & 0xff;\n        header[2] = (totalLength >> 16) & 0xff;\n        header[1] = (totalLength >> 8) & 0xff;\n        header[0] = totalLength & 0xff;\n        // Write header information requestId\n        header[index + 3] = (this.requestId >> 24) & 0xff;\n        header[index + 2] = (this.requestId >> 16) & 0xff;\n        header[index + 1] = (this.requestId >> 8) & 0xff;\n        header[index] = this.requestId & 0xff;\n        index = index + 4;\n        // Write header information responseTo\n        header[index + 3] = (0 >> 24) & 0xff;\n        header[index + 2] = (0 >> 16) & 0xff;\n        header[index + 1] = (0 >> 8) & 0xff;\n        header[index] = 0 & 0xff;\n        index = index + 4;\n        // Write header information OP_QUERY\n        header[index + 3] = (constants_1.OP_QUERY >> 24) & 0xff;\n        header[index + 2] = (constants_1.OP_QUERY >> 16) & 0xff;\n        header[index + 1] = (constants_1.OP_QUERY >> 8) & 0xff;\n        header[index] = constants_1.OP_QUERY & 0xff;\n        index = index + 4;\n        // Write header information flags\n        header[index + 3] = (flags >> 24) & 0xff;\n        header[index + 2] = (flags >> 16) & 0xff;\n        header[index + 1] = (flags >> 8) & 0xff;\n        header[index] = flags & 0xff;\n        index = index + 4;\n        // Write collection name\n        index = index + header.write(this.ns, index, 'utf8') + 1;\n        header[index - 1] = 0;\n        // Write header information flags numberToSkip\n        header[index + 3] = (this.numberToSkip >> 24) & 0xff;\n        header[index + 2] = (this.numberToSkip >> 16) & 0xff;\n        header[index + 1] = (this.numberToSkip >> 8) & 0xff;\n        header[index] = this.numberToSkip & 0xff;\n        index = index + 4;\n        // Write header information flags numberToReturn\n        header[index + 3] = (this.numberToReturn >> 24) & 0xff;\n        header[index + 2] = (this.numberToReturn >> 16) & 0xff;\n        header[index + 1] = (this.numberToReturn >> 8) & 0xff;\n        header[index] = this.numberToReturn & 0xff;\n        index = index + 4;\n        // Return the buffers\n        return buffers;\n    }\n}\nexports.OpQueryRequest = OpQueryRequest;\n/** @internal */\nclass OpReply {\n    constructor(message, msgHeader, msgBody, opts) {\n        this.index = 0;\n        this.sections = [];\n        /** moreToCome is an OP_MSG only concept */\n        this.moreToCome = false;\n        this.parsed = false;\n        this.raw = message;\n        this.data = msgBody;\n        this.opts = opts ?? {\n            useBigInt64: false,\n            promoteLongs: true,\n            promoteValues: true,\n            promoteBuffers: false,\n            bsonRegExp: false\n        };\n        // Read the message header\n        this.length = msgHeader.length;\n        this.requestId = msgHeader.requestId;\n        this.responseTo = msgHeader.responseTo;\n        this.opCode = msgHeader.opCode;\n        this.fromCompressed = msgHeader.fromCompressed;\n        // Flag values\n        this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\n        this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n        this.promoteValues =\n            typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n        this.promoteBuffers =\n            typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n        this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n    }\n    isParsed() {\n        return this.parsed;\n    }\n    parse() {\n        // Don't parse again if not needed\n        if (this.parsed)\n            return this.sections[0];\n        // Position within OP_REPLY at which documents start\n        // (See https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/#wire-op-reply)\n        this.index = 20;\n        // Read the message body\n        this.responseFlags = this.data.readInt32LE(0);\n        this.cursorId = new BSON.Long(this.data.readInt32LE(4), this.data.readInt32LE(8));\n        this.startingFrom = this.data.readInt32LE(12);\n        this.numberReturned = this.data.readInt32LE(16);\n        if (this.numberReturned < 0 || this.numberReturned > 2 ** 32 - 1) {\n            throw new RangeError(`OP_REPLY numberReturned is an invalid array length ${this.numberReturned}`);\n        }\n        this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) !== 0;\n        this.queryFailure = (this.responseFlags & QUERY_FAILURE) !== 0;\n        this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) !== 0;\n        this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) !== 0;\n        // Parse Body\n        for (let i = 0; i < this.numberReturned; i++) {\n            const bsonSize = this.data[this.index] |\n                (this.data[this.index + 1] << 8) |\n                (this.data[this.index + 2] << 16) |\n                (this.data[this.index + 3] << 24);\n            const section = this.data.subarray(this.index, this.index + bsonSize);\n            this.sections.push(section);\n            // Adjust the index\n            this.index = this.index + bsonSize;\n        }\n        // Set parsed\n        this.parsed = true;\n        return this.sections[0];\n    }\n}\nexports.OpReply = OpReply;\n// Msg Flags\nconst OPTS_CHECKSUM_PRESENT = 1;\nconst OPTS_MORE_TO_COME = 2;\nconst OPTS_EXHAUST_ALLOWED = 1 << 16;\n/** @internal */\nclass DocumentSequence {\n    /**\n     * Create a new document sequence for the provided field.\n     * @param field - The field it will replace.\n     */\n    constructor(field, documents) {\n        this.field = field;\n        this.documents = [];\n        this.chunks = [];\n        this.serializedDocumentsLength = 0;\n        // Document sequences starts with type 1 at the first byte.\n        // Field strings must always be UTF-8.\n        const buffer = Buffer.allocUnsafe(1 + 4 + this.field.length + 1);\n        buffer[0] = 1;\n        // Third part is the field name at offset 5 with trailing null byte.\n        encodeUTF8Into(buffer, `${this.field}\\0`, 5);\n        this.chunks.push(buffer);\n        this.header = buffer;\n        if (documents) {\n            for (const doc of documents) {\n                this.push(doc, BSON.serialize(doc));\n            }\n        }\n    }\n    /**\n     * Push a document to the document sequence. Will serialize the document\n     * as well and return the current serialized length of all documents.\n     * @param document - The document to add.\n     * @param buffer - The serialized document in raw BSON.\n     * @returns The new total document sequence length.\n     */\n    push(document, buffer) {\n        this.serializedDocumentsLength += buffer.length;\n        // Push the document.\n        this.documents.push(document);\n        // Push the document raw bson.\n        this.chunks.push(buffer);\n        // Write the new length.\n        this.header?.writeInt32LE(4 + this.field.length + 1 + this.serializedDocumentsLength, 1);\n        return this.serializedDocumentsLength + this.header.length;\n    }\n    /**\n     * Get the fully serialized bytes for the document sequence section.\n     * @returns The section bytes.\n     */\n    toBin() {\n        return Buffer.concat(this.chunks);\n    }\n}\nexports.DocumentSequence = DocumentSequence;\n/** @internal */\nclass OpMsgRequest {\n    constructor(databaseName, command, options) {\n        this.databaseName = databaseName;\n        this.command = command;\n        this.options = options;\n        // Basic options needed to be passed in\n        if (command == null)\n            throw new error_1.MongoInvalidArgumentError('Query document must be specified for query');\n        // Basic options\n        this.command.$db = databaseName;\n        // Ensure empty options\n        this.options = options ?? {};\n        // Additional options\n        this.requestId = options.requestId ? options.requestId : OpMsgRequest.getRequestId();\n        // Serialization option\n        this.serializeFunctions =\n            typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n        this.ignoreUndefined =\n            typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n        this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n        this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n        // flags\n        this.checksumPresent = false;\n        this.moreToCome = options.moreToCome ?? command.writeConcern?.w === 0;\n        this.exhaustAllowed =\n            typeof options.exhaustAllowed === 'boolean' ? options.exhaustAllowed : false;\n    }\n    toBin() {\n        const buffers = [];\n        let flags = 0;\n        if (this.checksumPresent) {\n            flags |= OPTS_CHECKSUM_PRESENT;\n        }\n        if (this.moreToCome) {\n            flags |= OPTS_MORE_TO_COME;\n        }\n        if (this.exhaustAllowed) {\n            flags |= OPTS_EXHAUST_ALLOWED;\n        }\n        const header = Buffer.alloc(4 * 4 + // Header\n            4 // Flags\n        );\n        buffers.push(header);\n        let totalLength = header.length;\n        const command = this.command;\n        totalLength += this.makeSections(buffers, command);\n        header.writeInt32LE(totalLength, 0); // messageLength\n        header.writeInt32LE(this.requestId, 4); // requestID\n        header.writeInt32LE(0, 8); // responseTo\n        header.writeInt32LE(constants_1.OP_MSG, 12); // opCode\n        header.writeUInt32LE(flags, 16); // flags\n        return buffers;\n    }\n    /**\n     * Add the sections to the OP_MSG request's buffers and returns the length.\n     */\n    makeSections(buffers, document) {\n        const sequencesBuffer = this.extractDocumentSequences(document);\n        const payloadTypeBuffer = Buffer.allocUnsafe(1);\n        payloadTypeBuffer[0] = 0;\n        const documentBuffer = this.serializeBson(document);\n        // First section, type 0\n        buffers.push(payloadTypeBuffer);\n        buffers.push(documentBuffer);\n        // Subsequent sections, type 1\n        buffers.push(sequencesBuffer);\n        return payloadTypeBuffer.length + documentBuffer.length + sequencesBuffer.length;\n    }\n    /**\n     * Extracts the document sequences from the command document and returns\n     * a buffer to be added as multiple sections after the initial type 0\n     * section in the message.\n     */\n    extractDocumentSequences(document) {\n        // Pull out any field in the command document that's value is a document sequence.\n        const chunks = [];\n        for (const [key, value] of Object.entries(document)) {\n            if (value instanceof DocumentSequence) {\n                chunks.push(value.toBin());\n                // Why are we removing the field from the command? This is because it needs to be\n                // removed in the OP_MSG request first section, and DocumentSequence is not a\n                // BSON type and is specific to the MongoDB wire protocol so there's nothing\n                // our BSON serializer can do about this. Since DocumentSequence is not exposed\n                // in the public API and only used internally, we are never mutating an original\n                // command provided by the user, just our own, and it's cheaper to delete from\n                // our own command than copying it.\n                delete document[key];\n            }\n        }\n        if (chunks.length > 0) {\n            return Buffer.concat(chunks);\n        }\n        // If we have no document sequences we return an empty buffer for nothing to add\n        // to the payload.\n        return Buffer.alloc(0);\n    }\n    serializeBson(document) {\n        return BSON.serialize(document, {\n            checkKeys: this.checkKeys,\n            serializeFunctions: this.serializeFunctions,\n            ignoreUndefined: this.ignoreUndefined\n        });\n    }\n    static getRequestId() {\n        _requestId = (_requestId + 1) & 0x7fffffff;\n        return _requestId;\n    }\n}\nexports.OpMsgRequest = OpMsgRequest;\n/** @internal */\nclass OpMsgResponse {\n    constructor(message, msgHeader, msgBody, opts) {\n        this.index = 0;\n        this.sections = [];\n        this.parsed = false;\n        this.raw = message;\n        this.data = msgBody;\n        this.opts = opts ?? {\n            useBigInt64: false,\n            promoteLongs: true,\n            promoteValues: true,\n            promoteBuffers: false,\n            bsonRegExp: false\n        };\n        // Read the message header\n        this.length = msgHeader.length;\n        this.requestId = msgHeader.requestId;\n        this.responseTo = msgHeader.responseTo;\n        this.opCode = msgHeader.opCode;\n        this.fromCompressed = msgHeader.fromCompressed;\n        // Read response flags\n        this.responseFlags = msgBody.readInt32LE(0);\n        this.checksumPresent = (this.responseFlags & OPTS_CHECKSUM_PRESENT) !== 0;\n        this.moreToCome = (this.responseFlags & OPTS_MORE_TO_COME) !== 0;\n        this.exhaustAllowed = (this.responseFlags & OPTS_EXHAUST_ALLOWED) !== 0;\n        this.useBigInt64 = typeof this.opts.useBigInt64 === 'boolean' ? this.opts.useBigInt64 : false;\n        this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n        this.promoteValues =\n            typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n        this.promoteBuffers =\n            typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n        this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n    }\n    isParsed() {\n        return this.parsed;\n    }\n    parse() {\n        // Don't parse again if not needed\n        if (this.parsed)\n            return this.sections[0];\n        this.index = 4;\n        while (this.index < this.data.length) {\n            const payloadType = this.data.readUInt8(this.index++);\n            if (payloadType === 0) {\n                const bsonSize = this.data.readUInt32LE(this.index);\n                const bin = this.data.subarray(this.index, this.index + bsonSize);\n                this.sections.push(bin);\n                this.index += bsonSize;\n            }\n            else if (payloadType === 1) {\n                // It was decided that no driver makes use of payload type 1\n                // TODO(NODE-3483): Replace with MongoDeprecationError\n                throw new error_1.MongoRuntimeError('OP_MSG Payload Type 1 detected unsupported protocol');\n            }\n        }\n        this.parsed = true;\n        return this.sections[0];\n    }\n}\nexports.OpMsgResponse = OpMsgResponse;\nconst MESSAGE_HEADER_SIZE = 16;\nconst COMPRESSION_DETAILS_SIZE = 9; // originalOpcode + uncompressedSize, compressorID\n/**\n * @internal\n *\n * An OP_COMPRESSED request wraps either an OP_QUERY or OP_MSG message.\n */\nclass OpCompressedRequest {\n    constructor(command, options) {\n        this.command = command;\n        this.options = options;\n    }\n    // Return whether a command contains an uncompressible command term\n    // Will return true if command contains no uncompressible command terms\n    static canCompress(command) {\n        const commandDoc = command instanceof OpMsgRequest ? command.command : command.query;\n        const commandName = Object.keys(commandDoc)[0];\n        return !compression_1.uncompressibleCommands.has(commandName);\n    }\n    async toBin() {\n        const concatenatedOriginalCommandBuffer = Buffer.concat(this.command.toBin());\n        // otherwise, compress the message\n        const messageToBeCompressed = concatenatedOriginalCommandBuffer.slice(MESSAGE_HEADER_SIZE);\n        // Extract information needed for OP_COMPRESSED from the uncompressed message\n        const originalCommandOpCode = concatenatedOriginalCommandBuffer.readInt32LE(12);\n        // Compress the message body\n        const compressedMessage = await (0, compression_1.compress)(this.options, messageToBeCompressed);\n        // Create the msgHeader of OP_COMPRESSED\n        const msgHeader = Buffer.alloc(MESSAGE_HEADER_SIZE);\n        msgHeader.writeInt32LE(MESSAGE_HEADER_SIZE + COMPRESSION_DETAILS_SIZE + compressedMessage.length, 0); // messageLength\n        msgHeader.writeInt32LE(this.command.requestId, 4); // requestID\n        msgHeader.writeInt32LE(0, 8); // responseTo (zero)\n        msgHeader.writeInt32LE(constants_1.OP_COMPRESSED, 12); // opCode\n        // Create the compression details of OP_COMPRESSED\n        const compressionDetails = Buffer.alloc(COMPRESSION_DETAILS_SIZE);\n        compressionDetails.writeInt32LE(originalCommandOpCode, 0); // originalOpcode\n        compressionDetails.writeInt32LE(messageToBeCompressed.length, 4); // Size of the uncompressed compressedMessage, excluding the MsgHeader\n        compressionDetails.writeUInt8(compression_1.Compressor[this.options.agreedCompressor], 8); // compressorID\n        return [msgHeader, compressionDetails, compressedMessage];\n    }\n}\nexports.OpCompressedRequest = OpCompressedRequest;\n//# sourceMappingURL=commands.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29tbWFuZHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMkJBQTJCLEdBQUcscUJBQXFCLEdBQUcsb0JBQW9CLEdBQUcsd0JBQXdCLEdBQUcsZUFBZSxHQUFHLHNCQUFzQjtBQUNoSixhQUFhLG1CQUFPLENBQUMsMkZBQVM7QUFDOUIsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsc0JBQXNCLG1CQUFPLENBQUMseUlBQTZCO0FBQzNELG9CQUFvQixtQkFBTyxDQUFDLHFJQUEyQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixhQUFhO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUZBQXVGLG9CQUFvQjtBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUJBQXlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxXQUFXO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDLGdEQUFnRDtBQUNoRCxtQ0FBbUM7QUFDbkMscURBQXFEO0FBQ3JELHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEdBQThHO0FBQzlHLDJEQUEyRDtBQUMzRCxzQ0FBc0M7QUFDdEMsK0RBQStEO0FBQy9EO0FBQ0E7QUFDQSxtRUFBbUU7QUFDbkUsMEVBQTBFO0FBQzFFLG1HQUFtRztBQUNuRztBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2NvbW1hbmRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PcENvbXByZXNzZWRSZXF1ZXN0ID0gZXhwb3J0cy5PcE1zZ1Jlc3BvbnNlID0gZXhwb3J0cy5PcE1zZ1JlcXVlc3QgPSBleHBvcnRzLkRvY3VtZW50U2VxdWVuY2UgPSBleHBvcnRzLk9wUmVwbHkgPSBleHBvcnRzLk9wUXVlcnlSZXF1ZXN0ID0gdm9pZCAwO1xuY29uc3QgQlNPTiA9IHJlcXVpcmUoXCIuLi9ic29uXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGNvbXByZXNzaW9uXzEgPSByZXF1aXJlKFwiLi93aXJlX3Byb3RvY29sL2NvbXByZXNzaW9uXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi93aXJlX3Byb3RvY29sL2NvbnN0YW50c1wiKTtcbi8vIEluY3JlbWVudGluZyByZXF1ZXN0IGlkXG5sZXQgX3JlcXVlc3RJZCA9IDA7XG4vLyBRdWVyeSBmbGFnc1xuY29uc3QgT1BUU19UQUlMQUJMRV9DVVJTT1IgPSAyO1xuY29uc3QgT1BUU19TRUNPTkRBUlkgPSA0O1xuY29uc3QgT1BUU19PUExPR19SRVBMQVkgPSA4O1xuY29uc3QgT1BUU19OT19DVVJTT1JfVElNRU9VVCA9IDE2O1xuY29uc3QgT1BUU19BV0FJVF9EQVRBID0gMzI7XG5jb25zdCBPUFRTX0VYSEFVU1QgPSA2NDtcbmNvbnN0IE9QVFNfUEFSVElBTCA9IDEyODtcbi8vIFJlc3BvbnNlIGZsYWdzXG5jb25zdCBDVVJTT1JfTk9UX0ZPVU5EID0gMTtcbmNvbnN0IFFVRVJZX0ZBSUxVUkUgPSAyO1xuY29uc3QgU0hBUkRfQ09ORklHX1NUQUxFID0gNDtcbmNvbnN0IEFXQUlUX0NBUEFCTEUgPSA4O1xuY29uc3QgZW5jb2RlVVRGOEludG8gPSBCU09OLkJTT04ub25EZW1hbmQuQnl0ZVV0aWxzLmVuY29kZVVURjhJbnRvO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgT3BRdWVyeVJlcXVlc3Qge1xuICAgIGNvbnN0cnVjdG9yKGRhdGFiYXNlTmFtZSwgcXVlcnksIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZU5hbWUgPSBkYXRhYmFzZU5hbWU7XG4gICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTtcbiAgICAgICAgLyoqIG1vcmVUb0NvbWUgaXMgYW4gT1BfTVNHIG9ubHkgY29uY2VwdCAqL1xuICAgICAgICB0aGlzLm1vcmVUb0NvbWUgPSBmYWxzZTtcbiAgICAgICAgLy8gQmFzaWMgb3B0aW9ucyBuZWVkZWQgdG8gYmUgcGFzc2VkIGluXG4gICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKTogUmVwbGFjZSB3aXRoIE1vbmdvQ29tbWFuZEVycm9yXG4gICAgICAgIGNvbnN0IG5zID0gYCR7ZGF0YWJhc2VOYW1lfS4kY21kYDtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhYmFzZU5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignRGF0YWJhc2UgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIGZvciBhIHF1ZXJ5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBSZXBsYWNlIHdpdGggTW9uZ29Db21tYW5kRXJyb3JcbiAgICAgICAgaWYgKHF1ZXJ5ID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignQSBxdWVyeSBkb2N1bWVudCBtdXN0IGJlIHNwZWNpZmllZCBmb3IgcXVlcnknKTtcbiAgICAgICAgLy8gVmFsaWRhdGUgdGhhdCB3ZSBhcmUgbm90IHBhc3NpbmcgMHgwMCBpbiB0aGUgY29sbGVjdGlvbiBuYW1lXG4gICAgICAgIGlmIChucy5pbmRleE9mKCdcXHgwMCcpICE9PSAtMSkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBVc2UgTW9uZ29OYW1lc3BhY2Ugc3RhdGljIG1ldGhvZFxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ05hbWVzcGFjZSBjYW5ub3QgY29udGFpbiBhIG51bGwgY2hhcmFjdGVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQmFzaWMgb3B0aW9uc1xuICAgICAgICB0aGlzLm5zID0gbnM7XG4gICAgICAgIC8vIEFkZGl0aW9uYWwgb3B0aW9uc1xuICAgICAgICB0aGlzLm51bWJlclRvU2tpcCA9IG9wdGlvbnMubnVtYmVyVG9Ta2lwIHx8IDA7XG4gICAgICAgIHRoaXMubnVtYmVyVG9SZXR1cm4gPSBvcHRpb25zLm51bWJlclRvUmV0dXJuIHx8IDA7XG4gICAgICAgIHRoaXMucmV0dXJuRmllbGRTZWxlY3RvciA9IG9wdGlvbnMucmV0dXJuRmllbGRTZWxlY3RvciB8fCB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gb3B0aW9ucy5yZXF1ZXN0SWQgPz8gT3BRdWVyeVJlcXVlc3QuZ2V0UmVxdWVzdElkKCk7XG4gICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgcHJlLTMuMiBmaW5kIGNvbW1hbmRzLCBkZWxldGUgQVNBUFxuICAgICAgICB0aGlzLnByZTMyTGltaXQgPSBvcHRpb25zLnByZTMyTGltaXQ7XG4gICAgICAgIC8vIFNlcmlhbGl6YXRpb24gb3B0aW9uXG4gICAgICAgIHRoaXMuc2VyaWFsaXplRnVuY3Rpb25zID1cbiAgICAgICAgICAgIHR5cGVvZiBvcHRpb25zLnNlcmlhbGl6ZUZ1bmN0aW9ucyA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5zZXJpYWxpemVGdW5jdGlvbnMgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5pZ25vcmVVbmRlZmluZWQgPVxuICAgICAgICAgICAgdHlwZW9mIG9wdGlvbnMuaWdub3JlVW5kZWZpbmVkID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmlnbm9yZVVuZGVmaW5lZCA6IGZhbHNlO1xuICAgICAgICB0aGlzLm1heEJzb25TaXplID0gb3B0aW9ucy5tYXhCc29uU2l6ZSB8fCAxMDI0ICogMTAyNCAqIDE2O1xuICAgICAgICB0aGlzLmNoZWNrS2V5cyA9IHR5cGVvZiBvcHRpb25zLmNoZWNrS2V5cyA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5jaGVja0tleXMgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5iYXRjaFNpemUgPSB0aGlzLm51bWJlclRvUmV0dXJuO1xuICAgICAgICAvLyBGbGFnc1xuICAgICAgICB0aGlzLnRhaWxhYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5T2sgPSB0eXBlb2Ygb3B0aW9ucy5zZWNvbmRhcnlPayA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5zZWNvbmRhcnlPayA6IGZhbHNlO1xuICAgICAgICB0aGlzLm9wbG9nUmVwbGF5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMubm9DdXJzb3JUaW1lb3V0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXdhaXREYXRhID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXhoYXVzdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBhcnRpYWwgPSBmYWxzZTtcbiAgICB9XG4gICAgLyoqIEFzc2lnbiBuZXh0IHJlcXVlc3QgSWQuICovXG4gICAgaW5jUmVxdWVzdElkKCkge1xuICAgICAgICB0aGlzLnJlcXVlc3RJZCA9IF9yZXF1ZXN0SWQrKztcbiAgICB9XG4gICAgLyoqIFBlZWsgbmV4dCByZXF1ZXN0IElkLiAqL1xuICAgIG5leHRSZXF1ZXN0SWQoKSB7XG4gICAgICAgIHJldHVybiBfcmVxdWVzdElkICsgMTtcbiAgICB9XG4gICAgLyoqIEluY3JlbWVudCB0aGVuIHJldHVybiBuZXh0IHJlcXVlc3QgSWQuICovXG4gICAgc3RhdGljIGdldFJlcXVlc3RJZCgpIHtcbiAgICAgICAgcmV0dXJuICsrX3JlcXVlc3RJZDtcbiAgICB9XG4gICAgLy8gVXNlcyBhIHNpbmdsZSBhbGxvY2F0ZWQgYnVmZmVyIGZvciB0aGUgcHJvY2VzcywgYXZvaWRpbmcgbXVsdGlwbGUgbWVtb3J5IGFsbG9jYXRpb25zXG4gICAgdG9CaW4oKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSBbXTtcbiAgICAgICAgbGV0IHByb2plY3Rpb24gPSBudWxsO1xuICAgICAgICAvLyBTZXQgdXAgdGhlIGZsYWdzXG4gICAgICAgIGxldCBmbGFncyA9IDA7XG4gICAgICAgIGlmICh0aGlzLnRhaWxhYmxlKSB7XG4gICAgICAgICAgICBmbGFncyB8PSBPUFRTX1RBSUxBQkxFX0NVUlNPUjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZWNvbmRhcnlPaykge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19TRUNPTkRBUlk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3Bsb2dSZXBsYXkpIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfT1BMT0dfUkVQTEFZO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5vQ3Vyc29yVGltZW91dCkge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19OT19DVVJTT1JfVElNRU9VVDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hd2FpdERhdGEpIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfQVdBSVRfREFUQTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5leGhhdXN0KSB7XG4gICAgICAgICAgICBmbGFncyB8PSBPUFRTX0VYSEFVU1Q7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGFydGlhbCkge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19QQVJUSUFMO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIGJhdGNoU2l6ZSBpcyBkaWZmZXJlbnQgdG8gdGhpcy5udW1iZXJUb1JldHVyblxuICAgICAgICBpZiAodGhpcy5iYXRjaFNpemUgIT09IHRoaXMubnVtYmVyVG9SZXR1cm4pXG4gICAgICAgICAgICB0aGlzLm51bWJlclRvUmV0dXJuID0gdGhpcy5iYXRjaFNpemU7XG4gICAgICAgIC8vIEFsbG9jYXRlIHdyaXRlIHByb3RvY29sIGhlYWRlciBidWZmZXJcbiAgICAgICAgY29uc3QgaGVhZGVyID0gQnVmZmVyLmFsbG9jKDQgKiA0ICsgLy8gSGVhZGVyXG4gICAgICAgICAgICA0ICsgLy8gRmxhZ3NcbiAgICAgICAgICAgIEJ1ZmZlci5ieXRlTGVuZ3RoKHRoaXMubnMpICtcbiAgICAgICAgICAgIDEgKyAvLyBuYW1lc3BhY2VcbiAgICAgICAgICAgIDQgKyAvLyBudW1iZXJUb1NraXBcbiAgICAgICAgICAgIDQgLy8gbnVtYmVyVG9SZXR1cm5cbiAgICAgICAgKTtcbiAgICAgICAgLy8gQWRkIGhlYWRlciB0byBidWZmZXJzXG4gICAgICAgIGJ1ZmZlcnMucHVzaChoZWFkZXIpO1xuICAgICAgICAvLyBTZXJpYWxpemUgdGhlIHF1ZXJ5XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gQlNPTi5zZXJpYWxpemUodGhpcy5xdWVyeSwge1xuICAgICAgICAgICAgY2hlY2tLZXlzOiB0aGlzLmNoZWNrS2V5cyxcbiAgICAgICAgICAgIHNlcmlhbGl6ZUZ1bmN0aW9uczogdGhpcy5zZXJpYWxpemVGdW5jdGlvbnMsXG4gICAgICAgICAgICBpZ25vcmVVbmRlZmluZWQ6IHRoaXMuaWdub3JlVW5kZWZpbmVkXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBZGQgcXVlcnkgZG9jdW1lbnRcbiAgICAgICAgYnVmZmVycy5wdXNoKHF1ZXJ5KTtcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuRmllbGRTZWxlY3RvciAmJiBPYmplY3Qua2V5cyh0aGlzLnJldHVybkZpZWxkU2VsZWN0b3IpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSB0aGUgcHJvamVjdGlvbiBkb2N1bWVudFxuICAgICAgICAgICAgcHJvamVjdGlvbiA9IEJTT04uc2VyaWFsaXplKHRoaXMucmV0dXJuRmllbGRTZWxlY3Rvciwge1xuICAgICAgICAgICAgICAgIGNoZWNrS2V5czogdGhpcy5jaGVja0tleXMsXG4gICAgICAgICAgICAgICAgc2VyaWFsaXplRnVuY3Rpb25zOiB0aGlzLnNlcmlhbGl6ZUZ1bmN0aW9ucyxcbiAgICAgICAgICAgICAgICBpZ25vcmVVbmRlZmluZWQ6IHRoaXMuaWdub3JlVW5kZWZpbmVkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEFkZCBwcm9qZWN0aW9uIGRvY3VtZW50XG4gICAgICAgICAgICBidWZmZXJzLnB1c2gocHJvamVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVG90YWwgbWVzc2FnZSBzaXplXG4gICAgICAgIGNvbnN0IHRvdGFsTGVuZ3RoID0gaGVhZGVyLmxlbmd0aCArIHF1ZXJ5Lmxlbmd0aCArIChwcm9qZWN0aW9uID8gcHJvamVjdGlvbi5sZW5ndGggOiAwKTtcbiAgICAgICAgLy8gU2V0IHVwIHRoZSBpbmRleFxuICAgICAgICBsZXQgaW5kZXggPSA0O1xuICAgICAgICAvLyBXcml0ZSB0b3RhbCBkb2N1bWVudCBsZW5ndGhcbiAgICAgICAgaGVhZGVyWzNdID0gKHRvdGFsTGVuZ3RoID4+IDI0KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlclsyXSA9ICh0b3RhbExlbmd0aCA+PiAxNikgJiAweGZmO1xuICAgICAgICBoZWFkZXJbMV0gPSAodG90YWxMZW5ndGggPj4gOCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbMF0gPSB0b3RhbExlbmd0aCAmIDB4ZmY7XG4gICAgICAgIC8vIFdyaXRlIGhlYWRlciBpbmZvcm1hdGlvbiByZXF1ZXN0SWRcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgM10gPSAodGhpcy5yZXF1ZXN0SWQgPj4gMjQpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgMl0gPSAodGhpcy5yZXF1ZXN0SWQgPj4gMTYpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgMV0gPSAodGhpcy5yZXF1ZXN0SWQgPj4gOCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXhdID0gdGhpcy5yZXF1ZXN0SWQgJiAweGZmO1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgNDtcbiAgICAgICAgLy8gV3JpdGUgaGVhZGVyIGluZm9ybWF0aW9uIHJlc3BvbnNlVG9cbiAgICAgICAgaGVhZGVyW2luZGV4ICsgM10gPSAoMCA+PiAyNCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXggKyAyXSA9ICgwID4+IDE2KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDFdID0gKDAgPj4gOCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXhdID0gMCAmIDB4ZmY7XG4gICAgICAgIGluZGV4ID0gaW5kZXggKyA0O1xuICAgICAgICAvLyBXcml0ZSBoZWFkZXIgaW5mb3JtYXRpb24gT1BfUVVFUllcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgM10gPSAoY29uc3RhbnRzXzEuT1BfUVVFUlkgPj4gMjQpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgMl0gPSAoY29uc3RhbnRzXzEuT1BfUVVFUlkgPj4gMTYpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgMV0gPSAoY29uc3RhbnRzXzEuT1BfUVVFUlkgPj4gOCkgJiAweGZmO1xuICAgICAgICBoZWFkZXJbaW5kZXhdID0gY29uc3RhbnRzXzEuT1BfUVVFUlkgJiAweGZmO1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgNDtcbiAgICAgICAgLy8gV3JpdGUgaGVhZGVyIGluZm9ybWF0aW9uIGZsYWdzXG4gICAgICAgIGhlYWRlcltpbmRleCArIDNdID0gKGZsYWdzID4+IDI0KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDJdID0gKGZsYWdzID4+IDE2KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDFdID0gKGZsYWdzID4+IDgpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4XSA9IGZsYWdzICYgMHhmZjtcbiAgICAgICAgaW5kZXggPSBpbmRleCArIDQ7XG4gICAgICAgIC8vIFdyaXRlIGNvbGxlY3Rpb24gbmFtZVxuICAgICAgICBpbmRleCA9IGluZGV4ICsgaGVhZGVyLndyaXRlKHRoaXMubnMsIGluZGV4LCAndXRmOCcpICsgMTtcbiAgICAgICAgaGVhZGVyW2luZGV4IC0gMV0gPSAwO1xuICAgICAgICAvLyBXcml0ZSBoZWFkZXIgaW5mb3JtYXRpb24gZmxhZ3MgbnVtYmVyVG9Ta2lwXG4gICAgICAgIGhlYWRlcltpbmRleCArIDNdID0gKHRoaXMubnVtYmVyVG9Ta2lwID4+IDI0KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDJdID0gKHRoaXMubnVtYmVyVG9Ta2lwID4+IDE2KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDFdID0gKHRoaXMubnVtYmVyVG9Ta2lwID4+IDgpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4XSA9IHRoaXMubnVtYmVyVG9Ta2lwICYgMHhmZjtcbiAgICAgICAgaW5kZXggPSBpbmRleCArIDQ7XG4gICAgICAgIC8vIFdyaXRlIGhlYWRlciBpbmZvcm1hdGlvbiBmbGFncyBudW1iZXJUb1JldHVyblxuICAgICAgICBoZWFkZXJbaW5kZXggKyAzXSA9ICh0aGlzLm51bWJlclRvUmV0dXJuID4+IDI0KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleCArIDJdID0gKHRoaXMubnVtYmVyVG9SZXR1cm4gPj4gMTYpICYgMHhmZjtcbiAgICAgICAgaGVhZGVyW2luZGV4ICsgMV0gPSAodGhpcy5udW1iZXJUb1JldHVybiA+PiA4KSAmIDB4ZmY7XG4gICAgICAgIGhlYWRlcltpbmRleF0gPSB0aGlzLm51bWJlclRvUmV0dXJuICYgMHhmZjtcbiAgICAgICAgaW5kZXggPSBpbmRleCArIDQ7XG4gICAgICAgIC8vIFJldHVybiB0aGUgYnVmZmVyc1xuICAgICAgICByZXR1cm4gYnVmZmVycztcbiAgICB9XG59XG5leHBvcnRzLk9wUXVlcnlSZXF1ZXN0ID0gT3BRdWVyeVJlcXVlc3Q7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBPcFJlcGx5IHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBtc2dIZWFkZXIsIG1zZ0JvZHksIG9wdHMpIHtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgICAgIHRoaXMuc2VjdGlvbnMgPSBbXTtcbiAgICAgICAgLyoqIG1vcmVUb0NvbWUgaXMgYW4gT1BfTVNHIG9ubHkgY29uY2VwdCAqL1xuICAgICAgICB0aGlzLm1vcmVUb0NvbWUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wYXJzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yYXcgPSBtZXNzYWdlO1xuICAgICAgICB0aGlzLmRhdGEgPSBtc2dCb2R5O1xuICAgICAgICB0aGlzLm9wdHMgPSBvcHRzID8/IHtcbiAgICAgICAgICAgIHVzZUJpZ0ludDY0OiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVMb25nczogdHJ1ZSxcbiAgICAgICAgICAgIHByb21vdGVWYWx1ZXM6IHRydWUsXG4gICAgICAgICAgICBwcm9tb3RlQnVmZmVyczogZmFsc2UsXG4gICAgICAgICAgICBic29uUmVnRXhwOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICAvLyBSZWFkIHRoZSBtZXNzYWdlIGhlYWRlclxuICAgICAgICB0aGlzLmxlbmd0aCA9IG1zZ0hlYWRlci5sZW5ndGg7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gbXNnSGVhZGVyLnJlcXVlc3RJZDtcbiAgICAgICAgdGhpcy5yZXNwb25zZVRvID0gbXNnSGVhZGVyLnJlc3BvbnNlVG87XG4gICAgICAgIHRoaXMub3BDb2RlID0gbXNnSGVhZGVyLm9wQ29kZTtcbiAgICAgICAgdGhpcy5mcm9tQ29tcHJlc3NlZCA9IG1zZ0hlYWRlci5mcm9tQ29tcHJlc3NlZDtcbiAgICAgICAgLy8gRmxhZyB2YWx1ZXNcbiAgICAgICAgdGhpcy51c2VCaWdJbnQ2NCA9IHR5cGVvZiB0aGlzLm9wdHMudXNlQmlnSW50NjQgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy51c2VCaWdJbnQ2NCA6IGZhbHNlO1xuICAgICAgICB0aGlzLnByb21vdGVMb25ncyA9IHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZUxvbmdzID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdHMucHJvbW90ZUxvbmdzIDogdHJ1ZTtcbiAgICAgICAgdGhpcy5wcm9tb3RlVmFsdWVzID1cbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZVZhbHVlcyA9PT0gJ2Jvb2xlYW4nID8gdGhpcy5vcHRzLnByb21vdGVWYWx1ZXMgOiB0cnVlO1xuICAgICAgICB0aGlzLnByb21vdGVCdWZmZXJzID1cbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZUJ1ZmZlcnMgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5wcm9tb3RlQnVmZmVycyA6IGZhbHNlO1xuICAgICAgICB0aGlzLmJzb25SZWdFeHAgPSB0eXBlb2YgdGhpcy5vcHRzLmJzb25SZWdFeHAgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5ic29uUmVnRXhwIDogZmFsc2U7XG4gICAgfVxuICAgIGlzUGFyc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZWQ7XG4gICAgfVxuICAgIHBhcnNlKCkge1xuICAgICAgICAvLyBEb24ndCBwYXJzZSBhZ2FpbiBpZiBub3QgbmVlZGVkXG4gICAgICAgIGlmICh0aGlzLnBhcnNlZClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlY3Rpb25zWzBdO1xuICAgICAgICAvLyBQb3NpdGlvbiB3aXRoaW4gT1BfUkVQTFkgYXQgd2hpY2ggZG9jdW1lbnRzIHN0YXJ0XG4gICAgICAgIC8vIChTZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL21vbmdvZGItd2lyZS1wcm90b2NvbC8jd2lyZS1vcC1yZXBseSlcbiAgICAgICAgdGhpcy5pbmRleCA9IDIwO1xuICAgICAgICAvLyBSZWFkIHRoZSBtZXNzYWdlIGJvZHlcbiAgICAgICAgdGhpcy5yZXNwb25zZUZsYWdzID0gdGhpcy5kYXRhLnJlYWRJbnQzMkxFKDApO1xuICAgICAgICB0aGlzLmN1cnNvcklkID0gbmV3IEJTT04uTG9uZyh0aGlzLmRhdGEucmVhZEludDMyTEUoNCksIHRoaXMuZGF0YS5yZWFkSW50MzJMRSg4KSk7XG4gICAgICAgIHRoaXMuc3RhcnRpbmdGcm9tID0gdGhpcy5kYXRhLnJlYWRJbnQzMkxFKDEyKTtcbiAgICAgICAgdGhpcy5udW1iZXJSZXR1cm5lZCA9IHRoaXMuZGF0YS5yZWFkSW50MzJMRSgxNik7XG4gICAgICAgIGlmICh0aGlzLm51bWJlclJldHVybmVkIDwgMCB8fCB0aGlzLm51bWJlclJldHVybmVkID4gMiAqKiAzMiAtIDEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKGBPUF9SRVBMWSBudW1iZXJSZXR1cm5lZCBpcyBhbiBpbnZhbGlkIGFycmF5IGxlbmd0aCAke3RoaXMubnVtYmVyUmV0dXJuZWR9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJzb3JOb3RGb3VuZCA9ICh0aGlzLnJlc3BvbnNlRmxhZ3MgJiBDVVJTT1JfTk9UX0ZPVU5EKSAhPT0gMDtcbiAgICAgICAgdGhpcy5xdWVyeUZhaWx1cmUgPSAodGhpcy5yZXNwb25zZUZsYWdzICYgUVVFUllfRkFJTFVSRSkgIT09IDA7XG4gICAgICAgIHRoaXMuc2hhcmRDb25maWdTdGFsZSA9ICh0aGlzLnJlc3BvbnNlRmxhZ3MgJiBTSEFSRF9DT05GSUdfU1RBTEUpICE9PSAwO1xuICAgICAgICB0aGlzLmF3YWl0Q2FwYWJsZSA9ICh0aGlzLnJlc3BvbnNlRmxhZ3MgJiBBV0FJVF9DQVBBQkxFKSAhPT0gMDtcbiAgICAgICAgLy8gUGFyc2UgQm9keVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtYmVyUmV0dXJuZWQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgYnNvblNpemUgPSB0aGlzLmRhdGFbdGhpcy5pbmRleF0gfFxuICAgICAgICAgICAgICAgICh0aGlzLmRhdGFbdGhpcy5pbmRleCArIDFdIDw8IDgpIHxcbiAgICAgICAgICAgICAgICAodGhpcy5kYXRhW3RoaXMuaW5kZXggKyAyXSA8PCAxNikgfFxuICAgICAgICAgICAgICAgICh0aGlzLmRhdGFbdGhpcy5pbmRleCArIDNdIDw8IDI0KTtcbiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSB0aGlzLmRhdGEuc3ViYXJyYXkodGhpcy5pbmRleCwgdGhpcy5pbmRleCArIGJzb25TaXplKTtcbiAgICAgICAgICAgIHRoaXMuc2VjdGlvbnMucHVzaChzZWN0aW9uKTtcbiAgICAgICAgICAgIC8vIEFkanVzdCB0aGUgaW5kZXhcbiAgICAgICAgICAgIHRoaXMuaW5kZXggPSB0aGlzLmluZGV4ICsgYnNvblNpemU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2V0IHBhcnNlZFxuICAgICAgICB0aGlzLnBhcnNlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzLnNlY3Rpb25zWzBdO1xuICAgIH1cbn1cbmV4cG9ydHMuT3BSZXBseSA9IE9wUmVwbHk7XG4vLyBNc2cgRmxhZ3NcbmNvbnN0IE9QVFNfQ0hFQ0tTVU1fUFJFU0VOVCA9IDE7XG5jb25zdCBPUFRTX01PUkVfVE9fQ09NRSA9IDI7XG5jb25zdCBPUFRTX0VYSEFVU1RfQUxMT1dFRCA9IDEgPDwgMTY7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBEb2N1bWVudFNlcXVlbmNlIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgZG9jdW1lbnQgc2VxdWVuY2UgZm9yIHRoZSBwcm92aWRlZCBmaWVsZC5cbiAgICAgKiBAcGFyYW0gZmllbGQgLSBUaGUgZmllbGQgaXQgd2lsbCByZXBsYWNlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGZpZWxkLCBkb2N1bWVudHMpIHtcbiAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkO1xuICAgICAgICB0aGlzLmRvY3VtZW50cyA9IFtdO1xuICAgICAgICB0aGlzLmNodW5rcyA9IFtdO1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZWREb2N1bWVudHNMZW5ndGggPSAwO1xuICAgICAgICAvLyBEb2N1bWVudCBzZXF1ZW5jZXMgc3RhcnRzIHdpdGggdHlwZSAxIGF0IHRoZSBmaXJzdCBieXRlLlxuICAgICAgICAvLyBGaWVsZCBzdHJpbmdzIG11c3QgYWx3YXlzIGJlIFVURi04LlxuICAgICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuYWxsb2NVbnNhZmUoMSArIDQgKyB0aGlzLmZpZWxkLmxlbmd0aCArIDEpO1xuICAgICAgICBidWZmZXJbMF0gPSAxO1xuICAgICAgICAvLyBUaGlyZCBwYXJ0IGlzIHRoZSBmaWVsZCBuYW1lIGF0IG9mZnNldCA1IHdpdGggdHJhaWxpbmcgbnVsbCBieXRlLlxuICAgICAgICBlbmNvZGVVVEY4SW50byhidWZmZXIsIGAke3RoaXMuZmllbGR9XFwwYCwgNSk7XG4gICAgICAgIHRoaXMuY2h1bmtzLnB1c2goYnVmZmVyKTtcbiAgICAgICAgdGhpcy5oZWFkZXIgPSBidWZmZXI7XG4gICAgICAgIGlmIChkb2N1bWVudHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZG9jIG9mIGRvY3VtZW50cykge1xuICAgICAgICAgICAgICAgIHRoaXMucHVzaChkb2MsIEJTT04uc2VyaWFsaXplKGRvYykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFB1c2ggYSBkb2N1bWVudCB0byB0aGUgZG9jdW1lbnQgc2VxdWVuY2UuIFdpbGwgc2VyaWFsaXplIHRoZSBkb2N1bWVudFxuICAgICAqIGFzIHdlbGwgYW5kIHJldHVybiB0aGUgY3VycmVudCBzZXJpYWxpemVkIGxlbmd0aCBvZiBhbGwgZG9jdW1lbnRzLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBhZGQuXG4gICAgICogQHBhcmFtIGJ1ZmZlciAtIFRoZSBzZXJpYWxpemVkIGRvY3VtZW50IGluIHJhdyBCU09OLlxuICAgICAqIEByZXR1cm5zIFRoZSBuZXcgdG90YWwgZG9jdW1lbnQgc2VxdWVuY2UgbGVuZ3RoLlxuICAgICAqL1xuICAgIHB1c2goZG9jdW1lbnQsIGJ1ZmZlcikge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZWREb2N1bWVudHNMZW5ndGggKz0gYnVmZmVyLmxlbmd0aDtcbiAgICAgICAgLy8gUHVzaCB0aGUgZG9jdW1lbnQuXG4gICAgICAgIHRoaXMuZG9jdW1lbnRzLnB1c2goZG9jdW1lbnQpO1xuICAgICAgICAvLyBQdXNoIHRoZSBkb2N1bWVudCByYXcgYnNvbi5cbiAgICAgICAgdGhpcy5jaHVua3MucHVzaChidWZmZXIpO1xuICAgICAgICAvLyBXcml0ZSB0aGUgbmV3IGxlbmd0aC5cbiAgICAgICAgdGhpcy5oZWFkZXI/LndyaXRlSW50MzJMRSg0ICsgdGhpcy5maWVsZC5sZW5ndGggKyAxICsgdGhpcy5zZXJpYWxpemVkRG9jdW1lbnRzTGVuZ3RoLCAxKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplZERvY3VtZW50c0xlbmd0aCArIHRoaXMuaGVhZGVyLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBmdWxseSBzZXJpYWxpemVkIGJ5dGVzIGZvciB0aGUgZG9jdW1lbnQgc2VxdWVuY2Ugc2VjdGlvbi5cbiAgICAgKiBAcmV0dXJucyBUaGUgc2VjdGlvbiBieXRlcy5cbiAgICAgKi9cbiAgICB0b0JpbigpIHtcbiAgICAgICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQodGhpcy5jaHVua3MpO1xuICAgIH1cbn1cbmV4cG9ydHMuRG9jdW1lbnRTZXF1ZW5jZSA9IERvY3VtZW50U2VxdWVuY2U7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBPcE1zZ1JlcXVlc3Qge1xuICAgIGNvbnN0cnVjdG9yKGRhdGFiYXNlTmFtZSwgY29tbWFuZCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmRhdGFiYXNlTmFtZSA9IGRhdGFiYXNlTmFtZTtcbiAgICAgICAgdGhpcy5jb21tYW5kID0gY29tbWFuZDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgLy8gQmFzaWMgb3B0aW9ucyBuZWVkZWQgdG8gYmUgcGFzc2VkIGluXG4gICAgICAgIGlmIChjb21tYW5kID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdRdWVyeSBkb2N1bWVudCBtdXN0IGJlIHNwZWNpZmllZCBmb3IgcXVlcnknKTtcbiAgICAgICAgLy8gQmFzaWMgb3B0aW9uc1xuICAgICAgICB0aGlzLmNvbW1hbmQuJGRiID0gZGF0YWJhc2VOYW1lO1xuICAgICAgICAvLyBFbnN1cmUgZW1wdHkgb3B0aW9uc1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICAvLyBBZGRpdGlvbmFsIG9wdGlvbnNcbiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSBvcHRpb25zLnJlcXVlc3RJZCA/IG9wdGlvbnMucmVxdWVzdElkIDogT3BNc2dSZXF1ZXN0LmdldFJlcXVlc3RJZCgpO1xuICAgICAgICAvLyBTZXJpYWxpemF0aW9uIG9wdGlvblxuICAgICAgICB0aGlzLnNlcmlhbGl6ZUZ1bmN0aW9ucyA9XG4gICAgICAgICAgICB0eXBlb2Ygb3B0aW9ucy5zZXJpYWxpemVGdW5jdGlvbnMgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuc2VyaWFsaXplRnVuY3Rpb25zIDogZmFsc2U7XG4gICAgICAgIHRoaXMuaWdub3JlVW5kZWZpbmVkID1cbiAgICAgICAgICAgIHR5cGVvZiBvcHRpb25zLmlnbm9yZVVuZGVmaW5lZCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5pZ25vcmVVbmRlZmluZWQgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5jaGVja0tleXMgPSB0eXBlb2Ygb3B0aW9ucy5jaGVja0tleXMgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuY2hlY2tLZXlzIDogZmFsc2U7XG4gICAgICAgIHRoaXMubWF4QnNvblNpemUgPSBvcHRpb25zLm1heEJzb25TaXplIHx8IDEwMjQgKiAxMDI0ICogMTY7XG4gICAgICAgIC8vIGZsYWdzXG4gICAgICAgIHRoaXMuY2hlY2tzdW1QcmVzZW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMubW9yZVRvQ29tZSA9IG9wdGlvbnMubW9yZVRvQ29tZSA/PyBjb21tYW5kLndyaXRlQ29uY2Vybj8udyA9PT0gMDtcbiAgICAgICAgdGhpcy5leGhhdXN0QWxsb3dlZCA9XG4gICAgICAgICAgICB0eXBlb2Ygb3B0aW9ucy5leGhhdXN0QWxsb3dlZCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5leGhhdXN0QWxsb3dlZCA6IGZhbHNlO1xuICAgIH1cbiAgICB0b0JpbigpIHtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IFtdO1xuICAgICAgICBsZXQgZmxhZ3MgPSAwO1xuICAgICAgICBpZiAodGhpcy5jaGVja3N1bVByZXNlbnQpIHtcbiAgICAgICAgICAgIGZsYWdzIHw9IE9QVFNfQ0hFQ0tTVU1fUFJFU0VOVDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tb3JlVG9Db21lKSB7XG4gICAgICAgICAgICBmbGFncyB8PSBPUFRTX01PUkVfVE9fQ09NRTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5leGhhdXN0QWxsb3dlZCkge1xuICAgICAgICAgICAgZmxhZ3MgfD0gT1BUU19FWEhBVVNUX0FMTE9XRUQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVhZGVyID0gQnVmZmVyLmFsbG9jKDQgKiA0ICsgLy8gSGVhZGVyXG4gICAgICAgICAgICA0IC8vIEZsYWdzXG4gICAgICAgICk7XG4gICAgICAgIGJ1ZmZlcnMucHVzaChoZWFkZXIpO1xuICAgICAgICBsZXQgdG90YWxMZW5ndGggPSBoZWFkZXIubGVuZ3RoO1xuICAgICAgICBjb25zdCBjb21tYW5kID0gdGhpcy5jb21tYW5kO1xuICAgICAgICB0b3RhbExlbmd0aCArPSB0aGlzLm1ha2VTZWN0aW9ucyhidWZmZXJzLCBjb21tYW5kKTtcbiAgICAgICAgaGVhZGVyLndyaXRlSW50MzJMRSh0b3RhbExlbmd0aCwgMCk7IC8vIG1lc3NhZ2VMZW5ndGhcbiAgICAgICAgaGVhZGVyLndyaXRlSW50MzJMRSh0aGlzLnJlcXVlc3RJZCwgNCk7IC8vIHJlcXVlc3RJRFxuICAgICAgICBoZWFkZXIud3JpdGVJbnQzMkxFKDAsIDgpOyAvLyByZXNwb25zZVRvXG4gICAgICAgIGhlYWRlci53cml0ZUludDMyTEUoY29uc3RhbnRzXzEuT1BfTVNHLCAxMik7IC8vIG9wQ29kZVxuICAgICAgICBoZWFkZXIud3JpdGVVSW50MzJMRShmbGFncywgMTYpOyAvLyBmbGFnc1xuICAgICAgICByZXR1cm4gYnVmZmVycztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIHRoZSBzZWN0aW9ucyB0byB0aGUgT1BfTVNHIHJlcXVlc3QncyBidWZmZXJzIGFuZCByZXR1cm5zIHRoZSBsZW5ndGguXG4gICAgICovXG4gICAgbWFrZVNlY3Rpb25zKGJ1ZmZlcnMsIGRvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IHNlcXVlbmNlc0J1ZmZlciA9IHRoaXMuZXh0cmFjdERvY3VtZW50U2VxdWVuY2VzKGRvY3VtZW50KTtcbiAgICAgICAgY29uc3QgcGF5bG9hZFR5cGVCdWZmZXIgPSBCdWZmZXIuYWxsb2NVbnNhZmUoMSk7XG4gICAgICAgIHBheWxvYWRUeXBlQnVmZmVyWzBdID0gMDtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRCdWZmZXIgPSB0aGlzLnNlcmlhbGl6ZUJzb24oZG9jdW1lbnQpO1xuICAgICAgICAvLyBGaXJzdCBzZWN0aW9uLCB0eXBlIDBcbiAgICAgICAgYnVmZmVycy5wdXNoKHBheWxvYWRUeXBlQnVmZmVyKTtcbiAgICAgICAgYnVmZmVycy5wdXNoKGRvY3VtZW50QnVmZmVyKTtcbiAgICAgICAgLy8gU3Vic2VxdWVudCBzZWN0aW9ucywgdHlwZSAxXG4gICAgICAgIGJ1ZmZlcnMucHVzaChzZXF1ZW5jZXNCdWZmZXIpO1xuICAgICAgICByZXR1cm4gcGF5bG9hZFR5cGVCdWZmZXIubGVuZ3RoICsgZG9jdW1lbnRCdWZmZXIubGVuZ3RoICsgc2VxdWVuY2VzQnVmZmVyLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXh0cmFjdHMgdGhlIGRvY3VtZW50IHNlcXVlbmNlcyBmcm9tIHRoZSBjb21tYW5kIGRvY3VtZW50IGFuZCByZXR1cm5zXG4gICAgICogYSBidWZmZXIgdG8gYmUgYWRkZWQgYXMgbXVsdGlwbGUgc2VjdGlvbnMgYWZ0ZXIgdGhlIGluaXRpYWwgdHlwZSAwXG4gICAgICogc2VjdGlvbiBpbiB0aGUgbWVzc2FnZS5cbiAgICAgKi9cbiAgICBleHRyYWN0RG9jdW1lbnRTZXF1ZW5jZXMoZG9jdW1lbnQpIHtcbiAgICAgICAgLy8gUHVsbCBvdXQgYW55IGZpZWxkIGluIHRoZSBjb21tYW5kIGRvY3VtZW50IHRoYXQncyB2YWx1ZSBpcyBhIGRvY3VtZW50IHNlcXVlbmNlLlxuICAgICAgICBjb25zdCBjaHVua3MgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZG9jdW1lbnQpKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEb2N1bWVudFNlcXVlbmNlKSB7XG4gICAgICAgICAgICAgICAgY2h1bmtzLnB1c2godmFsdWUudG9CaW4oKSk7XG4gICAgICAgICAgICAgICAgLy8gV2h5IGFyZSB3ZSByZW1vdmluZyB0aGUgZmllbGQgZnJvbSB0aGUgY29tbWFuZD8gVGhpcyBpcyBiZWNhdXNlIGl0IG5lZWRzIHRvIGJlXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlZCBpbiB0aGUgT1BfTVNHIHJlcXVlc3QgZmlyc3Qgc2VjdGlvbiwgYW5kIERvY3VtZW50U2VxdWVuY2UgaXMgbm90IGFcbiAgICAgICAgICAgICAgICAvLyBCU09OIHR5cGUgYW5kIGlzIHNwZWNpZmljIHRvIHRoZSBNb25nb0RCIHdpcmUgcHJvdG9jb2wgc28gdGhlcmUncyBub3RoaW5nXG4gICAgICAgICAgICAgICAgLy8gb3VyIEJTT04gc2VyaWFsaXplciBjYW4gZG8gYWJvdXQgdGhpcy4gU2luY2UgRG9jdW1lbnRTZXF1ZW5jZSBpcyBub3QgZXhwb3NlZFxuICAgICAgICAgICAgICAgIC8vIGluIHRoZSBwdWJsaWMgQVBJIGFuZCBvbmx5IHVzZWQgaW50ZXJuYWxseSwgd2UgYXJlIG5ldmVyIG11dGF0aW5nIGFuIG9yaWdpbmFsXG4gICAgICAgICAgICAgICAgLy8gY29tbWFuZCBwcm92aWRlZCBieSB0aGUgdXNlciwganVzdCBvdXIgb3duLCBhbmQgaXQncyBjaGVhcGVyIHRvIGRlbGV0ZSBmcm9tXG4gICAgICAgICAgICAgICAgLy8gb3VyIG93biBjb21tYW5kIHRoYW4gY29weWluZyBpdC5cbiAgICAgICAgICAgICAgICBkZWxldGUgZG9jdW1lbnRba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2h1bmtzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBCdWZmZXIuY29uY2F0KGNodW5rcyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBubyBkb2N1bWVudCBzZXF1ZW5jZXMgd2UgcmV0dXJuIGFuIGVtcHR5IGJ1ZmZlciBmb3Igbm90aGluZyB0byBhZGRcbiAgICAgICAgLy8gdG8gdGhlIHBheWxvYWQuXG4gICAgICAgIHJldHVybiBCdWZmZXIuYWxsb2MoMCk7XG4gICAgfVxuICAgIHNlcmlhbGl6ZUJzb24oZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIEJTT04uc2VyaWFsaXplKGRvY3VtZW50LCB7XG4gICAgICAgICAgICBjaGVja0tleXM6IHRoaXMuY2hlY2tLZXlzLFxuICAgICAgICAgICAgc2VyaWFsaXplRnVuY3Rpb25zOiB0aGlzLnNlcmlhbGl6ZUZ1bmN0aW9ucyxcbiAgICAgICAgICAgIGlnbm9yZVVuZGVmaW5lZDogdGhpcy5pZ25vcmVVbmRlZmluZWRcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRSZXF1ZXN0SWQoKSB7XG4gICAgICAgIF9yZXF1ZXN0SWQgPSAoX3JlcXVlc3RJZCArIDEpICYgMHg3ZmZmZmZmZjtcbiAgICAgICAgcmV0dXJuIF9yZXF1ZXN0SWQ7XG4gICAgfVxufVxuZXhwb3J0cy5PcE1zZ1JlcXVlc3QgPSBPcE1zZ1JlcXVlc3Q7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBPcE1zZ1Jlc3BvbnNlIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBtc2dIZWFkZXIsIG1zZ0JvZHksIG9wdHMpIHtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgICAgIHRoaXMuc2VjdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5wYXJzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yYXcgPSBtZXNzYWdlO1xuICAgICAgICB0aGlzLmRhdGEgPSBtc2dCb2R5O1xuICAgICAgICB0aGlzLm9wdHMgPSBvcHRzID8/IHtcbiAgICAgICAgICAgIHVzZUJpZ0ludDY0OiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVMb25nczogdHJ1ZSxcbiAgICAgICAgICAgIHByb21vdGVWYWx1ZXM6IHRydWUsXG4gICAgICAgICAgICBwcm9tb3RlQnVmZmVyczogZmFsc2UsXG4gICAgICAgICAgICBic29uUmVnRXhwOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICAvLyBSZWFkIHRoZSBtZXNzYWdlIGhlYWRlclxuICAgICAgICB0aGlzLmxlbmd0aCA9IG1zZ0hlYWRlci5sZW5ndGg7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gbXNnSGVhZGVyLnJlcXVlc3RJZDtcbiAgICAgICAgdGhpcy5yZXNwb25zZVRvID0gbXNnSGVhZGVyLnJlc3BvbnNlVG87XG4gICAgICAgIHRoaXMub3BDb2RlID0gbXNnSGVhZGVyLm9wQ29kZTtcbiAgICAgICAgdGhpcy5mcm9tQ29tcHJlc3NlZCA9IG1zZ0hlYWRlci5mcm9tQ29tcHJlc3NlZDtcbiAgICAgICAgLy8gUmVhZCByZXNwb25zZSBmbGFnc1xuICAgICAgICB0aGlzLnJlc3BvbnNlRmxhZ3MgPSBtc2dCb2R5LnJlYWRJbnQzMkxFKDApO1xuICAgICAgICB0aGlzLmNoZWNrc3VtUHJlc2VudCA9ICh0aGlzLnJlc3BvbnNlRmxhZ3MgJiBPUFRTX0NIRUNLU1VNX1BSRVNFTlQpICE9PSAwO1xuICAgICAgICB0aGlzLm1vcmVUb0NvbWUgPSAodGhpcy5yZXNwb25zZUZsYWdzICYgT1BUU19NT1JFX1RPX0NPTUUpICE9PSAwO1xuICAgICAgICB0aGlzLmV4aGF1c3RBbGxvd2VkID0gKHRoaXMucmVzcG9uc2VGbGFncyAmIE9QVFNfRVhIQVVTVF9BTExPV0VEKSAhPT0gMDtcbiAgICAgICAgdGhpcy51c2VCaWdJbnQ2NCA9IHR5cGVvZiB0aGlzLm9wdHMudXNlQmlnSW50NjQgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy51c2VCaWdJbnQ2NCA6IGZhbHNlO1xuICAgICAgICB0aGlzLnByb21vdGVMb25ncyA9IHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZUxvbmdzID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdHMucHJvbW90ZUxvbmdzIDogdHJ1ZTtcbiAgICAgICAgdGhpcy5wcm9tb3RlVmFsdWVzID1cbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZVZhbHVlcyA9PT0gJ2Jvb2xlYW4nID8gdGhpcy5vcHRzLnByb21vdGVWYWx1ZXMgOiB0cnVlO1xuICAgICAgICB0aGlzLnByb21vdGVCdWZmZXJzID1cbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLm9wdHMucHJvbW90ZUJ1ZmZlcnMgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5wcm9tb3RlQnVmZmVycyA6IGZhbHNlO1xuICAgICAgICB0aGlzLmJzb25SZWdFeHAgPSB0eXBlb2YgdGhpcy5vcHRzLmJzb25SZWdFeHAgPT09ICdib29sZWFuJyA/IHRoaXMub3B0cy5ic29uUmVnRXhwIDogZmFsc2U7XG4gICAgfVxuICAgIGlzUGFyc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZWQ7XG4gICAgfVxuICAgIHBhcnNlKCkge1xuICAgICAgICAvLyBEb24ndCBwYXJzZSBhZ2FpbiBpZiBub3QgbmVlZGVkXG4gICAgICAgIGlmICh0aGlzLnBhcnNlZClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlY3Rpb25zWzBdO1xuICAgICAgICB0aGlzLmluZGV4ID0gNDtcbiAgICAgICAgd2hpbGUgKHRoaXMuaW5kZXggPCB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkVHlwZSA9IHRoaXMuZGF0YS5yZWFkVUludDgodGhpcy5pbmRleCsrKTtcbiAgICAgICAgICAgIGlmIChwYXlsb2FkVHlwZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJzb25TaXplID0gdGhpcy5kYXRhLnJlYWRVSW50MzJMRSh0aGlzLmluZGV4KTtcbiAgICAgICAgICAgICAgICBjb25zdCBiaW4gPSB0aGlzLmRhdGEuc3ViYXJyYXkodGhpcy5pbmRleCwgdGhpcy5pbmRleCArIGJzb25TaXplKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlY3Rpb25zLnB1c2goYmluKTtcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4ICs9IGJzb25TaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGF5bG9hZFR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyBJdCB3YXMgZGVjaWRlZCB0aGF0IG5vIGRyaXZlciBtYWtlcyB1c2Ugb2YgcGF5bG9hZCB0eXBlIDFcbiAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IFJlcGxhY2Ugd2l0aCBNb25nb0RlcHJlY2F0aW9uRXJyb3JcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignT1BfTVNHIFBheWxvYWQgVHlwZSAxIGRldGVjdGVkIHVuc3VwcG9ydGVkIHByb3RvY29sJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wYXJzZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcy5zZWN0aW9uc1swXTtcbiAgICB9XG59XG5leHBvcnRzLk9wTXNnUmVzcG9uc2UgPSBPcE1zZ1Jlc3BvbnNlO1xuY29uc3QgTUVTU0FHRV9IRUFERVJfU0laRSA9IDE2O1xuY29uc3QgQ09NUFJFU1NJT05fREVUQUlMU19TSVpFID0gOTsgLy8gb3JpZ2luYWxPcGNvZGUgKyB1bmNvbXByZXNzZWRTaXplLCBjb21wcmVzc29ySURcbi8qKlxuICogQGludGVybmFsXG4gKlxuICogQW4gT1BfQ09NUFJFU1NFRCByZXF1ZXN0IHdyYXBzIGVpdGhlciBhbiBPUF9RVUVSWSBvciBPUF9NU0cgbWVzc2FnZS5cbiAqL1xuY2xhc3MgT3BDb21wcmVzc2VkUmVxdWVzdCB7XG4gICAgY29uc3RydWN0b3IoY29tbWFuZCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmNvbW1hbmQgPSBjb21tYW5kO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH1cbiAgICAvLyBSZXR1cm4gd2hldGhlciBhIGNvbW1hbmQgY29udGFpbnMgYW4gdW5jb21wcmVzc2libGUgY29tbWFuZCB0ZXJtXG4gICAgLy8gV2lsbCByZXR1cm4gdHJ1ZSBpZiBjb21tYW5kIGNvbnRhaW5zIG5vIHVuY29tcHJlc3NpYmxlIGNvbW1hbmQgdGVybXNcbiAgICBzdGF0aWMgY2FuQ29tcHJlc3MoY29tbWFuZCkge1xuICAgICAgICBjb25zdCBjb21tYW5kRG9jID0gY29tbWFuZCBpbnN0YW5jZW9mIE9wTXNnUmVxdWVzdCA/IGNvbW1hbmQuY29tbWFuZCA6IGNvbW1hbmQucXVlcnk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmROYW1lID0gT2JqZWN0LmtleXMoY29tbWFuZERvYylbMF07XG4gICAgICAgIHJldHVybiAhY29tcHJlc3Npb25fMS51bmNvbXByZXNzaWJsZUNvbW1hbmRzLmhhcyhjb21tYW5kTmFtZSk7XG4gICAgfVxuICAgIGFzeW5jIHRvQmluKCkge1xuICAgICAgICBjb25zdCBjb25jYXRlbmF0ZWRPcmlnaW5hbENvbW1hbmRCdWZmZXIgPSBCdWZmZXIuY29uY2F0KHRoaXMuY29tbWFuZC50b0JpbigpKTtcbiAgICAgICAgLy8gb3RoZXJ3aXNlLCBjb21wcmVzcyB0aGUgbWVzc2FnZVxuICAgICAgICBjb25zdCBtZXNzYWdlVG9CZUNvbXByZXNzZWQgPSBjb25jYXRlbmF0ZWRPcmlnaW5hbENvbW1hbmRCdWZmZXIuc2xpY2UoTUVTU0FHRV9IRUFERVJfU0laRSk7XG4gICAgICAgIC8vIEV4dHJhY3QgaW5mb3JtYXRpb24gbmVlZGVkIGZvciBPUF9DT01QUkVTU0VEIGZyb20gdGhlIHVuY29tcHJlc3NlZCBtZXNzYWdlXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsQ29tbWFuZE9wQ29kZSA9IGNvbmNhdGVuYXRlZE9yaWdpbmFsQ29tbWFuZEJ1ZmZlci5yZWFkSW50MzJMRSgxMik7XG4gICAgICAgIC8vIENvbXByZXNzIHRoZSBtZXNzYWdlIGJvZHlcbiAgICAgICAgY29uc3QgY29tcHJlc3NlZE1lc3NhZ2UgPSBhd2FpdCAoMCwgY29tcHJlc3Npb25fMS5jb21wcmVzcykodGhpcy5vcHRpb25zLCBtZXNzYWdlVG9CZUNvbXByZXNzZWQpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIG1zZ0hlYWRlciBvZiBPUF9DT01QUkVTU0VEXG4gICAgICAgIGNvbnN0IG1zZ0hlYWRlciA9IEJ1ZmZlci5hbGxvYyhNRVNTQUdFX0hFQURFUl9TSVpFKTtcbiAgICAgICAgbXNnSGVhZGVyLndyaXRlSW50MzJMRShNRVNTQUdFX0hFQURFUl9TSVpFICsgQ09NUFJFU1NJT05fREVUQUlMU19TSVpFICsgY29tcHJlc3NlZE1lc3NhZ2UubGVuZ3RoLCAwKTsgLy8gbWVzc2FnZUxlbmd0aFxuICAgICAgICBtc2dIZWFkZXIud3JpdGVJbnQzMkxFKHRoaXMuY29tbWFuZC5yZXF1ZXN0SWQsIDQpOyAvLyByZXF1ZXN0SURcbiAgICAgICAgbXNnSGVhZGVyLndyaXRlSW50MzJMRSgwLCA4KTsgLy8gcmVzcG9uc2VUbyAoemVybylcbiAgICAgICAgbXNnSGVhZGVyLndyaXRlSW50MzJMRShjb25zdGFudHNfMS5PUF9DT01QUkVTU0VELCAxMik7IC8vIG9wQ29kZVxuICAgICAgICAvLyBDcmVhdGUgdGhlIGNvbXByZXNzaW9uIGRldGFpbHMgb2YgT1BfQ09NUFJFU1NFRFxuICAgICAgICBjb25zdCBjb21wcmVzc2lvbkRldGFpbHMgPSBCdWZmZXIuYWxsb2MoQ09NUFJFU1NJT05fREVUQUlMU19TSVpFKTtcbiAgICAgICAgY29tcHJlc3Npb25EZXRhaWxzLndyaXRlSW50MzJMRShvcmlnaW5hbENvbW1hbmRPcENvZGUsIDApOyAvLyBvcmlnaW5hbE9wY29kZVxuICAgICAgICBjb21wcmVzc2lvbkRldGFpbHMud3JpdGVJbnQzMkxFKG1lc3NhZ2VUb0JlQ29tcHJlc3NlZC5sZW5ndGgsIDQpOyAvLyBTaXplIG9mIHRoZSB1bmNvbXByZXNzZWQgY29tcHJlc3NlZE1lc3NhZ2UsIGV4Y2x1ZGluZyB0aGUgTXNnSGVhZGVyXG4gICAgICAgIGNvbXByZXNzaW9uRGV0YWlscy53cml0ZVVJbnQ4KGNvbXByZXNzaW9uXzEuQ29tcHJlc3Nvclt0aGlzLm9wdGlvbnMuYWdyZWVkQ29tcHJlc3Nvcl0sIDgpOyAvLyBjb21wcmVzc29ySURcbiAgICAgICAgcmV0dXJuIFttc2dIZWFkZXIsIGNvbXByZXNzaW9uRGV0YWlscywgY29tcHJlc3NlZE1lc3NhZ2VdO1xuICAgIH1cbn1cbmV4cG9ydHMuT3BDb21wcmVzc2VkUmVxdWVzdCA9IE9wQ29tcHJlc3NlZFJlcXVlc3Q7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tYW5kcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connect.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connect.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.LEGAL_TCP_SOCKET_OPTIONS = exports.LEGAL_TLS_SOCKET_OPTIONS = void 0;\nexports.connect = connect;\nexports.makeConnection = makeConnection;\nexports.performInitialHandshake = performInitialHandshake;\nexports.prepareHandshakeDocument = prepareHandshakeDocument;\nexports.makeSocket = makeSocket;\nconst net = __webpack_require__(/*! net */ \"net\");\nconst tls = __webpack_require__(/*! tls */ \"tls\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst deps_1 = __webpack_require__(/*! ../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst auth_provider_1 = __webpack_require__(/*! ./auth/auth_provider */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/auth_provider.js\");\nconst providers_1 = __webpack_require__(/*! ./auth/providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst connection_1 = __webpack_require__(/*! ./connection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection.js\");\nconst constants_2 = __webpack_require__(/*! ./wire_protocol/constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nasync function connect(options) {\n    let connection = null;\n    try {\n        const socket = await makeSocket(options);\n        connection = makeConnection(options, socket);\n        await performInitialHandshake(connection, options);\n        return connection;\n    }\n    catch (error) {\n        connection?.destroy();\n        throw error;\n    }\n}\nfunction makeConnection(options, socket) {\n    let ConnectionType = options.connectionType ?? connection_1.Connection;\n    if (options.autoEncrypter) {\n        ConnectionType = connection_1.CryptoConnection;\n    }\n    return new ConnectionType(socket, options);\n}\nfunction checkSupportedServer(hello, options) {\n    const maxWireVersion = Number(hello.maxWireVersion);\n    const minWireVersion = Number(hello.minWireVersion);\n    const serverVersionHighEnough = !Number.isNaN(maxWireVersion) && maxWireVersion >= constants_2.MIN_SUPPORTED_WIRE_VERSION;\n    const serverVersionLowEnough = !Number.isNaN(minWireVersion) && minWireVersion <= constants_2.MAX_SUPPORTED_WIRE_VERSION;\n    if (serverVersionHighEnough) {\n        if (serverVersionLowEnough) {\n            return null;\n        }\n        const message = `Server at ${options.hostAddress} reports minimum wire version ${JSON.stringify(hello.minWireVersion)}, but this version of the Node.js Driver requires at most ${constants_2.MAX_SUPPORTED_WIRE_VERSION} (MongoDB ${constants_2.MAX_SUPPORTED_SERVER_VERSION})`;\n        return new error_1.MongoCompatibilityError(message);\n    }\n    const message = `Server at ${options.hostAddress} reports maximum wire version ${JSON.stringify(hello.maxWireVersion) ?? 0}, but this version of the Node.js Driver requires at least ${constants_2.MIN_SUPPORTED_WIRE_VERSION} (MongoDB ${constants_2.MIN_SUPPORTED_SERVER_VERSION})`;\n    return new error_1.MongoCompatibilityError(message);\n}\nasync function performInitialHandshake(conn, options) {\n    const credentials = options.credentials;\n    if (credentials) {\n        if (!(credentials.mechanism === providers_1.AuthMechanism.MONGODB_DEFAULT) &&\n            !options.authProviders.getOrCreateProvider(credentials.mechanism, credentials.mechanismProperties)) {\n            throw new error_1.MongoInvalidArgumentError(`AuthMechanism '${credentials.mechanism}' not supported`);\n        }\n    }\n    const authContext = new auth_provider_1.AuthContext(conn, credentials, options);\n    conn.authContext = authContext;\n    const handshakeDoc = await prepareHandshakeDocument(authContext);\n    // @ts-expect-error: TODO(NODE-5141): The options need to be filtered properly, Connection options differ from Command options\n    const handshakeOptions = { ...options, raw: false };\n    if (typeof options.connectTimeoutMS === 'number') {\n        // The handshake technically is a monitoring check, so its socket timeout should be connectTimeoutMS\n        handshakeOptions.socketTimeoutMS = options.connectTimeoutMS;\n    }\n    const start = new Date().getTime();\n    const response = await executeHandshake(handshakeDoc, handshakeOptions);\n    if (!('isWritablePrimary' in response)) {\n        // Provide hello-style response document.\n        response.isWritablePrimary = response[constants_1.LEGACY_HELLO_COMMAND];\n    }\n    if (response.helloOk) {\n        conn.helloOk = true;\n    }\n    const supportedServerErr = checkSupportedServer(response, options);\n    if (supportedServerErr) {\n        throw supportedServerErr;\n    }\n    if (options.loadBalanced) {\n        if (!response.serviceId) {\n            throw new error_1.MongoCompatibilityError('Driver attempted to initialize in load balancing mode, ' +\n                'but the server does not support this mode.');\n        }\n    }\n    // NOTE: This is metadata attached to the connection while porting away from\n    //       handshake being done in the `Server` class. Likely, it should be\n    //       relocated, or at very least restructured.\n    conn.hello = response;\n    conn.lastHelloMS = new Date().getTime() - start;\n    if (!response.arbiterOnly && credentials) {\n        // store the response on auth context\n        authContext.response = response;\n        const resolvedCredentials = credentials.resolveAuthMechanism(response);\n        const provider = options.authProviders.getOrCreateProvider(resolvedCredentials.mechanism, resolvedCredentials.mechanismProperties);\n        if (!provider) {\n            throw new error_1.MongoInvalidArgumentError(`No AuthProvider for ${resolvedCredentials.mechanism} defined.`);\n        }\n        try {\n            await provider.auth(authContext);\n        }\n        catch (error) {\n            if (error instanceof error_1.MongoError) {\n                error.addErrorLabel(error_1.MongoErrorLabel.HandshakeError);\n                if ((0, error_1.needsRetryableWriteLabel)(error, response.maxWireVersion, conn.description.type)) {\n                    error.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n                }\n            }\n            throw error;\n        }\n    }\n    // Connection establishment is socket creation (tcp handshake, tls handshake, MongoDB handshake (saslStart, saslContinue))\n    // Once connection is established, command logging can log events (if enabled)\n    conn.established = true;\n    async function executeHandshake(handshakeDoc, handshakeOptions) {\n        try {\n            const handshakeResponse = await conn.command((0, utils_1.ns)('admin.$cmd'), handshakeDoc, handshakeOptions);\n            return handshakeResponse;\n        }\n        catch (error) {\n            if (error instanceof error_1.MongoError) {\n                error.addErrorLabel(error_1.MongoErrorLabel.HandshakeError);\n            }\n            throw error;\n        }\n    }\n}\n/**\n * @internal\n *\n * This function is only exposed for testing purposes.\n */\nasync function prepareHandshakeDocument(authContext) {\n    const options = authContext.options;\n    const compressors = options.compressors ? options.compressors : [];\n    const { serverApi } = authContext.connection;\n    const clientMetadata = await options.extendedMetadata;\n    const handshakeDoc = {\n        [serverApi?.version || options.loadBalanced === true ? 'hello' : constants_1.LEGACY_HELLO_COMMAND]: 1,\n        helloOk: true,\n        client: clientMetadata,\n        compression: compressors\n    };\n    if (options.loadBalanced === true) {\n        handshakeDoc.loadBalanced = true;\n    }\n    const credentials = authContext.credentials;\n    if (credentials) {\n        if (credentials.mechanism === providers_1.AuthMechanism.MONGODB_DEFAULT && credentials.username) {\n            handshakeDoc.saslSupportedMechs = `${credentials.source}.${credentials.username}`;\n            const provider = authContext.options.authProviders.getOrCreateProvider(providers_1.AuthMechanism.MONGODB_SCRAM_SHA256, credentials.mechanismProperties);\n            if (!provider) {\n                // This auth mechanism is always present.\n                throw new error_1.MongoInvalidArgumentError(`No AuthProvider for ${providers_1.AuthMechanism.MONGODB_SCRAM_SHA256} defined.`);\n            }\n            return await provider.prepare(handshakeDoc, authContext);\n        }\n        const provider = authContext.options.authProviders.getOrCreateProvider(credentials.mechanism, credentials.mechanismProperties);\n        if (!provider) {\n            throw new error_1.MongoInvalidArgumentError(`No AuthProvider for ${credentials.mechanism} defined.`);\n        }\n        return await provider.prepare(handshakeDoc, authContext);\n    }\n    return handshakeDoc;\n}\n/** @public */\nexports.LEGAL_TLS_SOCKET_OPTIONS = [\n    'allowPartialTrustChain',\n    'ALPNProtocols',\n    'ca',\n    'cert',\n    'checkServerIdentity',\n    'ciphers',\n    'crl',\n    'ecdhCurve',\n    'key',\n    'minDHSize',\n    'passphrase',\n    'pfx',\n    'rejectUnauthorized',\n    'secureContext',\n    'secureProtocol',\n    'servername',\n    'session'\n];\n/** @public */\nexports.LEGAL_TCP_SOCKET_OPTIONS = [\n    'autoSelectFamily',\n    'autoSelectFamilyAttemptTimeout',\n    'family',\n    'hints',\n    'localAddress',\n    'localPort',\n    'lookup'\n];\nfunction parseConnectOptions(options) {\n    const hostAddress = options.hostAddress;\n    if (!hostAddress)\n        throw new error_1.MongoInvalidArgumentError('Option \"hostAddress\" is required');\n    const result = {};\n    for (const name of exports.LEGAL_TCP_SOCKET_OPTIONS) {\n        if (options[name] != null) {\n            result[name] = options[name];\n        }\n    }\n    if (typeof hostAddress.socketPath === 'string') {\n        result.path = hostAddress.socketPath;\n        return result;\n    }\n    else if (typeof hostAddress.host === 'string') {\n        result.host = hostAddress.host;\n        result.port = hostAddress.port;\n        return result;\n    }\n    else {\n        // This should never happen since we set up HostAddresses\n        // But if we don't throw here the socket could hang until timeout\n        // TODO(NODE-3483)\n        throw new error_1.MongoRuntimeError(`Unexpected HostAddress ${JSON.stringify(hostAddress)}`);\n    }\n}\nfunction parseSslOptions(options) {\n    const result = parseConnectOptions(options);\n    // Merge in valid SSL options\n    for (const name of exports.LEGAL_TLS_SOCKET_OPTIONS) {\n        if (options[name] != null) {\n            result[name] = options[name];\n        }\n    }\n    if (options.existingSocket) {\n        result.socket = options.existingSocket;\n    }\n    // Set default sni servername to be the same as host\n    if (result.servername == null && result.host && !net.isIP(result.host)) {\n        result.servername = result.host;\n    }\n    return result;\n}\nasync function makeSocket(options) {\n    const useTLS = options.tls ?? false;\n    const noDelay = options.noDelay ?? true;\n    const connectTimeoutMS = options.connectTimeoutMS ?? 30000;\n    const existingSocket = options.existingSocket;\n    let socket;\n    if (options.proxyHost != null) {\n        // Currently, only Socks5 is supported.\n        return await makeSocks5Connection({\n            ...options,\n            connectTimeoutMS // Should always be present for Socks5\n        });\n    }\n    if (useTLS) {\n        const tlsSocket = tls.connect(parseSslOptions(options));\n        if (typeof tlsSocket.disableRenegotiation === 'function') {\n            tlsSocket.disableRenegotiation();\n        }\n        socket = tlsSocket;\n    }\n    else if (existingSocket) {\n        // In the TLS case, parseSslOptions() sets options.socket to existingSocket,\n        // so we only need to handle the non-TLS case here (where existingSocket\n        // gives us all we need out of the box).\n        socket = existingSocket;\n    }\n    else {\n        socket = net.createConnection(parseConnectOptions(options));\n    }\n    socket.setKeepAlive(true, 300000);\n    socket.setTimeout(connectTimeoutMS);\n    socket.setNoDelay(noDelay);\n    let cancellationHandler = null;\n    const { promise: connectedSocket, resolve, reject } = (0, utils_1.promiseWithResolvers)();\n    if (existingSocket) {\n        resolve(socket);\n    }\n    else {\n        const start = performance.now();\n        const connectEvent = useTLS ? 'secureConnect' : 'connect';\n        socket\n            .once(connectEvent, () => resolve(socket))\n            .once('error', cause => reject(new error_1.MongoNetworkError(error_1.MongoError.buildErrorMessage(cause), { cause })))\n            .once('timeout', () => {\n            reject(new error_1.MongoNetworkTimeoutError(`Socket '${connectEvent}' timed out after ${(performance.now() - start) | 0}ms (connectTimeoutMS: ${connectTimeoutMS})`));\n        })\n            .once('close', () => reject(new error_1.MongoNetworkError(`Socket closed after ${(performance.now() - start) | 0} during connection establishment`)));\n        if (options.cancellationToken != null) {\n            cancellationHandler = () => reject(new error_1.MongoNetworkError(`Socket connection establishment was cancelled after ${(performance.now() - start) | 0}`));\n            options.cancellationToken.once('cancel', cancellationHandler);\n        }\n    }\n    try {\n        socket = await connectedSocket;\n        return socket;\n    }\n    catch (error) {\n        socket.destroy();\n        throw error;\n    }\n    finally {\n        socket.setTimeout(0);\n        if (cancellationHandler != null) {\n            options.cancellationToken?.removeListener('cancel', cancellationHandler);\n        }\n    }\n}\nlet socks = null;\nfunction loadSocks() {\n    if (socks == null) {\n        const socksImport = (0, deps_1.getSocks)();\n        if ('kModuleError' in socksImport) {\n            throw socksImport.kModuleError;\n        }\n        socks = socksImport;\n    }\n    return socks;\n}\nasync function makeSocks5Connection(options) {\n    const hostAddress = utils_1.HostAddress.fromHostPort(options.proxyHost ?? '', // proxyHost is guaranteed to set here\n    options.proxyPort ?? 1080);\n    // First, connect to the proxy server itself:\n    const rawSocket = await makeSocket({\n        ...options,\n        hostAddress,\n        tls: false,\n        proxyHost: undefined\n    });\n    const destination = parseConnectOptions(options);\n    if (typeof destination.host !== 'string' || typeof destination.port !== 'number') {\n        throw new error_1.MongoInvalidArgumentError('Can only make Socks5 connections to TCP hosts');\n    }\n    socks ??= loadSocks();\n    let existingSocket;\n    try {\n        // Then, establish the Socks5 proxy connection:\n        const connection = await socks.SocksClient.createConnection({\n            existing_socket: rawSocket,\n            timeout: options.connectTimeoutMS,\n            command: 'connect',\n            destination: {\n                host: destination.host,\n                port: destination.port\n            },\n            proxy: {\n                // host and port are ignored because we pass existing_socket\n                host: 'iLoveJavaScript',\n                port: 0,\n                type: 5,\n                userId: options.proxyUsername || undefined,\n                password: options.proxyPassword || undefined\n            }\n        });\n        existingSocket = connection.socket;\n    }\n    catch (cause) {\n        throw new error_1.MongoNetworkError(error_1.MongoError.buildErrorMessage(cause), { cause });\n    }\n    // Finally, now treat the resulting duplex stream as the\n    // socket over which we send and receive wire protocol messages:\n    return await makeSocket({ ...options, existingSocket, proxyHost: undefined });\n}\n//# sourceMappingURL=connect.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29ubmVjdC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxnQ0FBZ0MsR0FBRyxnQ0FBZ0M7QUFDbkUsZUFBZTtBQUNmLHNCQUFzQjtBQUN0QiwrQkFBK0I7QUFDL0IsZ0NBQWdDO0FBQ2hDLGtCQUFrQjtBQUNsQixZQUFZLG1CQUFPLENBQUMsZ0JBQUs7QUFDekIsWUFBWSxtQkFBTyxDQUFDLGdCQUFLO0FBQ3pCLG9CQUFvQixtQkFBTyxDQUFDLHFHQUFjO0FBQzFDLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyx3QkFBd0IsbUJBQU8sQ0FBQywySEFBc0I7QUFDdEQsb0JBQW9CLG1CQUFPLENBQUMsbUhBQWtCO0FBQzlDLHFCQUFxQixtQkFBTyxDQUFDLDJHQUFjO0FBQzNDLG9CQUFvQixtQkFBTyxDQUFDLHFJQUEyQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHFCQUFxQiwrQkFBK0IscUNBQXFDLDREQUE0RCx3Q0FBd0MsV0FBVyx5Q0FBeUM7QUFDdFI7QUFDQTtBQUNBLGlDQUFpQyxxQkFBcUIsK0JBQStCLDBDQUEwQyw2REFBNkQsd0NBQXdDLFdBQVcseUNBQXlDO0FBQ3hSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEVBQTBFLHNCQUFzQjtBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRUFBK0UsK0JBQStCO0FBQzlHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVk7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsbUJBQW1CLEdBQUcscUJBQXFCO0FBQzVGO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRixnREFBZ0Q7QUFDbkk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSx1QkFBdUI7QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFLDRCQUE0QjtBQUNsRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw0Q0FBNEM7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdIQUF3SCxPQUFPO0FBQy9IO0FBQ0EsbUVBQW1FLGFBQWEsb0JBQW9CLGdDQUFnQyx3QkFBd0IsaUJBQWlCO0FBQzdLLFNBQVM7QUFDVCw2RkFBNkYsaUNBQWlDO0FBQzlIO0FBQ0Esb0lBQW9JLGdDQUFnQztBQUNwSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDJGQUEyRixPQUFPO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixrREFBa0Q7QUFDaEY7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29ubmVjdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTEVHQUxfVENQX1NPQ0tFVF9PUFRJT05TID0gZXhwb3J0cy5MRUdBTF9UTFNfU09DS0VUX09QVElPTlMgPSB2b2lkIDA7XG5leHBvcnRzLmNvbm5lY3QgPSBjb25uZWN0O1xuZXhwb3J0cy5tYWtlQ29ubmVjdGlvbiA9IG1ha2VDb25uZWN0aW9uO1xuZXhwb3J0cy5wZXJmb3JtSW5pdGlhbEhhbmRzaGFrZSA9IHBlcmZvcm1Jbml0aWFsSGFuZHNoYWtlO1xuZXhwb3J0cy5wcmVwYXJlSGFuZHNoYWtlRG9jdW1lbnQgPSBwcmVwYXJlSGFuZHNoYWtlRG9jdW1lbnQ7XG5leHBvcnRzLm1ha2VTb2NrZXQgPSBtYWtlU29ja2V0O1xuY29uc3QgbmV0ID0gcmVxdWlyZShcIm5ldFwiKTtcbmNvbnN0IHRscyA9IHJlcXVpcmUoXCJ0bHNcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XG5jb25zdCBkZXBzXzEgPSByZXF1aXJlKFwiLi4vZGVwc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgYXV0aF9wcm92aWRlcl8xID0gcmVxdWlyZShcIi4vYXV0aC9hdXRoX3Byb3ZpZGVyXCIpO1xuY29uc3QgcHJvdmlkZXJzXzEgPSByZXF1aXJlKFwiLi9hdXRoL3Byb3ZpZGVyc1wiKTtcbmNvbnN0IGNvbm5lY3Rpb25fMSA9IHJlcXVpcmUoXCIuL2Nvbm5lY3Rpb25cIik7XG5jb25zdCBjb25zdGFudHNfMiA9IHJlcXVpcmUoXCIuL3dpcmVfcHJvdG9jb2wvY29uc3RhbnRzXCIpO1xuYXN5bmMgZnVuY3Rpb24gY29ubmVjdChvcHRpb25zKSB7XG4gICAgbGV0IGNvbm5lY3Rpb24gPSBudWxsO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNvY2tldCA9IGF3YWl0IG1ha2VTb2NrZXQob3B0aW9ucyk7XG4gICAgICAgIGNvbm5lY3Rpb24gPSBtYWtlQ29ubmVjdGlvbihvcHRpb25zLCBzb2NrZXQpO1xuICAgICAgICBhd2FpdCBwZXJmb3JtSW5pdGlhbEhhbmRzaGFrZShjb25uZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb247XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25uZWN0aW9uPy5kZXN0cm95KCk7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG1ha2VDb25uZWN0aW9uKG9wdGlvbnMsIHNvY2tldCkge1xuICAgIGxldCBDb25uZWN0aW9uVHlwZSA9IG9wdGlvbnMuY29ubmVjdGlvblR5cGUgPz8gY29ubmVjdGlvbl8xLkNvbm5lY3Rpb247XG4gICAgaWYgKG9wdGlvbnMuYXV0b0VuY3J5cHRlcikge1xuICAgICAgICBDb25uZWN0aW9uVHlwZSA9IGNvbm5lY3Rpb25fMS5DcnlwdG9Db25uZWN0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IENvbm5lY3Rpb25UeXBlKHNvY2tldCwgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBjaGVja1N1cHBvcnRlZFNlcnZlcihoZWxsbywgb3B0aW9ucykge1xuICAgIGNvbnN0IG1heFdpcmVWZXJzaW9uID0gTnVtYmVyKGhlbGxvLm1heFdpcmVWZXJzaW9uKTtcbiAgICBjb25zdCBtaW5XaXJlVmVyc2lvbiA9IE51bWJlcihoZWxsby5taW5XaXJlVmVyc2lvbik7XG4gICAgY29uc3Qgc2VydmVyVmVyc2lvbkhpZ2hFbm91Z2ggPSAhTnVtYmVyLmlzTmFOKG1heFdpcmVWZXJzaW9uKSAmJiBtYXhXaXJlVmVyc2lvbiA+PSBjb25zdGFudHNfMi5NSU5fU1VQUE9SVEVEX1dJUkVfVkVSU0lPTjtcbiAgICBjb25zdCBzZXJ2ZXJWZXJzaW9uTG93RW5vdWdoID0gIU51bWJlci5pc05hTihtaW5XaXJlVmVyc2lvbikgJiYgbWluV2lyZVZlcnNpb24gPD0gY29uc3RhbnRzXzIuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT047XG4gICAgaWYgKHNlcnZlclZlcnNpb25IaWdoRW5vdWdoKSB7XG4gICAgICAgIGlmIChzZXJ2ZXJWZXJzaW9uTG93RW5vdWdoKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZXNzYWdlID0gYFNlcnZlciBhdCAke29wdGlvbnMuaG9zdEFkZHJlc3N9IHJlcG9ydHMgbWluaW11bSB3aXJlIHZlcnNpb24gJHtKU09OLnN0cmluZ2lmeShoZWxsby5taW5XaXJlVmVyc2lvbil9LCBidXQgdGhpcyB2ZXJzaW9uIG9mIHRoZSBOb2RlLmpzIERyaXZlciByZXF1aXJlcyBhdCBtb3N0ICR7Y29uc3RhbnRzXzIuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT059IChNb25nb0RCICR7Y29uc3RhbnRzXzIuTUFYX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTn0pYDtcbiAgICAgICAgcmV0dXJuIG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBjb25zdCBtZXNzYWdlID0gYFNlcnZlciBhdCAke29wdGlvbnMuaG9zdEFkZHJlc3N9IHJlcG9ydHMgbWF4aW11bSB3aXJlIHZlcnNpb24gJHtKU09OLnN0cmluZ2lmeShoZWxsby5tYXhXaXJlVmVyc2lvbikgPz8gMH0sIGJ1dCB0aGlzIHZlcnNpb24gb2YgdGhlIE5vZGUuanMgRHJpdmVyIHJlcXVpcmVzIGF0IGxlYXN0ICR7Y29uc3RhbnRzXzIuTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT059IChNb25nb0RCICR7Y29uc3RhbnRzXzIuTUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTn0pYDtcbiAgICByZXR1cm4gbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IobWVzc2FnZSk7XG59XG5hc3luYyBmdW5jdGlvbiBwZXJmb3JtSW5pdGlhbEhhbmRzaGFrZShjb25uLCBvcHRpb25zKSB7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBvcHRpb25zLmNyZWRlbnRpYWxzO1xuICAgIGlmIChjcmVkZW50aWFscykge1xuICAgICAgICBpZiAoIShjcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9ERUZBVUxUKSAmJlxuICAgICAgICAgICAgIW9wdGlvbnMuYXV0aFByb3ZpZGVycy5nZXRPckNyZWF0ZVByb3ZpZGVyKGNyZWRlbnRpYWxzLm1lY2hhbmlzbSwgY3JlZGVudGlhbHMubWVjaGFuaXNtUHJvcGVydGllcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEF1dGhNZWNoYW5pc20gJyR7Y3JlZGVudGlhbHMubWVjaGFuaXNtfScgbm90IHN1cHBvcnRlZGApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGF1dGhDb250ZXh0ID0gbmV3IGF1dGhfcHJvdmlkZXJfMS5BdXRoQ29udGV4dChjb25uLCBjcmVkZW50aWFscywgb3B0aW9ucyk7XG4gICAgY29ubi5hdXRoQ29udGV4dCA9IGF1dGhDb250ZXh0O1xuICAgIGNvbnN0IGhhbmRzaGFrZURvYyA9IGF3YWl0IHByZXBhcmVIYW5kc2hha2VEb2N1bWVudChhdXRoQ29udGV4dCk7XG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvcjogVE9ETyhOT0RFLTUxNDEpOiBUaGUgb3B0aW9ucyBuZWVkIHRvIGJlIGZpbHRlcmVkIHByb3Blcmx5LCBDb25uZWN0aW9uIG9wdGlvbnMgZGlmZmVyIGZyb20gQ29tbWFuZCBvcHRpb25zXG4gICAgY29uc3QgaGFuZHNoYWtlT3B0aW9ucyA9IHsgLi4ub3B0aW9ucywgcmF3OiBmYWxzZSB9O1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5jb25uZWN0VGltZW91dE1TID09PSAnbnVtYmVyJykge1xuICAgICAgICAvLyBUaGUgaGFuZHNoYWtlIHRlY2huaWNhbGx5IGlzIGEgbW9uaXRvcmluZyBjaGVjaywgc28gaXRzIHNvY2tldCB0aW1lb3V0IHNob3VsZCBiZSBjb25uZWN0VGltZW91dE1TXG4gICAgICAgIGhhbmRzaGFrZU9wdGlvbnMuc29ja2V0VGltZW91dE1TID0gb3B0aW9ucy5jb25uZWN0VGltZW91dE1TO1xuICAgIH1cbiAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZXhlY3V0ZUhhbmRzaGFrZShoYW5kc2hha2VEb2MsIGhhbmRzaGFrZU9wdGlvbnMpO1xuICAgIGlmICghKCdpc1dyaXRhYmxlUHJpbWFyeScgaW4gcmVzcG9uc2UpKSB7XG4gICAgICAgIC8vIFByb3ZpZGUgaGVsbG8tc3R5bGUgcmVzcG9uc2UgZG9jdW1lbnQuXG4gICAgICAgIHJlc3BvbnNlLmlzV3JpdGFibGVQcmltYXJ5ID0gcmVzcG9uc2VbY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkRdO1xuICAgIH1cbiAgICBpZiAocmVzcG9uc2UuaGVsbG9Paykge1xuICAgICAgICBjb25uLmhlbGxvT2sgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBzdXBwb3J0ZWRTZXJ2ZXJFcnIgPSBjaGVja1N1cHBvcnRlZFNlcnZlcihyZXNwb25zZSwgb3B0aW9ucyk7XG4gICAgaWYgKHN1cHBvcnRlZFNlcnZlckVycikge1xuICAgICAgICB0aHJvdyBzdXBwb3J0ZWRTZXJ2ZXJFcnI7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICBpZiAoIXJlc3BvbnNlLnNlcnZpY2VJZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoJ0RyaXZlciBhdHRlbXB0ZWQgdG8gaW5pdGlhbGl6ZSBpbiBsb2FkIGJhbGFuY2luZyBtb2RlLCAnICtcbiAgICAgICAgICAgICAgICAnYnV0IHRoZSBzZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIG1vZGUuJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gTk9URTogVGhpcyBpcyBtZXRhZGF0YSBhdHRhY2hlZCB0byB0aGUgY29ubmVjdGlvbiB3aGlsZSBwb3J0aW5nIGF3YXkgZnJvbVxuICAgIC8vICAgICAgIGhhbmRzaGFrZSBiZWluZyBkb25lIGluIHRoZSBgU2VydmVyYCBjbGFzcy4gTGlrZWx5LCBpdCBzaG91bGQgYmVcbiAgICAvLyAgICAgICByZWxvY2F0ZWQsIG9yIGF0IHZlcnkgbGVhc3QgcmVzdHJ1Y3R1cmVkLlxuICAgIGNvbm4uaGVsbG8gPSByZXNwb25zZTtcbiAgICBjb25uLmxhc3RIZWxsb01TID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydDtcbiAgICBpZiAoIXJlc3BvbnNlLmFyYml0ZXJPbmx5ICYmIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIC8vIHN0b3JlIHRoZSByZXNwb25zZSBvbiBhdXRoIGNvbnRleHRcbiAgICAgICAgYXV0aENvbnRleHQucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgICAgY29uc3QgcmVzb2x2ZWRDcmVkZW50aWFscyA9IGNyZWRlbnRpYWxzLnJlc29sdmVBdXRoTWVjaGFuaXNtKHJlc3BvbnNlKTtcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBvcHRpb25zLmF1dGhQcm92aWRlcnMuZ2V0T3JDcmVhdGVQcm92aWRlcihyZXNvbHZlZENyZWRlbnRpYWxzLm1lY2hhbmlzbSwgcmVzb2x2ZWRDcmVkZW50aWFscy5tZWNoYW5pc21Qcm9wZXJ0aWVzKTtcbiAgICAgICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgTm8gQXV0aFByb3ZpZGVyIGZvciAke3Jlc29sdmVkQ3JlZGVudGlhbHMubWVjaGFuaXNtfSBkZWZpbmVkLmApO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBwcm92aWRlci5hdXRoKGF1dGhDb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvcikge1xuICAgICAgICAgICAgICAgIGVycm9yLmFkZEVycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuSGFuZHNoYWtlRXJyb3IpO1xuICAgICAgICAgICAgICAgIGlmICgoMCwgZXJyb3JfMS5uZWVkc1JldHJ5YWJsZVdyaXRlTGFiZWwpKGVycm9yLCByZXNwb25zZS5tYXhXaXJlVmVyc2lvbiwgY29ubi5kZXNjcmlwdGlvbi50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJldHJ5YWJsZVdyaXRlRXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIENvbm5lY3Rpb24gZXN0YWJsaXNobWVudCBpcyBzb2NrZXQgY3JlYXRpb24gKHRjcCBoYW5kc2hha2UsIHRscyBoYW5kc2hha2UsIE1vbmdvREIgaGFuZHNoYWtlIChzYXNsU3RhcnQsIHNhc2xDb250aW51ZSkpXG4gICAgLy8gT25jZSBjb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkLCBjb21tYW5kIGxvZ2dpbmcgY2FuIGxvZyBldmVudHMgKGlmIGVuYWJsZWQpXG4gICAgY29ubi5lc3RhYmxpc2hlZCA9IHRydWU7XG4gICAgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUhhbmRzaGFrZShoYW5kc2hha2VEb2MsIGhhbmRzaGFrZU9wdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGhhbmRzaGFrZVJlc3BvbnNlID0gYXdhaXQgY29ubi5jb21tYW5kKCgwLCB1dGlsc18xLm5zKSgnYWRtaW4uJGNtZCcpLCBoYW5kc2hha2VEb2MsIGhhbmRzaGFrZU9wdGlvbnMpO1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRzaGFrZVJlc3BvbnNlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5IYW5kc2hha2VFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQGludGVybmFsXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBvbmx5IGV4cG9zZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHByZXBhcmVIYW5kc2hha2VEb2N1bWVudChhdXRoQ29udGV4dCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBhdXRoQ29udGV4dC5vcHRpb25zO1xuICAgIGNvbnN0IGNvbXByZXNzb3JzID0gb3B0aW9ucy5jb21wcmVzc29ycyA/IG9wdGlvbnMuY29tcHJlc3NvcnMgOiBbXTtcbiAgICBjb25zdCB7IHNlcnZlckFwaSB9ID0gYXV0aENvbnRleHQuY29ubmVjdGlvbjtcbiAgICBjb25zdCBjbGllbnRNZXRhZGF0YSA9IGF3YWl0IG9wdGlvbnMuZXh0ZW5kZWRNZXRhZGF0YTtcbiAgICBjb25zdCBoYW5kc2hha2VEb2MgPSB7XG4gICAgICAgIFtzZXJ2ZXJBcGk/LnZlcnNpb24gfHwgb3B0aW9ucy5sb2FkQmFsYW5jZWQgPT09IHRydWUgPyAnaGVsbG8nIDogY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkRdOiAxLFxuICAgICAgICBoZWxsb09rOiB0cnVlLFxuICAgICAgICBjbGllbnQ6IGNsaWVudE1ldGFkYXRhLFxuICAgICAgICBjb21wcmVzc2lvbjogY29tcHJlc3NvcnNcbiAgICB9O1xuICAgIGlmIChvcHRpb25zLmxvYWRCYWxhbmNlZCA9PT0gdHJ1ZSkge1xuICAgICAgICBoYW5kc2hha2VEb2MubG9hZEJhbGFuY2VkID0gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBhdXRoQ29udGV4dC5jcmVkZW50aWFscztcbiAgICBpZiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKGNyZWRlbnRpYWxzLm1lY2hhbmlzbSA9PT0gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX0RFRkFVTFQgJiYgY3JlZGVudGlhbHMudXNlcm5hbWUpIHtcbiAgICAgICAgICAgIGhhbmRzaGFrZURvYy5zYXNsU3VwcG9ydGVkTWVjaHMgPSBgJHtjcmVkZW50aWFscy5zb3VyY2V9LiR7Y3JlZGVudGlhbHMudXNlcm5hbWV9YDtcbiAgICAgICAgICAgIGNvbnN0IHByb3ZpZGVyID0gYXV0aENvbnRleHQub3B0aW9ucy5hdXRoUHJvdmlkZXJzLmdldE9yQ3JlYXRlUHJvdmlkZXIocHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1NiwgY3JlZGVudGlhbHMubWVjaGFuaXNtUHJvcGVydGllcyk7XG4gICAgICAgICAgICBpZiAoIXByb3ZpZGVyKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBhdXRoIG1lY2hhbmlzbSBpcyBhbHdheXMgcHJlc2VudC5cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBObyBBdXRoUHJvdmlkZXIgZm9yICR7cHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1Nn0gZGVmaW5lZC5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBwcm92aWRlci5wcmVwYXJlKGhhbmRzaGFrZURvYywgYXV0aENvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gYXV0aENvbnRleHQub3B0aW9ucy5hdXRoUHJvdmlkZXJzLmdldE9yQ3JlYXRlUHJvdmlkZXIoY3JlZGVudGlhbHMubWVjaGFuaXNtLCBjcmVkZW50aWFscy5tZWNoYW5pc21Qcm9wZXJ0aWVzKTtcbiAgICAgICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgTm8gQXV0aFByb3ZpZGVyIGZvciAke2NyZWRlbnRpYWxzLm1lY2hhbmlzbX0gZGVmaW5lZC5gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgcHJvdmlkZXIucHJlcGFyZShoYW5kc2hha2VEb2MsIGF1dGhDb250ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGhhbmRzaGFrZURvYztcbn1cbi8qKiBAcHVibGljICovXG5leHBvcnRzLkxFR0FMX1RMU19TT0NLRVRfT1BUSU9OUyA9IFtcbiAgICAnYWxsb3dQYXJ0aWFsVHJ1c3RDaGFpbicsXG4gICAgJ0FMUE5Qcm90b2NvbHMnLFxuICAgICdjYScsXG4gICAgJ2NlcnQnLFxuICAgICdjaGVja1NlcnZlcklkZW50aXR5JyxcbiAgICAnY2lwaGVycycsXG4gICAgJ2NybCcsXG4gICAgJ2VjZGhDdXJ2ZScsXG4gICAgJ2tleScsXG4gICAgJ21pbkRIU2l6ZScsXG4gICAgJ3Bhc3NwaHJhc2UnLFxuICAgICdwZngnLFxuICAgICdyZWplY3RVbmF1dGhvcml6ZWQnLFxuICAgICdzZWN1cmVDb250ZXh0JyxcbiAgICAnc2VjdXJlUHJvdG9jb2wnLFxuICAgICdzZXJ2ZXJuYW1lJyxcbiAgICAnc2Vzc2lvbidcbl07XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5MRUdBTF9UQ1BfU09DS0VUX09QVElPTlMgPSBbXG4gICAgJ2F1dG9TZWxlY3RGYW1pbHknLFxuICAgICdhdXRvU2VsZWN0RmFtaWx5QXR0ZW1wdFRpbWVvdXQnLFxuICAgICdmYW1pbHknLFxuICAgICdoaW50cycsXG4gICAgJ2xvY2FsQWRkcmVzcycsXG4gICAgJ2xvY2FsUG9ydCcsXG4gICAgJ2xvb2t1cCdcbl07XG5mdW5jdGlvbiBwYXJzZUNvbm5lY3RPcHRpb25zKG9wdGlvbnMpIHtcbiAgICBjb25zdCBob3N0QWRkcmVzcyA9IG9wdGlvbnMuaG9zdEFkZHJlc3M7XG4gICAgaWYgKCFob3N0QWRkcmVzcylcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3B0aW9uIFwiaG9zdEFkZHJlc3NcIiBpcyByZXF1aXJlZCcpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBleHBvcnRzLkxFR0FMX1RDUF9TT0NLRVRfT1BUSU9OUykge1xuICAgICAgICBpZiAob3B0aW9uc1tuYW1lXSAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBvcHRpb25zW25hbWVdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlb2YgaG9zdEFkZHJlc3Muc29ja2V0UGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmVzdWx0LnBhdGggPSBob3N0QWRkcmVzcy5zb2NrZXRQYXRoO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgaG9zdEFkZHJlc3MuaG9zdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmVzdWx0Lmhvc3QgPSBob3N0QWRkcmVzcy5ob3N0O1xuICAgICAgICByZXN1bHQucG9ydCA9IGhvc3RBZGRyZXNzLnBvcnQ7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW4gc2luY2Ugd2Ugc2V0IHVwIEhvc3RBZGRyZXNzZXNcbiAgICAgICAgLy8gQnV0IGlmIHdlIGRvbid0IHRocm93IGhlcmUgdGhlIHNvY2tldCBjb3VsZCBoYW5nIHVudGlsIHRpbWVvdXRcbiAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBVbmV4cGVjdGVkIEhvc3RBZGRyZXNzICR7SlNPTi5zdHJpbmdpZnkoaG9zdEFkZHJlc3MpfWApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHBhcnNlU3NsT3B0aW9ucyhvcHRpb25zKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb25uZWN0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAvLyBNZXJnZSBpbiB2YWxpZCBTU0wgb3B0aW9uc1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBleHBvcnRzLkxFR0FMX1RMU19TT0NLRVRfT1BUSU9OUykge1xuICAgICAgICBpZiAob3B0aW9uc1tuYW1lXSAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBvcHRpb25zW25hbWVdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmV4aXN0aW5nU29ja2V0KSB7XG4gICAgICAgIHJlc3VsdC5zb2NrZXQgPSBvcHRpb25zLmV4aXN0aW5nU29ja2V0O1xuICAgIH1cbiAgICAvLyBTZXQgZGVmYXVsdCBzbmkgc2VydmVybmFtZSB0byBiZSB0aGUgc2FtZSBhcyBob3N0XG4gICAgaWYgKHJlc3VsdC5zZXJ2ZXJuYW1lID09IG51bGwgJiYgcmVzdWx0Lmhvc3QgJiYgIW5ldC5pc0lQKHJlc3VsdC5ob3N0KSkge1xuICAgICAgICByZXN1bHQuc2VydmVybmFtZSA9IHJlc3VsdC5ob3N0O1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuYXN5bmMgZnVuY3Rpb24gbWFrZVNvY2tldChvcHRpb25zKSB7XG4gICAgY29uc3QgdXNlVExTID0gb3B0aW9ucy50bHMgPz8gZmFsc2U7XG4gICAgY29uc3Qgbm9EZWxheSA9IG9wdGlvbnMubm9EZWxheSA/PyB0cnVlO1xuICAgIGNvbnN0IGNvbm5lY3RUaW1lb3V0TVMgPSBvcHRpb25zLmNvbm5lY3RUaW1lb3V0TVMgPz8gMzAwMDA7XG4gICAgY29uc3QgZXhpc3RpbmdTb2NrZXQgPSBvcHRpb25zLmV4aXN0aW5nU29ja2V0O1xuICAgIGxldCBzb2NrZXQ7XG4gICAgaWYgKG9wdGlvbnMucHJveHlIb3N0ICE9IG51bGwpIHtcbiAgICAgICAgLy8gQ3VycmVudGx5LCBvbmx5IFNvY2tzNSBpcyBzdXBwb3J0ZWQuXG4gICAgICAgIHJldHVybiBhd2FpdCBtYWtlU29ja3M1Q29ubmVjdGlvbih7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgY29ubmVjdFRpbWVvdXRNUyAvLyBTaG91bGQgYWx3YXlzIGJlIHByZXNlbnQgZm9yIFNvY2tzNVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHVzZVRMUykge1xuICAgICAgICBjb25zdCB0bHNTb2NrZXQgPSB0bHMuY29ubmVjdChwYXJzZVNzbE9wdGlvbnMob3B0aW9ucykpO1xuICAgICAgICBpZiAodHlwZW9mIHRsc1NvY2tldC5kaXNhYmxlUmVuZWdvdGlhdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGxzU29ja2V0LmRpc2FibGVSZW5lZ290aWF0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgc29ja2V0ID0gdGxzU29ja2V0O1xuICAgIH1cbiAgICBlbHNlIGlmIChleGlzdGluZ1NvY2tldCkge1xuICAgICAgICAvLyBJbiB0aGUgVExTIGNhc2UsIHBhcnNlU3NsT3B0aW9ucygpIHNldHMgb3B0aW9ucy5zb2NrZXQgdG8gZXhpc3RpbmdTb2NrZXQsXG4gICAgICAgIC8vIHNvIHdlIG9ubHkgbmVlZCB0byBoYW5kbGUgdGhlIG5vbi1UTFMgY2FzZSBoZXJlICh3aGVyZSBleGlzdGluZ1NvY2tldFxuICAgICAgICAvLyBnaXZlcyB1cyBhbGwgd2UgbmVlZCBvdXQgb2YgdGhlIGJveCkuXG4gICAgICAgIHNvY2tldCA9IGV4aXN0aW5nU29ja2V0O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc29ja2V0ID0gbmV0LmNyZWF0ZUNvbm5lY3Rpb24ocGFyc2VDb25uZWN0T3B0aW9ucyhvcHRpb25zKSk7XG4gICAgfVxuICAgIHNvY2tldC5zZXRLZWVwQWxpdmUodHJ1ZSwgMzAwMDAwKTtcbiAgICBzb2NrZXQuc2V0VGltZW91dChjb25uZWN0VGltZW91dE1TKTtcbiAgICBzb2NrZXQuc2V0Tm9EZWxheShub0RlbGF5KTtcbiAgICBsZXQgY2FuY2VsbGF0aW9uSGFuZGxlciA9IG51bGw7XG4gICAgY29uc3QgeyBwcm9taXNlOiBjb25uZWN0ZWRTb2NrZXQsIHJlc29sdmUsIHJlamVjdCB9ID0gKDAsIHV0aWxzXzEucHJvbWlzZVdpdGhSZXNvbHZlcnMpKCk7XG4gICAgaWYgKGV4aXN0aW5nU29ja2V0KSB7XG4gICAgICAgIHJlc29sdmUoc29ja2V0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGNvbnN0IGNvbm5lY3RFdmVudCA9IHVzZVRMUyA/ICdzZWN1cmVDb25uZWN0JyA6ICdjb25uZWN0JztcbiAgICAgICAgc29ja2V0XG4gICAgICAgICAgICAub25jZShjb25uZWN0RXZlbnQsICgpID0+IHJlc29sdmUoc29ja2V0KSlcbiAgICAgICAgICAgIC5vbmNlKCdlcnJvcicsIGNhdXNlID0+IHJlamVjdChuZXcgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvcihlcnJvcl8xLk1vbmdvRXJyb3IuYnVpbGRFcnJvck1lc3NhZ2UoY2F1c2UpLCB7IGNhdXNlIH0pKSlcbiAgICAgICAgICAgIC5vbmNlKCd0aW1lb3V0JywgKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcihgU29ja2V0ICcke2Nvbm5lY3RFdmVudH0nIHRpbWVkIG91dCBhZnRlciAkeyhwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0KSB8IDB9bXMgKGNvbm5lY3RUaW1lb3V0TVM6ICR7Y29ubmVjdFRpbWVvdXRNU30pYCkpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uY2UoJ2Nsb3NlJywgKCkgPT4gcmVqZWN0KG5ldyBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yKGBTb2NrZXQgY2xvc2VkIGFmdGVyICR7KHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQpIHwgMH0gZHVyaW5nIGNvbm5lY3Rpb24gZXN0YWJsaXNobWVudGApKSk7XG4gICAgICAgIGlmIChvcHRpb25zLmNhbmNlbGxhdGlvblRva2VuICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNhbmNlbGxhdGlvbkhhbmRsZXIgPSAoKSA9PiByZWplY3QobmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IoYFNvY2tldCBjb25uZWN0aW9uIGVzdGFibGlzaG1lbnQgd2FzIGNhbmNlbGxlZCBhZnRlciAkeyhwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0KSB8IDB9YCkpO1xuICAgICAgICAgICAgb3B0aW9ucy5jYW5jZWxsYXRpb25Ub2tlbi5vbmNlKCdjYW5jZWwnLCBjYW5jZWxsYXRpb25IYW5kbGVyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBzb2NrZXQgPSBhd2FpdCBjb25uZWN0ZWRTb2NrZXQ7XG4gICAgICAgIHJldHVybiBzb2NrZXQ7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBzb2NrZXQuZGVzdHJveSgpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHNvY2tldC5zZXRUaW1lb3V0KDApO1xuICAgICAgICBpZiAoY2FuY2VsbGF0aW9uSGFuZGxlciAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcHRpb25zLmNhbmNlbGxhdGlvblRva2VuPy5yZW1vdmVMaXN0ZW5lcignY2FuY2VsJywgY2FuY2VsbGF0aW9uSGFuZGxlcik7XG4gICAgICAgIH1cbiAgICB9XG59XG5sZXQgc29ja3MgPSBudWxsO1xuZnVuY3Rpb24gbG9hZFNvY2tzKCkge1xuICAgIGlmIChzb2NrcyA9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IHNvY2tzSW1wb3J0ID0gKDAsIGRlcHNfMS5nZXRTb2NrcykoKTtcbiAgICAgICAgaWYgKCdrTW9kdWxlRXJyb3InIGluIHNvY2tzSW1wb3J0KSB7XG4gICAgICAgICAgICB0aHJvdyBzb2Nrc0ltcG9ydC5rTW9kdWxlRXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgc29ja3MgPSBzb2Nrc0ltcG9ydDtcbiAgICB9XG4gICAgcmV0dXJuIHNvY2tzO1xufVxuYXN5bmMgZnVuY3Rpb24gbWFrZVNvY2tzNUNvbm5lY3Rpb24ob3B0aW9ucykge1xuICAgIGNvbnN0IGhvc3RBZGRyZXNzID0gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tSG9zdFBvcnQob3B0aW9ucy5wcm94eUhvc3QgPz8gJycsIC8vIHByb3h5SG9zdCBpcyBndWFyYW50ZWVkIHRvIHNldCBoZXJlXG4gICAgb3B0aW9ucy5wcm94eVBvcnQgPz8gMTA4MCk7XG4gICAgLy8gRmlyc3QsIGNvbm5lY3QgdG8gdGhlIHByb3h5IHNlcnZlciBpdHNlbGY6XG4gICAgY29uc3QgcmF3U29ja2V0ID0gYXdhaXQgbWFrZVNvY2tldCh7XG4gICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIGhvc3RBZGRyZXNzLFxuICAgICAgICB0bHM6IGZhbHNlLFxuICAgICAgICBwcm94eUhvc3Q6IHVuZGVmaW5lZFxuICAgIH0pO1xuICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gcGFyc2VDb25uZWN0T3B0aW9ucyhvcHRpb25zKTtcbiAgICBpZiAodHlwZW9mIGRlc3RpbmF0aW9uLmhvc3QgIT09ICdzdHJpbmcnIHx8IHR5cGVvZiBkZXN0aW5hdGlvbi5wb3J0ICE9PSAnbnVtYmVyJykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDYW4gb25seSBtYWtlIFNvY2tzNSBjb25uZWN0aW9ucyB0byBUQ1AgaG9zdHMnKTtcbiAgICB9XG4gICAgc29ja3MgPz89IGxvYWRTb2NrcygpO1xuICAgIGxldCBleGlzdGluZ1NvY2tldDtcbiAgICB0cnkge1xuICAgICAgICAvLyBUaGVuLCBlc3RhYmxpc2ggdGhlIFNvY2tzNSBwcm94eSBjb25uZWN0aW9uOlxuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gYXdhaXQgc29ja3MuU29ja3NDbGllbnQuY3JlYXRlQ29ubmVjdGlvbih7XG4gICAgICAgICAgICBleGlzdGluZ19zb2NrZXQ6IHJhd1NvY2tldCxcbiAgICAgICAgICAgIHRpbWVvdXQ6IG9wdGlvbnMuY29ubmVjdFRpbWVvdXRNUyxcbiAgICAgICAgICAgIGNvbW1hbmQ6ICdjb25uZWN0JyxcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgaG9zdDogZGVzdGluYXRpb24uaG9zdCxcbiAgICAgICAgICAgICAgICBwb3J0OiBkZXN0aW5hdGlvbi5wb3J0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJveHk6IHtcbiAgICAgICAgICAgICAgICAvLyBob3N0IGFuZCBwb3J0IGFyZSBpZ25vcmVkIGJlY2F1c2Ugd2UgcGFzcyBleGlzdGluZ19zb2NrZXRcbiAgICAgICAgICAgICAgICBob3N0OiAnaUxvdmVKYXZhU2NyaXB0JyxcbiAgICAgICAgICAgICAgICBwb3J0OiAwLFxuICAgICAgICAgICAgICAgIHR5cGU6IDUsXG4gICAgICAgICAgICAgICAgdXNlcklkOiBvcHRpb25zLnByb3h5VXNlcm5hbWUgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBvcHRpb25zLnByb3h5UGFzc3dvcmQgfHwgdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBleGlzdGluZ1NvY2tldCA9IGNvbm5lY3Rpb24uc29ja2V0O1xuICAgIH1cbiAgICBjYXRjaCAoY2F1c2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IoZXJyb3JfMS5Nb25nb0Vycm9yLmJ1aWxkRXJyb3JNZXNzYWdlKGNhdXNlKSwgeyBjYXVzZSB9KTtcbiAgICB9XG4gICAgLy8gRmluYWxseSwgbm93IHRyZWF0IHRoZSByZXN1bHRpbmcgZHVwbGV4IHN0cmVhbSBhcyB0aGVcbiAgICAvLyBzb2NrZXQgb3ZlciB3aGljaCB3ZSBzZW5kIGFuZCByZWNlaXZlIHdpcmUgcHJvdG9jb2wgbWVzc2FnZXM6XG4gICAgcmV0dXJuIGF3YWl0IG1ha2VTb2NrZXQoeyAuLi5vcHRpb25zLCBleGlzdGluZ1NvY2tldCwgcHJveHlIb3N0OiB1bmRlZmluZWQgfSk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25uZWN0LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connect.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CryptoConnection = exports.SizedMessageTransform = exports.Connection = void 0;\nexports.hasSessionSupport = hasSessionSupport;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ../mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ../sdam/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst sessions_1 = __webpack_require__(/*! ../sessions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_monitoring_events_1 = __webpack_require__(/*! ./command_monitoring_events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/command_monitoring_events.js\");\nconst commands_1 = __webpack_require__(/*! ./commands */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js\");\nconst stream_description_1 = __webpack_require__(/*! ./stream_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/stream_description.js\");\nconst compression_1 = __webpack_require__(/*! ./wire_protocol/compression */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nconst on_data_1 = __webpack_require__(/*! ./wire_protocol/on_data */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_data.js\");\nconst responses_1 = __webpack_require__(/*! ./wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst shared_1 = __webpack_require__(/*! ./wire_protocol/shared */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/shared.js\");\n/** @internal */\nfunction hasSessionSupport(conn) {\n    const description = conn.description;\n    return description.logicalSessionTimeoutMinutes != null;\n}\nfunction streamIdentifier(stream, options) {\n    if (options.proxyHost) {\n        // If proxy options are specified, the properties of `stream` itself\n        // will not accurately reflect what endpoint this is connected to.\n        return options.hostAddress.toString();\n    }\n    const { remoteAddress, remotePort } = stream;\n    if (typeof remoteAddress === 'string' && typeof remotePort === 'number') {\n        return utils_1.HostAddress.fromHostPort(remoteAddress, remotePort).toString();\n    }\n    return (0, utils_1.uuidV4)().toString('hex');\n}\n/** @internal */\nclass Connection extends mongo_types_1.TypedEventEmitter {\n    constructor(stream, options) {\n        super();\n        this.lastHelloMS = -1;\n        this.helloOk = false;\n        this.delayedTimeoutId = null;\n        /** Indicates that the connection (including underlying TCP socket) has been closed. */\n        this.closed = false;\n        this.clusterTime = null;\n        this.error = null;\n        this.dataEvents = null;\n        this.on('error', utils_1.noop);\n        this.socket = stream;\n        this.id = options.id;\n        this.address = streamIdentifier(stream, options);\n        this.socketTimeoutMS = options.socketTimeoutMS ?? 0;\n        this.monitorCommands = options.monitorCommands;\n        this.serverApi = options.serverApi;\n        this.mongoLogger = options.mongoLogger;\n        this.established = false;\n        this.description = new stream_description_1.StreamDescription(this.address, options);\n        this.generation = options.generation;\n        this.lastUseTime = (0, utils_1.now)();\n        this.messageStream = this.socket\n            .on('error', this.onError.bind(this))\n            .pipe(new SizedMessageTransform({ connection: this }))\n            .on('error', this.onError.bind(this));\n        this.socket.on('close', this.onClose.bind(this));\n        this.socket.on('timeout', this.onTimeout.bind(this));\n        this.messageStream.pause();\n    }\n    get hello() {\n        return this.description.hello;\n    }\n    // the `connect` method stores the result of the handshake hello on the connection\n    set hello(response) {\n        this.description.receiveResponse(response);\n        Object.freeze(this.description);\n    }\n    get serviceId() {\n        return this.hello?.serviceId;\n    }\n    get loadBalanced() {\n        return this.description.loadBalanced;\n    }\n    get idleTime() {\n        return (0, utils_1.calculateDurationInMs)(this.lastUseTime);\n    }\n    get hasSessionSupport() {\n        return this.description.logicalSessionTimeoutMinutes != null;\n    }\n    get supportsOpMsg() {\n        return (this.description != null &&\n            (0, utils_1.maxWireVersion)(this) >= 6 &&\n            !this.description.__nodejs_mock_server__);\n    }\n    get shouldEmitAndLogCommand() {\n        return ((this.monitorCommands ||\n            (this.established &&\n                !this.authContext?.reauthenticating &&\n                this.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.COMMAND, mongo_logger_1.SeverityLevel.DEBUG))) ??\n            false);\n    }\n    markAvailable() {\n        this.lastUseTime = (0, utils_1.now)();\n    }\n    onError(error) {\n        this.cleanup(error);\n    }\n    onClose() {\n        const message = `connection ${this.id} to ${this.address} closed`;\n        this.cleanup(new error_1.MongoNetworkError(message));\n    }\n    onTimeout() {\n        this.delayedTimeoutId = (0, timers_1.setTimeout)(() => {\n            const message = `connection ${this.id} to ${this.address} timed out`;\n            const beforeHandshake = this.hello == null;\n            this.cleanup(new error_1.MongoNetworkTimeoutError(message, { beforeHandshake }));\n        }, 1).unref(); // No need for this timer to hold the event loop open\n    }\n    destroy() {\n        if (this.closed) {\n            return;\n        }\n        // load balanced mode requires that these listeners remain on the connection\n        // after cleanup on timeouts, errors or close so we remove them before calling\n        // cleanup.\n        this.removeAllListeners(Connection.PINNED);\n        this.removeAllListeners(Connection.UNPINNED);\n        const message = `connection ${this.id} to ${this.address} closed`;\n        this.cleanup(new error_1.MongoNetworkError(message));\n    }\n    /**\n     * A method that cleans up the connection.  When `force` is true, this method\n     * forcibly destroys the socket.\n     *\n     * If an error is provided, any in-flight operations will be closed with the error.\n     *\n     * This method does nothing if the connection is already closed.\n     */\n    cleanup(error) {\n        if (this.closed) {\n            return;\n        }\n        this.socket.destroy();\n        this.error = error;\n        this.dataEvents?.throw(error).then(undefined, utils_1.squashError);\n        this.closed = true;\n        this.emit(Connection.CLOSE);\n    }\n    prepareCommand(db, command, options) {\n        let cmd = { ...command };\n        const readPreference = (0, shared_1.getReadPreference)(options);\n        const session = options?.session;\n        let clusterTime = this.clusterTime;\n        if (this.serverApi) {\n            const { version, strict, deprecationErrors } = this.serverApi;\n            cmd.apiVersion = version;\n            if (strict != null)\n                cmd.apiStrict = strict;\n            if (deprecationErrors != null)\n                cmd.apiDeprecationErrors = deprecationErrors;\n        }\n        if (this.hasSessionSupport && session) {\n            if (session.clusterTime &&\n                clusterTime &&\n                session.clusterTime.clusterTime.greaterThan(clusterTime.clusterTime)) {\n                clusterTime = session.clusterTime;\n            }\n            const sessionError = (0, sessions_1.applySession)(session, cmd, options);\n            if (sessionError)\n                throw sessionError;\n        }\n        else if (session?.explicit) {\n            throw new error_1.MongoCompatibilityError('Current topology does not support sessions');\n        }\n        // if we have a known cluster time, gossip it\n        if (clusterTime) {\n            cmd.$clusterTime = clusterTime;\n        }\n        // For standalone, drivers MUST NOT set $readPreference.\n        if (this.description.type !== common_1.ServerType.Standalone) {\n            if (!(0, shared_1.isSharded)(this) &&\n                !this.description.loadBalanced &&\n                this.supportsOpMsg &&\n                options.directConnection === true &&\n                readPreference?.mode === 'primary') {\n                // For mongos and load balancers with 'primary' mode, drivers MUST NOT set $readPreference.\n                // For all other types with a direct connection, if the read preference is 'primary'\n                // (driver sets 'primary' as default if no read preference is configured),\n                // the $readPreference MUST be set to 'primaryPreferred'\n                // to ensure that any server type can handle the request.\n                cmd.$readPreference = read_preference_1.ReadPreference.primaryPreferred.toJSON();\n            }\n            else if ((0, shared_1.isSharded)(this) && !this.supportsOpMsg && readPreference?.mode !== 'primary') {\n                // When sending a read operation via OP_QUERY and the $readPreference modifier,\n                // the query MUST be provided using the $query modifier.\n                cmd = {\n                    $query: cmd,\n                    $readPreference: readPreference.toJSON()\n                };\n            }\n            else if (readPreference?.mode !== 'primary') {\n                // For mode 'primary', drivers MUST NOT set $readPreference.\n                // For all other read preference modes (i.e. 'secondary', 'primaryPreferred', ...),\n                // drivers MUST set $readPreference\n                cmd.$readPreference = readPreference.toJSON();\n            }\n        }\n        const commandOptions = {\n            numberToSkip: 0,\n            numberToReturn: -1,\n            checkKeys: false,\n            // This value is not overridable\n            secondaryOk: readPreference.secondaryOk(),\n            ...options\n        };\n        options.timeoutContext?.addMaxTimeMSToCommand(cmd, options);\n        const message = this.supportsOpMsg\n            ? new commands_1.OpMsgRequest(db, cmd, commandOptions)\n            : new commands_1.OpQueryRequest(db, cmd, commandOptions);\n        return message;\n    }\n    async *sendWire(message, options, responseType) {\n        this.throwIfAborted();\n        const timeout = options.socketTimeoutMS ??\n            options?.timeoutContext?.getSocketTimeoutMS() ??\n            this.socketTimeoutMS;\n        this.socket.setTimeout(timeout);\n        try {\n            await this.writeCommand(message, {\n                agreedCompressor: this.description.compressor ?? 'none',\n                zlibCompressionLevel: this.description.zlibCompressionLevel,\n                timeoutContext: options.timeoutContext,\n                signal: options.signal\n            });\n            if (options.noResponse || message.moreToCome) {\n                yield responses_1.MongoDBResponse.empty;\n                return;\n            }\n            this.throwIfAborted();\n            if (options.timeoutContext?.csotEnabled() &&\n                options.timeoutContext.minRoundTripTime != null &&\n                options.timeoutContext.remainingTimeMS < options.timeoutContext.minRoundTripTime) {\n                throw new error_1.MongoOperationTimeoutError('Server roundtrip time is greater than the time remaining');\n            }\n            for await (const response of this.readMany(options)) {\n                this.socket.setTimeout(0);\n                const bson = response.parse();\n                const document = (responseType ?? responses_1.MongoDBResponse).make(bson);\n                yield document;\n                this.throwIfAborted();\n                this.socket.setTimeout(timeout);\n            }\n        }\n        finally {\n            this.socket.setTimeout(0);\n        }\n    }\n    async *sendCommand(ns, command, options, responseType) {\n        options?.signal?.throwIfAborted();\n        const message = this.prepareCommand(ns.db, command, options);\n        let started = 0;\n        if (this.shouldEmitAndLogCommand) {\n            started = (0, utils_1.now)();\n            this.emitAndLogCommand(this.monitorCommands, Connection.COMMAND_STARTED, message.databaseName, this.established, new command_monitoring_events_1.CommandStartedEvent(this, message, this.description.serverConnectionId));\n        }\n        // If `documentsReturnedIn` not set or raw is not enabled, use input bson options\n        // Otherwise, support raw flag. Raw only works for cursors that hardcode firstBatch/nextBatch fields\n        const bsonOptions = options.documentsReturnedIn == null || !options.raw\n            ? options\n            : {\n                ...options,\n                raw: false,\n                fieldsAsRaw: { [options.documentsReturnedIn]: true }\n            };\n        /** MongoDBResponse instance or subclass */\n        let document = undefined;\n        /** Cached result of a toObject call */\n        let object = undefined;\n        try {\n            this.throwIfAborted();\n            for await (document of this.sendWire(message, options, responseType)) {\n                object = undefined;\n                if (options.session != null) {\n                    (0, sessions_1.updateSessionFromResponse)(options.session, document);\n                }\n                if (document.$clusterTime) {\n                    this.clusterTime = document.$clusterTime;\n                    this.emit(Connection.CLUSTER_TIME_RECEIVED, document.$clusterTime);\n                }\n                if (document.ok === 0) {\n                    if (options.timeoutContext?.csotEnabled() && document.isMaxTimeExpiredError) {\n                        throw new error_1.MongoOperationTimeoutError('Server reported a timeout error', {\n                            cause: new error_1.MongoServerError((object ??= document.toObject(bsonOptions)))\n                        });\n                    }\n                    throw new error_1.MongoServerError((object ??= document.toObject(bsonOptions)));\n                }\n                if (this.shouldEmitAndLogCommand) {\n                    this.emitAndLogCommand(this.monitorCommands, Connection.COMMAND_SUCCEEDED, message.databaseName, this.established, new command_monitoring_events_1.CommandSucceededEvent(this, message, options.noResponse\n                        ? undefined\n                        : message.moreToCome\n                            ? { ok: 1 }\n                            : (object ??= document.toObject(bsonOptions)), started, this.description.serverConnectionId));\n                }\n                if (responseType == null) {\n                    yield (object ??= document.toObject(bsonOptions));\n                }\n                else {\n                    yield document;\n                }\n                this.throwIfAborted();\n            }\n        }\n        catch (error) {\n            if (this.shouldEmitAndLogCommand) {\n                this.emitAndLogCommand(this.monitorCommands, Connection.COMMAND_FAILED, message.databaseName, this.established, new command_monitoring_events_1.CommandFailedEvent(this, message, error, started, this.description.serverConnectionId));\n            }\n            throw error;\n        }\n    }\n    async command(ns, command, options = {}, responseType) {\n        this.throwIfAborted();\n        options.signal?.throwIfAborted();\n        for await (const document of this.sendCommand(ns, command, options, responseType)) {\n            if (options.timeoutContext?.csotEnabled()) {\n                if (responses_1.MongoDBResponse.is(document)) {\n                    if (document.isMaxTimeExpiredError) {\n                        throw new error_1.MongoOperationTimeoutError('Server reported a timeout error', {\n                            cause: new error_1.MongoServerError(document.toObject())\n                        });\n                    }\n                }\n                else {\n                    if ((Array.isArray(document?.writeErrors) &&\n                        document.writeErrors.some(error => error?.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired)) ||\n                        document?.writeConcernError?.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired) {\n                        throw new error_1.MongoOperationTimeoutError('Server reported a timeout error', {\n                            cause: new error_1.MongoServerError(document)\n                        });\n                    }\n                }\n            }\n            return document;\n        }\n        throw new error_1.MongoUnexpectedServerResponseError('Unable to get response from server');\n    }\n    exhaustCommand(ns, command, options, replyListener) {\n        const exhaustLoop = async () => {\n            this.throwIfAborted();\n            for await (const reply of this.sendCommand(ns, command, options)) {\n                replyListener(undefined, reply);\n                this.throwIfAborted();\n            }\n            throw new error_1.MongoUnexpectedServerResponseError('Server ended moreToCome unexpectedly');\n        };\n        exhaustLoop().then(undefined, replyListener);\n    }\n    throwIfAborted() {\n        if (this.error)\n            throw this.error;\n    }\n    /**\n     * @internal\n     *\n     * Writes an OP_MSG or OP_QUERY request to the socket, optionally compressing the command. This method\n     * waits until the socket's buffer has emptied (the Nodejs socket `drain` event has fired).\n     */\n    async writeCommand(command, options) {\n        const finalCommand = options.agreedCompressor === 'none' || !commands_1.OpCompressedRequest.canCompress(command)\n            ? command\n            : new commands_1.OpCompressedRequest(command, {\n                agreedCompressor: options.agreedCompressor ?? 'none',\n                zlibCompressionLevel: options.zlibCompressionLevel ?? 0\n            });\n        const buffer = Buffer.concat(await finalCommand.toBin());\n        if (options.timeoutContext?.csotEnabled()) {\n            if (options.timeoutContext.minRoundTripTime != null &&\n                options.timeoutContext.remainingTimeMS < options.timeoutContext.minRoundTripTime) {\n                throw new error_1.MongoOperationTimeoutError('Server roundtrip time is greater than the time remaining');\n            }\n        }\n        if (this.socket.write(buffer))\n            return;\n        const drainEvent = (0, utils_1.once)(this.socket, 'drain', options);\n        const timeout = options?.timeoutContext?.timeoutForSocketWrite;\n        const drained = timeout ? Promise.race([drainEvent, timeout]) : drainEvent;\n        try {\n            return await drained;\n        }\n        catch (writeError) {\n            if (timeout_1.TimeoutError.is(writeError)) {\n                const timeoutError = new error_1.MongoOperationTimeoutError('Timed out at socket write');\n                this.onError(timeoutError);\n                throw timeoutError;\n            }\n            else if (writeError === options.signal?.reason) {\n                this.onError(writeError);\n            }\n            throw writeError;\n        }\n        finally {\n            timeout?.clear();\n        }\n    }\n    /**\n     * @internal\n     *\n     * Returns an async generator that yields full wire protocol messages from the underlying socket.  This function\n     * yields messages until `moreToCome` is false or not present in a response, or the caller cancels the request\n     * by calling `return` on the generator.\n     *\n     * Note that `for-await` loops call `return` automatically when the loop is exited.\n     */\n    async *readMany(options) {\n        try {\n            this.dataEvents = (0, on_data_1.onData)(this.messageStream, options);\n            this.messageStream.resume();\n            for await (const message of this.dataEvents) {\n                const response = await (0, compression_1.decompressResponse)(message);\n                yield response;\n                if (!response.moreToCome) {\n                    return;\n                }\n            }\n        }\n        catch (readError) {\n            if (timeout_1.TimeoutError.is(readError)) {\n                const timeoutError = new error_1.MongoOperationTimeoutError(`Timed out during socket read (${readError.duration}ms)`);\n                this.dataEvents = null;\n                this.onError(timeoutError);\n                throw timeoutError;\n            }\n            else if (readError === options.signal?.reason) {\n                this.onError(readError);\n            }\n            throw readError;\n        }\n        finally {\n            this.dataEvents = null;\n            this.messageStream.pause();\n            this.throwIfAborted();\n        }\n    }\n}\nexports.Connection = Connection;\n/** @event */\nConnection.COMMAND_STARTED = constants_1.COMMAND_STARTED;\n/** @event */\nConnection.COMMAND_SUCCEEDED = constants_1.COMMAND_SUCCEEDED;\n/** @event */\nConnection.COMMAND_FAILED = constants_1.COMMAND_FAILED;\n/** @event */\nConnection.CLUSTER_TIME_RECEIVED = constants_1.CLUSTER_TIME_RECEIVED;\n/** @event */\nConnection.CLOSE = constants_1.CLOSE;\n/** @event */\nConnection.PINNED = constants_1.PINNED;\n/** @event */\nConnection.UNPINNED = constants_1.UNPINNED;\n/** @internal */\nclass SizedMessageTransform extends stream_1.Transform {\n    constructor({ connection }) {\n        super({ writableObjectMode: false, readableObjectMode: true });\n        this.bufferPool = new utils_1.BufferPool();\n        this.connection = connection;\n    }\n    _transform(chunk, encoding, callback) {\n        if (this.connection.delayedTimeoutId != null) {\n            (0, timers_1.clearTimeout)(this.connection.delayedTimeoutId);\n            this.connection.delayedTimeoutId = null;\n        }\n        this.bufferPool.append(chunk);\n        while (this.bufferPool.length) {\n            // While there are any bytes in the buffer\n            // Try to fetch a size from the top 4 bytes\n            const sizeOfMessage = this.bufferPool.getInt32();\n            if (sizeOfMessage == null) {\n                // Not even an int32 worth of data. Stop the loop, we need more chunks.\n                break;\n            }\n            if (sizeOfMessage < 0) {\n                // The size in the message has a negative value, this is probably corruption, throw:\n                return callback(new error_1.MongoParseError(`Message size cannot be negative: ${sizeOfMessage}`));\n            }\n            if (sizeOfMessage > this.bufferPool.length) {\n                // We do not have enough bytes to make a sizeOfMessage chunk\n                break;\n            }\n            // Add a message to the stream\n            const message = this.bufferPool.read(sizeOfMessage);\n            if (!this.push(message)) {\n                // We only subscribe to data events so we should never get backpressure\n                // if we do, we do not have the handling for it.\n                return callback(new error_1.MongoRuntimeError(`SizedMessageTransform does not support backpressure`));\n            }\n        }\n        callback();\n    }\n}\nexports.SizedMessageTransform = SizedMessageTransform;\n/** @internal */\nclass CryptoConnection extends Connection {\n    constructor(stream, options) {\n        super(stream, options);\n        this.autoEncrypter = options.autoEncrypter;\n    }\n    async command(ns, cmd, options, responseType) {\n        const { autoEncrypter } = this;\n        if (!autoEncrypter) {\n            // TODO(NODE-6065): throw a MongoRuntimeError in Node V7\n            // @ts-expect-error No cause provided because there is no underlying error.\n            throw new error_1.MongoMissingDependencyError('No AutoEncrypter available for encryption', {\n                dependencyName: 'n/a'\n            });\n        }\n        const serverWireVersion = (0, utils_1.maxWireVersion)(this);\n        if (serverWireVersion === 0) {\n            // This means the initial handshake hasn't happened yet\n            return await super.command(ns, cmd, options, responseType);\n        }\n        if (serverWireVersion < 8) {\n            throw new error_1.MongoCompatibilityError('Auto-encryption requires a minimum MongoDB version of 4.2');\n        }\n        // Save sort or indexKeys based on the command being run\n        // the encrypt API serializes our JS objects to BSON to pass to the native code layer\n        // and then deserializes the encrypted result, the protocol level components\n        // of the command (ex. sort) are then converted to JS objects potentially losing\n        // import key order information. These fields are never encrypted so we can save the values\n        // from before the encryption and replace them after encryption has been performed\n        const sort = cmd.find || cmd.findAndModify ? cmd.sort : null;\n        const indexKeys = cmd.createIndexes\n            ? cmd.indexes.map((index) => index.key)\n            : null;\n        const encrypted = await autoEncrypter.encrypt(ns.toString(), cmd, options);\n        // Replace the saved values\n        if (sort != null && (cmd.find || cmd.findAndModify)) {\n            encrypted.sort = sort;\n        }\n        if (indexKeys != null && cmd.createIndexes) {\n            for (const [offset, index] of indexKeys.entries()) {\n                // @ts-expect-error `encrypted` is a generic \"command\", but we've narrowed for only `createIndexes` commands here\n                encrypted.indexes[offset].key = index;\n            }\n        }\n        const encryptedResponse = await super.command(ns, encrypted, options, \n        // Eventually we want to require `responseType` which means we would satisfy `T` as the return type.\n        // In the meantime, we want encryptedResponse to always be _at least_ a MongoDBResponse if not a more specific subclass\n        // So that we can ensure we have access to the on-demand APIs for decorate response\n        responseType ?? responses_1.MongoDBResponse);\n        const result = await autoEncrypter.decrypt(encryptedResponse.toBytes(), options);\n        const decryptedResponse = responseType?.make(result) ?? (0, bson_1.deserialize)(result, options);\n        if (autoEncrypter[constants_1.kDecorateResult]) {\n            if (responseType == null) {\n                (0, utils_1.decorateDecryptionResult)(decryptedResponse, encryptedResponse.toObject(), true);\n            }\n            else if (decryptedResponse instanceof responses_1.CursorResponse) {\n                decryptedResponse.encryptedResponse = encryptedResponse;\n            }\n        }\n        return decryptedResponse;\n    }\n}\nexports.CryptoConnection = CryptoConnection;\n//# sourceMappingURL=connection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29ubmVjdGlvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx3QkFBd0IsR0FBRyw2QkFBNkIsR0FBRyxrQkFBa0I7QUFDN0UseUJBQXlCO0FBQ3pCLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyxvQkFBb0IsbUJBQU8sQ0FBQyxxR0FBYztBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyx1QkFBdUIsbUJBQU8sQ0FBQywyR0FBaUI7QUFDaEQsc0JBQXNCLG1CQUFPLENBQUMseUdBQWdCO0FBQzlDLDBCQUEwQixtQkFBTyxDQUFDLGlIQUFvQjtBQUN0RCxpQkFBaUIsbUJBQU8sQ0FBQyx5R0FBZ0I7QUFDekMsbUJBQW1CLG1CQUFPLENBQUMsbUdBQWE7QUFDeEMsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsb0NBQW9DLG1CQUFPLENBQUMseUlBQTZCO0FBQ3pFLG1CQUFtQixtQkFBTyxDQUFDLHVHQUFZO0FBQ3ZDLDZCQUE2QixtQkFBTyxDQUFDLDJIQUFzQjtBQUMzRCxzQkFBc0IsbUJBQU8sQ0FBQyx5SUFBNkI7QUFDM0Qsa0JBQWtCLG1CQUFPLENBQUMsaUlBQXlCO0FBQ25ELG9CQUFvQixtQkFBTyxDQUFDLHFJQUEyQjtBQUN2RCxpQkFBaUIsbUJBQU8sQ0FBQywrSEFBd0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNEJBQTRCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLGtCQUFrQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLFNBQVMsS0FBSyxjQUFjO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLFNBQVMsS0FBSyxjQUFjO0FBQ3RFO0FBQ0EseUVBQXlFLGlCQUFpQjtBQUMxRixTQUFTLGNBQWM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsU0FBUyxLQUFLLGNBQWM7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHFDQUFxQztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZHQUE2RyxtQkFBbUI7QUFDaEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsWUFBWTtBQUM5QixnQkFBZ0IscURBQXFEO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHLGNBQWM7QUFDOUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsZ0JBQWdCO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9jb25uZWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DcnlwdG9Db25uZWN0aW9uID0gZXhwb3J0cy5TaXplZE1lc3NhZ2VUcmFuc2Zvcm0gPSBleHBvcnRzLkNvbm5lY3Rpb24gPSB2b2lkIDA7XG5leHBvcnRzLmhhc1Nlc3Npb25TdXBwb3J0ID0gaGFzU2Vzc2lvblN1cHBvcnQ7XG5jb25zdCBzdHJlYW1fMSA9IHJlcXVpcmUoXCJzdHJlYW1cIik7XG5jb25zdCB0aW1lcnNfMSA9IHJlcXVpcmUoXCJ0aW1lcnNcIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb19sb2dnZXJfMSA9IHJlcXVpcmUoXCIuLi9tb25nb19sb2dnZXJcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vc2RhbS9jb21tb25cIik7XG5jb25zdCBzZXNzaW9uc18xID0gcmVxdWlyZShcIi4uL3Nlc3Npb25zXCIpO1xuY29uc3QgdGltZW91dF8xID0gcmVxdWlyZShcIi4uL3RpbWVvdXRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c18xID0gcmVxdWlyZShcIi4vY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c1wiKTtcbmNvbnN0IGNvbW1hbmRzXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kc1wiKTtcbmNvbnN0IHN0cmVhbV9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4vc3RyZWFtX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgY29tcHJlc3Npb25fMSA9IHJlcXVpcmUoXCIuL3dpcmVfcHJvdG9jb2wvY29tcHJlc3Npb25cIik7XG5jb25zdCBvbl9kYXRhXzEgPSByZXF1aXJlKFwiLi93aXJlX3Byb3RvY29sL29uX2RhdGFcIik7XG5jb25zdCByZXNwb25zZXNfMSA9IHJlcXVpcmUoXCIuL3dpcmVfcHJvdG9jb2wvcmVzcG9uc2VzXCIpO1xuY29uc3Qgc2hhcmVkXzEgPSByZXF1aXJlKFwiLi93aXJlX3Byb3RvY29sL3NoYXJlZFwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGhhc1Nlc3Npb25TdXBwb3J0KGNvbm4pIHtcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGNvbm4uZGVzY3JpcHRpb247XG4gICAgcmV0dXJuIGRlc2NyaXB0aW9uLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgIT0gbnVsbDtcbn1cbmZ1bmN0aW9uIHN0cmVhbUlkZW50aWZpZXIoc3RyZWFtLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMucHJveHlIb3N0KSB7XG4gICAgICAgIC8vIElmIHByb3h5IG9wdGlvbnMgYXJlIHNwZWNpZmllZCwgdGhlIHByb3BlcnRpZXMgb2YgYHN0cmVhbWAgaXRzZWxmXG4gICAgICAgIC8vIHdpbGwgbm90IGFjY3VyYXRlbHkgcmVmbGVjdCB3aGF0IGVuZHBvaW50IHRoaXMgaXMgY29ubmVjdGVkIHRvLlxuICAgICAgICByZXR1cm4gb3B0aW9ucy5ob3N0QWRkcmVzcy50b1N0cmluZygpO1xuICAgIH1cbiAgICBjb25zdCB7IHJlbW90ZUFkZHJlc3MsIHJlbW90ZVBvcnQgfSA9IHN0cmVhbTtcbiAgICBpZiAodHlwZW9mIHJlbW90ZUFkZHJlc3MgPT09ICdzdHJpbmcnICYmIHR5cGVvZiByZW1vdGVQb3J0ID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tSG9zdFBvcnQocmVtb3RlQWRkcmVzcywgcmVtb3RlUG9ydCkudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuICgwLCB1dGlsc18xLnV1aWRWNCkoKS50b1N0cmluZygnaGV4Jyk7XG59XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDb25uZWN0aW9uIGV4dGVuZHMgbW9uZ29fdHlwZXNfMS5UeXBlZEV2ZW50RW1pdHRlciB7XG4gICAgY29uc3RydWN0b3Ioc3RyZWFtLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMubGFzdEhlbGxvTVMgPSAtMTtcbiAgICAgICAgdGhpcy5oZWxsb09rID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZGVsYXllZFRpbWVvdXRJZCA9IG51bGw7XG4gICAgICAgIC8qKiBJbmRpY2F0ZXMgdGhhdCB0aGUgY29ubmVjdGlvbiAoaW5jbHVkaW5nIHVuZGVybHlpbmcgVENQIHNvY2tldCkgaGFzIGJlZW4gY2xvc2VkLiAqL1xuICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNsdXN0ZXJUaW1lID0gbnVsbDtcbiAgICAgICAgdGhpcy5lcnJvciA9IG51bGw7XG4gICAgICAgIHRoaXMuZGF0YUV2ZW50cyA9IG51bGw7XG4gICAgICAgIHRoaXMub24oJ2Vycm9yJywgdXRpbHNfMS5ub29wKTtcbiAgICAgICAgdGhpcy5zb2NrZXQgPSBzdHJlYW07XG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBzdHJlYW1JZGVudGlmaWVyKHN0cmVhbSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc29ja2V0VGltZW91dE1TID0gb3B0aW9ucy5zb2NrZXRUaW1lb3V0TVMgPz8gMDtcbiAgICAgICAgdGhpcy5tb25pdG9yQ29tbWFuZHMgPSBvcHRpb25zLm1vbml0b3JDb21tYW5kcztcbiAgICAgICAgdGhpcy5zZXJ2ZXJBcGkgPSBvcHRpb25zLnNlcnZlckFwaTtcbiAgICAgICAgdGhpcy5tb25nb0xvZ2dlciA9IG9wdGlvbnMubW9uZ29Mb2dnZXI7XG4gICAgICAgIHRoaXMuZXN0YWJsaXNoZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IG5ldyBzdHJlYW1fZGVzY3JpcHRpb25fMS5TdHJlYW1EZXNjcmlwdGlvbih0aGlzLmFkZHJlc3MsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmdlbmVyYXRpb24gPSBvcHRpb25zLmdlbmVyYXRpb247XG4gICAgICAgIHRoaXMubGFzdFVzZVRpbWUgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIHRoaXMubWVzc2FnZVN0cmVhbSA9IHRoaXMuc29ja2V0XG4gICAgICAgICAgICAub24oJ2Vycm9yJywgdGhpcy5vbkVycm9yLmJpbmQodGhpcykpXG4gICAgICAgICAgICAucGlwZShuZXcgU2l6ZWRNZXNzYWdlVHJhbnNmb3JtKHsgY29ubmVjdGlvbjogdGhpcyB9KSlcbiAgICAgICAgICAgIC5vbignZXJyb3InLCB0aGlzLm9uRXJyb3IuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc29ja2V0Lm9uKCdjbG9zZScsIHRoaXMub25DbG9zZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zb2NrZXQub24oJ3RpbWVvdXQnLCB0aGlzLm9uVGltZW91dC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5tZXNzYWdlU3RyZWFtLnBhdXNlKCk7XG4gICAgfVxuICAgIGdldCBoZWxsbygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb24uaGVsbG87XG4gICAgfVxuICAgIC8vIHRoZSBgY29ubmVjdGAgbWV0aG9kIHN0b3JlcyB0aGUgcmVzdWx0IG9mIHRoZSBoYW5kc2hha2UgaGVsbG8gb24gdGhlIGNvbm5lY3Rpb25cbiAgICBzZXQgaGVsbG8ocmVzcG9uc2UpIHtcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbi5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICBPYmplY3QuZnJlZXplKHRoaXMuZGVzY3JpcHRpb24pO1xuICAgIH1cbiAgICBnZXQgc2VydmljZUlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oZWxsbz8uc2VydmljZUlkO1xuICAgIH1cbiAgICBnZXQgbG9hZEJhbGFuY2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kZXNjcmlwdGlvbi5sb2FkQmFsYW5jZWQ7XG4gICAgfVxuICAgIGdldCBpZGxlVGltZSgpIHtcbiAgICAgICAgcmV0dXJuICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5NcykodGhpcy5sYXN0VXNlVGltZSk7XG4gICAgfVxuICAgIGdldCBoYXNTZXNzaW9uU3VwcG9ydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyAhPSBudWxsO1xuICAgIH1cbiAgICBnZXQgc3VwcG9ydHNPcE1zZygpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmRlc2NyaXB0aW9uICE9IG51bGwgJiZcbiAgICAgICAgICAgICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKSh0aGlzKSA+PSA2ICYmXG4gICAgICAgICAgICAhdGhpcy5kZXNjcmlwdGlvbi5fX25vZGVqc19tb2NrX3NlcnZlcl9fKTtcbiAgICB9XG4gICAgZ2V0IHNob3VsZEVtaXRBbmRMb2dDb21tYW5kKCkge1xuICAgICAgICByZXR1cm4gKCh0aGlzLm1vbml0b3JDb21tYW5kcyB8fFxuICAgICAgICAgICAgKHRoaXMuZXN0YWJsaXNoZWQgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5hdXRoQ29udGV4dD8ucmVhdXRoZW50aWNhdGluZyAmJlxuICAgICAgICAgICAgICAgIHRoaXMubW9uZ29Mb2dnZXI/LndpbGxMb2cobW9uZ29fbG9nZ2VyXzEuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudC5DT01NQU5ELCBtb25nb19sb2dnZXJfMS5TZXZlcml0eUxldmVsLkRFQlVHKSkpID8/XG4gICAgICAgICAgICBmYWxzZSk7XG4gICAgfVxuICAgIG1hcmtBdmFpbGFibGUoKSB7XG4gICAgICAgIHRoaXMubGFzdFVzZVRpbWUgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgfVxuICAgIG9uRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5jbGVhbnVwKGVycm9yKTtcbiAgICB9XG4gICAgb25DbG9zZSgpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGBjb25uZWN0aW9uICR7dGhpcy5pZH0gdG8gJHt0aGlzLmFkZHJlc3N9IGNsb3NlZGA7XG4gICAgICAgIHRoaXMuY2xlYW51cChuZXcgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvcihtZXNzYWdlKSk7XG4gICAgfVxuICAgIG9uVGltZW91dCgpIHtcbiAgICAgICAgdGhpcy5kZWxheWVkVGltZW91dElkID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgY29ubmVjdGlvbiAke3RoaXMuaWR9IHRvICR7dGhpcy5hZGRyZXNzfSB0aW1lZCBvdXRgO1xuICAgICAgICAgICAgY29uc3QgYmVmb3JlSGFuZHNoYWtlID0gdGhpcy5oZWxsbyA9PSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGVhbnVwKG5ldyBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcihtZXNzYWdlLCB7IGJlZm9yZUhhbmRzaGFrZSB9KSk7XG4gICAgICAgIH0sIDEpLnVucmVmKCk7IC8vIE5vIG5lZWQgZm9yIHRoaXMgdGltZXIgdG8gaG9sZCB0aGUgZXZlbnQgbG9vcCBvcGVuXG4gICAgfVxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGxvYWQgYmFsYW5jZWQgbW9kZSByZXF1aXJlcyB0aGF0IHRoZXNlIGxpc3RlbmVycyByZW1haW4gb24gdGhlIGNvbm5lY3Rpb25cbiAgICAgICAgLy8gYWZ0ZXIgY2xlYW51cCBvbiB0aW1lb3V0cywgZXJyb3JzIG9yIGNsb3NlIHNvIHdlIHJlbW92ZSB0aGVtIGJlZm9yZSBjYWxsaW5nXG4gICAgICAgIC8vIGNsZWFudXAuXG4gICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKENvbm5lY3Rpb24uUElOTkVEKTtcbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoQ29ubmVjdGlvbi5VTlBJTk5FRCk7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgY29ubmVjdGlvbiAke3RoaXMuaWR9IHRvICR7dGhpcy5hZGRyZXNzfSBjbG9zZWRgO1xuICAgICAgICB0aGlzLmNsZWFudXAobmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IobWVzc2FnZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIG1ldGhvZCB0aGF0IGNsZWFucyB1cCB0aGUgY29ubmVjdGlvbi4gIFdoZW4gYGZvcmNlYCBpcyB0cnVlLCB0aGlzIG1ldGhvZFxuICAgICAqIGZvcmNpYmx5IGRlc3Ryb3lzIHRoZSBzb2NrZXQuXG4gICAgICpcbiAgICAgKiBJZiBhbiBlcnJvciBpcyBwcm92aWRlZCwgYW55IGluLWZsaWdodCBvcGVyYXRpb25zIHdpbGwgYmUgY2xvc2VkIHdpdGggdGhlIGVycm9yLlxuICAgICAqXG4gICAgICogVGhpcyBtZXRob2QgZG9lcyBub3RoaW5nIGlmIHRoZSBjb25uZWN0aW9uIGlzIGFscmVhZHkgY2xvc2VkLlxuICAgICAqL1xuICAgIGNsZWFudXAoZXJyb3IpIHtcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zb2NrZXQuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgIHRoaXMuZGF0YUV2ZW50cz8udGhyb3coZXJyb3IpLnRoZW4odW5kZWZpbmVkLCB1dGlsc18xLnNxdWFzaEVycm9yKTtcbiAgICAgICAgdGhpcy5jbG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmVtaXQoQ29ubmVjdGlvbi5DTE9TRSk7XG4gICAgfVxuICAgIHByZXBhcmVDb21tYW5kKGRiLCBjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgICAgIGxldCBjbWQgPSB7IC4uLmNvbW1hbmQgfTtcbiAgICAgICAgY29uc3QgcmVhZFByZWZlcmVuY2UgPSAoMCwgc2hhcmVkXzEuZ2V0UmVhZFByZWZlcmVuY2UpKG9wdGlvbnMpO1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gb3B0aW9ucz8uc2Vzc2lvbjtcbiAgICAgICAgbGV0IGNsdXN0ZXJUaW1lID0gdGhpcy5jbHVzdGVyVGltZTtcbiAgICAgICAgaWYgKHRoaXMuc2VydmVyQXBpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHZlcnNpb24sIHN0cmljdCwgZGVwcmVjYXRpb25FcnJvcnMgfSA9IHRoaXMuc2VydmVyQXBpO1xuICAgICAgICAgICAgY21kLmFwaVZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgaWYgKHN0cmljdCAhPSBudWxsKVxuICAgICAgICAgICAgICAgIGNtZC5hcGlTdHJpY3QgPSBzdHJpY3Q7XG4gICAgICAgICAgICBpZiAoZGVwcmVjYXRpb25FcnJvcnMgIT0gbnVsbClcbiAgICAgICAgICAgICAgICBjbWQuYXBpRGVwcmVjYXRpb25FcnJvcnMgPSBkZXByZWNhdGlvbkVycm9ycztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5oYXNTZXNzaW9uU3VwcG9ydCAmJiBzZXNzaW9uKSB7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbi5jbHVzdGVyVGltZSAmJlxuICAgICAgICAgICAgICAgIGNsdXN0ZXJUaW1lICYmXG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5jbHVzdGVyVGltZS5jbHVzdGVyVGltZS5ncmVhdGVyVGhhbihjbHVzdGVyVGltZS5jbHVzdGVyVGltZSkpIHtcbiAgICAgICAgICAgICAgICBjbHVzdGVyVGltZSA9IHNlc3Npb24uY2x1c3RlclRpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uRXJyb3IgPSAoMCwgc2Vzc2lvbnNfMS5hcHBseVNlc3Npb24pKHNlc3Npb24sIGNtZCwgb3B0aW9ucyk7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbkVycm9yKVxuICAgICAgICAgICAgICAgIHRocm93IHNlc3Npb25FcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzZXNzaW9uPy5leHBsaWNpdCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoJ0N1cnJlbnQgdG9wb2xvZ3kgZG9lcyBub3Qgc3VwcG9ydCBzZXNzaW9ucycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIHdlIGhhdmUgYSBrbm93biBjbHVzdGVyIHRpbWUsIGdvc3NpcCBpdFxuICAgICAgICBpZiAoY2x1c3RlclRpbWUpIHtcbiAgICAgICAgICAgIGNtZC4kY2x1c3RlclRpbWUgPSBjbHVzdGVyVGltZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBGb3Igc3RhbmRhbG9uZSwgZHJpdmVycyBNVVNUIE5PVCBzZXQgJHJlYWRQcmVmZXJlbmNlLlxuICAgICAgICBpZiAodGhpcy5kZXNjcmlwdGlvbi50eXBlICE9PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlN0YW5kYWxvbmUpIHtcbiAgICAgICAgICAgIGlmICghKDAsIHNoYXJlZF8xLmlzU2hhcmRlZCkodGhpcykgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5kZXNjcmlwdGlvbi5sb2FkQmFsYW5jZWQgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnN1cHBvcnRzT3BNc2cgJiZcbiAgICAgICAgICAgICAgICBvcHRpb25zLmRpcmVjdENvbm5lY3Rpb24gPT09IHRydWUgJiZcbiAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZT8ubW9kZSA9PT0gJ3ByaW1hcnknKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9yIG1vbmdvcyBhbmQgbG9hZCBiYWxhbmNlcnMgd2l0aCAncHJpbWFyeScgbW9kZSwgZHJpdmVycyBNVVNUIE5PVCBzZXQgJHJlYWRQcmVmZXJlbmNlLlxuICAgICAgICAgICAgICAgIC8vIEZvciBhbGwgb3RoZXIgdHlwZXMgd2l0aCBhIGRpcmVjdCBjb25uZWN0aW9uLCBpZiB0aGUgcmVhZCBwcmVmZXJlbmNlIGlzICdwcmltYXJ5J1xuICAgICAgICAgICAgICAgIC8vIChkcml2ZXIgc2V0cyAncHJpbWFyeScgYXMgZGVmYXVsdCBpZiBubyByZWFkIHByZWZlcmVuY2UgaXMgY29uZmlndXJlZCksXG4gICAgICAgICAgICAgICAgLy8gdGhlICRyZWFkUHJlZmVyZW5jZSBNVVNUIGJlIHNldCB0byAncHJpbWFyeVByZWZlcnJlZCdcbiAgICAgICAgICAgICAgICAvLyB0byBlbnN1cmUgdGhhdCBhbnkgc2VydmVyIHR5cGUgY2FuIGhhbmRsZSB0aGUgcmVxdWVzdC5cbiAgICAgICAgICAgICAgICBjbWQuJHJlYWRQcmVmZXJlbmNlID0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeVByZWZlcnJlZC50b0pTT04oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCgwLCBzaGFyZWRfMS5pc1NoYXJkZWQpKHRoaXMpICYmICF0aGlzLnN1cHBvcnRzT3BNc2cgJiYgcmVhZFByZWZlcmVuY2U/Lm1vZGUgIT09ICdwcmltYXJ5Jykge1xuICAgICAgICAgICAgICAgIC8vIFdoZW4gc2VuZGluZyBhIHJlYWQgb3BlcmF0aW9uIHZpYSBPUF9RVUVSWSBhbmQgdGhlICRyZWFkUHJlZmVyZW5jZSBtb2RpZmllcixcbiAgICAgICAgICAgICAgICAvLyB0aGUgcXVlcnkgTVVTVCBiZSBwcm92aWRlZCB1c2luZyB0aGUgJHF1ZXJ5IG1vZGlmaWVyLlxuICAgICAgICAgICAgICAgIGNtZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5OiBjbWQsXG4gICAgICAgICAgICAgICAgICAgICRyZWFkUHJlZmVyZW5jZTogcmVhZFByZWZlcmVuY2UudG9KU09OKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVhZFByZWZlcmVuY2U/Lm1vZGUgIT09ICdwcmltYXJ5Jykge1xuICAgICAgICAgICAgICAgIC8vIEZvciBtb2RlICdwcmltYXJ5JywgZHJpdmVycyBNVVNUIE5PVCBzZXQgJHJlYWRQcmVmZXJlbmNlLlxuICAgICAgICAgICAgICAgIC8vIEZvciBhbGwgb3RoZXIgcmVhZCBwcmVmZXJlbmNlIG1vZGVzIChpLmUuICdzZWNvbmRhcnknLCAncHJpbWFyeVByZWZlcnJlZCcsIC4uLiksXG4gICAgICAgICAgICAgICAgLy8gZHJpdmVycyBNVVNUIHNldCAkcmVhZFByZWZlcmVuY2VcbiAgICAgICAgICAgICAgICBjbWQuJHJlYWRQcmVmZXJlbmNlID0gcmVhZFByZWZlcmVuY2UudG9KU09OKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29tbWFuZE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBudW1iZXJUb1NraXA6IDAsXG4gICAgICAgICAgICBudW1iZXJUb1JldHVybjogLTEsXG4gICAgICAgICAgICBjaGVja0tleXM6IGZhbHNlLFxuICAgICAgICAgICAgLy8gVGhpcyB2YWx1ZSBpcyBub3Qgb3ZlcnJpZGFibGVcbiAgICAgICAgICAgIHNlY29uZGFyeU9rOiByZWFkUHJlZmVyZW5jZS5zZWNvbmRhcnlPaygpLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9O1xuICAgICAgICBvcHRpb25zLnRpbWVvdXRDb250ZXh0Py5hZGRNYXhUaW1lTVNUb0NvbW1hbmQoY21kLCBvcHRpb25zKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuc3VwcG9ydHNPcE1zZ1xuICAgICAgICAgICAgPyBuZXcgY29tbWFuZHNfMS5PcE1zZ1JlcXVlc3QoZGIsIGNtZCwgY29tbWFuZE9wdGlvbnMpXG4gICAgICAgICAgICA6IG5ldyBjb21tYW5kc18xLk9wUXVlcnlSZXF1ZXN0KGRiLCBjbWQsIGNvbW1hbmRPcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfVxuICAgIGFzeW5jICpzZW5kV2lyZShtZXNzYWdlLCBvcHRpb25zLCByZXNwb25zZVR5cGUpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICBjb25zdCB0aW1lb3V0ID0gb3B0aW9ucy5zb2NrZXRUaW1lb3V0TVMgPz9cbiAgICAgICAgICAgIG9wdGlvbnM/LnRpbWVvdXRDb250ZXh0Py5nZXRTb2NrZXRUaW1lb3V0TVMoKSA/P1xuICAgICAgICAgICAgdGhpcy5zb2NrZXRUaW1lb3V0TVM7XG4gICAgICAgIHRoaXMuc29ja2V0LnNldFRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLndyaXRlQ29tbWFuZChtZXNzYWdlLCB7XG4gICAgICAgICAgICAgICAgYWdyZWVkQ29tcHJlc3NvcjogdGhpcy5kZXNjcmlwdGlvbi5jb21wcmVzc29yID8/ICdub25lJyxcbiAgICAgICAgICAgICAgICB6bGliQ29tcHJlc3Npb25MZXZlbDogdGhpcy5kZXNjcmlwdGlvbi56bGliQ29tcHJlc3Npb25MZXZlbCxcbiAgICAgICAgICAgICAgICB0aW1lb3V0Q29udGV4dDogb3B0aW9ucy50aW1lb3V0Q29udGV4dCxcbiAgICAgICAgICAgICAgICBzaWduYWw6IG9wdGlvbnMuc2lnbmFsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm5vUmVzcG9uc2UgfHwgbWVzc2FnZS5tb3JlVG9Db21lKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgcmVzcG9uc2VzXzEuTW9uZ29EQlJlc3BvbnNlLmVtcHR5O1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudGhyb3dJZkFib3J0ZWQoKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXRDb250ZXh0Py5jc290RW5hYmxlZCgpICYmXG4gICAgICAgICAgICAgICAgb3B0aW9ucy50aW1lb3V0Q29udGV4dC5taW5Sb3VuZFRyaXBUaW1lICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRpbWVvdXRDb250ZXh0LnJlbWFpbmluZ1RpbWVNUyA8IG9wdGlvbnMudGltZW91dENvbnRleHQubWluUm91bmRUcmlwVGltZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKCdTZXJ2ZXIgcm91bmR0cmlwIHRpbWUgaXMgZ3JlYXRlciB0aGFuIHRoZSB0aW1lIHJlbWFpbmluZycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCByZXNwb25zZSBvZiB0aGlzLnJlYWRNYW55KG9wdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuc2V0VGltZW91dCgwKTtcbiAgICAgICAgICAgICAgICBjb25zdCBic29uID0gcmVzcG9uc2UucGFyc2UoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IChyZXNwb25zZVR5cGUgPz8gcmVzcG9uc2VzXzEuTW9uZ29EQlJlc3BvbnNlKS5tYWtlKGJzb24pO1xuICAgICAgICAgICAgICAgIHlpZWxkIGRvY3VtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMudGhyb3dJZkFib3J0ZWQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5zZXRUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQuc2V0VGltZW91dCgwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyAqc2VuZENvbW1hbmQobnMsIGNvbW1hbmQsIG9wdGlvbnMsIHJlc3BvbnNlVHlwZSkge1xuICAgICAgICBvcHRpb25zPy5zaWduYWw/LnRocm93SWZBYm9ydGVkKCk7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLnByZXBhcmVDb21tYW5kKG5zLmRiLCBjb21tYW5kLCBvcHRpb25zKTtcbiAgICAgICAgbGV0IHN0YXJ0ZWQgPSAwO1xuICAgICAgICBpZiAodGhpcy5zaG91bGRFbWl0QW5kTG9nQ29tbWFuZCkge1xuICAgICAgICAgICAgc3RhcnRlZCA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZ0NvbW1hbmQodGhpcy5tb25pdG9yQ29tbWFuZHMsIENvbm5lY3Rpb24uQ09NTUFORF9TVEFSVEVELCBtZXNzYWdlLmRhdGFiYXNlTmFtZSwgdGhpcy5lc3RhYmxpc2hlZCwgbmV3IGNvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNfMS5Db21tYW5kU3RhcnRlZEV2ZW50KHRoaXMsIG1lc3NhZ2UsIHRoaXMuZGVzY3JpcHRpb24uc2VydmVyQ29ubmVjdGlvbklkKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgYGRvY3VtZW50c1JldHVybmVkSW5gIG5vdCBzZXQgb3IgcmF3IGlzIG5vdCBlbmFibGVkLCB1c2UgaW5wdXQgYnNvbiBvcHRpb25zXG4gICAgICAgIC8vIE90aGVyd2lzZSwgc3VwcG9ydCByYXcgZmxhZy4gUmF3IG9ubHkgd29ya3MgZm9yIGN1cnNvcnMgdGhhdCBoYXJkY29kZSBmaXJzdEJhdGNoL25leHRCYXRjaCBmaWVsZHNcbiAgICAgICAgY29uc3QgYnNvbk9wdGlvbnMgPSBvcHRpb25zLmRvY3VtZW50c1JldHVybmVkSW4gPT0gbnVsbCB8fCAhb3B0aW9ucy5yYXdcbiAgICAgICAgICAgID8gb3B0aW9uc1xuICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgICAgICByYXc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZpZWxkc0FzUmF3OiB7IFtvcHRpb25zLmRvY3VtZW50c1JldHVybmVkSW5dOiB0cnVlIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIC8qKiBNb25nb0RCUmVzcG9uc2UgaW5zdGFuY2Ugb3Igc3ViY2xhc3MgKi9cbiAgICAgICAgbGV0IGRvY3VtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICAvKiogQ2FjaGVkIHJlc3VsdCBvZiBhIHRvT2JqZWN0IGNhbGwgKi9cbiAgICAgICAgbGV0IG9iamVjdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMudGhyb3dJZkFib3J0ZWQoKTtcbiAgICAgICAgICAgIGZvciBhd2FpdCAoZG9jdW1lbnQgb2YgdGhpcy5zZW5kV2lyZShtZXNzYWdlLCBvcHRpb25zLCByZXNwb25zZVR5cGUpKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnNlc3Npb24gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAoMCwgc2Vzc2lvbnNfMS51cGRhdGVTZXNzaW9uRnJvbVJlc3BvbnNlKShvcHRpb25zLnNlc3Npb24sIGRvY3VtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LiRjbHVzdGVyVGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsdXN0ZXJUaW1lID0gZG9jdW1lbnQuJGNsdXN0ZXJUaW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoQ29ubmVjdGlvbi5DTFVTVEVSX1RJTUVfUkVDRUlWRUQsIGRvY3VtZW50LiRjbHVzdGVyVGltZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5vayA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKSAmJiBkb2N1bWVudC5pc01heFRpbWVFeHBpcmVkRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKCdTZXJ2ZXIgcmVwb3J0ZWQgYSB0aW1lb3V0IGVycm9yJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlOiBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKChvYmplY3QgPz89IGRvY3VtZW50LnRvT2JqZWN0KGJzb25PcHRpb25zKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKChvYmplY3QgPz89IGRvY3VtZW50LnRvT2JqZWN0KGJzb25PcHRpb25zKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRFbWl0QW5kTG9nQ29tbWFuZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2dDb21tYW5kKHRoaXMubW9uaXRvckNvbW1hbmRzLCBDb25uZWN0aW9uLkNPTU1BTkRfU1VDQ0VFREVELCBtZXNzYWdlLmRhdGFiYXNlTmFtZSwgdGhpcy5lc3RhYmxpc2hlZCwgbmV3IGNvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNfMS5Db21tYW5kU3VjY2VlZGVkRXZlbnQodGhpcywgbWVzc2FnZSwgb3B0aW9ucy5ub1Jlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgOiBtZXNzYWdlLm1vcmVUb0NvbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHsgb2s6IDEgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogKG9iamVjdCA/Pz0gZG9jdW1lbnQudG9PYmplY3QoYnNvbk9wdGlvbnMpKSwgc3RhcnRlZCwgdGhpcy5kZXNjcmlwdGlvbi5zZXJ2ZXJDb25uZWN0aW9uSWQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlVHlwZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIChvYmplY3QgPz89IGRvY3VtZW50LnRvT2JqZWN0KGJzb25PcHRpb25zKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCBkb2N1bWVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkRW1pdEFuZExvZ0NvbW1hbmQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2dDb21tYW5kKHRoaXMubW9uaXRvckNvbW1hbmRzLCBDb25uZWN0aW9uLkNPTU1BTkRfRkFJTEVELCBtZXNzYWdlLmRhdGFiYXNlTmFtZSwgdGhpcy5lc3RhYmxpc2hlZCwgbmV3IGNvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNfMS5Db21tYW5kRmFpbGVkRXZlbnQodGhpcywgbWVzc2FnZSwgZXJyb3IsIHN0YXJ0ZWQsIHRoaXMuZGVzY3JpcHRpb24uc2VydmVyQ29ubmVjdGlvbklkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBjb21tYW5kKG5zLCBjb21tYW5kLCBvcHRpb25zID0ge30sIHJlc3BvbnNlVHlwZSkge1xuICAgICAgICB0aGlzLnRocm93SWZBYm9ydGVkKCk7XG4gICAgICAgIG9wdGlvbnMuc2lnbmFsPy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGRvY3VtZW50IG9mIHRoaXMuc2VuZENvbW1hbmQobnMsIGNvbW1hbmQsIG9wdGlvbnMsIHJlc3BvbnNlVHlwZSkpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXRDb250ZXh0Py5jc290RW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlc18xLk1vbmdvREJSZXNwb25zZS5pcyhkb2N1bWVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmlzTWF4VGltZUV4cGlyZWRFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IoJ1NlcnZlciByZXBvcnRlZCBhIHRpbWVvdXQgZXJyb3InLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IoZG9jdW1lbnQudG9PYmplY3QoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKEFycmF5LmlzQXJyYXkoZG9jdW1lbnQ/LndyaXRlRXJyb3JzKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQud3JpdGVFcnJvcnMuc29tZShlcnJvciA9PiBlcnJvcj8uY29kZSA9PT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLk1heFRpbWVNU0V4cGlyZWQpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ/LndyaXRlQ29uY2VybkVycm9yPy5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTWF4VGltZU1TRXhwaXJlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IoJ1NlcnZlciByZXBvcnRlZCBhIHRpbWVvdXQgZXJyb3InLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IoZG9jdW1lbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKCdVbmFibGUgdG8gZ2V0IHJlc3BvbnNlIGZyb20gc2VydmVyJyk7XG4gICAgfVxuICAgIGV4aGF1c3RDb21tYW5kKG5zLCBjb21tYW5kLCBvcHRpb25zLCByZXBseUxpc3RlbmVyKSB7XG4gICAgICAgIGNvbnN0IGV4aGF1c3RMb29wID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCByZXBseSBvZiB0aGlzLnNlbmRDb21tYW5kKG5zLCBjb21tYW5kLCBvcHRpb25zKSkge1xuICAgICAgICAgICAgICAgIHJlcGx5TGlzdGVuZXIodW5kZWZpbmVkLCByZXBseSk7XG4gICAgICAgICAgICAgICAgdGhpcy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvcignU2VydmVyIGVuZGVkIG1vcmVUb0NvbWUgdW5leHBlY3RlZGx5Jyk7XG4gICAgICAgIH07XG4gICAgICAgIGV4aGF1c3RMb29wKCkudGhlbih1bmRlZmluZWQsIHJlcGx5TGlzdGVuZXIpO1xuICAgIH1cbiAgICB0aHJvd0lmQWJvcnRlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZXJyb3IpXG4gICAgICAgICAgICB0aHJvdyB0aGlzLmVycm9yO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKlxuICAgICAqIFdyaXRlcyBhbiBPUF9NU0cgb3IgT1BfUVVFUlkgcmVxdWVzdCB0byB0aGUgc29ja2V0LCBvcHRpb25hbGx5IGNvbXByZXNzaW5nIHRoZSBjb21tYW5kLiBUaGlzIG1ldGhvZFxuICAgICAqIHdhaXRzIHVudGlsIHRoZSBzb2NrZXQncyBidWZmZXIgaGFzIGVtcHRpZWQgKHRoZSBOb2RlanMgc29ja2V0IGBkcmFpbmAgZXZlbnQgaGFzIGZpcmVkKS5cbiAgICAgKi9cbiAgICBhc3luYyB3cml0ZUNvbW1hbmQoY29tbWFuZCwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBmaW5hbENvbW1hbmQgPSBvcHRpb25zLmFncmVlZENvbXByZXNzb3IgPT09ICdub25lJyB8fCAhY29tbWFuZHNfMS5PcENvbXByZXNzZWRSZXF1ZXN0LmNhbkNvbXByZXNzKGNvbW1hbmQpXG4gICAgICAgICAgICA/IGNvbW1hbmRcbiAgICAgICAgICAgIDogbmV3IGNvbW1hbmRzXzEuT3BDb21wcmVzc2VkUmVxdWVzdChjb21tYW5kLCB7XG4gICAgICAgICAgICAgICAgYWdyZWVkQ29tcHJlc3Nvcjogb3B0aW9ucy5hZ3JlZWRDb21wcmVzc29yID8/ICdub25lJyxcbiAgICAgICAgICAgICAgICB6bGliQ29tcHJlc3Npb25MZXZlbDogb3B0aW9ucy56bGliQ29tcHJlc3Npb25MZXZlbCA/PyAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmNvbmNhdChhd2FpdCBmaW5hbENvbW1hbmQudG9CaW4oKSk7XG4gICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXRDb250ZXh0Py5jc290RW5hYmxlZCgpKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0Q29udGV4dC5taW5Sb3VuZFRyaXBUaW1lICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRpbWVvdXRDb250ZXh0LnJlbWFpbmluZ1RpbWVNUyA8IG9wdGlvbnMudGltZW91dENvbnRleHQubWluUm91bmRUcmlwVGltZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKCdTZXJ2ZXIgcm91bmR0cmlwIHRpbWUgaXMgZ3JlYXRlciB0aGFuIHRoZSB0aW1lIHJlbWFpbmluZycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNvY2tldC53cml0ZShidWZmZXIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBkcmFpbkV2ZW50ID0gKDAsIHV0aWxzXzEub25jZSkodGhpcy5zb2NrZXQsICdkcmFpbicsIG9wdGlvbnMpO1xuICAgICAgICBjb25zdCB0aW1lb3V0ID0gb3B0aW9ucz8udGltZW91dENvbnRleHQ/LnRpbWVvdXRGb3JTb2NrZXRXcml0ZTtcbiAgICAgICAgY29uc3QgZHJhaW5lZCA9IHRpbWVvdXQgPyBQcm9taXNlLnJhY2UoW2RyYWluRXZlbnQsIHRpbWVvdXRdKSA6IGRyYWluRXZlbnQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgZHJhaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAod3JpdGVFcnJvcikge1xuICAgICAgICAgICAgaWYgKHRpbWVvdXRfMS5UaW1lb3V0RXJyb3IuaXMod3JpdGVFcnJvcikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lb3V0RXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcignVGltZWQgb3V0IGF0IHNvY2tldCB3cml0ZScpO1xuICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcih0aW1lb3V0RXJyb3IpO1xuICAgICAgICAgICAgICAgIHRocm93IHRpbWVvdXRFcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHdyaXRlRXJyb3IgPT09IG9wdGlvbnMuc2lnbmFsPy5yZWFzb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3Iod3JpdGVFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyB3cml0ZUVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGltZW91dD8uY2xlYXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKlxuICAgICAqIFJldHVybnMgYW4gYXN5bmMgZ2VuZXJhdG9yIHRoYXQgeWllbGRzIGZ1bGwgd2lyZSBwcm90b2NvbCBtZXNzYWdlcyBmcm9tIHRoZSB1bmRlcmx5aW5nIHNvY2tldC4gIFRoaXMgZnVuY3Rpb25cbiAgICAgKiB5aWVsZHMgbWVzc2FnZXMgdW50aWwgYG1vcmVUb0NvbWVgIGlzIGZhbHNlIG9yIG5vdCBwcmVzZW50IGluIGEgcmVzcG9uc2UsIG9yIHRoZSBjYWxsZXIgY2FuY2VscyB0aGUgcmVxdWVzdFxuICAgICAqIGJ5IGNhbGxpbmcgYHJldHVybmAgb24gdGhlIGdlbmVyYXRvci5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBgZm9yLWF3YWl0YCBsb29wcyBjYWxsIGByZXR1cm5gIGF1dG9tYXRpY2FsbHkgd2hlbiB0aGUgbG9vcCBpcyBleGl0ZWQuXG4gICAgICovXG4gICAgYXN5bmMgKnJlYWRNYW55KG9wdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuZGF0YUV2ZW50cyA9ICgwLCBvbl9kYXRhXzEub25EYXRhKSh0aGlzLm1lc3NhZ2VTdHJlYW0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlU3RyZWFtLnJlc3VtZSgpO1xuICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBtZXNzYWdlIG9mIHRoaXMuZGF0YUV2ZW50cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKDAsIGNvbXByZXNzaW9uXzEuZGVjb21wcmVzc1Jlc3BvbnNlKShtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB5aWVsZCByZXNwb25zZTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm1vcmVUb0NvbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAocmVhZEVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGltZW91dF8xLlRpbWVvdXRFcnJvci5pcyhyZWFkRXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZW91dEVycm9yID0gbmV3IGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IoYFRpbWVkIG91dCBkdXJpbmcgc29ja2V0IHJlYWQgKCR7cmVhZEVycm9yLmR1cmF0aW9ufW1zKWApO1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YUV2ZW50cyA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHRpbWVvdXRFcnJvcik7XG4gICAgICAgICAgICAgICAgdGhyb3cgdGltZW91dEVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVhZEVycm9yID09PSBvcHRpb25zLnNpZ25hbD8ucmVhc29uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHJlYWRFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyByZWFkRXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLmRhdGFFdmVudHMgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlU3RyZWFtLnBhdXNlKCk7XG4gICAgICAgICAgICB0aGlzLnRocm93SWZBYm9ydGVkKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb24gPSBDb25uZWN0aW9uO1xuLyoqIEBldmVudCAqL1xuQ29ubmVjdGlvbi5DT01NQU5EX1NUQVJURUQgPSBjb25zdGFudHNfMS5DT01NQU5EX1NUQVJURUQ7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLkNPTU1BTkRfU1VDQ0VFREVEID0gY29uc3RhbnRzXzEuQ09NTUFORF9TVUNDRUVERUQ7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLkNPTU1BTkRfRkFJTEVEID0gY29uc3RhbnRzXzEuQ09NTUFORF9GQUlMRUQ7XG4vKiogQGV2ZW50ICovXG5Db25uZWN0aW9uLkNMVVNURVJfVElNRV9SRUNFSVZFRCA9IGNvbnN0YW50c18xLkNMVVNURVJfVElNRV9SRUNFSVZFRDtcbi8qKiBAZXZlbnQgKi9cbkNvbm5lY3Rpb24uQ0xPU0UgPSBjb25zdGFudHNfMS5DTE9TRTtcbi8qKiBAZXZlbnQgKi9cbkNvbm5lY3Rpb24uUElOTkVEID0gY29uc3RhbnRzXzEuUElOTkVEO1xuLyoqIEBldmVudCAqL1xuQ29ubmVjdGlvbi5VTlBJTk5FRCA9IGNvbnN0YW50c18xLlVOUElOTkVEO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgU2l6ZWRNZXNzYWdlVHJhbnNmb3JtIGV4dGVuZHMgc3RyZWFtXzEuVHJhbnNmb3JtIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGNvbm5lY3Rpb24gfSkge1xuICAgICAgICBzdXBlcih7IHdyaXRhYmxlT2JqZWN0TW9kZTogZmFsc2UsIHJlYWRhYmxlT2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5idWZmZXJQb29sID0gbmV3IHV0aWxzXzEuQnVmZmVyUG9vbCgpO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICAgIH1cbiAgICBfdHJhbnNmb3JtKGNodW5rLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbi5kZWxheWVkVGltZW91dElkICE9IG51bGwpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMuY29ubmVjdGlvbi5kZWxheWVkVGltZW91dElkKTtcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5kZWxheWVkVGltZW91dElkID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ1ZmZlclBvb2wuYXBwZW5kKGNodW5rKTtcbiAgICAgICAgd2hpbGUgKHRoaXMuYnVmZmVyUG9vbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIFdoaWxlIHRoZXJlIGFyZSBhbnkgYnl0ZXMgaW4gdGhlIGJ1ZmZlclxuICAgICAgICAgICAgLy8gVHJ5IHRvIGZldGNoIGEgc2l6ZSBmcm9tIHRoZSB0b3AgNCBieXRlc1xuICAgICAgICAgICAgY29uc3Qgc2l6ZU9mTWVzc2FnZSA9IHRoaXMuYnVmZmVyUG9vbC5nZXRJbnQzMigpO1xuICAgICAgICAgICAgaWYgKHNpemVPZk1lc3NhZ2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIC8vIE5vdCBldmVuIGFuIGludDMyIHdvcnRoIG9mIGRhdGEuIFN0b3AgdGhlIGxvb3AsIHdlIG5lZWQgbW9yZSBjaHVua3MuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2l6ZU9mTWVzc2FnZSA8IDApIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgc2l6ZSBpbiB0aGUgbWVzc2FnZSBoYXMgYSBuZWdhdGl2ZSB2YWx1ZSwgdGhpcyBpcyBwcm9iYWJseSBjb3JydXB0aW9uLCB0aHJvdzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBNZXNzYWdlIHNpemUgY2Fubm90IGJlIG5lZ2F0aXZlOiAke3NpemVPZk1lc3NhZ2V9YCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNpemVPZk1lc3NhZ2UgPiB0aGlzLmJ1ZmZlclBvb2wubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgZG8gbm90IGhhdmUgZW5vdWdoIGJ5dGVzIHRvIG1ha2UgYSBzaXplT2ZNZXNzYWdlIGNodW5rXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBZGQgYSBtZXNzYWdlIHRvIHRoZSBzdHJlYW1cbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLmJ1ZmZlclBvb2wucmVhZChzaXplT2ZNZXNzYWdlKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5wdXNoKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugb25seSBzdWJzY3JpYmUgdG8gZGF0YSBldmVudHMgc28gd2Ugc2hvdWxkIG5ldmVyIGdldCBiYWNrcHJlc3N1cmVcbiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBkbywgd2UgZG8gbm90IGhhdmUgdGhlIGhhbmRsaW5nIGZvciBpdC5cbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYFNpemVkTWVzc2FnZVRyYW5zZm9ybSBkb2VzIG5vdCBzdXBwb3J0IGJhY2twcmVzc3VyZWApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFjaygpO1xuICAgIH1cbn1cbmV4cG9ydHMuU2l6ZWRNZXNzYWdlVHJhbnNmb3JtID0gU2l6ZWRNZXNzYWdlVHJhbnNmb3JtO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ3J5cHRvQ29ubmVjdGlvbiBleHRlbmRzIENvbm5lY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHN0cmVhbSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihzdHJlYW0sIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmF1dG9FbmNyeXB0ZXIgPSBvcHRpb25zLmF1dG9FbmNyeXB0ZXI7XG4gICAgfVxuICAgIGFzeW5jIGNvbW1hbmQobnMsIGNtZCwgb3B0aW9ucywgcmVzcG9uc2VUeXBlKSB7XG4gICAgICAgIGNvbnN0IHsgYXV0b0VuY3J5cHRlciB9ID0gdGhpcztcbiAgICAgICAgaWYgKCFhdXRvRW5jcnlwdGVyKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtNjA2NSk6IHRocm93IGEgTW9uZ29SdW50aW1lRXJyb3IgaW4gTm9kZSBWN1xuICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBObyBjYXVzZSBwcm92aWRlZCBiZWNhdXNlIHRoZXJlIGlzIG5vIHVuZGVybHlpbmcgZXJyb3IuXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ05vIEF1dG9FbmNyeXB0ZXIgYXZhaWxhYmxlIGZvciBlbmNyeXB0aW9uJywge1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY3lOYW1lOiAnbi9hJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VydmVyV2lyZVZlcnNpb24gPSAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikodGhpcyk7XG4gICAgICAgIGlmIChzZXJ2ZXJXaXJlVmVyc2lvbiA9PT0gMCkge1xuICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGUgaW5pdGlhbCBoYW5kc2hha2UgaGFzbid0IGhhcHBlbmVkIHlldFxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLmNvbW1hbmQobnMsIGNtZCwgb3B0aW9ucywgcmVzcG9uc2VUeXBlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VydmVyV2lyZVZlcnNpb24gPCA4KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcignQXV0by1lbmNyeXB0aW9uIHJlcXVpcmVzIGEgbWluaW11bSBNb25nb0RCIHZlcnNpb24gb2YgNC4yJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2F2ZSBzb3J0IG9yIGluZGV4S2V5cyBiYXNlZCBvbiB0aGUgY29tbWFuZCBiZWluZyBydW5cbiAgICAgICAgLy8gdGhlIGVuY3J5cHQgQVBJIHNlcmlhbGl6ZXMgb3VyIEpTIG9iamVjdHMgdG8gQlNPTiB0byBwYXNzIHRvIHRoZSBuYXRpdmUgY29kZSBsYXllclxuICAgICAgICAvLyBhbmQgdGhlbiBkZXNlcmlhbGl6ZXMgdGhlIGVuY3J5cHRlZCByZXN1bHQsIHRoZSBwcm90b2NvbCBsZXZlbCBjb21wb25lbnRzXG4gICAgICAgIC8vIG9mIHRoZSBjb21tYW5kIChleC4gc29ydCkgYXJlIHRoZW4gY29udmVydGVkIHRvIEpTIG9iamVjdHMgcG90ZW50aWFsbHkgbG9zaW5nXG4gICAgICAgIC8vIGltcG9ydCBrZXkgb3JkZXIgaW5mb3JtYXRpb24uIFRoZXNlIGZpZWxkcyBhcmUgbmV2ZXIgZW5jcnlwdGVkIHNvIHdlIGNhbiBzYXZlIHRoZSB2YWx1ZXNcbiAgICAgICAgLy8gZnJvbSBiZWZvcmUgdGhlIGVuY3J5cHRpb24gYW5kIHJlcGxhY2UgdGhlbSBhZnRlciBlbmNyeXB0aW9uIGhhcyBiZWVuIHBlcmZvcm1lZFxuICAgICAgICBjb25zdCBzb3J0ID0gY21kLmZpbmQgfHwgY21kLmZpbmRBbmRNb2RpZnkgPyBjbWQuc29ydCA6IG51bGw7XG4gICAgICAgIGNvbnN0IGluZGV4S2V5cyA9IGNtZC5jcmVhdGVJbmRleGVzXG4gICAgICAgICAgICA/IGNtZC5pbmRleGVzLm1hcCgoaW5kZXgpID0+IGluZGV4LmtleSlcbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgYXV0b0VuY3J5cHRlci5lbmNyeXB0KG5zLnRvU3RyaW5nKCksIGNtZCwgb3B0aW9ucyk7XG4gICAgICAgIC8vIFJlcGxhY2UgdGhlIHNhdmVkIHZhbHVlc1xuICAgICAgICBpZiAoc29ydCAhPSBudWxsICYmIChjbWQuZmluZCB8fCBjbWQuZmluZEFuZE1vZGlmeSkpIHtcbiAgICAgICAgICAgIGVuY3J5cHRlZC5zb3J0ID0gc29ydDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5kZXhLZXlzICE9IG51bGwgJiYgY21kLmNyZWF0ZUluZGV4ZXMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW29mZnNldCwgaW5kZXhdIG9mIGluZGV4S2V5cy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIGBlbmNyeXB0ZWRgIGlzIGEgZ2VuZXJpYyBcImNvbW1hbmRcIiwgYnV0IHdlJ3ZlIG5hcnJvd2VkIGZvciBvbmx5IGBjcmVhdGVJbmRleGVzYCBjb21tYW5kcyBoZXJlXG4gICAgICAgICAgICAgICAgZW5jcnlwdGVkLmluZGV4ZXNbb2Zmc2V0XS5rZXkgPSBpbmRleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlbmNyeXB0ZWRSZXNwb25zZSA9IGF3YWl0IHN1cGVyLmNvbW1hbmQobnMsIGVuY3J5cHRlZCwgb3B0aW9ucywgXG4gICAgICAgIC8vIEV2ZW50dWFsbHkgd2Ugd2FudCB0byByZXF1aXJlIGByZXNwb25zZVR5cGVgIHdoaWNoIG1lYW5zIHdlIHdvdWxkIHNhdGlzZnkgYFRgIGFzIHRoZSByZXR1cm4gdHlwZS5cbiAgICAgICAgLy8gSW4gdGhlIG1lYW50aW1lLCB3ZSB3YW50IGVuY3J5cHRlZFJlc3BvbnNlIHRvIGFsd2F5cyBiZSBfYXQgbGVhc3RfIGEgTW9uZ29EQlJlc3BvbnNlIGlmIG5vdCBhIG1vcmUgc3BlY2lmaWMgc3ViY2xhc3NcbiAgICAgICAgLy8gU28gdGhhdCB3ZSBjYW4gZW5zdXJlIHdlIGhhdmUgYWNjZXNzIHRvIHRoZSBvbi1kZW1hbmQgQVBJcyBmb3IgZGVjb3JhdGUgcmVzcG9uc2VcbiAgICAgICAgcmVzcG9uc2VUeXBlID8/IHJlc3BvbnNlc18xLk1vbmdvREJSZXNwb25zZSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dG9FbmNyeXB0ZXIuZGVjcnlwdChlbmNyeXB0ZWRSZXNwb25zZS50b0J5dGVzKCksIG9wdGlvbnMpO1xuICAgICAgICBjb25zdCBkZWNyeXB0ZWRSZXNwb25zZSA9IHJlc3BvbnNlVHlwZT8ubWFrZShyZXN1bHQpID8/ICgwLCBic29uXzEuZGVzZXJpYWxpemUpKHJlc3VsdCwgb3B0aW9ucyk7XG4gICAgICAgIGlmIChhdXRvRW5jcnlwdGVyW2NvbnN0YW50c18xLmtEZWNvcmF0ZVJlc3VsdF0pIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZVR5cGUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLmRlY29yYXRlRGVjcnlwdGlvblJlc3VsdCkoZGVjcnlwdGVkUmVzcG9uc2UsIGVuY3J5cHRlZFJlc3BvbnNlLnRvT2JqZWN0KCksIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZGVjcnlwdGVkUmVzcG9uc2UgaW5zdGFuY2VvZiByZXNwb25zZXNfMS5DdXJzb3JSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGRlY3J5cHRlZFJlc3BvbnNlLmVuY3J5cHRlZFJlc3BvbnNlID0gZW5jcnlwdGVkUmVzcG9uc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlY3J5cHRlZFJlc3BvbnNlO1xuICAgIH1cbn1cbmV4cG9ydHMuQ3J5cHRvQ29ubmVjdGlvbiA9IENyeXB0b0Nvbm5lY3Rpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25uZWN0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool.js ***!
  \********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ConnectionPool = exports.PoolState = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst connect_1 = __webpack_require__(/*! ./connect */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connect.js\");\nconst connection_1 = __webpack_require__(/*! ./connection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection.js\");\nconst connection_pool_events_1 = __webpack_require__(/*! ./connection_pool_events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool_events.js\");\nconst errors_1 = __webpack_require__(/*! ./errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/errors.js\");\nconst metrics_1 = __webpack_require__(/*! ./metrics */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/metrics.js\");\n/** @internal */\nexports.PoolState = Object.freeze({\n    paused: 'paused',\n    ready: 'ready',\n    closed: 'closed'\n});\n/**\n * A pool of connections which dynamically resizes, and emit events related to pool activity\n * @internal\n */\nclass ConnectionPool extends mongo_types_1.TypedEventEmitter {\n    constructor(server, options) {\n        super();\n        this.on('error', utils_1.noop);\n        this.options = Object.freeze({\n            connectionType: connection_1.Connection,\n            ...options,\n            maxPoolSize: options.maxPoolSize ?? 100,\n            minPoolSize: options.minPoolSize ?? 0,\n            maxConnecting: options.maxConnecting ?? 2,\n            maxIdleTimeMS: options.maxIdleTimeMS ?? 0,\n            waitQueueTimeoutMS: options.waitQueueTimeoutMS ?? 0,\n            minPoolSizeCheckFrequencyMS: options.minPoolSizeCheckFrequencyMS ?? 100,\n            autoEncrypter: options.autoEncrypter\n        });\n        if (this.options.minPoolSize > this.options.maxPoolSize) {\n            throw new error_1.MongoInvalidArgumentError('Connection pool minimum size must not be greater than maximum pool size');\n        }\n        this.poolState = exports.PoolState.paused;\n        this.server = server;\n        this.connections = new utils_1.List();\n        this.pending = 0;\n        this.checkedOut = new Set();\n        this.minPoolSizeTimer = undefined;\n        this.generation = 0;\n        this.serviceGenerations = new Map();\n        this.connectionCounter = (0, utils_1.makeCounter)(1);\n        this.cancellationToken = new mongo_types_1.CancellationToken();\n        this.cancellationToken.setMaxListeners(Infinity);\n        this.waitQueue = new utils_1.List();\n        this.metrics = new metrics_1.ConnectionPoolMetrics();\n        this.processingWaitQueue = false;\n        this.mongoLogger = this.server.topology.client?.mongoLogger;\n        this.component = 'connection';\n        process.nextTick(() => {\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CREATED, new connection_pool_events_1.ConnectionPoolCreatedEvent(this));\n        });\n    }\n    /** The address of the endpoint the pool is connected to */\n    get address() {\n        return this.options.hostAddress.toString();\n    }\n    /**\n     * Check if the pool has been closed\n     *\n     * TODO(NODE-3263): We can remove this property once shell no longer needs it\n     */\n    get closed() {\n        return this.poolState === exports.PoolState.closed;\n    }\n    /** An integer expressing how many total connections (available + pending + in use) the pool currently has */\n    get totalConnectionCount() {\n        return (this.availableConnectionCount + this.pendingConnectionCount + this.currentCheckedOutCount);\n    }\n    /** An integer expressing how many connections are currently available in the pool. */\n    get availableConnectionCount() {\n        return this.connections.length;\n    }\n    get pendingConnectionCount() {\n        return this.pending;\n    }\n    get currentCheckedOutCount() {\n        return this.checkedOut.size;\n    }\n    get waitQueueSize() {\n        return this.waitQueue.length;\n    }\n    get loadBalanced() {\n        return this.options.loadBalanced;\n    }\n    get serverError() {\n        return this.server.description.error;\n    }\n    /**\n     * This is exposed ONLY for use in mongosh, to enable\n     * killing all connections if a user quits the shell with\n     * operations in progress.\n     *\n     * This property may be removed as a part of NODE-3263.\n     */\n    get checkedOutConnections() {\n        return this.checkedOut;\n    }\n    /**\n     * Get the metrics information for the pool when a wait queue timeout occurs.\n     */\n    waitQueueErrorMetrics() {\n        return this.metrics.info(this.options.maxPoolSize);\n    }\n    /**\n     * Set the pool state to \"ready\"\n     */\n    ready() {\n        if (this.poolState !== exports.PoolState.paused) {\n            return;\n        }\n        this.poolState = exports.PoolState.ready;\n        this.emitAndLog(ConnectionPool.CONNECTION_POOL_READY, new connection_pool_events_1.ConnectionPoolReadyEvent(this));\n        (0, timers_1.clearTimeout)(this.minPoolSizeTimer);\n        this.ensureMinPoolSize();\n    }\n    /**\n     * Check a connection out of this pool. The connection will continue to be tracked, but no reference to it\n     * will be held by the pool. This means that if a connection is checked out it MUST be checked back in or\n     * explicitly destroyed by the new owner.\n     */\n    async checkOut(options) {\n        const checkoutTime = (0, utils_1.now)();\n        this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_STARTED, new connection_pool_events_1.ConnectionCheckOutStartedEvent(this));\n        const { promise, resolve, reject } = (0, utils_1.promiseWithResolvers)();\n        const timeout = options.timeoutContext.connectionCheckoutTimeout;\n        const waitQueueMember = {\n            resolve,\n            reject,\n            cancelled: false,\n            checkoutTime\n        };\n        const abortListener = (0, utils_1.addAbortListener)(options.signal, function () {\n            waitQueueMember.cancelled = true;\n            reject(this.reason);\n        });\n        this.waitQueue.push(waitQueueMember);\n        process.nextTick(() => this.processWaitQueue());\n        try {\n            timeout?.throwIfExpired();\n            return await (timeout ? Promise.race([promise, timeout]) : promise);\n        }\n        catch (error) {\n            if (timeout_1.TimeoutError.is(error)) {\n                timeout?.clear();\n                waitQueueMember.cancelled = true;\n                this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_FAILED, new connection_pool_events_1.ConnectionCheckOutFailedEvent(this, 'timeout', waitQueueMember.checkoutTime));\n                const timeoutError = new errors_1.WaitQueueTimeoutError(this.loadBalanced\n                    ? this.waitQueueErrorMetrics()\n                    : 'Timed out while checking out a connection from connection pool', this.address);\n                if (options.timeoutContext.csotEnabled()) {\n                    throw new error_1.MongoOperationTimeoutError('Timed out during connection checkout', {\n                        cause: timeoutError\n                    });\n                }\n                throw timeoutError;\n            }\n            throw error;\n        }\n        finally {\n            abortListener?.[utils_1.kDispose]();\n            timeout?.clear();\n        }\n    }\n    /**\n     * Check a connection into the pool.\n     *\n     * @param connection - The connection to check in\n     */\n    checkIn(connection) {\n        if (!this.checkedOut.has(connection)) {\n            return;\n        }\n        const poolClosed = this.closed;\n        const stale = this.connectionIsStale(connection);\n        const willDestroy = !!(poolClosed || stale || connection.closed);\n        if (!willDestroy) {\n            connection.markAvailable();\n            this.connections.unshift(connection);\n        }\n        this.checkedOut.delete(connection);\n        this.emitAndLog(ConnectionPool.CONNECTION_CHECKED_IN, new connection_pool_events_1.ConnectionCheckedInEvent(this, connection));\n        if (willDestroy) {\n            const reason = connection.closed ? 'error' : poolClosed ? 'poolClosed' : 'stale';\n            this.destroyConnection(connection, reason);\n        }\n        process.nextTick(() => this.processWaitQueue());\n    }\n    /**\n     * Clear the pool\n     *\n     * Pool reset is handled by incrementing the pool's generation count. Any existing connection of a\n     * previous generation will eventually be pruned during subsequent checkouts.\n     */\n    clear(options = {}) {\n        if (this.closed) {\n            return;\n        }\n        // handle load balanced case\n        if (this.loadBalanced) {\n            const { serviceId } = options;\n            if (!serviceId) {\n                throw new error_1.MongoRuntimeError('ConnectionPool.clear() called in load balanced mode with no serviceId.');\n            }\n            const sid = serviceId.toHexString();\n            const generation = this.serviceGenerations.get(sid);\n            // Only need to worry if the generation exists, since it should\n            // always be there but typescript needs the check.\n            if (generation == null) {\n                throw new error_1.MongoRuntimeError('Service generations are required in load balancer mode.');\n            }\n            else {\n                // Increment the generation for the service id.\n                this.serviceGenerations.set(sid, generation + 1);\n            }\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CLEARED, new connection_pool_events_1.ConnectionPoolClearedEvent(this, { serviceId }));\n            return;\n        }\n        // handle non load-balanced case\n        const interruptInUseConnections = options.interruptInUseConnections ?? false;\n        const oldGeneration = this.generation;\n        this.generation += 1;\n        const alreadyPaused = this.poolState === exports.PoolState.paused;\n        this.poolState = exports.PoolState.paused;\n        this.clearMinPoolSizeTimer();\n        if (!alreadyPaused) {\n            this.emitAndLog(ConnectionPool.CONNECTION_POOL_CLEARED, new connection_pool_events_1.ConnectionPoolClearedEvent(this, {\n                interruptInUseConnections\n            }));\n        }\n        if (interruptInUseConnections) {\n            process.nextTick(() => this.interruptInUseConnections(oldGeneration));\n        }\n        this.processWaitQueue();\n    }\n    /**\n     * Closes all stale in-use connections in the pool with a resumable PoolClearedOnNetworkError.\n     *\n     * Only connections where `connection.generation <= minGeneration` are killed.\n     */\n    interruptInUseConnections(minGeneration) {\n        for (const connection of this.checkedOut) {\n            if (connection.generation <= minGeneration) {\n                connection.onError(new errors_1.PoolClearedOnNetworkError(this));\n                this.checkIn(connection);\n            }\n        }\n    }\n    /** Close the pool */\n    close() {\n        if (this.closed) {\n            return;\n        }\n        // immediately cancel any in-flight connections\n        this.cancellationToken.emit('cancel');\n        // end the connection counter\n        if (typeof this.connectionCounter.return === 'function') {\n            this.connectionCounter.return(undefined);\n        }\n        this.poolState = exports.PoolState.closed;\n        this.clearMinPoolSizeTimer();\n        this.processWaitQueue();\n        for (const conn of this.connections) {\n            this.emitAndLog(ConnectionPool.CONNECTION_CLOSED, new connection_pool_events_1.ConnectionClosedEvent(this, conn, 'poolClosed'));\n            conn.destroy();\n        }\n        this.connections.clear();\n        this.emitAndLog(ConnectionPool.CONNECTION_POOL_CLOSED, new connection_pool_events_1.ConnectionPoolClosedEvent(this));\n    }\n    /**\n     * @internal\n     * Reauthenticate a connection\n     */\n    async reauthenticate(connection) {\n        const authContext = connection.authContext;\n        if (!authContext) {\n            throw new error_1.MongoRuntimeError('No auth context found on connection.');\n        }\n        const credentials = authContext.credentials;\n        if (!credentials) {\n            throw new error_1.MongoMissingCredentialsError('Connection is missing credentials when asked to reauthenticate');\n        }\n        const resolvedCredentials = credentials.resolveAuthMechanism(connection.hello);\n        const provider = this.server.topology.client.s.authProviders.getOrCreateProvider(resolvedCredentials.mechanism, resolvedCredentials.mechanismProperties);\n        if (!provider) {\n            throw new error_1.MongoMissingCredentialsError(`Reauthenticate failed due to no auth provider for ${credentials.mechanism}`);\n        }\n        await provider.reauth(authContext);\n        return;\n    }\n    /** Clear the min pool size timer */\n    clearMinPoolSizeTimer() {\n        const minPoolSizeTimer = this.minPoolSizeTimer;\n        if (minPoolSizeTimer) {\n            (0, timers_1.clearTimeout)(minPoolSizeTimer);\n        }\n    }\n    destroyConnection(connection, reason) {\n        this.emitAndLog(ConnectionPool.CONNECTION_CLOSED, new connection_pool_events_1.ConnectionClosedEvent(this, connection, reason));\n        // destroy the connection\n        connection.destroy();\n    }\n    connectionIsStale(connection) {\n        const serviceId = connection.serviceId;\n        if (this.loadBalanced && serviceId) {\n            const sid = serviceId.toHexString();\n            const generation = this.serviceGenerations.get(sid);\n            return connection.generation !== generation;\n        }\n        return connection.generation !== this.generation;\n    }\n    connectionIsIdle(connection) {\n        return !!(this.options.maxIdleTimeMS && connection.idleTime > this.options.maxIdleTimeMS);\n    }\n    /**\n     * Destroys a connection if the connection is perished.\n     *\n     * @returns `true` if the connection was destroyed, `false` otherwise.\n     */\n    destroyConnectionIfPerished(connection) {\n        const isStale = this.connectionIsStale(connection);\n        const isIdle = this.connectionIsIdle(connection);\n        if (!isStale && !isIdle && !connection.closed) {\n            return false;\n        }\n        const reason = connection.closed ? 'error' : isStale ? 'stale' : 'idle';\n        this.destroyConnection(connection, reason);\n        return true;\n    }\n    createConnection(callback) {\n        const connectOptions = {\n            ...this.options,\n            id: this.connectionCounter.next().value,\n            generation: this.generation,\n            cancellationToken: this.cancellationToken,\n            mongoLogger: this.mongoLogger,\n            authProviders: this.server.topology.client.s.authProviders\n        };\n        this.pending++;\n        // This is our version of a \"virtual\" no-I/O connection as the spec requires\n        const connectionCreatedTime = (0, utils_1.now)();\n        this.emitAndLog(ConnectionPool.CONNECTION_CREATED, new connection_pool_events_1.ConnectionCreatedEvent(this, { id: connectOptions.id }));\n        (0, connect_1.connect)(connectOptions).then(connection => {\n            // The pool might have closed since we started trying to create a connection\n            if (this.poolState !== exports.PoolState.ready) {\n                this.pending--;\n                connection.destroy();\n                callback(this.closed ? new errors_1.PoolClosedError(this) : new errors_1.PoolClearedError(this));\n                return;\n            }\n            // forward all events from the connection to the pool\n            for (const event of [...constants_1.APM_EVENTS, connection_1.Connection.CLUSTER_TIME_RECEIVED]) {\n                connection.on(event, (e) => this.emit(event, e));\n            }\n            if (this.loadBalanced) {\n                connection.on(connection_1.Connection.PINNED, pinType => this.metrics.markPinned(pinType));\n                connection.on(connection_1.Connection.UNPINNED, pinType => this.metrics.markUnpinned(pinType));\n                const serviceId = connection.serviceId;\n                if (serviceId) {\n                    let generation;\n                    const sid = serviceId.toHexString();\n                    if ((generation = this.serviceGenerations.get(sid))) {\n                        connection.generation = generation;\n                    }\n                    else {\n                        this.serviceGenerations.set(sid, 0);\n                        connection.generation = 0;\n                    }\n                }\n            }\n            connection.markAvailable();\n            this.emitAndLog(ConnectionPool.CONNECTION_READY, new connection_pool_events_1.ConnectionReadyEvent(this, connection, connectionCreatedTime));\n            this.pending--;\n            callback(undefined, connection);\n        }, error => {\n            this.pending--;\n            this.server.handleError(error);\n            this.emitAndLog(ConnectionPool.CONNECTION_CLOSED, new connection_pool_events_1.ConnectionClosedEvent(this, { id: connectOptions.id, serviceId: undefined }, 'error', \n            // TODO(NODE-5192): Remove this cast\n            error));\n            if (error instanceof error_1.MongoNetworkError || error instanceof error_1.MongoServerError) {\n                error.connectionGeneration = connectOptions.generation;\n            }\n            callback(error ?? new error_1.MongoRuntimeError('Connection creation failed without error'));\n        });\n    }\n    ensureMinPoolSize() {\n        const minPoolSize = this.options.minPoolSize;\n        if (this.poolState !== exports.PoolState.ready || minPoolSize === 0) {\n            return;\n        }\n        this.connections.prune(connection => this.destroyConnectionIfPerished(connection));\n        if (this.totalConnectionCount < minPoolSize &&\n            this.pendingConnectionCount < this.options.maxConnecting) {\n            // NOTE: ensureMinPoolSize should not try to get all the pending\n            // connection permits because that potentially delays the availability of\n            // the connection to a checkout request\n            this.createConnection((err, connection) => {\n                if (!err && connection) {\n                    this.connections.push(connection);\n                    process.nextTick(() => this.processWaitQueue());\n                }\n                if (this.poolState === exports.PoolState.ready) {\n                    (0, timers_1.clearTimeout)(this.minPoolSizeTimer);\n                    this.minPoolSizeTimer = (0, timers_1.setTimeout)(() => this.ensureMinPoolSize(), this.options.minPoolSizeCheckFrequencyMS);\n                }\n            });\n        }\n        else {\n            (0, timers_1.clearTimeout)(this.minPoolSizeTimer);\n            this.minPoolSizeTimer = (0, timers_1.setTimeout)(() => this.ensureMinPoolSize(), this.options.minPoolSizeCheckFrequencyMS);\n        }\n    }\n    processWaitQueue() {\n        if (this.processingWaitQueue) {\n            return;\n        }\n        this.processingWaitQueue = true;\n        while (this.waitQueueSize) {\n            const waitQueueMember = this.waitQueue.first();\n            if (!waitQueueMember) {\n                this.waitQueue.shift();\n                continue;\n            }\n            if (waitQueueMember.cancelled) {\n                this.waitQueue.shift();\n                continue;\n            }\n            if (this.poolState !== exports.PoolState.ready) {\n                const reason = this.closed ? 'poolClosed' : 'connectionError';\n                const error = this.closed ? new errors_1.PoolClosedError(this) : new errors_1.PoolClearedError(this);\n                this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_FAILED, new connection_pool_events_1.ConnectionCheckOutFailedEvent(this, reason, waitQueueMember.checkoutTime, error));\n                this.waitQueue.shift();\n                waitQueueMember.reject(error);\n                continue;\n            }\n            if (!this.availableConnectionCount) {\n                break;\n            }\n            const connection = this.connections.shift();\n            if (!connection) {\n                break;\n            }\n            if (!this.destroyConnectionIfPerished(connection)) {\n                this.checkedOut.add(connection);\n                this.emitAndLog(ConnectionPool.CONNECTION_CHECKED_OUT, new connection_pool_events_1.ConnectionCheckedOutEvent(this, connection, waitQueueMember.checkoutTime));\n                this.waitQueue.shift();\n                waitQueueMember.resolve(connection);\n            }\n        }\n        const { maxPoolSize, maxConnecting } = this.options;\n        while (this.waitQueueSize > 0 &&\n            this.pendingConnectionCount < maxConnecting &&\n            (maxPoolSize === 0 || this.totalConnectionCount < maxPoolSize)) {\n            const waitQueueMember = this.waitQueue.shift();\n            if (!waitQueueMember || waitQueueMember.cancelled) {\n                continue;\n            }\n            this.createConnection((err, connection) => {\n                if (waitQueueMember.cancelled) {\n                    if (!err && connection) {\n                        this.connections.push(connection);\n                    }\n                }\n                else {\n                    if (err) {\n                        this.emitAndLog(ConnectionPool.CONNECTION_CHECK_OUT_FAILED, \n                        // TODO(NODE-5192): Remove this cast\n                        new connection_pool_events_1.ConnectionCheckOutFailedEvent(this, 'connectionError', waitQueueMember.checkoutTime, err));\n                        waitQueueMember.reject(err);\n                    }\n                    else if (connection) {\n                        this.checkedOut.add(connection);\n                        this.emitAndLog(ConnectionPool.CONNECTION_CHECKED_OUT, new connection_pool_events_1.ConnectionCheckedOutEvent(this, connection, waitQueueMember.checkoutTime));\n                        waitQueueMember.resolve(connection);\n                    }\n                }\n                process.nextTick(() => this.processWaitQueue());\n            });\n        }\n        this.processingWaitQueue = false;\n    }\n}\nexports.ConnectionPool = ConnectionPool;\n/**\n * Emitted when the connection pool is created.\n * @event\n */\nConnectionPool.CONNECTION_POOL_CREATED = constants_1.CONNECTION_POOL_CREATED;\n/**\n * Emitted once when the connection pool is closed\n * @event\n */\nConnectionPool.CONNECTION_POOL_CLOSED = constants_1.CONNECTION_POOL_CLOSED;\n/**\n * Emitted each time the connection pool is cleared and it's generation incremented\n * @event\n */\nConnectionPool.CONNECTION_POOL_CLEARED = constants_1.CONNECTION_POOL_CLEARED;\n/**\n * Emitted each time the connection pool is marked ready\n * @event\n */\nConnectionPool.CONNECTION_POOL_READY = constants_1.CONNECTION_POOL_READY;\n/**\n * Emitted when a connection is created.\n * @event\n */\nConnectionPool.CONNECTION_CREATED = constants_1.CONNECTION_CREATED;\n/**\n * Emitted when a connection becomes established, and is ready to use\n * @event\n */\nConnectionPool.CONNECTION_READY = constants_1.CONNECTION_READY;\n/**\n * Emitted when a connection is closed\n * @event\n */\nConnectionPool.CONNECTION_CLOSED = constants_1.CONNECTION_CLOSED;\n/**\n * Emitted when an attempt to check out a connection begins\n * @event\n */\nConnectionPool.CONNECTION_CHECK_OUT_STARTED = constants_1.CONNECTION_CHECK_OUT_STARTED;\n/**\n * Emitted when an attempt to check out a connection fails\n * @event\n */\nConnectionPool.CONNECTION_CHECK_OUT_FAILED = constants_1.CONNECTION_CHECK_OUT_FAILED;\n/**\n * Emitted each time a connection is successfully checked out of the connection pool\n * @event\n */\nConnectionPool.CONNECTION_CHECKED_OUT = constants_1.CONNECTION_CHECKED_OUT;\n/**\n * Emitted each time a connection is successfully checked into the connection pool\n * @event\n */\nConnectionPool.CONNECTION_CHECKED_IN = constants_1.CONNECTION_CHECKED_IN;\n//# sourceMappingURL=connection_pool.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29ubmVjdGlvbl9wb29sLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQixHQUFHLGlCQUFpQjtBQUMxQyxpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxvQkFBb0IsbUJBQU8sQ0FBQyxxR0FBYztBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxzQkFBc0IsbUJBQU8sQ0FBQyx5R0FBZ0I7QUFDOUMsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMscUdBQVc7QUFDckMscUJBQXFCLG1CQUFPLENBQUMsMkdBQWM7QUFDM0MsaUNBQWlDLG1CQUFPLENBQUMsbUlBQTBCO0FBQ25FLGlCQUFpQixtQkFBTyxDQUFDLG1HQUFVO0FBQ25DLGtCQUFrQixtQkFBTyxDQUFDLHFHQUFXO0FBQ3JDO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiwyQkFBMkI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFlBQVk7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9JQUFvSSxXQUFXO0FBQy9JO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0hBQWdILHNCQUFzQjtBQUN0STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVIQUF1SCx1QkFBdUI7QUFDOUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EseUhBQXlILDZDQUE2QztBQUN0SztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDZCQUE2QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29ubmVjdGlvbl9wb29sLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db25uZWN0aW9uUG9vbCA9IGV4cG9ydHMuUG9vbFN0YXRlID0gdm9pZCAwO1xuY29uc3QgdGltZXJzXzEgPSByZXF1aXJlKFwidGltZXJzXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCB0aW1lb3V0XzEgPSByZXF1aXJlKFwiLi4vdGltZW91dFwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb25uZWN0XzEgPSByZXF1aXJlKFwiLi9jb25uZWN0XCIpO1xuY29uc3QgY29ubmVjdGlvbl8xID0gcmVxdWlyZShcIi4vY29ubmVjdGlvblwiKTtcbmNvbnN0IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMSA9IHJlcXVpcmUoXCIuL2Nvbm5lY3Rpb25fcG9vbF9ldmVudHNcIik7XG5jb25zdCBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuL2Vycm9yc1wiKTtcbmNvbnN0IG1ldHJpY3NfMSA9IHJlcXVpcmUoXCIuL21ldHJpY3NcIik7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLlBvb2xTdGF0ZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIHBhdXNlZDogJ3BhdXNlZCcsXG4gICAgcmVhZHk6ICdyZWFkeScsXG4gICAgY2xvc2VkOiAnY2xvc2VkJ1xufSk7XG4vKipcbiAqIEEgcG9vbCBvZiBjb25uZWN0aW9ucyB3aGljaCBkeW5hbWljYWxseSByZXNpemVzLCBhbmQgZW1pdCBldmVudHMgcmVsYXRlZCB0byBwb29sIGFjdGl2aXR5XG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ29ubmVjdGlvblBvb2wgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5vbignZXJyb3InLCB1dGlsc18xLm5vb3ApO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuZnJlZXplKHtcbiAgICAgICAgICAgIGNvbm5lY3Rpb25UeXBlOiBjb25uZWN0aW9uXzEuQ29ubmVjdGlvbixcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBtYXhQb29sU2l6ZTogb3B0aW9ucy5tYXhQb29sU2l6ZSA/PyAxMDAsXG4gICAgICAgICAgICBtaW5Qb29sU2l6ZTogb3B0aW9ucy5taW5Qb29sU2l6ZSA/PyAwLFxuICAgICAgICAgICAgbWF4Q29ubmVjdGluZzogb3B0aW9ucy5tYXhDb25uZWN0aW5nID8/IDIsXG4gICAgICAgICAgICBtYXhJZGxlVGltZU1TOiBvcHRpb25zLm1heElkbGVUaW1lTVMgPz8gMCxcbiAgICAgICAgICAgIHdhaXRRdWV1ZVRpbWVvdXRNUzogb3B0aW9ucy53YWl0UXVldWVUaW1lb3V0TVMgPz8gMCxcbiAgICAgICAgICAgIG1pblBvb2xTaXplQ2hlY2tGcmVxdWVuY3lNUzogb3B0aW9ucy5taW5Qb29sU2l6ZUNoZWNrRnJlcXVlbmN5TVMgPz8gMTAwLFxuICAgICAgICAgICAgYXV0b0VuY3J5cHRlcjogb3B0aW9ucy5hdXRvRW5jcnlwdGVyXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1pblBvb2xTaXplID4gdGhpcy5vcHRpb25zLm1heFBvb2xTaXplKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDb25uZWN0aW9uIHBvb2wgbWluaW11bSBzaXplIG11c3Qgbm90IGJlIGdyZWF0ZXIgdGhhbiBtYXhpbXVtIHBvb2wgc2l6ZScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucG9vbFN0YXRlID0gZXhwb3J0cy5Qb29sU3RhdGUucGF1c2VkO1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9ucyA9IG5ldyB1dGlsc18xLkxpc3QoKTtcbiAgICAgICAgdGhpcy5wZW5kaW5nID0gMDtcbiAgICAgICAgdGhpcy5jaGVja2VkT3V0ID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLm1pblBvb2xTaXplVGltZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ2VuZXJhdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuc2VydmljZUdlbmVyYXRpb25zID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25Db3VudGVyID0gKDAsIHV0aWxzXzEubWFrZUNvdW50ZXIpKDEpO1xuICAgICAgICB0aGlzLmNhbmNlbGxhdGlvblRva2VuID0gbmV3IG1vbmdvX3R5cGVzXzEuQ2FuY2VsbGF0aW9uVG9rZW4oKTtcbiAgICAgICAgdGhpcy5jYW5jZWxsYXRpb25Ub2tlbi5zZXRNYXhMaXN0ZW5lcnMoSW5maW5pdHkpO1xuICAgICAgICB0aGlzLndhaXRRdWV1ZSA9IG5ldyB1dGlsc18xLkxpc3QoKTtcbiAgICAgICAgdGhpcy5tZXRyaWNzID0gbmV3IG1ldHJpY3NfMS5Db25uZWN0aW9uUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nV2FpdFF1ZXVlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubW9uZ29Mb2dnZXIgPSB0aGlzLnNlcnZlci50b3BvbG9neS5jbGllbnQ/Lm1vbmdvTG9nZ2VyO1xuICAgICAgICB0aGlzLmNvbXBvbmVudCA9ICdjb25uZWN0aW9uJztcbiAgICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9QT09MX0NSRUFURUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xDcmVhdGVkRXZlbnQodGhpcykpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIFRoZSBhZGRyZXNzIG9mIHRoZSBlbmRwb2ludCB0aGUgcG9vbCBpcyBjb25uZWN0ZWQgdG8gKi9cbiAgICBnZXQgYWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5ob3N0QWRkcmVzcy50b1N0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgcG9vbCBoYXMgYmVlbiBjbG9zZWRcbiAgICAgKlxuICAgICAqIFRPRE8oTk9ERS0zMjYzKTogV2UgY2FuIHJlbW92ZSB0aGlzIHByb3BlcnR5IG9uY2Ugc2hlbGwgbm8gbG9uZ2VyIG5lZWRzIGl0XG4gICAgICovXG4gICAgZ2V0IGNsb3NlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9vbFN0YXRlID09PSBleHBvcnRzLlBvb2xTdGF0ZS5jbG9zZWQ7XG4gICAgfVxuICAgIC8qKiBBbiBpbnRlZ2VyIGV4cHJlc3NpbmcgaG93IG1hbnkgdG90YWwgY29ubmVjdGlvbnMgKGF2YWlsYWJsZSArIHBlbmRpbmcgKyBpbiB1c2UpIHRoZSBwb29sIGN1cnJlbnRseSBoYXMgKi9cbiAgICBnZXQgdG90YWxDb25uZWN0aW9uQ291bnQoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5hdmFpbGFibGVDb25uZWN0aW9uQ291bnQgKyB0aGlzLnBlbmRpbmdDb25uZWN0aW9uQ291bnQgKyB0aGlzLmN1cnJlbnRDaGVja2VkT3V0Q291bnQpO1xuICAgIH1cbiAgICAvKiogQW4gaW50ZWdlciBleHByZXNzaW5nIGhvdyBtYW55IGNvbm5lY3Rpb25zIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlIGluIHRoZSBwb29sLiAqL1xuICAgIGdldCBhdmFpbGFibGVDb25uZWN0aW9uQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb25zLmxlbmd0aDtcbiAgICB9XG4gICAgZ2V0IHBlbmRpbmdDb25uZWN0aW9uQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlbmRpbmc7XG4gICAgfVxuICAgIGdldCBjdXJyZW50Q2hlY2tlZE91dENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja2VkT3V0LnNpemU7XG4gICAgfVxuICAgIGdldCB3YWl0UXVldWVTaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53YWl0UXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBnZXQgbG9hZEJhbGFuY2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmxvYWRCYWxhbmNlZDtcbiAgICB9XG4gICAgZ2V0IHNlcnZlckVycm9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2ZXIuZGVzY3JpcHRpb24uZXJyb3I7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgZXhwb3NlZCBPTkxZIGZvciB1c2UgaW4gbW9uZ29zaCwgdG8gZW5hYmxlXG4gICAgICoga2lsbGluZyBhbGwgY29ubmVjdGlvbnMgaWYgYSB1c2VyIHF1aXRzIHRoZSBzaGVsbCB3aXRoXG4gICAgICogb3BlcmF0aW9ucyBpbiBwcm9ncmVzcy5cbiAgICAgKlxuICAgICAqIFRoaXMgcHJvcGVydHkgbWF5IGJlIHJlbW92ZWQgYXMgYSBwYXJ0IG9mIE5PREUtMzI2My5cbiAgICAgKi9cbiAgICBnZXQgY2hlY2tlZE91dENvbm5lY3Rpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja2VkT3V0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIG1ldHJpY3MgaW5mb3JtYXRpb24gZm9yIHRoZSBwb29sIHdoZW4gYSB3YWl0IHF1ZXVlIHRpbWVvdXQgb2NjdXJzLlxuICAgICAqL1xuICAgIHdhaXRRdWV1ZUVycm9yTWV0cmljcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWV0cmljcy5pbmZvKHRoaXMub3B0aW9ucy5tYXhQb29sU2l6ZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgcG9vbCBzdGF0ZSB0byBcInJlYWR5XCJcbiAgICAgKi9cbiAgICByZWFkeSgpIHtcbiAgICAgICAgaWYgKHRoaXMucG9vbFN0YXRlICE9PSBleHBvcnRzLlBvb2xTdGF0ZS5wYXVzZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvb2xTdGF0ZSA9IGV4cG9ydHMuUG9vbFN0YXRlLnJlYWR5O1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9QT09MX1JFQURZLCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sUmVhZHlFdmVudCh0aGlzKSk7XG4gICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMubWluUG9vbFNpemVUaW1lcik7XG4gICAgICAgIHRoaXMuZW5zdXJlTWluUG9vbFNpemUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2sgYSBjb25uZWN0aW9uIG91dCBvZiB0aGlzIHBvb2wuIFRoZSBjb25uZWN0aW9uIHdpbGwgY29udGludWUgdG8gYmUgdHJhY2tlZCwgYnV0IG5vIHJlZmVyZW5jZSB0byBpdFxuICAgICAqIHdpbGwgYmUgaGVsZCBieSB0aGUgcG9vbC4gVGhpcyBtZWFucyB0aGF0IGlmIGEgY29ubmVjdGlvbiBpcyBjaGVja2VkIG91dCBpdCBNVVNUIGJlIGNoZWNrZWQgYmFjayBpbiBvclxuICAgICAqIGV4cGxpY2l0bHkgZGVzdHJveWVkIGJ5IHRoZSBuZXcgb3duZXIuXG4gICAgICovXG4gICAgYXN5bmMgY2hlY2tPdXQob3B0aW9ucykge1xuICAgICAgICBjb25zdCBjaGVja291dFRpbWUgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVELCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja091dFN0YXJ0ZWRFdmVudCh0aGlzKSk7XG4gICAgICAgIGNvbnN0IHsgcHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0IH0gPSAoMCwgdXRpbHNfMS5wcm9taXNlV2l0aFJlc29sdmVycykoKTtcbiAgICAgICAgY29uc3QgdGltZW91dCA9IG9wdGlvbnMudGltZW91dENvbnRleHQuY29ubmVjdGlvbkNoZWNrb3V0VGltZW91dDtcbiAgICAgICAgY29uc3Qgd2FpdFF1ZXVlTWVtYmVyID0ge1xuICAgICAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgICAgIHJlamVjdCxcbiAgICAgICAgICAgIGNhbmNlbGxlZDogZmFsc2UsXG4gICAgICAgICAgICBjaGVja291dFRpbWVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYWJvcnRMaXN0ZW5lciA9ICgwLCB1dGlsc18xLmFkZEFib3J0TGlzdGVuZXIpKG9wdGlvbnMuc2lnbmFsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIuY2FuY2VsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlamVjdCh0aGlzLnJlYXNvbik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLndhaXRRdWV1ZS5wdXNoKHdhaXRRdWV1ZU1lbWJlcik7XG4gICAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4gdGhpcy5wcm9jZXNzV2FpdFF1ZXVlKCkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGltZW91dD8udGhyb3dJZkV4cGlyZWQoKTtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCAodGltZW91dCA/IFByb21pc2UucmFjZShbcHJvbWlzZSwgdGltZW91dF0pIDogcHJvbWlzZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGltZW91dF8xLlRpbWVvdXRFcnJvci5pcyhlcnJvcikpIHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0Py5jbGVhcigpO1xuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5jYW5jZWxsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLX09VVF9GQUlMRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0RmFpbGVkRXZlbnQodGhpcywgJ3RpbWVvdXQnLCB3YWl0UXVldWVNZW1iZXIuY2hlY2tvdXRUaW1lKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZW91dEVycm9yID0gbmV3IGVycm9yc18xLldhaXRRdWV1ZVRpbWVvdXRFcnJvcih0aGlzLmxvYWRCYWxhbmNlZFxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMud2FpdFF1ZXVlRXJyb3JNZXRyaWNzKClcbiAgICAgICAgICAgICAgICAgICAgOiAnVGltZWQgb3V0IHdoaWxlIGNoZWNraW5nIG91dCBhIGNvbm5lY3Rpb24gZnJvbSBjb25uZWN0aW9uIHBvb2wnLCB0aGlzLmFkZHJlc3MpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXRDb250ZXh0LmNzb3RFbmFibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IoJ1RpbWVkIG91dCBkdXJpbmcgY29ubmVjdGlvbiBjaGVja291dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlOiB0aW1lb3V0RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRocm93IHRpbWVvdXRFcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgYWJvcnRMaXN0ZW5lcj8uW3V0aWxzXzEua0Rpc3Bvc2VdKCk7XG4gICAgICAgICAgICB0aW1lb3V0Py5jbGVhcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoZWNrIGEgY29ubmVjdGlvbiBpbnRvIHRoZSBwb29sLlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbm5lY3Rpb24gLSBUaGUgY29ubmVjdGlvbiB0byBjaGVjayBpblxuICAgICAqL1xuICAgIGNoZWNrSW4oY29ubmVjdGlvbikge1xuICAgICAgICBpZiAoIXRoaXMuY2hlY2tlZE91dC5oYXMoY29ubmVjdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb29sQ2xvc2VkID0gdGhpcy5jbG9zZWQ7XG4gICAgICAgIGNvbnN0IHN0YWxlID0gdGhpcy5jb25uZWN0aW9uSXNTdGFsZShjb25uZWN0aW9uKTtcbiAgICAgICAgY29uc3Qgd2lsbERlc3Ryb3kgPSAhIShwb29sQ2xvc2VkIHx8IHN0YWxlIHx8IGNvbm5lY3Rpb24uY2xvc2VkKTtcbiAgICAgICAgaWYgKCF3aWxsRGVzdHJveSkge1xuICAgICAgICAgICAgY29ubmVjdGlvbi5tYXJrQXZhaWxhYmxlKCk7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25zLnVuc2hpZnQoY29ubmVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGVja2VkT3V0LmRlbGV0ZShjb25uZWN0aW9uKTtcbiAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTiwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2hlY2tlZEluRXZlbnQodGhpcywgY29ubmVjdGlvbikpO1xuICAgICAgICBpZiAod2lsbERlc3Ryb3kpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IGNvbm5lY3Rpb24uY2xvc2VkID8gJ2Vycm9yJyA6IHBvb2xDbG9zZWQgPyAncG9vbENsb3NlZCcgOiAnc3RhbGUnO1xuICAgICAgICAgICAgdGhpcy5kZXN0cm95Q29ubmVjdGlvbihjb25uZWN0aW9uLCByZWFzb24pO1xuICAgICAgICB9XG4gICAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4gdGhpcy5wcm9jZXNzV2FpdFF1ZXVlKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbGVhciB0aGUgcG9vbFxuICAgICAqXG4gICAgICogUG9vbCByZXNldCBpcyBoYW5kbGVkIGJ5IGluY3JlbWVudGluZyB0aGUgcG9vbCdzIGdlbmVyYXRpb24gY291bnQuIEFueSBleGlzdGluZyBjb25uZWN0aW9uIG9mIGFcbiAgICAgKiBwcmV2aW91cyBnZW5lcmF0aW9uIHdpbGwgZXZlbnR1YWxseSBiZSBwcnVuZWQgZHVyaW5nIHN1YnNlcXVlbnQgY2hlY2tvdXRzLlxuICAgICAqL1xuICAgIGNsZWFyKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBoYW5kbGUgbG9hZCBiYWxhbmNlZCBjYXNlXG4gICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgY29uc3QgeyBzZXJ2aWNlSWQgfSA9IG9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoIXNlcnZpY2VJZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDb25uZWN0aW9uUG9vbC5jbGVhcigpIGNhbGxlZCBpbiBsb2FkIGJhbGFuY2VkIG1vZGUgd2l0aCBubyBzZXJ2aWNlSWQuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzaWQgPSBzZXJ2aWNlSWQudG9IZXhTdHJpbmcoKTtcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5nZXQoc2lkKTtcbiAgICAgICAgICAgIC8vIE9ubHkgbmVlZCB0byB3b3JyeSBpZiB0aGUgZ2VuZXJhdGlvbiBleGlzdHMsIHNpbmNlIGl0IHNob3VsZFxuICAgICAgICAgICAgLy8gYWx3YXlzIGJlIHRoZXJlIGJ1dCB0eXBlc2NyaXB0IG5lZWRzIHRoZSBjaGVjay5cbiAgICAgICAgICAgIGlmIChnZW5lcmF0aW9uID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignU2VydmljZSBnZW5lcmF0aW9ucyBhcmUgcmVxdWlyZWQgaW4gbG9hZCBiYWxhbmNlciBtb2RlLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBnZW5lcmF0aW9uIGZvciB0aGUgc2VydmljZSBpZC5cbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5zZXQoc2lkLCBnZW5lcmF0aW9uICsgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9QT09MX0NMRUFSRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xDbGVhcmVkRXZlbnQodGhpcywgeyBzZXJ2aWNlSWQgfSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGhhbmRsZSBub24gbG9hZC1iYWxhbmNlZCBjYXNlXG4gICAgICAgIGNvbnN0IGludGVycnVwdEluVXNlQ29ubmVjdGlvbnMgPSBvcHRpb25zLmludGVycnVwdEluVXNlQ29ubmVjdGlvbnMgPz8gZmFsc2U7XG4gICAgICAgIGNvbnN0IG9sZEdlbmVyYXRpb24gPSB0aGlzLmdlbmVyYXRpb247XG4gICAgICAgIHRoaXMuZ2VuZXJhdGlvbiArPSAxO1xuICAgICAgICBjb25zdCBhbHJlYWR5UGF1c2VkID0gdGhpcy5wb29sU3RhdGUgPT09IGV4cG9ydHMuUG9vbFN0YXRlLnBhdXNlZDtcbiAgICAgICAgdGhpcy5wb29sU3RhdGUgPSBleHBvcnRzLlBvb2xTdGF0ZS5wYXVzZWQ7XG4gICAgICAgIHRoaXMuY2xlYXJNaW5Qb29sU2l6ZVRpbWVyKCk7XG4gICAgICAgIGlmICghYWxyZWFkeVBhdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVELCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50KHRoaXMsIHtcbiAgICAgICAgICAgICAgICBpbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGludGVycnVwdEluVXNlQ29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4gdGhpcy5pbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zKG9sZEdlbmVyYXRpb24pKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByb2Nlc3NXYWl0UXVldWUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xvc2VzIGFsbCBzdGFsZSBpbi11c2UgY29ubmVjdGlvbnMgaW4gdGhlIHBvb2wgd2l0aCBhIHJlc3VtYWJsZSBQb29sQ2xlYXJlZE9uTmV0d29ya0Vycm9yLlxuICAgICAqXG4gICAgICogT25seSBjb25uZWN0aW9ucyB3aGVyZSBgY29ubmVjdGlvbi5nZW5lcmF0aW9uIDw9IG1pbkdlbmVyYXRpb25gIGFyZSBraWxsZWQuXG4gICAgICovXG4gICAgaW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyhtaW5HZW5lcmF0aW9uKSB7XG4gICAgICAgIGZvciAoY29uc3QgY29ubmVjdGlvbiBvZiB0aGlzLmNoZWNrZWRPdXQpIHtcbiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uLmdlbmVyYXRpb24gPD0gbWluR2VuZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ub25FcnJvcihuZXcgZXJyb3JzXzEuUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvcih0aGlzKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja0luKGNvbm5lY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBDbG9zZSB0aGUgcG9vbCAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBpbW1lZGlhdGVseSBjYW5jZWwgYW55IGluLWZsaWdodCBjb25uZWN0aW9uc1xuICAgICAgICB0aGlzLmNhbmNlbGxhdGlvblRva2VuLmVtaXQoJ2NhbmNlbCcpO1xuICAgICAgICAvLyBlbmQgdGhlIGNvbm5lY3Rpb24gY291bnRlclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuY29ubmVjdGlvbkNvdW50ZXIucmV0dXJuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25Db3VudGVyLnJldHVybih1bmRlZmluZWQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucG9vbFN0YXRlID0gZXhwb3J0cy5Qb29sU3RhdGUuY2xvc2VkO1xuICAgICAgICB0aGlzLmNsZWFyTWluUG9vbFNpemVUaW1lcigpO1xuICAgICAgICB0aGlzLnByb2Nlc3NXYWl0UXVldWUoKTtcbiAgICAgICAgZm9yIChjb25zdCBjb25uIG9mIHRoaXMuY29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NMT1NFRCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2xvc2VkRXZlbnQodGhpcywgY29ubiwgJ3Bvb2xDbG9zZWQnKSk7XG4gICAgICAgICAgICBjb25uLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbm5lY3Rpb25zLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ0xPU0VELCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sQ2xvc2VkRXZlbnQodGhpcykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBSZWF1dGhlbnRpY2F0ZSBhIGNvbm5lY3Rpb25cbiAgICAgKi9cbiAgICBhc3luYyByZWF1dGhlbnRpY2F0ZShjb25uZWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IGF1dGhDb250ZXh0ID0gY29ubmVjdGlvbi5hdXRoQ29udGV4dDtcbiAgICAgICAgaWYgKCFhdXRoQ29udGV4dCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ05vIGF1dGggY29udGV4dCBmb3VuZCBvbiBjb25uZWN0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gYXV0aENvbnRleHQuY3JlZGVudGlhbHM7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoJ0Nvbm5lY3Rpb24gaXMgbWlzc2luZyBjcmVkZW50aWFscyB3aGVuIGFza2VkIHRvIHJlYXV0aGVudGljYXRlJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzb2x2ZWRDcmVkZW50aWFscyA9IGNyZWRlbnRpYWxzLnJlc29sdmVBdXRoTWVjaGFuaXNtKGNvbm5lY3Rpb24uaGVsbG8pO1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuc2VydmVyLnRvcG9sb2d5LmNsaWVudC5zLmF1dGhQcm92aWRlcnMuZ2V0T3JDcmVhdGVQcm92aWRlcihyZXNvbHZlZENyZWRlbnRpYWxzLm1lY2hhbmlzbSwgcmVzb2x2ZWRDcmVkZW50aWFscy5tZWNoYW5pc21Qcm9wZXJ0aWVzKTtcbiAgICAgICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcihgUmVhdXRoZW50aWNhdGUgZmFpbGVkIGR1ZSB0byBubyBhdXRoIHByb3ZpZGVyIGZvciAke2NyZWRlbnRpYWxzLm1lY2hhbmlzbX1gKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBwcm92aWRlci5yZWF1dGgoYXV0aENvbnRleHQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8qKiBDbGVhciB0aGUgbWluIHBvb2wgc2l6ZSB0aW1lciAqL1xuICAgIGNsZWFyTWluUG9vbFNpemVUaW1lcigpIHtcbiAgICAgICAgY29uc3QgbWluUG9vbFNpemVUaW1lciA9IHRoaXMubWluUG9vbFNpemVUaW1lcjtcbiAgICAgICAgaWYgKG1pblBvb2xTaXplVGltZXIpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKG1pblBvb2xTaXplVGltZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRlc3Ryb3lDb25uZWN0aW9uKGNvbm5lY3Rpb24sIHJlYXNvbikge1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DTE9TRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNsb3NlZEV2ZW50KHRoaXMsIGNvbm5lY3Rpb24sIHJlYXNvbikpO1xuICAgICAgICAvLyBkZXN0cm95IHRoZSBjb25uZWN0aW9uXG4gICAgICAgIGNvbm5lY3Rpb24uZGVzdHJveSgpO1xuICAgIH1cbiAgICBjb25uZWN0aW9uSXNTdGFsZShjb25uZWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IHNlcnZpY2VJZCA9IGNvbm5lY3Rpb24uc2VydmljZUlkO1xuICAgICAgICBpZiAodGhpcy5sb2FkQmFsYW5jZWQgJiYgc2VydmljZUlkKSB7XG4gICAgICAgICAgICBjb25zdCBzaWQgPSBzZXJ2aWNlSWQudG9IZXhTdHJpbmcoKTtcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5nZXQoc2lkKTtcbiAgICAgICAgICAgIHJldHVybiBjb25uZWN0aW9uLmdlbmVyYXRpb24gIT09IGdlbmVyYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24uZ2VuZXJhdGlvbiAhPT0gdGhpcy5nZW5lcmF0aW9uO1xuICAgIH1cbiAgICBjb25uZWN0aW9uSXNJZGxlKGNvbm5lY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuICEhKHRoaXMub3B0aW9ucy5tYXhJZGxlVGltZU1TICYmIGNvbm5lY3Rpb24uaWRsZVRpbWUgPiB0aGlzLm9wdGlvbnMubWF4SWRsZVRpbWVNUyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlc3Ryb3lzIGEgY29ubmVjdGlvbiBpZiB0aGUgY29ubmVjdGlvbiBpcyBwZXJpc2hlZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgY29ubmVjdGlvbiB3YXMgZGVzdHJveWVkLCBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBkZXN0cm95Q29ubmVjdGlvbklmUGVyaXNoZWQoY29ubmVjdGlvbikge1xuICAgICAgICBjb25zdCBpc1N0YWxlID0gdGhpcy5jb25uZWN0aW9uSXNTdGFsZShjb25uZWN0aW9uKTtcbiAgICAgICAgY29uc3QgaXNJZGxlID0gdGhpcy5jb25uZWN0aW9uSXNJZGxlKGNvbm5lY3Rpb24pO1xuICAgICAgICBpZiAoIWlzU3RhbGUgJiYgIWlzSWRsZSAmJiAhY29ubmVjdGlvbi5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZWFzb24gPSBjb25uZWN0aW9uLmNsb3NlZCA/ICdlcnJvcicgOiBpc1N0YWxlID8gJ3N0YWxlJyA6ICdpZGxlJztcbiAgICAgICAgdGhpcy5kZXN0cm95Q29ubmVjdGlvbihjb25uZWN0aW9uLCByZWFzb24pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY3JlYXRlQ29ubmVjdGlvbihjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBjb25uZWN0T3B0aW9ucyA9IHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIGlkOiB0aGlzLmNvbm5lY3Rpb25Db3VudGVyLm5leHQoKS52YWx1ZSxcbiAgICAgICAgICAgIGdlbmVyYXRpb246IHRoaXMuZ2VuZXJhdGlvbixcbiAgICAgICAgICAgIGNhbmNlbGxhdGlvblRva2VuOiB0aGlzLmNhbmNlbGxhdGlvblRva2VuLFxuICAgICAgICAgICAgbW9uZ29Mb2dnZXI6IHRoaXMubW9uZ29Mb2dnZXIsXG4gICAgICAgICAgICBhdXRoUHJvdmlkZXJzOiB0aGlzLnNlcnZlci50b3BvbG9neS5jbGllbnQucy5hdXRoUHJvdmlkZXJzXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucGVuZGluZysrO1xuICAgICAgICAvLyBUaGlzIGlzIG91ciB2ZXJzaW9uIG9mIGEgXCJ2aXJ0dWFsXCIgbm8tSS9PIGNvbm5lY3Rpb24gYXMgdGhlIHNwZWMgcmVxdWlyZXNcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbkNyZWF0ZWRUaW1lID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DUkVBVEVELCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQodGhpcywgeyBpZDogY29ubmVjdE9wdGlvbnMuaWQgfSkpO1xuICAgICAgICAoMCwgY29ubmVjdF8xLmNvbm5lY3QpKGNvbm5lY3RPcHRpb25zKS50aGVuKGNvbm5lY3Rpb24gPT4ge1xuICAgICAgICAgICAgLy8gVGhlIHBvb2wgbWlnaHQgaGF2ZSBjbG9zZWQgc2luY2Ugd2Ugc3RhcnRlZCB0cnlpbmcgdG8gY3JlYXRlIGEgY29ubmVjdGlvblxuICAgICAgICAgICAgaWYgKHRoaXMucG9vbFN0YXRlICE9PSBleHBvcnRzLlBvb2xTdGF0ZS5yZWFkeSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZy0tO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHRoaXMuY2xvc2VkID8gbmV3IGVycm9yc18xLlBvb2xDbG9zZWRFcnJvcih0aGlzKSA6IG5ldyBlcnJvcnNfMS5Qb29sQ2xlYXJlZEVycm9yKHRoaXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBmb3J3YXJkIGFsbCBldmVudHMgZnJvbSB0aGUgY29ubmVjdGlvbiB0byB0aGUgcG9vbFxuICAgICAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiBbLi4uY29uc3RhbnRzXzEuQVBNX0VWRU5UUywgY29ubmVjdGlvbl8xLkNvbm5lY3Rpb24uQ0xVU1RFUl9USU1FX1JFQ0VJVkVEXSkge1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ub24oZXZlbnQsIChlKSA9PiB0aGlzLmVtaXQoZXZlbnQsIGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ub24oY29ubmVjdGlvbl8xLkNvbm5lY3Rpb24uUElOTkVELCBwaW5UeXBlID0+IHRoaXMubWV0cmljcy5tYXJrUGlubmVkKHBpblR5cGUpKTtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm9uKGNvbm5lY3Rpb25fMS5Db25uZWN0aW9uLlVOUElOTkVELCBwaW5UeXBlID0+IHRoaXMubWV0cmljcy5tYXJrVW5waW5uZWQocGluVHlwZSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZpY2VJZCA9IGNvbm5lY3Rpb24uc2VydmljZUlkO1xuICAgICAgICAgICAgICAgIGlmIChzZXJ2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGdlbmVyYXRpb247XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHNlcnZpY2VJZC50b0hleFN0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGdlbmVyYXRpb24gPSB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5nZXQoc2lkKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uZ2VuZXJhdGlvbiA9IGdlbmVyYXRpb247XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VHZW5lcmF0aW9ucy5zZXQoc2lkLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uZ2VuZXJhdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25uZWN0aW9uLm1hcmtBdmFpbGFibGUoKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1JFQURZLCBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25SZWFkeUV2ZW50KHRoaXMsIGNvbm5lY3Rpb24sIGNvbm5lY3Rpb25DcmVhdGVkVGltZSkpO1xuICAgICAgICAgICAgdGhpcy5wZW5kaW5nLS07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGNvbm5lY3Rpb24pO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICB0aGlzLnBlbmRpbmctLTtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NMT1NFRCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2xvc2VkRXZlbnQodGhpcywgeyBpZDogY29ubmVjdE9wdGlvbnMuaWQsIHNlcnZpY2VJZDogdW5kZWZpbmVkIH0sICdlcnJvcicsIFxuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTUxOTIpOiBSZW1vdmUgdGhpcyBjYXN0XG4gICAgICAgICAgICBlcnJvcikpO1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvciB8fCBlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcikge1xuICAgICAgICAgICAgICAgIGVycm9yLmNvbm5lY3Rpb25HZW5lcmF0aW9uID0gY29ubmVjdE9wdGlvbnMuZ2VuZXJhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yID8/IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDb25uZWN0aW9uIGNyZWF0aW9uIGZhaWxlZCB3aXRob3V0IGVycm9yJykpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZW5zdXJlTWluUG9vbFNpemUoKSB7XG4gICAgICAgIGNvbnN0IG1pblBvb2xTaXplID0gdGhpcy5vcHRpb25zLm1pblBvb2xTaXplO1xuICAgICAgICBpZiAodGhpcy5wb29sU3RhdGUgIT09IGV4cG9ydHMuUG9vbFN0YXRlLnJlYWR5IHx8IG1pblBvb2xTaXplID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25uZWN0aW9ucy5wcnVuZShjb25uZWN0aW9uID0+IHRoaXMuZGVzdHJveUNvbm5lY3Rpb25JZlBlcmlzaGVkKGNvbm5lY3Rpb24pKTtcbiAgICAgICAgaWYgKHRoaXMudG90YWxDb25uZWN0aW9uQ291bnQgPCBtaW5Qb29sU2l6ZSAmJlxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nQ29ubmVjdGlvbkNvdW50IDwgdGhpcy5vcHRpb25zLm1heENvbm5lY3RpbmcpIHtcbiAgICAgICAgICAgIC8vIE5PVEU6IGVuc3VyZU1pblBvb2xTaXplIHNob3VsZCBub3QgdHJ5IHRvIGdldCBhbGwgdGhlIHBlbmRpbmdcbiAgICAgICAgICAgIC8vIGNvbm5lY3Rpb24gcGVybWl0cyBiZWNhdXNlIHRoYXQgcG90ZW50aWFsbHkgZGVsYXlzIHRoZSBhdmFpbGFiaWxpdHkgb2ZcbiAgICAgICAgICAgIC8vIHRoZSBjb25uZWN0aW9uIHRvIGEgY2hlY2tvdXQgcmVxdWVzdFxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDb25uZWN0aW9uKChlcnIsIGNvbm5lY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWVyciAmJiBjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbnMucHVzaChjb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB0aGlzLnByb2Nlc3NXYWl0UXVldWUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBvb2xTdGF0ZSA9PT0gZXhwb3J0cy5Qb29sU3RhdGUucmVhZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkodGhpcy5taW5Qb29sU2l6ZVRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5taW5Qb29sU2l6ZVRpbWVyID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKCgpID0+IHRoaXMuZW5zdXJlTWluUG9vbFNpemUoKSwgdGhpcy5vcHRpb25zLm1pblBvb2xTaXplQ2hlY2tGcmVxdWVuY3lNUyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAoMCwgdGltZXJzXzEuY2xlYXJUaW1lb3V0KSh0aGlzLm1pblBvb2xTaXplVGltZXIpO1xuICAgICAgICAgICAgdGhpcy5taW5Qb29sU2l6ZVRpbWVyID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKCgpID0+IHRoaXMuZW5zdXJlTWluUG9vbFNpemUoKSwgdGhpcy5vcHRpb25zLm1pblBvb2xTaXplQ2hlY2tGcmVxdWVuY3lNUyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc1dhaXRRdWV1ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc2luZ1dhaXRRdWV1ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvY2Vzc2luZ1dhaXRRdWV1ZSA9IHRydWU7XG4gICAgICAgIHdoaWxlICh0aGlzLndhaXRRdWV1ZVNpemUpIHtcbiAgICAgICAgICAgIGNvbnN0IHdhaXRRdWV1ZU1lbWJlciA9IHRoaXMud2FpdFF1ZXVlLmZpcnN0KCk7XG4gICAgICAgICAgICBpZiAoIXdhaXRRdWV1ZU1lbWJlcikge1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdFF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod2FpdFF1ZXVlTWVtYmVyLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdFF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5wb29sU3RhdGUgIT09IGV4cG9ydHMuUG9vbFN0YXRlLnJlYWR5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVhc29uID0gdGhpcy5jbG9zZWQgPyAncG9vbENsb3NlZCcgOiAnY29ubmVjdGlvbkVycm9yJztcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHRoaXMuY2xvc2VkID8gbmV3IGVycm9yc18xLlBvb2xDbG9zZWRFcnJvcih0aGlzKSA6IG5ldyBlcnJvcnNfMS5Qb29sQ2xlYXJlZEVycm9yKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLX09VVF9GQUlMRUQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0RmFpbGVkRXZlbnQodGhpcywgcmVhc29uLCB3YWl0UXVldWVNZW1iZXIuY2hlY2tvdXRUaW1lLCBlcnJvcikpO1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdFF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgd2FpdFF1ZXVlTWVtYmVyLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXZhaWxhYmxlQ29ubmVjdGlvbkNvdW50KSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5jb25uZWN0aW9ucy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKCFjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGVzdHJveUNvbm5lY3Rpb25JZlBlcmlzaGVkKGNvbm5lY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkT3V0LmFkZChjb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRBbmRMb2coQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DSEVDS0VEX09VVCwgbmV3IGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2hlY2tlZE91dEV2ZW50KHRoaXMsIGNvbm5lY3Rpb24sIHdhaXRRdWV1ZU1lbWJlci5jaGVja291dFRpbWUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLndhaXRRdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5yZXNvbHZlKGNvbm5lY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbWF4UG9vbFNpemUsIG1heENvbm5lY3RpbmcgfSA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgd2hpbGUgKHRoaXMud2FpdFF1ZXVlU2l6ZSA+IDAgJiZcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0Nvbm5lY3Rpb25Db3VudCA8IG1heENvbm5lY3RpbmcgJiZcbiAgICAgICAgICAgIChtYXhQb29sU2l6ZSA9PT0gMCB8fCB0aGlzLnRvdGFsQ29ubmVjdGlvbkNvdW50IDwgbWF4UG9vbFNpemUpKSB7XG4gICAgICAgICAgICBjb25zdCB3YWl0UXVldWVNZW1iZXIgPSB0aGlzLndhaXRRdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKCF3YWl0UXVldWVNZW1iZXIgfHwgd2FpdFF1ZXVlTWVtYmVyLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDb25uZWN0aW9uKChlcnIsIGNvbm5lY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAod2FpdFF1ZXVlTWVtYmVyLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVyciAmJiBjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25zLnB1c2goY29ubmVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhDb25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLX09VVF9GQUlMRUQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTUxOTIpOiBSZW1vdmUgdGhpcyBjYXN0XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50KHRoaXMsICdjb25uZWN0aW9uRXJyb3InLCB3YWl0UXVldWVNZW1iZXIuY2hlY2tvdXRUaW1lLCBlcnIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRPdXQuYWRkKGNvbm5lY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0QW5kTG9nKENvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tFRF9PVVQsIG5ldyBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrZWRPdXRFdmVudCh0aGlzLCBjb25uZWN0aW9uLCB3YWl0UXVldWVNZW1iZXIuY2hlY2tvdXRUaW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIucmVzb2x2ZShjb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHRoaXMucHJvY2Vzc1dhaXRRdWV1ZSgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvY2Vzc2luZ1dhaXRRdWV1ZSA9IGZhbHNlO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2wgPSBDb25uZWN0aW9uUG9vbDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHRoZSBjb25uZWN0aW9uIHBvb2wgaXMgY3JlYXRlZC5cbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRCA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DUkVBVEVEO1xuLyoqXG4gKiBFbWl0dGVkIG9uY2Ugd2hlbiB0aGUgY29ubmVjdGlvbiBwb29sIGlzIGNsb3NlZFxuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ0xPU0VEO1xuLyoqXG4gKiBFbWl0dGVkIGVhY2ggdGltZSB0aGUgY29ubmVjdGlvbiBwb29sIGlzIGNsZWFyZWQgYW5kIGl0J3MgZ2VuZXJhdGlvbiBpbmNyZW1lbnRlZFxuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX0NMRUFSRUQ7XG4vKipcbiAqIEVtaXR0ZWQgZWFjaCB0aW1lIHRoZSBjb25uZWN0aW9uIHBvb2wgaXMgbWFya2VkIHJlYWR5XG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9QT09MX1JFQURZID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX1JFQURZO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gYSBjb25uZWN0aW9uIGlzIGNyZWF0ZWQuXG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DUkVBVEVEID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DUkVBVEVEO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gYSBjb25uZWN0aW9uIGJlY29tZXMgZXN0YWJsaXNoZWQsIGFuZCBpcyByZWFkeSB0byB1c2VcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX1JFQURZID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9SRUFEWTtcbi8qKlxuICogRW1pdHRlZCB3aGVuIGEgY29ubmVjdGlvbiBpcyBjbG9zZWRcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NMT1NFRCA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0xPU0VEO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gYW4gYXR0ZW1wdCB0byBjaGVjayBvdXQgYSBjb25uZWN0aW9uIGJlZ2luc1xuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX1NUQVJURUQgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVEO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gYW4gYXR0ZW1wdCB0byBjaGVjayBvdXQgYSBjb25uZWN0aW9uIGZhaWxzXG4gKiBAZXZlbnRcbiAqL1xuQ29ubmVjdGlvblBvb2wuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEO1xuLyoqXG4gKiBFbWl0dGVkIGVhY2ggdGltZSBhIGNvbm5lY3Rpb24gaXMgc3VjY2Vzc2Z1bGx5IGNoZWNrZWQgb3V0IG9mIHRoZSBjb25uZWN0aW9uIHBvb2xcbiAqIEBldmVudFxuICovXG5Db25uZWN0aW9uUG9vbC5DT05ORUNUSU9OX0NIRUNLRURfT1VUID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS0VEX09VVDtcbi8qKlxuICogRW1pdHRlZCBlYWNoIHRpbWUgYSBjb25uZWN0aW9uIGlzIHN1Y2Nlc3NmdWxseSBjaGVja2VkIGludG8gdGhlIGNvbm5lY3Rpb24gcG9vbFxuICogQGV2ZW50XG4gKi9cbkNvbm5lY3Rpb25Qb29sLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTiA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbm5lY3Rpb25fcG9vbC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool_events.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool_events.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ConnectionPoolClearedEvent = exports.ConnectionCheckedInEvent = exports.ConnectionCheckedOutEvent = exports.ConnectionCheckOutFailedEvent = exports.ConnectionCheckOutStartedEvent = exports.ConnectionClosedEvent = exports.ConnectionReadyEvent = exports.ConnectionCreatedEvent = exports.ConnectionPoolClosedEvent = exports.ConnectionPoolReadyEvent = exports.ConnectionPoolCreatedEvent = exports.ConnectionPoolMonitoringEvent = void 0;\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/**\n * The base export class for all monitoring events published from the connection pool\n * @public\n * @category Event\n */\nclass ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        this.time = new Date();\n        this.address = pool.address;\n    }\n}\nexports.ConnectionPoolMonitoringEvent = ConnectionPoolMonitoringEvent;\n/**\n * An event published when a connection pool is created\n * @public\n * @category Event\n */\nclass ConnectionPoolCreatedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_CREATED;\n        const { maxConnecting, maxPoolSize, minPoolSize, maxIdleTimeMS, waitQueueTimeoutMS } = pool.options;\n        this.options = { maxConnecting, maxPoolSize, minPoolSize, maxIdleTimeMS, waitQueueTimeoutMS };\n    }\n}\nexports.ConnectionPoolCreatedEvent = ConnectionPoolCreatedEvent;\n/**\n * An event published when a connection pool is ready\n * @public\n * @category Event\n */\nclass ConnectionPoolReadyEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_READY;\n    }\n}\nexports.ConnectionPoolReadyEvent = ConnectionPoolReadyEvent;\n/**\n * An event published when a connection pool is closed\n * @public\n * @category Event\n */\nclass ConnectionPoolClosedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_CLOSED;\n    }\n}\nexports.ConnectionPoolClosedEvent = ConnectionPoolClosedEvent;\n/**\n * An event published when a connection pool creates a new connection\n * @public\n * @category Event\n */\nclass ConnectionCreatedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CREATED;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionCreatedEvent = ConnectionCreatedEvent;\n/**\n * An event published when a connection is ready for use\n * @public\n * @category Event\n */\nclass ConnectionReadyEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection, connectionCreatedEventTime) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_READY;\n        this.durationMS = (0, utils_1.now)() - connectionCreatedEventTime;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionReadyEvent = ConnectionReadyEvent;\n/**\n * An event published when a connection is closed\n * @public\n * @category Event\n */\nclass ConnectionClosedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection, reason, error) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CLOSED;\n        this.connectionId = connection.id;\n        this.reason = reason;\n        this.serviceId = connection.serviceId;\n        this.error = error ?? null;\n    }\n}\nexports.ConnectionClosedEvent = ConnectionClosedEvent;\n/**\n * An event published when a request to check a connection out begins\n * @public\n * @category Event\n */\nclass ConnectionCheckOutStartedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECK_OUT_STARTED;\n    }\n}\nexports.ConnectionCheckOutStartedEvent = ConnectionCheckOutStartedEvent;\n/**\n * An event published when a request to check a connection out fails\n * @public\n * @category Event\n */\nclass ConnectionCheckOutFailedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, reason, checkoutTime, error) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECK_OUT_FAILED;\n        this.durationMS = (0, utils_1.now)() - checkoutTime;\n        this.reason = reason;\n        this.error = error;\n    }\n}\nexports.ConnectionCheckOutFailedEvent = ConnectionCheckOutFailedEvent;\n/**\n * An event published when a connection is checked out of the connection pool\n * @public\n * @category Event\n */\nclass ConnectionCheckedOutEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection, checkoutTime) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECKED_OUT;\n        this.durationMS = (0, utils_1.now)() - checkoutTime;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionCheckedOutEvent = ConnectionCheckedOutEvent;\n/**\n * An event published when a connection is checked into the connection pool\n * @public\n * @category Event\n */\nclass ConnectionCheckedInEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, connection) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_CHECKED_IN;\n        this.connectionId = connection.id;\n    }\n}\nexports.ConnectionCheckedInEvent = ConnectionCheckedInEvent;\n/**\n * An event published when a connection pool is cleared\n * @public\n * @category Event\n */\nclass ConnectionPoolClearedEvent extends ConnectionPoolMonitoringEvent {\n    /** @internal */\n    constructor(pool, options = {}) {\n        super(pool);\n        /** @internal */\n        this.name = constants_1.CONNECTION_POOL_CLEARED;\n        this.serviceId = options.serviceId;\n        this.interruptInUseConnections = options.interruptInUseConnections;\n    }\n}\nexports.ConnectionPoolClearedEvent = ConnectionPoolClearedEvent;\n//# sourceMappingURL=connection_pool_events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvY29ubmVjdGlvbl9wb29sX2V2ZW50cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQ0FBa0MsR0FBRyxnQ0FBZ0MsR0FBRyxpQ0FBaUMsR0FBRyxxQ0FBcUMsR0FBRyxzQ0FBc0MsR0FBRyw2QkFBNkIsR0FBRyw0QkFBNEIsR0FBRyw4QkFBOEIsR0FBRyxpQ0FBaUMsR0FBRyxnQ0FBZ0MsR0FBRyxrQ0FBa0MsR0FBRyxxQ0FBcUM7QUFDOWEsb0JBQW9CLG1CQUFPLENBQUMscUdBQWM7QUFDMUMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkVBQTZFO0FBQzdGLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2Nvbm5lY3Rpb25fcG9vbF9ldmVudHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tlZEluRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DbG9zZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblJlYWR5RXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25Qb29sQ2xvc2VkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25Qb29sUmVhZHlFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xDcmVhdGVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50ID0gdm9pZCAwO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbi8qKlxuICogVGhlIGJhc2UgZXhwb3J0IGNsYXNzIGZvciBhbGwgbW9uaXRvcmluZyBldmVudHMgcHVibGlzaGVkIGZyb20gdGhlIGNvbm5lY3Rpb24gcG9vbFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCkge1xuICAgICAgICB0aGlzLnRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBwb29sLmFkZHJlc3M7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCA9IENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gcG9vbCBpcyBjcmVhdGVkXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgQ29ubmVjdGlvblBvb2xDcmVhdGVkRXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX0NSRUFURUQ7XG4gICAgICAgIGNvbnN0IHsgbWF4Q29ubmVjdGluZywgbWF4UG9vbFNpemUsIG1pblBvb2xTaXplLCBtYXhJZGxlVGltZU1TLCB3YWl0UXVldWVUaW1lb3V0TVMgfSA9IHBvb2wub3B0aW9ucztcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyBtYXhDb25uZWN0aW5nLCBtYXhQb29sU2l6ZSwgbWluUG9vbFNpemUsIG1heElkbGVUaW1lTVMsIHdhaXRRdWV1ZVRpbWVvdXRNUyB9O1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xDcmVhdGVkRXZlbnQgPSBDb25uZWN0aW9uUG9vbENyZWF0ZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIHBvb2wgaXMgcmVhZHlcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uUG9vbFJlYWR5RXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wpIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX1JFQURZO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50ID0gQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gcG9vbCBpcyBjbG9zZWRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uUG9vbENsb3NlZEV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sKSB7XG4gICAgICAgIHN1cGVyKHBvb2wpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQ7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uUG9vbENsb3NlZEV2ZW50ID0gQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIHBvb2wgY3JlYXRlcyBhIG5ldyBjb25uZWN0aW9uXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgQ29ubmVjdGlvbkNyZWF0ZWRFdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCwgY29ubmVjdGlvbikge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NSRUFURUQ7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25DcmVhdGVkRXZlbnQgPSBDb25uZWN0aW9uQ3JlYXRlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gaXMgcmVhZHkgZm9yIHVzZVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25SZWFkeUV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sLCBjb25uZWN0aW9uLCBjb25uZWN0aW9uQ3JlYXRlZEV2ZW50VGltZSkge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1JFQURZO1xuICAgICAgICB0aGlzLmR1cmF0aW9uTVMgPSAoMCwgdXRpbHNfMS5ub3cpKCkgLSBjb25uZWN0aW9uQ3JlYXRlZEV2ZW50VGltZTtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uLmlkO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblJlYWR5RXZlbnQgPSBDb25uZWN0aW9uUmVhZHlFdmVudDtcbi8qKlxuICogQW4gZXZlbnQgcHVibGlzaGVkIHdoZW4gYSBjb25uZWN0aW9uIGlzIGNsb3NlZFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25DbG9zZWRFdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCwgY29ubmVjdGlvbiwgcmVhc29uLCBlcnJvcikge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NMT1NFRDtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uLmlkO1xuICAgICAgICB0aGlzLnJlYXNvbiA9IHJlYXNvbjtcbiAgICAgICAgdGhpcy5zZXJ2aWNlSWQgPSBjb25uZWN0aW9uLnNlcnZpY2VJZDtcbiAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yID8/IG51bGw7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uQ2xvc2VkRXZlbnQgPSBDb25uZWN0aW9uQ2xvc2VkRXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IHB1Ymxpc2hlZCB3aGVuIGEgcmVxdWVzdCB0byBjaGVjayBhIGNvbm5lY3Rpb24gb3V0IGJlZ2luc1xuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25DaGVja091dFN0YXJ0ZWRFdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCkge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVEO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvbkNoZWNrT3V0U3RhcnRlZEV2ZW50ID0gQ29ubmVjdGlvbkNoZWNrT3V0U3RhcnRlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIHJlcXVlc3QgdG8gY2hlY2sgYSBjb25uZWN0aW9uIG91dCBmYWlsc1xuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50IGV4dGVuZHMgQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sLCByZWFzb24sIGNoZWNrb3V0VGltZSwgZXJyb3IpIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEO1xuICAgICAgICB0aGlzLmR1cmF0aW9uTVMgPSAoMCwgdXRpbHNfMS5ub3cpKCkgLSBjaGVja291dFRpbWU7XG4gICAgICAgIHRoaXMucmVhc29uID0gcmVhc29uO1xuICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tPdXRGYWlsZWRFdmVudCA9IENvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gaXMgY2hlY2tlZCBvdXQgb2YgdGhlIGNvbm5lY3Rpb24gcG9vbFxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIENvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wsIGNvbm5lY3Rpb24sIGNoZWNrb3V0VGltZSkge1xuICAgICAgICBzdXBlcihwb29sKTtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLRURfT1VUO1xuICAgICAgICB0aGlzLmR1cmF0aW9uTVMgPSAoMCwgdXRpbHNfMS5ub3cpKCkgLSBjaGVja291dFRpbWU7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDtcbiAgICB9XG59XG5leHBvcnRzLkNvbm5lY3Rpb25DaGVja2VkT3V0RXZlbnQgPSBDb25uZWN0aW9uQ2hlY2tlZE91dEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBhIGNvbm5lY3Rpb24gaXMgY2hlY2tlZCBpbnRvIHRoZSBjb25uZWN0aW9uIHBvb2xcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uQ2hlY2tlZEluRXZlbnQgZXh0ZW5kcyBDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHBvb2wsIGNvbm5lY3Rpb24pIHtcbiAgICAgICAgc3VwZXIocG9vbCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DSEVDS0VEX0lOO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb24uaWQ7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tlZEluRXZlbnQgPSBDb25uZWN0aW9uQ2hlY2tlZEluRXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IHB1Ymxpc2hlZCB3aGVuIGEgY29ubmVjdGlvbiBwb29sIGlzIGNsZWFyZWRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBDb25uZWN0aW9uUG9vbENsZWFyZWRFdmVudCBleHRlbmRzIENvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IocG9vbCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKHBvb2wpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEO1xuICAgICAgICB0aGlzLnNlcnZpY2VJZCA9IG9wdGlvbnMuc2VydmljZUlkO1xuICAgICAgICB0aGlzLmludGVycnVwdEluVXNlQ29ubmVjdGlvbnMgPSBvcHRpb25zLmludGVycnVwdEluVXNlQ29ubmVjdGlvbnM7XG4gICAgfVxufVxuZXhwb3J0cy5Db25uZWN0aW9uUG9vbENsZWFyZWRFdmVudCA9IENvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29ubmVjdGlvbl9wb29sX2V2ZW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool_events.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/errors.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/errors.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.WaitQueueTimeoutError = exports.PoolClearedOnNetworkError = exports.PoolClearedError = exports.PoolClosedError = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/**\n * An error indicating a connection pool is closed\n * @category Error\n */\nclass PoolClosedError extends error_1.MongoDriverError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(pool) {\n        super('Attempted to check out a connection from closed connection pool');\n        this.address = pool.address;\n    }\n    get name() {\n        return 'MongoPoolClosedError';\n    }\n}\nexports.PoolClosedError = PoolClosedError;\n/**\n * An error indicating a connection pool is currently paused\n * @category Error\n */\nclass PoolClearedError extends error_1.MongoNetworkError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(pool, message) {\n        const errorMessage = message\n            ? message\n            : `Connection pool for ${pool.address} was cleared because another operation failed with: \"${pool.serverError?.message}\"`;\n        super(errorMessage, pool.serverError ? { cause: pool.serverError } : undefined);\n        this.address = pool.address;\n        this.addErrorLabel(error_1.MongoErrorLabel.PoolRequstedRetry);\n    }\n    get name() {\n        return 'MongoPoolClearedError';\n    }\n}\nexports.PoolClearedError = PoolClearedError;\n/**\n * An error indicating that a connection pool has been cleared after the monitor for that server timed out.\n * @category Error\n */\nclass PoolClearedOnNetworkError extends PoolClearedError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(pool) {\n        super(pool, `Connection to ${pool.address} interrupted due to server monitor timeout`);\n    }\n    get name() {\n        return 'PoolClearedOnNetworkError';\n    }\n}\nexports.PoolClearedOnNetworkError = PoolClearedOnNetworkError;\n/**\n * An error thrown when a request to check out a connection times out\n * @category Error\n */\nclass WaitQueueTimeoutError extends error_1.MongoDriverError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, address) {\n        super(message);\n        this.address = address;\n    }\n    get name() {\n        return 'MongoWaitQueueTimeoutError';\n    }\n}\nexports.WaitQueueTimeoutError = WaitQueueTimeoutError;\n//# sourceMappingURL=errors.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvZXJyb3JzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDZCQUE2QixHQUFHLGlDQUFpQyxHQUFHLHdCQUF3QixHQUFHLHVCQUF1QjtBQUN0SCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsY0FBYyxzREFBc0QsMEJBQTBCO0FBQ25JLGlEQUFpRCwwQkFBMEI7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxjQUFjO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9lcnJvcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldhaXRRdWV1ZVRpbWVvdXRFcnJvciA9IGV4cG9ydHMuUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvciA9IGV4cG9ydHMuUG9vbENsZWFyZWRFcnJvciA9IGV4cG9ydHMuUG9vbENsb3NlZEVycm9yID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbi8qKlxuICogQW4gZXJyb3IgaW5kaWNhdGluZyBhIGNvbm5lY3Rpb24gcG9vbCBpcyBjbG9zZWRcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBQb29sQ2xvc2VkRXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvRHJpdmVyRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sKSB7XG4gICAgICAgIHN1cGVyKCdBdHRlbXB0ZWQgdG8gY2hlY2sgb3V0IGEgY29ubmVjdGlvbiBmcm9tIGNsb3NlZCBjb25uZWN0aW9uIHBvb2wnKTtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gcG9vbC5hZGRyZXNzO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1Bvb2xDbG9zZWRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Qb29sQ2xvc2VkRXJyb3IgPSBQb29sQ2xvc2VkRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgYSBjb25uZWN0aW9uIHBvb2wgaXMgY3VycmVudGx5IHBhdXNlZFxuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIFBvb2xDbGVhcmVkRXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IocG9vbCwgbWVzc2FnZSkge1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBtZXNzYWdlXG4gICAgICAgICAgICA/IG1lc3NhZ2VcbiAgICAgICAgICAgIDogYENvbm5lY3Rpb24gcG9vbCBmb3IgJHtwb29sLmFkZHJlc3N9IHdhcyBjbGVhcmVkIGJlY2F1c2UgYW5vdGhlciBvcGVyYXRpb24gZmFpbGVkIHdpdGg6IFwiJHtwb29sLnNlcnZlckVycm9yPy5tZXNzYWdlfVwiYDtcbiAgICAgICAgc3VwZXIoZXJyb3JNZXNzYWdlLCBwb29sLnNlcnZlckVycm9yID8geyBjYXVzZTogcG9vbC5zZXJ2ZXJFcnJvciB9IDogdW5kZWZpbmVkKTtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gcG9vbC5hZGRyZXNzO1xuICAgICAgICB0aGlzLmFkZEVycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuUG9vbFJlcXVzdGVkUmV0cnkpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1Bvb2xDbGVhcmVkRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuUG9vbENsZWFyZWRFcnJvciA9IFBvb2xDbGVhcmVkRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgdGhhdCBhIGNvbm5lY3Rpb24gcG9vbCBoYXMgYmVlbiBjbGVhcmVkIGFmdGVyIHRoZSBtb25pdG9yIGZvciB0aGF0IHNlcnZlciB0aW1lZCBvdXQuXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgUG9vbENsZWFyZWRPbk5ldHdvcmtFcnJvciBleHRlbmRzIFBvb2xDbGVhcmVkRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3Rvcihwb29sKSB7XG4gICAgICAgIHN1cGVyKHBvb2wsIGBDb25uZWN0aW9uIHRvICR7cG9vbC5hZGRyZXNzfSBpbnRlcnJ1cHRlZCBkdWUgdG8gc2VydmVyIG1vbml0b3IgdGltZW91dGApO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdQb29sQ2xlYXJlZE9uTmV0d29ya0Vycm9yJztcbiAgICB9XG59XG5leHBvcnRzLlBvb2xDbGVhcmVkT25OZXR3b3JrRXJyb3IgPSBQb29sQ2xlYXJlZE9uTmV0d29ya0Vycm9yO1xuLyoqXG4gKiBBbiBlcnJvciB0aHJvd24gd2hlbiBhIHJlcXVlc3QgdG8gY2hlY2sgb3V0IGEgY29ubmVjdGlvbiB0aW1lcyBvdXRcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBXYWl0UXVldWVUaW1lb3V0RXJyb3IgZXh0ZW5kcyBlcnJvcl8xLk1vbmdvRHJpdmVyRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBhZGRyZXNzKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1dhaXRRdWV1ZVRpbWVvdXRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5XYWl0UXVldWVUaW1lb3V0RXJyb3IgPSBXYWl0UXVldWVUaW1lb3V0RXJyb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1lcnJvcnMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/errors.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/handshake/client_metadata.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/handshake/client_metadata.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.LimitedSizeDocument = void 0;\nexports.makeClientMetadata = makeClientMetadata;\nexports.addContainerMetadata = addContainerMetadata;\nexports.getFAASEnv = getFAASEnv;\nconst os = __webpack_require__(/*! os */ \"os\");\nconst process = __webpack_require__(/*! process */ \"process\");\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nconst NODE_DRIVER_VERSION = (__webpack_require__(/*! ../../../package.json */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/package.json\").version);\n/** @internal */\nclass LimitedSizeDocument {\n    constructor(maxSize) {\n        this.maxSize = maxSize;\n        this.document = new Map();\n        /** BSON overhead: Int32 + Null byte */\n        this.documentSize = 5;\n    }\n    /** Only adds key/value if the bsonByteLength is less than MAX_SIZE */\n    ifItFitsItSits(key, value) {\n        // The BSON byteLength of the new element is the same as serializing it to its own document\n        // subtracting the document size int32 and the null terminator.\n        const newElementSize = bson_1.BSON.serialize(new Map().set(key, value)).byteLength - 5;\n        if (newElementSize + this.documentSize > this.maxSize) {\n            return false;\n        }\n        this.documentSize += newElementSize;\n        this.document.set(key, value);\n        return true;\n    }\n    toObject() {\n        return bson_1.BSON.deserialize(bson_1.BSON.serialize(this.document), {\n            promoteLongs: false,\n            promoteBuffers: false,\n            promoteValues: false,\n            useBigInt64: false\n        });\n    }\n}\nexports.LimitedSizeDocument = LimitedSizeDocument;\n/**\n * From the specs:\n * Implementors SHOULD cumulatively update fields in the following order until the document is under the size limit:\n * 1. Omit fields from `env` except `env.name`.\n * 2. Omit fields from `os` except `os.type`.\n * 3. Omit the `env` document entirely.\n * 4. Truncate `platform`. -- special we do not truncate this field\n */\nfunction makeClientMetadata(options) {\n    const metadataDocument = new LimitedSizeDocument(512);\n    const { appName = '' } = options;\n    // Add app name first, it must be sent\n    if (appName.length > 0) {\n        const name = Buffer.byteLength(appName, 'utf8') <= 128\n            ? options.appName\n            : Buffer.from(appName, 'utf8').subarray(0, 128).toString('utf8');\n        metadataDocument.ifItFitsItSits('application', { name });\n    }\n    const { name = '', version = '', platform = '' } = options.driverInfo;\n    const driverInfo = {\n        name: name.length > 0 ? `nodejs|${name}` : 'nodejs',\n        version: version.length > 0 ? `${NODE_DRIVER_VERSION}|${version}` : NODE_DRIVER_VERSION\n    };\n    if (!metadataDocument.ifItFitsItSits('driver', driverInfo)) {\n        throw new error_1.MongoInvalidArgumentError('Unable to include driverInfo name and version, metadata cannot exceed 512 bytes');\n    }\n    let runtimeInfo = getRuntimeInfo();\n    if (platform.length > 0) {\n        runtimeInfo = `${runtimeInfo}|${platform}`;\n    }\n    if (!metadataDocument.ifItFitsItSits('platform', runtimeInfo)) {\n        throw new error_1.MongoInvalidArgumentError('Unable to include driverInfo platform, metadata cannot exceed 512 bytes');\n    }\n    // Note: order matters, os.type is last so it will be removed last if we're at maxSize\n    const osInfo = new Map()\n        .set('name', process.platform)\n        .set('architecture', process.arch)\n        .set('version', os.release())\n        .set('type', os.type());\n    if (!metadataDocument.ifItFitsItSits('os', osInfo)) {\n        for (const key of osInfo.keys()) {\n            osInfo.delete(key);\n            if (osInfo.size === 0)\n                break;\n            if (metadataDocument.ifItFitsItSits('os', osInfo))\n                break;\n        }\n    }\n    const faasEnv = getFAASEnv();\n    if (faasEnv != null) {\n        if (!metadataDocument.ifItFitsItSits('env', faasEnv)) {\n            for (const key of faasEnv.keys()) {\n                faasEnv.delete(key);\n                if (faasEnv.size === 0)\n                    break;\n                if (metadataDocument.ifItFitsItSits('env', faasEnv))\n                    break;\n            }\n        }\n    }\n    return metadataDocument.toObject();\n}\nlet dockerPromise;\n/** @internal */\nasync function getContainerMetadata() {\n    const containerMetadata = {};\n    dockerPromise ??= (0, utils_1.fileIsAccessible)('/.dockerenv');\n    const isDocker = await dockerPromise;\n    const { KUBERNETES_SERVICE_HOST = '' } = process.env;\n    const isKubernetes = KUBERNETES_SERVICE_HOST.length > 0 ? true : false;\n    if (isDocker)\n        containerMetadata.runtime = 'docker';\n    if (isKubernetes)\n        containerMetadata.orchestrator = 'kubernetes';\n    return containerMetadata;\n}\n/**\n * @internal\n * Re-add each metadata value.\n * Attempt to add new env container metadata, but keep old data if it does not fit.\n */\nasync function addContainerMetadata(originalMetadata) {\n    const containerMetadata = await getContainerMetadata();\n    if (Object.keys(containerMetadata).length === 0)\n        return originalMetadata;\n    const extendedMetadata = new LimitedSizeDocument(512);\n    const extendedEnvMetadata = { ...originalMetadata?.env, container: containerMetadata };\n    for (const [key, val] of Object.entries(originalMetadata)) {\n        if (key !== 'env') {\n            extendedMetadata.ifItFitsItSits(key, val);\n        }\n        else {\n            if (!extendedMetadata.ifItFitsItSits('env', extendedEnvMetadata)) {\n                // add in old data if newer / extended metadata does not fit\n                extendedMetadata.ifItFitsItSits('env', val);\n            }\n        }\n    }\n    if (!('env' in originalMetadata)) {\n        extendedMetadata.ifItFitsItSits('env', extendedEnvMetadata);\n    }\n    return extendedMetadata.toObject();\n}\n/**\n * Collects FaaS metadata.\n * - `name` MUST be the last key in the Map returned.\n */\nfunction getFAASEnv() {\n    const { AWS_EXECUTION_ENV = '', AWS_LAMBDA_RUNTIME_API = '', FUNCTIONS_WORKER_RUNTIME = '', K_SERVICE = '', FUNCTION_NAME = '', VERCEL = '', AWS_LAMBDA_FUNCTION_MEMORY_SIZE = '', AWS_REGION = '', FUNCTION_MEMORY_MB = '', FUNCTION_REGION = '', FUNCTION_TIMEOUT_SEC = '', VERCEL_REGION = '' } = process.env;\n    const isAWSFaaS = AWS_EXECUTION_ENV.startsWith('AWS_Lambda_') || AWS_LAMBDA_RUNTIME_API.length > 0;\n    const isAzureFaaS = FUNCTIONS_WORKER_RUNTIME.length > 0;\n    const isGCPFaaS = K_SERVICE.length > 0 || FUNCTION_NAME.length > 0;\n    const isVercelFaaS = VERCEL.length > 0;\n    // Note: order matters, name must always be the last key\n    const faasEnv = new Map();\n    // When isVercelFaaS is true so is isAWSFaaS; Vercel inherits the AWS env\n    if (isVercelFaaS && !(isAzureFaaS || isGCPFaaS)) {\n        if (VERCEL_REGION.length > 0) {\n            faasEnv.set('region', VERCEL_REGION);\n        }\n        faasEnv.set('name', 'vercel');\n        return faasEnv;\n    }\n    if (isAWSFaaS && !(isAzureFaaS || isGCPFaaS || isVercelFaaS)) {\n        if (AWS_REGION.length > 0) {\n            faasEnv.set('region', AWS_REGION);\n        }\n        if (AWS_LAMBDA_FUNCTION_MEMORY_SIZE.length > 0 &&\n            Number.isInteger(+AWS_LAMBDA_FUNCTION_MEMORY_SIZE)) {\n            faasEnv.set('memory_mb', new bson_1.Int32(AWS_LAMBDA_FUNCTION_MEMORY_SIZE));\n        }\n        faasEnv.set('name', 'aws.lambda');\n        return faasEnv;\n    }\n    if (isAzureFaaS && !(isGCPFaaS || isAWSFaaS || isVercelFaaS)) {\n        faasEnv.set('name', 'azure.func');\n        return faasEnv;\n    }\n    if (isGCPFaaS && !(isAzureFaaS || isAWSFaaS || isVercelFaaS)) {\n        if (FUNCTION_REGION.length > 0) {\n            faasEnv.set('region', FUNCTION_REGION);\n        }\n        if (FUNCTION_MEMORY_MB.length > 0 && Number.isInteger(+FUNCTION_MEMORY_MB)) {\n            faasEnv.set('memory_mb', new bson_1.Int32(FUNCTION_MEMORY_MB));\n        }\n        if (FUNCTION_TIMEOUT_SEC.length > 0 && Number.isInteger(+FUNCTION_TIMEOUT_SEC)) {\n            faasEnv.set('timeout_sec', new bson_1.Int32(FUNCTION_TIMEOUT_SEC));\n        }\n        faasEnv.set('name', 'gcp.func');\n        return faasEnv;\n    }\n    return null;\n}\n/**\n * @internal\n * Get current JavaScript runtime platform\n *\n * NOTE: The version information fetching is intentionally written defensively\n * to avoid having a released driver version that becomes incompatible\n * with a future change to these global objects.\n */\nfunction getRuntimeInfo() {\n    if ('Deno' in globalThis) {\n        const version = typeof Deno?.version?.deno === 'string' ? Deno?.version?.deno : '0.0.0-unknown';\n        return `Deno v${version}, ${os.endianness()}`;\n    }\n    if ('Bun' in globalThis) {\n        const version = typeof Bun?.version === 'string' ? Bun?.version : '0.0.0-unknown';\n        return `Bun v${version}, ${os.endianness()}`;\n    }\n    return `Node.js ${process.version}, ${os.endianness()}`;\n}\n//# sourceMappingURL=client_metadata.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvaGFuZHNoYWtlL2NsaWVudF9tZXRhZGF0YS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwyQkFBMkI7QUFDM0IsMEJBQTBCO0FBQzFCLDRCQUE0QjtBQUM1QixrQkFBa0I7QUFDbEIsV0FBVyxtQkFBTyxDQUFDLGNBQUk7QUFDdkIsZ0JBQWdCLG1CQUFPLENBQUMsd0JBQVM7QUFDakMsZUFBZSxtQkFBTyxDQUFDLDhGQUFZO0FBQ25DLGdCQUFnQixtQkFBTyxDQUFDLGdHQUFhO0FBQ3JDLGdCQUFnQixtQkFBTyxDQUFDLGdHQUFhO0FBQ3JDO0FBQ0EsNEJBQTRCLHlJQUF3QztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGVBQWU7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxNQUFNO0FBQy9EO0FBQ0EsWUFBWSx5Q0FBeUM7QUFDckQ7QUFDQSwwQ0FBMEMsS0FBSztBQUMvQyx5Q0FBeUMsb0JBQW9CLEdBQUcsUUFBUTtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsWUFBWSxHQUFHLFNBQVM7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwrQkFBK0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDJSQUEyUjtBQUN2UztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLFFBQVEsSUFBSSxnQkFBZ0I7QUFDcEQ7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFFBQVEsSUFBSSxnQkFBZ0I7QUFDbkQ7QUFDQSxzQkFBc0IsZ0JBQWdCLElBQUksZ0JBQWdCO0FBQzFEO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL2hhbmRzaGFrZS9jbGllbnRfbWV0YWRhdGEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpbWl0ZWRTaXplRG9jdW1lbnQgPSB2b2lkIDA7XG5leHBvcnRzLm1ha2VDbGllbnRNZXRhZGF0YSA9IG1ha2VDbGllbnRNZXRhZGF0YTtcbmV4cG9ydHMuYWRkQ29udGFpbmVyTWV0YWRhdGEgPSBhZGRDb250YWluZXJNZXRhZGF0YTtcbmV4cG9ydHMuZ2V0RkFBU0VudiA9IGdldEZBQVNFbnY7XG5jb25zdCBvcyA9IHJlcXVpcmUoXCJvc1wiKTtcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKFwicHJvY2Vzc1wiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9ic29uXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHNcIik7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlcXVpcmUtaW1wb3J0c1xuY29uc3QgTk9ERV9EUklWRVJfVkVSU0lPTiA9IHJlcXVpcmUoJy4uLy4uLy4uL3BhY2thZ2UuanNvbicpLnZlcnNpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBMaW1pdGVkU2l6ZURvY3VtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihtYXhTaXplKSB7XG4gICAgICAgIHRoaXMubWF4U2l6ZSA9IG1heFNpemU7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSBuZXcgTWFwKCk7XG4gICAgICAgIC8qKiBCU09OIG92ZXJoZWFkOiBJbnQzMiArIE51bGwgYnl0ZSAqL1xuICAgICAgICB0aGlzLmRvY3VtZW50U2l6ZSA9IDU7XG4gICAgfVxuICAgIC8qKiBPbmx5IGFkZHMga2V5L3ZhbHVlIGlmIHRoZSBic29uQnl0ZUxlbmd0aCBpcyBsZXNzIHRoYW4gTUFYX1NJWkUgKi9cbiAgICBpZkl0Rml0c0l0U2l0cyhrZXksIHZhbHVlKSB7XG4gICAgICAgIC8vIFRoZSBCU09OIGJ5dGVMZW5ndGggb2YgdGhlIG5ldyBlbGVtZW50IGlzIHRoZSBzYW1lIGFzIHNlcmlhbGl6aW5nIGl0IHRvIGl0cyBvd24gZG9jdW1lbnRcbiAgICAgICAgLy8gc3VidHJhY3RpbmcgdGhlIGRvY3VtZW50IHNpemUgaW50MzIgYW5kIHRoZSBudWxsIHRlcm1pbmF0b3IuXG4gICAgICAgIGNvbnN0IG5ld0VsZW1lbnRTaXplID0gYnNvbl8xLkJTT04uc2VyaWFsaXplKG5ldyBNYXAoKS5zZXQoa2V5LCB2YWx1ZSkpLmJ5dGVMZW5ndGggLSA1O1xuICAgICAgICBpZiAobmV3RWxlbWVudFNpemUgKyB0aGlzLmRvY3VtZW50U2l6ZSA+IHRoaXMubWF4U2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZG9jdW1lbnRTaXplICs9IG5ld0VsZW1lbnRTaXplO1xuICAgICAgICB0aGlzLmRvY3VtZW50LnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHRvT2JqZWN0KCkge1xuICAgICAgICByZXR1cm4gYnNvbl8xLkJTT04uZGVzZXJpYWxpemUoYnNvbl8xLkJTT04uc2VyaWFsaXplKHRoaXMuZG9jdW1lbnQpLCB7XG4gICAgICAgICAgICBwcm9tb3RlTG9uZ3M6IGZhbHNlLFxuICAgICAgICAgICAgcHJvbW90ZUJ1ZmZlcnM6IGZhbHNlLFxuICAgICAgICAgICAgcHJvbW90ZVZhbHVlczogZmFsc2UsXG4gICAgICAgICAgICB1c2VCaWdJbnQ2NDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5MaW1pdGVkU2l6ZURvY3VtZW50ID0gTGltaXRlZFNpemVEb2N1bWVudDtcbi8qKlxuICogRnJvbSB0aGUgc3BlY3M6XG4gKiBJbXBsZW1lbnRvcnMgU0hPVUxEIGN1bXVsYXRpdmVseSB1cGRhdGUgZmllbGRzIGluIHRoZSBmb2xsb3dpbmcgb3JkZXIgdW50aWwgdGhlIGRvY3VtZW50IGlzIHVuZGVyIHRoZSBzaXplIGxpbWl0OlxuICogMS4gT21pdCBmaWVsZHMgZnJvbSBgZW52YCBleGNlcHQgYGVudi5uYW1lYC5cbiAqIDIuIE9taXQgZmllbGRzIGZyb20gYG9zYCBleGNlcHQgYG9zLnR5cGVgLlxuICogMy4gT21pdCB0aGUgYGVudmAgZG9jdW1lbnQgZW50aXJlbHkuXG4gKiA0LiBUcnVuY2F0ZSBgcGxhdGZvcm1gLiAtLSBzcGVjaWFsIHdlIGRvIG5vdCB0cnVuY2F0ZSB0aGlzIGZpZWxkXG4gKi9cbmZ1bmN0aW9uIG1ha2VDbGllbnRNZXRhZGF0YShvcHRpb25zKSB7XG4gICAgY29uc3QgbWV0YWRhdGFEb2N1bWVudCA9IG5ldyBMaW1pdGVkU2l6ZURvY3VtZW50KDUxMik7XG4gICAgY29uc3QgeyBhcHBOYW1lID0gJycgfSA9IG9wdGlvbnM7XG4gICAgLy8gQWRkIGFwcCBuYW1lIGZpcnN0LCBpdCBtdXN0IGJlIHNlbnRcbiAgICBpZiAoYXBwTmFtZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBCdWZmZXIuYnl0ZUxlbmd0aChhcHBOYW1lLCAndXRmOCcpIDw9IDEyOFxuICAgICAgICAgICAgPyBvcHRpb25zLmFwcE5hbWVcbiAgICAgICAgICAgIDogQnVmZmVyLmZyb20oYXBwTmFtZSwgJ3V0ZjgnKS5zdWJhcnJheSgwLCAxMjgpLnRvU3RyaW5nKCd1dGY4Jyk7XG4gICAgICAgIG1ldGFkYXRhRG9jdW1lbnQuaWZJdEZpdHNJdFNpdHMoJ2FwcGxpY2F0aW9uJywgeyBuYW1lIH0pO1xuICAgIH1cbiAgICBjb25zdCB7IG5hbWUgPSAnJywgdmVyc2lvbiA9ICcnLCBwbGF0Zm9ybSA9ICcnIH0gPSBvcHRpb25zLmRyaXZlckluZm87XG4gICAgY29uc3QgZHJpdmVySW5mbyA9IHtcbiAgICAgICAgbmFtZTogbmFtZS5sZW5ndGggPiAwID8gYG5vZGVqc3wke25hbWV9YCA6ICdub2RlanMnLFxuICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLmxlbmd0aCA+IDAgPyBgJHtOT0RFX0RSSVZFUl9WRVJTSU9OfXwke3ZlcnNpb259YCA6IE5PREVfRFJJVkVSX1ZFUlNJT05cbiAgICB9O1xuICAgIGlmICghbWV0YWRhdGFEb2N1bWVudC5pZkl0Rml0c0l0U2l0cygnZHJpdmVyJywgZHJpdmVySW5mbykpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignVW5hYmxlIHRvIGluY2x1ZGUgZHJpdmVySW5mbyBuYW1lIGFuZCB2ZXJzaW9uLCBtZXRhZGF0YSBjYW5ub3QgZXhjZWVkIDUxMiBieXRlcycpO1xuICAgIH1cbiAgICBsZXQgcnVudGltZUluZm8gPSBnZXRSdW50aW1lSW5mbygpO1xuICAgIGlmIChwbGF0Zm9ybS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJ1bnRpbWVJbmZvID0gYCR7cnVudGltZUluZm99fCR7cGxhdGZvcm19YDtcbiAgICB9XG4gICAgaWYgKCFtZXRhZGF0YURvY3VtZW50LmlmSXRGaXRzSXRTaXRzKCdwbGF0Zm9ybScsIHJ1bnRpbWVJbmZvKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVbmFibGUgdG8gaW5jbHVkZSBkcml2ZXJJbmZvIHBsYXRmb3JtLCBtZXRhZGF0YSBjYW5ub3QgZXhjZWVkIDUxMiBieXRlcycpO1xuICAgIH1cbiAgICAvLyBOb3RlOiBvcmRlciBtYXR0ZXJzLCBvcy50eXBlIGlzIGxhc3Qgc28gaXQgd2lsbCBiZSByZW1vdmVkIGxhc3QgaWYgd2UncmUgYXQgbWF4U2l6ZVxuICAgIGNvbnN0IG9zSW5mbyA9IG5ldyBNYXAoKVxuICAgICAgICAuc2V0KCduYW1lJywgcHJvY2Vzcy5wbGF0Zm9ybSlcbiAgICAgICAgLnNldCgnYXJjaGl0ZWN0dXJlJywgcHJvY2Vzcy5hcmNoKVxuICAgICAgICAuc2V0KCd2ZXJzaW9uJywgb3MucmVsZWFzZSgpKVxuICAgICAgICAuc2V0KCd0eXBlJywgb3MudHlwZSgpKTtcbiAgICBpZiAoIW1ldGFkYXRhRG9jdW1lbnQuaWZJdEZpdHNJdFNpdHMoJ29zJywgb3NJbmZvKSkge1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBvc0luZm8ua2V5cygpKSB7XG4gICAgICAgICAgICBvc0luZm8uZGVsZXRlKGtleSk7XG4gICAgICAgICAgICBpZiAob3NJbmZvLnNpemUgPT09IDApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBpZiAobWV0YWRhdGFEb2N1bWVudC5pZkl0Rml0c0l0U2l0cygnb3MnLCBvc0luZm8pKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGZhYXNFbnYgPSBnZXRGQUFTRW52KCk7XG4gICAgaWYgKGZhYXNFbnYgIT0gbnVsbCkge1xuICAgICAgICBpZiAoIW1ldGFkYXRhRG9jdW1lbnQuaWZJdEZpdHNJdFNpdHMoJ2VudicsIGZhYXNFbnYpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBmYWFzRW52LmtleXMoKSkge1xuICAgICAgICAgICAgICAgIGZhYXNFbnYuZGVsZXRlKGtleSk7XG4gICAgICAgICAgICAgICAgaWYgKGZhYXNFbnYuc2l6ZSA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgaWYgKG1ldGFkYXRhRG9jdW1lbnQuaWZJdEZpdHNJdFNpdHMoJ2VudicsIGZhYXNFbnYpKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWV0YWRhdGFEb2N1bWVudC50b09iamVjdCgpO1xufVxubGV0IGRvY2tlclByb21pc2U7XG4vKiogQGludGVybmFsICovXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWluZXJNZXRhZGF0YSgpIHtcbiAgICBjb25zdCBjb250YWluZXJNZXRhZGF0YSA9IHt9O1xuICAgIGRvY2tlclByb21pc2UgPz89ICgwLCB1dGlsc18xLmZpbGVJc0FjY2Vzc2libGUpKCcvLmRvY2tlcmVudicpO1xuICAgIGNvbnN0IGlzRG9ja2VyID0gYXdhaXQgZG9ja2VyUHJvbWlzZTtcbiAgICBjb25zdCB7IEtVQkVSTkVURVNfU0VSVklDRV9IT1NUID0gJycgfSA9IHByb2Nlc3MuZW52O1xuICAgIGNvbnN0IGlzS3ViZXJuZXRlcyA9IEtVQkVSTkVURVNfU0VSVklDRV9IT1NULmxlbmd0aCA+IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgaWYgKGlzRG9ja2VyKVxuICAgICAgICBjb250YWluZXJNZXRhZGF0YS5ydW50aW1lID0gJ2RvY2tlcic7XG4gICAgaWYgKGlzS3ViZXJuZXRlcylcbiAgICAgICAgY29udGFpbmVyTWV0YWRhdGEub3JjaGVzdHJhdG9yID0gJ2t1YmVybmV0ZXMnO1xuICAgIHJldHVybiBjb250YWluZXJNZXRhZGF0YTtcbn1cbi8qKlxuICogQGludGVybmFsXG4gKiBSZS1hZGQgZWFjaCBtZXRhZGF0YSB2YWx1ZS5cbiAqIEF0dGVtcHQgdG8gYWRkIG5ldyBlbnYgY29udGFpbmVyIG1ldGFkYXRhLCBidXQga2VlcCBvbGQgZGF0YSBpZiBpdCBkb2VzIG5vdCBmaXQuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFkZENvbnRhaW5lck1ldGFkYXRhKG9yaWdpbmFsTWV0YWRhdGEpIHtcbiAgICBjb25zdCBjb250YWluZXJNZXRhZGF0YSA9IGF3YWl0IGdldENvbnRhaW5lck1ldGFkYXRhKCk7XG4gICAgaWYgKE9iamVjdC5rZXlzKGNvbnRhaW5lck1ldGFkYXRhKS5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiBvcmlnaW5hbE1ldGFkYXRhO1xuICAgIGNvbnN0IGV4dGVuZGVkTWV0YWRhdGEgPSBuZXcgTGltaXRlZFNpemVEb2N1bWVudCg1MTIpO1xuICAgIGNvbnN0IGV4dGVuZGVkRW52TWV0YWRhdGEgPSB7IC4uLm9yaWdpbmFsTWV0YWRhdGE/LmVudiwgY29udGFpbmVyOiBjb250YWluZXJNZXRhZGF0YSB9O1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhvcmlnaW5hbE1ldGFkYXRhKSkge1xuICAgICAgICBpZiAoa2V5ICE9PSAnZW52Jykge1xuICAgICAgICAgICAgZXh0ZW5kZWRNZXRhZGF0YS5pZkl0Rml0c0l0U2l0cyhrZXksIHZhbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIWV4dGVuZGVkTWV0YWRhdGEuaWZJdEZpdHNJdFNpdHMoJ2VudicsIGV4dGVuZGVkRW52TWV0YWRhdGEpKSB7XG4gICAgICAgICAgICAgICAgLy8gYWRkIGluIG9sZCBkYXRhIGlmIG5ld2VyIC8gZXh0ZW5kZWQgbWV0YWRhdGEgZG9lcyBub3QgZml0XG4gICAgICAgICAgICAgICAgZXh0ZW5kZWRNZXRhZGF0YS5pZkl0Rml0c0l0U2l0cygnZW52JywgdmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoISgnZW52JyBpbiBvcmlnaW5hbE1ldGFkYXRhKSkge1xuICAgICAgICBleHRlbmRlZE1ldGFkYXRhLmlmSXRGaXRzSXRTaXRzKCdlbnYnLCBleHRlbmRlZEVudk1ldGFkYXRhKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4dGVuZGVkTWV0YWRhdGEudG9PYmplY3QoKTtcbn1cbi8qKlxuICogQ29sbGVjdHMgRmFhUyBtZXRhZGF0YS5cbiAqIC0gYG5hbWVgIE1VU1QgYmUgdGhlIGxhc3Qga2V5IGluIHRoZSBNYXAgcmV0dXJuZWQuXG4gKi9cbmZ1bmN0aW9uIGdldEZBQVNFbnYoKSB7XG4gICAgY29uc3QgeyBBV1NfRVhFQ1VUSU9OX0VOViA9ICcnLCBBV1NfTEFNQkRBX1JVTlRJTUVfQVBJID0gJycsIEZVTkNUSU9OU19XT1JLRVJfUlVOVElNRSA9ICcnLCBLX1NFUlZJQ0UgPSAnJywgRlVOQ1RJT05fTkFNRSA9ICcnLCBWRVJDRUwgPSAnJywgQVdTX0xBTUJEQV9GVU5DVElPTl9NRU1PUllfU0laRSA9ICcnLCBBV1NfUkVHSU9OID0gJycsIEZVTkNUSU9OX01FTU9SWV9NQiA9ICcnLCBGVU5DVElPTl9SRUdJT04gPSAnJywgRlVOQ1RJT05fVElNRU9VVF9TRUMgPSAnJywgVkVSQ0VMX1JFR0lPTiA9ICcnIH0gPSBwcm9jZXNzLmVudjtcbiAgICBjb25zdCBpc0FXU0ZhYVMgPSBBV1NfRVhFQ1VUSU9OX0VOVi5zdGFydHNXaXRoKCdBV1NfTGFtYmRhXycpIHx8IEFXU19MQU1CREFfUlVOVElNRV9BUEkubGVuZ3RoID4gMDtcbiAgICBjb25zdCBpc0F6dXJlRmFhUyA9IEZVTkNUSU9OU19XT1JLRVJfUlVOVElNRS5sZW5ndGggPiAwO1xuICAgIGNvbnN0IGlzR0NQRmFhUyA9IEtfU0VSVklDRS5sZW5ndGggPiAwIHx8IEZVTkNUSU9OX05BTUUubGVuZ3RoID4gMDtcbiAgICBjb25zdCBpc1ZlcmNlbEZhYVMgPSBWRVJDRUwubGVuZ3RoID4gMDtcbiAgICAvLyBOb3RlOiBvcmRlciBtYXR0ZXJzLCBuYW1lIG11c3QgYWx3YXlzIGJlIHRoZSBsYXN0IGtleVxuICAgIGNvbnN0IGZhYXNFbnYgPSBuZXcgTWFwKCk7XG4gICAgLy8gV2hlbiBpc1ZlcmNlbEZhYVMgaXMgdHJ1ZSBzbyBpcyBpc0FXU0ZhYVM7IFZlcmNlbCBpbmhlcml0cyB0aGUgQVdTIGVudlxuICAgIGlmIChpc1ZlcmNlbEZhYVMgJiYgIShpc0F6dXJlRmFhUyB8fCBpc0dDUEZhYVMpKSB7XG4gICAgICAgIGlmIChWRVJDRUxfUkVHSU9OLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZhYXNFbnYuc2V0KCdyZWdpb24nLCBWRVJDRUxfUkVHSU9OKTtcbiAgICAgICAgfVxuICAgICAgICBmYWFzRW52LnNldCgnbmFtZScsICd2ZXJjZWwnKTtcbiAgICAgICAgcmV0dXJuIGZhYXNFbnY7XG4gICAgfVxuICAgIGlmIChpc0FXU0ZhYVMgJiYgIShpc0F6dXJlRmFhUyB8fCBpc0dDUEZhYVMgfHwgaXNWZXJjZWxGYWFTKSkge1xuICAgICAgICBpZiAoQVdTX1JFR0lPTi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmYWFzRW52LnNldCgncmVnaW9uJywgQVdTX1JFR0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEFXU19MQU1CREFfRlVOQ1RJT05fTUVNT1JZX1NJWkUubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgTnVtYmVyLmlzSW50ZWdlcigrQVdTX0xBTUJEQV9GVU5DVElPTl9NRU1PUllfU0laRSkpIHtcbiAgICAgICAgICAgIGZhYXNFbnYuc2V0KCdtZW1vcnlfbWInLCBuZXcgYnNvbl8xLkludDMyKEFXU19MQU1CREFfRlVOQ1RJT05fTUVNT1JZX1NJWkUpKTtcbiAgICAgICAgfVxuICAgICAgICBmYWFzRW52LnNldCgnbmFtZScsICdhd3MubGFtYmRhJyk7XG4gICAgICAgIHJldHVybiBmYWFzRW52O1xuICAgIH1cbiAgICBpZiAoaXNBenVyZUZhYVMgJiYgIShpc0dDUEZhYVMgfHwgaXNBV1NGYWFTIHx8IGlzVmVyY2VsRmFhUykpIHtcbiAgICAgICAgZmFhc0Vudi5zZXQoJ25hbWUnLCAnYXp1cmUuZnVuYycpO1xuICAgICAgICByZXR1cm4gZmFhc0VudjtcbiAgICB9XG4gICAgaWYgKGlzR0NQRmFhUyAmJiAhKGlzQXp1cmVGYWFTIHx8IGlzQVdTRmFhUyB8fCBpc1ZlcmNlbEZhYVMpKSB7XG4gICAgICAgIGlmIChGVU5DVElPTl9SRUdJT04ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZmFhc0Vudi5zZXQoJ3JlZ2lvbicsIEZVTkNUSU9OX1JFR0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEZVTkNUSU9OX01FTU9SWV9NQi5sZW5ndGggPiAwICYmIE51bWJlci5pc0ludGVnZXIoK0ZVTkNUSU9OX01FTU9SWV9NQikpIHtcbiAgICAgICAgICAgIGZhYXNFbnYuc2V0KCdtZW1vcnlfbWInLCBuZXcgYnNvbl8xLkludDMyKEZVTkNUSU9OX01FTU9SWV9NQikpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChGVU5DVElPTl9USU1FT1VUX1NFQy5sZW5ndGggPiAwICYmIE51bWJlci5pc0ludGVnZXIoK0ZVTkNUSU9OX1RJTUVPVVRfU0VDKSkge1xuICAgICAgICAgICAgZmFhc0Vudi5zZXQoJ3RpbWVvdXRfc2VjJywgbmV3IGJzb25fMS5JbnQzMihGVU5DVElPTl9USU1FT1VUX1NFQykpO1xuICAgICAgICB9XG4gICAgICAgIGZhYXNFbnYuc2V0KCduYW1lJywgJ2djcC5mdW5jJyk7XG4gICAgICAgIHJldHVybiBmYWFzRW52O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogQGludGVybmFsXG4gKiBHZXQgY3VycmVudCBKYXZhU2NyaXB0IHJ1bnRpbWUgcGxhdGZvcm1cbiAqXG4gKiBOT1RFOiBUaGUgdmVyc2lvbiBpbmZvcm1hdGlvbiBmZXRjaGluZyBpcyBpbnRlbnRpb25hbGx5IHdyaXR0ZW4gZGVmZW5zaXZlbHlcbiAqIHRvIGF2b2lkIGhhdmluZyBhIHJlbGVhc2VkIGRyaXZlciB2ZXJzaW9uIHRoYXQgYmVjb21lcyBpbmNvbXBhdGlibGVcbiAqIHdpdGggYSBmdXR1cmUgY2hhbmdlIHRvIHRoZXNlIGdsb2JhbCBvYmplY3RzLlxuICovXG5mdW5jdGlvbiBnZXRSdW50aW1lSW5mbygpIHtcbiAgICBpZiAoJ0Rlbm8nIGluIGdsb2JhbFRoaXMpIHtcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IHR5cGVvZiBEZW5vPy52ZXJzaW9uPy5kZW5vID09PSAnc3RyaW5nJyA/IERlbm8/LnZlcnNpb24/LmRlbm8gOiAnMC4wLjAtdW5rbm93bic7XG4gICAgICAgIHJldHVybiBgRGVubyB2JHt2ZXJzaW9ufSwgJHtvcy5lbmRpYW5uZXNzKCl9YDtcbiAgICB9XG4gICAgaWYgKCdCdW4nIGluIGdsb2JhbFRoaXMpIHtcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IHR5cGVvZiBCdW4/LnZlcnNpb24gPT09ICdzdHJpbmcnID8gQnVuPy52ZXJzaW9uIDogJzAuMC4wLXVua25vd24nO1xuICAgICAgICByZXR1cm4gYEJ1biB2JHt2ZXJzaW9ufSwgJHtvcy5lbmRpYW5uZXNzKCl9YDtcbiAgICB9XG4gICAgcmV0dXJuIGBOb2RlLmpzICR7cHJvY2Vzcy52ZXJzaW9ufSwgJHtvcy5lbmRpYW5uZXNzKCl9YDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNsaWVudF9tZXRhZGF0YS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/handshake/client_metadata.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/metrics.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/metrics.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ConnectionPoolMetrics = void 0;\n/** @internal */\nclass ConnectionPoolMetrics {\n    constructor() {\n        this.txnConnections = 0;\n        this.cursorConnections = 0;\n        this.otherConnections = 0;\n    }\n    /**\n     * Mark a connection as pinned for a specific operation.\n     */\n    markPinned(pinType) {\n        if (pinType === ConnectionPoolMetrics.TXN) {\n            this.txnConnections += 1;\n        }\n        else if (pinType === ConnectionPoolMetrics.CURSOR) {\n            this.cursorConnections += 1;\n        }\n        else {\n            this.otherConnections += 1;\n        }\n    }\n    /**\n     * Unmark a connection as pinned for an operation.\n     */\n    markUnpinned(pinType) {\n        if (pinType === ConnectionPoolMetrics.TXN) {\n            this.txnConnections -= 1;\n        }\n        else if (pinType === ConnectionPoolMetrics.CURSOR) {\n            this.cursorConnections -= 1;\n        }\n        else {\n            this.otherConnections -= 1;\n        }\n    }\n    /**\n     * Return information about the cmap metrics as a string.\n     */\n    info(maxPoolSize) {\n        return ('Timed out while checking out a connection from connection pool: ' +\n            `maxPoolSize: ${maxPoolSize}, ` +\n            `connections in use by cursors: ${this.cursorConnections}, ` +\n            `connections in use by transactions: ${this.txnConnections}, ` +\n            `connections in use by other operations: ${this.otherConnections}`);\n    }\n    /**\n     * Reset the metrics to the initial values.\n     */\n    reset() {\n        this.txnConnections = 0;\n        this.cursorConnections = 0;\n        this.otherConnections = 0;\n    }\n}\nexports.ConnectionPoolMetrics = ConnectionPoolMetrics;\nConnectionPoolMetrics.TXN = 'txn';\nConnectionPoolMetrics.CURSOR = 'cursor';\nConnectionPoolMetrics.OTHER = 'other';\n//# sourceMappingURL=metrics.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvbWV0cmljcy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsWUFBWTtBQUN4Qyw4Q0FBOEMsdUJBQXVCO0FBQ3JFLG1EQUFtRCxvQkFBb0I7QUFDdkUsdURBQXVELHNCQUFzQjtBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvbWV0cmljcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xNZXRyaWNzID0gdm9pZCAwO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ29ubmVjdGlvblBvb2xNZXRyaWNzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy50eG5Db25uZWN0aW9ucyA9IDA7XG4gICAgICAgIHRoaXMuY3Vyc29yQ29ubmVjdGlvbnMgPSAwO1xuICAgICAgICB0aGlzLm90aGVyQ29ubmVjdGlvbnMgPSAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYXJrIGEgY29ubmVjdGlvbiBhcyBwaW5uZWQgZm9yIGEgc3BlY2lmaWMgb3BlcmF0aW9uLlxuICAgICAqL1xuICAgIG1hcmtQaW5uZWQocGluVHlwZSkge1xuICAgICAgICBpZiAocGluVHlwZSA9PT0gQ29ubmVjdGlvblBvb2xNZXRyaWNzLlRYTikge1xuICAgICAgICAgICAgdGhpcy50eG5Db25uZWN0aW9ucyArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBpblR5cGUgPT09IENvbm5lY3Rpb25Qb29sTWV0cmljcy5DVVJTT1IpIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yQ29ubmVjdGlvbnMgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3RoZXJDb25uZWN0aW9ucyArPSAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVubWFyayBhIGNvbm5lY3Rpb24gYXMgcGlubmVkIGZvciBhbiBvcGVyYXRpb24uXG4gICAgICovXG4gICAgbWFya1VucGlubmVkKHBpblR5cGUpIHtcbiAgICAgICAgaWYgKHBpblR5cGUgPT09IENvbm5lY3Rpb25Qb29sTWV0cmljcy5UWE4pIHtcbiAgICAgICAgICAgIHRoaXMudHhuQ29ubmVjdGlvbnMgLT0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwaW5UeXBlID09PSBDb25uZWN0aW9uUG9vbE1ldHJpY3MuQ1VSU09SKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnNvckNvbm5lY3Rpb25zIC09IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm90aGVyQ29ubmVjdGlvbnMgLT0gMTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gaW5mb3JtYXRpb24gYWJvdXQgdGhlIGNtYXAgbWV0cmljcyBhcyBhIHN0cmluZy5cbiAgICAgKi9cbiAgICBpbmZvKG1heFBvb2xTaXplKSB7XG4gICAgICAgIHJldHVybiAoJ1RpbWVkIG91dCB3aGlsZSBjaGVja2luZyBvdXQgYSBjb25uZWN0aW9uIGZyb20gY29ubmVjdGlvbiBwb29sOiAnICtcbiAgICAgICAgICAgIGBtYXhQb29sU2l6ZTogJHttYXhQb29sU2l6ZX0sIGAgK1xuICAgICAgICAgICAgYGNvbm5lY3Rpb25zIGluIHVzZSBieSBjdXJzb3JzOiAke3RoaXMuY3Vyc29yQ29ubmVjdGlvbnN9LCBgICtcbiAgICAgICAgICAgIGBjb25uZWN0aW9ucyBpbiB1c2UgYnkgdHJhbnNhY3Rpb25zOiAke3RoaXMudHhuQ29ubmVjdGlvbnN9LCBgICtcbiAgICAgICAgICAgIGBjb25uZWN0aW9ucyBpbiB1c2UgYnkgb3RoZXIgb3BlcmF0aW9uczogJHt0aGlzLm90aGVyQ29ubmVjdGlvbnN9YCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSBtZXRyaWNzIHRvIHRoZSBpbml0aWFsIHZhbHVlcy5cbiAgICAgKi9cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy50eG5Db25uZWN0aW9ucyA9IDA7XG4gICAgICAgIHRoaXMuY3Vyc29yQ29ubmVjdGlvbnMgPSAwO1xuICAgICAgICB0aGlzLm90aGVyQ29ubmVjdGlvbnMgPSAwO1xuICAgIH1cbn1cbmV4cG9ydHMuQ29ubmVjdGlvblBvb2xNZXRyaWNzID0gQ29ubmVjdGlvblBvb2xNZXRyaWNzO1xuQ29ubmVjdGlvblBvb2xNZXRyaWNzLlRYTiA9ICd0eG4nO1xuQ29ubmVjdGlvblBvb2xNZXRyaWNzLkNVUlNPUiA9ICdjdXJzb3InO1xuQ29ubmVjdGlvblBvb2xNZXRyaWNzLk9USEVSID0gJ290aGVyJztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1ldHJpY3MuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/metrics.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/stream_description.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/stream_description.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.StreamDescription = void 0;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst common_1 = __webpack_require__(/*! ../sdam/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst server_description_1 = __webpack_require__(/*! ../sdam/server_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js\");\nconst RESPONSE_FIELDS = [\n    'minWireVersion',\n    'maxWireVersion',\n    'maxBsonObjectSize',\n    'maxMessageSizeBytes',\n    'maxWriteBatchSize',\n    'logicalSessionTimeoutMinutes'\n];\n/** @public */\nclass StreamDescription {\n    constructor(address, options) {\n        this.hello = null;\n        this.address = address;\n        this.type = common_1.ServerType.Unknown;\n        this.minWireVersion = undefined;\n        this.maxWireVersion = undefined;\n        this.maxBsonObjectSize = 16777216;\n        this.maxMessageSizeBytes = 48000000;\n        this.maxWriteBatchSize = 100000;\n        this.logicalSessionTimeoutMinutes = options?.logicalSessionTimeoutMinutes;\n        this.loadBalanced = !!options?.loadBalanced;\n        this.compressors =\n            options && options.compressors && Array.isArray(options.compressors)\n                ? options.compressors\n                : [];\n        this.serverConnectionId = null;\n    }\n    receiveResponse(response) {\n        if (response == null) {\n            return;\n        }\n        this.hello = response;\n        this.type = (0, server_description_1.parseServerType)(response);\n        if ('connectionId' in response) {\n            this.serverConnectionId = this.parseServerConnectionID(response.connectionId);\n        }\n        else {\n            this.serverConnectionId = null;\n        }\n        for (const field of RESPONSE_FIELDS) {\n            if (response[field] != null) {\n                this[field] = response[field];\n            }\n            // testing case\n            if ('__nodejs_mock_server__' in response) {\n                this.__nodejs_mock_server__ = response['__nodejs_mock_server__'];\n            }\n        }\n        if (response.compression) {\n            this.compressor = this.compressors.filter(c => response.compression?.includes(c))[0];\n        }\n    }\n    /* @internal */\n    parseServerConnectionID(serverConnectionId) {\n        // Connection ids are always integral, so it's safe to coerce doubles as well as\n        // any integral type.\n        return bson_1.Long.isLong(serverConnectionId)\n            ? serverConnectionId.toBigInt()\n            : // @ts-expect-error: Doubles are coercible to number\n                BigInt(serverConnectionId);\n    }\n}\nexports.StreamDescription = StreamDescription;\n//# sourceMappingURL=stream_description.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvc3RyZWFtX2Rlc2NyaXB0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QjtBQUN6QixlQUFlLG1CQUFPLENBQUMsMkZBQVM7QUFDaEMsaUJBQWlCLG1CQUFPLENBQUMseUdBQWdCO0FBQ3pDLDZCQUE2QixtQkFBTyxDQUFDLGlJQUE0QjtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC9zdHJlYW1fZGVzY3JpcHRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlN0cmVhbURlc2NyaXB0aW9uID0gdm9pZCAwO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuLi9zZGFtL2NvbW1vblwiKTtcbmNvbnN0IHNlcnZlcl9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4uL3NkYW0vc2VydmVyX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgUkVTUE9OU0VfRklFTERTID0gW1xuICAgICdtaW5XaXJlVmVyc2lvbicsXG4gICAgJ21heFdpcmVWZXJzaW9uJyxcbiAgICAnbWF4QnNvbk9iamVjdFNpemUnLFxuICAgICdtYXhNZXNzYWdlU2l6ZUJ5dGVzJyxcbiAgICAnbWF4V3JpdGVCYXRjaFNpemUnLFxuICAgICdsb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzJ1xuXTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBTdHJlYW1EZXNjcmlwdGlvbiB7XG4gICAgY29uc3RydWN0b3IoYWRkcmVzcywgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmhlbGxvID0gbnVsbDtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICAgICAgdGhpcy50eXBlID0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duO1xuICAgICAgICB0aGlzLm1pbldpcmVWZXJzaW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1heFdpcmVWZXJzaW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1heEJzb25PYmplY3RTaXplID0gMTY3NzcyMTY7XG4gICAgICAgIHRoaXMubWF4TWVzc2FnZVNpemVCeXRlcyA9IDQ4MDAwMDAwO1xuICAgICAgICB0aGlzLm1heFdyaXRlQmF0Y2hTaXplID0gMTAwMDAwO1xuICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBvcHRpb25zPy5sb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzO1xuICAgICAgICB0aGlzLmxvYWRCYWxhbmNlZCA9ICEhb3B0aW9ucz8ubG9hZEJhbGFuY2VkO1xuICAgICAgICB0aGlzLmNvbXByZXNzb3JzID1cbiAgICAgICAgICAgIG9wdGlvbnMgJiYgb3B0aW9ucy5jb21wcmVzc29ycyAmJiBBcnJheS5pc0FycmF5KG9wdGlvbnMuY29tcHJlc3NvcnMpXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLmNvbXByZXNzb3JzXG4gICAgICAgICAgICAgICAgOiBbXTtcbiAgICAgICAgdGhpcy5zZXJ2ZXJDb25uZWN0aW9uSWQgPSBudWxsO1xuICAgIH1cbiAgICByZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhlbGxvID0gcmVzcG9uc2U7XG4gICAgICAgIHRoaXMudHlwZSA9ICgwLCBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5wYXJzZVNlcnZlclR5cGUpKHJlc3BvbnNlKTtcbiAgICAgICAgaWYgKCdjb25uZWN0aW9uSWQnIGluIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlckNvbm5lY3Rpb25JZCA9IHRoaXMucGFyc2VTZXJ2ZXJDb25uZWN0aW9uSUQocmVzcG9uc2UuY29ubmVjdGlvbklkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyQ29ubmVjdGlvbklkID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIFJFU1BPTlNFX0ZJRUxEUykge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlW2ZpZWxkXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpc1tmaWVsZF0gPSByZXNwb25zZVtmaWVsZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0ZXN0aW5nIGNhc2VcbiAgICAgICAgICAgIGlmICgnX19ub2RlanNfbW9ja19zZXJ2ZXJfXycgaW4gcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9fbm9kZWpzX21vY2tfc2VydmVyX18gPSByZXNwb25zZVsnX19ub2RlanNfbW9ja19zZXJ2ZXJfXyddO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChyZXNwb25zZS5jb21wcmVzc2lvbikge1xuICAgICAgICAgICAgdGhpcy5jb21wcmVzc29yID0gdGhpcy5jb21wcmVzc29ycy5maWx0ZXIoYyA9PiByZXNwb25zZS5jb21wcmVzc2lvbj8uaW5jbHVkZXMoYykpWzBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qIEBpbnRlcm5hbCAqL1xuICAgIHBhcnNlU2VydmVyQ29ubmVjdGlvbklEKHNlcnZlckNvbm5lY3Rpb25JZCkge1xuICAgICAgICAvLyBDb25uZWN0aW9uIGlkcyBhcmUgYWx3YXlzIGludGVncmFsLCBzbyBpdCdzIHNhZmUgdG8gY29lcmNlIGRvdWJsZXMgYXMgd2VsbCBhc1xuICAgICAgICAvLyBhbnkgaW50ZWdyYWwgdHlwZS5cbiAgICAgICAgcmV0dXJuIGJzb25fMS5Mb25nLmlzTG9uZyhzZXJ2ZXJDb25uZWN0aW9uSWQpXG4gICAgICAgICAgICA/IHNlcnZlckNvbm5lY3Rpb25JZC50b0JpZ0ludCgpXG4gICAgICAgICAgICA6IC8vIEB0cy1leHBlY3QtZXJyb3I6IERvdWJsZXMgYXJlIGNvZXJjaWJsZSB0byBudW1iZXJcbiAgICAgICAgICAgICAgICBCaWdJbnQoc2VydmVyQ29ubmVjdGlvbklkKTtcbiAgICB9XG59XG5leHBvcnRzLlN0cmVhbURlc2NyaXB0aW9uID0gU3RyZWFtRGVzY3JpcHRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdHJlYW1fZGVzY3JpcHRpb24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/stream_description.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.uncompressibleCommands = exports.Compressor = void 0;\nexports.compress = compress;\nexports.decompress = decompress;\nexports.compressCommand = compressCommand;\nexports.decompressResponse = decompressResponse;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst zlib = __webpack_require__(/*! zlib */ \"zlib\");\nconst constants_1 = __webpack_require__(/*! ../../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst deps_1 = __webpack_require__(/*! ../../deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst commands_1 = __webpack_require__(/*! ../commands */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js\");\nconst constants_2 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\n/** @public */\nexports.Compressor = Object.freeze({\n    none: 0,\n    snappy: 1,\n    zlib: 2,\n    zstd: 3\n});\nexports.uncompressibleCommands = new Set([\n    constants_1.LEGACY_HELLO_COMMAND,\n    'saslStart',\n    'saslContinue',\n    'getnonce',\n    'authenticate',\n    'createUser',\n    'updateUser',\n    'copydbSaslStart',\n    'copydbgetnonce',\n    'copydb'\n]);\nconst ZSTD_COMPRESSION_LEVEL = 3;\nconst zlibInflate = (0, util_1.promisify)(zlib.inflate.bind(zlib));\nconst zlibDeflate = (0, util_1.promisify)(zlib.deflate.bind(zlib));\nlet zstd;\nlet Snappy = null;\nfunction loadSnappy() {\n    if (Snappy == null) {\n        const snappyImport = (0, deps_1.getSnappy)();\n        if ('kModuleError' in snappyImport) {\n            throw snappyImport.kModuleError;\n        }\n        Snappy = snappyImport;\n    }\n    return Snappy;\n}\n// Facilitate compressing a message using an agreed compressor\nasync function compress(options, dataToBeCompressed) {\n    const zlibOptions = {};\n    switch (options.agreedCompressor) {\n        case 'snappy': {\n            Snappy ??= loadSnappy();\n            return await Snappy.compress(dataToBeCompressed);\n        }\n        case 'zstd': {\n            loadZstd();\n            if ('kModuleError' in zstd) {\n                throw zstd['kModuleError'];\n            }\n            return await zstd.compress(dataToBeCompressed, ZSTD_COMPRESSION_LEVEL);\n        }\n        case 'zlib': {\n            if (options.zlibCompressionLevel) {\n                zlibOptions.level = options.zlibCompressionLevel;\n            }\n            return await zlibDeflate(dataToBeCompressed, zlibOptions);\n        }\n        default: {\n            throw new error_1.MongoInvalidArgumentError(`Unknown compressor ${options.agreedCompressor} failed to compress`);\n        }\n    }\n}\n// Decompress a message using the given compressor\nasync function decompress(compressorID, compressedData) {\n    if (compressorID !== exports.Compressor.snappy &&\n        compressorID !== exports.Compressor.zstd &&\n        compressorID !== exports.Compressor.zlib &&\n        compressorID !== exports.Compressor.none) {\n        throw new error_1.MongoDecompressionError(`Server sent message compressed using an unsupported compressor. (Received compressor ID ${compressorID})`);\n    }\n    switch (compressorID) {\n        case exports.Compressor.snappy: {\n            Snappy ??= loadSnappy();\n            return await Snappy.uncompress(compressedData, { asBuffer: true });\n        }\n        case exports.Compressor.zstd: {\n            loadZstd();\n            if ('kModuleError' in zstd) {\n                throw zstd['kModuleError'];\n            }\n            return await zstd.decompress(compressedData);\n        }\n        case exports.Compressor.zlib: {\n            return await zlibInflate(compressedData);\n        }\n        default: {\n            return compressedData;\n        }\n    }\n}\n/**\n * Load ZStandard if it is not already set.\n */\nfunction loadZstd() {\n    if (!zstd) {\n        zstd = (0, deps_1.getZstdLibrary)();\n    }\n}\nconst MESSAGE_HEADER_SIZE = 16;\n/**\n * @internal\n *\n * Compresses an OP_MSG or OP_QUERY message, if compression is configured.  This method\n * also serializes the command to BSON.\n */\nasync function compressCommand(command, description) {\n    const finalCommand = description.agreedCompressor === 'none' || !commands_1.OpCompressedRequest.canCompress(command)\n        ? command\n        : new commands_1.OpCompressedRequest(command, {\n            agreedCompressor: description.agreedCompressor ?? 'none',\n            zlibCompressionLevel: description.zlibCompressionLevel ?? 0\n        });\n    const data = await finalCommand.toBin();\n    return Buffer.concat(data);\n}\n/**\n * @internal\n *\n * Decompresses an OP_MSG or OP_QUERY response from the server, if compression is configured.\n *\n * This method does not parse the response's BSON.\n */\nasync function decompressResponse(message) {\n    const messageHeader = {\n        length: message.readInt32LE(0),\n        requestId: message.readInt32LE(4),\n        responseTo: message.readInt32LE(8),\n        opCode: message.readInt32LE(12)\n    };\n    if (messageHeader.opCode !== constants_2.OP_COMPRESSED) {\n        const ResponseType = messageHeader.opCode === constants_2.OP_MSG ? commands_1.OpMsgResponse : commands_1.OpReply;\n        const messageBody = message.subarray(MESSAGE_HEADER_SIZE);\n        return new ResponseType(message, messageHeader, messageBody);\n    }\n    const header = {\n        ...messageHeader,\n        fromCompressed: true,\n        opCode: message.readInt32LE(MESSAGE_HEADER_SIZE),\n        length: message.readInt32LE(MESSAGE_HEADER_SIZE + 4)\n    };\n    const compressorID = message[MESSAGE_HEADER_SIZE + 8];\n    const compressedBuffer = message.slice(MESSAGE_HEADER_SIZE + 9);\n    // recalculate based on wrapped opcode\n    const ResponseType = header.opCode === constants_2.OP_MSG ? commands_1.OpMsgResponse : commands_1.OpReply;\n    const messageBody = await decompress(compressorID, compressedBuffer);\n    if (messageBody.length !== header.length) {\n        throw new error_1.MongoDecompressionError('Message body and message header must be the same length');\n    }\n    return new ResponseType(message, header, messageBody);\n}\n//# sourceMappingURL=compression.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9jb21wcmVzc2lvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw4QkFBOEIsR0FBRyxrQkFBa0I7QUFDbkQsZ0JBQWdCO0FBQ2hCLGtCQUFrQjtBQUNsQix1QkFBdUI7QUFDdkIsMEJBQTBCO0FBQzFCLGVBQWUsbUJBQU8sQ0FBQyxrQkFBTTtBQUM3QixhQUFhLG1CQUFPLENBQUMsa0JBQU07QUFDM0Isb0JBQW9CLG1CQUFPLENBQUMsd0dBQWlCO0FBQzdDLGVBQWUsbUJBQU8sQ0FBQyw4RkFBWTtBQUNuQyxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQyxtQkFBbUIsbUJBQU8sQ0FBQyx3R0FBYTtBQUN4QyxvQkFBb0IsbUJBQU8sQ0FBQyx1SEFBYTtBQUN6QztBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLDBCQUEwQjtBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2SUFBNkksYUFBYTtBQUMxSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxnQkFBZ0I7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY21hcC93aXJlX3Byb3RvY29sL2NvbXByZXNzaW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51bmNvbXByZXNzaWJsZUNvbW1hbmRzID0gZXhwb3J0cy5Db21wcmVzc29yID0gdm9pZCAwO1xuZXhwb3J0cy5jb21wcmVzcyA9IGNvbXByZXNzO1xuZXhwb3J0cy5kZWNvbXByZXNzID0gZGVjb21wcmVzcztcbmV4cG9ydHMuY29tcHJlc3NDb21tYW5kID0gY29tcHJlc3NDb21tYW5kO1xuZXhwb3J0cy5kZWNvbXByZXNzUmVzcG9uc2UgPSBkZWNvbXByZXNzUmVzcG9uc2U7XG5jb25zdCB1dGlsXzEgPSByZXF1aXJlKFwidXRpbFwiKTtcbmNvbnN0IHpsaWIgPSByZXF1aXJlKFwiemxpYlwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGRlcHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9kZXBzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IGNvbW1hbmRzXzEgPSByZXF1aXJlKFwiLi4vY29tbWFuZHNcIik7XG5jb25zdCBjb25zdGFudHNfMiA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLkNvbXByZXNzb3IgPSBPYmplY3QuZnJlZXplKHtcbiAgICBub25lOiAwLFxuICAgIHNuYXBweTogMSxcbiAgICB6bGliOiAyLFxuICAgIHpzdGQ6IDNcbn0pO1xuZXhwb3J0cy51bmNvbXByZXNzaWJsZUNvbW1hbmRzID0gbmV3IFNldChbXG4gICAgY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkQsXG4gICAgJ3Nhc2xTdGFydCcsXG4gICAgJ3Nhc2xDb250aW51ZScsXG4gICAgJ2dldG5vbmNlJyxcbiAgICAnYXV0aGVudGljYXRlJyxcbiAgICAnY3JlYXRlVXNlcicsXG4gICAgJ3VwZGF0ZVVzZXInLFxuICAgICdjb3B5ZGJTYXNsU3RhcnQnLFxuICAgICdjb3B5ZGJnZXRub25jZScsXG4gICAgJ2NvcHlkYidcbl0pO1xuY29uc3QgWlNURF9DT01QUkVTU0lPTl9MRVZFTCA9IDM7XG5jb25zdCB6bGliSW5mbGF0ZSA9ICgwLCB1dGlsXzEucHJvbWlzaWZ5KSh6bGliLmluZmxhdGUuYmluZCh6bGliKSk7XG5jb25zdCB6bGliRGVmbGF0ZSA9ICgwLCB1dGlsXzEucHJvbWlzaWZ5KSh6bGliLmRlZmxhdGUuYmluZCh6bGliKSk7XG5sZXQgenN0ZDtcbmxldCBTbmFwcHkgPSBudWxsO1xuZnVuY3Rpb24gbG9hZFNuYXBweSgpIHtcbiAgICBpZiAoU25hcHB5ID09IG51bGwpIHtcbiAgICAgICAgY29uc3Qgc25hcHB5SW1wb3J0ID0gKDAsIGRlcHNfMS5nZXRTbmFwcHkpKCk7XG4gICAgICAgIGlmICgna01vZHVsZUVycm9yJyBpbiBzbmFwcHlJbXBvcnQpIHtcbiAgICAgICAgICAgIHRocm93IHNuYXBweUltcG9ydC5rTW9kdWxlRXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgU25hcHB5ID0gc25hcHB5SW1wb3J0O1xuICAgIH1cbiAgICByZXR1cm4gU25hcHB5O1xufVxuLy8gRmFjaWxpdGF0ZSBjb21wcmVzc2luZyBhIG1lc3NhZ2UgdXNpbmcgYW4gYWdyZWVkIGNvbXByZXNzb3JcbmFzeW5jIGZ1bmN0aW9uIGNvbXByZXNzKG9wdGlvbnMsIGRhdGFUb0JlQ29tcHJlc3NlZCkge1xuICAgIGNvbnN0IHpsaWJPcHRpb25zID0ge307XG4gICAgc3dpdGNoIChvcHRpb25zLmFncmVlZENvbXByZXNzb3IpIHtcbiAgICAgICAgY2FzZSAnc25hcHB5Jzoge1xuICAgICAgICAgICAgU25hcHB5ID8/PSBsb2FkU25hcHB5KCk7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgU25hcHB5LmNvbXByZXNzKGRhdGFUb0JlQ29tcHJlc3NlZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnenN0ZCc6IHtcbiAgICAgICAgICAgIGxvYWRac3RkKCk7XG4gICAgICAgICAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4genN0ZCkge1xuICAgICAgICAgICAgICAgIHRocm93IHpzdGRbJ2tNb2R1bGVFcnJvciddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHpzdGQuY29tcHJlc3MoZGF0YVRvQmVDb21wcmVzc2VkLCBaU1REX0NPTVBSRVNTSU9OX0xFVkVMKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICd6bGliJzoge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuemxpYkNvbXByZXNzaW9uTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICB6bGliT3B0aW9ucy5sZXZlbCA9IG9wdGlvbnMuemxpYkNvbXByZXNzaW9uTGV2ZWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgemxpYkRlZmxhdGUoZGF0YVRvQmVDb21wcmVzc2VkLCB6bGliT3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgVW5rbm93biBjb21wcmVzc29yICR7b3B0aW9ucy5hZ3JlZWRDb21wcmVzc29yfSBmYWlsZWQgdG8gY29tcHJlc3NgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIERlY29tcHJlc3MgYSBtZXNzYWdlIHVzaW5nIHRoZSBnaXZlbiBjb21wcmVzc29yXG5hc3luYyBmdW5jdGlvbiBkZWNvbXByZXNzKGNvbXByZXNzb3JJRCwgY29tcHJlc3NlZERhdGEpIHtcbiAgICBpZiAoY29tcHJlc3NvcklEICE9PSBleHBvcnRzLkNvbXByZXNzb3Iuc25hcHB5ICYmXG4gICAgICAgIGNvbXByZXNzb3JJRCAhPT0gZXhwb3J0cy5Db21wcmVzc29yLnpzdGQgJiZcbiAgICAgICAgY29tcHJlc3NvcklEICE9PSBleHBvcnRzLkNvbXByZXNzb3IuemxpYiAmJlxuICAgICAgICBjb21wcmVzc29ySUQgIT09IGV4cG9ydHMuQ29tcHJlc3Nvci5ub25lKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvRGVjb21wcmVzc2lvbkVycm9yKGBTZXJ2ZXIgc2VudCBtZXNzYWdlIGNvbXByZXNzZWQgdXNpbmcgYW4gdW5zdXBwb3J0ZWQgY29tcHJlc3Nvci4gKFJlY2VpdmVkIGNvbXByZXNzb3IgSUQgJHtjb21wcmVzc29ySUR9KWApO1xuICAgIH1cbiAgICBzd2l0Y2ggKGNvbXByZXNzb3JJRCkge1xuICAgICAgICBjYXNlIGV4cG9ydHMuQ29tcHJlc3Nvci5zbmFwcHk6IHtcbiAgICAgICAgICAgIFNuYXBweSA/Pz0gbG9hZFNuYXBweSgpO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IFNuYXBweS51bmNvbXByZXNzKGNvbXByZXNzZWREYXRhLCB7IGFzQnVmZmVyOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgZXhwb3J0cy5Db21wcmVzc29yLnpzdGQ6IHtcbiAgICAgICAgICAgIGxvYWRac3RkKCk7XG4gICAgICAgICAgICBpZiAoJ2tNb2R1bGVFcnJvcicgaW4genN0ZCkge1xuICAgICAgICAgICAgICAgIHRocm93IHpzdGRbJ2tNb2R1bGVFcnJvciddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHpzdGQuZGVjb21wcmVzcyhjb21wcmVzc2VkRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBleHBvcnRzLkNvbXByZXNzb3IuemxpYjoge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHpsaWJJbmZsYXRlKGNvbXByZXNzZWREYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICByZXR1cm4gY29tcHJlc3NlZERhdGE7XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIExvYWQgWlN0YW5kYXJkIGlmIGl0IGlzIG5vdCBhbHJlYWR5IHNldC5cbiAqL1xuZnVuY3Rpb24gbG9hZFpzdGQoKSB7XG4gICAgaWYgKCF6c3RkKSB7XG4gICAgICAgIHpzdGQgPSAoMCwgZGVwc18xLmdldFpzdGRMaWJyYXJ5KSgpO1xuICAgIH1cbn1cbmNvbnN0IE1FU1NBR0VfSEVBREVSX1NJWkUgPSAxNjtcbi8qKlxuICogQGludGVybmFsXG4gKlxuICogQ29tcHJlc3NlcyBhbiBPUF9NU0cgb3IgT1BfUVVFUlkgbWVzc2FnZSwgaWYgY29tcHJlc3Npb24gaXMgY29uZmlndXJlZC4gIFRoaXMgbWV0aG9kXG4gKiBhbHNvIHNlcmlhbGl6ZXMgdGhlIGNvbW1hbmQgdG8gQlNPTi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY29tcHJlc3NDb21tYW5kKGNvbW1hbmQsIGRlc2NyaXB0aW9uKSB7XG4gICAgY29uc3QgZmluYWxDb21tYW5kID0gZGVzY3JpcHRpb24uYWdyZWVkQ29tcHJlc3NvciA9PT0gJ25vbmUnIHx8ICFjb21tYW5kc18xLk9wQ29tcHJlc3NlZFJlcXVlc3QuY2FuQ29tcHJlc3MoY29tbWFuZClcbiAgICAgICAgPyBjb21tYW5kXG4gICAgICAgIDogbmV3IGNvbW1hbmRzXzEuT3BDb21wcmVzc2VkUmVxdWVzdChjb21tYW5kLCB7XG4gICAgICAgICAgICBhZ3JlZWRDb21wcmVzc29yOiBkZXNjcmlwdGlvbi5hZ3JlZWRDb21wcmVzc29yID8/ICdub25lJyxcbiAgICAgICAgICAgIHpsaWJDb21wcmVzc2lvbkxldmVsOiBkZXNjcmlwdGlvbi56bGliQ29tcHJlc3Npb25MZXZlbCA/PyAwXG4gICAgICAgIH0pO1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmaW5hbENvbW1hbmQudG9CaW4oKTtcbiAgICByZXR1cm4gQnVmZmVyLmNvbmNhdChkYXRhKTtcbn1cbi8qKlxuICogQGludGVybmFsXG4gKlxuICogRGVjb21wcmVzc2VzIGFuIE9QX01TRyBvciBPUF9RVUVSWSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIsIGlmIGNvbXByZXNzaW9uIGlzIGNvbmZpZ3VyZWQuXG4gKlxuICogVGhpcyBtZXRob2QgZG9lcyBub3QgcGFyc2UgdGhlIHJlc3BvbnNlJ3MgQlNPTi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGVjb21wcmVzc1Jlc3BvbnNlKG1lc3NhZ2UpIHtcbiAgICBjb25zdCBtZXNzYWdlSGVhZGVyID0ge1xuICAgICAgICBsZW5ndGg6IG1lc3NhZ2UucmVhZEludDMyTEUoMCksXG4gICAgICAgIHJlcXVlc3RJZDogbWVzc2FnZS5yZWFkSW50MzJMRSg0KSxcbiAgICAgICAgcmVzcG9uc2VUbzogbWVzc2FnZS5yZWFkSW50MzJMRSg4KSxcbiAgICAgICAgb3BDb2RlOiBtZXNzYWdlLnJlYWRJbnQzMkxFKDEyKVxuICAgIH07XG4gICAgaWYgKG1lc3NhZ2VIZWFkZXIub3BDb2RlICE9PSBjb25zdGFudHNfMi5PUF9DT01QUkVTU0VEKSB7XG4gICAgICAgIGNvbnN0IFJlc3BvbnNlVHlwZSA9IG1lc3NhZ2VIZWFkZXIub3BDb2RlID09PSBjb25zdGFudHNfMi5PUF9NU0cgPyBjb21tYW5kc18xLk9wTXNnUmVzcG9uc2UgOiBjb21tYW5kc18xLk9wUmVwbHk7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VCb2R5ID0gbWVzc2FnZS5zdWJhcnJheShNRVNTQUdFX0hFQURFUl9TSVpFKTtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZVR5cGUobWVzc2FnZSwgbWVzc2FnZUhlYWRlciwgbWVzc2FnZUJvZHkpO1xuICAgIH1cbiAgICBjb25zdCBoZWFkZXIgPSB7XG4gICAgICAgIC4uLm1lc3NhZ2VIZWFkZXIsXG4gICAgICAgIGZyb21Db21wcmVzc2VkOiB0cnVlLFxuICAgICAgICBvcENvZGU6IG1lc3NhZ2UucmVhZEludDMyTEUoTUVTU0FHRV9IRUFERVJfU0laRSksXG4gICAgICAgIGxlbmd0aDogbWVzc2FnZS5yZWFkSW50MzJMRShNRVNTQUdFX0hFQURFUl9TSVpFICsgNClcbiAgICB9O1xuICAgIGNvbnN0IGNvbXByZXNzb3JJRCA9IG1lc3NhZ2VbTUVTU0FHRV9IRUFERVJfU0laRSArIDhdO1xuICAgIGNvbnN0IGNvbXByZXNzZWRCdWZmZXIgPSBtZXNzYWdlLnNsaWNlKE1FU1NBR0VfSEVBREVSX1NJWkUgKyA5KTtcbiAgICAvLyByZWNhbGN1bGF0ZSBiYXNlZCBvbiB3cmFwcGVkIG9wY29kZVxuICAgIGNvbnN0IFJlc3BvbnNlVHlwZSA9IGhlYWRlci5vcENvZGUgPT09IGNvbnN0YW50c18yLk9QX01TRyA/IGNvbW1hbmRzXzEuT3BNc2dSZXNwb25zZSA6IGNvbW1hbmRzXzEuT3BSZXBseTtcbiAgICBjb25zdCBtZXNzYWdlQm9keSA9IGF3YWl0IGRlY29tcHJlc3MoY29tcHJlc3NvcklELCBjb21wcmVzc2VkQnVmZmVyKTtcbiAgICBpZiAobWVzc2FnZUJvZHkubGVuZ3RoICE9PSBoZWFkZXIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvRGVjb21wcmVzc2lvbkVycm9yKCdNZXNzYWdlIGJvZHkgYW5kIG1lc3NhZ2UgaGVhZGVyIG11c3QgYmUgdGhlIHNhbWUgbGVuZ3RoJyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVzcG9uc2VUeXBlKG1lc3NhZ2UsIGhlYWRlciwgbWVzc2FnZUJvZHkpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tcHJlc3Npb24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OP_MSG = exports.OP_COMPRESSED = exports.OP_DELETE = exports.OP_QUERY = exports.OP_INSERT = exports.OP_UPDATE = exports.OP_REPLY = exports.MIN_SUPPORTED_QE_SERVER_VERSION = exports.MIN_SUPPORTED_QE_WIRE_VERSION = exports.MAX_SUPPORTED_WIRE_VERSION = exports.MIN_SUPPORTED_WIRE_VERSION = exports.MAX_SUPPORTED_SERVER_VERSION = exports.MIN_SUPPORTED_SERVER_VERSION = void 0;\nexports.MIN_SUPPORTED_SERVER_VERSION = '4.0';\nexports.MAX_SUPPORTED_SERVER_VERSION = '8.0';\nexports.MIN_SUPPORTED_WIRE_VERSION = 7;\nexports.MAX_SUPPORTED_WIRE_VERSION = 25;\nexports.MIN_SUPPORTED_QE_WIRE_VERSION = 21;\nexports.MIN_SUPPORTED_QE_SERVER_VERSION = '7.0';\nexports.OP_REPLY = 1;\nexports.OP_UPDATE = 2001;\nexports.OP_INSERT = 2002;\nexports.OP_QUERY = 2004;\nexports.OP_DELETE = 2006;\nexports.OP_COMPRESSED = 2012;\nexports.OP_MSG = 2013;\n//# sourceMappingURL=constants.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9jb25zdGFudHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsY0FBYyxHQUFHLHFCQUFxQixHQUFHLGlCQUFpQixHQUFHLGdCQUFnQixHQUFHLGlCQUFpQixHQUFHLGlCQUFpQixHQUFHLGdCQUFnQixHQUFHLHVDQUF1QyxHQUFHLHFDQUFxQyxHQUFHLGtDQUFrQyxHQUFHLGtDQUFrQyxHQUFHLG9DQUFvQyxHQUFHLG9DQUFvQztBQUNsWCxvQ0FBb0M7QUFDcEMsb0NBQW9DO0FBQ3BDLGtDQUFrQztBQUNsQyxrQ0FBa0M7QUFDbEMscUNBQXFDO0FBQ3JDLHVDQUF1QztBQUN2QyxnQkFBZ0I7QUFDaEIsaUJBQWlCO0FBQ2pCLGlCQUFpQjtBQUNqQixnQkFBZ0I7QUFDaEIsaUJBQWlCO0FBQ2pCLHFCQUFxQjtBQUNyQixjQUFjO0FBQ2QiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL3dpcmVfcHJvdG9jb2wvY29uc3RhbnRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PUF9NU0cgPSBleHBvcnRzLk9QX0NPTVBSRVNTRUQgPSBleHBvcnRzLk9QX0RFTEVURSA9IGV4cG9ydHMuT1BfUVVFUlkgPSBleHBvcnRzLk9QX0lOU0VSVCA9IGV4cG9ydHMuT1BfVVBEQVRFID0gZXhwb3J0cy5PUF9SRVBMWSA9IGV4cG9ydHMuTUlOX1NVUFBPUlRFRF9RRV9TRVJWRVJfVkVSU0lPTiA9IGV4cG9ydHMuTUlOX1NVUFBPUlRFRF9RRV9XSVJFX1ZFUlNJT04gPSBleHBvcnRzLk1BWF9TVVBQT1JURURfV0lSRV9WRVJTSU9OID0gZXhwb3J0cy5NSU5fU1VQUE9SVEVEX1dJUkVfVkVSU0lPTiA9IGV4cG9ydHMuTUFYX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTiA9IGV4cG9ydHMuTUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTiA9IHZvaWQgMDtcbmV4cG9ydHMuTUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTiA9ICc0LjAnO1xuZXhwb3J0cy5NQVhfU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OID0gJzguMCc7XG5leHBvcnRzLk1JTl9TVVBQT1JURURfV0lSRV9WRVJTSU9OID0gNztcbmV4cG9ydHMuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04gPSAyNTtcbmV4cG9ydHMuTUlOX1NVUFBPUlRFRF9RRV9XSVJFX1ZFUlNJT04gPSAyMTtcbmV4cG9ydHMuTUlOX1NVUFBPUlRFRF9RRV9TRVJWRVJfVkVSU0lPTiA9ICc3LjAnO1xuZXhwb3J0cy5PUF9SRVBMWSA9IDE7XG5leHBvcnRzLk9QX1VQREFURSA9IDIwMDE7XG5leHBvcnRzLk9QX0lOU0VSVCA9IDIwMDI7XG5leHBvcnRzLk9QX1FVRVJZID0gMjAwNDtcbmV4cG9ydHMuT1BfREVMRVRFID0gMjAwNjtcbmV4cG9ydHMuT1BfQ09NUFJFU1NFRCA9IDIwMTI7XG5leHBvcnRzLk9QX01TRyA9IDIwMTM7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb25zdGFudHMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_data.js":
/*!**************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_data.js ***!
  \**************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.onData = onData;\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/**\n * onData is adapted from Node.js' events.on helper\n * https://nodejs.org/api/events.html#eventsonemitter-eventname-options\n *\n * Returns an AsyncIterator that iterates each 'data' event emitted from emitter.\n * It will reject upon an error event.\n */\nfunction onData(emitter, { timeoutContext, signal }) {\n    signal?.throwIfAborted();\n    // Setup pending events and pending promise lists\n    /**\n     * When the caller has not yet called .next(), we store the\n     * value from the event in this list. Next time they call .next()\n     * we pull the first value out of this list and resolve a promise with it.\n     */\n    const unconsumedEvents = new utils_1.List();\n    /**\n     * When there has not yet been an event, a new promise will be created\n     * and implicitly stored in this list. When an event occurs we take the first\n     * promise in this list and resolve it.\n     */\n    const unconsumedPromises = new utils_1.List();\n    /**\n     * Stored an error created by an error event.\n     * This error will turn into a rejection for the subsequent .next() call\n     */\n    let error = null;\n    /** Set to true only after event listeners have been removed. */\n    let finished = false;\n    const iterator = {\n        next() {\n            // First, we consume all unread events\n            const value = unconsumedEvents.shift();\n            if (value != null) {\n                return Promise.resolve({ value, done: false });\n            }\n            // Then we error, if an error happened\n            // This happens one time if at all, because after 'error'\n            // we stop listening\n            if (error != null) {\n                const p = Promise.reject(error);\n                // Only the first element errors\n                error = null;\n                return p;\n            }\n            // If the iterator is finished, resolve to done\n            if (finished)\n                return closeHandler();\n            // Wait until an event happens\n            const { promise, resolve, reject } = (0, utils_1.promiseWithResolvers)();\n            unconsumedPromises.push({ resolve, reject });\n            return promise;\n        },\n        return() {\n            return closeHandler();\n        },\n        throw(err) {\n            errorHandler(err);\n            return Promise.resolve({ value: undefined, done: true });\n        },\n        [Symbol.asyncIterator]() {\n            return this;\n        }\n    };\n    // Adding event handlers\n    emitter.on('data', eventHandler);\n    emitter.on('error', errorHandler);\n    const abortListener = (0, utils_1.addAbortListener)(signal, function () {\n        errorHandler(this.reason);\n    });\n    const timeoutForSocketRead = timeoutContext?.timeoutForSocketRead;\n    timeoutForSocketRead?.throwIfExpired();\n    timeoutForSocketRead?.then(undefined, errorHandler);\n    return iterator;\n    function eventHandler(value) {\n        const promise = unconsumedPromises.shift();\n        if (promise != null)\n            promise.resolve({ value, done: false });\n        else\n            unconsumedEvents.push(value);\n    }\n    function errorHandler(err) {\n        const promise = unconsumedPromises.shift();\n        if (promise != null)\n            promise.reject(err);\n        else\n            error = err;\n        void closeHandler();\n    }\n    function closeHandler() {\n        // Adding event handlers\n        emitter.off('data', eventHandler);\n        emitter.off('error', errorHandler);\n        abortListener?.[utils_1.kDispose]();\n        finished = true;\n        timeoutForSocketRead?.clear();\n        const doneResult = { value: undefined, done: finished };\n        for (const promise of unconsumedPromises) {\n            promise.resolve(doneResult);\n        }\n        return Promise.resolve(doneResult);\n    }\n}\n//# sourceMappingURL=on_data.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9vbl9kYXRhLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGNBQWM7QUFDZCxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix3QkFBd0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxvQkFBb0I7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwyQkFBMkI7QUFDL0Msc0NBQXNDLGlCQUFpQjtBQUN2RDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxxQ0FBcUMsOEJBQThCO0FBQ25FLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsb0JBQW9CO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9vbl9kYXRhLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5vbkRhdGEgPSBvbkRhdGE7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuLyoqXG4gKiBvbkRhdGEgaXMgYWRhcHRlZCBmcm9tIE5vZGUuanMnIGV2ZW50cy5vbiBoZWxwZXJcbiAqIGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvZXZlbnRzLmh0bWwjZXZlbnRzb25lbWl0dGVyLWV2ZW50bmFtZS1vcHRpb25zXG4gKlxuICogUmV0dXJucyBhbiBBc3luY0l0ZXJhdG9yIHRoYXQgaXRlcmF0ZXMgZWFjaCAnZGF0YScgZXZlbnQgZW1pdHRlZCBmcm9tIGVtaXR0ZXIuXG4gKiBJdCB3aWxsIHJlamVjdCB1cG9uIGFuIGVycm9yIGV2ZW50LlxuICovXG5mdW5jdGlvbiBvbkRhdGEoZW1pdHRlciwgeyB0aW1lb3V0Q29udGV4dCwgc2lnbmFsIH0pIHtcbiAgICBzaWduYWw/LnRocm93SWZBYm9ydGVkKCk7XG4gICAgLy8gU2V0dXAgcGVuZGluZyBldmVudHMgYW5kIHBlbmRpbmcgcHJvbWlzZSBsaXN0c1xuICAgIC8qKlxuICAgICAqIFdoZW4gdGhlIGNhbGxlciBoYXMgbm90IHlldCBjYWxsZWQgLm5leHQoKSwgd2Ugc3RvcmUgdGhlXG4gICAgICogdmFsdWUgZnJvbSB0aGUgZXZlbnQgaW4gdGhpcyBsaXN0LiBOZXh0IHRpbWUgdGhleSBjYWxsIC5uZXh0KClcbiAgICAgKiB3ZSBwdWxsIHRoZSBmaXJzdCB2YWx1ZSBvdXQgb2YgdGhpcyBsaXN0IGFuZCByZXNvbHZlIGEgcHJvbWlzZSB3aXRoIGl0LlxuICAgICAqL1xuICAgIGNvbnN0IHVuY29uc3VtZWRFdmVudHMgPSBuZXcgdXRpbHNfMS5MaXN0KCk7XG4gICAgLyoqXG4gICAgICogV2hlbiB0aGVyZSBoYXMgbm90IHlldCBiZWVuIGFuIGV2ZW50LCBhIG5ldyBwcm9taXNlIHdpbGwgYmUgY3JlYXRlZFxuICAgICAqIGFuZCBpbXBsaWNpdGx5IHN0b3JlZCBpbiB0aGlzIGxpc3QuIFdoZW4gYW4gZXZlbnQgb2NjdXJzIHdlIHRha2UgdGhlIGZpcnN0XG4gICAgICogcHJvbWlzZSBpbiB0aGlzIGxpc3QgYW5kIHJlc29sdmUgaXQuXG4gICAgICovXG4gICAgY29uc3QgdW5jb25zdW1lZFByb21pc2VzID0gbmV3IHV0aWxzXzEuTGlzdCgpO1xuICAgIC8qKlxuICAgICAqIFN0b3JlZCBhbiBlcnJvciBjcmVhdGVkIGJ5IGFuIGVycm9yIGV2ZW50LlxuICAgICAqIFRoaXMgZXJyb3Igd2lsbCB0dXJuIGludG8gYSByZWplY3Rpb24gZm9yIHRoZSBzdWJzZXF1ZW50IC5uZXh0KCkgY2FsbFxuICAgICAqL1xuICAgIGxldCBlcnJvciA9IG51bGw7XG4gICAgLyoqIFNldCB0byB0cnVlIG9ubHkgYWZ0ZXIgZXZlbnQgbGlzdGVuZXJzIGhhdmUgYmVlbiByZW1vdmVkLiAqL1xuICAgIGxldCBmaW5pc2hlZCA9IGZhbHNlO1xuICAgIGNvbnN0IGl0ZXJhdG9yID0ge1xuICAgICAgICBuZXh0KCkge1xuICAgICAgICAgICAgLy8gRmlyc3QsIHdlIGNvbnN1bWUgYWxsIHVucmVhZCBldmVudHNcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdW5jb25zdW1lZEV2ZW50cy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgdmFsdWUsIGRvbmU6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhlbiB3ZSBlcnJvciwgaWYgYW4gZXJyb3IgaGFwcGVuZWRcbiAgICAgICAgICAgIC8vIFRoaXMgaGFwcGVucyBvbmUgdGltZSBpZiBhdCBhbGwsIGJlY2F1c2UgYWZ0ZXIgJ2Vycm9yJ1xuICAgICAgICAgICAgLy8gd2Ugc3RvcCBsaXN0ZW5pbmdcbiAgICAgICAgICAgIGlmIChlcnJvciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IHRoZSBmaXJzdCBlbGVtZW50IGVycm9yc1xuICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBpdGVyYXRvciBpcyBmaW5pc2hlZCwgcmVzb2x2ZSB0byBkb25lXG4gICAgICAgICAgICBpZiAoZmluaXNoZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb3NlSGFuZGxlcigpO1xuICAgICAgICAgICAgLy8gV2FpdCB1bnRpbCBhbiBldmVudCBoYXBwZW5zXG4gICAgICAgICAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmUsIHJlamVjdCB9ID0gKDAsIHV0aWxzXzEucHJvbWlzZVdpdGhSZXNvbHZlcnMpKCk7XG4gICAgICAgICAgICB1bmNvbnN1bWVkUHJvbWlzZXMucHVzaCh7IHJlc29sdmUsIHJlamVjdCB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9LFxuICAgICAgICByZXR1cm4oKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xvc2VIYW5kbGVyKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRocm93KGVycikge1xuICAgICAgICAgICAgZXJyb3JIYW5kbGVyKGVycik7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvLyBBZGRpbmcgZXZlbnQgaGFuZGxlcnNcbiAgICBlbWl0dGVyLm9uKCdkYXRhJywgZXZlbnRIYW5kbGVyKTtcbiAgICBlbWl0dGVyLm9uKCdlcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgY29uc3QgYWJvcnRMaXN0ZW5lciA9ICgwLCB1dGlsc18xLmFkZEFib3J0TGlzdGVuZXIpKHNpZ25hbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBlcnJvckhhbmRsZXIodGhpcy5yZWFzb24pO1xuICAgIH0pO1xuICAgIGNvbnN0IHRpbWVvdXRGb3JTb2NrZXRSZWFkID0gdGltZW91dENvbnRleHQ/LnRpbWVvdXRGb3JTb2NrZXRSZWFkO1xuICAgIHRpbWVvdXRGb3JTb2NrZXRSZWFkPy50aHJvd0lmRXhwaXJlZCgpO1xuICAgIHRpbWVvdXRGb3JTb2NrZXRSZWFkPy50aGVuKHVuZGVmaW5lZCwgZXJyb3JIYW5kbGVyKTtcbiAgICByZXR1cm4gaXRlcmF0b3I7XG4gICAgZnVuY3Rpb24gZXZlbnRIYW5kbGVyKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB1bmNvbnN1bWVkUHJvbWlzZXMuc2hpZnQoKTtcbiAgICAgICAgaWYgKHByb21pc2UgIT0gbnVsbClcbiAgICAgICAgICAgIHByb21pc2UucmVzb2x2ZSh7IHZhbHVlLCBkb25lOiBmYWxzZSB9KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdW5jb25zdW1lZEV2ZW50cy5wdXNoKHZhbHVlKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGVycikge1xuICAgICAgICBjb25zdCBwcm9taXNlID0gdW5jb25zdW1lZFByb21pc2VzLnNoaWZ0KCk7XG4gICAgICAgIGlmIChwcm9taXNlICE9IG51bGwpXG4gICAgICAgICAgICBwcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBlcnJvciA9IGVycjtcbiAgICAgICAgdm9pZCBjbG9zZUhhbmRsZXIoKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY2xvc2VIYW5kbGVyKCkge1xuICAgICAgICAvLyBBZGRpbmcgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgZW1pdHRlci5vZmYoJ2RhdGEnLCBldmVudEhhbmRsZXIpO1xuICAgICAgICBlbWl0dGVyLm9mZignZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICBhYm9ydExpc3RlbmVyPy5bdXRpbHNfMS5rRGlzcG9zZV0oKTtcbiAgICAgICAgZmluaXNoZWQgPSB0cnVlO1xuICAgICAgICB0aW1lb3V0Rm9yU29ja2V0UmVhZD8uY2xlYXIoKTtcbiAgICAgICAgY29uc3QgZG9uZVJlc3VsdCA9IHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogZmluaXNoZWQgfTtcbiAgICAgICAgZm9yIChjb25zdCBwcm9taXNlIG9mIHVuY29uc3VtZWRQcm9taXNlcykge1xuICAgICAgICAgICAgcHJvbWlzZS5yZXNvbHZlKGRvbmVSZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZG9uZVJlc3VsdCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9b25fZGF0YS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_data.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_demand/document.js":
/*!*************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_demand/document.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OnDemandDocument = void 0;\nconst bson_1 = __webpack_require__(/*! ../../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\n/** @internal */\nclass OnDemandDocument {\n    constructor(\n    /** BSON bytes, this document begins at offset */\n    bson, \n    /** The start of the document */\n    offset = 0, \n    /** If this is an embedded document, indicates if this was a BSON array */\n    isArray = false, \n    /** If elements was already calculated */\n    elements) {\n        this.bson = bson;\n        this.offset = offset;\n        this.isArray = isArray;\n        /**\n         * Maps JS strings to elements and jsValues for speeding up subsequent lookups.\n         * - If `false` then name does not exist in the BSON document\n         * - If `CachedBSONElement` instance name exists\n         * - If `cache[name].value == null` jsValue has not yet been parsed\n         *   - Null/Undefined values do not get cached because they are zero-length values.\n         */\n        this.cache = Object.create(null);\n        /** Caches the index of elements that have been named */\n        this.indexFound = Object.create(null);\n        this.elements = elements ?? (0, bson_1.parseToElementsToArray)(this.bson, offset);\n    }\n    /** Only supports basic latin strings */\n    isElementName(name, element) {\n        const nameLength = element[2 /* BSONElementOffset.nameLength */];\n        const nameOffset = element[1 /* BSONElementOffset.nameOffset */];\n        if (name.length !== nameLength)\n            return false;\n        const nameEnd = nameOffset + nameLength;\n        for (let byteIndex = nameOffset, charIndex = 0; charIndex < name.length && byteIndex < nameEnd; charIndex++, byteIndex++) {\n            if (this.bson[byteIndex] !== name.charCodeAt(charIndex))\n                return false;\n        }\n        return true;\n    }\n    /**\n     * Seeks into the elements array for an element matching the given name.\n     *\n     * @remarks\n     * Caching:\n     * - Caches the existence of a property making subsequent look ups for non-existent properties return immediately\n     * - Caches names mapped to elements to avoid reiterating the array and comparing the name again\n     * - Caches the index at which an element has been found to prevent rechecking against elements already determined to belong to another name\n     *\n     * @param name - a basic latin string name of a BSON element\n     * @returns\n     */\n    getElement(name) {\n        const cachedElement = this.cache[name];\n        if (cachedElement === false)\n            return null;\n        if (cachedElement != null) {\n            return cachedElement;\n        }\n        if (typeof name === 'number') {\n            if (this.isArray) {\n                if (name < this.elements.length) {\n                    const element = this.elements[name];\n                    const cachedElement = { element, value: undefined };\n                    this.cache[name] = cachedElement;\n                    this.indexFound[name] = true;\n                    return cachedElement;\n                }\n                else {\n                    return null;\n                }\n            }\n            else {\n                return null;\n            }\n        }\n        for (let index = 0; index < this.elements.length; index++) {\n            const element = this.elements[index];\n            // skip this element if it has already been associated with a name\n            if (!(index in this.indexFound) && this.isElementName(name, element)) {\n                const cachedElement = { element, value: undefined };\n                this.cache[name] = cachedElement;\n                this.indexFound[index] = true;\n                return cachedElement;\n            }\n        }\n        this.cache[name] = false;\n        return null;\n    }\n    toJSValue(element, as) {\n        const type = element[0 /* BSONElementOffset.type */];\n        const offset = element[3 /* BSONElementOffset.offset */];\n        const length = element[4 /* BSONElementOffset.length */];\n        if (as !== type) {\n            return null;\n        }\n        switch (as) {\n            case bson_1.BSONType.null:\n            case bson_1.BSONType.undefined:\n                return null;\n            case bson_1.BSONType.double:\n                return (0, bson_1.getFloat64LE)(this.bson, offset);\n            case bson_1.BSONType.int:\n                return (0, bson_1.getInt32LE)(this.bson, offset);\n            case bson_1.BSONType.long:\n                return (0, bson_1.getBigInt64LE)(this.bson, offset);\n            case bson_1.BSONType.bool:\n                return Boolean(this.bson[offset]);\n            case bson_1.BSONType.objectId:\n                return new bson_1.ObjectId(this.bson.subarray(offset, offset + 12));\n            case bson_1.BSONType.timestamp:\n                return new bson_1.Timestamp((0, bson_1.getBigInt64LE)(this.bson, offset));\n            case bson_1.BSONType.string:\n                return (0, bson_1.toUTF8)(this.bson, offset + 4, offset + length - 1, false);\n            case bson_1.BSONType.binData: {\n                const totalBinarySize = (0, bson_1.getInt32LE)(this.bson, offset);\n                const subType = this.bson[offset + 4];\n                if (subType === 2) {\n                    const subType2BinarySize = (0, bson_1.getInt32LE)(this.bson, offset + 1 + 4);\n                    if (subType2BinarySize < 0)\n                        throw new bson_1.BSONError('Negative binary type element size found for subtype 0x02');\n                    if (subType2BinarySize > totalBinarySize - 4)\n                        throw new bson_1.BSONError('Binary type with subtype 0x02 contains too long binary size');\n                    if (subType2BinarySize < totalBinarySize - 4)\n                        throw new bson_1.BSONError('Binary type with subtype 0x02 contains too short binary size');\n                    return new bson_1.Binary(this.bson.subarray(offset + 1 + 4 + 4, offset + 1 + 4 + 4 + subType2BinarySize), 2);\n                }\n                return new bson_1.Binary(this.bson.subarray(offset + 1 + 4, offset + 1 + 4 + totalBinarySize), subType);\n            }\n            case bson_1.BSONType.date:\n                // Pretend this is correct.\n                return new Date(Number((0, bson_1.getBigInt64LE)(this.bson, offset)));\n            case bson_1.BSONType.object:\n                return new OnDemandDocument(this.bson, offset);\n            case bson_1.BSONType.array:\n                return new OnDemandDocument(this.bson, offset, true);\n            default:\n                throw new bson_1.BSONError(`Unsupported BSON type: ${as}`);\n        }\n    }\n    /**\n     * Returns the number of elements in this BSON document\n     */\n    size() {\n        return this.elements.length;\n    }\n    /**\n     * Checks for the existence of an element by name.\n     *\n     * @remarks\n     * Uses `getElement` with the expectation that will populate caches such that a `has` call\n     * followed by a `getElement` call will not repeat the cost paid by the first look up.\n     *\n     * @param name - element name\n     */\n    has(name) {\n        const cachedElement = this.cache[name];\n        if (cachedElement === false)\n            return false;\n        if (cachedElement != null)\n            return true;\n        return this.getElement(name) != null;\n    }\n    get(name, as, required) {\n        const element = this.getElement(name);\n        if (element == null) {\n            if (required === true) {\n                throw new bson_1.BSONError(`BSON element \"${name}\" is missing`);\n            }\n            else {\n                return null;\n            }\n        }\n        if (element.value == null) {\n            const value = this.toJSValue(element.element, as);\n            if (value == null) {\n                if (required === true) {\n                    throw new bson_1.BSONError(`BSON element \"${name}\" is missing`);\n                }\n                else {\n                    return null;\n                }\n            }\n            // It is important to never store null\n            element.value = value;\n        }\n        return element.value;\n    }\n    getNumber(name, required) {\n        const maybeBool = this.get(name, bson_1.BSONType.bool);\n        const bool = maybeBool == null ? null : maybeBool ? 1 : 0;\n        const maybeLong = this.get(name, bson_1.BSONType.long);\n        const long = maybeLong == null ? null : Number(maybeLong);\n        const result = bool ?? long ?? this.get(name, bson_1.BSONType.int) ?? this.get(name, bson_1.BSONType.double);\n        if (required === true && result == null) {\n            throw new bson_1.BSONError(`BSON element \"${name}\" is missing`);\n        }\n        return result;\n    }\n    /**\n     * Deserialize this object, DOES NOT cache result so avoid multiple invocations\n     * @param options - BSON deserialization options\n     */\n    toObject(options) {\n        return (0, bson_1.deserialize)(this.bson, {\n            ...options,\n            index: this.offset,\n            allowObjectSmallerThanBufferSize: true\n        });\n    }\n    /** Returns this document's bytes only */\n    toBytes() {\n        const size = (0, bson_1.getInt32LE)(this.bson, this.offset);\n        return this.bson.subarray(this.offset, this.offset + size);\n    }\n}\nexports.OnDemandDocument = OnDemandDocument;\n//# sourceMappingURL=document.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9vbl9kZW1hbmQvZG9jdW1lbnQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLGVBQWUsbUJBQU8sQ0FBQyxpR0FBZTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0QsZ0RBQWdEO0FBQ3hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw4QkFBOEI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRUFBcUUsR0FBRztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELEtBQUs7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLEtBQUs7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCxLQUFLO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9vbl9kZW1hbmQvZG9jdW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk9uRGVtYW5kRG9jdW1lbnQgPSB2b2lkIDA7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vYnNvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIE9uRGVtYW5kRG9jdW1lbnQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBCU09OIGJ5dGVzLCB0aGlzIGRvY3VtZW50IGJlZ2lucyBhdCBvZmZzZXQgKi9cbiAgICBic29uLCBcbiAgICAvKiogVGhlIHN0YXJ0IG9mIHRoZSBkb2N1bWVudCAqL1xuICAgIG9mZnNldCA9IDAsIFxuICAgIC8qKiBJZiB0aGlzIGlzIGFuIGVtYmVkZGVkIGRvY3VtZW50LCBpbmRpY2F0ZXMgaWYgdGhpcyB3YXMgYSBCU09OIGFycmF5ICovXG4gICAgaXNBcnJheSA9IGZhbHNlLCBcbiAgICAvKiogSWYgZWxlbWVudHMgd2FzIGFscmVhZHkgY2FsY3VsYXRlZCAqL1xuICAgIGVsZW1lbnRzKSB7XG4gICAgICAgIHRoaXMuYnNvbiA9IGJzb247XG4gICAgICAgIHRoaXMub2Zmc2V0ID0gb2Zmc2V0O1xuICAgICAgICB0aGlzLmlzQXJyYXkgPSBpc0FycmF5O1xuICAgICAgICAvKipcbiAgICAgICAgICogTWFwcyBKUyBzdHJpbmdzIHRvIGVsZW1lbnRzIGFuZCBqc1ZhbHVlcyBmb3Igc3BlZWRpbmcgdXAgc3Vic2VxdWVudCBsb29rdXBzLlxuICAgICAgICAgKiAtIElmIGBmYWxzZWAgdGhlbiBuYW1lIGRvZXMgbm90IGV4aXN0IGluIHRoZSBCU09OIGRvY3VtZW50XG4gICAgICAgICAqIC0gSWYgYENhY2hlZEJTT05FbGVtZW50YCBpbnN0YW5jZSBuYW1lIGV4aXN0c1xuICAgICAgICAgKiAtIElmIGBjYWNoZVtuYW1lXS52YWx1ZSA9PSBudWxsYCBqc1ZhbHVlIGhhcyBub3QgeWV0IGJlZW4gcGFyc2VkXG4gICAgICAgICAqICAgLSBOdWxsL1VuZGVmaW5lZCB2YWx1ZXMgZG8gbm90IGdldCBjYWNoZWQgYmVjYXVzZSB0aGV5IGFyZSB6ZXJvLWxlbmd0aCB2YWx1ZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgLyoqIENhY2hlcyB0aGUgaW5kZXggb2YgZWxlbWVudHMgdGhhdCBoYXZlIGJlZW4gbmFtZWQgKi9cbiAgICAgICAgdGhpcy5pbmRleEZvdW5kID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzID8/ICgwLCBic29uXzEucGFyc2VUb0VsZW1lbnRzVG9BcnJheSkodGhpcy5ic29uLCBvZmZzZXQpO1xuICAgIH1cbiAgICAvKiogT25seSBzdXBwb3J0cyBiYXNpYyBsYXRpbiBzdHJpbmdzICovXG4gICAgaXNFbGVtZW50TmFtZShuYW1lLCBlbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IG5hbWVMZW5ndGggPSBlbGVtZW50WzIgLyogQlNPTkVsZW1lbnRPZmZzZXQubmFtZUxlbmd0aCAqL107XG4gICAgICAgIGNvbnN0IG5hbWVPZmZzZXQgPSBlbGVtZW50WzEgLyogQlNPTkVsZW1lbnRPZmZzZXQubmFtZU9mZnNldCAqL107XG4gICAgICAgIGlmIChuYW1lLmxlbmd0aCAhPT0gbmFtZUxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgbmFtZUVuZCA9IG5hbWVPZmZzZXQgKyBuYW1lTGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBieXRlSW5kZXggPSBuYW1lT2Zmc2V0LCBjaGFySW5kZXggPSAwOyBjaGFySW5kZXggPCBuYW1lLmxlbmd0aCAmJiBieXRlSW5kZXggPCBuYW1lRW5kOyBjaGFySW5kZXgrKywgYnl0ZUluZGV4KyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJzb25bYnl0ZUluZGV4XSAhPT0gbmFtZS5jaGFyQ29kZUF0KGNoYXJJbmRleCkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZWVrcyBpbnRvIHRoZSBlbGVtZW50cyBhcnJheSBmb3IgYW4gZWxlbWVudCBtYXRjaGluZyB0aGUgZ2l2ZW4gbmFtZS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogQ2FjaGluZzpcbiAgICAgKiAtIENhY2hlcyB0aGUgZXhpc3RlbmNlIG9mIGEgcHJvcGVydHkgbWFraW5nIHN1YnNlcXVlbnQgbG9vayB1cHMgZm9yIG5vbi1leGlzdGVudCBwcm9wZXJ0aWVzIHJldHVybiBpbW1lZGlhdGVseVxuICAgICAqIC0gQ2FjaGVzIG5hbWVzIG1hcHBlZCB0byBlbGVtZW50cyB0byBhdm9pZCByZWl0ZXJhdGluZyB0aGUgYXJyYXkgYW5kIGNvbXBhcmluZyB0aGUgbmFtZSBhZ2FpblxuICAgICAqIC0gQ2FjaGVzIHRoZSBpbmRleCBhdCB3aGljaCBhbiBlbGVtZW50IGhhcyBiZWVuIGZvdW5kIHRvIHByZXZlbnQgcmVjaGVja2luZyBhZ2FpbnN0IGVsZW1lbnRzIGFscmVhZHkgZGV0ZXJtaW5lZCB0byBiZWxvbmcgdG8gYW5vdGhlciBuYW1lXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIGEgYmFzaWMgbGF0aW4gc3RyaW5nIG5hbWUgb2YgYSBCU09OIGVsZW1lbnRcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIGdldEVsZW1lbnQobmFtZSkge1xuICAgICAgICBjb25zdCBjYWNoZWRFbGVtZW50ID0gdGhpcy5jYWNoZVtuYW1lXTtcbiAgICAgICAgaWYgKGNhY2hlZEVsZW1lbnQgPT09IGZhbHNlKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmIChjYWNoZWRFbGVtZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRFbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQXJyYXkpIHtcbiAgICAgICAgICAgICAgICBpZiAobmFtZSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmVsZW1lbnRzW25hbWVdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZWRFbGVtZW50ID0geyBlbGVtZW50LCB2YWx1ZTogdW5kZWZpbmVkIH07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FjaGVbbmFtZV0gPSBjYWNoZWRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Rm91bmRbbmFtZV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkRWxlbWVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudHNbaW5kZXhdO1xuICAgICAgICAgICAgLy8gc2tpcCB0aGlzIGVsZW1lbnQgaWYgaXQgaGFzIGFscmVhZHkgYmVlbiBhc3NvY2lhdGVkIHdpdGggYSBuYW1lXG4gICAgICAgICAgICBpZiAoIShpbmRleCBpbiB0aGlzLmluZGV4Rm91bmQpICYmIHRoaXMuaXNFbGVtZW50TmFtZShuYW1lLCBlbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlZEVsZW1lbnQgPSB7IGVsZW1lbnQsIHZhbHVlOiB1bmRlZmluZWQgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlW25hbWVdID0gY2FjaGVkRWxlbWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4Rm91bmRbaW5kZXhdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkRWxlbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhY2hlW25hbWVdID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB0b0pTVmFsdWUoZWxlbWVudCwgYXMpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IGVsZW1lbnRbMCAvKiBCU09ORWxlbWVudE9mZnNldC50eXBlICovXTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZWxlbWVudFszIC8qIEJTT05FbGVtZW50T2Zmc2V0Lm9mZnNldCAqL107XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IGVsZW1lbnRbNCAvKiBCU09ORWxlbWVudE9mZnNldC5sZW5ndGggKi9dO1xuICAgICAgICBpZiAoYXMgIT09IHR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoYXMpIHtcbiAgICAgICAgICAgIGNhc2UgYnNvbl8xLkJTT05UeXBlLm51bGw6XG4gICAgICAgICAgICBjYXNlIGJzb25fMS5CU09OVHlwZS51bmRlZmluZWQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBjYXNlIGJzb25fMS5CU09OVHlwZS5kb3VibGU6XG4gICAgICAgICAgICAgICAgcmV0dXJuICgwLCBic29uXzEuZ2V0RmxvYXQ2NExFKSh0aGlzLmJzb24sIG9mZnNldCk7XG4gICAgICAgICAgICBjYXNlIGJzb25fMS5CU09OVHlwZS5pbnQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICgwLCBic29uXzEuZ2V0SW50MzJMRSkodGhpcy5ic29uLCBvZmZzZXQpO1xuICAgICAgICAgICAgY2FzZSBic29uXzEuQlNPTlR5cGUubG9uZzpcbiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIGJzb25fMS5nZXRCaWdJbnQ2NExFKSh0aGlzLmJzb24sIG9mZnNldCk7XG4gICAgICAgICAgICBjYXNlIGJzb25fMS5CU09OVHlwZS5ib29sOlxuICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuKHRoaXMuYnNvbltvZmZzZXRdKTtcbiAgICAgICAgICAgIGNhc2UgYnNvbl8xLkJTT05UeXBlLm9iamVjdElkOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgYnNvbl8xLk9iamVjdElkKHRoaXMuYnNvbi5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIDEyKSk7XG4gICAgICAgICAgICBjYXNlIGJzb25fMS5CU09OVHlwZS50aW1lc3RhbXA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBic29uXzEuVGltZXN0YW1wKCgwLCBic29uXzEuZ2V0QmlnSW50NjRMRSkodGhpcy5ic29uLCBvZmZzZXQpKTtcbiAgICAgICAgICAgIGNhc2UgYnNvbl8xLkJTT05UeXBlLnN0cmluZzpcbiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIGJzb25fMS50b1VURjgpKHRoaXMuYnNvbiwgb2Zmc2V0ICsgNCwgb2Zmc2V0ICsgbGVuZ3RoIC0gMSwgZmFsc2UpO1xuICAgICAgICAgICAgY2FzZSBic29uXzEuQlNPTlR5cGUuYmluRGF0YToge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsQmluYXJ5U2l6ZSA9ICgwLCBic29uXzEuZ2V0SW50MzJMRSkodGhpcy5ic29uLCBvZmZzZXQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YlR5cGUgPSB0aGlzLmJzb25bb2Zmc2V0ICsgNF07XG4gICAgICAgICAgICAgICAgaWYgKHN1YlR5cGUgPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViVHlwZTJCaW5hcnlTaXplID0gKDAsIGJzb25fMS5nZXRJbnQzMkxFKSh0aGlzLmJzb24sIG9mZnNldCArIDEgKyA0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlR5cGUyQmluYXJ5U2l6ZSA8IDApXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgYnNvbl8xLkJTT05FcnJvcignTmVnYXRpdmUgYmluYXJ5IHR5cGUgZWxlbWVudCBzaXplIGZvdW5kIGZvciBzdWJ0eXBlIDB4MDInKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlR5cGUyQmluYXJ5U2l6ZSA+IHRvdGFsQmluYXJ5U2l6ZSAtIDQpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgYnNvbl8xLkJTT05FcnJvcignQmluYXJ5IHR5cGUgd2l0aCBzdWJ0eXBlIDB4MDIgY29udGFpbnMgdG9vIGxvbmcgYmluYXJ5IHNpemUnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlR5cGUyQmluYXJ5U2l6ZSA8IHRvdGFsQmluYXJ5U2l6ZSAtIDQpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgYnNvbl8xLkJTT05FcnJvcignQmluYXJ5IHR5cGUgd2l0aCBzdWJ0eXBlIDB4MDIgY29udGFpbnMgdG9vIHNob3J0IGJpbmFyeSBzaXplJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgYnNvbl8xLkJpbmFyeSh0aGlzLmJzb24uc3ViYXJyYXkob2Zmc2V0ICsgMSArIDQgKyA0LCBvZmZzZXQgKyAxICsgNCArIDQgKyBzdWJUeXBlMkJpbmFyeVNpemUpLCAyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBic29uXzEuQmluYXJ5KHRoaXMuYnNvbi5zdWJhcnJheShvZmZzZXQgKyAxICsgNCwgb2Zmc2V0ICsgMSArIDQgKyB0b3RhbEJpbmFyeVNpemUpLCBzdWJUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgYnNvbl8xLkJTT05UeXBlLmRhdGU6XG4gICAgICAgICAgICAgICAgLy8gUHJldGVuZCB0aGlzIGlzIGNvcnJlY3QuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKE51bWJlcigoMCwgYnNvbl8xLmdldEJpZ0ludDY0TEUpKHRoaXMuYnNvbiwgb2Zmc2V0KSkpO1xuICAgICAgICAgICAgY2FzZSBic29uXzEuQlNPTlR5cGUub2JqZWN0OlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT25EZW1hbmREb2N1bWVudCh0aGlzLmJzb24sIG9mZnNldCk7XG4gICAgICAgICAgICBjYXNlIGJzb25fMS5CU09OVHlwZS5hcnJheTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9uRGVtYW5kRG9jdW1lbnQodGhpcy5ic29uLCBvZmZzZXQsIHRydWUpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgYnNvbl8xLkJTT05FcnJvcihgVW5zdXBwb3J0ZWQgQlNPTiB0eXBlOiAke2FzfWApO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGlzIEJTT04gZG9jdW1lbnRcbiAgICAgKi9cbiAgICBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50cy5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoZWNrcyBmb3IgdGhlIGV4aXN0ZW5jZSBvZiBhbiBlbGVtZW50IGJ5IG5hbWUuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFVzZXMgYGdldEVsZW1lbnRgIHdpdGggdGhlIGV4cGVjdGF0aW9uIHRoYXQgd2lsbCBwb3B1bGF0ZSBjYWNoZXMgc3VjaCB0aGF0IGEgYGhhc2AgY2FsbFxuICAgICAqIGZvbGxvd2VkIGJ5IGEgYGdldEVsZW1lbnRgIGNhbGwgd2lsbCBub3QgcmVwZWF0IHRoZSBjb3N0IHBhaWQgYnkgdGhlIGZpcnN0IGxvb2sgdXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIGVsZW1lbnQgbmFtZVxuICAgICAqL1xuICAgIGhhcyhuYW1lKSB7XG4gICAgICAgIGNvbnN0IGNhY2hlZEVsZW1lbnQgPSB0aGlzLmNhY2hlW25hbWVdO1xuICAgICAgICBpZiAoY2FjaGVkRWxlbWVudCA9PT0gZmFsc2UpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChjYWNoZWRFbGVtZW50ICE9IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudChuYW1lKSAhPSBudWxsO1xuICAgIH1cbiAgICBnZXQobmFtZSwgYXMsIHJlcXVpcmVkKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQobmFtZSk7XG4gICAgICAgIGlmIChlbGVtZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChyZXF1aXJlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBic29uXzEuQlNPTkVycm9yKGBCU09OIGVsZW1lbnQgXCIke25hbWV9XCIgaXMgbWlzc2luZ2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnQudmFsdWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnRvSlNWYWx1ZShlbGVtZW50LmVsZW1lbnQsIGFzKTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVkID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBic29uXzEuQlNPTkVycm9yKGBCU09OIGVsZW1lbnQgXCIke25hbWV9XCIgaXMgbWlzc2luZ2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSXQgaXMgaW1wb3J0YW50IHRvIG5ldmVyIHN0b3JlIG51bGxcbiAgICAgICAgICAgIGVsZW1lbnQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZWxlbWVudC52YWx1ZTtcbiAgICB9XG4gICAgZ2V0TnVtYmVyKG5hbWUsIHJlcXVpcmVkKSB7XG4gICAgICAgIGNvbnN0IG1heWJlQm9vbCA9IHRoaXMuZ2V0KG5hbWUsIGJzb25fMS5CU09OVHlwZS5ib29sKTtcbiAgICAgICAgY29uc3QgYm9vbCA9IG1heWJlQm9vbCA9PSBudWxsID8gbnVsbCA6IG1heWJlQm9vbCA/IDEgOiAwO1xuICAgICAgICBjb25zdCBtYXliZUxvbmcgPSB0aGlzLmdldChuYW1lLCBic29uXzEuQlNPTlR5cGUubG9uZyk7XG4gICAgICAgIGNvbnN0IGxvbmcgPSBtYXliZUxvbmcgPT0gbnVsbCA/IG51bGwgOiBOdW1iZXIobWF5YmVMb25nKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYm9vbCA/PyBsb25nID8/IHRoaXMuZ2V0KG5hbWUsIGJzb25fMS5CU09OVHlwZS5pbnQpID8/IHRoaXMuZ2V0KG5hbWUsIGJzb25fMS5CU09OVHlwZS5kb3VibGUpO1xuICAgICAgICBpZiAocmVxdWlyZWQgPT09IHRydWUgJiYgcmVzdWx0ID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBic29uXzEuQlNPTkVycm9yKGBCU09OIGVsZW1lbnQgXCIke25hbWV9XCIgaXMgbWlzc2luZ2ApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlc2VyaWFsaXplIHRoaXMgb2JqZWN0LCBET0VTIE5PVCBjYWNoZSByZXN1bHQgc28gYXZvaWQgbXVsdGlwbGUgaW52b2NhdGlvbnNcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEJTT04gZGVzZXJpYWxpemF0aW9uIG9wdGlvbnNcbiAgICAgKi9cbiAgICB0b09iamVjdChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiAoMCwgYnNvbl8xLmRlc2VyaWFsaXplKSh0aGlzLmJzb24sIHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBpbmRleDogdGhpcy5vZmZzZXQsXG4gICAgICAgICAgICBhbGxvd09iamVjdFNtYWxsZXJUaGFuQnVmZmVyU2l6ZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhpcyBkb2N1bWVudCdzIGJ5dGVzIG9ubHkgKi9cbiAgICB0b0J5dGVzKCkge1xuICAgICAgICBjb25zdCBzaXplID0gKDAsIGJzb25fMS5nZXRJbnQzMkxFKSh0aGlzLmJzb24sIHRoaXMub2Zmc2V0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnNvbi5zdWJhcnJheSh0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyBzaXplKTtcbiAgICB9XG59XG5leHBvcnRzLk9uRGVtYW5kRG9jdW1lbnQgPSBPbkRlbWFuZERvY3VtZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZG9jdW1lbnQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_demand/document.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ClientBulkWriteCursorResponse = exports.ExplainedCursorResponse = exports.CursorResponse = exports.MongoDBResponse = void 0;\nexports.isErrorResponse = isErrorResponse;\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst document_1 = __webpack_require__(/*! ./on_demand/document */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/on_demand/document.js\");\n/**\n * Accepts a BSON payload and checks for na \"ok: 0\" element.\n * This utility is intended to prevent calling response class constructors\n * that expect the result to be a success and demand certain properties to exist.\n *\n * For example, a cursor response always expects a cursor embedded document.\n * In order to write the class such that the properties reflect that assertion (non-null)\n * we cannot invoke the subclass constructor if the BSON represents an error.\n *\n * @param bytes - BSON document returned from the server\n */\nfunction isErrorResponse(bson, elements) {\n    for (let eIdx = 0; eIdx < elements.length; eIdx++) {\n        const element = elements[eIdx];\n        if (element[2 /* BSONElementOffset.nameLength */] === 2) {\n            const nameOffset = element[1 /* BSONElementOffset.nameOffset */];\n            // 111 == \"o\", 107 == \"k\"\n            if (bson[nameOffset] === 111 && bson[nameOffset + 1] === 107) {\n                const valueOffset = element[3 /* BSONElementOffset.offset */];\n                const valueLength = element[4 /* BSONElementOffset.length */];\n                // If any byte in the length of the ok number (works for any type) is non zero,\n                // then it is considered \"ok: 1\"\n                for (let i = valueOffset; i < valueOffset + valueLength; i++) {\n                    if (bson[i] !== 0x00)\n                        return false;\n                }\n                return true;\n            }\n        }\n    }\n    return true;\n}\n/** @internal */\nclass MongoDBResponse extends document_1.OnDemandDocument {\n    get(name, as, required) {\n        try {\n            return super.get(name, as, required);\n        }\n        catch (cause) {\n            throw new error_1.MongoUnexpectedServerResponseError(cause.message, { cause });\n        }\n    }\n    static is(value) {\n        return value instanceof MongoDBResponse;\n    }\n    static make(bson) {\n        const elements = (0, bson_1.parseToElementsToArray)(bson, 0);\n        const isError = isErrorResponse(bson, elements);\n        return isError\n            ? new MongoDBResponse(bson, 0, false, elements)\n            : new this(bson, 0, false, elements);\n    }\n    /**\n     * Returns true iff:\n     * - ok is 0 and the top-level code === 50\n     * - ok is 1 and the writeErrors array contains a code === 50\n     * - ok is 1 and the writeConcern object contains a code === 50\n     */\n    get isMaxTimeExpiredError() {\n        // {ok: 0, code: 50 ... }\n        const isTopLevel = this.ok === 0 && this.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired;\n        if (isTopLevel)\n            return true;\n        if (this.ok === 0)\n            return false;\n        // {ok: 1, writeConcernError: {code: 50 ... }}\n        const isWriteConcern = this.get('writeConcernError', bson_1.BSONType.object)?.getNumber('code') ===\n            error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired;\n        if (isWriteConcern)\n            return true;\n        const writeErrors = this.get('writeErrors', bson_1.BSONType.array);\n        if (writeErrors?.size()) {\n            for (let i = 0; i < writeErrors.size(); i++) {\n                const isWriteError = writeErrors.get(i, bson_1.BSONType.object)?.getNumber('code') ===\n                    error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired;\n                // {ok: 1, writeErrors: [{code: 50 ... }]}\n                if (isWriteError)\n                    return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Drivers can safely assume that the `recoveryToken` field is always a BSON document but drivers MUST NOT modify the\n     * contents of the document.\n     */\n    get recoveryToken() {\n        return (this.get('recoveryToken', bson_1.BSONType.object)?.toObject({\n            promoteValues: false,\n            promoteLongs: false,\n            promoteBuffers: false,\n            validation: { utf8: true }\n        }) ?? null);\n    }\n    /**\n     * The server creates a cursor in response to a snapshot find/aggregate command and reports atClusterTime within the cursor field in the response.\n     * For the distinct command the server adds a top-level atClusterTime field to the response.\n     * The atClusterTime field represents the timestamp of the read and is guaranteed to be majority committed.\n     */\n    get atClusterTime() {\n        return (this.get('cursor', bson_1.BSONType.object)?.get('atClusterTime', bson_1.BSONType.timestamp) ??\n            this.get('atClusterTime', bson_1.BSONType.timestamp));\n    }\n    get operationTime() {\n        return this.get('operationTime', bson_1.BSONType.timestamp);\n    }\n    /** Normalizes whatever BSON value is \"ok\" to a JS number 1 or 0. */\n    get ok() {\n        return this.getNumber('ok') ? 1 : 0;\n    }\n    get $err() {\n        return this.get('$err', bson_1.BSONType.string);\n    }\n    get errmsg() {\n        return this.get('errmsg', bson_1.BSONType.string);\n    }\n    get code() {\n        return this.getNumber('code');\n    }\n    get $clusterTime() {\n        if (!('clusterTime' in this)) {\n            const clusterTimeDoc = this.get('$clusterTime', bson_1.BSONType.object);\n            if (clusterTimeDoc == null) {\n                this.clusterTime = null;\n                return null;\n            }\n            const clusterTime = clusterTimeDoc.get('clusterTime', bson_1.BSONType.timestamp, true);\n            const signature = clusterTimeDoc.get('signature', bson_1.BSONType.object)?.toObject();\n            // @ts-expect-error: `signature` is incorrectly typed. It is public API.\n            this.clusterTime = { clusterTime, signature };\n        }\n        return this.clusterTime ?? null;\n    }\n    toObject(options) {\n        const exactBSONOptions = {\n            ...(0, bson_1.pluckBSONSerializeOptions)(options ?? {}),\n            validation: (0, bson_1.parseUtf8ValidationOption)(options)\n        };\n        return super.toObject(exactBSONOptions);\n    }\n}\nexports.MongoDBResponse = MongoDBResponse;\n// {ok:1}\nMongoDBResponse.empty = new MongoDBResponse(new Uint8Array([13, 0, 0, 0, 16, 111, 107, 0, 1, 0, 0, 0, 0]));\n/** @internal */\nclass CursorResponse extends MongoDBResponse {\n    constructor() {\n        super(...arguments);\n        this._batch = null;\n        this.iterated = 0;\n        this._encryptedBatch = null;\n    }\n    /**\n     * This supports a feature of the FindCursor.\n     * It is an optimization to avoid an extra getMore when the limit has been reached\n     */\n    static get emptyGetMore() {\n        return new CursorResponse((0, bson_1.serialize)({ ok: 1, cursor: { id: 0n, nextBatch: [] } }));\n    }\n    static is(value) {\n        return value instanceof CursorResponse || value === CursorResponse.emptyGetMore;\n    }\n    get cursor() {\n        return this.get('cursor', bson_1.BSONType.object, true);\n    }\n    get id() {\n        try {\n            return bson_1.Long.fromBigInt(this.cursor.get('id', bson_1.BSONType.long, true));\n        }\n        catch (cause) {\n            throw new error_1.MongoUnexpectedServerResponseError(cause.message, { cause });\n        }\n    }\n    get ns() {\n        const namespace = this.cursor.get('ns', bson_1.BSONType.string);\n        if (namespace != null)\n            return (0, utils_1.ns)(namespace);\n        return null;\n    }\n    get length() {\n        return Math.max(this.batchSize - this.iterated, 0);\n    }\n    get encryptedBatch() {\n        if (this.encryptedResponse == null)\n            return null;\n        if (this._encryptedBatch != null)\n            return this._encryptedBatch;\n        const cursor = this.encryptedResponse?.get('cursor', bson_1.BSONType.object);\n        if (cursor?.has('firstBatch'))\n            this._encryptedBatch = cursor.get('firstBatch', bson_1.BSONType.array, true);\n        else if (cursor?.has('nextBatch'))\n            this._encryptedBatch = cursor.get('nextBatch', bson_1.BSONType.array, true);\n        else\n            throw new error_1.MongoUnexpectedServerResponseError('Cursor document did not contain a batch');\n        return this._encryptedBatch;\n    }\n    get batch() {\n        if (this._batch != null)\n            return this._batch;\n        const cursor = this.cursor;\n        if (cursor.has('firstBatch'))\n            this._batch = cursor.get('firstBatch', bson_1.BSONType.array, true);\n        else if (cursor.has('nextBatch'))\n            this._batch = cursor.get('nextBatch', bson_1.BSONType.array, true);\n        else\n            throw new error_1.MongoUnexpectedServerResponseError('Cursor document did not contain a batch');\n        return this._batch;\n    }\n    get batchSize() {\n        return this.batch?.size();\n    }\n    get postBatchResumeToken() {\n        return (this.cursor.get('postBatchResumeToken', bson_1.BSONType.object)?.toObject({\n            promoteValues: false,\n            promoteLongs: false,\n            promoteBuffers: false,\n            validation: { utf8: true }\n        }) ?? null);\n    }\n    shift(options) {\n        if (this.iterated >= this.batchSize) {\n            return null;\n        }\n        const result = this.batch.get(this.iterated, bson_1.BSONType.object, true) ?? null;\n        const encryptedResult = this.encryptedBatch?.get(this.iterated, bson_1.BSONType.object, true) ?? null;\n        this.iterated += 1;\n        if (options?.raw) {\n            return result.toBytes();\n        }\n        else {\n            const object = result.toObject(options);\n            if (encryptedResult) {\n                (0, utils_1.decorateDecryptionResult)(object, encryptedResult.toObject(options), true);\n            }\n            return object;\n        }\n    }\n    clear() {\n        this.iterated = this.batchSize;\n    }\n}\nexports.CursorResponse = CursorResponse;\n/**\n * Explain responses have nothing to do with cursor responses\n * This class serves to temporarily avoid refactoring how cursors handle\n * explain responses which is to detect that the response is not cursor-like and return the explain\n * result as the \"first and only\" document in the \"batch\" and end the \"cursor\"\n */\nclass ExplainedCursorResponse extends CursorResponse {\n    constructor() {\n        super(...arguments);\n        this.isExplain = true;\n        this._length = 1;\n    }\n    get id() {\n        return bson_1.Long.fromBigInt(0n);\n    }\n    get batchSize() {\n        return 0;\n    }\n    get ns() {\n        return null;\n    }\n    get length() {\n        return this._length;\n    }\n    shift(options) {\n        if (this._length === 0)\n            return null;\n        this._length -= 1;\n        return this.toObject(options);\n    }\n}\nexports.ExplainedCursorResponse = ExplainedCursorResponse;\n/**\n * Client bulk writes have some extra metadata at the top level that needs to be\n * included in the result returned to the user.\n */\nclass ClientBulkWriteCursorResponse extends CursorResponse {\n    get insertedCount() {\n        return this.get('nInserted', bson_1.BSONType.int, true);\n    }\n    get upsertedCount() {\n        return this.get('nUpserted', bson_1.BSONType.int, true);\n    }\n    get matchedCount() {\n        return this.get('nMatched', bson_1.BSONType.int, true);\n    }\n    get modifiedCount() {\n        return this.get('nModified', bson_1.BSONType.int, true);\n    }\n    get deletedCount() {\n        return this.get('nDeleted', bson_1.BSONType.int, true);\n    }\n    get writeConcernError() {\n        return this.get('writeConcernError', bson_1.BSONType.object, false);\n    }\n}\nexports.ClientBulkWriteCursorResponse = ClientBulkWriteCursorResponse;\n//# sourceMappingURL=responses.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9yZXNwb25zZXMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QscUNBQXFDLEdBQUcsK0JBQStCLEdBQUcsc0JBQXNCLEdBQUcsdUJBQXVCO0FBQzFILHVCQUF1QjtBQUN2QixlQUFlLG1CQUFPLENBQUMsOEZBQVk7QUFDbkMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsbUJBQW1CLG1CQUFPLENBQUMseUlBQXNCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix3QkFBd0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLCtCQUErQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRixPQUFPO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDJCQUEyQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsd0JBQXdCO0FBQ3BEO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCLGNBQWM7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRTtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELGlCQUFpQix5QkFBeUI7QUFDcEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0ZBQWtGLE9BQU87QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQyIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9yZXNwb25zZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNsaWVudEJ1bGtXcml0ZUN1cnNvclJlc3BvbnNlID0gZXhwb3J0cy5FeHBsYWluZWRDdXJzb3JSZXNwb25zZSA9IGV4cG9ydHMuQ3Vyc29yUmVzcG9uc2UgPSBleHBvcnRzLk1vbmdvREJSZXNwb25zZSA9IHZvaWQgMDtcbmV4cG9ydHMuaXNFcnJvclJlc3BvbnNlID0gaXNFcnJvclJlc3BvbnNlO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uLy4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsc1wiKTtcbmNvbnN0IGRvY3VtZW50XzEgPSByZXF1aXJlKFwiLi9vbl9kZW1hbmQvZG9jdW1lbnRcIik7XG4vKipcbiAqIEFjY2VwdHMgYSBCU09OIHBheWxvYWQgYW5kIGNoZWNrcyBmb3IgbmEgXCJvazogMFwiIGVsZW1lbnQuXG4gKiBUaGlzIHV0aWxpdHkgaXMgaW50ZW5kZWQgdG8gcHJldmVudCBjYWxsaW5nIHJlc3BvbnNlIGNsYXNzIGNvbnN0cnVjdG9yc1xuICogdGhhdCBleHBlY3QgdGhlIHJlc3VsdCB0byBiZSBhIHN1Y2Nlc3MgYW5kIGRlbWFuZCBjZXJ0YWluIHByb3BlcnRpZXMgdG8gZXhpc3QuXG4gKlxuICogRm9yIGV4YW1wbGUsIGEgY3Vyc29yIHJlc3BvbnNlIGFsd2F5cyBleHBlY3RzIGEgY3Vyc29yIGVtYmVkZGVkIGRvY3VtZW50LlxuICogSW4gb3JkZXIgdG8gd3JpdGUgdGhlIGNsYXNzIHN1Y2ggdGhhdCB0aGUgcHJvcGVydGllcyByZWZsZWN0IHRoYXQgYXNzZXJ0aW9uIChub24tbnVsbClcbiAqIHdlIGNhbm5vdCBpbnZva2UgdGhlIHN1YmNsYXNzIGNvbnN0cnVjdG9yIGlmIHRoZSBCU09OIHJlcHJlc2VudHMgYW4gZXJyb3IuXG4gKlxuICogQHBhcmFtIGJ5dGVzIC0gQlNPTiBkb2N1bWVudCByZXR1cm5lZCBmcm9tIHRoZSBzZXJ2ZXJcbiAqL1xuZnVuY3Rpb24gaXNFcnJvclJlc3BvbnNlKGJzb24sIGVsZW1lbnRzKSB7XG4gICAgZm9yIChsZXQgZUlkeCA9IDA7IGVJZHggPCBlbGVtZW50cy5sZW5ndGg7IGVJZHgrKykge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gZWxlbWVudHNbZUlkeF07XG4gICAgICAgIGlmIChlbGVtZW50WzIgLyogQlNPTkVsZW1lbnRPZmZzZXQubmFtZUxlbmd0aCAqL10gPT09IDIpIHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWVPZmZzZXQgPSBlbGVtZW50WzEgLyogQlNPTkVsZW1lbnRPZmZzZXQubmFtZU9mZnNldCAqL107XG4gICAgICAgICAgICAvLyAxMTEgPT0gXCJvXCIsIDEwNyA9PSBcImtcIlxuICAgICAgICAgICAgaWYgKGJzb25bbmFtZU9mZnNldF0gPT09IDExMSAmJiBic29uW25hbWVPZmZzZXQgKyAxXSA9PT0gMTA3KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVPZmZzZXQgPSBlbGVtZW50WzMgLyogQlNPTkVsZW1lbnRPZmZzZXQub2Zmc2V0ICovXTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZUxlbmd0aCA9IGVsZW1lbnRbNCAvKiBCU09ORWxlbWVudE9mZnNldC5sZW5ndGggKi9dO1xuICAgICAgICAgICAgICAgIC8vIElmIGFueSBieXRlIGluIHRoZSBsZW5ndGggb2YgdGhlIG9rIG51bWJlciAod29ya3MgZm9yIGFueSB0eXBlKSBpcyBub24gemVybyxcbiAgICAgICAgICAgICAgICAvLyB0aGVuIGl0IGlzIGNvbnNpZGVyZWQgXCJvazogMVwiXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHZhbHVlT2Zmc2V0OyBpIDwgdmFsdWVPZmZzZXQgKyB2YWx1ZUxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChic29uW2ldICE9PSAweDAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIE1vbmdvREJSZXNwb25zZSBleHRlbmRzIGRvY3VtZW50XzEuT25EZW1hbmREb2N1bWVudCB7XG4gICAgZ2V0KG5hbWUsIGFzLCByZXF1aXJlZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldChuYW1lLCBhcywgcmVxdWlyZWQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvcihjYXVzZS5tZXNzYWdlLCB7IGNhdXNlIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBpcyh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBNb25nb0RCUmVzcG9uc2U7XG4gICAgfVxuICAgIHN0YXRpYyBtYWtlKGJzb24pIHtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSAoMCwgYnNvbl8xLnBhcnNlVG9FbGVtZW50c1RvQXJyYXkpKGJzb24sIDApO1xuICAgICAgICBjb25zdCBpc0Vycm9yID0gaXNFcnJvclJlc3BvbnNlKGJzb24sIGVsZW1lbnRzKTtcbiAgICAgICAgcmV0dXJuIGlzRXJyb3JcbiAgICAgICAgICAgID8gbmV3IE1vbmdvREJSZXNwb25zZShic29uLCAwLCBmYWxzZSwgZWxlbWVudHMpXG4gICAgICAgICAgICA6IG5ldyB0aGlzKGJzb24sIDAsIGZhbHNlLCBlbGVtZW50cyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZmY6XG4gICAgICogLSBvayBpcyAwIGFuZCB0aGUgdG9wLWxldmVsIGNvZGUgPT09IDUwXG4gICAgICogLSBvayBpcyAxIGFuZCB0aGUgd3JpdGVFcnJvcnMgYXJyYXkgY29udGFpbnMgYSBjb2RlID09PSA1MFxuICAgICAqIC0gb2sgaXMgMSBhbmQgdGhlIHdyaXRlQ29uY2VybiBvYmplY3QgY29udGFpbnMgYSBjb2RlID09PSA1MFxuICAgICAqL1xuICAgIGdldCBpc01heFRpbWVFeHBpcmVkRXJyb3IoKSB7XG4gICAgICAgIC8vIHtvazogMCwgY29kZTogNTAgLi4uIH1cbiAgICAgICAgY29uc3QgaXNUb3BMZXZlbCA9IHRoaXMub2sgPT09IDAgJiYgdGhpcy5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTWF4VGltZU1TRXhwaXJlZDtcbiAgICAgICAgaWYgKGlzVG9wTGV2ZWwpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMub2sgPT09IDApXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIC8vIHtvazogMSwgd3JpdGVDb25jZXJuRXJyb3I6IHtjb2RlOiA1MCAuLi4gfX1cbiAgICAgICAgY29uc3QgaXNXcml0ZUNvbmNlcm4gPSB0aGlzLmdldCgnd3JpdGVDb25jZXJuRXJyb3InLCBic29uXzEuQlNPTlR5cGUub2JqZWN0KT8uZ2V0TnVtYmVyKCdjb2RlJykgPT09XG4gICAgICAgICAgICBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTWF4VGltZU1TRXhwaXJlZDtcbiAgICAgICAgaWYgKGlzV3JpdGVDb25jZXJuKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGNvbnN0IHdyaXRlRXJyb3JzID0gdGhpcy5nZXQoJ3dyaXRlRXJyb3JzJywgYnNvbl8xLkJTT05UeXBlLmFycmF5KTtcbiAgICAgICAgaWYgKHdyaXRlRXJyb3JzPy5zaXplKCkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd3JpdGVFcnJvcnMuc2l6ZSgpOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1dyaXRlRXJyb3IgPSB3cml0ZUVycm9ycy5nZXQoaSwgYnNvbl8xLkJTT05UeXBlLm9iamVjdCk/LmdldE51bWJlcignY29kZScpID09PVxuICAgICAgICAgICAgICAgICAgICBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTWF4VGltZU1TRXhwaXJlZDtcbiAgICAgICAgICAgICAgICAvLyB7b2s6IDEsIHdyaXRlRXJyb3JzOiBbe2NvZGU6IDUwIC4uLiB9XX1cbiAgICAgICAgICAgICAgICBpZiAoaXNXcml0ZUVycm9yKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERyaXZlcnMgY2FuIHNhZmVseSBhc3N1bWUgdGhhdCB0aGUgYHJlY292ZXJ5VG9rZW5gIGZpZWxkIGlzIGFsd2F5cyBhIEJTT04gZG9jdW1lbnQgYnV0IGRyaXZlcnMgTVVTVCBOT1QgbW9kaWZ5IHRoZVxuICAgICAqIGNvbnRlbnRzIG9mIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICBnZXQgcmVjb3ZlcnlUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdldCgncmVjb3ZlcnlUb2tlbicsIGJzb25fMS5CU09OVHlwZS5vYmplY3QpPy50b09iamVjdCh7XG4gICAgICAgICAgICBwcm9tb3RlVmFsdWVzOiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVMb25nczogZmFsc2UsXG4gICAgICAgICAgICBwcm9tb3RlQnVmZmVyczogZmFsc2UsXG4gICAgICAgICAgICB2YWxpZGF0aW9uOiB7IHV0Zjg6IHRydWUgfVxuICAgICAgICB9KSA/PyBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIHNlcnZlciBjcmVhdGVzIGEgY3Vyc29yIGluIHJlc3BvbnNlIHRvIGEgc25hcHNob3QgZmluZC9hZ2dyZWdhdGUgY29tbWFuZCBhbmQgcmVwb3J0cyBhdENsdXN0ZXJUaW1lIHdpdGhpbiB0aGUgY3Vyc29yIGZpZWxkIGluIHRoZSByZXNwb25zZS5cbiAgICAgKiBGb3IgdGhlIGRpc3RpbmN0IGNvbW1hbmQgdGhlIHNlcnZlciBhZGRzIGEgdG9wLWxldmVsIGF0Q2x1c3RlclRpbWUgZmllbGQgdG8gdGhlIHJlc3BvbnNlLlxuICAgICAqIFRoZSBhdENsdXN0ZXJUaW1lIGZpZWxkIHJlcHJlc2VudHMgdGhlIHRpbWVzdGFtcCBvZiB0aGUgcmVhZCBhbmQgaXMgZ3VhcmFudGVlZCB0byBiZSBtYWpvcml0eSBjb21taXR0ZWQuXG4gICAgICovXG4gICAgZ2V0IGF0Q2x1c3RlclRpbWUoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5nZXQoJ2N1cnNvcicsIGJzb25fMS5CU09OVHlwZS5vYmplY3QpPy5nZXQoJ2F0Q2x1c3RlclRpbWUnLCBic29uXzEuQlNPTlR5cGUudGltZXN0YW1wKSA/P1xuICAgICAgICAgICAgdGhpcy5nZXQoJ2F0Q2x1c3RlclRpbWUnLCBic29uXzEuQlNPTlR5cGUudGltZXN0YW1wKSk7XG4gICAgfVxuICAgIGdldCBvcGVyYXRpb25UaW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ29wZXJhdGlvblRpbWUnLCBic29uXzEuQlNPTlR5cGUudGltZXN0YW1wKTtcbiAgICB9XG4gICAgLyoqIE5vcm1hbGl6ZXMgd2hhdGV2ZXIgQlNPTiB2YWx1ZSBpcyBcIm9rXCIgdG8gYSBKUyBudW1iZXIgMSBvciAwLiAqL1xuICAgIGdldCBvaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TnVtYmVyKCdvaycpID8gMSA6IDA7XG4gICAgfVxuICAgIGdldCAkZXJyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoJyRlcnInLCBic29uXzEuQlNPTlR5cGUuc3RyaW5nKTtcbiAgICB9XG4gICAgZ2V0IGVycm1zZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdlcnJtc2cnLCBic29uXzEuQlNPTlR5cGUuc3RyaW5nKTtcbiAgICB9XG4gICAgZ2V0IGNvZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE51bWJlcignY29kZScpO1xuICAgIH1cbiAgICBnZXQgJGNsdXN0ZXJUaW1lKCkge1xuICAgICAgICBpZiAoISgnY2x1c3RlclRpbWUnIGluIHRoaXMpKSB7XG4gICAgICAgICAgICBjb25zdCBjbHVzdGVyVGltZURvYyA9IHRoaXMuZ2V0KCckY2x1c3RlclRpbWUnLCBic29uXzEuQlNPTlR5cGUub2JqZWN0KTtcbiAgICAgICAgICAgIGlmIChjbHVzdGVyVGltZURvYyA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyVGltZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjbHVzdGVyVGltZSA9IGNsdXN0ZXJUaW1lRG9jLmdldCgnY2x1c3RlclRpbWUnLCBic29uXzEuQlNPTlR5cGUudGltZXN0YW1wLCB0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IHNpZ25hdHVyZSA9IGNsdXN0ZXJUaW1lRG9jLmdldCgnc2lnbmF0dXJlJywgYnNvbl8xLkJTT05UeXBlLm9iamVjdCk/LnRvT2JqZWN0KCk7XG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yOiBgc2lnbmF0dXJlYCBpcyBpbmNvcnJlY3RseSB0eXBlZC4gSXQgaXMgcHVibGljIEFQSS5cbiAgICAgICAgICAgIHRoaXMuY2x1c3RlclRpbWUgPSB7IGNsdXN0ZXJUaW1lLCBzaWduYXR1cmUgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jbHVzdGVyVGltZSA/PyBudWxsO1xuICAgIH1cbiAgICB0b09iamVjdChvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGV4YWN0QlNPTk9wdGlvbnMgPSB7XG4gICAgICAgICAgICAuLi4oMCwgYnNvbl8xLnBsdWNrQlNPTlNlcmlhbGl6ZU9wdGlvbnMpKG9wdGlvbnMgPz8ge30pLFxuICAgICAgICAgICAgdmFsaWRhdGlvbjogKDAsIGJzb25fMS5wYXJzZVV0ZjhWYWxpZGF0aW9uT3B0aW9uKShvcHRpb25zKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gc3VwZXIudG9PYmplY3QoZXhhY3RCU09OT3B0aW9ucyk7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0RCUmVzcG9uc2UgPSBNb25nb0RCUmVzcG9uc2U7XG4vLyB7b2s6MX1cbk1vbmdvREJSZXNwb25zZS5lbXB0eSA9IG5ldyBNb25nb0RCUmVzcG9uc2UobmV3IFVpbnQ4QXJyYXkoWzEzLCAwLCAwLCAwLCAxNiwgMTExLCAxMDcsIDAsIDEsIDAsIDAsIDAsIDBdKSk7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDdXJzb3JSZXNwb25zZSBleHRlbmRzIE1vbmdvREJSZXNwb25zZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMuX2JhdGNoID0gbnVsbDtcbiAgICAgICAgdGhpcy5pdGVyYXRlZCA9IDA7XG4gICAgICAgIHRoaXMuX2VuY3J5cHRlZEJhdGNoID0gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBzdXBwb3J0cyBhIGZlYXR1cmUgb2YgdGhlIEZpbmRDdXJzb3IuXG4gICAgICogSXQgaXMgYW4gb3B0aW1pemF0aW9uIHRvIGF2b2lkIGFuIGV4dHJhIGdldE1vcmUgd2hlbiB0aGUgbGltaXQgaGFzIGJlZW4gcmVhY2hlZFxuICAgICAqL1xuICAgIHN0YXRpYyBnZXQgZW1wdHlHZXRNb3JlKCkge1xuICAgICAgICByZXR1cm4gbmV3IEN1cnNvclJlc3BvbnNlKCgwLCBic29uXzEuc2VyaWFsaXplKSh7IG9rOiAxLCBjdXJzb3I6IHsgaWQ6IDBuLCBuZXh0QmF0Y2g6IFtdIH0gfSkpO1xuICAgIH1cbiAgICBzdGF0aWMgaXModmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgQ3Vyc29yUmVzcG9uc2UgfHwgdmFsdWUgPT09IEN1cnNvclJlc3BvbnNlLmVtcHR5R2V0TW9yZTtcbiAgICB9XG4gICAgZ2V0IGN1cnNvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdjdXJzb3InLCBic29uXzEuQlNPTlR5cGUub2JqZWN0LCB0cnVlKTtcbiAgICB9XG4gICAgZ2V0IGlkKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGJzb25fMS5Mb25nLmZyb21CaWdJbnQodGhpcy5jdXJzb3IuZ2V0KCdpZCcsIGJzb25fMS5CU09OVHlwZS5sb25nLCB0cnVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGNhdXNlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKGNhdXNlLm1lc3NhZ2UsIHsgY2F1c2UgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG5zKCkge1xuICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmN1cnNvci5nZXQoJ25zJywgYnNvbl8xLkJTT05UeXBlLnN0cmluZyk7XG4gICAgICAgIGlmIChuYW1lc3BhY2UgIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiAoMCwgdXRpbHNfMS5ucykobmFtZXNwYWNlKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heCh0aGlzLmJhdGNoU2l6ZSAtIHRoaXMuaXRlcmF0ZWQsIDApO1xuICAgIH1cbiAgICBnZXQgZW5jcnlwdGVkQmF0Y2goKSB7XG4gICAgICAgIGlmICh0aGlzLmVuY3J5cHRlZFJlc3BvbnNlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuX2VuY3J5cHRlZEJhdGNoICE9IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5jcnlwdGVkQmF0Y2g7XG4gICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuZW5jcnlwdGVkUmVzcG9uc2U/LmdldCgnY3Vyc29yJywgYnNvbl8xLkJTT05UeXBlLm9iamVjdCk7XG4gICAgICAgIGlmIChjdXJzb3I/LmhhcygnZmlyc3RCYXRjaCcpKVxuICAgICAgICAgICAgdGhpcy5fZW5jcnlwdGVkQmF0Y2ggPSBjdXJzb3IuZ2V0KCdmaXJzdEJhdGNoJywgYnNvbl8xLkJTT05UeXBlLmFycmF5LCB0cnVlKTtcbiAgICAgICAgZWxzZSBpZiAoY3Vyc29yPy5oYXMoJ25leHRCYXRjaCcpKVxuICAgICAgICAgICAgdGhpcy5fZW5jcnlwdGVkQmF0Y2ggPSBjdXJzb3IuZ2V0KCduZXh0QmF0Y2gnLCBic29uXzEuQlNPTlR5cGUuYXJyYXksIHRydWUpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKCdDdXJzb3IgZG9jdW1lbnQgZGlkIG5vdCBjb250YWluIGEgYmF0Y2gnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuY3J5cHRlZEJhdGNoO1xuICAgIH1cbiAgICBnZXQgYmF0Y2goKSB7XG4gICAgICAgIGlmICh0aGlzLl9iYXRjaCAhPSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JhdGNoO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmN1cnNvcjtcbiAgICAgICAgaWYgKGN1cnNvci5oYXMoJ2ZpcnN0QmF0Y2gnKSlcbiAgICAgICAgICAgIHRoaXMuX2JhdGNoID0gY3Vyc29yLmdldCgnZmlyc3RCYXRjaCcsIGJzb25fMS5CU09OVHlwZS5hcnJheSwgdHJ1ZSk7XG4gICAgICAgIGVsc2UgaWYgKGN1cnNvci5oYXMoJ25leHRCYXRjaCcpKVxuICAgICAgICAgICAgdGhpcy5fYmF0Y2ggPSBjdXJzb3IuZ2V0KCduZXh0QmF0Y2gnLCBic29uXzEuQlNPTlR5cGUuYXJyYXksIHRydWUpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKCdDdXJzb3IgZG9jdW1lbnQgZGlkIG5vdCBjb250YWluIGEgYmF0Y2gnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JhdGNoO1xuICAgIH1cbiAgICBnZXQgYmF0Y2hTaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXRjaD8uc2l6ZSgpO1xuICAgIH1cbiAgICBnZXQgcG9zdEJhdGNoUmVzdW1lVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5jdXJzb3IuZ2V0KCdwb3N0QmF0Y2hSZXN1bWVUb2tlbicsIGJzb25fMS5CU09OVHlwZS5vYmplY3QpPy50b09iamVjdCh7XG4gICAgICAgICAgICBwcm9tb3RlVmFsdWVzOiBmYWxzZSxcbiAgICAgICAgICAgIHByb21vdGVMb25nczogZmFsc2UsXG4gICAgICAgICAgICBwcm9tb3RlQnVmZmVyczogZmFsc2UsXG4gICAgICAgICAgICB2YWxpZGF0aW9uOiB7IHV0Zjg6IHRydWUgfVxuICAgICAgICB9KSA/PyBudWxsKTtcbiAgICB9XG4gICAgc2hpZnQob3B0aW9ucykge1xuICAgICAgICBpZiAodGhpcy5pdGVyYXRlZCA+PSB0aGlzLmJhdGNoU2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5iYXRjaC5nZXQodGhpcy5pdGVyYXRlZCwgYnNvbl8xLkJTT05UeXBlLm9iamVjdCwgdHJ1ZSkgPz8gbnVsbDtcbiAgICAgICAgY29uc3QgZW5jcnlwdGVkUmVzdWx0ID0gdGhpcy5lbmNyeXB0ZWRCYXRjaD8uZ2V0KHRoaXMuaXRlcmF0ZWQsIGJzb25fMS5CU09OVHlwZS5vYmplY3QsIHRydWUpID8/IG51bGw7XG4gICAgICAgIHRoaXMuaXRlcmF0ZWQgKz0gMTtcbiAgICAgICAgaWYgKG9wdGlvbnM/LnJhdykge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50b0J5dGVzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBvYmplY3QgPSByZXN1bHQudG9PYmplY3Qob3B0aW9ucyk7XG4gICAgICAgICAgICBpZiAoZW5jcnlwdGVkUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgKDAsIHV0aWxzXzEuZGVjb3JhdGVEZWNyeXB0aW9uUmVzdWx0KShvYmplY3QsIGVuY3J5cHRlZFJlc3VsdC50b09iamVjdChvcHRpb25zKSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLml0ZXJhdGVkID0gdGhpcy5iYXRjaFNpemU7XG4gICAgfVxufVxuZXhwb3J0cy5DdXJzb3JSZXNwb25zZSA9IEN1cnNvclJlc3BvbnNlO1xuLyoqXG4gKiBFeHBsYWluIHJlc3BvbnNlcyBoYXZlIG5vdGhpbmcgdG8gZG8gd2l0aCBjdXJzb3IgcmVzcG9uc2VzXG4gKiBUaGlzIGNsYXNzIHNlcnZlcyB0byB0ZW1wb3JhcmlseSBhdm9pZCByZWZhY3RvcmluZyBob3cgY3Vyc29ycyBoYW5kbGVcbiAqIGV4cGxhaW4gcmVzcG9uc2VzIHdoaWNoIGlzIHRvIGRldGVjdCB0aGF0IHRoZSByZXNwb25zZSBpcyBub3QgY3Vyc29yLWxpa2UgYW5kIHJldHVybiB0aGUgZXhwbGFpblxuICogcmVzdWx0IGFzIHRoZSBcImZpcnN0IGFuZCBvbmx5XCIgZG9jdW1lbnQgaW4gdGhlIFwiYmF0Y2hcIiBhbmQgZW5kIHRoZSBcImN1cnNvclwiXG4gKi9cbmNsYXNzIEV4cGxhaW5lZEN1cnNvclJlc3BvbnNlIGV4dGVuZHMgQ3Vyc29yUmVzcG9uc2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmlzRXhwbGFpbiA9IHRydWU7XG4gICAgICAgIHRoaXMuX2xlbmd0aCA9IDE7XG4gICAgfVxuICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIGJzb25fMS5Mb25nLmZyb21CaWdJbnQoMG4pO1xuICAgIH1cbiAgICBnZXQgYmF0Y2hTaXplKCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgZ2V0IG5zKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZ2V0IGxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xlbmd0aDtcbiAgICB9XG4gICAgc2hpZnQob3B0aW9ucykge1xuICAgICAgICBpZiAodGhpcy5fbGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIHRoaXMuX2xlbmd0aCAtPSAxO1xuICAgICAgICByZXR1cm4gdGhpcy50b09iamVjdChvcHRpb25zKTtcbiAgICB9XG59XG5leHBvcnRzLkV4cGxhaW5lZEN1cnNvclJlc3BvbnNlID0gRXhwbGFpbmVkQ3Vyc29yUmVzcG9uc2U7XG4vKipcbiAqIENsaWVudCBidWxrIHdyaXRlcyBoYXZlIHNvbWUgZXh0cmEgbWV0YWRhdGEgYXQgdGhlIHRvcCBsZXZlbCB0aGF0IG5lZWRzIHRvIGJlXG4gKiBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0IHJldHVybmVkIHRvIHRoZSB1c2VyLlxuICovXG5jbGFzcyBDbGllbnRCdWxrV3JpdGVDdXJzb3JSZXNwb25zZSBleHRlbmRzIEN1cnNvclJlc3BvbnNlIHtcbiAgICBnZXQgaW5zZXJ0ZWRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCduSW5zZXJ0ZWQnLCBic29uXzEuQlNPTlR5cGUuaW50LCB0cnVlKTtcbiAgICB9XG4gICAgZ2V0IHVwc2VydGVkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldCgnblVwc2VydGVkJywgYnNvbl8xLkJTT05UeXBlLmludCwgdHJ1ZSk7XG4gICAgfVxuICAgIGdldCBtYXRjaGVkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldCgnbk1hdGNoZWQnLCBic29uXzEuQlNPTlR5cGUuaW50LCB0cnVlKTtcbiAgICB9XG4gICAgZ2V0IG1vZGlmaWVkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldCgnbk1vZGlmaWVkJywgYnNvbl8xLkJTT05UeXBlLmludCwgdHJ1ZSk7XG4gICAgfVxuICAgIGdldCBkZWxldGVkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldCgnbkRlbGV0ZWQnLCBic29uXzEuQlNPTlR5cGUuaW50LCB0cnVlKTtcbiAgICB9XG4gICAgZ2V0IHdyaXRlQ29uY2VybkVycm9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ3dyaXRlQ29uY2VybkVycm9yJywgYnNvbl8xLkJTT05UeXBlLm9iamVjdCwgZmFsc2UpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ2xpZW50QnVsa1dyaXRlQ3Vyc29yUmVzcG9uc2UgPSBDbGllbnRCdWxrV3JpdGVDdXJzb3JSZXNwb25zZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlc3BvbnNlcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/shared.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/shared.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.getReadPreference = getReadPreference;\nexports.isSharded = isSharded;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ../../sdam/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst topology_description_1 = __webpack_require__(/*! ../../sdam/topology_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology_description.js\");\nfunction getReadPreference(options) {\n    // Default to command version of the readPreference.\n    let readPreference = options?.readPreference ?? read_preference_1.ReadPreference.primary;\n    if (typeof readPreference === 'string') {\n        readPreference = read_preference_1.ReadPreference.fromString(readPreference);\n    }\n    if (!(readPreference instanceof read_preference_1.ReadPreference)) {\n        throw new error_1.MongoInvalidArgumentError('Option \"readPreference\" must be a ReadPreference instance');\n    }\n    return readPreference;\n}\nfunction isSharded(topologyOrServer) {\n    if (topologyOrServer == null) {\n        return false;\n    }\n    if (topologyOrServer.description && topologyOrServer.description.type === common_1.ServerType.Mongos) {\n        return true;\n    }\n    // NOTE: This is incredibly inefficient, and should be removed once command construction\n    // happens based on `Server` not `Topology`.\n    if (topologyOrServer.description && topologyOrServer.description instanceof topology_description_1.TopologyDescription) {\n        const servers = Array.from(topologyOrServer.description.servers.values());\n        return servers.some((server) => server.type === common_1.ServerType.Mongos);\n    }\n    return false;\n}\n//# sourceMappingURL=shared.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NtYXAvd2lyZV9wcm90b2NvbC9zaGFyZWQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QseUJBQXlCO0FBQ3pCLGlCQUFpQjtBQUNqQixnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQywwQkFBMEIsbUJBQU8sQ0FBQyxvSEFBdUI7QUFDekQsaUJBQWlCLG1CQUFPLENBQUMsNEdBQW1CO0FBQzVDLCtCQUErQixtQkFBTyxDQUFDLHdJQUFpQztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jbWFwL3dpcmVfcHJvdG9jb2wvc2hhcmVkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRSZWFkUHJlZmVyZW5jZSA9IGdldFJlYWRQcmVmZXJlbmNlO1xuZXhwb3J0cy5pc1NoYXJkZWQgPSBpc1NoYXJkZWQ7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2Vycm9yXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vc2RhbS9jb21tb25cIik7XG5jb25zdCB0b3BvbG9neV9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL3NkYW0vdG9wb2xvZ3lfZGVzY3JpcHRpb25cIik7XG5mdW5jdGlvbiBnZXRSZWFkUHJlZmVyZW5jZShvcHRpb25zKSB7XG4gICAgLy8gRGVmYXVsdCB0byBjb21tYW5kIHZlcnNpb24gb2YgdGhlIHJlYWRQcmVmZXJlbmNlLlxuICAgIGxldCByZWFkUHJlZmVyZW5jZSA9IG9wdGlvbnM/LnJlYWRQcmVmZXJlbmNlID8/IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnk7XG4gICAgaWYgKHR5cGVvZiByZWFkUHJlZmVyZW5jZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmVhZFByZWZlcmVuY2UgPSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tU3RyaW5nKHJlYWRQcmVmZXJlbmNlKTtcbiAgICB9XG4gICAgaWYgKCEocmVhZFByZWZlcmVuY2UgaW5zdGFuY2VvZiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3B0aW9uIFwicmVhZFByZWZlcmVuY2VcIiBtdXN0IGJlIGEgUmVhZFByZWZlcmVuY2UgaW5zdGFuY2UnKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlYWRQcmVmZXJlbmNlO1xufVxuZnVuY3Rpb24gaXNTaGFyZGVkKHRvcG9sb2d5T3JTZXJ2ZXIpIHtcbiAgICBpZiAodG9wb2xvZ3lPclNlcnZlciA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24gJiYgdG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLk1vbmdvcykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLy8gTk9URTogVGhpcyBpcyBpbmNyZWRpYmx5IGluZWZmaWNpZW50LCBhbmQgc2hvdWxkIGJlIHJlbW92ZWQgb25jZSBjb21tYW5kIGNvbnN0cnVjdGlvblxuICAgIC8vIGhhcHBlbnMgYmFzZWQgb24gYFNlcnZlcmAgbm90IGBUb3BvbG9neWAuXG4gICAgaWYgKHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24gJiYgdG9wb2xvZ3lPclNlcnZlci5kZXNjcmlwdGlvbiBpbnN0YW5jZW9mIHRvcG9sb2d5X2Rlc2NyaXB0aW9uXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbikge1xuICAgICAgICBjb25zdCBzZXJ2ZXJzID0gQXJyYXkuZnJvbSh0b3BvbG9neU9yU2VydmVyLmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgICAgICByZXR1cm4gc2VydmVycy5zb21lKChzZXJ2ZXIpID0+IHNlcnZlci50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLk1vbmdvcyk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNoYXJlZC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/shared.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Collection = void 0;\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst ordered_1 = __webpack_require__(/*! ./bulk/ordered */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/ordered.js\");\nconst unordered_1 = __webpack_require__(/*! ./bulk/unordered */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/unordered.js\");\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\");\nconst aggregation_cursor_1 = __webpack_require__(/*! ./cursor/aggregation_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\nconst find_cursor_1 = __webpack_require__(/*! ./cursor/find_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/find_cursor.js\");\nconst list_indexes_cursor_1 = __webpack_require__(/*! ./cursor/list_indexes_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_indexes_cursor.js\");\nconst list_search_indexes_cursor_1 = __webpack_require__(/*! ./cursor/list_search_indexes_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst bulk_write_1 = __webpack_require__(/*! ./operations/bulk_write */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/bulk_write.js\");\nconst count_1 = __webpack_require__(/*! ./operations/count */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/count.js\");\nconst delete_1 = __webpack_require__(/*! ./operations/delete */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/delete.js\");\nconst distinct_1 = __webpack_require__(/*! ./operations/distinct */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/distinct.js\");\nconst drop_1 = __webpack_require__(/*! ./operations/drop */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/drop.js\");\nconst estimated_document_count_1 = __webpack_require__(/*! ./operations/estimated_document_count */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/estimated_document_count.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst find_and_modify_1 = __webpack_require__(/*! ./operations/find_and_modify */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find_and_modify.js\");\nconst indexes_1 = __webpack_require__(/*! ./operations/indexes */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js\");\nconst insert_1 = __webpack_require__(/*! ./operations/insert */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/insert.js\");\nconst is_capped_1 = __webpack_require__(/*! ./operations/is_capped */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/is_capped.js\");\nconst options_operation_1 = __webpack_require__(/*! ./operations/options_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/options_operation.js\");\nconst rename_1 = __webpack_require__(/*! ./operations/rename */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/rename.js\");\nconst create_1 = __webpack_require__(/*! ./operations/search_indexes/create */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/create.js\");\nconst drop_2 = __webpack_require__(/*! ./operations/search_indexes/drop */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/drop.js\");\nconst update_1 = __webpack_require__(/*! ./operations/search_indexes/update */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/update.js\");\nconst update_2 = __webpack_require__(/*! ./operations/update */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/update.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\n/**\n * The **Collection** class is an internal class that embodies a MongoDB collection\n * allowing for insert/find/update/delete and other command operation on that MongoDB collection.\n *\n * **COLLECTION Cannot directly be instantiated**\n * @public\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * interface Pet {\n *   name: string;\n *   kind: 'dog' | 'cat' | 'fish';\n * }\n *\n * const client = new MongoClient('mongodb://localhost:27017');\n * const pets = client.db().collection<Pet>('pets');\n *\n * const petCursor = pets.find();\n *\n * for await (const pet of petCursor) {\n *   console.log(`${pet.name} is a ${pet.kind}!`);\n * }\n * ```\n */\nclass Collection {\n    /**\n     * Create a new Collection instance\n     * @internal\n     */\n    constructor(db, name, options) {\n        // Internal state\n        this.s = {\n            db,\n            options,\n            namespace: new utils_1.MongoDBCollectionNamespace(db.databaseName, name),\n            pkFactory: db.options?.pkFactory ?? utils_1.DEFAULT_PK_FACTORY,\n            readPreference: read_preference_1.ReadPreference.fromOptions(options),\n            bsonOptions: (0, bson_1.resolveBSONOptions)(options, db),\n            readConcern: read_concern_1.ReadConcern.fromOptions(options),\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options)\n        };\n        this.client = db.client;\n    }\n    /**\n     * The name of the database this collection belongs to\n     */\n    get dbName() {\n        return this.s.namespace.db;\n    }\n    /**\n     * The name of this collection\n     */\n    get collectionName() {\n        return this.s.namespace.collection;\n    }\n    /**\n     * The namespace of this collection, in the format `${this.dbName}.${this.collectionName}`\n     */\n    get namespace() {\n        return this.fullNamespace.toString();\n    }\n    /**\n     *  @internal\n     *\n     * The `MongoDBNamespace` for the collection.\n     */\n    get fullNamespace() {\n        return this.s.namespace;\n    }\n    /**\n     * The current readConcern of the collection. If not explicitly defined for\n     * this collection, will be inherited from the parent DB\n     */\n    get readConcern() {\n        if (this.s.readConcern == null) {\n            return this.s.db.readConcern;\n        }\n        return this.s.readConcern;\n    }\n    /**\n     * The current readPreference of the collection. If not explicitly defined for\n     * this collection, will be inherited from the parent DB\n     */\n    get readPreference() {\n        if (this.s.readPreference == null) {\n            return this.s.db.readPreference;\n        }\n        return this.s.readPreference;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    /**\n     * The current writeConcern of the collection. If not explicitly defined for\n     * this collection, will be inherited from the parent DB\n     */\n    get writeConcern() {\n        if (this.s.writeConcern == null) {\n            return this.s.db.writeConcern;\n        }\n        return this.s.writeConcern;\n    }\n    /** The current index hint for the collection */\n    get hint() {\n        return this.s.collectionHint;\n    }\n    set hint(v) {\n        this.s.collectionHint = (0, utils_1.normalizeHintField)(v);\n    }\n    get timeoutMS() {\n        return this.s.options.timeoutMS;\n    }\n    /**\n     * Inserts a single document into MongoDB. If documents passed in do not contain the **_id** field,\n     * one will be added to each of the documents missing it by the driver, mutating the document. This behavior\n     * can be overridden by setting the **forceServerObjectId** flag.\n     *\n     * @param doc - The document to insert\n     * @param options - Optional settings for the command\n     */\n    async insertOne(doc, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new insert_1.InsertOneOperation(this, doc, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Inserts an array of documents into MongoDB. If documents passed in do not contain the **_id** field,\n     * one will be added to each of the documents missing it by the driver, mutating the document. This behavior\n     * can be overridden by setting the **forceServerObjectId** flag.\n     *\n     * @param docs - The documents to insert\n     * @param options - Optional settings for the command\n     */\n    async insertMany(docs, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new insert_1.InsertManyOperation(this, docs, (0, utils_1.resolveOptions)(this, options ?? { ordered: true })));\n    }\n    /**\n     * Perform a bulkWrite operation without a fluent API\n     *\n     * Legal operation types are\n     * - `insertOne`\n     * - `replaceOne`\n     * - `updateOne`\n     * - `updateMany`\n     * - `deleteOne`\n     * - `deleteMany`\n     *\n     * If documents passed in do not contain the **_id** field,\n     * one will be added to each of the documents missing it by the driver, mutating the document. This behavior\n     * can be overridden by setting the **forceServerObjectId** flag.\n     *\n     * @param operations - Bulk operations to perform\n     * @param options - Optional settings for the command\n     * @throws MongoDriverError if operations is not an array\n     */\n    async bulkWrite(operations, options) {\n        if (!Array.isArray(operations)) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"operations\" must be an array of documents');\n        }\n        return await (0, execute_operation_1.executeOperation)(this.client, new bulk_write_1.BulkWriteOperation(this, operations, (0, utils_1.resolveOptions)(this, options ?? { ordered: true })));\n    }\n    /**\n     * Update a single document in a collection\n     *\n     * The value of `update` can be either:\n     * - UpdateFilter<TSchema> - A document that contains update operator expressions,\n     * - Document[] - an aggregation pipeline.\n     *\n     * @param filter - The filter used to select the document to update\n     * @param update - The modifications to apply\n     * @param options - Optional settings for the command\n     */\n    async updateOne(filter, update, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new update_2.UpdateOneOperation(this, filter, update, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Replace a document in a collection with another document\n     *\n     * @param filter - The filter used to select the document to replace\n     * @param replacement - The Document that replaces the matching document\n     * @param options - Optional settings for the command\n     */\n    async replaceOne(filter, replacement, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new update_2.ReplaceOneOperation(this, filter, replacement, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Update multiple documents in a collection\n     *\n     * The value of `update` can be either:\n     * - UpdateFilter<TSchema> - A document that contains update operator expressions,\n     * - Document[] - an aggregation pipeline.\n     *\n     * @param filter - The filter used to select the document to update\n     * @param update - The modifications to apply\n     * @param options - Optional settings for the command\n     */\n    async updateMany(filter, update, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new update_2.UpdateManyOperation(this, filter, update, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Delete a document from a collection\n     *\n     * @param filter - The filter used to select the document to remove\n     * @param options - Optional settings for the command\n     */\n    async deleteOne(filter = {}, options = {}) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new delete_1.DeleteOneOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Delete multiple documents from a collection\n     *\n     * @param filter - The filter used to select the documents to remove\n     * @param options - Optional settings for the command\n     */\n    async deleteMany(filter = {}, options = {}) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new delete_1.DeleteManyOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Rename the collection.\n     *\n     * @remarks\n     * This operation does not inherit options from the Db or MongoClient.\n     *\n     * @param newName - New name of of the collection.\n     * @param options - Optional settings for the command\n     */\n    async rename(newName, options) {\n        // Intentionally, we do not inherit options from parent for this operation.\n        return await (0, execute_operation_1.executeOperation)(this.client, new rename_1.RenameOperation(this, newName, (0, utils_1.resolveOptions)(undefined, {\n            ...options,\n            readPreference: read_preference_1.ReadPreference.PRIMARY\n        })));\n    }\n    /**\n     * Drop the collection from the database, removing it permanently. New accesses will create a new collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async drop(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new drop_1.DropCollectionOperation(this.s.db, this.collectionName, options));\n    }\n    async findOne(filter = {}, options = {}) {\n        const cursor = this.find(filter, options).limit(-1).batchSize(1);\n        const res = await cursor.next();\n        await cursor.close();\n        return res;\n    }\n    find(filter = {}, options = {}) {\n        return new find_cursor_1.FindCursor(this.client, this.s.namespace, filter, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Returns the options of the collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async options(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new options_operation_1.OptionsOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Returns if the collection is a capped collection\n     *\n     * @param options - Optional settings for the command\n     */\n    async isCapped(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new is_capped_1.IsCappedOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Creates an index on the db and collection collection.\n     *\n     * @param indexSpec - The field name or index specification to create an index for\n     * @param options - Optional settings for the command\n     *\n     * @example\n     * ```ts\n     * const collection = client.db('foo').collection('bar');\n     *\n     * await collection.createIndex({ a: 1, b: -1 });\n     *\n     * // Alternate syntax for { c: 1, d: -1 } that ensures order of indexes\n     * await collection.createIndex([ [c, 1], [d, -1] ]);\n     *\n     * // Equivalent to { e: 1 }\n     * await collection.createIndex('e');\n     *\n     * // Equivalent to { f: 1, g: 1 }\n     * await collection.createIndex(['f', 'g'])\n     *\n     * // Equivalent to { h: 1, i: -1 }\n     * await collection.createIndex([ { h: 1 }, { i: -1 } ]);\n     *\n     * // Equivalent to { j: 1, k: -1, l: 2d }\n     * await collection.createIndex(['j', ['k', -1], { l: '2d' }])\n     * ```\n     */\n    async createIndex(indexSpec, options) {\n        const indexes = await (0, execute_operation_1.executeOperation)(this.client, indexes_1.CreateIndexesOperation.fromIndexSpecification(this, this.collectionName, indexSpec, (0, utils_1.resolveOptions)(this, options)));\n        return indexes[0];\n    }\n    /**\n     * Creates multiple indexes in the collection, this method is only supported for\n     * MongoDB 2.6 or higher. Earlier version of MongoDB will throw a command not supported\n     * error.\n     *\n     * **Note**: Unlike {@link Collection#createIndex| createIndex}, this function takes in raw index specifications.\n     * Index specifications are defined {@link https://www.mongodb.com/docs/manual/reference/command/createIndexes/| here}.\n     *\n     * @param indexSpecs - An array of index specifications to be created\n     * @param options - Optional settings for the command\n     *\n     * @example\n     * ```ts\n     * const collection = client.db('foo').collection('bar');\n     * await collection.createIndexes([\n     *   // Simple index on field fizz\n     *   {\n     *     key: { fizz: 1 },\n     *   }\n     *   // wildcard index\n     *   {\n     *     key: { '$**': 1 }\n     *   },\n     *   // named index on darmok and jalad\n     *   {\n     *     key: { darmok: 1, jalad: -1 }\n     *     name: 'tanagra'\n     *   }\n     * ]);\n     * ```\n     */\n    async createIndexes(indexSpecs, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, indexes_1.CreateIndexesOperation.fromIndexDescriptionArray(this, this.collectionName, indexSpecs, (0, utils_1.resolveOptions)(this, { ...options, maxTimeMS: undefined })));\n    }\n    /**\n     * Drops an index from this collection.\n     *\n     * @param indexName - Name of the index to drop.\n     * @param options - Optional settings for the command\n     */\n    async dropIndex(indexName, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new indexes_1.DropIndexOperation(this, indexName, {\n            ...(0, utils_1.resolveOptions)(this, options),\n            readPreference: read_preference_1.ReadPreference.primary\n        }));\n    }\n    /**\n     * Drops all indexes from this collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    async dropIndexes(options) {\n        try {\n            await (0, execute_operation_1.executeOperation)(this.client, new indexes_1.DropIndexOperation(this, '*', (0, utils_1.resolveOptions)(this, options)));\n            return true;\n        }\n        catch (error) {\n            // TODO(NODE-6517): Driver should only filter for namespace not found error. Other errors should be thrown.\n            if (error instanceof error_1.MongoOperationTimeoutError)\n                throw error;\n            return false;\n        }\n    }\n    /**\n     * Get the list of all indexes information for the collection.\n     *\n     * @param options - Optional settings for the command\n     */\n    listIndexes(options) {\n        return new list_indexes_cursor_1.ListIndexesCursor(this, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Checks if one or more indexes exist on the collection, fails on first non-existing index\n     *\n     * @param indexes - One or more index names to check.\n     * @param options - Optional settings for the command\n     */\n    async indexExists(indexes, options) {\n        const indexNames = Array.isArray(indexes) ? indexes : [indexes];\n        const allIndexes = new Set(await this.listIndexes(options)\n            .map(({ name }) => name)\n            .toArray());\n        return indexNames.every(name => allIndexes.has(name));\n    }\n    async indexInformation(options) {\n        return await this.indexes({\n            ...options,\n            full: options?.full ?? false\n        });\n    }\n    /**\n     * Gets an estimate of the count of documents in a collection using collection metadata.\n     * This will always run a count command on all server versions.\n     *\n     * due to an oversight in versions 5.0.0-5.0.8 of MongoDB, the count command,\n     * which estimatedDocumentCount uses in its implementation, was not included in v1 of\n     * the Stable API, and so users of the Stable API with estimatedDocumentCount are\n     * recommended to upgrade their server version to 5.0.9+ or set apiStrict: false to avoid\n     * encountering errors.\n     *\n     * @see {@link https://www.mongodb.com/docs/manual/reference/command/count/#behavior|Count: Behavior}\n     * @param options - Optional settings for the command\n     */\n    async estimatedDocumentCount(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new estimated_document_count_1.EstimatedDocumentCountOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Gets the number of documents matching the filter.\n     * For a fast count of the total documents in a collection see {@link Collection#estimatedDocumentCount| estimatedDocumentCount}.\n     *\n     * Due to countDocuments using the $match aggregation pipeline stage, certain query operators cannot be used in countDocuments. This includes the $where and $near query operators, among others. Details can be found in the documentation for the $match aggregation pipeline stage.\n     *\n     * **Note**: When migrating from {@link Collection#count| count} to {@link Collection#countDocuments| countDocuments}\n     * the following query operators must be replaced:\n     *\n     * | Operator | Replacement |\n     * | -------- | ----------- |\n     * | `$where`   | [`$expr`][1] |\n     * | `$near`    | [`$geoWithin`][2] with [`$center`][3] |\n     * | `$nearSphere` | [`$geoWithin`][2] with [`$centerSphere`][4] |\n     *\n     * [1]: https://www.mongodb.com/docs/manual/reference/operator/query/expr/\n     * [2]: https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/\n     * [3]: https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center\n     * [4]: https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere\n     *\n     * @param filter - The filter for the count\n     * @param options - Optional settings for the command\n     *\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/expr/\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center\n     * @see https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere\n     */\n    async countDocuments(filter = {}, options = {}) {\n        const pipeline = [];\n        pipeline.push({ $match: filter });\n        if (typeof options.skip === 'number') {\n            pipeline.push({ $skip: options.skip });\n        }\n        if (typeof options.limit === 'number') {\n            pipeline.push({ $limit: options.limit });\n        }\n        pipeline.push({ $group: { _id: 1, n: { $sum: 1 } } });\n        const cursor = this.aggregate(pipeline, options);\n        const doc = await cursor.next();\n        await cursor.close();\n        return doc?.n ?? 0;\n    }\n    async distinct(key, filter = {}, options = {}) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new distinct_1.DistinctOperation(this, key, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async indexes(options) {\n        const indexes = await this.listIndexes(options).toArray();\n        const full = options?.full ?? true;\n        if (full) {\n            return indexes;\n        }\n        const object = Object.fromEntries(indexes.map(({ name, key }) => [name, Object.entries(key)]));\n        return object;\n    }\n    async findOneAndDelete(filter, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new find_and_modify_1.FindOneAndDeleteOperation(this, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async findOneAndReplace(filter, replacement, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new find_and_modify_1.FindOneAndReplaceOperation(this, filter, replacement, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async findOneAndUpdate(filter, update, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new find_and_modify_1.FindOneAndUpdateOperation(this, filter, update, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Execute an aggregation framework pipeline against the collection, needs MongoDB \\>= 2.2\n     *\n     * @param pipeline - An array of aggregation pipelines to execute\n     * @param options - Optional settings for the command\n     */\n    aggregate(pipeline = [], options) {\n        if (!Array.isArray(pipeline)) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"pipeline\" must be an array of aggregation stages');\n        }\n        return new aggregation_cursor_1.AggregationCursor(this.client, this.s.namespace, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Create a new Change Stream, watching for new changes (insertions, updates, replacements, deletions, and invalidations) in this collection.\n     *\n     * @remarks\n     * watch() accepts two generic arguments for distinct use cases:\n     * - The first is to override the schema that may be defined for this specific collection\n     * - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument\n     * @example\n     * By just providing the first argument I can type the change to be `ChangeStreamDocument<{ _id: number }>`\n     * ```ts\n     * collection.watch<{ _id: number }>()\n     *   .on('change', change => console.log(change._id.toFixed(4)));\n     * ```\n     *\n     * @example\n     * Passing a second argument provides a way to reflect the type changes caused by an advanced pipeline.\n     * Here, we are using a pipeline to have MongoDB filter for insert changes only and add a comment.\n     * No need start from scratch on the ChangeStreamInsertDocument type!\n     * By using an intersection we can save time and ensure defaults remain the same type!\n     * ```ts\n     * collection\n     *   .watch<Schema, ChangeStreamInsertDocument<Schema> & { comment: string }>([\n     *     { $addFields: { comment: 'big changes' } },\n     *     { $match: { operationType: 'insert' } }\n     *   ])\n     *   .on('change', change => {\n     *     change.comment.startsWith('big');\n     *     change.operationType === 'insert';\n     *     // No need to narrow in code because the generics did that for us!\n     *     expectType<Schema>(change.fullDocument);\n     *   });\n     * ```\n     *\n     * @remarks\n     * When `timeoutMS` is configured for a change stream, it will have different behaviour depending\n     * on whether the change stream is in iterator mode or emitter mode. In both cases, a change\n     * stream will time out if it does not receive a change event within `timeoutMS` of the last change\n     * event.\n     *\n     * Note that if a change stream is consistently timing out when watching a collection, database or\n     * client that is being changed, then this may be due to the server timing out before it can finish\n     * processing the existing oplog. To address this, restart the change stream with a higher\n     * `timeoutMS`.\n     *\n     * If the change stream times out the initial aggregate operation to establish the change stream on\n     * the server, then the client will close the change stream. If the getMore calls to the server\n     * time out, then the change stream will be left open, but will throw a MongoOperationTimeoutError\n     * when in iterator mode and emit an error event that returns a MongoOperationTimeoutError in\n     * emitter mode.\n     *\n     * To determine whether or not the change stream is still open following a timeout, check the\n     * {@link ChangeStream.closed} getter.\n     *\n     * @example\n     * In iterator mode, if a next() call throws a timeout error, it will attempt to resume the change stream.\n     * The next call can just be retried after this succeeds.\n     * ```ts\n     * const changeStream = collection.watch([], { timeoutMS: 100 });\n     * try {\n     *     await changeStream.next();\n     * } catch (e) {\n     *     if (e instanceof MongoOperationTimeoutError && !changeStream.closed) {\n     *       await changeStream.next();\n     *     }\n     *     throw e;\n     * }\n     * ```\n     *\n     * @example\n     * In emitter mode, if the change stream goes `timeoutMS` without emitting a change event, it will\n     * emit an error event that returns a MongoOperationTimeoutError, but will not close the change\n     * stream unless the resume attempt fails. There is no need to re-establish change listeners as\n     * this will automatically continue emitting change events once the resume attempt completes.\n     *\n     * ```ts\n     * const changeStream = collection.watch([], { timeoutMS: 100 });\n     * changeStream.on('change', console.log);\n     * changeStream.on('error', e => {\n     *     if (e instanceof MongoOperationTimeoutError && !changeStream.closed) {\n     *         // do nothing\n     *     } else {\n     *         changeStream.close();\n     *     }\n     * });\n     * ```\n     *\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\n     * @param options - Optional settings for the command\n     * @typeParam TLocal - Type of the data being detected by the change stream\n     * @typeParam TChange - Type of the whole change stream document emitted\n     */\n    watch(pipeline = [], options = {}) {\n        // Allow optionally not specifying a pipeline\n        if (!Array.isArray(pipeline)) {\n            options = pipeline;\n            pipeline = [];\n        }\n        return new change_stream_1.ChangeStream(this, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Initiate an Out of order batch write operation. All operations will be buffered into insert/update/remove commands executed out of order.\n     *\n     * @throws MongoNotConnectedError\n     * @remarks\n     * **NOTE:** MongoClient must be connected prior to calling this method due to a known limitation in this legacy implementation.\n     * However, `collection.bulkWrite()` provides an equivalent API that does not require prior connecting.\n     */\n    initializeUnorderedBulkOp(options) {\n        return new unordered_1.UnorderedBulkOperation(this, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Initiate an In order bulk write operation. Operations will be serially executed in the order they are added, creating a new operation for each switch in types.\n     *\n     * @throws MongoNotConnectedError\n     * @remarks\n     * **NOTE:** MongoClient must be connected prior to calling this method due to a known limitation in this legacy implementation.\n     * However, `collection.bulkWrite()` provides an equivalent API that does not require prior connecting.\n     */\n    initializeOrderedBulkOp(options) {\n        return new ordered_1.OrderedBulkOperation(this, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * An estimated count of matching documents in the db to a filter.\n     *\n     * **NOTE:** This method has been deprecated, since it does not provide an accurate count of the documents\n     * in a collection. To obtain an accurate count of documents in the collection, use {@link Collection#countDocuments| countDocuments}.\n     * To obtain an estimated count of all documents in the collection, use {@link Collection#estimatedDocumentCount| estimatedDocumentCount}.\n     *\n     * @deprecated use {@link Collection#countDocuments| countDocuments} or {@link Collection#estimatedDocumentCount| estimatedDocumentCount} instead\n     *\n     * @param filter - The filter for the count.\n     * @param options - Optional settings for the command\n     */\n    async count(filter = {}, options = {}) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new count_1.CountOperation(this.fullNamespace, filter, (0, utils_1.resolveOptions)(this, options)));\n    }\n    listSearchIndexes(indexNameOrOptions, options) {\n        options =\n            typeof indexNameOrOptions === 'object' ? indexNameOrOptions : options == null ? {} : options;\n        const indexName = indexNameOrOptions == null\n            ? null\n            : typeof indexNameOrOptions === 'object'\n                ? null\n                : indexNameOrOptions;\n        return new list_search_indexes_cursor_1.ListSearchIndexesCursor(this, indexName, options);\n    }\n    /**\n     * Creates a single search index for the collection.\n     *\n     * @param description - The index description for the new search index.\n     * @returns A promise that resolves to the name of the new search index.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     */\n    async createSearchIndex(description) {\n        const [index] = await this.createSearchIndexes([description]);\n        return index;\n    }\n    /**\n     * Creates multiple search indexes for the current collection.\n     *\n     * @param descriptions - An array of `SearchIndexDescription`s for the new search indexes.\n     * @returns A promise that resolves to an array of the newly created search index names.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     * @returns\n     */\n    async createSearchIndexes(descriptions) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new create_1.CreateSearchIndexesOperation(this, descriptions));\n    }\n    /**\n     * Deletes a search index by index name.\n     *\n     * @param name - The name of the search index to be deleted.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     */\n    async dropSearchIndex(name) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new drop_2.DropSearchIndexOperation(this, name));\n    }\n    /**\n     * Updates a search index by replacing the existing index definition with the provided definition.\n     *\n     * @param name - The name of the search index to update.\n     * @param definition - The new search index definition.\n     *\n     * @remarks Only available when used against a 7.0+ Atlas cluster.\n     */\n    async updateSearchIndex(name, definition) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new update_1.UpdateSearchIndexOperation(this, name, definition));\n    }\n}\nexports.Collection = Collection;\n//# sourceMappingURL=collection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NvbGxlY3Rpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCO0FBQ2xCLGVBQWUsbUJBQU8sQ0FBQywwRkFBUTtBQUMvQixrQkFBa0IsbUJBQU8sQ0FBQywwR0FBZ0I7QUFDMUMsb0JBQW9CLG1CQUFPLENBQUMsOEdBQWtCO0FBQzlDLHdCQUF3QixtQkFBTyxDQUFDLDRHQUFpQjtBQUNqRCw2QkFBNkIsbUJBQU8sQ0FBQyxvSUFBNkI7QUFDbEUsc0JBQXNCLG1CQUFPLENBQUMsc0hBQXNCO0FBQ3BELDhCQUE4QixtQkFBTyxDQUFDLHNJQUE4QjtBQUNwRSxxQ0FBcUMsbUJBQU8sQ0FBQyxvSkFBcUM7QUFDbEYsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMscUJBQXFCLG1CQUFPLENBQUMsNEhBQXlCO0FBQ3RELGdCQUFnQixtQkFBTyxDQUFDLGtIQUFvQjtBQUM1QyxpQkFBaUIsbUJBQU8sQ0FBQyxvSEFBcUI7QUFDOUMsbUJBQW1CLG1CQUFPLENBQUMsd0hBQXVCO0FBQ2xELGVBQWUsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDMUMsbUNBQW1DLG1CQUFPLENBQUMsd0pBQXVDO0FBQ2xGLDRCQUE0QixtQkFBTyxDQUFDLDBJQUFnQztBQUNwRSwwQkFBMEIsbUJBQU8sQ0FBQyxzSUFBOEI7QUFDaEUsa0JBQWtCLG1CQUFPLENBQUMsc0hBQXNCO0FBQ2hELGlCQUFpQixtQkFBTyxDQUFDLG9IQUFxQjtBQUM5QyxvQkFBb0IsbUJBQU8sQ0FBQywwSEFBd0I7QUFDcEQsNEJBQTRCLG1CQUFPLENBQUMsMElBQWdDO0FBQ3BFLGlCQUFpQixtQkFBTyxDQUFDLG9IQUFxQjtBQUM5QyxpQkFBaUIsbUJBQU8sQ0FBQyxrSkFBb0M7QUFDN0QsZUFBZSxtQkFBTyxDQUFDLDhJQUFrQztBQUN6RCxpQkFBaUIsbUJBQU8sQ0FBQyxrSkFBb0M7QUFDN0QsaUJBQWlCLG1CQUFPLENBQUMsb0hBQXFCO0FBQzlDLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDckQsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsd0JBQXdCLG1CQUFPLENBQUMsNEdBQWlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksY0FBYztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsVUFBVSxPQUFPLFNBQVM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCxZQUFZLEdBQUcsb0JBQW9CO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdLQUF3SyxlQUFlO0FBQ3ZMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlMQUFpTCxlQUFlO0FBQ2hNO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixjQUFjO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsY0FBYztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsY0FBYztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsYUFBYTtBQUNuRDtBQUNBLGlDQUFpQyxjQUFjO0FBQy9DO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCLHdDQUF3QyxNQUFNLElBQUksUUFBUTtBQUMxRDtBQUNBLDBCQUEwQjtBQUMxQix1REFBdUQsU0FBUztBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLDBDQUEwQztBQUNuRSx5Q0FBeUMsaUZBQWlGO0FBQzFIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLFNBQVM7QUFDM0I7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCLFVBQVU7QUFDVjtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtOQUFrTixrQ0FBa0M7QUFDcFA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUFvRSxnRUFBZ0U7QUFDcEk7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLCtCQUErQixJQUFJO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxjQUFjO0FBQ2xEO0FBQ0Esd0JBQXdCLGdCQUFnQjtBQUN4QztBQUNBLDRCQUE0QixxQkFBcUI7QUFDakQ7QUFDQTtBQUNBLDRCQUE0Qix1QkFBdUI7QUFDbkQ7QUFDQSx3QkFBd0IsVUFBVSxhQUFhLGFBQWE7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxjQUFjO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsV0FBVztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdHQUFnRyxhQUFhO0FBQzdHO0FBQ0EsMEJBQTBCLGFBQWE7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0QsaUJBQWlCO0FBQ2hGLGFBQWEsY0FBYywwQkFBMEI7QUFDckQsYUFBYSxVQUFVO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwyQkFBMkI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxnQkFBZ0I7QUFDbkU7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELGdCQUFnQjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxzQ0FBc0MsZ0hBQWdIO0FBQ3RKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlGQUF5RixnREFBZ0Q7QUFDekksNkVBQTZFLGdFQUFnRTtBQUM3STtBQUNBLHdCQUF3QixpREFBaUQsSUFBSSxpRUFBaUU7QUFDOUk7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsY0FBYztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBLCtGQUErRjtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY29sbGVjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29sbGVjdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5jb25zdCBvcmRlcmVkXzEgPSByZXF1aXJlKFwiLi9idWxrL29yZGVyZWRcIik7XG5jb25zdCB1bm9yZGVyZWRfMSA9IHJlcXVpcmUoXCIuL2J1bGsvdW5vcmRlcmVkXCIpO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4vY2hhbmdlX3N0cmVhbVwiKTtcbmNvbnN0IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2FnZ3JlZ2F0aW9uX2N1cnNvclwiKTtcbmNvbnN0IGZpbmRfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvZmluZF9jdXJzb3JcIik7XG5jb25zdCBsaXN0X2luZGV4ZXNfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvbGlzdF9pbmRleGVzX2N1cnNvclwiKTtcbmNvbnN0IGxpc3Rfc2VhcmNoX2luZGV4ZXNfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvbGlzdF9zZWFyY2hfaW5kZXhlc19jdXJzb3JcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBidWxrX3dyaXRlXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2J1bGtfd3JpdGVcIik7XG5jb25zdCBjb3VudF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9jb3VudFwiKTtcbmNvbnN0IGRlbGV0ZV8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9kZWxldGVcIik7XG5jb25zdCBkaXN0aW5jdF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9kaXN0aW5jdFwiKTtcbmNvbnN0IGRyb3BfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZHJvcFwiKTtcbmNvbnN0IGVzdGltYXRlZF9kb2N1bWVudF9jb3VudF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9lc3RpbWF0ZWRfZG9jdW1lbnRfY291bnRcIik7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IGZpbmRfYW5kX21vZGlmeV8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9maW5kX2FuZF9tb2RpZnlcIik7XG5jb25zdCBpbmRleGVzXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2luZGV4ZXNcIik7XG5jb25zdCBpbnNlcnRfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvaW5zZXJ0XCIpO1xuY29uc3QgaXNfY2FwcGVkXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2lzX2NhcHBlZFwiKTtcbmNvbnN0IG9wdGlvbnNfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL29wdGlvbnNfb3BlcmF0aW9uXCIpO1xuY29uc3QgcmVuYW1lXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3JlbmFtZVwiKTtcbmNvbnN0IGNyZWF0ZV8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9zZWFyY2hfaW5kZXhlcy9jcmVhdGVcIik7XG5jb25zdCBkcm9wXzIgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3NlYXJjaF9pbmRleGVzL2Ryb3BcIik7XG5jb25zdCB1cGRhdGVfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvdXBkYXRlXCIpO1xuY29uc3QgdXBkYXRlXzIgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3VwZGF0ZVwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuLyoqXG4gKiBUaGUgKipDb2xsZWN0aW9uKiogY2xhc3MgaXMgYW4gaW50ZXJuYWwgY2xhc3MgdGhhdCBlbWJvZGllcyBhIE1vbmdvREIgY29sbGVjdGlvblxuICogYWxsb3dpbmcgZm9yIGluc2VydC9maW5kL3VwZGF0ZS9kZWxldGUgYW5kIG90aGVyIGNvbW1hbmQgb3BlcmF0aW9uIG9uIHRoYXQgTW9uZ29EQiBjb2xsZWN0aW9uLlxuICpcbiAqICoqQ09MTEVDVElPTiBDYW5ub3QgZGlyZWN0bHkgYmUgaW5zdGFudGlhdGVkKipcbiAqIEBwdWJsaWNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG4gKlxuICogaW50ZXJmYWNlIFBldCB7XG4gKiAgIG5hbWU6IHN0cmluZztcbiAqICAga2luZDogJ2RvZycgfCAnY2F0JyB8ICdmaXNoJztcbiAqIH1cbiAqXG4gKiBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQoJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcnKTtcbiAqIGNvbnN0IHBldHMgPSBjbGllbnQuZGIoKS5jb2xsZWN0aW9uPFBldD4oJ3BldHMnKTtcbiAqXG4gKiBjb25zdCBwZXRDdXJzb3IgPSBwZXRzLmZpbmQoKTtcbiAqXG4gKiBmb3IgYXdhaXQgKGNvbnN0IHBldCBvZiBwZXRDdXJzb3IpIHtcbiAqICAgY29uc29sZS5sb2coYCR7cGV0Lm5hbWV9IGlzIGEgJHtwZXQua2luZH0hYCk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuY2xhc3MgQ29sbGVjdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IENvbGxlY3Rpb24gaW5zdGFuY2VcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihkYiwgbmFtZSwgb3B0aW9ucykge1xuICAgICAgICAvLyBJbnRlcm5hbCBzdGF0ZVxuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICBkYixcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICBuYW1lc3BhY2U6IG5ldyB1dGlsc18xLk1vbmdvREJDb2xsZWN0aW9uTmFtZXNwYWNlKGRiLmRhdGFiYXNlTmFtZSwgbmFtZSksXG4gICAgICAgICAgICBwa0ZhY3Rvcnk6IGRiLm9wdGlvbnM/LnBrRmFjdG9yeSA/PyB1dGlsc18xLkRFRkFVTFRfUEtfRkFDVE9SWSxcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tT3B0aW9ucyhvcHRpb25zKSxcbiAgICAgICAgICAgIGJzb25PcHRpb25zOiAoMCwgYnNvbl8xLnJlc29sdmVCU09OT3B0aW9ucykob3B0aW9ucywgZGIpLFxuICAgICAgICAgICAgcmVhZENvbmNlcm46IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpLFxuICAgICAgICAgICAgd3JpdGVDb25jZXJuOiB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xpZW50ID0gZGIuY2xpZW50O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2UgdGhpcyBjb2xsZWN0aW9uIGJlbG9uZ3MgdG9cbiAgICAgKi9cbiAgICBnZXQgZGJOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLm5hbWVzcGFjZS5kYjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIG5hbWUgb2YgdGhpcyBjb2xsZWN0aW9uXG4gICAgICovXG4gICAgZ2V0IGNvbGxlY3Rpb25OYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLm5hbWVzcGFjZS5jb2xsZWN0aW9uO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbmFtZXNwYWNlIG9mIHRoaXMgY29sbGVjdGlvbiwgaW4gdGhlIGZvcm1hdCBgJHt0aGlzLmRiTmFtZX0uJHt0aGlzLmNvbGxlY3Rpb25OYW1lfWBcbiAgICAgKi9cbiAgICBnZXQgbmFtZXNwYWNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5mdWxsTmFtZXNwYWNlLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqICBAaW50ZXJuYWxcbiAgICAgKlxuICAgICAqIFRoZSBgTW9uZ29EQk5hbWVzcGFjZWAgZm9yIHRoZSBjb2xsZWN0aW9uLlxuICAgICAqL1xuICAgIGdldCBmdWxsTmFtZXNwYWNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLm5hbWVzcGFjZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnQgcmVhZENvbmNlcm4gb2YgdGhlIGNvbGxlY3Rpb24uIElmIG5vdCBleHBsaWNpdGx5IGRlZmluZWQgZm9yXG4gICAgICogdGhpcyBjb2xsZWN0aW9uLCB3aWxsIGJlIGluaGVyaXRlZCBmcm9tIHRoZSBwYXJlbnQgREJcbiAgICAgKi9cbiAgICBnZXQgcmVhZENvbmNlcm4oKSB7XG4gICAgICAgIGlmICh0aGlzLnMucmVhZENvbmNlcm4gPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucy5kYi5yZWFkQ29uY2VybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zLnJlYWRDb25jZXJuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudCByZWFkUHJlZmVyZW5jZSBvZiB0aGUgY29sbGVjdGlvbi4gSWYgbm90IGV4cGxpY2l0bHkgZGVmaW5lZCBmb3JcbiAgICAgKiB0aGlzIGNvbGxlY3Rpb24sIHdpbGwgYmUgaW5oZXJpdGVkIGZyb20gdGhlIHBhcmVudCBEQlxuICAgICAqL1xuICAgIGdldCByZWFkUHJlZmVyZW5jZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucy5yZWFkUHJlZmVyZW5jZSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zLmRiLnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnMucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGdldCBic29uT3B0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5ic29uT3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnQgd3JpdGVDb25jZXJuIG9mIHRoZSBjb2xsZWN0aW9uLiBJZiBub3QgZXhwbGljaXRseSBkZWZpbmVkIGZvclxuICAgICAqIHRoaXMgY29sbGVjdGlvbiwgd2lsbCBiZSBpbmhlcml0ZWQgZnJvbSB0aGUgcGFyZW50IERCXG4gICAgICovXG4gICAgZ2V0IHdyaXRlQ29uY2VybigpIHtcbiAgICAgICAgaWYgKHRoaXMucy53cml0ZUNvbmNlcm4gPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucy5kYi53cml0ZUNvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucy53cml0ZUNvbmNlcm47XG4gICAgfVxuICAgIC8qKiBUaGUgY3VycmVudCBpbmRleCBoaW50IGZvciB0aGUgY29sbGVjdGlvbiAqL1xuICAgIGdldCBoaW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmNvbGxlY3Rpb25IaW50O1xuICAgIH1cbiAgICBzZXQgaGludCh2KSB7XG4gICAgICAgIHRoaXMucy5jb2xsZWN0aW9uSGludCA9ICgwLCB1dGlsc18xLm5vcm1hbGl6ZUhpbnRGaWVsZCkodik7XG4gICAgfVxuICAgIGdldCB0aW1lb3V0TVMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMub3B0aW9ucy50aW1lb3V0TVM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluc2VydHMgYSBzaW5nbGUgZG9jdW1lbnQgaW50byBNb25nb0RCLiBJZiBkb2N1bWVudHMgcGFzc2VkIGluIGRvIG5vdCBjb250YWluIHRoZSAqKl9pZCoqIGZpZWxkLFxuICAgICAqIG9uZSB3aWxsIGJlIGFkZGVkIHRvIGVhY2ggb2YgdGhlIGRvY3VtZW50cyBtaXNzaW5nIGl0IGJ5IHRoZSBkcml2ZXIsIG11dGF0aW5nIHRoZSBkb2N1bWVudC4gVGhpcyBiZWhhdmlvclxuICAgICAqIGNhbiBiZSBvdmVycmlkZGVuIGJ5IHNldHRpbmcgdGhlICoqZm9yY2VTZXJ2ZXJPYmplY3RJZCoqIGZsYWcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jIC0gVGhlIGRvY3VtZW50IHRvIGluc2VydFxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgaW5zZXJ0T25lKGRvYywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBpbnNlcnRfMS5JbnNlcnRPbmVPcGVyYXRpb24odGhpcywgZG9jLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5zZXJ0cyBhbiBhcnJheSBvZiBkb2N1bWVudHMgaW50byBNb25nb0RCLiBJZiBkb2N1bWVudHMgcGFzc2VkIGluIGRvIG5vdCBjb250YWluIHRoZSAqKl9pZCoqIGZpZWxkLFxuICAgICAqIG9uZSB3aWxsIGJlIGFkZGVkIHRvIGVhY2ggb2YgdGhlIGRvY3VtZW50cyBtaXNzaW5nIGl0IGJ5IHRoZSBkcml2ZXIsIG11dGF0aW5nIHRoZSBkb2N1bWVudC4gVGhpcyBiZWhhdmlvclxuICAgICAqIGNhbiBiZSBvdmVycmlkZGVuIGJ5IHNldHRpbmcgdGhlICoqZm9yY2VTZXJ2ZXJPYmplY3RJZCoqIGZsYWcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jcyAtIFRoZSBkb2N1bWVudHMgdG8gaW5zZXJ0XG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBpbnNlcnRNYW55KGRvY3MsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5zZXJ0XzEuSW5zZXJ0TWFueU9wZXJhdGlvbih0aGlzLCBkb2NzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucyA/PyB7IG9yZGVyZWQ6IHRydWUgfSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybSBhIGJ1bGtXcml0ZSBvcGVyYXRpb24gd2l0aG91dCBhIGZsdWVudCBBUElcbiAgICAgKlxuICAgICAqIExlZ2FsIG9wZXJhdGlvbiB0eXBlcyBhcmVcbiAgICAgKiAtIGBpbnNlcnRPbmVgXG4gICAgICogLSBgcmVwbGFjZU9uZWBcbiAgICAgKiAtIGB1cGRhdGVPbmVgXG4gICAgICogLSBgdXBkYXRlTWFueWBcbiAgICAgKiAtIGBkZWxldGVPbmVgXG4gICAgICogLSBgZGVsZXRlTWFueWBcbiAgICAgKlxuICAgICAqIElmIGRvY3VtZW50cyBwYXNzZWQgaW4gZG8gbm90IGNvbnRhaW4gdGhlICoqX2lkKiogZmllbGQsXG4gICAgICogb25lIHdpbGwgYmUgYWRkZWQgdG8gZWFjaCBvZiB0aGUgZG9jdW1lbnRzIG1pc3NpbmcgaXQgYnkgdGhlIGRyaXZlciwgbXV0YXRpbmcgdGhlIGRvY3VtZW50LiBUaGlzIGJlaGF2aW9yXG4gICAgICogY2FuIGJlIG92ZXJyaWRkZW4gYnkgc2V0dGluZyB0aGUgKipmb3JjZVNlcnZlck9iamVjdElkKiogZmxhZy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcGVyYXRpb25zIC0gQnVsayBvcGVyYXRpb25zIHRvIHBlcmZvcm1cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqIEB0aHJvd3MgTW9uZ29Ecml2ZXJFcnJvciBpZiBvcGVyYXRpb25zIGlzIG5vdCBhbiBhcnJheVxuICAgICAqL1xuICAgIGFzeW5jIGJ1bGtXcml0ZShvcGVyYXRpb25zLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvcGVyYXRpb25zKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJvcGVyYXRpb25zXCIgbXVzdCBiZSBhbiBhcnJheSBvZiBkb2N1bWVudHMnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBidWxrX3dyaXRlXzEuQnVsa1dyaXRlT3BlcmF0aW9uKHRoaXMsIG9wZXJhdGlvbnMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zID8/IHsgb3JkZXJlZDogdHJ1ZSB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgYSBzaW5nbGUgZG9jdW1lbnQgaW4gYSBjb2xsZWN0aW9uXG4gICAgICpcbiAgICAgKiBUaGUgdmFsdWUgb2YgYHVwZGF0ZWAgY2FuIGJlIGVpdGhlcjpcbiAgICAgKiAtIFVwZGF0ZUZpbHRlcjxUU2NoZW1hPiAtIEEgZG9jdW1lbnQgdGhhdCBjb250YWlucyB1cGRhdGUgb3BlcmF0b3IgZXhwcmVzc2lvbnMsXG4gICAgICogLSBEb2N1bWVudFtdIC0gYW4gYWdncmVnYXRpb24gcGlwZWxpbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmlsdGVyIC0gVGhlIGZpbHRlciB1c2VkIHRvIHNlbGVjdCB0aGUgZG9jdW1lbnQgdG8gdXBkYXRlXG4gICAgICogQHBhcmFtIHVwZGF0ZSAtIFRoZSBtb2RpZmljYXRpb25zIHRvIGFwcGx5XG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVPbmUoZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgdXBkYXRlXzIuVXBkYXRlT25lT3BlcmF0aW9uKHRoaXMsIGZpbHRlciwgdXBkYXRlLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVwbGFjZSBhIGRvY3VtZW50IGluIGEgY29sbGVjdGlvbiB3aXRoIGFub3RoZXIgZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWx0ZXIgLSBUaGUgZmlsdGVyIHVzZWQgdG8gc2VsZWN0IHRoZSBkb2N1bWVudCB0byByZXBsYWNlXG4gICAgICogQHBhcmFtIHJlcGxhY2VtZW50IC0gVGhlIERvY3VtZW50IHRoYXQgcmVwbGFjZXMgdGhlIG1hdGNoaW5nIGRvY3VtZW50XG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyByZXBsYWNlT25lKGZpbHRlciwgcmVwbGFjZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgdXBkYXRlXzIuUmVwbGFjZU9uZU9wZXJhdGlvbih0aGlzLCBmaWx0ZXIsIHJlcGxhY2VtZW50LCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIG11bHRpcGxlIGRvY3VtZW50cyBpbiBhIGNvbGxlY3Rpb25cbiAgICAgKlxuICAgICAqIFRoZSB2YWx1ZSBvZiBgdXBkYXRlYCBjYW4gYmUgZWl0aGVyOlxuICAgICAqIC0gVXBkYXRlRmlsdGVyPFRTY2hlbWE+IC0gQSBkb2N1bWVudCB0aGF0IGNvbnRhaW5zIHVwZGF0ZSBvcGVyYXRvciBleHByZXNzaW9ucyxcbiAgICAgKiAtIERvY3VtZW50W10gLSBhbiBhZ2dyZWdhdGlvbiBwaXBlbGluZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWx0ZXIgLSBUaGUgZmlsdGVyIHVzZWQgdG8gc2VsZWN0IHRoZSBkb2N1bWVudCB0byB1cGRhdGVcbiAgICAgKiBAcGFyYW0gdXBkYXRlIC0gVGhlIG1vZGlmaWNhdGlvbnMgdG8gYXBwbHlcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHVwZGF0ZU1hbnkoZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgdXBkYXRlXzIuVXBkYXRlTWFueU9wZXJhdGlvbih0aGlzLCBmaWx0ZXIsIHVwZGF0ZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBhIGRvY3VtZW50IGZyb20gYSBjb2xsZWN0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmlsdGVyIC0gVGhlIGZpbHRlciB1c2VkIHRvIHNlbGVjdCB0aGUgZG9jdW1lbnQgdG8gcmVtb3ZlXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBkZWxldGVPbmUoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBkZWxldGVfMS5EZWxldGVPbmVPcGVyYXRpb24odGhpcywgZmlsdGVyLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIG11bHRpcGxlIGRvY3VtZW50cyBmcm9tIGEgY29sbGVjdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgdXNlZCB0byBzZWxlY3QgdGhlIGRvY3VtZW50cyB0byByZW1vdmVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGRlbGV0ZU1hbnkoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBkZWxldGVfMS5EZWxldGVNYW55T3BlcmF0aW9uKHRoaXMsIGZpbHRlciwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbmFtZSB0aGUgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBvcGVyYXRpb24gZG9lcyBub3QgaW5oZXJpdCBvcHRpb25zIGZyb20gdGhlIERiIG9yIE1vbmdvQ2xpZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIG5ld05hbWUgLSBOZXcgbmFtZSBvZiBvZiB0aGUgY29sbGVjdGlvbi5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlbmFtZShuZXdOYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIC8vIEludGVudGlvbmFsbHksIHdlIGRvIG5vdCBpbmhlcml0IG9wdGlvbnMgZnJvbSBwYXJlbnQgZm9yIHRoaXMgb3BlcmF0aW9uLlxuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyByZW5hbWVfMS5SZW5hbWVPcGVyYXRpb24odGhpcywgbmV3TmFtZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5QUklNQVJZXG4gICAgICAgIH0pKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERyb3AgdGhlIGNvbGxlY3Rpb24gZnJvbSB0aGUgZGF0YWJhc2UsIHJlbW92aW5nIGl0IHBlcm1hbmVudGx5LiBOZXcgYWNjZXNzZXMgd2lsbCBjcmVhdGUgYSBuZXcgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgZHJvcChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRyb3BfMS5Ecm9wQ29sbGVjdGlvbk9wZXJhdGlvbih0aGlzLnMuZGIsIHRoaXMuY29sbGVjdGlvbk5hbWUsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgYXN5bmMgZmluZE9uZShmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuZmluZChmaWx0ZXIsIG9wdGlvbnMpLmxpbWl0KC0xKS5iYXRjaFNpemUoMSk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGN1cnNvci5uZXh0KCk7XG4gICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpO1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmaW5kKGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBmaW5kX2N1cnNvcl8xLkZpbmRDdXJzb3IodGhpcy5jbGllbnQsIHRoaXMucy5uYW1lc3BhY2UsIGZpbHRlciwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgb3B0aW9ucyBvZiB0aGUgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgb3B0aW9ucyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IG9wdGlvbnNfb3BlcmF0aW9uXzEuT3B0aW9uc09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBpZiB0aGUgY29sbGVjdGlvbiBpcyBhIGNhcHBlZCBjb2xsZWN0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGlzQ2FwcGVkKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaXNfY2FwcGVkXzEuSXNDYXBwZWRPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gaW5kZXggb24gdGhlIGRiIGFuZCBjb2xsZWN0aW9uIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhTcGVjIC0gVGhlIGZpZWxkIG5hbWUgb3IgaW5kZXggc3BlY2lmaWNhdGlvbiB0byBjcmVhdGUgYW4gaW5kZXggZm9yXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiBjb25zdCBjb2xsZWN0aW9uID0gY2xpZW50LmRiKCdmb28nKS5jb2xsZWN0aW9uKCdiYXInKTtcbiAgICAgKlxuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoeyBhOiAxLCBiOiAtMSB9KTtcbiAgICAgKlxuICAgICAqIC8vIEFsdGVybmF0ZSBzeW50YXggZm9yIHsgYzogMSwgZDogLTEgfSB0aGF0IGVuc3VyZXMgb3JkZXIgb2YgaW5kZXhlc1xuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoWyBbYywgMV0sIFtkLCAtMV0gXSk7XG4gICAgICpcbiAgICAgKiAvLyBFcXVpdmFsZW50IHRvIHsgZTogMSB9XG4gICAgICogYXdhaXQgY29sbGVjdGlvbi5jcmVhdGVJbmRleCgnZScpO1xuICAgICAqXG4gICAgICogLy8gRXF1aXZhbGVudCB0byB7IGY6IDEsIGc6IDEgfVxuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoWydmJywgJ2cnXSlcbiAgICAgKlxuICAgICAqIC8vIEVxdWl2YWxlbnQgdG8geyBoOiAxLCBpOiAtMSB9XG4gICAgICogYXdhaXQgY29sbGVjdGlvbi5jcmVhdGVJbmRleChbIHsgaDogMSB9LCB7IGk6IC0xIH0gXSk7XG4gICAgICpcbiAgICAgKiAvLyBFcXVpdmFsZW50IHRvIHsgajogMSwgazogLTEsIGw6IDJkIH1cbiAgICAgKiBhd2FpdCBjb2xsZWN0aW9uLmNyZWF0ZUluZGV4KFsnaicsIFsnaycsIC0xXSwgeyBsOiAnMmQnIH1dKVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUluZGV4KGluZGV4U3BlYywgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBpbmRleGVzID0gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIGluZGV4ZXNfMS5DcmVhdGVJbmRleGVzT3BlcmF0aW9uLmZyb21JbmRleFNwZWNpZmljYXRpb24odGhpcywgdGhpcy5jb2xsZWN0aW9uTmFtZSwgaW5kZXhTcGVjLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICAgICAgcmV0dXJuIGluZGV4ZXNbMF07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgbXVsdGlwbGUgaW5kZXhlcyBpbiB0aGUgY29sbGVjdGlvbiwgdGhpcyBtZXRob2QgaXMgb25seSBzdXBwb3J0ZWQgZm9yXG4gICAgICogTW9uZ29EQiAyLjYgb3IgaGlnaGVyLiBFYXJsaWVyIHZlcnNpb24gb2YgTW9uZ29EQiB3aWxsIHRocm93IGEgY29tbWFuZCBub3Qgc3VwcG9ydGVkXG4gICAgICogZXJyb3IuXG4gICAgICpcbiAgICAgKiAqKk5vdGUqKjogVW5saWtlIHtAbGluayBDb2xsZWN0aW9uI2NyZWF0ZUluZGV4fCBjcmVhdGVJbmRleH0sIHRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gcmF3IGluZGV4IHNwZWNpZmljYXRpb25zLlxuICAgICAqIEluZGV4IHNwZWNpZmljYXRpb25zIGFyZSBkZWZpbmVkIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvY29tbWFuZC9jcmVhdGVJbmRleGVzL3wgaGVyZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhTcGVjcyAtIEFuIGFycmF5IG9mIGluZGV4IHNwZWNpZmljYXRpb25zIHRvIGJlIGNyZWF0ZWRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIGNvbnN0IGNvbGxlY3Rpb24gPSBjbGllbnQuZGIoJ2ZvbycpLmNvbGxlY3Rpb24oJ2JhcicpO1xuICAgICAqIGF3YWl0IGNvbGxlY3Rpb24uY3JlYXRlSW5kZXhlcyhbXG4gICAgICogICAvLyBTaW1wbGUgaW5kZXggb24gZmllbGQgZml6elxuICAgICAqICAge1xuICAgICAqICAgICBrZXk6IHsgZml6ejogMSB9LFxuICAgICAqICAgfVxuICAgICAqICAgLy8gd2lsZGNhcmQgaW5kZXhcbiAgICAgKiAgIHtcbiAgICAgKiAgICAga2V5OiB7ICckKionOiAxIH1cbiAgICAgKiAgIH0sXG4gICAgICogICAvLyBuYW1lZCBpbmRleCBvbiBkYXJtb2sgYW5kIGphbGFkXG4gICAgICogICB7XG4gICAgICogICAgIGtleTogeyBkYXJtb2s6IDEsIGphbGFkOiAtMSB9XG4gICAgICogICAgIG5hbWU6ICd0YW5hZ3JhJ1xuICAgICAqICAgfVxuICAgICAqIF0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUluZGV4ZXMoaW5kZXhTcGVjcywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIGluZGV4ZXNfMS5DcmVhdGVJbmRleGVzT3BlcmF0aW9uLmZyb21JbmRleERlc2NyaXB0aW9uQXJyYXkodGhpcywgdGhpcy5jb2xsZWN0aW9uTmFtZSwgaW5kZXhTcGVjcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIHsgLi4ub3B0aW9ucywgbWF4VGltZU1TOiB1bmRlZmluZWQgfSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRHJvcHMgYW4gaW5kZXggZnJvbSB0aGlzIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhOYW1lIC0gTmFtZSBvZiB0aGUgaW5kZXggdG8gZHJvcC5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGRyb3BJbmRleChpbmRleE5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5kZXhlc18xLkRyb3BJbmRleE9wZXJhdGlvbih0aGlzLCBpbmRleE5hbWUsIHtcbiAgICAgICAgICAgIC4uLigwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSxcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRHJvcHMgYWxsIGluZGV4ZXMgZnJvbSB0aGlzIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGRyb3BJbmRleGVzKG9wdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgaW5kZXhlc18xLkRyb3BJbmRleE9wZXJhdGlvbih0aGlzLCAnKicsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtNjUxNyk6IERyaXZlciBzaG91bGQgb25seSBmaWx0ZXIgZm9yIG5hbWVzcGFjZSBub3QgZm91bmQgZXJyb3IuIE90aGVyIGVycm9ycyBzaG91bGQgYmUgdGhyb3duLlxuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcilcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGxpc3Qgb2YgYWxsIGluZGV4ZXMgaW5mb3JtYXRpb24gZm9yIHRoZSBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBsaXN0SW5kZXhlcyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgbGlzdF9pbmRleGVzX2N1cnNvcl8xLkxpc3RJbmRleGVzQ3Vyc29yKHRoaXMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBvbmUgb3IgbW9yZSBpbmRleGVzIGV4aXN0IG9uIHRoZSBjb2xsZWN0aW9uLCBmYWlscyBvbiBmaXJzdCBub24tZXhpc3RpbmcgaW5kZXhcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmRleGVzIC0gT25lIG9yIG1vcmUgaW5kZXggbmFtZXMgdG8gY2hlY2suXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBpbmRleEV4aXN0cyhpbmRleGVzLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGluZGV4TmFtZXMgPSBBcnJheS5pc0FycmF5KGluZGV4ZXMpID8gaW5kZXhlcyA6IFtpbmRleGVzXTtcbiAgICAgICAgY29uc3QgYWxsSW5kZXhlcyA9IG5ldyBTZXQoYXdhaXQgdGhpcy5saXN0SW5kZXhlcyhvcHRpb25zKVxuICAgICAgICAgICAgLm1hcCgoeyBuYW1lIH0pID0+IG5hbWUpXG4gICAgICAgICAgICAudG9BcnJheSgpKTtcbiAgICAgICAgcmV0dXJuIGluZGV4TmFtZXMuZXZlcnkobmFtZSA9PiBhbGxJbmRleGVzLmhhcyhuYW1lKSk7XG4gICAgfVxuICAgIGFzeW5jIGluZGV4SW5mb3JtYXRpb24ob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5pbmRleGVzKHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBmdWxsOiBvcHRpb25zPy5mdWxsID8/IGZhbHNlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIGFuIGVzdGltYXRlIG9mIHRoZSBjb3VudCBvZiBkb2N1bWVudHMgaW4gYSBjb2xsZWN0aW9uIHVzaW5nIGNvbGxlY3Rpb24gbWV0YWRhdGEuXG4gICAgICogVGhpcyB3aWxsIGFsd2F5cyBydW4gYSBjb3VudCBjb21tYW5kIG9uIGFsbCBzZXJ2ZXIgdmVyc2lvbnMuXG4gICAgICpcbiAgICAgKiBkdWUgdG8gYW4gb3ZlcnNpZ2h0IGluIHZlcnNpb25zIDUuMC4wLTUuMC44IG9mIE1vbmdvREIsIHRoZSBjb3VudCBjb21tYW5kLFxuICAgICAqIHdoaWNoIGVzdGltYXRlZERvY3VtZW50Q291bnQgdXNlcyBpbiBpdHMgaW1wbGVtZW50YXRpb24sIHdhcyBub3QgaW5jbHVkZWQgaW4gdjEgb2ZcbiAgICAgKiB0aGUgU3RhYmxlIEFQSSwgYW5kIHNvIHVzZXJzIG9mIHRoZSBTdGFibGUgQVBJIHdpdGggZXN0aW1hdGVkRG9jdW1lbnRDb3VudCBhcmVcbiAgICAgKiByZWNvbW1lbmRlZCB0byB1cGdyYWRlIHRoZWlyIHNlcnZlciB2ZXJzaW9uIHRvIDUuMC45KyBvciBzZXQgYXBpU3RyaWN0OiBmYWxzZSB0byBhdm9pZFxuICAgICAqIGVuY291bnRlcmluZyBlcnJvcnMuXG4gICAgICpcbiAgICAgKiBAc2VlIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvY29tbWFuZC9jb3VudC8jYmVoYXZpb3J8Q291bnQ6IEJlaGF2aW9yfVxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgZXN0aW1hdGVkRG9jdW1lbnRDb3VudChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGVzdGltYXRlZF9kb2N1bWVudF9jb3VudF8xLkVzdGltYXRlZERvY3VtZW50Q291bnRPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgbWF0Y2hpbmcgdGhlIGZpbHRlci5cbiAgICAgKiBGb3IgYSBmYXN0IGNvdW50IG9mIHRoZSB0b3RhbCBkb2N1bWVudHMgaW4gYSBjb2xsZWN0aW9uIHNlZSB7QGxpbmsgQ29sbGVjdGlvbiNlc3RpbWF0ZWREb2N1bWVudENvdW50fCBlc3RpbWF0ZWREb2N1bWVudENvdW50fS5cbiAgICAgKlxuICAgICAqIER1ZSB0byBjb3VudERvY3VtZW50cyB1c2luZyB0aGUgJG1hdGNoIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lIHN0YWdlLCBjZXJ0YWluIHF1ZXJ5IG9wZXJhdG9ycyBjYW5ub3QgYmUgdXNlZCBpbiBjb3VudERvY3VtZW50cy4gVGhpcyBpbmNsdWRlcyB0aGUgJHdoZXJlIGFuZCAkbmVhciBxdWVyeSBvcGVyYXRvcnMsIGFtb25nIG90aGVycy4gRGV0YWlscyBjYW4gYmUgZm91bmQgaW4gdGhlIGRvY3VtZW50YXRpb24gZm9yIHRoZSAkbWF0Y2ggYWdncmVnYXRpb24gcGlwZWxpbmUgc3RhZ2UuXG4gICAgICpcbiAgICAgKiAqKk5vdGUqKjogV2hlbiBtaWdyYXRpbmcgZnJvbSB7QGxpbmsgQ29sbGVjdGlvbiNjb3VudHwgY291bnR9IHRvIHtAbGluayBDb2xsZWN0aW9uI2NvdW50RG9jdW1lbnRzfCBjb3VudERvY3VtZW50c31cbiAgICAgKiB0aGUgZm9sbG93aW5nIHF1ZXJ5IG9wZXJhdG9ycyBtdXN0IGJlIHJlcGxhY2VkOlxuICAgICAqXG4gICAgICogfCBPcGVyYXRvciB8IFJlcGxhY2VtZW50IHxcbiAgICAgKiB8IC0tLS0tLS0tIHwgLS0tLS0tLS0tLS0gfFxuICAgICAqIHwgYCR3aGVyZWAgICB8IFtgJGV4cHJgXVsxXSB8XG4gICAgICogfCBgJG5lYXJgICAgIHwgW2AkZ2VvV2l0aGluYF1bMl0gd2l0aCBbYCRjZW50ZXJgXVszXSB8XG4gICAgICogfCBgJG5lYXJTcGhlcmVgIHwgW2AkZ2VvV2l0aGluYF1bMl0gd2l0aCBbYCRjZW50ZXJTcGhlcmVgXVs0XSB8XG4gICAgICpcbiAgICAgKiBbMV06IGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9xdWVyeS9leHByL1xuICAgICAqIFsyXTogaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL3F1ZXJ5L2dlb1dpdGhpbi9cbiAgICAgKiBbM106IGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9xdWVyeS9jZW50ZXIvI29wLl9TX2NlbnRlclxuICAgICAqIFs0XTogaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL3F1ZXJ5L2NlbnRlclNwaGVyZS8jb3AuX1NfY2VudGVyU3BoZXJlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmlsdGVyIC0gVGhlIGZpbHRlciBmb3IgdGhlIGNvdW50XG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKlxuICAgICAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL3F1ZXJ5L2V4cHIvXG4gICAgICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvcXVlcnkvZ2VvV2l0aGluL1xuICAgICAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL29wZXJhdG9yL3F1ZXJ5L2NlbnRlci8jb3AuX1NfY2VudGVyXG4gICAgICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvcXVlcnkvY2VudGVyU3BoZXJlLyNvcC5fU19jZW50ZXJTcGhlcmVcbiAgICAgKi9cbiAgICBhc3luYyBjb3VudERvY3VtZW50cyhmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHBpcGVsaW5lID0gW107XG4gICAgICAgIHBpcGVsaW5lLnB1c2goeyAkbWF0Y2g6IGZpbHRlciB9KTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnNraXAgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBwaXBlbGluZS5wdXNoKHsgJHNraXA6IG9wdGlvbnMuc2tpcCB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMubGltaXQgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBwaXBlbGluZS5wdXNoKHsgJGxpbWl0OiBvcHRpb25zLmxpbWl0IH0pO1xuICAgICAgICB9XG4gICAgICAgIHBpcGVsaW5lLnB1c2goeyAkZ3JvdXA6IHsgX2lkOiAxLCBuOiB7ICRzdW06IDEgfSB9IH0pO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmFnZ3JlZ2F0ZShwaXBlbGluZSwgb3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGRvYyA9IGF3YWl0IGN1cnNvci5uZXh0KCk7XG4gICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpO1xuICAgICAgICByZXR1cm4gZG9jPy5uID8/IDA7XG4gICAgfVxuICAgIGFzeW5jIGRpc3RpbmN0KGtleSwgZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBkaXN0aW5jdF8xLkRpc3RpbmN0T3BlcmF0aW9uKHRoaXMsIGtleSwgZmlsdGVyLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgYXN5bmMgaW5kZXhlcyhvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGluZGV4ZXMgPSBhd2FpdCB0aGlzLmxpc3RJbmRleGVzKG9wdGlvbnMpLnRvQXJyYXkoKTtcbiAgICAgICAgY29uc3QgZnVsbCA9IG9wdGlvbnM/LmZ1bGwgPz8gdHJ1ZTtcbiAgICAgICAgaWYgKGZ1bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBpbmRleGVzO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9iamVjdCA9IE9iamVjdC5mcm9tRW50cmllcyhpbmRleGVzLm1hcCgoeyBuYW1lLCBrZXkgfSkgPT4gW25hbWUsIE9iamVjdC5lbnRyaWVzKGtleSldKSk7XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuICAgIGFzeW5jIGZpbmRPbmVBbmREZWxldGUoZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGZpbmRfYW5kX21vZGlmeV8xLkZpbmRPbmVBbmREZWxldGVPcGVyYXRpb24odGhpcywgZmlsdGVyLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgYXN5bmMgZmluZE9uZUFuZFJlcGxhY2UoZmlsdGVyLCByZXBsYWNlbWVudCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBmaW5kX2FuZF9tb2RpZnlfMS5GaW5kT25lQW5kUmVwbGFjZU9wZXJhdGlvbih0aGlzLCBmaWx0ZXIsIHJlcGxhY2VtZW50LCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgYXN5bmMgZmluZE9uZUFuZFVwZGF0ZShmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBmaW5kX2FuZF9tb2RpZnlfMS5GaW5kT25lQW5kVXBkYXRlT3BlcmF0aW9uKHRoaXMsIGZpbHRlciwgdXBkYXRlLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhbiBhZ2dyZWdhdGlvbiBmcmFtZXdvcmsgcGlwZWxpbmUgYWdhaW5zdCB0aGUgY29sbGVjdGlvbiwgbmVlZHMgTW9uZ29EQiBcXD49IDIuMlxuICAgICAqXG4gICAgICogQHBhcmFtIHBpcGVsaW5lIC0gQW4gYXJyYXkgb2YgYWdncmVnYXRpb24gcGlwZWxpbmVzIHRvIGV4ZWN1dGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFnZ3JlZ2F0ZShwaXBlbGluZSA9IFtdLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShwaXBlbGluZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0FyZ3VtZW50IFwicGlwZWxpbmVcIiBtdXN0IGJlIGFuIGFycmF5IG9mIGFnZ3JlZ2F0aW9uIHN0YWdlcycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgYWdncmVnYXRpb25fY3Vyc29yXzEuQWdncmVnYXRpb25DdXJzb3IodGhpcy5jbGllbnQsIHRoaXMucy5uYW1lc3BhY2UsIHBpcGVsaW5lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbmdlIFN0cmVhbSwgd2F0Y2hpbmcgZm9yIG5ldyBjaGFuZ2VzIChpbnNlcnRpb25zLCB1cGRhdGVzLCByZXBsYWNlbWVudHMsIGRlbGV0aW9ucywgYW5kIGludmFsaWRhdGlvbnMpIGluIHRoaXMgY29sbGVjdGlvbi5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogd2F0Y2goKSBhY2NlcHRzIHR3byBnZW5lcmljIGFyZ3VtZW50cyBmb3IgZGlzdGluY3QgdXNlIGNhc2VzOlxuICAgICAqIC0gVGhlIGZpcnN0IGlzIHRvIG92ZXJyaWRlIHRoZSBzY2hlbWEgdGhhdCBtYXkgYmUgZGVmaW5lZCBmb3IgdGhpcyBzcGVjaWZpYyBjb2xsZWN0aW9uXG4gICAgICogLSBUaGUgc2Vjb25kIGlzIHRvIG92ZXJyaWRlIHRoZSBzaGFwZSBvZiB0aGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBlbnRpcmVseSwgaWYgaXQgaXMgbm90IHByb3ZpZGVkIHRoZSB0eXBlIHdpbGwgZGVmYXVsdCB0byBDaGFuZ2VTdHJlYW1Eb2N1bWVudCBvZiB0aGUgZmlyc3QgYXJndW1lbnRcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIEJ5IGp1c3QgcHJvdmlkaW5nIHRoZSBmaXJzdCBhcmd1bWVudCBJIGNhbiB0eXBlIHRoZSBjaGFuZ2UgdG8gYmUgYENoYW5nZVN0cmVhbURvY3VtZW50PHsgX2lkOiBudW1iZXIgfT5gXG4gICAgICogYGBgdHNcbiAgICAgKiBjb2xsZWN0aW9uLndhdGNoPHsgX2lkOiBudW1iZXIgfT4oKVxuICAgICAqICAgLm9uKCdjaGFuZ2UnLCBjaGFuZ2UgPT4gY29uc29sZS5sb2coY2hhbmdlLl9pZC50b0ZpeGVkKDQpKSk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIFBhc3NpbmcgYSBzZWNvbmQgYXJndW1lbnQgcHJvdmlkZXMgYSB3YXkgdG8gcmVmbGVjdCB0aGUgdHlwZSBjaGFuZ2VzIGNhdXNlZCBieSBhbiBhZHZhbmNlZCBwaXBlbGluZS5cbiAgICAgKiBIZXJlLCB3ZSBhcmUgdXNpbmcgYSBwaXBlbGluZSB0byBoYXZlIE1vbmdvREIgZmlsdGVyIGZvciBpbnNlcnQgY2hhbmdlcyBvbmx5IGFuZCBhZGQgYSBjb21tZW50LlxuICAgICAqIE5vIG5lZWQgc3RhcnQgZnJvbSBzY3JhdGNoIG9uIHRoZSBDaGFuZ2VTdHJlYW1JbnNlcnREb2N1bWVudCB0eXBlIVxuICAgICAqIEJ5IHVzaW5nIGFuIGludGVyc2VjdGlvbiB3ZSBjYW4gc2F2ZSB0aW1lIGFuZCBlbnN1cmUgZGVmYXVsdHMgcmVtYWluIHRoZSBzYW1lIHR5cGUhXG4gICAgICogYGBgdHNcbiAgICAgKiBjb2xsZWN0aW9uXG4gICAgICogICAud2F0Y2g8U2NoZW1hLCBDaGFuZ2VTdHJlYW1JbnNlcnREb2N1bWVudDxTY2hlbWE+ICYgeyBjb21tZW50OiBzdHJpbmcgfT4oW1xuICAgICAqICAgICB7ICRhZGRGaWVsZHM6IHsgY29tbWVudDogJ2JpZyBjaGFuZ2VzJyB9IH0sXG4gICAgICogICAgIHsgJG1hdGNoOiB7IG9wZXJhdGlvblR5cGU6ICdpbnNlcnQnIH0gfVxuICAgICAqICAgXSlcbiAgICAgKiAgIC5vbignY2hhbmdlJywgY2hhbmdlID0+IHtcbiAgICAgKiAgICAgY2hhbmdlLmNvbW1lbnQuc3RhcnRzV2l0aCgnYmlnJyk7XG4gICAgICogICAgIGNoYW5nZS5vcGVyYXRpb25UeXBlID09PSAnaW5zZXJ0JztcbiAgICAgKiAgICAgLy8gTm8gbmVlZCB0byBuYXJyb3cgaW4gY29kZSBiZWNhdXNlIHRoZSBnZW5lcmljcyBkaWQgdGhhdCBmb3IgdXMhXG4gICAgICogICAgIGV4cGVjdFR5cGU8U2NoZW1hPihjaGFuZ2UuZnVsbERvY3VtZW50KTtcbiAgICAgKiAgIH0pO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBXaGVuIGB0aW1lb3V0TVNgIGlzIGNvbmZpZ3VyZWQgZm9yIGEgY2hhbmdlIHN0cmVhbSwgaXQgd2lsbCBoYXZlIGRpZmZlcmVudCBiZWhhdmlvdXIgZGVwZW5kaW5nXG4gICAgICogb24gd2hldGhlciB0aGUgY2hhbmdlIHN0cmVhbSBpcyBpbiBpdGVyYXRvciBtb2RlIG9yIGVtaXR0ZXIgbW9kZS4gSW4gYm90aCBjYXNlcywgYSBjaGFuZ2VcbiAgICAgKiBzdHJlYW0gd2lsbCB0aW1lIG91dCBpZiBpdCBkb2VzIG5vdCByZWNlaXZlIGEgY2hhbmdlIGV2ZW50IHdpdGhpbiBgdGltZW91dE1TYCBvZiB0aGUgbGFzdCBjaGFuZ2VcbiAgICAgKiBldmVudC5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBpZiBhIGNoYW5nZSBzdHJlYW0gaXMgY29uc2lzdGVudGx5IHRpbWluZyBvdXQgd2hlbiB3YXRjaGluZyBhIGNvbGxlY3Rpb24sIGRhdGFiYXNlIG9yXG4gICAgICogY2xpZW50IHRoYXQgaXMgYmVpbmcgY2hhbmdlZCwgdGhlbiB0aGlzIG1heSBiZSBkdWUgdG8gdGhlIHNlcnZlciB0aW1pbmcgb3V0IGJlZm9yZSBpdCBjYW4gZmluaXNoXG4gICAgICogcHJvY2Vzc2luZyB0aGUgZXhpc3Rpbmcgb3Bsb2cuIFRvIGFkZHJlc3MgdGhpcywgcmVzdGFydCB0aGUgY2hhbmdlIHN0cmVhbSB3aXRoIGEgaGlnaGVyXG4gICAgICogYHRpbWVvdXRNU2AuXG4gICAgICpcbiAgICAgKiBJZiB0aGUgY2hhbmdlIHN0cmVhbSB0aW1lcyBvdXQgdGhlIGluaXRpYWwgYWdncmVnYXRlIG9wZXJhdGlvbiB0byBlc3RhYmxpc2ggdGhlIGNoYW5nZSBzdHJlYW0gb25cbiAgICAgKiB0aGUgc2VydmVyLCB0aGVuIHRoZSBjbGllbnQgd2lsbCBjbG9zZSB0aGUgY2hhbmdlIHN0cmVhbS4gSWYgdGhlIGdldE1vcmUgY2FsbHMgdG8gdGhlIHNlcnZlclxuICAgICAqIHRpbWUgb3V0LCB0aGVuIHRoZSBjaGFuZ2Ugc3RyZWFtIHdpbGwgYmUgbGVmdCBvcGVuLCBidXQgd2lsbCB0aHJvdyBhIE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yXG4gICAgICogd2hlbiBpbiBpdGVyYXRvciBtb2RlIGFuZCBlbWl0IGFuIGVycm9yIGV2ZW50IHRoYXQgcmV0dXJucyBhIE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yIGluXG4gICAgICogZW1pdHRlciBtb2RlLlxuICAgICAqXG4gICAgICogVG8gZGV0ZXJtaW5lIHdoZXRoZXIgb3Igbm90IHRoZSBjaGFuZ2Ugc3RyZWFtIGlzIHN0aWxsIG9wZW4gZm9sbG93aW5nIGEgdGltZW91dCwgY2hlY2sgdGhlXG4gICAgICoge0BsaW5rIENoYW5nZVN0cmVhbS5jbG9zZWR9IGdldHRlci5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogSW4gaXRlcmF0b3IgbW9kZSwgaWYgYSBuZXh0KCkgY2FsbCB0aHJvd3MgYSB0aW1lb3V0IGVycm9yLCBpdCB3aWxsIGF0dGVtcHQgdG8gcmVzdW1lIHRoZSBjaGFuZ2Ugc3RyZWFtLlxuICAgICAqIFRoZSBuZXh0IGNhbGwgY2FuIGp1c3QgYmUgcmV0cmllZCBhZnRlciB0aGlzIHN1Y2NlZWRzLlxuICAgICAqIGBgYHRzXG4gICAgICogY29uc3QgY2hhbmdlU3RyZWFtID0gY29sbGVjdGlvbi53YXRjaChbXSwgeyB0aW1lb3V0TVM6IDEwMCB9KTtcbiAgICAgKiB0cnkge1xuICAgICAqICAgICBhd2FpdCBjaGFuZ2VTdHJlYW0ubmV4dCgpO1xuICAgICAqIH0gY2F0Y2ggKGUpIHtcbiAgICAgKiAgICAgaWYgKGUgaW5zdGFuY2VvZiBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvciAmJiAhY2hhbmdlU3RyZWFtLmNsb3NlZCkge1xuICAgICAqICAgICAgIGF3YWl0IGNoYW5nZVN0cmVhbS5uZXh0KCk7XG4gICAgICogICAgIH1cbiAgICAgKiAgICAgdGhyb3cgZTtcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIEluIGVtaXR0ZXIgbW9kZSwgaWYgdGhlIGNoYW5nZSBzdHJlYW0gZ29lcyBgdGltZW91dE1TYCB3aXRob3V0IGVtaXR0aW5nIGEgY2hhbmdlIGV2ZW50LCBpdCB3aWxsXG4gICAgICogZW1pdCBhbiBlcnJvciBldmVudCB0aGF0IHJldHVybnMgYSBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvciwgYnV0IHdpbGwgbm90IGNsb3NlIHRoZSBjaGFuZ2VcbiAgICAgKiBzdHJlYW0gdW5sZXNzIHRoZSByZXN1bWUgYXR0ZW1wdCBmYWlscy4gVGhlcmUgaXMgbm8gbmVlZCB0byByZS1lc3RhYmxpc2ggY2hhbmdlIGxpc3RlbmVycyBhc1xuICAgICAqIHRoaXMgd2lsbCBhdXRvbWF0aWNhbGx5IGNvbnRpbnVlIGVtaXR0aW5nIGNoYW5nZSBldmVudHMgb25jZSB0aGUgcmVzdW1lIGF0dGVtcHQgY29tcGxldGVzLlxuICAgICAqXG4gICAgICogYGBgdHNcbiAgICAgKiBjb25zdCBjaGFuZ2VTdHJlYW0gPSBjb2xsZWN0aW9uLndhdGNoKFtdLCB7IHRpbWVvdXRNUzogMTAwIH0pO1xuICAgICAqIGNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgY29uc29sZS5sb2cpO1xuICAgICAqIGNoYW5nZVN0cmVhbS5vbignZXJyb3InLCBlID0+IHtcbiAgICAgKiAgICAgaWYgKGUgaW5zdGFuY2VvZiBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvciAmJiAhY2hhbmdlU3RyZWFtLmNsb3NlZCkge1xuICAgICAqICAgICAgICAgLy8gZG8gbm90aGluZ1xuICAgICAqICAgICB9IGVsc2Uge1xuICAgICAqICAgICAgICAgY2hhbmdlU3RyZWFtLmNsb3NlKCk7XG4gICAgICogICAgIH1cbiAgICAgKiB9KTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBwaXBlbGluZSAtIEFuIGFycmF5IG9mIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvYWdncmVnYXRpb24tcGlwZWxpbmUvfGFnZ3JlZ2F0aW9uIHBpcGVsaW5lIHN0YWdlc30gdGhyb3VnaCB3aGljaCB0byBwYXNzIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzLiBUaGlzIGFsbG93cyBmb3IgZmlsdGVyaW5nICh1c2luZyAkbWF0Y2gpIGFuZCBtYW5pcHVsYXRpbmcgdGhlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICogQHR5cGVQYXJhbSBUTG9jYWwgLSBUeXBlIG9mIHRoZSBkYXRhIGJlaW5nIGRldGVjdGVkIGJ5IHRoZSBjaGFuZ2Ugc3RyZWFtXG4gICAgICogQHR5cGVQYXJhbSBUQ2hhbmdlIC0gVHlwZSBvZiB0aGUgd2hvbGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBlbWl0dGVkXG4gICAgICovXG4gICAgd2F0Y2gocGlwZWxpbmUgPSBbXSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIC8vIEFsbG93IG9wdGlvbmFsbHkgbm90IHNwZWNpZnlpbmcgYSBwaXBlbGluZVxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGlwZWxpbmUpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gcGlwZWxpbmU7XG4gICAgICAgICAgICBwaXBlbGluZSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbSh0aGlzLCBwaXBlbGluZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5pdGlhdGUgYW4gT3V0IG9mIG9yZGVyIGJhdGNoIHdyaXRlIG9wZXJhdGlvbi4gQWxsIG9wZXJhdGlvbnMgd2lsbCBiZSBidWZmZXJlZCBpbnRvIGluc2VydC91cGRhdGUvcmVtb3ZlIGNvbW1hbmRzIGV4ZWN1dGVkIG91dCBvZiBvcmRlci5cbiAgICAgKlxuICAgICAqIEB0aHJvd3MgTW9uZ29Ob3RDb25uZWN0ZWRFcnJvclxuICAgICAqIEByZW1hcmtzXG4gICAgICogKipOT1RFOioqIE1vbmdvQ2xpZW50IG11c3QgYmUgY29ubmVjdGVkIHByaW9yIHRvIGNhbGxpbmcgdGhpcyBtZXRob2QgZHVlIHRvIGEga25vd24gbGltaXRhdGlvbiBpbiB0aGlzIGxlZ2FjeSBpbXBsZW1lbnRhdGlvbi5cbiAgICAgKiBIb3dldmVyLCBgY29sbGVjdGlvbi5idWxrV3JpdGUoKWAgcHJvdmlkZXMgYW4gZXF1aXZhbGVudCBBUEkgdGhhdCBkb2VzIG5vdCByZXF1aXJlIHByaW9yIGNvbm5lY3RpbmcuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZVVub3JkZXJlZEJ1bGtPcChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgdW5vcmRlcmVkXzEuVW5vcmRlcmVkQnVsa09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbml0aWF0ZSBhbiBJbiBvcmRlciBidWxrIHdyaXRlIG9wZXJhdGlvbi4gT3BlcmF0aW9ucyB3aWxsIGJlIHNlcmlhbGx5IGV4ZWN1dGVkIGluIHRoZSBvcmRlciB0aGV5IGFyZSBhZGRlZCwgY3JlYXRpbmcgYSBuZXcgb3BlcmF0aW9uIGZvciBlYWNoIHN3aXRjaCBpbiB0eXBlcy5cbiAgICAgKlxuICAgICAqIEB0aHJvd3MgTW9uZ29Ob3RDb25uZWN0ZWRFcnJvclxuICAgICAqIEByZW1hcmtzXG4gICAgICogKipOT1RFOioqIE1vbmdvQ2xpZW50IG11c3QgYmUgY29ubmVjdGVkIHByaW9yIHRvIGNhbGxpbmcgdGhpcyBtZXRob2QgZHVlIHRvIGEga25vd24gbGltaXRhdGlvbiBpbiB0aGlzIGxlZ2FjeSBpbXBsZW1lbnRhdGlvbi5cbiAgICAgKiBIb3dldmVyLCBgY29sbGVjdGlvbi5idWxrV3JpdGUoKWAgcHJvdmlkZXMgYW4gZXF1aXZhbGVudCBBUEkgdGhhdCBkb2VzIG5vdCByZXF1aXJlIHByaW9yIGNvbm5lY3RpbmcuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZU9yZGVyZWRCdWxrT3Aob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IG9yZGVyZWRfMS5PcmRlcmVkQnVsa09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBbiBlc3RpbWF0ZWQgY291bnQgb2YgbWF0Y2hpbmcgZG9jdW1lbnRzIGluIHRoZSBkYiB0byBhIGZpbHRlci5cbiAgICAgKlxuICAgICAqICoqTk9URToqKiBUaGlzIG1ldGhvZCBoYXMgYmVlbiBkZXByZWNhdGVkLCBzaW5jZSBpdCBkb2VzIG5vdCBwcm92aWRlIGFuIGFjY3VyYXRlIGNvdW50IG9mIHRoZSBkb2N1bWVudHNcbiAgICAgKiBpbiBhIGNvbGxlY3Rpb24uIFRvIG9idGFpbiBhbiBhY2N1cmF0ZSBjb3VudCBvZiBkb2N1bWVudHMgaW4gdGhlIGNvbGxlY3Rpb24sIHVzZSB7QGxpbmsgQ29sbGVjdGlvbiNjb3VudERvY3VtZW50c3wgY291bnREb2N1bWVudHN9LlxuICAgICAqIFRvIG9idGFpbiBhbiBlc3RpbWF0ZWQgY291bnQgb2YgYWxsIGRvY3VtZW50cyBpbiB0aGUgY29sbGVjdGlvbiwgdXNlIHtAbGluayBDb2xsZWN0aW9uI2VzdGltYXRlZERvY3VtZW50Q291bnR8IGVzdGltYXRlZERvY3VtZW50Q291bnR9LlxuICAgICAqXG4gICAgICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayBDb2xsZWN0aW9uI2NvdW50RG9jdW1lbnRzfCBjb3VudERvY3VtZW50c30gb3Ige0BsaW5rIENvbGxlY3Rpb24jZXN0aW1hdGVkRG9jdW1lbnRDb3VudHwgZXN0aW1hdGVkRG9jdW1lbnRDb3VudH0gaW5zdGVhZFxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbHRlciAtIFRoZSBmaWx0ZXIgZm9yIHRoZSBjb3VudC5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGNvdW50KGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgY291bnRfMS5Db3VudE9wZXJhdGlvbih0aGlzLmZ1bGxOYW1lc3BhY2UsIGZpbHRlciwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIGxpc3RTZWFyY2hJbmRleGVzKGluZGV4TmFtZU9yT3B0aW9ucywgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID1cbiAgICAgICAgICAgIHR5cGVvZiBpbmRleE5hbWVPck9wdGlvbnMgPT09ICdvYmplY3QnID8gaW5kZXhOYW1lT3JPcHRpb25zIDogb3B0aW9ucyA9PSBudWxsID8ge30gOiBvcHRpb25zO1xuICAgICAgICBjb25zdCBpbmRleE5hbWUgPSBpbmRleE5hbWVPck9wdGlvbnMgPT0gbnVsbFxuICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICA6IHR5cGVvZiBpbmRleE5hbWVPck9wdGlvbnMgPT09ICdvYmplY3QnXG4gICAgICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICAgICAgOiBpbmRleE5hbWVPck9wdGlvbnM7XG4gICAgICAgIHJldHVybiBuZXcgbGlzdF9zZWFyY2hfaW5kZXhlc19jdXJzb3JfMS5MaXN0U2VhcmNoSW5kZXhlc0N1cnNvcih0aGlzLCBpbmRleE5hbWUsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2luZ2xlIHNlYXJjaCBpbmRleCBmb3IgdGhlIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gLSBUaGUgaW5kZXggZGVzY3JpcHRpb24gZm9yIHRoZSBuZXcgc2VhcmNoIGluZGV4LlxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBuYW1lIG9mIHRoZSBuZXcgc2VhcmNoIGluZGV4LlxuICAgICAqXG4gICAgICogQHJlbWFya3MgT25seSBhdmFpbGFibGUgd2hlbiB1c2VkIGFnYWluc3QgYSA3LjArIEF0bGFzIGNsdXN0ZXIuXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlU2VhcmNoSW5kZXgoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgY29uc3QgW2luZGV4XSA9IGF3YWl0IHRoaXMuY3JlYXRlU2VhcmNoSW5kZXhlcyhbZGVzY3JpcHRpb25dKTtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIG11bHRpcGxlIHNlYXJjaCBpbmRleGVzIGZvciB0aGUgY3VycmVudCBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRlc2NyaXB0aW9ucyAtIEFuIGFycmF5IG9mIGBTZWFyY2hJbmRleERlc2NyaXB0aW9uYHMgZm9yIHRoZSBuZXcgc2VhcmNoIGluZGV4ZXMuXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYW4gYXJyYXkgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgc2VhcmNoIGluZGV4IG5hbWVzLlxuICAgICAqXG4gICAgICogQHJlbWFya3MgT25seSBhdmFpbGFibGUgd2hlbiB1c2VkIGFnYWluc3QgYSA3LjArIEF0bGFzIGNsdXN0ZXIuXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBhc3luYyBjcmVhdGVTZWFyY2hJbmRleGVzKGRlc2NyaXB0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBjcmVhdGVfMS5DcmVhdGVTZWFyY2hJbmRleGVzT3BlcmF0aW9uKHRoaXMsIGRlc2NyaXB0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgc2VhcmNoIGluZGV4IGJ5IGluZGV4IG5hbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBzZWFyY2ggaW5kZXggdG8gYmUgZGVsZXRlZC5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzIE9ubHkgYXZhaWxhYmxlIHdoZW4gdXNlZCBhZ2FpbnN0IGEgNy4wKyBBdGxhcyBjbHVzdGVyLlxuICAgICAqL1xuICAgIGFzeW5jIGRyb3BTZWFyY2hJbmRleChuYW1lKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGRyb3BfMi5Ecm9wU2VhcmNoSW5kZXhPcGVyYXRpb24odGhpcywgbmFtZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIGEgc2VhcmNoIGluZGV4IGJ5IHJlcGxhY2luZyB0aGUgZXhpc3RpbmcgaW5kZXggZGVmaW5pdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBkZWZpbml0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc2VhcmNoIGluZGV4IHRvIHVwZGF0ZS5cbiAgICAgKiBAcGFyYW0gZGVmaW5pdGlvbiAtIFRoZSBuZXcgc2VhcmNoIGluZGV4IGRlZmluaXRpb24uXG4gICAgICpcbiAgICAgKiBAcmVtYXJrcyBPbmx5IGF2YWlsYWJsZSB3aGVuIHVzZWQgYWdhaW5zdCBhIDcuMCsgQXRsYXMgY2x1c3Rlci5cbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVTZWFyY2hJbmRleChuYW1lLCBkZWZpbml0aW9uKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHVwZGF0ZV8xLlVwZGF0ZVNlYXJjaEluZGV4T3BlcmF0aW9uKHRoaXMsIG5hbWUsIGRlZmluaXRpb24pKTtcbiAgICB9XG59XG5leHBvcnRzLkNvbGxlY3Rpb24gPSBDb2xsZWN0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29sbGVjdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/connection_string.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/connection_string.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DEFAULT_OPTIONS = exports.OPTIONS = void 0;\nexports.resolveSRVRecord = resolveSRVRecord;\nexports.parseOptions = parseOptions;\nconst dns = __webpack_require__(/*! dns */ \"dns\");\nconst mongodb_connection_string_url_1 = __webpack_require__(/*! mongodb-connection-string-url */ \"(rsc)/./node_modules/.pnpm/mongodb-connection-string-url@3.0.2/node_modules/mongodb-connection-string-url/lib/index.js\");\nconst url_1 = __webpack_require__(/*! url */ \"url\");\nconst mongo_credentials_1 = __webpack_require__(/*! ./cmap/auth/mongo_credentials */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\");\nconst providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst client_metadata_1 = __webpack_require__(/*! ./cmap/handshake/client_metadata */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/handshake/client_metadata.js\");\nconst compression_1 = __webpack_require__(/*! ./cmap/wire_protocol/compression */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nconst encrypter_1 = __webpack_require__(/*! ./encrypter */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/encrypter.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ./mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst monitor_1 = __webpack_require__(/*! ./sdam/monitor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/monitor.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst VALID_TXT_RECORDS = ['authSource', 'replicaSet', 'loadBalanced'];\nconst LB_SINGLE_HOST_ERROR = 'loadBalanced option only supported with a single host in the URI';\nconst LB_REPLICA_SET_ERROR = 'loadBalanced option not supported with a replicaSet option';\nconst LB_DIRECT_CONNECTION_ERROR = 'loadBalanced option not supported when directConnection is provided';\nfunction retryDNSTimeoutFor(api) {\n    return async function dnsReqRetryTimeout(lookupAddress) {\n        try {\n            return await dns.promises[api](lookupAddress);\n        }\n        catch (firstDNSError) {\n            if (firstDNSError.code === dns.TIMEOUT) {\n                return await dns.promises[api](lookupAddress);\n            }\n            else {\n                throw firstDNSError;\n            }\n        }\n    };\n}\nconst resolveSrv = retryDNSTimeoutFor('resolveSrv');\nconst resolveTxt = retryDNSTimeoutFor('resolveTxt');\n/**\n * Lookup a `mongodb+srv` connection string, combine the parts and reparse it as a normal\n * connection string.\n *\n * @param uri - The connection string to parse\n * @param options - Optional user provided connection string options\n */\nasync function resolveSRVRecord(options) {\n    if (typeof options.srvHost !== 'string') {\n        throw new error_1.MongoAPIError('Option \"srvHost\" must not be empty');\n    }\n    // Asynchronously start TXT resolution so that we do not have to wait until\n    // the SRV record is resolved before starting a second DNS query.\n    const lookupAddress = options.srvHost;\n    const txtResolutionPromise = resolveTxt(lookupAddress);\n    txtResolutionPromise.then(undefined, utils_1.squashError); // rejections will be handled later\n    const hostname = `_${options.srvServiceName}._tcp.${lookupAddress}`;\n    // Resolve the SRV record and use the result as the list of hosts to connect to.\n    const addresses = await resolveSrv(hostname);\n    if (addresses.length === 0) {\n        throw new error_1.MongoAPIError('No addresses found at host');\n    }\n    for (const { name } of addresses) {\n        (0, utils_1.checkParentDomainMatch)(name, lookupAddress);\n    }\n    const hostAddresses = addresses.map(r => utils_1.HostAddress.fromString(`${r.name}:${r.port ?? 27017}`));\n    validateLoadBalancedOptions(hostAddresses, options, true);\n    // Use the result of resolving the TXT record and add options from there if they exist.\n    let record;\n    try {\n        record = await txtResolutionPromise;\n    }\n    catch (error) {\n        if (error.code !== 'ENODATA' && error.code !== 'ENOTFOUND') {\n            throw error;\n        }\n        return hostAddresses;\n    }\n    if (record.length > 1) {\n        throw new error_1.MongoParseError('Multiple text records not allowed');\n    }\n    const txtRecordOptions = new url_1.URLSearchParams(record[0].join(''));\n    const txtRecordOptionKeys = [...txtRecordOptions.keys()];\n    if (txtRecordOptionKeys.some(key => !VALID_TXT_RECORDS.includes(key))) {\n        throw new error_1.MongoParseError(`Text record may only set any of: ${VALID_TXT_RECORDS.join(', ')}`);\n    }\n    if (VALID_TXT_RECORDS.some(option => txtRecordOptions.get(option) === '')) {\n        throw new error_1.MongoParseError('Cannot have empty URI params in DNS TXT Record');\n    }\n    const source = txtRecordOptions.get('authSource') ?? undefined;\n    const replicaSet = txtRecordOptions.get('replicaSet') ?? undefined;\n    const loadBalanced = txtRecordOptions.get('loadBalanced') ?? undefined;\n    if (!options.userSpecifiedAuthSource &&\n        source &&\n        options.credentials &&\n        !providers_1.AUTH_MECHS_AUTH_SRC_EXTERNAL.has(options.credentials.mechanism)) {\n        options.credentials = mongo_credentials_1.MongoCredentials.merge(options.credentials, { source });\n    }\n    if (!options.userSpecifiedReplicaSet && replicaSet) {\n        options.replicaSet = replicaSet;\n    }\n    if (loadBalanced === 'true') {\n        options.loadBalanced = true;\n    }\n    if (options.replicaSet && options.srvMaxHosts > 0) {\n        throw new error_1.MongoParseError('Cannot combine replicaSet option with srvMaxHosts');\n    }\n    validateLoadBalancedOptions(hostAddresses, options, true);\n    return hostAddresses;\n}\n/**\n * Checks if TLS options are valid\n *\n * @param allOptions - All options provided by user or included in default options map\n * @throws MongoAPIError if TLS options are invalid\n */\nfunction checkTLSOptions(allOptions) {\n    if (!allOptions)\n        return;\n    const check = (a, b) => {\n        if (allOptions.has(a) && allOptions.has(b)) {\n            throw new error_1.MongoAPIError(`The '${a}' option cannot be used with the '${b}' option`);\n        }\n    };\n    check('tlsInsecure', 'tlsAllowInvalidCertificates');\n    check('tlsInsecure', 'tlsAllowInvalidHostnames');\n    check('tlsInsecure', 'tlsDisableCertificateRevocationCheck');\n    check('tlsInsecure', 'tlsDisableOCSPEndpointCheck');\n    check('tlsAllowInvalidCertificates', 'tlsDisableCertificateRevocationCheck');\n    check('tlsAllowInvalidCertificates', 'tlsDisableOCSPEndpointCheck');\n    check('tlsDisableCertificateRevocationCheck', 'tlsDisableOCSPEndpointCheck');\n}\nfunction getBoolean(name, value) {\n    if (typeof value === 'boolean')\n        return value;\n    switch (value) {\n        case 'true':\n            return true;\n        case 'false':\n            return false;\n        default:\n            throw new error_1.MongoParseError(`${name} must be either \"true\" or \"false\"`);\n    }\n}\nfunction getIntFromOptions(name, value) {\n    const parsedInt = (0, utils_1.parseInteger)(value);\n    if (parsedInt != null) {\n        return parsedInt;\n    }\n    throw new error_1.MongoParseError(`Expected ${name} to be stringified int value, got: ${value}`);\n}\nfunction getUIntFromOptions(name, value) {\n    const parsedValue = getIntFromOptions(name, value);\n    if (parsedValue < 0) {\n        throw new error_1.MongoParseError(`${name} can only be a positive int value, got: ${value}`);\n    }\n    return parsedValue;\n}\nfunction* entriesFromString(value) {\n    if (value === '') {\n        return;\n    }\n    const keyValuePairs = value.split(',');\n    for (const keyValue of keyValuePairs) {\n        const [key, value] = keyValue.split(/:(.*)/);\n        if (value == null) {\n            throw new error_1.MongoParseError('Cannot have undefined values in key value pairs');\n        }\n        yield [key, value];\n    }\n}\nclass CaseInsensitiveMap extends Map {\n    constructor(entries = []) {\n        super(entries.map(([k, v]) => [k.toLowerCase(), v]));\n    }\n    has(k) {\n        return super.has(k.toLowerCase());\n    }\n    get(k) {\n        return super.get(k.toLowerCase());\n    }\n    set(k, v) {\n        return super.set(k.toLowerCase(), v);\n    }\n    delete(k) {\n        return super.delete(k.toLowerCase());\n    }\n}\nfunction parseOptions(uri, mongoClient = undefined, options = {}) {\n    if (mongoClient != null && !(mongoClient instanceof mongo_client_1.MongoClient)) {\n        options = mongoClient;\n        mongoClient = undefined;\n    }\n    // validate BSONOptions\n    if (options.useBigInt64 && typeof options.promoteLongs === 'boolean' && !options.promoteLongs) {\n        throw new error_1.MongoAPIError('Must request either bigint or Long for int64 deserialization');\n    }\n    if (options.useBigInt64 && typeof options.promoteValues === 'boolean' && !options.promoteValues) {\n        throw new error_1.MongoAPIError('Must request either bigint or Long for int64 deserialization');\n    }\n    const url = new mongodb_connection_string_url_1.default(uri);\n    const { hosts, isSRV } = url;\n    const mongoOptions = Object.create(null);\n    mongoOptions.hosts = isSRV ? [] : hosts.map(utils_1.HostAddress.fromString);\n    const urlOptions = new CaseInsensitiveMap();\n    if (url.pathname !== '/' && url.pathname !== '') {\n        const dbName = decodeURIComponent(url.pathname[0] === '/' ? url.pathname.slice(1) : url.pathname);\n        if (dbName) {\n            urlOptions.set('dbName', [dbName]);\n        }\n    }\n    if (url.username !== '') {\n        const auth = {\n            username: decodeURIComponent(url.username)\n        };\n        if (typeof url.password === 'string') {\n            auth.password = decodeURIComponent(url.password);\n        }\n        urlOptions.set('auth', [auth]);\n    }\n    for (const key of url.searchParams.keys()) {\n        const values = url.searchParams.getAll(key);\n        const isReadPreferenceTags = /readPreferenceTags/i.test(key);\n        if (!isReadPreferenceTags && values.length > 1) {\n            throw new error_1.MongoInvalidArgumentError(`URI option \"${key}\" cannot appear more than once in the connection string`);\n        }\n        if (!isReadPreferenceTags && values.includes('')) {\n            throw new error_1.MongoAPIError(`URI option \"${key}\" cannot be specified with no value`);\n        }\n        if (!urlOptions.has(key)) {\n            urlOptions.set(key, values);\n        }\n    }\n    const objectOptions = new CaseInsensitiveMap(Object.entries(options).filter(([, v]) => v != null));\n    // Validate options that can only be provided by one of uri or object\n    if (urlOptions.has('serverApi')) {\n        throw new error_1.MongoParseError('URI cannot contain `serverApi`, it can only be passed to the client');\n    }\n    const uriMechanismProperties = urlOptions.get('authMechanismProperties');\n    if (uriMechanismProperties) {\n        for (const property of uriMechanismProperties) {\n            if (/(^|,)ALLOWED_HOSTS:/.test(property)) {\n                throw new error_1.MongoParseError('Auth mechanism property ALLOWED_HOSTS is not allowed in the connection string.');\n            }\n        }\n    }\n    if (objectOptions.has('loadBalanced')) {\n        throw new error_1.MongoParseError('loadBalanced is only a valid option in the URI');\n    }\n    // All option collection\n    const allProvidedOptions = new CaseInsensitiveMap();\n    const allProvidedKeys = new Set([...urlOptions.keys(), ...objectOptions.keys()]);\n    for (const key of allProvidedKeys) {\n        const values = [];\n        const objectOptionValue = objectOptions.get(key);\n        if (objectOptionValue != null) {\n            values.push(objectOptionValue);\n        }\n        const urlValues = urlOptions.get(key) ?? [];\n        values.push(...urlValues);\n        allProvidedOptions.set(key, values);\n    }\n    if (allProvidedOptions.has('tls') || allProvidedOptions.has('ssl')) {\n        const tlsAndSslOpts = (allProvidedOptions.get('tls') || [])\n            .concat(allProvidedOptions.get('ssl') || [])\n            .map(getBoolean.bind(null, 'tls/ssl'));\n        if (new Set(tlsAndSslOpts).size !== 1) {\n            throw new error_1.MongoParseError('All values of tls/ssl must be the same.');\n        }\n    }\n    checkTLSOptions(allProvidedOptions);\n    const unsupportedOptions = (0, utils_1.setDifference)(allProvidedKeys, Array.from(Object.keys(exports.OPTIONS)).map(s => s.toLowerCase()));\n    if (unsupportedOptions.size !== 0) {\n        const optionWord = unsupportedOptions.size > 1 ? 'options' : 'option';\n        const isOrAre = unsupportedOptions.size > 1 ? 'are' : 'is';\n        throw new error_1.MongoParseError(`${optionWord} ${Array.from(unsupportedOptions).join(', ')} ${isOrAre} not supported`);\n    }\n    // Option parsing and setting\n    for (const [key, descriptor] of Object.entries(exports.OPTIONS)) {\n        const values = allProvidedOptions.get(key);\n        if (!values || values.length === 0) {\n            if (exports.DEFAULT_OPTIONS.has(key)) {\n                setOption(mongoOptions, key, descriptor, [exports.DEFAULT_OPTIONS.get(key)]);\n            }\n        }\n        else {\n            const { deprecated } = descriptor;\n            if (deprecated) {\n                const deprecatedMsg = typeof deprecated === 'string' ? `: ${deprecated}` : '';\n                (0, utils_1.emitWarning)(`${key} is a deprecated option${deprecatedMsg}`);\n            }\n            setOption(mongoOptions, key, descriptor, values);\n        }\n    }\n    if (mongoOptions.credentials) {\n        const isGssapi = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_GSSAPI;\n        const isX509 = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_X509;\n        const isAws = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_AWS;\n        const isOidc = mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_OIDC;\n        if ((isGssapi || isX509) &&\n            allProvidedOptions.has('authSource') &&\n            mongoOptions.credentials.source !== '$external') {\n            // If authSource was explicitly given and its incorrect, we error\n            throw new error_1.MongoParseError(`authMechanism ${mongoOptions.credentials.mechanism} requires an authSource of '$external'`);\n        }\n        if (!(isGssapi || isX509 || isAws || isOidc) &&\n            mongoOptions.dbName &&\n            !allProvidedOptions.has('authSource')) {\n            // inherit the dbName unless GSSAPI or X509, then silently ignore dbName\n            // and there was no specific authSource given\n            mongoOptions.credentials = mongo_credentials_1.MongoCredentials.merge(mongoOptions.credentials, {\n                source: mongoOptions.dbName\n            });\n        }\n        if (isAws && mongoOptions.credentials.username && !mongoOptions.credentials.password) {\n            throw new error_1.MongoMissingCredentialsError(`When using ${mongoOptions.credentials.mechanism} password must be set when a username is specified`);\n        }\n        mongoOptions.credentials.validate();\n        // Check if the only auth related option provided was authSource, if so we can remove credentials\n        if (mongoOptions.credentials.password === '' &&\n            mongoOptions.credentials.username === '' &&\n            mongoOptions.credentials.mechanism === providers_1.AuthMechanism.MONGODB_DEFAULT &&\n            Object.keys(mongoOptions.credentials.mechanismProperties).length === 0) {\n            delete mongoOptions.credentials;\n        }\n    }\n    if (!mongoOptions.dbName) {\n        // dbName default is applied here because of the credential validation above\n        mongoOptions.dbName = 'test';\n    }\n    validateLoadBalancedOptions(hosts, mongoOptions, isSRV);\n    if (mongoClient && mongoOptions.autoEncryption) {\n        encrypter_1.Encrypter.checkForMongoCrypt();\n        mongoOptions.encrypter = new encrypter_1.Encrypter(mongoClient, uri, options);\n        mongoOptions.autoEncrypter = mongoOptions.encrypter.autoEncrypter;\n    }\n    // Potential SRV Overrides and SRV connection string validations\n    mongoOptions.userSpecifiedAuthSource =\n        objectOptions.has('authSource') || urlOptions.has('authSource');\n    mongoOptions.userSpecifiedReplicaSet =\n        objectOptions.has('replicaSet') || urlOptions.has('replicaSet');\n    if (isSRV) {\n        // SRV Record is resolved upon connecting\n        mongoOptions.srvHost = hosts[0];\n        if (mongoOptions.directConnection) {\n            throw new error_1.MongoAPIError('SRV URI does not support directConnection');\n        }\n        if (mongoOptions.srvMaxHosts > 0 && typeof mongoOptions.replicaSet === 'string') {\n            throw new error_1.MongoParseError('Cannot use srvMaxHosts option with replicaSet');\n        }\n        // SRV turns on TLS by default, but users can override and turn it off\n        const noUserSpecifiedTLS = !objectOptions.has('tls') && !urlOptions.has('tls');\n        const noUserSpecifiedSSL = !objectOptions.has('ssl') && !urlOptions.has('ssl');\n        if (noUserSpecifiedTLS && noUserSpecifiedSSL) {\n            mongoOptions.tls = true;\n        }\n    }\n    else {\n        const userSpecifiedSrvOptions = urlOptions.has('srvMaxHosts') ||\n            objectOptions.has('srvMaxHosts') ||\n            urlOptions.has('srvServiceName') ||\n            objectOptions.has('srvServiceName');\n        if (userSpecifiedSrvOptions) {\n            throw new error_1.MongoParseError('Cannot use srvMaxHosts or srvServiceName with a non-srv connection string');\n        }\n    }\n    if (mongoOptions.directConnection && mongoOptions.hosts.length !== 1) {\n        throw new error_1.MongoParseError('directConnection option requires exactly one host');\n    }\n    if (!mongoOptions.proxyHost &&\n        (mongoOptions.proxyPort || mongoOptions.proxyUsername || mongoOptions.proxyPassword)) {\n        throw new error_1.MongoParseError('Must specify proxyHost if other proxy options are passed');\n    }\n    if ((mongoOptions.proxyUsername && !mongoOptions.proxyPassword) ||\n        (!mongoOptions.proxyUsername && mongoOptions.proxyPassword)) {\n        throw new error_1.MongoParseError('Can only specify both of proxy username/password or neither');\n    }\n    const proxyOptions = ['proxyHost', 'proxyPort', 'proxyUsername', 'proxyPassword'].map(key => urlOptions.get(key) ?? []);\n    if (proxyOptions.some(options => options.length > 1)) {\n        throw new error_1.MongoParseError('Proxy options cannot be specified multiple times in the connection string');\n    }\n    mongoOptions.mongoLoggerOptions = mongo_logger_1.MongoLogger.resolveOptions({\n        MONGODB_LOG_COMMAND: process.env.MONGODB_LOG_COMMAND,\n        MONGODB_LOG_TOPOLOGY: process.env.MONGODB_LOG_TOPOLOGY,\n        MONGODB_LOG_SERVER_SELECTION: process.env.MONGODB_LOG_SERVER_SELECTION,\n        MONGODB_LOG_CONNECTION: process.env.MONGODB_LOG_CONNECTION,\n        MONGODB_LOG_CLIENT: process.env.MONGODB_LOG_CLIENT,\n        MONGODB_LOG_ALL: process.env.MONGODB_LOG_ALL,\n        MONGODB_LOG_MAX_DOCUMENT_LENGTH: process.env.MONGODB_LOG_MAX_DOCUMENT_LENGTH,\n        MONGODB_LOG_PATH: process.env.MONGODB_LOG_PATH\n    }, {\n        mongodbLogPath: mongoOptions.mongodbLogPath,\n        mongodbLogComponentSeverities: mongoOptions.mongodbLogComponentSeverities,\n        mongodbLogMaxDocumentLength: mongoOptions.mongodbLogMaxDocumentLength\n    });\n    mongoOptions.metadata = (0, client_metadata_1.makeClientMetadata)(mongoOptions);\n    mongoOptions.extendedMetadata = (0, client_metadata_1.addContainerMetadata)(mongoOptions.metadata).then(undefined, utils_1.squashError); // rejections will be handled later\n    return mongoOptions;\n}\n/**\n * #### Throws if LB mode is true:\n * - hosts contains more than one host\n * - there is a replicaSet name set\n * - directConnection is set\n * - if srvMaxHosts is used when an srv connection string is passed in\n *\n * @throws MongoParseError\n */\nfunction validateLoadBalancedOptions(hosts, mongoOptions, isSrv) {\n    if (mongoOptions.loadBalanced) {\n        if (hosts.length > 1) {\n            throw new error_1.MongoParseError(LB_SINGLE_HOST_ERROR);\n        }\n        if (mongoOptions.replicaSet) {\n            throw new error_1.MongoParseError(LB_REPLICA_SET_ERROR);\n        }\n        if (mongoOptions.directConnection) {\n            throw new error_1.MongoParseError(LB_DIRECT_CONNECTION_ERROR);\n        }\n        if (isSrv && mongoOptions.srvMaxHosts > 0) {\n            throw new error_1.MongoParseError('Cannot limit srv hosts with loadBalanced enabled');\n        }\n    }\n    return;\n}\nfunction setOption(mongoOptions, key, descriptor, values) {\n    const { target, type, transform } = descriptor;\n    const name = target ?? key;\n    switch (type) {\n        case 'boolean':\n            mongoOptions[name] = getBoolean(name, values[0]);\n            break;\n        case 'int':\n            mongoOptions[name] = getIntFromOptions(name, values[0]);\n            break;\n        case 'uint':\n            mongoOptions[name] = getUIntFromOptions(name, values[0]);\n            break;\n        case 'string':\n            if (values[0] == null) {\n                break;\n            }\n            mongoOptions[name] = String(values[0]);\n            break;\n        case 'record':\n            if (!(0, utils_1.isRecord)(values[0])) {\n                throw new error_1.MongoParseError(`${name} must be an object`);\n            }\n            mongoOptions[name] = values[0];\n            break;\n        case 'any':\n            mongoOptions[name] = values[0];\n            break;\n        default: {\n            if (!transform) {\n                throw new error_1.MongoParseError('Descriptors missing a type must define a transform');\n            }\n            const transformValue = transform({ name, options: mongoOptions, values });\n            mongoOptions[name] = transformValue;\n            break;\n        }\n    }\n}\nexports.OPTIONS = {\n    appName: {\n        type: 'string'\n    },\n    auth: {\n        target: 'credentials',\n        transform({ name, options, values: [value] }) {\n            if (!(0, utils_1.isRecord)(value, ['username', 'password'])) {\n                throw new error_1.MongoParseError(`${name} must be an object with 'username' and 'password' properties`);\n            }\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, {\n                username: value.username,\n                password: value.password\n            });\n        }\n    },\n    authMechanism: {\n        target: 'credentials',\n        transform({ options, values: [value] }) {\n            const mechanisms = Object.values(providers_1.AuthMechanism);\n            const [mechanism] = mechanisms.filter(m => m.match(RegExp(String.raw `\\b${value}\\b`, 'i')));\n            if (!mechanism) {\n                throw new error_1.MongoParseError(`authMechanism one of ${mechanisms}, got ${value}`);\n            }\n            let source = options.credentials?.source;\n            if (mechanism === providers_1.AuthMechanism.MONGODB_PLAIN ||\n                providers_1.AUTH_MECHS_AUTH_SRC_EXTERNAL.has(mechanism)) {\n                // some mechanisms have '$external' as the Auth Source\n                source = '$external';\n            }\n            let password = options.credentials?.password;\n            if (mechanism === providers_1.AuthMechanism.MONGODB_X509 && password === '') {\n                password = undefined;\n            }\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, {\n                mechanism,\n                source,\n                password\n            });\n        }\n    },\n    // Note that if the authMechanismProperties contain a TOKEN_RESOURCE that has a\n    // comma in it, it MUST be supplied as a MongoClient option instead of in the\n    // connection string.\n    authMechanismProperties: {\n        target: 'credentials',\n        transform({ options, values }) {\n            // We can have a combination of options passed in the URI and options passed\n            // as an object to the MongoClient. So we must transform the string options\n            // as well as merge them together with a potentially provided object.\n            let mechanismProperties = Object.create(null);\n            for (const optionValue of values) {\n                if (typeof optionValue === 'string') {\n                    for (const [key, value] of entriesFromString(optionValue)) {\n                        try {\n                            mechanismProperties[key] = getBoolean(key, value);\n                        }\n                        catch {\n                            mechanismProperties[key] = value;\n                        }\n                    }\n                }\n                else {\n                    if (!(0, utils_1.isRecord)(optionValue)) {\n                        throw new error_1.MongoParseError('AuthMechanismProperties must be an object');\n                    }\n                    mechanismProperties = { ...optionValue };\n                }\n            }\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, {\n                mechanismProperties\n            });\n        }\n    },\n    authSource: {\n        target: 'credentials',\n        transform({ options, values: [value] }) {\n            const source = String(value);\n            return mongo_credentials_1.MongoCredentials.merge(options.credentials, { source });\n        }\n    },\n    autoEncryption: {\n        type: 'record'\n    },\n    autoSelectFamily: {\n        type: 'boolean',\n        default: true\n    },\n    autoSelectFamilyAttemptTimeout: {\n        type: 'uint'\n    },\n    bsonRegExp: {\n        type: 'boolean'\n    },\n    serverApi: {\n        target: 'serverApi',\n        transform({ values: [version] }) {\n            const serverApiToValidate = typeof version === 'string' ? { version } : version;\n            const versionToValidate = serverApiToValidate && serverApiToValidate.version;\n            if (!versionToValidate) {\n                throw new error_1.MongoParseError(`Invalid \\`serverApi\\` property; must specify a version from the following enum: [\"${Object.values(mongo_client_1.ServerApiVersion).join('\", \"')}\"]`);\n            }\n            if (!Object.values(mongo_client_1.ServerApiVersion).some(v => v === versionToValidate)) {\n                throw new error_1.MongoParseError(`Invalid server API version=${versionToValidate}; must be in the following enum: [\"${Object.values(mongo_client_1.ServerApiVersion).join('\", \"')}\"]`);\n            }\n            return serverApiToValidate;\n        }\n    },\n    checkKeys: {\n        type: 'boolean'\n    },\n    compressors: {\n        default: 'none',\n        target: 'compressors',\n        transform({ values }) {\n            const compressionList = new Set();\n            for (const compVal of values) {\n                const compValArray = typeof compVal === 'string' ? compVal.split(',') : compVal;\n                if (!Array.isArray(compValArray)) {\n                    throw new error_1.MongoInvalidArgumentError('compressors must be an array or a comma-delimited list of strings');\n                }\n                for (const c of compValArray) {\n                    if (Object.keys(compression_1.Compressor).includes(String(c))) {\n                        compressionList.add(String(c));\n                    }\n                    else {\n                        throw new error_1.MongoInvalidArgumentError(`${c} is not a valid compression mechanism. Must be one of: ${Object.keys(compression_1.Compressor)}.`);\n                    }\n                }\n            }\n            return [...compressionList];\n        }\n    },\n    connectTimeoutMS: {\n        default: 30000,\n        type: 'uint'\n    },\n    dbName: {\n        type: 'string'\n    },\n    directConnection: {\n        default: false,\n        type: 'boolean'\n    },\n    driverInfo: {\n        default: {},\n        type: 'record'\n    },\n    enableUtf8Validation: { type: 'boolean', default: true },\n    family: {\n        transform({ name, values: [value] }) {\n            const transformValue = getIntFromOptions(name, value);\n            if (transformValue === 4 || transformValue === 6) {\n                return transformValue;\n            }\n            throw new error_1.MongoParseError(`Option 'family' must be 4 or 6 got ${transformValue}.`);\n        }\n    },\n    fieldsAsRaw: {\n        type: 'record'\n    },\n    forceServerObjectId: {\n        default: false,\n        type: 'boolean'\n    },\n    fsync: {\n        deprecated: 'Please use journal instead',\n        target: 'writeConcern',\n        transform({ name, options, values: [value] }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    fsync: getBoolean(name, value)\n                }\n            });\n            if (!wc)\n                throw new error_1.MongoParseError(`Unable to make a writeConcern from fsync=${value}`);\n            return wc;\n        }\n    },\n    heartbeatFrequencyMS: {\n        default: 10000,\n        type: 'uint'\n    },\n    ignoreUndefined: {\n        type: 'boolean'\n    },\n    j: {\n        deprecated: 'Please use journal instead',\n        target: 'writeConcern',\n        transform({ name, options, values: [value] }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    journal: getBoolean(name, value)\n                }\n            });\n            if (!wc)\n                throw new error_1.MongoParseError(`Unable to make a writeConcern from journal=${value}`);\n            return wc;\n        }\n    },\n    journal: {\n        target: 'writeConcern',\n        transform({ name, options, values: [value] }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    journal: getBoolean(name, value)\n                }\n            });\n            if (!wc)\n                throw new error_1.MongoParseError(`Unable to make a writeConcern from journal=${value}`);\n            return wc;\n        }\n    },\n    loadBalanced: {\n        default: false,\n        type: 'boolean'\n    },\n    localThresholdMS: {\n        default: 15,\n        type: 'uint'\n    },\n    maxConnecting: {\n        default: 2,\n        transform({ name, values: [value] }) {\n            const maxConnecting = getUIntFromOptions(name, value);\n            if (maxConnecting === 0) {\n                throw new error_1.MongoInvalidArgumentError('maxConnecting must be > 0 if specified');\n            }\n            return maxConnecting;\n        }\n    },\n    maxIdleTimeMS: {\n        default: 0,\n        type: 'uint'\n    },\n    maxPoolSize: {\n        default: 100,\n        type: 'uint'\n    },\n    maxStalenessSeconds: {\n        target: 'readPreference',\n        transform({ name, options, values: [value] }) {\n            const maxStalenessSeconds = getUIntFromOptions(name, value);\n            if (options.readPreference) {\n                return read_preference_1.ReadPreference.fromOptions({\n                    readPreference: { ...options.readPreference, maxStalenessSeconds }\n                });\n            }\n            else {\n                return new read_preference_1.ReadPreference('secondary', undefined, { maxStalenessSeconds });\n            }\n        }\n    },\n    minInternalBufferSize: {\n        type: 'uint'\n    },\n    minPoolSize: {\n        default: 0,\n        type: 'uint'\n    },\n    minHeartbeatFrequencyMS: {\n        default: 500,\n        type: 'uint'\n    },\n    monitorCommands: {\n        default: false,\n        type: 'boolean'\n    },\n    name: {\n        target: 'driverInfo',\n        transform({ values: [value], options }) {\n            return { ...options.driverInfo, name: String(value) };\n        }\n    },\n    noDelay: {\n        default: true,\n        type: 'boolean'\n    },\n    pkFactory: {\n        default: utils_1.DEFAULT_PK_FACTORY,\n        transform({ values: [value] }) {\n            if ((0, utils_1.isRecord)(value, ['createPk']) && typeof value.createPk === 'function') {\n                return value;\n            }\n            throw new error_1.MongoParseError(`Option pkFactory must be an object with a createPk function, got ${value}`);\n        }\n    },\n    promoteBuffers: {\n        type: 'boolean'\n    },\n    promoteLongs: {\n        type: 'boolean'\n    },\n    promoteValues: {\n        type: 'boolean'\n    },\n    useBigInt64: {\n        type: 'boolean'\n    },\n    proxyHost: {\n        type: 'string'\n    },\n    proxyPassword: {\n        type: 'string'\n    },\n    proxyPort: {\n        type: 'uint'\n    },\n    proxyUsername: {\n        type: 'string'\n    },\n    raw: {\n        default: false,\n        type: 'boolean'\n    },\n    readConcern: {\n        transform({ values: [value], options }) {\n            if (value instanceof read_concern_1.ReadConcern || (0, utils_1.isRecord)(value, ['level'])) {\n                return read_concern_1.ReadConcern.fromOptions({ ...options.readConcern, ...value });\n            }\n            throw new error_1.MongoParseError(`ReadConcern must be an object, got ${JSON.stringify(value)}`);\n        }\n    },\n    readConcernLevel: {\n        target: 'readConcern',\n        transform({ values: [level], options }) {\n            return read_concern_1.ReadConcern.fromOptions({\n                ...options.readConcern,\n                level: level\n            });\n        }\n    },\n    readPreference: {\n        default: read_preference_1.ReadPreference.primary,\n        transform({ values: [value], options }) {\n            if (value instanceof read_preference_1.ReadPreference) {\n                return read_preference_1.ReadPreference.fromOptions({\n                    readPreference: { ...options.readPreference, ...value },\n                    ...value\n                });\n            }\n            if ((0, utils_1.isRecord)(value, ['mode'])) {\n                const rp = read_preference_1.ReadPreference.fromOptions({\n                    readPreference: { ...options.readPreference, ...value },\n                    ...value\n                });\n                if (rp)\n                    return rp;\n                else\n                    throw new error_1.MongoParseError(`Cannot make read preference from ${JSON.stringify(value)}`);\n            }\n            if (typeof value === 'string') {\n                const rpOpts = {\n                    hedge: options.readPreference?.hedge,\n                    maxStalenessSeconds: options.readPreference?.maxStalenessSeconds\n                };\n                return new read_preference_1.ReadPreference(value, options.readPreference?.tags, rpOpts);\n            }\n            throw new error_1.MongoParseError(`Unknown ReadPreference value: ${value}`);\n        }\n    },\n    readPreferenceTags: {\n        target: 'readPreference',\n        transform({ values, options }) {\n            const tags = Array.isArray(values[0])\n                ? values[0]\n                : values;\n            const readPreferenceTags = [];\n            for (const tag of tags) {\n                const readPreferenceTag = Object.create(null);\n                if (typeof tag === 'string') {\n                    for (const [k, v] of entriesFromString(tag)) {\n                        readPreferenceTag[k] = v;\n                    }\n                }\n                if ((0, utils_1.isRecord)(tag)) {\n                    for (const [k, v] of Object.entries(tag)) {\n                        readPreferenceTag[k] = v;\n                    }\n                }\n                readPreferenceTags.push(readPreferenceTag);\n            }\n            return read_preference_1.ReadPreference.fromOptions({\n                readPreference: options.readPreference,\n                readPreferenceTags\n            });\n        }\n    },\n    replicaSet: {\n        type: 'string'\n    },\n    retryReads: {\n        default: true,\n        type: 'boolean'\n    },\n    retryWrites: {\n        default: true,\n        type: 'boolean'\n    },\n    serializeFunctions: {\n        type: 'boolean'\n    },\n    serverMonitoringMode: {\n        default: 'auto',\n        transform({ values: [value] }) {\n            if (!Object.values(monitor_1.ServerMonitoringMode).includes(value)) {\n                throw new error_1.MongoParseError('serverMonitoringMode must be one of `auto`, `poll`, or `stream`');\n            }\n            return value;\n        }\n    },\n    serverSelectionTimeoutMS: {\n        default: 30000,\n        type: 'uint'\n    },\n    servername: {\n        type: 'string'\n    },\n    socketTimeoutMS: {\n        // TODO(NODE-6491): deprecated: 'Please use timeoutMS instead',\n        default: 0,\n        type: 'uint'\n    },\n    srvMaxHosts: {\n        type: 'uint',\n        default: 0\n    },\n    srvServiceName: {\n        type: 'string',\n        default: 'mongodb'\n    },\n    ssl: {\n        target: 'tls',\n        type: 'boolean'\n    },\n    timeoutMS: {\n        type: 'uint'\n    },\n    tls: {\n        type: 'boolean'\n    },\n    tlsAllowInvalidCertificates: {\n        target: 'rejectUnauthorized',\n        transform({ name, values: [value] }) {\n            // allowInvalidCertificates is the inverse of rejectUnauthorized\n            return !getBoolean(name, value);\n        }\n    },\n    tlsAllowInvalidHostnames: {\n        target: 'checkServerIdentity',\n        transform({ name, values: [value] }) {\n            // tlsAllowInvalidHostnames means setting the checkServerIdentity function to a noop\n            return getBoolean(name, value) ? () => undefined : undefined;\n        }\n    },\n    tlsCAFile: {\n        type: 'string'\n    },\n    tlsCRLFile: {\n        type: 'string'\n    },\n    tlsCertificateKeyFile: {\n        type: 'string'\n    },\n    tlsCertificateKeyFilePassword: {\n        target: 'passphrase',\n        type: 'any'\n    },\n    tlsInsecure: {\n        transform({ name, options, values: [value] }) {\n            const tlsInsecure = getBoolean(name, value);\n            if (tlsInsecure) {\n                options.checkServerIdentity = () => undefined;\n                options.rejectUnauthorized = false;\n            }\n            else {\n                options.checkServerIdentity = options.tlsAllowInvalidHostnames\n                    ? () => undefined\n                    : undefined;\n                options.rejectUnauthorized = options.tlsAllowInvalidCertificates ? false : true;\n            }\n            return tlsInsecure;\n        }\n    },\n    w: {\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            return write_concern_1.WriteConcern.fromOptions({ writeConcern: { ...options.writeConcern, w: value } });\n        }\n    },\n    waitQueueTimeoutMS: {\n        // TODO(NODE-6491): deprecated: 'Please use timeoutMS instead',\n        default: 0,\n        type: 'uint'\n    },\n    writeConcern: {\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            if ((0, utils_1.isRecord)(value) || value instanceof write_concern_1.WriteConcern) {\n                return write_concern_1.WriteConcern.fromOptions({\n                    writeConcern: {\n                        ...options.writeConcern,\n                        ...value\n                    }\n                });\n            }\n            else if (value === 'majority' || typeof value === 'number') {\n                return write_concern_1.WriteConcern.fromOptions({\n                    writeConcern: {\n                        ...options.writeConcern,\n                        w: value\n                    }\n                });\n            }\n            throw new error_1.MongoParseError(`Invalid WriteConcern cannot parse: ${JSON.stringify(value)}`);\n        }\n    },\n    wtimeout: {\n        deprecated: 'Please use wtimeoutMS instead',\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    wtimeout: getUIntFromOptions('wtimeout', value)\n                }\n            });\n            if (wc)\n                return wc;\n            throw new error_1.MongoParseError(`Cannot make WriteConcern from wtimeout`);\n        }\n    },\n    wtimeoutMS: {\n        target: 'writeConcern',\n        transform({ values: [value], options }) {\n            const wc = write_concern_1.WriteConcern.fromOptions({\n                writeConcern: {\n                    ...options.writeConcern,\n                    wtimeoutMS: getUIntFromOptions('wtimeoutMS', value)\n                }\n            });\n            if (wc)\n                return wc;\n            throw new error_1.MongoParseError(`Cannot make WriteConcern from wtimeout`);\n        }\n    },\n    zlibCompressionLevel: {\n        default: 0,\n        type: 'int'\n    },\n    mongodbLogPath: {\n        transform({ values: [value] }) {\n            if (!((typeof value === 'string' && ['stderr', 'stdout'].includes(value)) ||\n                (value &&\n                    typeof value === 'object' &&\n                    'write' in value &&\n                    typeof value.write === 'function'))) {\n                throw new error_1.MongoAPIError(`Option 'mongodbLogPath' must be of type 'stderr' | 'stdout' | MongoDBLogWritable`);\n            }\n            return value;\n        }\n    },\n    mongodbLogComponentSeverities: {\n        transform({ values: [value] }) {\n            if (typeof value !== 'object' || !value) {\n                throw new error_1.MongoAPIError(`Option 'mongodbLogComponentSeverities' must be a non-null object`);\n            }\n            for (const [k, v] of Object.entries(value)) {\n                if (typeof v !== 'string' || typeof k !== 'string') {\n                    throw new error_1.MongoAPIError(`User input for option 'mongodbLogComponentSeverities' object cannot include a non-string key or value`);\n                }\n                if (!Object.values(mongo_logger_1.MongoLoggableComponent).some(val => val === k) && k !== 'default') {\n                    throw new error_1.MongoAPIError(`User input for option 'mongodbLogComponentSeverities' contains invalid key: ${k}`);\n                }\n                if (!Object.values(mongo_logger_1.SeverityLevel).some(val => val === v)) {\n                    throw new error_1.MongoAPIError(`Option 'mongodbLogComponentSeverities' does not support ${v} as a value for ${k}`);\n                }\n            }\n            return value;\n        }\n    },\n    mongodbLogMaxDocumentLength: { type: 'uint' },\n    // Custom types for modifying core behavior\n    connectionType: { type: 'any' },\n    srvPoller: { type: 'any' },\n    // Accepted Node.js Options\n    allowPartialTrustChain: { type: 'any' },\n    minDHSize: { type: 'any' },\n    pskCallback: { type: 'any' },\n    secureContext: { type: 'any' },\n    enableTrace: { type: 'any' },\n    requestCert: { type: 'any' },\n    rejectUnauthorized: { type: 'any' },\n    checkServerIdentity: { type: 'any' },\n    ALPNProtocols: { type: 'any' },\n    SNICallback: { type: 'any' },\n    session: { type: 'any' },\n    requestOCSP: { type: 'any' },\n    localAddress: { type: 'any' },\n    localPort: { type: 'any' },\n    hints: { type: 'any' },\n    lookup: { type: 'any' },\n    ca: { type: 'any' },\n    cert: { type: 'any' },\n    ciphers: { type: 'any' },\n    crl: { type: 'any' },\n    ecdhCurve: { type: 'any' },\n    key: { type: 'any' },\n    passphrase: { type: 'any' },\n    pfx: { type: 'any' },\n    secureProtocol: { type: 'any' },\n    index: { type: 'any' },\n    // Legacy options from v3 era\n    useNewUrlParser: {\n        type: 'boolean',\n        deprecated: 'useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version'\n    },\n    useUnifiedTopology: {\n        type: 'boolean',\n        deprecated: 'useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version'\n    },\n    __skipPingOnConnect: { type: 'boolean' }\n};\nexports.DEFAULT_OPTIONS = new CaseInsensitiveMap(Object.entries(exports.OPTIONS)\n    .filter(([, descriptor]) => descriptor.default != null)\n    .map(([k, d]) => [k, d.default]));\n//# sourceMappingURL=connection_string.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2Nvbm5lY3Rpb25fc3RyaW5nLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHVCQUF1QixHQUFHLGVBQWU7QUFDekMsd0JBQXdCO0FBQ3hCLG9CQUFvQjtBQUNwQixZQUFZLG1CQUFPLENBQUMsZ0JBQUs7QUFDekIsd0NBQXdDLG1CQUFPLENBQUMsNkpBQStCO0FBQy9FLGNBQWMsbUJBQU8sQ0FBQyxnQkFBSztBQUMzQiw0QkFBNEIsbUJBQU8sQ0FBQyx3SUFBK0I7QUFDbkUsb0JBQW9CLG1CQUFPLENBQUMsd0hBQXVCO0FBQ25ELDBCQUEwQixtQkFBTyxDQUFDLDhJQUFrQztBQUNwRSxzQkFBc0IsbUJBQU8sQ0FBQyw4SUFBa0M7QUFDaEUsb0JBQW9CLG1CQUFPLENBQUMsb0dBQWE7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsdUJBQXVCLG1CQUFPLENBQUMsMEdBQWdCO0FBQy9DLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQyx1QkFBdUIsbUJBQU8sQ0FBQywwR0FBZ0I7QUFDL0MsMEJBQTBCLG1CQUFPLENBQUMsZ0hBQW1CO0FBQ3JELGtCQUFrQixtQkFBTyxDQUFDLDBHQUFnQjtBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQyx3QkFBd0IsbUJBQU8sQ0FBQyw0R0FBaUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStEO0FBQy9ELHlCQUF5Qix1QkFBdUIsUUFBUSxjQUFjO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0EsK0VBQStFLE9BQU8sR0FBRyxnQkFBZ0I7QUFDekc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLDZCQUE2QjtBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHLFFBQVE7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELEVBQUUsb0NBQW9DLEVBQUU7QUFDNUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsTUFBTTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxNQUFNLG9DQUFvQyxNQUFNO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE1BQU0seUNBQXlDLE1BQU07QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksZUFBZTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RSxJQUFJO0FBQzNFO0FBQ0E7QUFDQSwyREFBMkQsSUFBSTtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLFlBQVksRUFBRSwyQ0FBMkMsRUFBRSxTQUFTO0FBQ2pIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQSw0RUFBNEUsV0FBVztBQUN2Riw0Q0FBNEMsS0FBSyx3QkFBd0IsY0FBYztBQUN2RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxvQ0FBb0M7QUFDbkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EseUVBQXlFLG9DQUFvQztBQUM3RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLDZJQUE2STtBQUM3STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwwQkFBMEI7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsTUFBTTtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxxQ0FBcUM7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsZ0NBQWdDO0FBQ3BEO0FBQ0EscURBQXFELE1BQU07QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7QUFDQSxzRkFBc0YsTUFBTTtBQUM1RjtBQUNBLDBFQUEwRSxXQUFXLFFBQVEsTUFBTTtBQUNuRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7QUFDQSxxRkFBcUYsUUFBUTtBQUM3RjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixtQkFBbUI7QUFDdkMsd0VBQXdFLFVBQVU7QUFDbEY7QUFDQTtBQUNBLG1GQUFtRixvREFBb0QsNERBQTREO0FBQ25NO0FBQ0E7QUFDQSxnRkFBZ0Ysb0JBQW9CLG1DQUFtQyw0REFBNEQ7QUFDbk07QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RSxHQUFHLHdEQUF3RCxzQ0FBc0M7QUFDeEs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQSxLQUFLO0FBQ0wsNEJBQTRCLGdDQUFnQztBQUM1RDtBQUNBLG9CQUFvQix1QkFBdUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRkFBb0YsZUFBZTtBQUNuRztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0NBQWdDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSw4RkFBOEYsTUFBTTtBQUNwRztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQ0FBZ0M7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGdHQUFnRyxNQUFNO0FBQ3RHO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixnQ0FBZ0M7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGdHQUFnRyxNQUFNO0FBQ3RHO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLHVCQUF1QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGdDQUFnQztBQUNwRDtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEMsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxzRkFBc0YscUJBQXFCO0FBQzNHO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QyxxQkFBcUI7QUFDckI7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGtIQUFrSCxNQUFNO0FBQ3hIO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0EsZ0VBQWdFLGtDQUFrQztBQUNsRztBQUNBLG9GQUFvRixzQkFBc0I7QUFDMUc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0E7QUFDQSxzQ0FBc0MscUNBQXFDO0FBQzNFO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxxQ0FBcUM7QUFDM0U7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsMEZBQTBGLHNCQUFzQjtBQUNoSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFLE1BQU07QUFDckY7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsdUJBQXVCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLHVCQUF1QjtBQUMzQztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esb0JBQW9CLGdDQUFnQztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5Qyw4REFBOEQsZ0JBQWdCLHFDQUFxQztBQUNuSDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxvRkFBb0Ysc0JBQXNCO0FBQzFHO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUlBQW1JLEVBQUU7QUFDckk7QUFDQTtBQUNBLCtHQUErRyxHQUFHLGlCQUFpQixFQUFFO0FBQ3JJO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLG1DQUFtQyxjQUFjO0FBQ2pEO0FBQ0Esc0JBQXNCLGFBQWE7QUFDbkMsaUJBQWlCLGFBQWE7QUFDOUI7QUFDQSw4QkFBOEIsYUFBYTtBQUMzQyxpQkFBaUIsYUFBYTtBQUM5QixtQkFBbUIsYUFBYTtBQUNoQyxxQkFBcUIsYUFBYTtBQUNsQyxtQkFBbUIsYUFBYTtBQUNoQyxtQkFBbUIsYUFBYTtBQUNoQywwQkFBMEIsYUFBYTtBQUN2QywyQkFBMkIsYUFBYTtBQUN4QyxxQkFBcUIsYUFBYTtBQUNsQyxtQkFBbUIsYUFBYTtBQUNoQyxlQUFlLGFBQWE7QUFDNUIsbUJBQW1CLGFBQWE7QUFDaEMsb0JBQW9CLGFBQWE7QUFDakMsaUJBQWlCLGFBQWE7QUFDOUIsYUFBYSxhQUFhO0FBQzFCLGNBQWMsYUFBYTtBQUMzQixVQUFVLGFBQWE7QUFDdkIsWUFBWSxhQUFhO0FBQ3pCLGVBQWUsYUFBYTtBQUM1QixXQUFXLGFBQWE7QUFDeEIsaUJBQWlCLGFBQWE7QUFDOUIsV0FBVyxhQUFhO0FBQ3hCLGtCQUFrQixhQUFhO0FBQy9CLFdBQVcsYUFBYTtBQUN4QixzQkFBc0IsYUFBYTtBQUNuQyxhQUFhLGFBQWE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLDJCQUEyQjtBQUMzQjtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jb25uZWN0aW9uX3N0cmluZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuREVGQVVMVF9PUFRJT05TID0gZXhwb3J0cy5PUFRJT05TID0gdm9pZCAwO1xuZXhwb3J0cy5yZXNvbHZlU1JWUmVjb3JkID0gcmVzb2x2ZVNSVlJlY29yZDtcbmV4cG9ydHMucGFyc2VPcHRpb25zID0gcGFyc2VPcHRpb25zO1xuY29uc3QgZG5zID0gcmVxdWlyZShcImRuc1wiKTtcbmNvbnN0IG1vbmdvZGJfY29ubmVjdGlvbl9zdHJpbmdfdXJsXzEgPSByZXF1aXJlKFwibW9uZ29kYi1jb25uZWN0aW9uLXN0cmluZy11cmxcIik7XG5jb25zdCB1cmxfMSA9IHJlcXVpcmUoXCJ1cmxcIik7XG5jb25zdCBtb25nb19jcmVkZW50aWFsc18xID0gcmVxdWlyZShcIi4vY21hcC9hdXRoL21vbmdvX2NyZWRlbnRpYWxzXCIpO1xuY29uc3QgcHJvdmlkZXJzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvcHJvdmlkZXJzXCIpO1xuY29uc3QgY2xpZW50X21ldGFkYXRhXzEgPSByZXF1aXJlKFwiLi9jbWFwL2hhbmRzaGFrZS9jbGllbnRfbWV0YWRhdGFcIik7XG5jb25zdCBjb21wcmVzc2lvbl8xID0gcmVxdWlyZShcIi4vY21hcC93aXJlX3Byb3RvY29sL2NvbXByZXNzaW9uXCIpO1xuY29uc3QgZW5jcnlwdGVyXzEgPSByZXF1aXJlKFwiLi9lbmNyeXB0ZXJcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBtb25nb19jbGllbnRfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2NsaWVudFwiKTtcbmNvbnN0IG1vbmdvX2xvZ2dlcl8xID0gcmVxdWlyZShcIi4vbW9uZ29fbG9nZ2VyXCIpO1xuY29uc3QgcmVhZF9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi9yZWFkX2NvbmNlcm5cIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IG1vbml0b3JfMSA9IHJlcXVpcmUoXCIuL3NkYW0vbW9uaXRvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBWQUxJRF9UWFRfUkVDT1JEUyA9IFsnYXV0aFNvdXJjZScsICdyZXBsaWNhU2V0JywgJ2xvYWRCYWxhbmNlZCddO1xuY29uc3QgTEJfU0lOR0xFX0hPU1RfRVJST1IgPSAnbG9hZEJhbGFuY2VkIG9wdGlvbiBvbmx5IHN1cHBvcnRlZCB3aXRoIGEgc2luZ2xlIGhvc3QgaW4gdGhlIFVSSSc7XG5jb25zdCBMQl9SRVBMSUNBX1NFVF9FUlJPUiA9ICdsb2FkQmFsYW5jZWQgb3B0aW9uIG5vdCBzdXBwb3J0ZWQgd2l0aCBhIHJlcGxpY2FTZXQgb3B0aW9uJztcbmNvbnN0IExCX0RJUkVDVF9DT05ORUNUSU9OX0VSUk9SID0gJ2xvYWRCYWxhbmNlZCBvcHRpb24gbm90IHN1cHBvcnRlZCB3aGVuIGRpcmVjdENvbm5lY3Rpb24gaXMgcHJvdmlkZWQnO1xuZnVuY3Rpb24gcmV0cnlETlNUaW1lb3V0Rm9yKGFwaSkge1xuICAgIHJldHVybiBhc3luYyBmdW5jdGlvbiBkbnNSZXFSZXRyeVRpbWVvdXQobG9va3VwQWRkcmVzcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGRucy5wcm9taXNlc1thcGldKGxvb2t1cEFkZHJlc3MpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChmaXJzdEROU0Vycm9yKSB7XG4gICAgICAgICAgICBpZiAoZmlyc3RETlNFcnJvci5jb2RlID09PSBkbnMuVElNRU9VVCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBkbnMucHJvbWlzZXNbYXBpXShsb29rdXBBZGRyZXNzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IGZpcnN0RE5TRXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuY29uc3QgcmVzb2x2ZVNydiA9IHJldHJ5RE5TVGltZW91dEZvcigncmVzb2x2ZVNydicpO1xuY29uc3QgcmVzb2x2ZVR4dCA9IHJldHJ5RE5TVGltZW91dEZvcigncmVzb2x2ZVR4dCcpO1xuLyoqXG4gKiBMb29rdXAgYSBgbW9uZ29kYitzcnZgIGNvbm5lY3Rpb24gc3RyaW5nLCBjb21iaW5lIHRoZSBwYXJ0cyBhbmQgcmVwYXJzZSBpdCBhcyBhIG5vcm1hbFxuICogY29ubmVjdGlvbiBzdHJpbmcuXG4gKlxuICogQHBhcmFtIHVyaSAtIFRoZSBjb25uZWN0aW9uIHN0cmluZyB0byBwYXJzZVxuICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCB1c2VyIHByb3ZpZGVkIGNvbm5lY3Rpb24gc3RyaW5nIG9wdGlvbnNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZVNSVlJlY29yZChvcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnNydkhvc3QgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ09wdGlvbiBcInNydkhvc3RcIiBtdXN0IG5vdCBiZSBlbXB0eScpO1xuICAgIH1cbiAgICAvLyBBc3luY2hyb25vdXNseSBzdGFydCBUWFQgcmVzb2x1dGlvbiBzbyB0aGF0IHdlIGRvIG5vdCBoYXZlIHRvIHdhaXQgdW50aWxcbiAgICAvLyB0aGUgU1JWIHJlY29yZCBpcyByZXNvbHZlZCBiZWZvcmUgc3RhcnRpbmcgYSBzZWNvbmQgRE5TIHF1ZXJ5LlxuICAgIGNvbnN0IGxvb2t1cEFkZHJlc3MgPSBvcHRpb25zLnNydkhvc3Q7XG4gICAgY29uc3QgdHh0UmVzb2x1dGlvblByb21pc2UgPSByZXNvbHZlVHh0KGxvb2t1cEFkZHJlc3MpO1xuICAgIHR4dFJlc29sdXRpb25Qcm9taXNlLnRoZW4odW5kZWZpbmVkLCB1dGlsc18xLnNxdWFzaEVycm9yKTsgLy8gcmVqZWN0aW9ucyB3aWxsIGJlIGhhbmRsZWQgbGF0ZXJcbiAgICBjb25zdCBob3N0bmFtZSA9IGBfJHtvcHRpb25zLnNydlNlcnZpY2VOYW1lfS5fdGNwLiR7bG9va3VwQWRkcmVzc31gO1xuICAgIC8vIFJlc29sdmUgdGhlIFNSViByZWNvcmQgYW5kIHVzZSB0aGUgcmVzdWx0IGFzIHRoZSBsaXN0IG9mIGhvc3RzIHRvIGNvbm5lY3QgdG8uXG4gICAgY29uc3QgYWRkcmVzc2VzID0gYXdhaXQgcmVzb2x2ZVNydihob3N0bmFtZSk7XG4gICAgaWYgKGFkZHJlc3Nlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignTm8gYWRkcmVzc2VzIGZvdW5kIGF0IGhvc3QnKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB7IG5hbWUgfSBvZiBhZGRyZXNzZXMpIHtcbiAgICAgICAgKDAsIHV0aWxzXzEuY2hlY2tQYXJlbnREb21haW5NYXRjaCkobmFtZSwgbG9va3VwQWRkcmVzcyk7XG4gICAgfVxuICAgIGNvbnN0IGhvc3RBZGRyZXNzZXMgPSBhZGRyZXNzZXMubWFwKHIgPT4gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKGAke3IubmFtZX06JHtyLnBvcnQgPz8gMjcwMTd9YCkpO1xuICAgIHZhbGlkYXRlTG9hZEJhbGFuY2VkT3B0aW9ucyhob3N0QWRkcmVzc2VzLCBvcHRpb25zLCB0cnVlKTtcbiAgICAvLyBVc2UgdGhlIHJlc3VsdCBvZiByZXNvbHZpbmcgdGhlIFRYVCByZWNvcmQgYW5kIGFkZCBvcHRpb25zIGZyb20gdGhlcmUgaWYgdGhleSBleGlzdC5cbiAgICBsZXQgcmVjb3JkO1xuICAgIHRyeSB7XG4gICAgICAgIHJlY29yZCA9IGF3YWl0IHR4dFJlc29sdXRpb25Qcm9taXNlO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgIT09ICdFTk9EQVRBJyAmJiBlcnJvci5jb2RlICE9PSAnRU5PVEZPVU5EJykge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhvc3RBZGRyZXNzZXM7XG4gICAgfVxuICAgIGlmIChyZWNvcmQubGVuZ3RoID4gMSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ011bHRpcGxlIHRleHQgcmVjb3JkcyBub3QgYWxsb3dlZCcpO1xuICAgIH1cbiAgICBjb25zdCB0eHRSZWNvcmRPcHRpb25zID0gbmV3IHVybF8xLlVSTFNlYXJjaFBhcmFtcyhyZWNvcmRbMF0uam9pbignJykpO1xuICAgIGNvbnN0IHR4dFJlY29yZE9wdGlvbktleXMgPSBbLi4udHh0UmVjb3JkT3B0aW9ucy5rZXlzKCldO1xuICAgIGlmICh0eHRSZWNvcmRPcHRpb25LZXlzLnNvbWUoa2V5ID0+ICFWQUxJRF9UWFRfUkVDT1JEUy5pbmNsdWRlcyhrZXkpKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYFRleHQgcmVjb3JkIG1heSBvbmx5IHNldCBhbnkgb2Y6ICR7VkFMSURfVFhUX1JFQ09SRFMuam9pbignLCAnKX1gKTtcbiAgICB9XG4gICAgaWYgKFZBTElEX1RYVF9SRUNPUkRTLnNvbWUob3B0aW9uID0+IHR4dFJlY29yZE9wdGlvbnMuZ2V0KG9wdGlvbikgPT09ICcnKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0Nhbm5vdCBoYXZlIGVtcHR5IFVSSSBwYXJhbXMgaW4gRE5TIFRYVCBSZWNvcmQnKTtcbiAgICB9XG4gICAgY29uc3Qgc291cmNlID0gdHh0UmVjb3JkT3B0aW9ucy5nZXQoJ2F1dGhTb3VyY2UnKSA/PyB1bmRlZmluZWQ7XG4gICAgY29uc3QgcmVwbGljYVNldCA9IHR4dFJlY29yZE9wdGlvbnMuZ2V0KCdyZXBsaWNhU2V0JykgPz8gdW5kZWZpbmVkO1xuICAgIGNvbnN0IGxvYWRCYWxhbmNlZCA9IHR4dFJlY29yZE9wdGlvbnMuZ2V0KCdsb2FkQmFsYW5jZWQnKSA/PyB1bmRlZmluZWQ7XG4gICAgaWYgKCFvcHRpb25zLnVzZXJTcGVjaWZpZWRBdXRoU291cmNlICYmXG4gICAgICAgIHNvdXJjZSAmJlxuICAgICAgICBvcHRpb25zLmNyZWRlbnRpYWxzICYmXG4gICAgICAgICFwcm92aWRlcnNfMS5BVVRIX01FQ0hTX0FVVEhfU1JDX0VYVEVSTkFMLmhhcyhvcHRpb25zLmNyZWRlbnRpYWxzLm1lY2hhbmlzbSkpIHtcbiAgICAgICAgb3B0aW9ucy5jcmVkZW50aWFscyA9IG1vbmdvX2NyZWRlbnRpYWxzXzEuTW9uZ29DcmVkZW50aWFscy5tZXJnZShvcHRpb25zLmNyZWRlbnRpYWxzLCB7IHNvdXJjZSB9KTtcbiAgICB9XG4gICAgaWYgKCFvcHRpb25zLnVzZXJTcGVjaWZpZWRSZXBsaWNhU2V0ICYmIHJlcGxpY2FTZXQpIHtcbiAgICAgICAgb3B0aW9ucy5yZXBsaWNhU2V0ID0gcmVwbGljYVNldDtcbiAgICB9XG4gICAgaWYgKGxvYWRCYWxhbmNlZCA9PT0gJ3RydWUnKSB7XG4gICAgICAgIG9wdGlvbnMubG9hZEJhbGFuY2VkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMucmVwbGljYVNldCAmJiBvcHRpb25zLnNydk1heEhvc3RzID4gMCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0Nhbm5vdCBjb21iaW5lIHJlcGxpY2FTZXQgb3B0aW9uIHdpdGggc3J2TWF4SG9zdHMnKTtcbiAgICB9XG4gICAgdmFsaWRhdGVMb2FkQmFsYW5jZWRPcHRpb25zKGhvc3RBZGRyZXNzZXMsIG9wdGlvbnMsIHRydWUpO1xuICAgIHJldHVybiBob3N0QWRkcmVzc2VzO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgVExTIG9wdGlvbnMgYXJlIHZhbGlkXG4gKlxuICogQHBhcmFtIGFsbE9wdGlvbnMgLSBBbGwgb3B0aW9ucyBwcm92aWRlZCBieSB1c2VyIG9yIGluY2x1ZGVkIGluIGRlZmF1bHQgb3B0aW9ucyBtYXBcbiAqIEB0aHJvd3MgTW9uZ29BUElFcnJvciBpZiBUTFMgb3B0aW9ucyBhcmUgaW52YWxpZFxuICovXG5mdW5jdGlvbiBjaGVja1RMU09wdGlvbnMoYWxsT3B0aW9ucykge1xuICAgIGlmICghYWxsT3B0aW9ucylcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGNoZWNrID0gKGEsIGIpID0+IHtcbiAgICAgICAgaWYgKGFsbE9wdGlvbnMuaGFzKGEpICYmIGFsbE9wdGlvbnMuaGFzKGIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBUaGUgJyR7YX0nIG9wdGlvbiBjYW5ub3QgYmUgdXNlZCB3aXRoIHRoZSAnJHtifScgb3B0aW9uYCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNoZWNrKCd0bHNJbnNlY3VyZScsICd0bHNBbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXMnKTtcbiAgICBjaGVjaygndGxzSW5zZWN1cmUnLCAndGxzQWxsb3dJbnZhbGlkSG9zdG5hbWVzJyk7XG4gICAgY2hlY2soJ3Rsc0luc2VjdXJlJywgJ3Rsc0Rpc2FibGVDZXJ0aWZpY2F0ZVJldm9jYXRpb25DaGVjaycpO1xuICAgIGNoZWNrKCd0bHNJbnNlY3VyZScsICd0bHNEaXNhYmxlT0NTUEVuZHBvaW50Q2hlY2snKTtcbiAgICBjaGVjaygndGxzQWxsb3dJbnZhbGlkQ2VydGlmaWNhdGVzJywgJ3Rsc0Rpc2FibGVDZXJ0aWZpY2F0ZVJldm9jYXRpb25DaGVjaycpO1xuICAgIGNoZWNrKCd0bHNBbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXMnLCAndGxzRGlzYWJsZU9DU1BFbmRwb2ludENoZWNrJyk7XG4gICAgY2hlY2soJ3Rsc0Rpc2FibGVDZXJ0aWZpY2F0ZVJldm9jYXRpb25DaGVjaycsICd0bHNEaXNhYmxlT0NTUEVuZHBvaW50Q2hlY2snKTtcbn1cbmZ1bmN0aW9uIGdldEJvb2xlYW4obmFtZSwgdmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICAgIGNhc2UgJ3RydWUnOlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGNhc2UgJ2ZhbHNlJzpcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgJHtuYW1lfSBtdXN0IGJlIGVpdGhlciBcInRydWVcIiBvciBcImZhbHNlXCJgKTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRJbnRGcm9tT3B0aW9ucyhuYW1lLCB2YWx1ZSkge1xuICAgIGNvbnN0IHBhcnNlZEludCA9ICgwLCB1dGlsc18xLnBhcnNlSW50ZWdlcikodmFsdWUpO1xuICAgIGlmIChwYXJzZWRJbnQgIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gcGFyc2VkSW50O1xuICAgIH1cbiAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYEV4cGVjdGVkICR7bmFtZX0gdG8gYmUgc3RyaW5naWZpZWQgaW50IHZhbHVlLCBnb3Q6ICR7dmFsdWV9YCk7XG59XG5mdW5jdGlvbiBnZXRVSW50RnJvbU9wdGlvbnMobmFtZSwgdmFsdWUpIHtcbiAgICBjb25zdCBwYXJzZWRWYWx1ZSA9IGdldEludEZyb21PcHRpb25zKG5hbWUsIHZhbHVlKTtcbiAgICBpZiAocGFyc2VkVmFsdWUgPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgJHtuYW1lfSBjYW4gb25seSBiZSBhIHBvc2l0aXZlIGludCB2YWx1ZSwgZ290OiAke3ZhbHVlfWApO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VkVmFsdWU7XG59XG5mdW5jdGlvbiogZW50cmllc0Zyb21TdHJpbmcodmFsdWUpIHtcbiAgICBpZiAodmFsdWUgPT09ICcnKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qga2V5VmFsdWVQYWlycyA9IHZhbHVlLnNwbGl0KCcsJyk7XG4gICAgZm9yIChjb25zdCBrZXlWYWx1ZSBvZiBrZXlWYWx1ZVBhaXJzKSB7XG4gICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGtleVZhbHVlLnNwbGl0KC86KC4qKS8pO1xuICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdDYW5ub3QgaGF2ZSB1bmRlZmluZWQgdmFsdWVzIGluIGtleSB2YWx1ZSBwYWlycycpO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkIFtrZXksIHZhbHVlXTtcbiAgICB9XG59XG5jbGFzcyBDYXNlSW5zZW5zaXRpdmVNYXAgZXh0ZW5kcyBNYXAge1xuICAgIGNvbnN0cnVjdG9yKGVudHJpZXMgPSBbXSkge1xuICAgICAgICBzdXBlcihlbnRyaWVzLm1hcCgoW2ssIHZdKSA9PiBbay50b0xvd2VyQ2FzZSgpLCB2XSkpO1xuICAgIH1cbiAgICBoYXMoaykge1xuICAgICAgICByZXR1cm4gc3VwZXIuaGFzKGsudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuICAgIGdldChrKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXQoay50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG4gICAgc2V0KGssIHYpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLnNldChrLnRvTG93ZXJDYXNlKCksIHYpO1xuICAgIH1cbiAgICBkZWxldGUoaykge1xuICAgICAgICByZXR1cm4gc3VwZXIuZGVsZXRlKGsudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxufVxuZnVuY3Rpb24gcGFyc2VPcHRpb25zKHVyaSwgbW9uZ29DbGllbnQgPSB1bmRlZmluZWQsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmIChtb25nb0NsaWVudCAhPSBudWxsICYmICEobW9uZ29DbGllbnQgaW5zdGFuY2VvZiBtb25nb19jbGllbnRfMS5Nb25nb0NsaWVudCkpIHtcbiAgICAgICAgb3B0aW9ucyA9IG1vbmdvQ2xpZW50O1xuICAgICAgICBtb25nb0NsaWVudCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8gdmFsaWRhdGUgQlNPTk9wdGlvbnNcbiAgICBpZiAob3B0aW9ucy51c2VCaWdJbnQ2NCAmJiB0eXBlb2Ygb3B0aW9ucy5wcm9tb3RlTG9uZ3MgPT09ICdib29sZWFuJyAmJiAhb3B0aW9ucy5wcm9tb3RlTG9uZ3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignTXVzdCByZXF1ZXN0IGVpdGhlciBiaWdpbnQgb3IgTG9uZyBmb3IgaW50NjQgZGVzZXJpYWxpemF0aW9uJyk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnVzZUJpZ0ludDY0ICYmIHR5cGVvZiBvcHRpb25zLnByb21vdGVWYWx1ZXMgPT09ICdib29sZWFuJyAmJiAhb3B0aW9ucy5wcm9tb3RlVmFsdWVzKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ011c3QgcmVxdWVzdCBlaXRoZXIgYmlnaW50IG9yIExvbmcgZm9yIGludDY0IGRlc2VyaWFsaXphdGlvbicpO1xuICAgIH1cbiAgICBjb25zdCB1cmwgPSBuZXcgbW9uZ29kYl9jb25uZWN0aW9uX3N0cmluZ191cmxfMS5kZWZhdWx0KHVyaSk7XG4gICAgY29uc3QgeyBob3N0cywgaXNTUlYgfSA9IHVybDtcbiAgICBjb25zdCBtb25nb09wdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIG1vbmdvT3B0aW9ucy5ob3N0cyA9IGlzU1JWID8gW10gOiBob3N0cy5tYXAodXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKTtcbiAgICBjb25zdCB1cmxPcHRpb25zID0gbmV3IENhc2VJbnNlbnNpdGl2ZU1hcCgpO1xuICAgIGlmICh1cmwucGF0aG5hbWUgIT09ICcvJyAmJiB1cmwucGF0aG5hbWUgIT09ICcnKSB7XG4gICAgICAgIGNvbnN0IGRiTmFtZSA9IGRlY29kZVVSSUNvbXBvbmVudCh1cmwucGF0aG5hbWVbMF0gPT09ICcvJyA/IHVybC5wYXRobmFtZS5zbGljZSgxKSA6IHVybC5wYXRobmFtZSk7XG4gICAgICAgIGlmIChkYk5hbWUpIHtcbiAgICAgICAgICAgIHVybE9wdGlvbnMuc2V0KCdkYk5hbWUnLCBbZGJOYW1lXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHVybC51c2VybmFtZSAhPT0gJycpIHtcbiAgICAgICAgY29uc3QgYXV0aCA9IHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiBkZWNvZGVVUklDb21wb25lbnQodXJsLnVzZXJuYW1lKVxuICAgICAgICB9O1xuICAgICAgICBpZiAodHlwZW9mIHVybC5wYXNzd29yZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGF1dGgucGFzc3dvcmQgPSBkZWNvZGVVUklDb21wb25lbnQodXJsLnBhc3N3b3JkKTtcbiAgICAgICAgfVxuICAgICAgICB1cmxPcHRpb25zLnNldCgnYXV0aCcsIFthdXRoXSk7XG4gICAgfVxuICAgIGZvciAoY29uc3Qga2V5IG9mIHVybC5zZWFyY2hQYXJhbXMua2V5cygpKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0QWxsKGtleSk7XG4gICAgICAgIGNvbnN0IGlzUmVhZFByZWZlcmVuY2VUYWdzID0gL3JlYWRQcmVmZXJlbmNlVGFncy9pLnRlc3Qoa2V5KTtcbiAgICAgICAgaWYgKCFpc1JlYWRQcmVmZXJlbmNlVGFncyAmJiB2YWx1ZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgVVJJIG9wdGlvbiBcIiR7a2V5fVwiIGNhbm5vdCBhcHBlYXIgbW9yZSB0aGFuIG9uY2UgaW4gdGhlIGNvbm5lY3Rpb24gc3RyaW5nYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1JlYWRQcmVmZXJlbmNlVGFncyAmJiB2YWx1ZXMuaW5jbHVkZXMoJycpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBVUkkgb3B0aW9uIFwiJHtrZXl9XCIgY2Fubm90IGJlIHNwZWNpZmllZCB3aXRoIG5vIHZhbHVlYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF1cmxPcHRpb25zLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICB1cmxPcHRpb25zLnNldChrZXksIHZhbHVlcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgb2JqZWN0T3B0aW9ucyA9IG5ldyBDYXNlSW5zZW5zaXRpdmVNYXAoT2JqZWN0LmVudHJpZXMob3B0aW9ucykuZmlsdGVyKChbLCB2XSkgPT4gdiAhPSBudWxsKSk7XG4gICAgLy8gVmFsaWRhdGUgb3B0aW9ucyB0aGF0IGNhbiBvbmx5IGJlIHByb3ZpZGVkIGJ5IG9uZSBvZiB1cmkgb3Igb2JqZWN0XG4gICAgaWYgKHVybE9wdGlvbnMuaGFzKCdzZXJ2ZXJBcGknKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ1VSSSBjYW5ub3QgY29udGFpbiBgc2VydmVyQXBpYCwgaXQgY2FuIG9ubHkgYmUgcGFzc2VkIHRvIHRoZSBjbGllbnQnKTtcbiAgICB9XG4gICAgY29uc3QgdXJpTWVjaGFuaXNtUHJvcGVydGllcyA9IHVybE9wdGlvbnMuZ2V0KCdhdXRoTWVjaGFuaXNtUHJvcGVydGllcycpO1xuICAgIGlmICh1cmlNZWNoYW5pc21Qcm9wZXJ0aWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgb2YgdXJpTWVjaGFuaXNtUHJvcGVydGllcykge1xuICAgICAgICAgICAgaWYgKC8oXnwsKUFMTE9XRURfSE9TVFM6Ly50ZXN0KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcignQXV0aCBtZWNoYW5pc20gcHJvcGVydHkgQUxMT1dFRF9IT1NUUyBpcyBub3QgYWxsb3dlZCBpbiB0aGUgY29ubmVjdGlvbiBzdHJpbmcuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9iamVjdE9wdGlvbnMuaGFzKCdsb2FkQmFsYW5jZWQnKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ2xvYWRCYWxhbmNlZCBpcyBvbmx5IGEgdmFsaWQgb3B0aW9uIGluIHRoZSBVUkknKTtcbiAgICB9XG4gICAgLy8gQWxsIG9wdGlvbiBjb2xsZWN0aW9uXG4gICAgY29uc3QgYWxsUHJvdmlkZWRPcHRpb25zID0gbmV3IENhc2VJbnNlbnNpdGl2ZU1hcCgpO1xuICAgIGNvbnN0IGFsbFByb3ZpZGVkS2V5cyA9IG5ldyBTZXQoWy4uLnVybE9wdGlvbnMua2V5cygpLCAuLi5vYmplY3RPcHRpb25zLmtleXMoKV0pO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIGFsbFByb3ZpZGVkS2V5cykge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSBbXTtcbiAgICAgICAgY29uc3Qgb2JqZWN0T3B0aW9uVmFsdWUgPSBvYmplY3RPcHRpb25zLmdldChrZXkpO1xuICAgICAgICBpZiAob2JqZWN0T3B0aW9uVmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFsdWVzLnB1c2gob2JqZWN0T3B0aW9uVmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVybFZhbHVlcyA9IHVybE9wdGlvbnMuZ2V0KGtleSkgPz8gW107XG4gICAgICAgIHZhbHVlcy5wdXNoKC4uLnVybFZhbHVlcyk7XG4gICAgICAgIGFsbFByb3ZpZGVkT3B0aW9ucy5zZXQoa2V5LCB2YWx1ZXMpO1xuICAgIH1cbiAgICBpZiAoYWxsUHJvdmlkZWRPcHRpb25zLmhhcygndGxzJykgfHwgYWxsUHJvdmlkZWRPcHRpb25zLmhhcygnc3NsJykpIHtcbiAgICAgICAgY29uc3QgdGxzQW5kU3NsT3B0cyA9IChhbGxQcm92aWRlZE9wdGlvbnMuZ2V0KCd0bHMnKSB8fCBbXSlcbiAgICAgICAgICAgIC5jb25jYXQoYWxsUHJvdmlkZWRPcHRpb25zLmdldCgnc3NsJykgfHwgW10pXG4gICAgICAgICAgICAubWFwKGdldEJvb2xlYW4uYmluZChudWxsLCAndGxzL3NzbCcpKTtcbiAgICAgICAgaWYgKG5ldyBTZXQodGxzQW5kU3NsT3B0cykuc2l6ZSAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdBbGwgdmFsdWVzIG9mIHRscy9zc2wgbXVzdCBiZSB0aGUgc2FtZS4nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjaGVja1RMU09wdGlvbnMoYWxsUHJvdmlkZWRPcHRpb25zKTtcbiAgICBjb25zdCB1bnN1cHBvcnRlZE9wdGlvbnMgPSAoMCwgdXRpbHNfMS5zZXREaWZmZXJlbmNlKShhbGxQcm92aWRlZEtleXMsIEFycmF5LmZyb20oT2JqZWN0LmtleXMoZXhwb3J0cy5PUFRJT05TKSkubWFwKHMgPT4gcy50b0xvd2VyQ2FzZSgpKSk7XG4gICAgaWYgKHVuc3VwcG9ydGVkT3B0aW9ucy5zaXplICE9PSAwKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbldvcmQgPSB1bnN1cHBvcnRlZE9wdGlvbnMuc2l6ZSA+IDEgPyAnb3B0aW9ucycgOiAnb3B0aW9uJztcbiAgICAgICAgY29uc3QgaXNPckFyZSA9IHVuc3VwcG9ydGVkT3B0aW9ucy5zaXplID4gMSA/ICdhcmUnIDogJ2lzJztcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGAke29wdGlvbldvcmR9ICR7QXJyYXkuZnJvbSh1bnN1cHBvcnRlZE9wdGlvbnMpLmpvaW4oJywgJyl9ICR7aXNPckFyZX0gbm90IHN1cHBvcnRlZGApO1xuICAgIH1cbiAgICAvLyBPcHRpb24gcGFyc2luZyBhbmQgc2V0dGluZ1xuICAgIGZvciAoY29uc3QgW2tleSwgZGVzY3JpcHRvcl0gb2YgT2JqZWN0LmVudHJpZXMoZXhwb3J0cy5PUFRJT05TKSkge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSBhbGxQcm92aWRlZE9wdGlvbnMuZ2V0KGtleSk7XG4gICAgICAgIGlmICghdmFsdWVzIHx8IHZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLkRFRkFVTFRfT1BUSU9OUy5oYXMoa2V5KSkge1xuICAgICAgICAgICAgICAgIHNldE9wdGlvbihtb25nb09wdGlvbnMsIGtleSwgZGVzY3JpcHRvciwgW2V4cG9ydHMuREVGQVVMVF9PUFRJT05TLmdldChrZXkpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB7IGRlcHJlY2F0ZWQgfSA9IGRlc2NyaXB0b3I7XG4gICAgICAgICAgICBpZiAoZGVwcmVjYXRlZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlcHJlY2F0ZWRNc2cgPSB0eXBlb2YgZGVwcmVjYXRlZCA9PT0gJ3N0cmluZycgPyBgOiAke2RlcHJlY2F0ZWR9YCA6ICcnO1xuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLmVtaXRXYXJuaW5nKShgJHtrZXl9IGlzIGEgZGVwcmVjYXRlZCBvcHRpb24ke2RlcHJlY2F0ZWRNc2d9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRPcHRpb24obW9uZ29PcHRpb25zLCBrZXksIGRlc2NyaXB0b3IsIHZhbHVlcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscykge1xuICAgICAgICBjb25zdCBpc0dzc2FwaSA9IG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9HU1NBUEk7XG4gICAgICAgIGNvbnN0IGlzWDUwOSA9IG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9YNTA5O1xuICAgICAgICBjb25zdCBpc0F3cyA9IG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9BV1M7XG4gICAgICAgIGNvbnN0IGlzT2lkYyA9IG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9PSURDO1xuICAgICAgICBpZiAoKGlzR3NzYXBpIHx8IGlzWDUwOSkgJiZcbiAgICAgICAgICAgIGFsbFByb3ZpZGVkT3B0aW9ucy5oYXMoJ2F1dGhTb3VyY2UnKSAmJlxuICAgICAgICAgICAgbW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLnNvdXJjZSAhPT0gJyRleHRlcm5hbCcpIHtcbiAgICAgICAgICAgIC8vIElmIGF1dGhTb3VyY2Ugd2FzIGV4cGxpY2l0bHkgZ2l2ZW4gYW5kIGl0cyBpbmNvcnJlY3QsIHdlIGVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYGF1dGhNZWNoYW5pc20gJHttb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtfSByZXF1aXJlcyBhbiBhdXRoU291cmNlIG9mICckZXh0ZXJuYWwnYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEoaXNHc3NhcGkgfHwgaXNYNTA5IHx8IGlzQXdzIHx8IGlzT2lkYykgJiZcbiAgICAgICAgICAgIG1vbmdvT3B0aW9ucy5kYk5hbWUgJiZcbiAgICAgICAgICAgICFhbGxQcm92aWRlZE9wdGlvbnMuaGFzKCdhdXRoU291cmNlJykpIHtcbiAgICAgICAgICAgIC8vIGluaGVyaXQgdGhlIGRiTmFtZSB1bmxlc3MgR1NTQVBJIG9yIFg1MDksIHRoZW4gc2lsZW50bHkgaWdub3JlIGRiTmFtZVxuICAgICAgICAgICAgLy8gYW5kIHRoZXJlIHdhcyBubyBzcGVjaWZpYyBhdXRoU291cmNlIGdpdmVuXG4gICAgICAgICAgICBtb25nb09wdGlvbnMuY3JlZGVudGlhbHMgPSBtb25nb19jcmVkZW50aWFsc18xLk1vbmdvQ3JlZGVudGlhbHMubWVyZ2UobW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLCB7XG4gICAgICAgICAgICAgICAgc291cmNlOiBtb25nb09wdGlvbnMuZGJOYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNBd3MgJiYgbW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLnVzZXJuYW1lICYmICFtb25nb09wdGlvbnMuY3JlZGVudGlhbHMucGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IoYFdoZW4gdXNpbmcgJHttb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtfSBwYXNzd29yZCBtdXN0IGJlIHNldCB3aGVuIGEgdXNlcm5hbWUgaXMgc3BlY2lmaWVkYCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzLnZhbGlkYXRlKCk7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBvbmx5IGF1dGggcmVsYXRlZCBvcHRpb24gcHJvdmlkZWQgd2FzIGF1dGhTb3VyY2UsIGlmIHNvIHdlIGNhbiByZW1vdmUgY3JlZGVudGlhbHNcbiAgICAgICAgaWYgKG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5wYXNzd29yZCA9PT0gJycgJiZcbiAgICAgICAgICAgIG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy51c2VybmFtZSA9PT0gJycgJiZcbiAgICAgICAgICAgIG1vbmdvT3B0aW9ucy5jcmVkZW50aWFscy5tZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9ERUZBVUxUICYmXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhtb25nb09wdGlvbnMuY3JlZGVudGlhbHMubWVjaGFuaXNtUHJvcGVydGllcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBkZWxldGUgbW9uZ29PcHRpb25zLmNyZWRlbnRpYWxzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghbW9uZ29PcHRpb25zLmRiTmFtZSkge1xuICAgICAgICAvLyBkYk5hbWUgZGVmYXVsdCBpcyBhcHBsaWVkIGhlcmUgYmVjYXVzZSBvZiB0aGUgY3JlZGVudGlhbCB2YWxpZGF0aW9uIGFib3ZlXG4gICAgICAgIG1vbmdvT3B0aW9ucy5kYk5hbWUgPSAndGVzdCc7XG4gICAgfVxuICAgIHZhbGlkYXRlTG9hZEJhbGFuY2VkT3B0aW9ucyhob3N0cywgbW9uZ29PcHRpb25zLCBpc1NSVik7XG4gICAgaWYgKG1vbmdvQ2xpZW50ICYmIG1vbmdvT3B0aW9ucy5hdXRvRW5jcnlwdGlvbikge1xuICAgICAgICBlbmNyeXB0ZXJfMS5FbmNyeXB0ZXIuY2hlY2tGb3JNb25nb0NyeXB0KCk7XG4gICAgICAgIG1vbmdvT3B0aW9ucy5lbmNyeXB0ZXIgPSBuZXcgZW5jcnlwdGVyXzEuRW5jcnlwdGVyKG1vbmdvQ2xpZW50LCB1cmksIG9wdGlvbnMpO1xuICAgICAgICBtb25nb09wdGlvbnMuYXV0b0VuY3J5cHRlciA9IG1vbmdvT3B0aW9ucy5lbmNyeXB0ZXIuYXV0b0VuY3J5cHRlcjtcbiAgICB9XG4gICAgLy8gUG90ZW50aWFsIFNSViBPdmVycmlkZXMgYW5kIFNSViBjb25uZWN0aW9uIHN0cmluZyB2YWxpZGF0aW9uc1xuICAgIG1vbmdvT3B0aW9ucy51c2VyU3BlY2lmaWVkQXV0aFNvdXJjZSA9XG4gICAgICAgIG9iamVjdE9wdGlvbnMuaGFzKCdhdXRoU291cmNlJykgfHwgdXJsT3B0aW9ucy5oYXMoJ2F1dGhTb3VyY2UnKTtcbiAgICBtb25nb09wdGlvbnMudXNlclNwZWNpZmllZFJlcGxpY2FTZXQgPVxuICAgICAgICBvYmplY3RPcHRpb25zLmhhcygncmVwbGljYVNldCcpIHx8IHVybE9wdGlvbnMuaGFzKCdyZXBsaWNhU2V0Jyk7XG4gICAgaWYgKGlzU1JWKSB7XG4gICAgICAgIC8vIFNSViBSZWNvcmQgaXMgcmVzb2x2ZWQgdXBvbiBjb25uZWN0aW5nXG4gICAgICAgIG1vbmdvT3B0aW9ucy5zcnZIb3N0ID0gaG9zdHNbMF07XG4gICAgICAgIGlmIChtb25nb09wdGlvbnMuZGlyZWN0Q29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignU1JWIFVSSSBkb2VzIG5vdCBzdXBwb3J0IGRpcmVjdENvbm5lY3Rpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9uZ29PcHRpb25zLnNydk1heEhvc3RzID4gMCAmJiB0eXBlb2YgbW9uZ29PcHRpb25zLnJlcGxpY2FTZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0Nhbm5vdCB1c2Ugc3J2TWF4SG9zdHMgb3B0aW9uIHdpdGggcmVwbGljYVNldCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNSViB0dXJucyBvbiBUTFMgYnkgZGVmYXVsdCwgYnV0IHVzZXJzIGNhbiBvdmVycmlkZSBhbmQgdHVybiBpdCBvZmZcbiAgICAgICAgY29uc3Qgbm9Vc2VyU3BlY2lmaWVkVExTID0gIW9iamVjdE9wdGlvbnMuaGFzKCd0bHMnKSAmJiAhdXJsT3B0aW9ucy5oYXMoJ3RscycpO1xuICAgICAgICBjb25zdCBub1VzZXJTcGVjaWZpZWRTU0wgPSAhb2JqZWN0T3B0aW9ucy5oYXMoJ3NzbCcpICYmICF1cmxPcHRpb25zLmhhcygnc3NsJyk7XG4gICAgICAgIGlmIChub1VzZXJTcGVjaWZpZWRUTFMgJiYgbm9Vc2VyU3BlY2lmaWVkU1NMKSB7XG4gICAgICAgICAgICBtb25nb09wdGlvbnMudGxzID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgdXNlclNwZWNpZmllZFNydk9wdGlvbnMgPSB1cmxPcHRpb25zLmhhcygnc3J2TWF4SG9zdHMnKSB8fFxuICAgICAgICAgICAgb2JqZWN0T3B0aW9ucy5oYXMoJ3Nydk1heEhvc3RzJykgfHxcbiAgICAgICAgICAgIHVybE9wdGlvbnMuaGFzKCdzcnZTZXJ2aWNlTmFtZScpIHx8XG4gICAgICAgICAgICBvYmplY3RPcHRpb25zLmhhcygnc3J2U2VydmljZU5hbWUnKTtcbiAgICAgICAgaWYgKHVzZXJTcGVjaWZpZWRTcnZPcHRpb25zKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0Nhbm5vdCB1c2Ugc3J2TWF4SG9zdHMgb3Igc3J2U2VydmljZU5hbWUgd2l0aCBhIG5vbi1zcnYgY29ubmVjdGlvbiBzdHJpbmcnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAobW9uZ29PcHRpb25zLmRpcmVjdENvbm5lY3Rpb24gJiYgbW9uZ29PcHRpb25zLmhvc3RzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ2RpcmVjdENvbm5lY3Rpb24gb3B0aW9uIHJlcXVpcmVzIGV4YWN0bHkgb25lIGhvc3QnKTtcbiAgICB9XG4gICAgaWYgKCFtb25nb09wdGlvbnMucHJveHlIb3N0ICYmXG4gICAgICAgIChtb25nb09wdGlvbnMucHJveHlQb3J0IHx8IG1vbmdvT3B0aW9ucy5wcm94eVVzZXJuYW1lIHx8IG1vbmdvT3B0aW9ucy5wcm94eVBhc3N3b3JkKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ011c3Qgc3BlY2lmeSBwcm94eUhvc3QgaWYgb3RoZXIgcHJveHkgb3B0aW9ucyBhcmUgcGFzc2VkJyk7XG4gICAgfVxuICAgIGlmICgobW9uZ29PcHRpb25zLnByb3h5VXNlcm5hbWUgJiYgIW1vbmdvT3B0aW9ucy5wcm94eVBhc3N3b3JkKSB8fFxuICAgICAgICAoIW1vbmdvT3B0aW9ucy5wcm94eVVzZXJuYW1lICYmIG1vbmdvT3B0aW9ucy5wcm94eVBhc3N3b3JkKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0NhbiBvbmx5IHNwZWNpZnkgYm90aCBvZiBwcm94eSB1c2VybmFtZS9wYXNzd29yZCBvciBuZWl0aGVyJyk7XG4gICAgfVxuICAgIGNvbnN0IHByb3h5T3B0aW9ucyA9IFsncHJveHlIb3N0JywgJ3Byb3h5UG9ydCcsICdwcm94eVVzZXJuYW1lJywgJ3Byb3h5UGFzc3dvcmQnXS5tYXAoa2V5ID0+IHVybE9wdGlvbnMuZ2V0KGtleSkgPz8gW10pO1xuICAgIGlmIChwcm94eU9wdGlvbnMuc29tZShvcHRpb25zID0+IG9wdGlvbnMubGVuZ3RoID4gMSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKCdQcm94eSBvcHRpb25zIGNhbm5vdCBiZSBzcGVjaWZpZWQgbXVsdGlwbGUgdGltZXMgaW4gdGhlIGNvbm5lY3Rpb24gc3RyaW5nJyk7XG4gICAgfVxuICAgIG1vbmdvT3B0aW9ucy5tb25nb0xvZ2dlck9wdGlvbnMgPSBtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dlci5yZXNvbHZlT3B0aW9ucyh7XG4gICAgICAgIE1PTkdPREJfTE9HX0NPTU1BTkQ6IHByb2Nlc3MuZW52Lk1PTkdPREJfTE9HX0NPTU1BTkQsXG4gICAgICAgIE1PTkdPREJfTE9HX1RPUE9MT0dZOiBwcm9jZXNzLmVudi5NT05HT0RCX0xPR19UT1BPTE9HWSxcbiAgICAgICAgTU9OR09EQl9MT0dfU0VSVkVSX1NFTEVDVElPTjogcHJvY2Vzcy5lbnYuTU9OR09EQl9MT0dfU0VSVkVSX1NFTEVDVElPTixcbiAgICAgICAgTU9OR09EQl9MT0dfQ09OTkVDVElPTjogcHJvY2Vzcy5lbnYuTU9OR09EQl9MT0dfQ09OTkVDVElPTixcbiAgICAgICAgTU9OR09EQl9MT0dfQ0xJRU5UOiBwcm9jZXNzLmVudi5NT05HT0RCX0xPR19DTElFTlQsXG4gICAgICAgIE1PTkdPREJfTE9HX0FMTDogcHJvY2Vzcy5lbnYuTU9OR09EQl9MT0dfQUxMLFxuICAgICAgICBNT05HT0RCX0xPR19NQVhfRE9DVU1FTlRfTEVOR1RIOiBwcm9jZXNzLmVudi5NT05HT0RCX0xPR19NQVhfRE9DVU1FTlRfTEVOR1RILFxuICAgICAgICBNT05HT0RCX0xPR19QQVRIOiBwcm9jZXNzLmVudi5NT05HT0RCX0xPR19QQVRIXG4gICAgfSwge1xuICAgICAgICBtb25nb2RiTG9nUGF0aDogbW9uZ29PcHRpb25zLm1vbmdvZGJMb2dQYXRoLFxuICAgICAgICBtb25nb2RiTG9nQ29tcG9uZW50U2V2ZXJpdGllczogbW9uZ29PcHRpb25zLm1vbmdvZGJMb2dDb21wb25lbnRTZXZlcml0aWVzLFxuICAgICAgICBtb25nb2RiTG9nTWF4RG9jdW1lbnRMZW5ndGg6IG1vbmdvT3B0aW9ucy5tb25nb2RiTG9nTWF4RG9jdW1lbnRMZW5ndGhcbiAgICB9KTtcbiAgICBtb25nb09wdGlvbnMubWV0YWRhdGEgPSAoMCwgY2xpZW50X21ldGFkYXRhXzEubWFrZUNsaWVudE1ldGFkYXRhKShtb25nb09wdGlvbnMpO1xuICAgIG1vbmdvT3B0aW9ucy5leHRlbmRlZE1ldGFkYXRhID0gKDAsIGNsaWVudF9tZXRhZGF0YV8xLmFkZENvbnRhaW5lck1ldGFkYXRhKShtb25nb09wdGlvbnMubWV0YWRhdGEpLnRoZW4odW5kZWZpbmVkLCB1dGlsc18xLnNxdWFzaEVycm9yKTsgLy8gcmVqZWN0aW9ucyB3aWxsIGJlIGhhbmRsZWQgbGF0ZXJcbiAgICByZXR1cm4gbW9uZ29PcHRpb25zO1xufVxuLyoqXG4gKiAjIyMjIFRocm93cyBpZiBMQiBtb2RlIGlzIHRydWU6XG4gKiAtIGhvc3RzIGNvbnRhaW5zIG1vcmUgdGhhbiBvbmUgaG9zdFxuICogLSB0aGVyZSBpcyBhIHJlcGxpY2FTZXQgbmFtZSBzZXRcbiAqIC0gZGlyZWN0Q29ubmVjdGlvbiBpcyBzZXRcbiAqIC0gaWYgc3J2TWF4SG9zdHMgaXMgdXNlZCB3aGVuIGFuIHNydiBjb25uZWN0aW9uIHN0cmluZyBpcyBwYXNzZWQgaW5cbiAqXG4gKiBAdGhyb3dzIE1vbmdvUGFyc2VFcnJvclxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZUxvYWRCYWxhbmNlZE9wdGlvbnMoaG9zdHMsIG1vbmdvT3B0aW9ucywgaXNTcnYpIHtcbiAgICBpZiAobW9uZ29PcHRpb25zLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICBpZiAoaG9zdHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKExCX1NJTkdMRV9IT1NUX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9uZ29PcHRpb25zLnJlcGxpY2FTZXQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihMQl9SRVBMSUNBX1NFVF9FUlJPUik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vbmdvT3B0aW9ucy5kaXJlY3RDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoTEJfRElSRUNUX0NPTk5FQ1RJT05fRVJST1IpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1NydiAmJiBtb25nb09wdGlvbnMuc3J2TWF4SG9zdHMgPiAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0Nhbm5vdCBsaW1pdCBzcnYgaG9zdHMgd2l0aCBsb2FkQmFsYW5jZWQgZW5hYmxlZCcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybjtcbn1cbmZ1bmN0aW9uIHNldE9wdGlvbihtb25nb09wdGlvbnMsIGtleSwgZGVzY3JpcHRvciwgdmFsdWVzKSB7XG4gICAgY29uc3QgeyB0YXJnZXQsIHR5cGUsIHRyYW5zZm9ybSB9ID0gZGVzY3JpcHRvcjtcbiAgICBjb25zdCBuYW1lID0gdGFyZ2V0ID8/IGtleTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICBtb25nb09wdGlvbnNbbmFtZV0gPSBnZXRCb29sZWFuKG5hbWUsIHZhbHVlc1swXSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnaW50JzpcbiAgICAgICAgICAgIG1vbmdvT3B0aW9uc1tuYW1lXSA9IGdldEludEZyb21PcHRpb25zKG5hbWUsIHZhbHVlc1swXSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndWludCc6XG4gICAgICAgICAgICBtb25nb09wdGlvbnNbbmFtZV0gPSBnZXRVSW50RnJvbU9wdGlvbnMobmFtZSwgdmFsdWVzWzBdKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgaWYgKHZhbHVlc1swXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb25nb09wdGlvbnNbbmFtZV0gPSBTdHJpbmcodmFsdWVzWzBdKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyZWNvcmQnOlxuICAgICAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5pc1JlY29yZCkodmFsdWVzWzBdKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgJHtuYW1lfSBtdXN0IGJlIGFuIG9iamVjdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9uZ29PcHRpb25zW25hbWVdID0gdmFsdWVzWzBdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2FueSc6XG4gICAgICAgICAgICBtb25nb09wdGlvbnNbbmFtZV0gPSB2YWx1ZXNbMF07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgaWYgKCF0cmFuc2Zvcm0pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ0Rlc2NyaXB0b3JzIG1pc3NpbmcgYSB0eXBlIG11c3QgZGVmaW5lIGEgdHJhbnNmb3JtJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1WYWx1ZSA9IHRyYW5zZm9ybSh7IG5hbWUsIG9wdGlvbnM6IG1vbmdvT3B0aW9ucywgdmFsdWVzIH0pO1xuICAgICAgICAgICAgbW9uZ29PcHRpb25zW25hbWVdID0gdHJhbnNmb3JtVmFsdWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuT1BUSU9OUyA9IHtcbiAgICBhcHBOYW1lOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBhdXRoOiB7XG4gICAgICAgIHRhcmdldDogJ2NyZWRlbnRpYWxzJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgb3B0aW9ucywgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGlmICghKDAsIHV0aWxzXzEuaXNSZWNvcmQpKHZhbHVlLCBbJ3VzZXJuYW1lJywgJ3Bhc3N3b3JkJ10pKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGAke25hbWV9IG11c3QgYmUgYW4gb2JqZWN0IHdpdGggJ3VzZXJuYW1lJyBhbmQgJ3Bhc3N3b3JkJyBwcm9wZXJ0aWVzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbW9uZ29fY3JlZGVudGlhbHNfMS5Nb25nb0NyZWRlbnRpYWxzLm1lcmdlKG9wdGlvbnMuY3JlZGVudGlhbHMsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdmFsdWUudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHZhbHVlLnBhc3N3b3JkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYXV0aE1lY2hhbmlzbToge1xuICAgICAgICB0YXJnZXQ6ICdjcmVkZW50aWFscycsXG4gICAgICAgIHRyYW5zZm9ybSh7IG9wdGlvbnMsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBjb25zdCBtZWNoYW5pc21zID0gT2JqZWN0LnZhbHVlcyhwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtKTtcbiAgICAgICAgICAgIGNvbnN0IFttZWNoYW5pc21dID0gbWVjaGFuaXNtcy5maWx0ZXIobSA9PiBtLm1hdGNoKFJlZ0V4cChTdHJpbmcucmF3IGBcXGIke3ZhbHVlfVxcYmAsICdpJykpKTtcbiAgICAgICAgICAgIGlmICghbWVjaGFuaXNtKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBhdXRoTWVjaGFuaXNtIG9uZSBvZiAke21lY2hhbmlzbXN9LCBnb3QgJHt2YWx1ZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBzb3VyY2UgPSBvcHRpb25zLmNyZWRlbnRpYWxzPy5zb3VyY2U7XG4gICAgICAgICAgICBpZiAobWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfUExBSU4gfHxcbiAgICAgICAgICAgICAgICBwcm92aWRlcnNfMS5BVVRIX01FQ0hTX0FVVEhfU1JDX0VYVEVSTkFMLmhhcyhtZWNoYW5pc20pKSB7XG4gICAgICAgICAgICAgICAgLy8gc29tZSBtZWNoYW5pc21zIGhhdmUgJyRleHRlcm5hbCcgYXMgdGhlIEF1dGggU291cmNlXG4gICAgICAgICAgICAgICAgc291cmNlID0gJyRleHRlcm5hbCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcGFzc3dvcmQgPSBvcHRpb25zLmNyZWRlbnRpYWxzPy5wYXNzd29yZDtcbiAgICAgICAgICAgIGlmIChtZWNoYW5pc20gPT09IHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9YNTA5ICYmIHBhc3N3b3JkID09PSAnJykge1xuICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vbmdvX2NyZWRlbnRpYWxzXzEuTW9uZ29DcmVkZW50aWFscy5tZXJnZShvcHRpb25zLmNyZWRlbnRpYWxzLCB7XG4gICAgICAgICAgICAgICAgbWVjaGFuaXNtLFxuICAgICAgICAgICAgICAgIHNvdXJjZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIE5vdGUgdGhhdCBpZiB0aGUgYXV0aE1lY2hhbmlzbVByb3BlcnRpZXMgY29udGFpbiBhIFRPS0VOX1JFU09VUkNFIHRoYXQgaGFzIGFcbiAgICAvLyBjb21tYSBpbiBpdCwgaXQgTVVTVCBiZSBzdXBwbGllZCBhcyBhIE1vbmdvQ2xpZW50IG9wdGlvbiBpbnN0ZWFkIG9mIGluIHRoZVxuICAgIC8vIGNvbm5lY3Rpb24gc3RyaW5nLlxuICAgIGF1dGhNZWNoYW5pc21Qcm9wZXJ0aWVzOiB7XG4gICAgICAgIHRhcmdldDogJ2NyZWRlbnRpYWxzJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgb3B0aW9ucywgdmFsdWVzIH0pIHtcbiAgICAgICAgICAgIC8vIFdlIGNhbiBoYXZlIGEgY29tYmluYXRpb24gb2Ygb3B0aW9ucyBwYXNzZWQgaW4gdGhlIFVSSSBhbmQgb3B0aW9ucyBwYXNzZWRcbiAgICAgICAgICAgIC8vIGFzIGFuIG9iamVjdCB0byB0aGUgTW9uZ29DbGllbnQuIFNvIHdlIG11c3QgdHJhbnNmb3JtIHRoZSBzdHJpbmcgb3B0aW9uc1xuICAgICAgICAgICAgLy8gYXMgd2VsbCBhcyBtZXJnZSB0aGVtIHRvZ2V0aGVyIHdpdGggYSBwb3RlbnRpYWxseSBwcm92aWRlZCBvYmplY3QuXG4gICAgICAgICAgICBsZXQgbWVjaGFuaXNtUHJvcGVydGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG9wdGlvblZhbHVlIG9mIHZhbHVlcykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9uVmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXNGcm9tU3RyaW5nKG9wdGlvblZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWNoYW5pc21Qcm9wZXJ0aWVzW2tleV0gPSBnZXRCb29sZWFuKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lY2hhbmlzbVByb3BlcnRpZXNba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCB1dGlsc18xLmlzUmVjb3JkKShvcHRpb25WYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcignQXV0aE1lY2hhbmlzbVByb3BlcnRpZXMgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBtZWNoYW5pc21Qcm9wZXJ0aWVzID0geyAuLi5vcHRpb25WYWx1ZSB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb25nb19jcmVkZW50aWFsc18xLk1vbmdvQ3JlZGVudGlhbHMubWVyZ2Uob3B0aW9ucy5jcmVkZW50aWFscywge1xuICAgICAgICAgICAgICAgIG1lY2hhbmlzbVByb3BlcnRpZXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhdXRoU291cmNlOiB7XG4gICAgICAgIHRhcmdldDogJ2NyZWRlbnRpYWxzJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgb3B0aW9ucywgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gbW9uZ29fY3JlZGVudGlhbHNfMS5Nb25nb0NyZWRlbnRpYWxzLm1lcmdlKG9wdGlvbnMuY3JlZGVudGlhbHMsIHsgc291cmNlIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhdXRvRW5jcnlwdGlvbjoge1xuICAgICAgICB0eXBlOiAncmVjb3JkJ1xuICAgIH0sXG4gICAgYXV0b1NlbGVjdEZhbWlseToge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICB9LFxuICAgIGF1dG9TZWxlY3RGYW1pbHlBdHRlbXB0VGltZW91dDoge1xuICAgICAgICB0eXBlOiAndWludCdcbiAgICB9LFxuICAgIGJzb25SZWdFeHA6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBzZXJ2ZXJBcGk6IHtcbiAgICAgICAgdGFyZ2V0OiAnc2VydmVyQXBpJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmVyc2lvbl0gfSkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyQXBpVG9WYWxpZGF0ZSA9IHR5cGVvZiB2ZXJzaW9uID09PSAnc3RyaW5nJyA/IHsgdmVyc2lvbiB9IDogdmVyc2lvbjtcbiAgICAgICAgICAgIGNvbnN0IHZlcnNpb25Ub1ZhbGlkYXRlID0gc2VydmVyQXBpVG9WYWxpZGF0ZSAmJiBzZXJ2ZXJBcGlUb1ZhbGlkYXRlLnZlcnNpb247XG4gICAgICAgICAgICBpZiAoIXZlcnNpb25Ub1ZhbGlkYXRlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBJbnZhbGlkIFxcYHNlcnZlckFwaVxcYCBwcm9wZXJ0eTsgbXVzdCBzcGVjaWZ5IGEgdmVyc2lvbiBmcm9tIHRoZSBmb2xsb3dpbmcgZW51bTogW1wiJHtPYmplY3QudmFsdWVzKG1vbmdvX2NsaWVudF8xLlNlcnZlckFwaVZlcnNpb24pLmpvaW4oJ1wiLCBcIicpfVwiXWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFPYmplY3QudmFsdWVzKG1vbmdvX2NsaWVudF8xLlNlcnZlckFwaVZlcnNpb24pLnNvbWUodiA9PiB2ID09PSB2ZXJzaW9uVG9WYWxpZGF0ZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYEludmFsaWQgc2VydmVyIEFQSSB2ZXJzaW9uPSR7dmVyc2lvblRvVmFsaWRhdGV9OyBtdXN0IGJlIGluIHRoZSBmb2xsb3dpbmcgZW51bTogW1wiJHtPYmplY3QudmFsdWVzKG1vbmdvX2NsaWVudF8xLlNlcnZlckFwaVZlcnNpb24pLmpvaW4oJ1wiLCBcIicpfVwiXWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNlcnZlckFwaVRvVmFsaWRhdGU7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGNoZWNrS2V5czoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIGNvbXByZXNzb3JzOiB7XG4gICAgICAgIGRlZmF1bHQ6ICdub25lJyxcbiAgICAgICAgdGFyZ2V0OiAnY29tcHJlc3NvcnMnLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXMgfSkge1xuICAgICAgICAgICAgY29uc3QgY29tcHJlc3Npb25MaXN0ID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjb21wVmFsIG9mIHZhbHVlcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBWYWxBcnJheSA9IHR5cGVvZiBjb21wVmFsID09PSAnc3RyaW5nJyA/IGNvbXBWYWwuc3BsaXQoJywnKSA6IGNvbXBWYWw7XG4gICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvbXBWYWxBcnJheSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignY29tcHJlc3NvcnMgbXVzdCBiZSBhbiBhcnJheSBvciBhIGNvbW1hLWRlbGltaXRlZCBsaXN0IG9mIHN0cmluZ3MnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGNvbXBWYWxBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY29tcHJlc3Npb25fMS5Db21wcmVzc29yKS5pbmNsdWRlcyhTdHJpbmcoYykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvbkxpc3QuYWRkKFN0cmluZyhjKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGAke2N9IGlzIG5vdCBhIHZhbGlkIGNvbXByZXNzaW9uIG1lY2hhbmlzbS4gTXVzdCBiZSBvbmUgb2Y6ICR7T2JqZWN0LmtleXMoY29tcHJlc3Npb25fMS5Db21wcmVzc29yKX0uYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gWy4uLmNvbXByZXNzaW9uTGlzdF07XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGNvbm5lY3RUaW1lb3V0TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMzAwMDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgZGJOYW1lOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICBkaXJlY3RDb25uZWN0aW9uOiB7XG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIGRyaXZlckluZm86IHtcbiAgICAgICAgZGVmYXVsdDoge30sXG4gICAgICAgIHR5cGU6ICdyZWNvcmQnXG4gICAgfSxcbiAgICBlbmFibGVVdGY4VmFsaWRhdGlvbjogeyB0eXBlOiAnYm9vbGVhbicsIGRlZmF1bHQ6IHRydWUgfSxcbiAgICBmYW1pbHk6IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybVZhbHVlID0gZ2V0SW50RnJvbU9wdGlvbnMobmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybVZhbHVlID09PSA0IHx8IHRyYW5zZm9ybVZhbHVlID09PSA2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybVZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBPcHRpb24gJ2ZhbWlseScgbXVzdCBiZSA0IG9yIDYgZ290ICR7dHJhbnNmb3JtVmFsdWV9LmApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBmaWVsZHNBc1Jhdzoge1xuICAgICAgICB0eXBlOiAncmVjb3JkJ1xuICAgIH0sXG4gICAgZm9yY2VTZXJ2ZXJPYmplY3RJZDoge1xuICAgICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBmc3luYzoge1xuICAgICAgICBkZXByZWNhdGVkOiAnUGxlYXNlIHVzZSBqb3VybmFsIGluc3RlYWQnLFxuICAgICAgICB0YXJnZXQ6ICd3cml0ZUNvbmNlcm4nLFxuICAgICAgICB0cmFuc2Zvcm0oeyBuYW1lLCBvcHRpb25zLCB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgY29uc3Qgd2MgPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgIGZzeW5jOiBnZXRCb29sZWFuKG5hbWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF3YylcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYFVuYWJsZSB0byBtYWtlIGEgd3JpdGVDb25jZXJuIGZyb20gZnN5bmM9JHt2YWx1ZX1gKTtcbiAgICAgICAgICAgIHJldHVybiB3YztcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMTAwMDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgaWdub3JlVW5kZWZpbmVkOiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgajoge1xuICAgICAgICBkZXByZWNhdGVkOiAnUGxlYXNlIHVzZSBqb3VybmFsIGluc3RlYWQnLFxuICAgICAgICB0YXJnZXQ6ICd3cml0ZUNvbmNlcm4nLFxuICAgICAgICB0cmFuc2Zvcm0oeyBuYW1lLCBvcHRpb25zLCB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgY29uc3Qgd2MgPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgIGpvdXJuYWw6IGdldEJvb2xlYW4obmFtZSwgdmFsdWUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXdjKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgVW5hYmxlIHRvIG1ha2UgYSB3cml0ZUNvbmNlcm4gZnJvbSBqb3VybmFsPSR7dmFsdWV9YCk7XG4gICAgICAgICAgICByZXR1cm4gd2M7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGpvdXJuYWw6IHtcbiAgICAgICAgdGFyZ2V0OiAnd3JpdGVDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgb3B0aW9ucywgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHdjID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgd3JpdGVDb25jZXJuOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMud3JpdGVDb25jZXJuLFxuICAgICAgICAgICAgICAgICAgICBqb3VybmFsOiBnZXRCb29sZWFuKG5hbWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF3YylcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYFVuYWJsZSB0byBtYWtlIGEgd3JpdGVDb25jZXJuIGZyb20gam91cm5hbD0ke3ZhbHVlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHdjO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBsb2FkQmFsYW5jZWQ6IHtcbiAgICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgbG9jYWxUaHJlc2hvbGRNUzoge1xuICAgICAgICBkZWZhdWx0OiAxNSxcbiAgICAgICAgdHlwZTogJ3VpbnQnXG4gICAgfSxcbiAgICBtYXhDb25uZWN0aW5nOiB7XG4gICAgICAgIGRlZmF1bHQ6IDIsXG4gICAgICAgIHRyYW5zZm9ybSh7IG5hbWUsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBjb25zdCBtYXhDb25uZWN0aW5nID0gZ2V0VUludEZyb21PcHRpb25zKG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIGlmIChtYXhDb25uZWN0aW5nID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignbWF4Q29ubmVjdGluZyBtdXN0IGJlID4gMCBpZiBzcGVjaWZpZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtYXhDb25uZWN0aW5nO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBtYXhJZGxlVGltZU1TOiB7XG4gICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgbWF4UG9vbFNpemU6IHtcbiAgICAgICAgZGVmYXVsdDogMTAwLFxuICAgICAgICB0eXBlOiAndWludCdcbiAgICB9LFxuICAgIG1heFN0YWxlbmVzc1NlY29uZHM6IHtcbiAgICAgICAgdGFyZ2V0OiAncmVhZFByZWZlcmVuY2UnLFxuICAgICAgICB0cmFuc2Zvcm0oeyBuYW1lLCBvcHRpb25zLCB2YWx1ZXM6IFt2YWx1ZV0gfSkge1xuICAgICAgICAgICAgY29uc3QgbWF4U3RhbGVuZXNzU2Vjb25kcyA9IGdldFVJbnRGcm9tT3B0aW9ucyhuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5yZWFkUHJlZmVyZW5jZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiB7IC4uLm9wdGlvbnMucmVhZFByZWZlcmVuY2UsIG1heFN0YWxlbmVzc1NlY29uZHMgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZSgnc2Vjb25kYXJ5JywgdW5kZWZpbmVkLCB7IG1heFN0YWxlbmVzc1NlY29uZHMgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG1pbkludGVybmFsQnVmZmVyU2l6ZToge1xuICAgICAgICB0eXBlOiAndWludCdcbiAgICB9LFxuICAgIG1pblBvb2xTaXplOiB7XG4gICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVM6IHtcbiAgICAgICAgZGVmYXVsdDogNTAwLFxuICAgICAgICB0eXBlOiAndWludCdcbiAgICB9LFxuICAgIG1vbml0b3JDb21tYW5kczoge1xuICAgICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBuYW1lOiB7XG4gICAgICAgIHRhcmdldDogJ2RyaXZlckluZm8nLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0sIG9wdGlvbnMgfSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgLi4ub3B0aW9ucy5kcml2ZXJJbmZvLCBuYW1lOiBTdHJpbmcodmFsdWUpIH07XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG5vRGVsYXk6IHtcbiAgICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBwa0ZhY3Rvcnk6IHtcbiAgICAgICAgZGVmYXVsdDogdXRpbHNfMS5ERUZBVUxUX1BLX0ZBQ1RPUlksXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaXNSZWNvcmQpKHZhbHVlLCBbJ2NyZWF0ZVBrJ10pICYmIHR5cGVvZiB2YWx1ZS5jcmVhdGVQayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgT3B0aW9uIHBrRmFjdG9yeSBtdXN0IGJlIGFuIG9iamVjdCB3aXRoIGEgY3JlYXRlUGsgZnVuY3Rpb24sIGdvdCAke3ZhbHVlfWApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBwcm9tb3RlQnVmZmVyczoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHByb21vdGVMb25nczoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHByb21vdGVWYWx1ZXM6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICB1c2VCaWdJbnQ2NDoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHByb3h5SG9zdDoge1xuICAgICAgICB0eXBlOiAnc3RyaW5nJ1xuICAgIH0sXG4gICAgcHJveHlQYXNzd29yZDoge1xuICAgICAgICB0eXBlOiAnc3RyaW5nJ1xuICAgIH0sXG4gICAgcHJveHlQb3J0OiB7XG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgcHJveHlVc2VybmFtZToge1xuICAgICAgICB0eXBlOiAnc3RyaW5nJ1xuICAgIH0sXG4gICAgcmF3OiB7XG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICB9LFxuICAgIHJlYWRDb25jZXJuOiB7XG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSwgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2VybiB8fCAoMCwgdXRpbHNfMS5pc1JlY29yZCkodmFsdWUsIFsnbGV2ZWwnXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZF9jb25jZXJuXzEuUmVhZENvbmNlcm4uZnJvbU9wdGlvbnMoeyAuLi5vcHRpb25zLnJlYWRDb25jZXJuLCAuLi52YWx1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcihgUmVhZENvbmNlcm4gbXVzdCBiZSBhbiBvYmplY3QsIGdvdCAke0pTT04uc3RyaW5naWZ5KHZhbHVlKX1gKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVhZENvbmNlcm5MZXZlbDoge1xuICAgICAgICB0YXJnZXQ6ICdyZWFkQ29uY2VybicsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW2xldmVsXSwgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVhZF9jb25jZXJuXzEuUmVhZENvbmNlcm4uZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMucmVhZENvbmNlcm4sXG4gICAgICAgICAgICAgICAgbGV2ZWw6IGxldmVsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVhZFByZWZlcmVuY2U6IHtcbiAgICAgICAgZGVmYXVsdDogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHsgLi4ub3B0aW9ucy5yZWFkUHJlZmVyZW5jZSwgLi4udmFsdWUgfSxcbiAgICAgICAgICAgICAgICAgICAgLi4udmFsdWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoMCwgdXRpbHNfMS5pc1JlY29yZCkodmFsdWUsIFsnbW9kZSddKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJwID0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogeyAuLi5vcHRpb25zLnJlYWRQcmVmZXJlbmNlLCAuLi52YWx1ZSB9LFxuICAgICAgICAgICAgICAgICAgICAuLi52YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChycClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJwO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBDYW5ub3QgbWFrZSByZWFkIHByZWZlcmVuY2UgZnJvbSAke0pTT04uc3RyaW5naWZ5KHZhbHVlKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcnBPcHRzID0ge1xuICAgICAgICAgICAgICAgICAgICBoZWRnZTogb3B0aW9ucy5yZWFkUHJlZmVyZW5jZT8uaGVkZ2UsXG4gICAgICAgICAgICAgICAgICAgIG1heFN0YWxlbmVzc1NlY29uZHM6IG9wdGlvbnMucmVhZFByZWZlcmVuY2U/Lm1heFN0YWxlbmVzc1NlY29uZHNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UodmFsdWUsIG9wdGlvbnMucmVhZFByZWZlcmVuY2U/LnRhZ3MsIHJwT3B0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoYFVua25vd24gUmVhZFByZWZlcmVuY2UgdmFsdWU6ICR7dmFsdWV9YCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHJlYWRQcmVmZXJlbmNlVGFnczoge1xuICAgICAgICB0YXJnZXQ6ICdyZWFkUHJlZmVyZW5jZScsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlcywgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICBjb25zdCB0YWdzID0gQXJyYXkuaXNBcnJheSh2YWx1ZXNbMF0pXG4gICAgICAgICAgICAgICAgPyB2YWx1ZXNbMF1cbiAgICAgICAgICAgICAgICA6IHZhbHVlcztcbiAgICAgICAgICAgIGNvbnN0IHJlYWRQcmVmZXJlbmNlVGFncyA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0YWcgb2YgdGFncykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlYWRQcmVmZXJlbmNlVGFnID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRhZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbaywgdl0gb2YgZW50cmllc0Zyb21TdHJpbmcodGFnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2VUYWdba10gPSB2O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgoMCwgdXRpbHNfMS5pc1JlY29yZCkodGFnKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBPYmplY3QuZW50cmllcyh0YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZVRhZ1trXSA9IHY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2VUYWdzLnB1c2gocmVhZFByZWZlcmVuY2VUYWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogb3B0aW9ucy5yZWFkUHJlZmVyZW5jZSxcbiAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZVRhZ3NcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZXBsaWNhU2V0OiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICByZXRyeVJlYWRzOiB7XG4gICAgICAgIGRlZmF1bHQ6IHRydWUsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgcmV0cnlXcml0ZXM6IHtcbiAgICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBzZXJpYWxpemVGdW5jdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgfSxcbiAgICBzZXJ2ZXJNb25pdG9yaW5nTW9kZToge1xuICAgICAgICBkZWZhdWx0OiAnYXV0bycsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICBpZiAoIU9iamVjdC52YWx1ZXMobW9uaXRvcl8xLlNlcnZlck1vbml0b3JpbmdNb2RlKS5pbmNsdWRlcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1BhcnNlRXJyb3IoJ3NlcnZlck1vbml0b3JpbmdNb2RlIG11c3QgYmUgb25lIG9mIGBhdXRvYCwgYHBvbGxgLCBvciBgc3RyZWFtYCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IHtcbiAgICAgICAgZGVmYXVsdDogMzAwMDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgc2VydmVybmFtZToge1xuICAgICAgICB0eXBlOiAnc3RyaW5nJ1xuICAgIH0sXG4gICAgc29ja2V0VGltZW91dE1TOiB7XG4gICAgICAgIC8vIFRPRE8oTk9ERS02NDkxKTogZGVwcmVjYXRlZDogJ1BsZWFzZSB1c2UgdGltZW91dE1TIGluc3RlYWQnLFxuICAgICAgICBkZWZhdWx0OiAwLFxuICAgICAgICB0eXBlOiAndWludCdcbiAgICB9LFxuICAgIHNydk1heEhvc3RzOiB7XG4gICAgICAgIHR5cGU6ICd1aW50JyxcbiAgICAgICAgZGVmYXVsdDogMFxuICAgIH0sXG4gICAgc3J2U2VydmljZU5hbWU6IHtcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGRlZmF1bHQ6ICdtb25nb2RiJ1xuICAgIH0sXG4gICAgc3NsOiB7XG4gICAgICAgIHRhcmdldDogJ3RscycsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgdGltZW91dE1TOiB7XG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgdGxzOiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgIH0sXG4gICAgdGxzQWxsb3dJbnZhbGlkQ2VydGlmaWNhdGVzOiB7XG4gICAgICAgIHRhcmdldDogJ3JlamVjdFVuYXV0aG9yaXplZCcsXG4gICAgICAgIHRyYW5zZm9ybSh7IG5hbWUsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICAvLyBhbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXMgaXMgdGhlIGludmVyc2Ugb2YgcmVqZWN0VW5hdXRob3JpemVkXG4gICAgICAgICAgICByZXR1cm4gIWdldEJvb2xlYW4obmFtZSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB0bHNBbGxvd0ludmFsaWRIb3N0bmFtZXM6IHtcbiAgICAgICAgdGFyZ2V0OiAnY2hlY2tTZXJ2ZXJJZGVudGl0eScsXG4gICAgICAgIHRyYW5zZm9ybSh7IG5hbWUsIHZhbHVlczogW3ZhbHVlXSB9KSB7XG4gICAgICAgICAgICAvLyB0bHNBbGxvd0ludmFsaWRIb3N0bmFtZXMgbWVhbnMgc2V0dGluZyB0aGUgY2hlY2tTZXJ2ZXJJZGVudGl0eSBmdW5jdGlvbiB0byBhIG5vb3BcbiAgICAgICAgICAgIHJldHVybiBnZXRCb29sZWFuKG5hbWUsIHZhbHVlKSA/ICgpID0+IHVuZGVmaW5lZCA6IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdGxzQ0FGaWxlOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICB0bHNDUkxGaWxlOiB7XG4gICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgfSxcbiAgICB0bHNDZXJ0aWZpY2F0ZUtleUZpbGU6IHtcbiAgICAgICAgdHlwZTogJ3N0cmluZydcbiAgICB9LFxuICAgIHRsc0NlcnRpZmljYXRlS2V5RmlsZVBhc3N3b3JkOiB7XG4gICAgICAgIHRhcmdldDogJ3Bhc3NwaHJhc2UnLFxuICAgICAgICB0eXBlOiAnYW55J1xuICAgIH0sXG4gICAgdGxzSW5zZWN1cmU6IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgbmFtZSwgb3B0aW9ucywgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRsc0luc2VjdXJlID0gZ2V0Qm9vbGVhbihuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICBpZiAodGxzSW5zZWN1cmUpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNoZWNrU2VydmVySWRlbnRpdHkgPSAoKSA9PiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5yZWplY3RVbmF1dGhvcml6ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY2hlY2tTZXJ2ZXJJZGVudGl0eSA9IG9wdGlvbnMudGxzQWxsb3dJbnZhbGlkSG9zdG5hbWVzXG4gICAgICAgICAgICAgICAgICAgID8gKCkgPT4gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucmVqZWN0VW5hdXRob3JpemVkID0gb3B0aW9ucy50bHNBbGxvd0ludmFsaWRDZXJ0aWZpY2F0ZXMgPyBmYWxzZSA6IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGxzSW5zZWN1cmU7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHc6IHtcbiAgICAgICAgdGFyZ2V0OiAnd3JpdGVDb25jZXJuJyxcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdLCBvcHRpb25zIH0pIHtcbiAgICAgICAgICAgIHJldHVybiB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHsgd3JpdGVDb25jZXJuOiB7IC4uLm9wdGlvbnMud3JpdGVDb25jZXJuLCB3OiB2YWx1ZSB9IH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB3YWl0UXVldWVUaW1lb3V0TVM6IHtcbiAgICAgICAgLy8gVE9ETyhOT0RFLTY0OTEpOiBkZXByZWNhdGVkOiAnUGxlYXNlIHVzZSB0aW1lb3V0TVMgaW5zdGVhZCcsXG4gICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICAgIHR5cGU6ICd1aW50J1xuICAgIH0sXG4gICAgd3JpdGVDb25jZXJuOiB7XG4gICAgICAgIHRhcmdldDogJ3dyaXRlQ29uY2VybicsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSwgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaXNSZWNvcmQpKHZhbHVlKSB8fCB2YWx1ZSBpbnN0YW5jZW9mIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQ29uY2Vybjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi52YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA9PT0gJ21ham9yaXR5JyB8fCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMud3JpdGVDb25jZXJuLFxuICAgICAgICAgICAgICAgICAgICAgICAgdzogdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBJbnZhbGlkIFdyaXRlQ29uY2VybiBjYW5ub3QgcGFyc2U6ICR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfWApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB3dGltZW91dDoge1xuICAgICAgICBkZXByZWNhdGVkOiAnUGxlYXNlIHVzZSB3dGltZW91dE1TIGluc3RlYWQnLFxuICAgICAgICB0YXJnZXQ6ICd3cml0ZUNvbmNlcm4nLFxuICAgICAgICB0cmFuc2Zvcm0oeyB2YWx1ZXM6IFt2YWx1ZV0sIG9wdGlvbnMgfSkge1xuICAgICAgICAgICAgY29uc3Qgd2MgPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKHtcbiAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICAgICAgICAgIHd0aW1lb3V0OiBnZXRVSW50RnJvbU9wdGlvbnMoJ3d0aW1lb3V0JywgdmFsdWUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAod2MpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHdjO1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBDYW5ub3QgbWFrZSBXcml0ZUNvbmNlcm4gZnJvbSB3dGltZW91dGApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB3dGltZW91dE1TOiB7XG4gICAgICAgIHRhcmdldDogJ3dyaXRlQ29uY2VybicsXG4gICAgICAgIHRyYW5zZm9ybSh7IHZhbHVlczogW3ZhbHVlXSwgb3B0aW9ucyB9KSB7XG4gICAgICAgICAgICBjb25zdCB3YyA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIHdyaXRlQ29uY2Vybjoge1xuICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLndyaXRlQ29uY2VybixcbiAgICAgICAgICAgICAgICAgICAgd3RpbWVvdXRNUzogZ2V0VUludEZyb21PcHRpb25zKCd3dGltZW91dE1TJywgdmFsdWUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAod2MpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHdjO1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29QYXJzZUVycm9yKGBDYW5ub3QgbWFrZSBXcml0ZUNvbmNlcm4gZnJvbSB3dGltZW91dGApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB6bGliQ29tcHJlc3Npb25MZXZlbDoge1xuICAgICAgICBkZWZhdWx0OiAwLFxuICAgICAgICB0eXBlOiAnaW50J1xuICAgIH0sXG4gICAgbW9uZ29kYkxvZ1BhdGg6IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGlmICghKCh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIFsnc3RkZXJyJywgJ3N0ZG91dCddLmluY2x1ZGVzKHZhbHVlKSkgfHxcbiAgICAgICAgICAgICAgICAodmFsdWUgJiZcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgICAgICAgICAnd3JpdGUnIGluIHZhbHVlICYmXG4gICAgICAgICAgICAgICAgICAgIHR5cGVvZiB2YWx1ZS53cml0ZSA9PT0gJ2Z1bmN0aW9uJykpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcihgT3B0aW9uICdtb25nb2RiTG9nUGF0aCcgbXVzdCBiZSBvZiB0eXBlICdzdGRlcnInIHwgJ3N0ZG91dCcgfCBNb25nb0RCTG9nV3JpdGFibGVgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgbW9uZ29kYkxvZ0NvbXBvbmVudFNldmVyaXRpZXM6IHtcbiAgICAgICAgdHJhbnNmb3JtKHsgdmFsdWVzOiBbdmFsdWVdIH0pIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnIHx8ICF2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYE9wdGlvbiAnbW9uZ29kYkxvZ0NvbXBvbmVudFNldmVyaXRpZXMnIG11c3QgYmUgYSBub24tbnVsbCBvYmplY3RgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdiAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIGsgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoYFVzZXIgaW5wdXQgZm9yIG9wdGlvbiAnbW9uZ29kYkxvZ0NvbXBvbmVudFNldmVyaXRpZXMnIG9iamVjdCBjYW5ub3QgaW5jbHVkZSBhIG5vbi1zdHJpbmcga2V5IG9yIHZhbHVlYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LnZhbHVlcyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50KS5zb21lKHZhbCA9PiB2YWwgPT09IGspICYmIGsgIT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBVc2VyIGlucHV0IGZvciBvcHRpb24gJ21vbmdvZGJMb2dDb21wb25lbnRTZXZlcml0aWVzJyBjb250YWlucyBpbnZhbGlkIGtleTogJHtrfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC52YWx1ZXMobW9uZ29fbG9nZ2VyXzEuU2V2ZXJpdHlMZXZlbCkuc29tZSh2YWwgPT4gdmFsID09PSB2KSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBPcHRpb24gJ21vbmdvZGJMb2dDb21wb25lbnRTZXZlcml0aWVzJyBkb2VzIG5vdCBzdXBwb3J0ICR7dn0gYXMgYSB2YWx1ZSBmb3IgJHtrfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgbW9uZ29kYkxvZ01heERvY3VtZW50TGVuZ3RoOiB7IHR5cGU6ICd1aW50JyB9LFxuICAgIC8vIEN1c3RvbSB0eXBlcyBmb3IgbW9kaWZ5aW5nIGNvcmUgYmVoYXZpb3JcbiAgICBjb25uZWN0aW9uVHlwZTogeyB0eXBlOiAnYW55JyB9LFxuICAgIHNydlBvbGxlcjogeyB0eXBlOiAnYW55JyB9LFxuICAgIC8vIEFjY2VwdGVkIE5vZGUuanMgT3B0aW9uc1xuICAgIGFsbG93UGFydGlhbFRydXN0Q2hhaW46IHsgdHlwZTogJ2FueScgfSxcbiAgICBtaW5ESFNpemU6IHsgdHlwZTogJ2FueScgfSxcbiAgICBwc2tDYWxsYmFjazogeyB0eXBlOiAnYW55JyB9LFxuICAgIHNlY3VyZUNvbnRleHQ6IHsgdHlwZTogJ2FueScgfSxcbiAgICBlbmFibGVUcmFjZTogeyB0eXBlOiAnYW55JyB9LFxuICAgIHJlcXVlc3RDZXJ0OiB7IHR5cGU6ICdhbnknIH0sXG4gICAgcmVqZWN0VW5hdXRob3JpemVkOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgY2hlY2tTZXJ2ZXJJZGVudGl0eTogeyB0eXBlOiAnYW55JyB9LFxuICAgIEFMUE5Qcm90b2NvbHM6IHsgdHlwZTogJ2FueScgfSxcbiAgICBTTklDYWxsYmFjazogeyB0eXBlOiAnYW55JyB9LFxuICAgIHNlc3Npb246IHsgdHlwZTogJ2FueScgfSxcbiAgICByZXF1ZXN0T0NTUDogeyB0eXBlOiAnYW55JyB9LFxuICAgIGxvY2FsQWRkcmVzczogeyB0eXBlOiAnYW55JyB9LFxuICAgIGxvY2FsUG9ydDogeyB0eXBlOiAnYW55JyB9LFxuICAgIGhpbnRzOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgbG9va3VwOiB7IHR5cGU6ICdhbnknIH0sXG4gICAgY2E6IHsgdHlwZTogJ2FueScgfSxcbiAgICBjZXJ0OiB7IHR5cGU6ICdhbnknIH0sXG4gICAgY2lwaGVyczogeyB0eXBlOiAnYW55JyB9LFxuICAgIGNybDogeyB0eXBlOiAnYW55JyB9LFxuICAgIGVjZGhDdXJ2ZTogeyB0eXBlOiAnYW55JyB9LFxuICAgIGtleTogeyB0eXBlOiAnYW55JyB9LFxuICAgIHBhc3NwaHJhc2U6IHsgdHlwZTogJ2FueScgfSxcbiAgICBwZng6IHsgdHlwZTogJ2FueScgfSxcbiAgICBzZWN1cmVQcm90b2NvbDogeyB0eXBlOiAnYW55JyB9LFxuICAgIGluZGV4OiB7IHR5cGU6ICdhbnknIH0sXG4gICAgLy8gTGVnYWN5IG9wdGlvbnMgZnJvbSB2MyBlcmFcbiAgICB1c2VOZXdVcmxQYXJzZXI6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBkZXByZWNhdGVkOiAndXNlTmV3VXJsUGFyc2VyIGhhcyBubyBlZmZlY3Qgc2luY2UgTm9kZS5qcyBEcml2ZXIgdmVyc2lvbiA0LjAuMCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24nXG4gICAgfSxcbiAgICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBkZXByZWNhdGVkOiAndXNlVW5pZmllZFRvcG9sb2d5IGhhcyBubyBlZmZlY3Qgc2luY2UgTm9kZS5qcyBEcml2ZXIgdmVyc2lvbiA0LjAuMCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24nXG4gICAgfSxcbiAgICBfX3NraXBQaW5nT25Db25uZWN0OiB7IHR5cGU6ICdib29sZWFuJyB9XG59O1xuZXhwb3J0cy5ERUZBVUxUX09QVElPTlMgPSBuZXcgQ2FzZUluc2Vuc2l0aXZlTWFwKE9iamVjdC5lbnRyaWVzKGV4cG9ydHMuT1BUSU9OUylcbiAgICAuZmlsdGVyKChbLCBkZXNjcmlwdG9yXSkgPT4gZGVzY3JpcHRvci5kZWZhdWx0ICE9IG51bGwpXG4gICAgLm1hcCgoW2ssIGRdKSA9PiBbaywgZC5kZWZhdWx0XSkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29ubmVjdGlvbl9zdHJpbmcuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/connection_string.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.END = exports.CHANGE = exports.INIT = exports.MORE = exports.RESPONSE = exports.SERVER_HEARTBEAT_FAILED = exports.SERVER_HEARTBEAT_SUCCEEDED = exports.SERVER_HEARTBEAT_STARTED = exports.COMMAND_FAILED = exports.COMMAND_SUCCEEDED = exports.COMMAND_STARTED = exports.CLUSTER_TIME_RECEIVED = exports.CONNECTION_CHECKED_IN = exports.CONNECTION_CHECKED_OUT = exports.CONNECTION_CHECK_OUT_FAILED = exports.CONNECTION_CHECK_OUT_STARTED = exports.CONNECTION_CLOSED = exports.CONNECTION_READY = exports.CONNECTION_CREATED = exports.CONNECTION_POOL_READY = exports.CONNECTION_POOL_CLEARED = exports.CONNECTION_POOL_CLOSED = exports.CONNECTION_POOL_CREATED = exports.WAITING_FOR_SUITABLE_SERVER = exports.SERVER_SELECTION_SUCCEEDED = exports.SERVER_SELECTION_FAILED = exports.SERVER_SELECTION_STARTED = exports.TOPOLOGY_DESCRIPTION_CHANGED = exports.TOPOLOGY_CLOSED = exports.TOPOLOGY_OPENING = exports.SERVER_DESCRIPTION_CHANGED = exports.SERVER_CLOSED = exports.SERVER_OPENING = exports.DESCRIPTION_RECEIVED = exports.UNPINNED = exports.PINNED = exports.MESSAGE = exports.ENDED = exports.CLOSED = exports.CONNECT = exports.OPEN = exports.CLOSE = exports.TIMEOUT = exports.ERROR = exports.SYSTEM_JS_COLLECTION = exports.SYSTEM_COMMAND_COLLECTION = exports.SYSTEM_USER_COLLECTION = exports.SYSTEM_PROFILE_COLLECTION = exports.SYSTEM_INDEX_COLLECTION = exports.SYSTEM_NAMESPACE_COLLECTION = void 0;\nexports.kDecoratedKeys = exports.kDecorateResult = exports.LEGACY_HELLO_COMMAND_CAMEL_CASE = exports.LEGACY_HELLO_COMMAND = exports.MONGO_CLIENT_EVENTS = exports.LOCAL_SERVER_EVENTS = exports.SERVER_RELAY_EVENTS = exports.APM_EVENTS = exports.TOPOLOGY_EVENTS = exports.CMAP_EVENTS = exports.HEARTBEAT_EVENTS = exports.RESUME_TOKEN_CHANGED = void 0;\n/* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\nexports.SYSTEM_NAMESPACE_COLLECTION = 'system.namespaces';\nexports.SYSTEM_INDEX_COLLECTION = 'system.indexes';\nexports.SYSTEM_PROFILE_COLLECTION = 'system.profile';\nexports.SYSTEM_USER_COLLECTION = 'system.users';\nexports.SYSTEM_COMMAND_COLLECTION = '$cmd';\nexports.SYSTEM_JS_COLLECTION = 'system.js';\n// events\nexports.ERROR = 'error';\nexports.TIMEOUT = 'timeout';\nexports.CLOSE = 'close';\nexports.OPEN = 'open';\nexports.CONNECT = 'connect';\nexports.CLOSED = 'closed';\nexports.ENDED = 'ended';\nexports.MESSAGE = 'message';\nexports.PINNED = 'pinned';\nexports.UNPINNED = 'unpinned';\nexports.DESCRIPTION_RECEIVED = 'descriptionReceived';\n/** @internal */\nexports.SERVER_OPENING = 'serverOpening';\n/** @internal */\nexports.SERVER_CLOSED = 'serverClosed';\n/** @internal */\nexports.SERVER_DESCRIPTION_CHANGED = 'serverDescriptionChanged';\n/** @internal */\nexports.TOPOLOGY_OPENING = 'topologyOpening';\n/** @internal */\nexports.TOPOLOGY_CLOSED = 'topologyClosed';\n/** @internal */\nexports.TOPOLOGY_DESCRIPTION_CHANGED = 'topologyDescriptionChanged';\n/** @internal */\nexports.SERVER_SELECTION_STARTED = 'serverSelectionStarted';\n/** @internal */\nexports.SERVER_SELECTION_FAILED = 'serverSelectionFailed';\n/** @internal */\nexports.SERVER_SELECTION_SUCCEEDED = 'serverSelectionSucceeded';\n/** @internal */\nexports.WAITING_FOR_SUITABLE_SERVER = 'waitingForSuitableServer';\n/** @internal */\nexports.CONNECTION_POOL_CREATED = 'connectionPoolCreated';\n/** @internal */\nexports.CONNECTION_POOL_CLOSED = 'connectionPoolClosed';\n/** @internal */\nexports.CONNECTION_POOL_CLEARED = 'connectionPoolCleared';\n/** @internal */\nexports.CONNECTION_POOL_READY = 'connectionPoolReady';\n/** @internal */\nexports.CONNECTION_CREATED = 'connectionCreated';\n/** @internal */\nexports.CONNECTION_READY = 'connectionReady';\n/** @internal */\nexports.CONNECTION_CLOSED = 'connectionClosed';\n/** @internal */\nexports.CONNECTION_CHECK_OUT_STARTED = 'connectionCheckOutStarted';\n/** @internal */\nexports.CONNECTION_CHECK_OUT_FAILED = 'connectionCheckOutFailed';\n/** @internal */\nexports.CONNECTION_CHECKED_OUT = 'connectionCheckedOut';\n/** @internal */\nexports.CONNECTION_CHECKED_IN = 'connectionCheckedIn';\nexports.CLUSTER_TIME_RECEIVED = 'clusterTimeReceived';\n/** @internal */\nexports.COMMAND_STARTED = 'commandStarted';\n/** @internal */\nexports.COMMAND_SUCCEEDED = 'commandSucceeded';\n/** @internal */\nexports.COMMAND_FAILED = 'commandFailed';\n/** @internal */\nexports.SERVER_HEARTBEAT_STARTED = 'serverHeartbeatStarted';\n/** @internal */\nexports.SERVER_HEARTBEAT_SUCCEEDED = 'serverHeartbeatSucceeded';\n/** @internal */\nexports.SERVER_HEARTBEAT_FAILED = 'serverHeartbeatFailed';\nexports.RESPONSE = 'response';\nexports.MORE = 'more';\nexports.INIT = 'init';\nexports.CHANGE = 'change';\nexports.END = 'end';\nexports.RESUME_TOKEN_CHANGED = 'resumeTokenChanged';\n/** @public */\nexports.HEARTBEAT_EVENTS = Object.freeze([\n    exports.SERVER_HEARTBEAT_STARTED,\n    exports.SERVER_HEARTBEAT_SUCCEEDED,\n    exports.SERVER_HEARTBEAT_FAILED\n]);\n/** @public */\nexports.CMAP_EVENTS = Object.freeze([\n    exports.CONNECTION_POOL_CREATED,\n    exports.CONNECTION_POOL_READY,\n    exports.CONNECTION_POOL_CLEARED,\n    exports.CONNECTION_POOL_CLOSED,\n    exports.CONNECTION_CREATED,\n    exports.CONNECTION_READY,\n    exports.CONNECTION_CLOSED,\n    exports.CONNECTION_CHECK_OUT_STARTED,\n    exports.CONNECTION_CHECK_OUT_FAILED,\n    exports.CONNECTION_CHECKED_OUT,\n    exports.CONNECTION_CHECKED_IN\n]);\n/** @public */\nexports.TOPOLOGY_EVENTS = Object.freeze([\n    exports.SERVER_OPENING,\n    exports.SERVER_CLOSED,\n    exports.SERVER_DESCRIPTION_CHANGED,\n    exports.TOPOLOGY_OPENING,\n    exports.TOPOLOGY_CLOSED,\n    exports.TOPOLOGY_DESCRIPTION_CHANGED,\n    exports.ERROR,\n    exports.TIMEOUT,\n    exports.CLOSE\n]);\n/** @public */\nexports.APM_EVENTS = Object.freeze([\n    exports.COMMAND_STARTED,\n    exports.COMMAND_SUCCEEDED,\n    exports.COMMAND_FAILED\n]);\n/**\n * All events that we relay to the `Topology`\n * @internal\n */\nexports.SERVER_RELAY_EVENTS = Object.freeze([\n    exports.SERVER_HEARTBEAT_STARTED,\n    exports.SERVER_HEARTBEAT_SUCCEEDED,\n    exports.SERVER_HEARTBEAT_FAILED,\n    exports.COMMAND_STARTED,\n    exports.COMMAND_SUCCEEDED,\n    exports.COMMAND_FAILED,\n    ...exports.CMAP_EVENTS\n]);\n/**\n * All events we listen to from `Server` instances, but do not forward to the client\n * @internal\n */\nexports.LOCAL_SERVER_EVENTS = Object.freeze([\n    exports.CONNECT,\n    exports.DESCRIPTION_RECEIVED,\n    exports.CLOSED,\n    exports.ENDED\n]);\n/** @public */\nexports.MONGO_CLIENT_EVENTS = Object.freeze([\n    ...exports.CMAP_EVENTS,\n    ...exports.APM_EVENTS,\n    ...exports.TOPOLOGY_EVENTS,\n    ...exports.HEARTBEAT_EVENTS\n]);\n/**\n * @internal\n * The legacy hello command that was deprecated in MongoDB 5.0.\n */\nexports.LEGACY_HELLO_COMMAND = 'ismaster';\n/**\n * @internal\n * The legacy hello command that was deprecated in MongoDB 5.0.\n */\nexports.LEGACY_HELLO_COMMAND_CAMEL_CASE = 'isMaster';\n// Typescript errors if we index objects with `Symbol.for(...)`, so\n// to avoid TS errors we pull them out into variables.  Then we can type\n// the objects (and class) that we expect to see them on and prevent TS\n// errors.\n/** @internal */\nexports.kDecorateResult = Symbol.for('@@mdb.decorateDecryptionResult');\n/** @internal */\nexports.kDecoratedKeys = Symbol.for('@@mdb.decryptedKeys');\n//# sourceMappingURL=constants.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2NvbnN0YW50cy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxXQUFXLEdBQUcsY0FBYyxHQUFHLFlBQVksR0FBRyxZQUFZLEdBQUcsZ0JBQWdCLEdBQUcsK0JBQStCLEdBQUcsa0NBQWtDLEdBQUcsZ0NBQWdDLEdBQUcsc0JBQXNCLEdBQUcseUJBQXlCLEdBQUcsdUJBQXVCLEdBQUcsNkJBQTZCLEdBQUcsNkJBQTZCLEdBQUcsOEJBQThCLEdBQUcsbUNBQW1DLEdBQUcsb0NBQW9DLEdBQUcseUJBQXlCLEdBQUcsd0JBQXdCLEdBQUcsMEJBQTBCLEdBQUcsNkJBQTZCLEdBQUcsK0JBQStCLEdBQUcsOEJBQThCLEdBQUcsK0JBQStCLEdBQUcsbUNBQW1DLEdBQUcsa0NBQWtDLEdBQUcsK0JBQStCLEdBQUcsZ0NBQWdDLEdBQUcsb0NBQW9DLEdBQUcsdUJBQXVCLEdBQUcsd0JBQXdCLEdBQUcsa0NBQWtDLEdBQUcscUJBQXFCLEdBQUcsc0JBQXNCLEdBQUcsNEJBQTRCLEdBQUcsZ0JBQWdCLEdBQUcsY0FBYyxHQUFHLGVBQWUsR0FBRyxhQUFhLEdBQUcsY0FBYyxHQUFHLGVBQWUsR0FBRyxZQUFZLEdBQUcsYUFBYSxHQUFHLGVBQWUsR0FBRyxhQUFhLEdBQUcsNEJBQTRCLEdBQUcsaUNBQWlDLEdBQUcsOEJBQThCLEdBQUcsaUNBQWlDLEdBQUcsK0JBQStCLEdBQUcsbUNBQW1DO0FBQ3gyQyxzQkFBc0IsR0FBRyx1QkFBdUIsR0FBRyx1Q0FBdUMsR0FBRyw0QkFBNEIsR0FBRywyQkFBMkIsR0FBRywyQkFBMkIsR0FBRywyQkFBMkIsR0FBRyxrQkFBa0IsR0FBRyx1QkFBdUIsR0FBRyxtQkFBbUIsR0FBRyx3QkFBd0IsR0FBRyw0QkFBNEI7QUFDbFY7QUFDQSxtQ0FBbUM7QUFDbkMsK0JBQStCO0FBQy9CLGlDQUFpQztBQUNqQyw4QkFBOEI7QUFDOUIsaUNBQWlDO0FBQ2pDLDRCQUE0QjtBQUM1QjtBQUNBLGFBQWE7QUFDYixlQUFlO0FBQ2YsYUFBYTtBQUNiLFlBQVk7QUFDWixlQUFlO0FBQ2YsY0FBYztBQUNkLGFBQWE7QUFDYixlQUFlO0FBQ2YsY0FBYztBQUNkLGdCQUFnQjtBQUNoQiw0QkFBNEI7QUFDNUI7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQSw2QkFBNkI7QUFDN0IsNkJBQTZCO0FBQzdCO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0EsK0JBQStCO0FBQy9CLGdCQUFnQjtBQUNoQixZQUFZO0FBQ1osWUFBWTtBQUNaLGNBQWM7QUFDZCxXQUFXO0FBQ1gsNEJBQTRCO0FBQzVCO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQSxzQkFBc0I7QUFDdEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jb25zdGFudHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkVORCA9IGV4cG9ydHMuQ0hBTkdFID0gZXhwb3J0cy5JTklUID0gZXhwb3J0cy5NT1JFID0gZXhwb3J0cy5SRVNQT05TRSA9IGV4cG9ydHMuU0VSVkVSX0hFQVJUQkVBVF9GQUlMRUQgPSBleHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVEID0gZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQgPSBleHBvcnRzLkNPTU1BTkRfRkFJTEVEID0gZXhwb3J0cy5DT01NQU5EX1NVQ0NFRURFRCA9IGV4cG9ydHMuQ09NTUFORF9TVEFSVEVEID0gZXhwb3J0cy5DTFVTVEVSX1RJTUVfUkVDRUlWRUQgPSBleHBvcnRzLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTiA9IGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS0VEX09VVCA9IGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEID0gZXhwb3J0cy5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVEID0gZXhwb3J0cy5DT05ORUNUSU9OX0NMT1NFRCA9IGV4cG9ydHMuQ09OTkVDVElPTl9SRUFEWSA9IGV4cG9ydHMuQ09OTkVDVElPTl9DUkVBVEVEID0gZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfUkVBRFkgPSBleHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEID0gZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfQ0xPU0VEID0gZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRCA9IGV4cG9ydHMuV0FJVElOR19GT1JfU1VJVEFCTEVfU0VSVkVSID0gZXhwb3J0cy5TRVJWRVJfU0VMRUNUSU9OX1NVQ0NFRURFRCA9IGV4cG9ydHMuU0VSVkVSX1NFTEVDVElPTl9GQUlMRUQgPSBleHBvcnRzLlNFUlZFUl9TRUxFQ1RJT05fU1RBUlRFRCA9IGV4cG9ydHMuVE9QT0xPR1lfREVTQ1JJUFRJT05fQ0hBTkdFRCA9IGV4cG9ydHMuVE9QT0xPR1lfQ0xPU0VEID0gZXhwb3J0cy5UT1BPTE9HWV9PUEVOSU5HID0gZXhwb3J0cy5TRVJWRVJfREVTQ1JJUFRJT05fQ0hBTkdFRCA9IGV4cG9ydHMuU0VSVkVSX0NMT1NFRCA9IGV4cG9ydHMuU0VSVkVSX09QRU5JTkcgPSBleHBvcnRzLkRFU0NSSVBUSU9OX1JFQ0VJVkVEID0gZXhwb3J0cy5VTlBJTk5FRCA9IGV4cG9ydHMuUElOTkVEID0gZXhwb3J0cy5NRVNTQUdFID0gZXhwb3J0cy5FTkRFRCA9IGV4cG9ydHMuQ0xPU0VEID0gZXhwb3J0cy5DT05ORUNUID0gZXhwb3J0cy5PUEVOID0gZXhwb3J0cy5DTE9TRSA9IGV4cG9ydHMuVElNRU9VVCA9IGV4cG9ydHMuRVJST1IgPSBleHBvcnRzLlNZU1RFTV9KU19DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fQ09NTUFORF9DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fVVNFUl9DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fUFJPRklMRV9DT0xMRUNUSU9OID0gZXhwb3J0cy5TWVNURU1fSU5ERVhfQ09MTEVDVElPTiA9IGV4cG9ydHMuU1lTVEVNX05BTUVTUEFDRV9DT0xMRUNUSU9OID0gdm9pZCAwO1xuZXhwb3J0cy5rRGVjb3JhdGVkS2V5cyA9IGV4cG9ydHMua0RlY29yYXRlUmVzdWx0ID0gZXhwb3J0cy5MRUdBQ1lfSEVMTE9fQ09NTUFORF9DQU1FTF9DQVNFID0gZXhwb3J0cy5MRUdBQ1lfSEVMTE9fQ09NTUFORCA9IGV4cG9ydHMuTU9OR09fQ0xJRU5UX0VWRU5UUyA9IGV4cG9ydHMuTE9DQUxfU0VSVkVSX0VWRU5UUyA9IGV4cG9ydHMuU0VSVkVSX1JFTEFZX0VWRU5UUyA9IGV4cG9ydHMuQVBNX0VWRU5UUyA9IGV4cG9ydHMuVE9QT0xPR1lfRVZFTlRTID0gZXhwb3J0cy5DTUFQX0VWRU5UUyA9IGV4cG9ydHMuSEVBUlRCRUFUX0VWRU5UUyA9IGV4cG9ydHMuUkVTVU1FX1RPS0VOX0NIQU5HRUQgPSB2b2lkIDA7XG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5uZWNlc3NhcnktdHlwZS1hc3NlcnRpb24gKi9cbmV4cG9ydHMuU1lTVEVNX05BTUVTUEFDRV9DT0xMRUNUSU9OID0gJ3N5c3RlbS5uYW1lc3BhY2VzJztcbmV4cG9ydHMuU1lTVEVNX0lOREVYX0NPTExFQ1RJT04gPSAnc3lzdGVtLmluZGV4ZXMnO1xuZXhwb3J0cy5TWVNURU1fUFJPRklMRV9DT0xMRUNUSU9OID0gJ3N5c3RlbS5wcm9maWxlJztcbmV4cG9ydHMuU1lTVEVNX1VTRVJfQ09MTEVDVElPTiA9ICdzeXN0ZW0udXNlcnMnO1xuZXhwb3J0cy5TWVNURU1fQ09NTUFORF9DT0xMRUNUSU9OID0gJyRjbWQnO1xuZXhwb3J0cy5TWVNURU1fSlNfQ09MTEVDVElPTiA9ICdzeXN0ZW0uanMnO1xuLy8gZXZlbnRzXG5leHBvcnRzLkVSUk9SID0gJ2Vycm9yJztcbmV4cG9ydHMuVElNRU9VVCA9ICd0aW1lb3V0JztcbmV4cG9ydHMuQ0xPU0UgPSAnY2xvc2UnO1xuZXhwb3J0cy5PUEVOID0gJ29wZW4nO1xuZXhwb3J0cy5DT05ORUNUID0gJ2Nvbm5lY3QnO1xuZXhwb3J0cy5DTE9TRUQgPSAnY2xvc2VkJztcbmV4cG9ydHMuRU5ERUQgPSAnZW5kZWQnO1xuZXhwb3J0cy5NRVNTQUdFID0gJ21lc3NhZ2UnO1xuZXhwb3J0cy5QSU5ORUQgPSAncGlubmVkJztcbmV4cG9ydHMuVU5QSU5ORUQgPSAndW5waW5uZWQnO1xuZXhwb3J0cy5ERVNDUklQVElPTl9SRUNFSVZFRCA9ICdkZXNjcmlwdGlvblJlY2VpdmVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuU0VSVkVSX09QRU5JTkcgPSAnc2VydmVyT3BlbmluZyc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLlNFUlZFUl9DTE9TRUQgPSAnc2VydmVyQ2xvc2VkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuU0VSVkVSX0RFU0NSSVBUSU9OX0NIQU5HRUQgPSAnc2VydmVyRGVzY3JpcHRpb25DaGFuZ2VkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuVE9QT0xPR1lfT1BFTklORyA9ICd0b3BvbG9neU9wZW5pbmcnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5UT1BPTE9HWV9DTE9TRUQgPSAndG9wb2xvZ3lDbG9zZWQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5UT1BPTE9HWV9ERVNDUklQVElPTl9DSEFOR0VEID0gJ3RvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuU0VSVkVSX1NFTEVDVElPTl9TVEFSVEVEID0gJ3NlcnZlclNlbGVjdGlvblN0YXJ0ZWQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5TRVJWRVJfU0VMRUNUSU9OX0ZBSUxFRCA9ICdzZXJ2ZXJTZWxlY3Rpb25GYWlsZWQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5TRVJWRVJfU0VMRUNUSU9OX1NVQ0NFRURFRCA9ICdzZXJ2ZXJTZWxlY3Rpb25TdWNjZWVkZWQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5XQUlUSU5HX0ZPUl9TVUlUQUJMRV9TRVJWRVIgPSAnd2FpdGluZ0ZvclN1aXRhYmxlU2VydmVyJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9QT09MX0NSRUFURUQgPSAnY29ubmVjdGlvblBvb2xDcmVhdGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9QT09MX0NMT1NFRCA9ICdjb25uZWN0aW9uUG9vbENsb3NlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9DTEVBUkVEID0gJ2Nvbm5lY3Rpb25Qb29sQ2xlYXJlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9SRUFEWSA9ICdjb25uZWN0aW9uUG9vbFJlYWR5Jztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9DUkVBVEVEID0gJ2Nvbm5lY3Rpb25DcmVhdGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9SRUFEWSA9ICdjb25uZWN0aW9uUmVhZHknO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5DT05ORUNUSU9OX0NMT1NFRCA9ICdjb25uZWN0aW9uQ2xvc2VkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfU1RBUlRFRCA9ICdjb25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVEID0gJ2Nvbm5lY3Rpb25DaGVja091dEZhaWxlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTk5FQ1RJT05fQ0hFQ0tFRF9PVVQgPSAnY29ubmVjdGlvbkNoZWNrZWRPdXQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5DT05ORUNUSU9OX0NIRUNLRURfSU4gPSAnY29ubmVjdGlvbkNoZWNrZWRJbic7XG5leHBvcnRzLkNMVVNURVJfVElNRV9SRUNFSVZFRCA9ICdjbHVzdGVyVGltZVJlY2VpdmVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09NTUFORF9TVEFSVEVEID0gJ2NvbW1hbmRTdGFydGVkJztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09NTUFORF9TVUNDRUVERUQgPSAnY29tbWFuZFN1Y2NlZWRlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPTU1BTkRfRkFJTEVEID0gJ2NvbW1hbmRGYWlsZWQnO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQgPSAnc2VydmVySGVhcnRiZWF0U3RhcnRlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVEID0gJ3NlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZCc7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVEID0gJ3NlcnZlckhlYXJ0YmVhdEZhaWxlZCc7XG5leHBvcnRzLlJFU1BPTlNFID0gJ3Jlc3BvbnNlJztcbmV4cG9ydHMuTU9SRSA9ICdtb3JlJztcbmV4cG9ydHMuSU5JVCA9ICdpbml0JztcbmV4cG9ydHMuQ0hBTkdFID0gJ2NoYW5nZSc7XG5leHBvcnRzLkVORCA9ICdlbmQnO1xuZXhwb3J0cy5SRVNVTUVfVE9LRU5fQ0hBTkdFRCA9ICdyZXN1bWVUb2tlbkNoYW5nZWQnO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuSEVBUlRCRUFUX0VWRU5UUyA9IE9iamVjdC5mcmVlemUoW1xuICAgIGV4cG9ydHMuU0VSVkVSX0hFQVJUQkVBVF9TVEFSVEVELFxuICAgIGV4cG9ydHMuU0VSVkVSX0hFQVJUQkVBVF9TVUNDRUVERUQsXG4gICAgZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX0ZBSUxFRFxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5DTUFQX0VWRU5UUyA9IE9iamVjdC5mcmVlemUoW1xuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9QT09MX0NSRUFURUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfUkVBRFksXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRCxcbiAgICBleHBvcnRzLkNPTk5FQ1RJT05fUE9PTF9DTE9TRUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX0NSRUFURUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX1JFQURZLFxuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9DTE9TRUQsXG4gICAgZXhwb3J0cy5DT05ORUNUSU9OX0NIRUNLX09VVF9TVEFSVEVELFxuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS19PVVRfRkFJTEVELFxuICAgIGV4cG9ydHMuQ09OTkVDVElPTl9DSEVDS0VEX09VVCxcbiAgICBleHBvcnRzLkNPTk5FQ1RJT05fQ0hFQ0tFRF9JTlxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5UT1BPTE9HWV9FVkVOVFMgPSBPYmplY3QuZnJlZXplKFtcbiAgICBleHBvcnRzLlNFUlZFUl9PUEVOSU5HLFxuICAgIGV4cG9ydHMuU0VSVkVSX0NMT1NFRCxcbiAgICBleHBvcnRzLlNFUlZFUl9ERVNDUklQVElPTl9DSEFOR0VELFxuICAgIGV4cG9ydHMuVE9QT0xPR1lfT1BFTklORyxcbiAgICBleHBvcnRzLlRPUE9MT0dZX0NMT1NFRCxcbiAgICBleHBvcnRzLlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQsXG4gICAgZXhwb3J0cy5FUlJPUixcbiAgICBleHBvcnRzLlRJTUVPVVQsXG4gICAgZXhwb3J0cy5DTE9TRVxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5BUE1fRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgZXhwb3J0cy5DT01NQU5EX1NUQVJURUQsXG4gICAgZXhwb3J0cy5DT01NQU5EX1NVQ0NFRURFRCxcbiAgICBleHBvcnRzLkNPTU1BTkRfRkFJTEVEXG5dKTtcbi8qKlxuICogQWxsIGV2ZW50cyB0aGF0IHdlIHJlbGF5IHRvIHRoZSBgVG9wb2xvZ3lgXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0cy5TRVJWRVJfUkVMQVlfRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQsXG4gICAgZXhwb3J0cy5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRCxcbiAgICBleHBvcnRzLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVELFxuICAgIGV4cG9ydHMuQ09NTUFORF9TVEFSVEVELFxuICAgIGV4cG9ydHMuQ09NTUFORF9TVUNDRUVERUQsXG4gICAgZXhwb3J0cy5DT01NQU5EX0ZBSUxFRCxcbiAgICAuLi5leHBvcnRzLkNNQVBfRVZFTlRTXG5dKTtcbi8qKlxuICogQWxsIGV2ZW50cyB3ZSBsaXN0ZW4gdG8gZnJvbSBgU2VydmVyYCBpbnN0YW5jZXMsIGJ1dCBkbyBub3QgZm9yd2FyZCB0byB0aGUgY2xpZW50XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0cy5MT0NBTF9TRVJWRVJfRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgZXhwb3J0cy5DT05ORUNULFxuICAgIGV4cG9ydHMuREVTQ1JJUFRJT05fUkVDRUlWRUQsXG4gICAgZXhwb3J0cy5DTE9TRUQsXG4gICAgZXhwb3J0cy5FTkRFRFxuXSk7XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0cy5NT05HT19DTElFTlRfRVZFTlRTID0gT2JqZWN0LmZyZWV6ZShbXG4gICAgLi4uZXhwb3J0cy5DTUFQX0VWRU5UUyxcbiAgICAuLi5leHBvcnRzLkFQTV9FVkVOVFMsXG4gICAgLi4uZXhwb3J0cy5UT1BPTE9HWV9FVkVOVFMsXG4gICAgLi4uZXhwb3J0cy5IRUFSVEJFQVRfRVZFTlRTXG5dKTtcbi8qKlxuICogQGludGVybmFsXG4gKiBUaGUgbGVnYWN5IGhlbGxvIGNvbW1hbmQgdGhhdCB3YXMgZGVwcmVjYXRlZCBpbiBNb25nb0RCIDUuMC5cbiAqL1xuZXhwb3J0cy5MRUdBQ1lfSEVMTE9fQ09NTUFORCA9ICdpc21hc3Rlcic7XG4vKipcbiAqIEBpbnRlcm5hbFxuICogVGhlIGxlZ2FjeSBoZWxsbyBjb21tYW5kIHRoYXQgd2FzIGRlcHJlY2F0ZWQgaW4gTW9uZ29EQiA1LjAuXG4gKi9cbmV4cG9ydHMuTEVHQUNZX0hFTExPX0NPTU1BTkRfQ0FNRUxfQ0FTRSA9ICdpc01hc3Rlcic7XG4vLyBUeXBlc2NyaXB0IGVycm9ycyBpZiB3ZSBpbmRleCBvYmplY3RzIHdpdGggYFN5bWJvbC5mb3IoLi4uKWAsIHNvXG4vLyB0byBhdm9pZCBUUyBlcnJvcnMgd2UgcHVsbCB0aGVtIG91dCBpbnRvIHZhcmlhYmxlcy4gIFRoZW4gd2UgY2FuIHR5cGVcbi8vIHRoZSBvYmplY3RzIChhbmQgY2xhc3MpIHRoYXQgd2UgZXhwZWN0IHRvIHNlZSB0aGVtIG9uIGFuZCBwcmV2ZW50IFRTXG4vLyBlcnJvcnMuXG4vKiogQGludGVybmFsICovXG5leHBvcnRzLmtEZWNvcmF0ZVJlc3VsdCA9IFN5bWJvbC5mb3IoJ0BAbWRiLmRlY29yYXRlRGVjcnlwdGlvblJlc3VsdCcpO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5rRGVjb3JhdGVkS2V5cyA9IFN5bWJvbC5mb3IoJ0BAbWRiLmRlY3J5cHRlZEtleXMnKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbnN0YW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CursorTimeoutContext = exports.AbstractCursor = exports.CursorTimeoutMode = exports.CURSOR_FLAGS = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst get_more_1 = __webpack_require__(/*! ../operations/get_more */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/get_more.js\");\nconst kill_cursors_1 = __webpack_require__(/*! ../operations/kill_cursors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/kill_cursors.js\");\nconst read_concern_1 = __webpack_require__(/*! ../read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst resource_management_1 = __webpack_require__(/*! ../resource_management */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js\");\nconst sessions_1 = __webpack_require__(/*! ../sessions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/** @public */\nexports.CURSOR_FLAGS = [\n    'tailable',\n    'oplogReplay',\n    'noCursorTimeout',\n    'awaitData',\n    'exhaust',\n    'partial'\n];\nfunction removeActiveCursor() {\n    this.client.s.activeCursors.delete(this);\n}\n/**\n * @public\n * @experimental\n * Specifies how `timeoutMS` is applied to the cursor. Can be either `'cursorLifeTime'` or `'iteration'`\n * When set to `'iteration'`, the deadline specified by `timeoutMS` applies to each call of\n * `cursor.next()`.\n * When set to `'cursorLifetime'`, the deadline applies to the life of the entire cursor.\n *\n * Depending on the type of cursor being used, this option has different default values.\n * For non-tailable cursors, this value defaults to `'cursorLifetime'`\n * For tailable cursors, this value defaults to `'iteration'` since tailable cursors, by\n * definition can have an arbitrarily long lifetime.\n *\n * @example\n * ```ts\n * const cursor = collection.find({}, {timeoutMS: 100, timeoutMode: 'iteration'});\n * for await (const doc of cursor) {\n *  // process doc\n *  // This will throw a timeout error if any of the iterator's `next()` calls takes more than 100ms, but\n *  // will continue to iterate successfully otherwise, regardless of the number of batches.\n * }\n * ```\n *\n * @example\n * ```ts\n * const cursor = collection.find({}, { timeoutMS: 1000, timeoutMode: 'cursorLifetime' });\n * const docs = await cursor.toArray(); // This entire line will throw a timeout error if all batches are not fetched and returned within 1000ms.\n * ```\n */\nexports.CursorTimeoutMode = Object.freeze({\n    ITERATION: 'iteration',\n    LIFETIME: 'cursorLifetime'\n});\n/** @public */\nclass AbstractCursor extends mongo_types_1.TypedEventEmitter {\n    /** @internal */\n    constructor(client, namespace, options = {}) {\n        super();\n        /** @internal */\n        this.documents = null;\n        /** @internal */\n        this.hasEmittedClose = false;\n        this.on('error', utils_1.noop);\n        if (!client.s.isMongoClient) {\n            throw new error_1.MongoRuntimeError('Cursor must be constructed with MongoClient');\n        }\n        this.cursorClient = client;\n        this.cursorNamespace = namespace;\n        this.cursorId = null;\n        this.initialized = false;\n        this.isClosed = false;\n        this.isKilled = false;\n        this.cursorOptions = {\n            readPreference: options.readPreference && options.readPreference instanceof read_preference_1.ReadPreference\n                ? options.readPreference\n                : read_preference_1.ReadPreference.primary,\n            ...(0, bson_1.pluckBSONSerializeOptions)(options),\n            timeoutMS: options?.timeoutContext?.csotEnabled()\n                ? options.timeoutContext.timeoutMS\n                : options.timeoutMS,\n            tailable: options.tailable,\n            awaitData: options.awaitData\n        };\n        if (this.cursorOptions.timeoutMS != null) {\n            if (options.timeoutMode == null) {\n                if (options.tailable) {\n                    if (options.awaitData) {\n                        if (options.maxAwaitTimeMS != null &&\n                            options.maxAwaitTimeMS >= this.cursorOptions.timeoutMS)\n                            throw new error_1.MongoInvalidArgumentError('Cannot specify maxAwaitTimeMS >= timeoutMS for a tailable awaitData cursor');\n                    }\n                    this.cursorOptions.timeoutMode = exports.CursorTimeoutMode.ITERATION;\n                }\n                else {\n                    this.cursorOptions.timeoutMode = exports.CursorTimeoutMode.LIFETIME;\n                }\n            }\n            else {\n                if (options.tailable && options.timeoutMode === exports.CursorTimeoutMode.LIFETIME) {\n                    throw new error_1.MongoInvalidArgumentError(\"Cannot set tailable cursor's timeoutMode to LIFETIME\");\n                }\n                this.cursorOptions.timeoutMode = options.timeoutMode;\n            }\n        }\n        else {\n            if (options.timeoutMode != null)\n                throw new error_1.MongoInvalidArgumentError('Cannot set timeoutMode without setting timeoutMS');\n        }\n        // Set for initial command\n        this.cursorOptions.omitMaxTimeMS =\n            this.cursorOptions.timeoutMS != null &&\n                ((this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION &&\n                    !this.cursorOptions.tailable) ||\n                    (this.cursorOptions.tailable && !this.cursorOptions.awaitData));\n        const readConcern = read_concern_1.ReadConcern.fromOptions(options);\n        if (readConcern) {\n            this.cursorOptions.readConcern = readConcern;\n        }\n        if (typeof options.batchSize === 'number') {\n            this.cursorOptions.batchSize = options.batchSize;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            this.cursorOptions.comment = options.comment;\n        }\n        if (typeof options.maxTimeMS === 'number') {\n            this.cursorOptions.maxTimeMS = options.maxTimeMS;\n        }\n        if (typeof options.maxAwaitTimeMS === 'number') {\n            this.cursorOptions.maxAwaitTimeMS = options.maxAwaitTimeMS;\n        }\n        if (options.session instanceof sessions_1.ClientSession) {\n            this.cursorSession = options.session;\n        }\n        else {\n            this.cursorSession = this.cursorClient.startSession({ owner: this, explicit: false });\n        }\n        this.deserializationOptions = {\n            ...this.cursorOptions,\n            validation: {\n                utf8: options?.enableUtf8Validation === false ? false : true\n            }\n        };\n        this.timeoutContext = options.timeoutContext;\n        this.signal = options.signal;\n        this.abortListener = (0, utils_1.addAbortListener)(this.signal, () => void this.close().then(undefined, utils_1.squashError));\n        this.trackCursor();\n    }\n    /**\n     * The cursor has no id until it receives a response from the initial cursor creating command.\n     *\n     * It is non-zero for as long as the database has an open cursor.\n     *\n     * The initiating command may receive a zero id if the entire result is in the `firstBatch`.\n     */\n    get id() {\n        return this.cursorId ?? undefined;\n    }\n    /** @internal */\n    get isDead() {\n        return (this.cursorId?.isZero() ?? false) || this.isClosed || this.isKilled;\n    }\n    /** @internal */\n    get client() {\n        return this.cursorClient;\n    }\n    /** @internal */\n    get server() {\n        return this.selectedServer;\n    }\n    get namespace() {\n        return this.cursorNamespace;\n    }\n    get readPreference() {\n        return this.cursorOptions.readPreference;\n    }\n    get readConcern() {\n        return this.cursorOptions.readConcern;\n    }\n    /** @internal */\n    get session() {\n        return this.cursorSession;\n    }\n    set session(clientSession) {\n        this.cursorSession = clientSession;\n    }\n    /**\n     * The cursor is closed and all remaining locally buffered documents have been iterated.\n     */\n    get closed() {\n        return this.isClosed && (this.documents?.length ?? 0) === 0;\n    }\n    /**\n     * A `killCursors` command was attempted on this cursor.\n     * This is performed if the cursor id is non zero.\n     */\n    get killed() {\n        return this.isKilled;\n    }\n    get loadBalanced() {\n        return !!this.cursorClient.topology?.loadBalanced;\n    }\n    /** @internal */\n    async asyncDispose() {\n        await this.close();\n    }\n    /** Adds cursor to client's tracking so it will be closed by MongoClient.close() */\n    trackCursor() {\n        this.cursorClient.s.activeCursors.add(this);\n        if (!this.listeners('close').includes(removeActiveCursor)) {\n            this.once('close', removeActiveCursor);\n        }\n    }\n    /** Returns current buffered documents length */\n    bufferedCount() {\n        return this.documents?.length ?? 0;\n    }\n    /** Returns current buffered documents */\n    readBufferedDocuments(number) {\n        const bufferedDocs = [];\n        const documentsToRead = Math.min(number ?? this.documents?.length ?? 0, this.documents?.length ?? 0);\n        for (let count = 0; count < documentsToRead; count++) {\n            const document = this.documents?.shift(this.deserializationOptions);\n            if (document != null) {\n                bufferedDocs.push(document);\n            }\n        }\n        return bufferedDocs;\n    }\n    async *[Symbol.asyncIterator]() {\n        this.signal?.throwIfAborted();\n        if (this.closed) {\n            return;\n        }\n        try {\n            while (true) {\n                if (this.isKilled) {\n                    return;\n                }\n                if (this.closed) {\n                    return;\n                }\n                if (this.cursorId != null && this.isDead && (this.documents?.length ?? 0) === 0) {\n                    return;\n                }\n                const document = await this.next();\n                // eslint-disable-next-line no-restricted-syntax\n                if (document === null) {\n                    return;\n                }\n                yield document;\n                this.signal?.throwIfAborted();\n            }\n        }\n        finally {\n            // Only close the cursor if it has not already been closed. This finally clause handles\n            // the case when a user would break out of a for await of loop early.\n            if (!this.isClosed) {\n                try {\n                    await this.close();\n                }\n                catch (error) {\n                    (0, utils_1.squashError)(error);\n                }\n            }\n        }\n    }\n    stream(options) {\n        const readable = new ReadableCursorStream(this);\n        const abortListener = (0, utils_1.addAbortListener)(this.signal, function () {\n            readable.destroy(this.reason);\n        });\n        readable.once('end', () => {\n            abortListener?.[utils_1.kDispose]();\n        });\n        if (options?.transform) {\n            const transform = options.transform;\n            const transformedStream = readable.pipe(new stream_1.Transform({\n                objectMode: true,\n                highWaterMark: 1,\n                transform(chunk, _, callback) {\n                    try {\n                        const transformed = transform(chunk);\n                        callback(undefined, transformed);\n                    }\n                    catch (err) {\n                        callback(err);\n                    }\n                }\n            }));\n            // Bubble errors to transformed stream, because otherwise no way\n            // to handle this error.\n            readable.on('error', err => transformedStream.emit('error', err));\n            return transformedStream;\n        }\n        return readable;\n    }\n    async hasNext() {\n        this.signal?.throwIfAborted();\n        if (this.cursorId === bson_1.Long.ZERO) {\n            return false;\n        }\n        if (this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION && this.cursorId != null) {\n            this.timeoutContext?.refresh();\n        }\n        try {\n            do {\n                if ((this.documents?.length ?? 0) !== 0) {\n                    return true;\n                }\n                await this.fetchBatch();\n            } while (!this.isDead || (this.documents?.length ?? 0) !== 0);\n        }\n        finally {\n            if (this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION) {\n                this.timeoutContext?.clear();\n            }\n        }\n        return false;\n    }\n    /** Get the next available document from the cursor, returns null if no more documents are available. */\n    async next() {\n        this.signal?.throwIfAborted();\n        if (this.cursorId === bson_1.Long.ZERO) {\n            throw new error_1.MongoCursorExhaustedError();\n        }\n        if (this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION && this.cursorId != null) {\n            this.timeoutContext?.refresh();\n        }\n        try {\n            do {\n                const doc = this.documents?.shift(this.deserializationOptions);\n                if (doc != null) {\n                    if (this.transform != null)\n                        return await this.transformDocument(doc);\n                    return doc;\n                }\n                await this.fetchBatch();\n            } while (!this.isDead || (this.documents?.length ?? 0) !== 0);\n        }\n        finally {\n            if (this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION) {\n                this.timeoutContext?.clear();\n            }\n        }\n        return null;\n    }\n    /**\n     * Try to get the next available document from the cursor or `null` if an empty batch is returned\n     */\n    async tryNext() {\n        this.signal?.throwIfAborted();\n        if (this.cursorId === bson_1.Long.ZERO) {\n            throw new error_1.MongoCursorExhaustedError();\n        }\n        if (this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION && this.cursorId != null) {\n            this.timeoutContext?.refresh();\n        }\n        try {\n            let doc = this.documents?.shift(this.deserializationOptions);\n            if (doc != null) {\n                if (this.transform != null)\n                    return await this.transformDocument(doc);\n                return doc;\n            }\n            await this.fetchBatch();\n            doc = this.documents?.shift(this.deserializationOptions);\n            if (doc != null) {\n                if (this.transform != null)\n                    return await this.transformDocument(doc);\n                return doc;\n            }\n        }\n        finally {\n            if (this.cursorOptions.timeoutMode === exports.CursorTimeoutMode.ITERATION) {\n                this.timeoutContext?.clear();\n            }\n        }\n        return null;\n    }\n    /**\n     * Iterates over all the documents for this cursor using the iterator, callback pattern.\n     *\n     * If the iterator returns `false`, iteration will stop.\n     *\n     * @param iterator - The iteration callback.\n     * @deprecated - Will be removed in a future release. Use for await...of instead.\n     */\n    async forEach(iterator) {\n        this.signal?.throwIfAborted();\n        if (typeof iterator !== 'function') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"iterator\" must be a function');\n        }\n        for await (const document of this) {\n            const result = iterator(document);\n            if (result === false) {\n                break;\n            }\n        }\n    }\n    /**\n     * Frees any client-side resources used by the cursor.\n     */\n    async close(options) {\n        await this.cleanup(options?.timeoutMS);\n    }\n    /**\n     * Returns an array of documents. The caller is responsible for making sure that there\n     * is enough memory to store the results. Note that the array only contains partial\n     * results when this cursor had been previously accessed. In that case,\n     * cursor.rewind() can be used to reset the cursor.\n     */\n    async toArray() {\n        this.signal?.throwIfAborted();\n        const array = [];\n        // at the end of the loop (since readBufferedDocuments is called) the buffer will be empty\n        // then, the 'await of' syntax will run a getMore call\n        for await (const document of this) {\n            array.push(document);\n            const docs = this.readBufferedDocuments();\n            if (this.transform != null) {\n                for (const doc of docs) {\n                    array.push(await this.transformDocument(doc));\n                }\n            }\n            else {\n                array.push(...docs);\n            }\n        }\n        return array;\n    }\n    /**\n     * Add a cursor flag to the cursor\n     *\n     * @param flag - The flag to set, must be one of following ['tailable', 'oplogReplay', 'noCursorTimeout', 'awaitData', 'partial' -.\n     * @param value - The flag boolean value.\n     */\n    addCursorFlag(flag, value) {\n        this.throwIfInitialized();\n        if (!exports.CURSOR_FLAGS.includes(flag)) {\n            throw new error_1.MongoInvalidArgumentError(`Flag ${flag} is not one of ${exports.CURSOR_FLAGS}`);\n        }\n        if (typeof value !== 'boolean') {\n            throw new error_1.MongoInvalidArgumentError(`Flag ${flag} must be a boolean value`);\n        }\n        this.cursorOptions[flag] = value;\n        return this;\n    }\n    /**\n     * Map all documents using the provided function\n     * If there is a transform set on the cursor, that will be called first and the result passed to\n     * this function's transform.\n     *\n     * @remarks\n     *\n     * **Note** Cursors use `null` internally to indicate that there are no more documents in the cursor. Providing a mapping\n     * function that maps values to `null` will result in the cursor closing itself before it has finished iterating\n     * all documents.  This will **not** result in a memory leak, just surprising behavior.  For example:\n     *\n     * ```typescript\n     * const cursor = collection.find({});\n     * cursor.map(() => null);\n     *\n     * const documents = await cursor.toArray();\n     * // documents is always [], regardless of how many documents are in the collection.\n     * ```\n     *\n     * Other falsey values are allowed:\n     *\n     * ```typescript\n     * const cursor = collection.find({});\n     * cursor.map(() => '');\n     *\n     * const documents = await cursor.toArray();\n     * // documents is now an array of empty strings\n     * ```\n     *\n     * **Note for Typescript Users:** adding a transform changes the return type of the iteration of this cursor,\n     * it **does not** return a new instance of a cursor. This means when calling map,\n     * you should always assign the result to a new variable in order to get a correctly typed cursor variable.\n     * Take note of the following example:\n     *\n     * @example\n     * ```typescript\n     * const cursor: FindCursor<Document> = coll.find();\n     * const mappedCursor: FindCursor<number> = cursor.map(doc => Object.keys(doc).length);\n     * const keyCounts: number[] = await mappedCursor.toArray(); // cursor.toArray() still returns Document[]\n     * ```\n     * @param transform - The mapping transformation method.\n     */\n    map(transform) {\n        this.throwIfInitialized();\n        const oldTransform = this.transform;\n        if (oldTransform) {\n            this.transform = doc => {\n                return transform(oldTransform(doc));\n            };\n        }\n        else {\n            this.transform = transform;\n        }\n        return this;\n    }\n    /**\n     * Set the ReadPreference for the cursor.\n     *\n     * @param readPreference - The new read preference for the cursor.\n     */\n    withReadPreference(readPreference) {\n        this.throwIfInitialized();\n        if (readPreference instanceof read_preference_1.ReadPreference) {\n            this.cursorOptions.readPreference = readPreference;\n        }\n        else if (typeof readPreference === 'string') {\n            this.cursorOptions.readPreference = read_preference_1.ReadPreference.fromString(readPreference);\n        }\n        else {\n            throw new error_1.MongoInvalidArgumentError(`Invalid read preference: ${readPreference}`);\n        }\n        return this;\n    }\n    /**\n     * Set the ReadPreference for the cursor.\n     *\n     * @param readPreference - The new read preference for the cursor.\n     */\n    withReadConcern(readConcern) {\n        this.throwIfInitialized();\n        const resolvedReadConcern = read_concern_1.ReadConcern.fromOptions({ readConcern });\n        if (resolvedReadConcern) {\n            this.cursorOptions.readConcern = resolvedReadConcern;\n        }\n        return this;\n    }\n    /**\n     * Set a maxTimeMS on the cursor query, allowing for hard timeout limits on queries (Only supported on MongoDB 2.6 or higher)\n     *\n     * @param value - Number of milliseconds to wait before aborting the query.\n     */\n    maxTimeMS(value) {\n        this.throwIfInitialized();\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Argument for maxTimeMS must be a number');\n        }\n        this.cursorOptions.maxTimeMS = value;\n        return this;\n    }\n    /**\n     * Set the batch size for the cursor.\n     *\n     * @param value - The number of documents to return per batch. See {@link https://www.mongodb.com/docs/manual/reference/command/find/|find command documentation}.\n     */\n    batchSize(value) {\n        this.throwIfInitialized();\n        if (this.cursorOptions.tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support batchSize');\n        }\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Operation \"batchSize\" requires an integer');\n        }\n        this.cursorOptions.batchSize = value;\n        return this;\n    }\n    /**\n     * Rewind this cursor to its uninitialized state. Any options that are present on the cursor will\n     * remain in effect. Iterating this cursor will cause new queries to be sent to the server, even\n     * if the resultant data has already been retrieved by this cursor.\n     */\n    rewind() {\n        if (this.timeoutContext && this.timeoutContext.owner !== this) {\n            throw new error_1.MongoAPIError(`Cannot rewind cursor that does not own its timeout context.`);\n        }\n        if (!this.initialized) {\n            return;\n        }\n        this.cursorId = null;\n        this.documents?.clear();\n        this.timeoutContext?.clear();\n        this.timeoutContext = undefined;\n        this.isClosed = false;\n        this.isKilled = false;\n        this.initialized = false;\n        this.hasEmittedClose = false;\n        this.trackCursor();\n        // We only want to end this session if we created it, and it hasn't ended yet\n        if (this.cursorSession.explicit === false) {\n            if (!this.cursorSession.hasEnded) {\n                this.cursorSession.endSession().then(undefined, utils_1.squashError);\n            }\n            this.cursorSession = this.cursorClient.startSession({ owner: this, explicit: false });\n        }\n    }\n    /** @internal */\n    async getMore(batchSize) {\n        if (this.cursorId == null) {\n            throw new error_1.MongoRuntimeError('Unexpected null cursor id. A cursor creating command should have set this');\n        }\n        if (this.selectedServer == null) {\n            throw new error_1.MongoRuntimeError('Unexpected null selectedServer. A cursor creating command should have set this');\n        }\n        const getMoreOptions = {\n            ...this.cursorOptions,\n            session: this.cursorSession,\n            batchSize\n        };\n        const getMoreOperation = new get_more_1.GetMoreOperation(this.cursorNamespace, this.cursorId, this.selectedServer, getMoreOptions);\n        return await (0, execute_operation_1.executeOperation)(this.cursorClient, getMoreOperation, this.timeoutContext);\n    }\n    /**\n     * @internal\n     *\n     * This function is exposed for the unified test runner's createChangeStream\n     * operation.  We cannot refactor to use the abstract _initialize method without\n     * a significant refactor.\n     */\n    async cursorInit() {\n        if (this.cursorOptions.timeoutMS != null) {\n            this.timeoutContext ??= new CursorTimeoutContext(timeout_1.TimeoutContext.create({\n                serverSelectionTimeoutMS: this.client.s.options.serverSelectionTimeoutMS,\n                timeoutMS: this.cursorOptions.timeoutMS\n            }), this);\n        }\n        try {\n            const state = await this._initialize(this.cursorSession);\n            // Set omitMaxTimeMS to the value needed for subsequent getMore calls\n            this.cursorOptions.omitMaxTimeMS = this.cursorOptions.timeoutMS != null;\n            const response = state.response;\n            this.selectedServer = state.server;\n            this.cursorId = response.id;\n            this.cursorNamespace = response.ns ?? this.namespace;\n            this.documents = response;\n            this.initialized = true; // the cursor is now initialized, even if it is dead\n        }\n        catch (error) {\n            // the cursor is now initialized, even if an error occurred\n            this.initialized = true;\n            await this.cleanup(undefined, error);\n            throw error;\n        }\n        if (this.isDead) {\n            await this.cleanup();\n        }\n        return;\n    }\n    /** @internal Attempt to obtain more documents */\n    async fetchBatch() {\n        if (this.isClosed) {\n            return;\n        }\n        if (this.isDead) {\n            // if the cursor is dead, we clean it up\n            // cleanupCursor should never throw, but if it does it indicates a bug in the driver\n            // and we should surface the error\n            await this.cleanup();\n            return;\n        }\n        if (this.cursorId == null) {\n            await this.cursorInit();\n            // If the cursor died or returned documents, return\n            if ((this.documents?.length ?? 0) !== 0 || this.isDead)\n                return;\n            // Otherwise, run a getMore\n        }\n        // otherwise need to call getMore\n        const batchSize = this.cursorOptions.batchSize || 1000;\n        try {\n            const response = await this.getMore(batchSize);\n            this.cursorId = response.id;\n            this.documents = response;\n        }\n        catch (error) {\n            try {\n                await this.cleanup(undefined, error);\n            }\n            catch (cleanupError) {\n                // `cleanupCursor` should never throw, squash and throw the original error\n                (0, utils_1.squashError)(cleanupError);\n            }\n            throw error;\n        }\n        if (this.isDead) {\n            // If we successfully received a response from a cursor BUT the cursor indicates that it is exhausted,\n            // we intentionally clean up the cursor to release its session back into the pool before the cursor\n            // is iterated.  This prevents a cursor that is exhausted on the server from holding\n            // onto a session indefinitely until the AbstractCursor is iterated.\n            //\n            // cleanupCursorAsync should never throw, but if it does it indicates a bug in the driver\n            // and we should surface the error\n            await this.cleanup();\n        }\n    }\n    /** @internal */\n    async cleanup(timeoutMS, error) {\n        this.abortListener?.[utils_1.kDispose]();\n        this.isClosed = true;\n        const timeoutContextForKillCursors = () => {\n            if (timeoutMS != null) {\n                this.timeoutContext?.clear();\n                return new CursorTimeoutContext(timeout_1.TimeoutContext.create({\n                    serverSelectionTimeoutMS: this.client.s.options.serverSelectionTimeoutMS,\n                    timeoutMS\n                }), this);\n            }\n            else {\n                return this.timeoutContext?.refreshed();\n            }\n        };\n        try {\n            if (!this.isKilled &&\n                this.cursorId &&\n                !this.cursorId.isZero() &&\n                this.cursorNamespace &&\n                this.selectedServer &&\n                !this.cursorSession.hasEnded) {\n                this.isKilled = true;\n                const cursorId = this.cursorId;\n                this.cursorId = bson_1.Long.ZERO;\n                await (0, execute_operation_1.executeOperation)(this.cursorClient, new kill_cursors_1.KillCursorsOperation(cursorId, this.cursorNamespace, this.selectedServer, {\n                    session: this.cursorSession\n                }), timeoutContextForKillCursors());\n            }\n        }\n        catch (error) {\n            (0, utils_1.squashError)(error);\n        }\n        finally {\n            try {\n                if (this.cursorSession?.owner === this) {\n                    await this.cursorSession.endSession({ error });\n                }\n                if (!this.cursorSession?.inTransaction()) {\n                    (0, sessions_1.maybeClearPinnedConnection)(this.cursorSession, { error });\n                }\n            }\n            finally {\n                this.emitClose();\n            }\n        }\n    }\n    /** @internal */\n    emitClose() {\n        try {\n            if (!this.hasEmittedClose && ((this.documents?.length ?? 0) === 0 || this.isClosed)) {\n                // @ts-expect-error: CursorEvents is generic so Parameters<CursorEvents[\"close\"]> may not be assignable to `[]`. Not sure how to require extenders do not add parameters.\n                this.emit('close');\n            }\n        }\n        finally {\n            this.hasEmittedClose = true;\n        }\n    }\n    /** @internal */\n    async transformDocument(document) {\n        if (this.transform == null)\n            return document;\n        try {\n            const transformedDocument = this.transform(document);\n            // eslint-disable-next-line no-restricted-syntax\n            if (transformedDocument === null) {\n                const TRANSFORM_TO_NULL_ERROR = 'Cursor returned a `null` document, but the cursor is not exhausted.  Mapping documents to `null` is not supported in the cursor transform.';\n                throw new error_1.MongoAPIError(TRANSFORM_TO_NULL_ERROR);\n            }\n            return transformedDocument;\n        }\n        catch (transformError) {\n            try {\n                await this.close();\n            }\n            catch (closeError) {\n                (0, utils_1.squashError)(closeError);\n            }\n            throw transformError;\n        }\n    }\n    /** @internal */\n    throwIfInitialized() {\n        if (this.initialized)\n            throw new error_1.MongoCursorInUseError();\n    }\n}\nexports.AbstractCursor = AbstractCursor;\n/** @event */\nAbstractCursor.CLOSE = 'close';\nclass ReadableCursorStream extends stream_1.Readable {\n    constructor(cursor) {\n        super({\n            objectMode: true,\n            autoDestroy: false,\n            highWaterMark: 1\n        });\n        this._readInProgress = false;\n        this._cursor = cursor;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _read(size) {\n        if (!this._readInProgress) {\n            this._readInProgress = true;\n            this._readNext();\n        }\n    }\n    _destroy(error, callback) {\n        this._cursor.close().then(() => callback(error), closeError => callback(closeError));\n    }\n    _readNext() {\n        if (this._cursor.id === bson_1.Long.ZERO) {\n            this.push(null);\n            return;\n        }\n        this._cursor\n            .next()\n            .then(\n        // result from next()\n        result => {\n            if (result == null) {\n                this.push(null);\n            }\n            else if (this.destroyed) {\n                this._cursor.close().then(undefined, utils_1.squashError);\n            }\n            else {\n                if (this.push(result)) {\n                    return this._readNext();\n                }\n                this._readInProgress = false;\n            }\n        }, \n        // error from next()\n        err => {\n            // NOTE: This is questionable, but we have a test backing the behavior. It seems the\n            //       desired behavior is that a stream ends cleanly when a user explicitly closes\n            //       a client during iteration. Alternatively, we could do the \"right\" thing and\n            //       propagate the error message by removing this special case.\n            if (err.message.match(/server is closed/)) {\n                this._cursor.close().then(undefined, utils_1.squashError);\n                return this.push(null);\n            }\n            // NOTE: This is also perhaps questionable. The rationale here is that these errors tend\n            //       to be \"operation was interrupted\", where a cursor has been closed but there is an\n            //       active getMore in-flight. This used to check if the cursor was killed but once\n            //       that changed to happen in cleanup legitimate errors would not destroy the\n            //       stream. There are change streams test specifically test these cases.\n            if (err.message.match(/operation was interrupted/)) {\n                return this.push(null);\n            }\n            // NOTE: The two above checks on the message of the error will cause a null to be pushed\n            //       to the stream, thus closing the stream before the destroy call happens. This means\n            //       that either of those error messages on a change stream will not get a proper\n            //       'error' event to be emitted (the error passed to destroy). Change stream resumability\n            //       relies on that error event to be emitted to create its new cursor and thus was not\n            //       working on 4.4 servers because the error emitted on failover was \"interrupted at\n            //       shutdown\" while on 5.0+ it is \"The server is in quiesce mode and will shut down\".\n            //       See NODE-4475.\n            return this.destroy(err);\n        })\n            // if either of the above handlers throw\n            .catch(error => {\n            this._readInProgress = false;\n            this.destroy(error);\n        });\n    }\n}\n(0, resource_management_1.configureResourceManagement)(AbstractCursor.prototype);\n/**\n * @internal\n * The cursor timeout context is a wrapper around a timeout context\n * that keeps track of the \"owner\" of the cursor.  For timeout contexts\n * instantiated inside a cursor, the owner will be the cursor.\n *\n * All timeout behavior is exactly the same as the wrapped timeout context's.\n */\nclass CursorTimeoutContext extends timeout_1.TimeoutContext {\n    constructor(timeoutContext, owner) {\n        super();\n        this.timeoutContext = timeoutContext;\n        this.owner = owner;\n    }\n    get serverSelectionTimeout() {\n        return this.timeoutContext.serverSelectionTimeout;\n    }\n    get connectionCheckoutTimeout() {\n        return this.timeoutContext.connectionCheckoutTimeout;\n    }\n    get clearServerSelectionTimeout() {\n        return this.timeoutContext.clearServerSelectionTimeout;\n    }\n    get timeoutForSocketWrite() {\n        return this.timeoutContext.timeoutForSocketWrite;\n    }\n    get timeoutForSocketRead() {\n        return this.timeoutContext.timeoutForSocketRead;\n    }\n    csotEnabled() {\n        return this.timeoutContext.csotEnabled();\n    }\n    refresh() {\n        if (typeof this.owner !== 'symbol')\n            return this.timeoutContext.refresh();\n    }\n    clear() {\n        if (typeof this.owner !== 'symbol')\n            return this.timeoutContext.clear();\n    }\n    get maxTimeMS() {\n        return this.timeoutContext.maxTimeMS;\n    }\n    get timeoutMS() {\n        return this.timeoutContext.csotEnabled() ? this.timeoutContext.timeoutMS : null;\n    }\n    refreshed() {\n        return new CursorTimeoutContext(this.timeoutContext.refreshed(), this.owner);\n    }\n    addMaxTimeMSToCommand(command, options) {\n        this.timeoutContext.addMaxTimeMSToCommand(command, options);\n    }\n    getSocketTimeoutMS() {\n        return this.timeoutContext.getSocketTimeoutMS();\n    }\n}\nexports.CursorTimeoutContext = CursorTimeoutContext;\n//# sourceMappingURL=abstract_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9hYnN0cmFjdF9jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNEJBQTRCLEdBQUcsc0JBQXNCLEdBQUcseUJBQXlCLEdBQUcsb0JBQW9CO0FBQ3hHLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxzQkFBc0IsbUJBQU8sQ0FBQyx5R0FBZ0I7QUFDOUMsNEJBQTRCLG1CQUFPLENBQUMsMklBQWlDO0FBQ3JFLG1CQUFtQixtQkFBTyxDQUFDLHlIQUF3QjtBQUNuRCx1QkFBdUIsbUJBQU8sQ0FBQyxpSUFBNEI7QUFDM0QsdUJBQXVCLG1CQUFPLENBQUMsMkdBQWlCO0FBQ2hELDBCQUEwQixtQkFBTyxDQUFDLGlIQUFvQjtBQUN0RCw4QkFBOEIsbUJBQU8sQ0FBQyx5SEFBd0I7QUFDOUQsbUJBQW1CLG1CQUFPLENBQUMsbUdBQWE7QUFDeEMsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEM7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsR0FBRyx5Q0FBeUM7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLElBQUksZ0RBQWdEO0FBQ3hGLHdDQUF3QztBQUN4QztBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFLDhCQUE4QjtBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qix5QkFBeUI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0UsTUFBTSxnQkFBZ0IscUJBQXFCO0FBQzNHO0FBQ0E7QUFDQSxnRUFBZ0UsTUFBTTtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRixlQUFlO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLGFBQWE7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFLDZGQUE2RjtBQUNySztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFLDhCQUE4QjtBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCxPQUFPO0FBQ2pFO0FBQ0E7QUFDQSxxRkFBcUYsT0FBTztBQUM1RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvY3Vyc29yL2Fic3RyYWN0X2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ3Vyc29yVGltZW91dENvbnRleHQgPSBleHBvcnRzLkFic3RyYWN0Q3Vyc29yID0gZXhwb3J0cy5DdXJzb3JUaW1lb3V0TW9kZSA9IGV4cG9ydHMuQ1VSU09SX0ZMQUdTID0gdm9pZCAwO1xuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwic3RyZWFtXCIpO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4uL2Jzb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgbW9uZ29fdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi9tb25nb190eXBlc1wiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IGdldF9tb3JlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9nZXRfbW9yZVwiKTtcbmNvbnN0IGtpbGxfY3Vyc29yc18xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMva2lsbF9jdXJzb3JzXCIpO1xuY29uc3QgcmVhZF9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3QgcmVzb3VyY2VfbWFuYWdlbWVudF8xID0gcmVxdWlyZShcIi4uL3Jlc291cmNlX21hbmFnZW1lbnRcIik7XG5jb25zdCBzZXNzaW9uc18xID0gcmVxdWlyZShcIi4uL3Nlc3Npb25zXCIpO1xuY29uc3QgdGltZW91dF8xID0gcmVxdWlyZShcIi4uL3RpbWVvdXRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuQ1VSU09SX0ZMQUdTID0gW1xuICAgICd0YWlsYWJsZScsXG4gICAgJ29wbG9nUmVwbGF5JyxcbiAgICAnbm9DdXJzb3JUaW1lb3V0JyxcbiAgICAnYXdhaXREYXRhJyxcbiAgICAnZXhoYXVzdCcsXG4gICAgJ3BhcnRpYWwnXG5dO1xuZnVuY3Rpb24gcmVtb3ZlQWN0aXZlQ3Vyc29yKCkge1xuICAgIHRoaXMuY2xpZW50LnMuYWN0aXZlQ3Vyc29ycy5kZWxldGUodGhpcyk7XG59XG4vKipcbiAqIEBwdWJsaWNcbiAqIEBleHBlcmltZW50YWxcbiAqIFNwZWNpZmllcyBob3cgYHRpbWVvdXRNU2AgaXMgYXBwbGllZCB0byB0aGUgY3Vyc29yLiBDYW4gYmUgZWl0aGVyIGAnY3Vyc29yTGlmZVRpbWUnYCBvciBgJ2l0ZXJhdGlvbidgXG4gKiBXaGVuIHNldCB0byBgJ2l0ZXJhdGlvbidgLCB0aGUgZGVhZGxpbmUgc3BlY2lmaWVkIGJ5IGB0aW1lb3V0TVNgIGFwcGxpZXMgdG8gZWFjaCBjYWxsIG9mXG4gKiBgY3Vyc29yLm5leHQoKWAuXG4gKiBXaGVuIHNldCB0byBgJ2N1cnNvckxpZmV0aW1lJ2AsIHRoZSBkZWFkbGluZSBhcHBsaWVzIHRvIHRoZSBsaWZlIG9mIHRoZSBlbnRpcmUgY3Vyc29yLlxuICpcbiAqIERlcGVuZGluZyBvbiB0aGUgdHlwZSBvZiBjdXJzb3IgYmVpbmcgdXNlZCwgdGhpcyBvcHRpb24gaGFzIGRpZmZlcmVudCBkZWZhdWx0IHZhbHVlcy5cbiAqIEZvciBub24tdGFpbGFibGUgY3Vyc29ycywgdGhpcyB2YWx1ZSBkZWZhdWx0cyB0byBgJ2N1cnNvckxpZmV0aW1lJ2BcbiAqIEZvciB0YWlsYWJsZSBjdXJzb3JzLCB0aGlzIHZhbHVlIGRlZmF1bHRzIHRvIGAnaXRlcmF0aW9uJ2Agc2luY2UgdGFpbGFibGUgY3Vyc29ycywgYnlcbiAqIGRlZmluaXRpb24gY2FuIGhhdmUgYW4gYXJiaXRyYXJpbHkgbG9uZyBsaWZldGltZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGNvbnN0IGN1cnNvciA9IGNvbGxlY3Rpb24uZmluZCh7fSwge3RpbWVvdXRNUzogMTAwLCB0aW1lb3V0TW9kZTogJ2l0ZXJhdGlvbid9KTtcbiAqIGZvciBhd2FpdCAoY29uc3QgZG9jIG9mIGN1cnNvcikge1xuICogIC8vIHByb2Nlc3MgZG9jXG4gKiAgLy8gVGhpcyB3aWxsIHRocm93IGEgdGltZW91dCBlcnJvciBpZiBhbnkgb2YgdGhlIGl0ZXJhdG9yJ3MgYG5leHQoKWAgY2FsbHMgdGFrZXMgbW9yZSB0aGFuIDEwMG1zLCBidXRcbiAqICAvLyB3aWxsIGNvbnRpbnVlIHRvIGl0ZXJhdGUgc3VjY2Vzc2Z1bGx5IG90aGVyd2lzZSwgcmVnYXJkbGVzcyBvZiB0aGUgbnVtYmVyIG9mIGJhdGNoZXMuXG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIGNvbnN0IGN1cnNvciA9IGNvbGxlY3Rpb24uZmluZCh7fSwgeyB0aW1lb3V0TVM6IDEwMDAsIHRpbWVvdXRNb2RlOiAnY3Vyc29yTGlmZXRpbWUnIH0pO1xuICogY29uc3QgZG9jcyA9IGF3YWl0IGN1cnNvci50b0FycmF5KCk7IC8vIFRoaXMgZW50aXJlIGxpbmUgd2lsbCB0aHJvdyBhIHRpbWVvdXQgZXJyb3IgaWYgYWxsIGJhdGNoZXMgYXJlIG5vdCBmZXRjaGVkIGFuZCByZXR1cm5lZCB3aXRoaW4gMTAwMG1zLlxuICogYGBgXG4gKi9cbmV4cG9ydHMuQ3Vyc29yVGltZW91dE1vZGUgPSBPYmplY3QuZnJlZXplKHtcbiAgICBJVEVSQVRJT046ICdpdGVyYXRpb24nLFxuICAgIExJRkVUSU1FOiAnY3Vyc29yTGlmZXRpbWUnXG59KTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBBYnN0cmFjdEN1cnNvciBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIG5hbWVzcGFjZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5kb2N1bWVudHMgPSBudWxsO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMuaGFzRW1pdHRlZENsb3NlID0gZmFsc2U7XG4gICAgICAgIHRoaXMub24oJ2Vycm9yJywgdXRpbHNfMS5ub29wKTtcbiAgICAgICAgaWYgKCFjbGllbnQucy5pc01vbmdvQ2xpZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignQ3Vyc29yIG11c3QgYmUgY29uc3RydWN0ZWQgd2l0aCBNb25nb0NsaWVudCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3Vyc29yQ2xpZW50ID0gY2xpZW50O1xuICAgICAgICB0aGlzLmN1cnNvck5hbWVzcGFjZSA9IG5hbWVzcGFjZTtcbiAgICAgICAgdGhpcy5jdXJzb3JJZCA9IG51bGw7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0Nsb3NlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzS2lsbGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiBvcHRpb25zLnJlYWRQcmVmZXJlbmNlICYmIG9wdGlvbnMucmVhZFByZWZlcmVuY2UgaW5zdGFuY2VvZiByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZVxuICAgICAgICAgICAgICAgID8gb3B0aW9ucy5yZWFkUHJlZmVyZW5jZVxuICAgICAgICAgICAgICAgIDogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSxcbiAgICAgICAgICAgIC4uLigwLCBic29uXzEucGx1Y2tCU09OU2VyaWFsaXplT3B0aW9ucykob3B0aW9ucyksXG4gICAgICAgICAgICB0aW1lb3V0TVM6IG9wdGlvbnM/LnRpbWVvdXRDb250ZXh0Py5jc290RW5hYmxlZCgpXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLnRpbWVvdXRDb250ZXh0LnRpbWVvdXRNU1xuICAgICAgICAgICAgICAgIDogb3B0aW9ucy50aW1lb3V0TVMsXG4gICAgICAgICAgICB0YWlsYWJsZTogb3B0aW9ucy50YWlsYWJsZSxcbiAgICAgICAgICAgIGF3YWl0RGF0YTogb3B0aW9ucy5hd2FpdERhdGFcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuY3Vyc29yT3B0aW9ucy50aW1lb3V0TVMgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dE1vZGUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnRhaWxhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmF3YWl0RGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4QXdhaXRUaW1lTVMgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubWF4QXdhaXRUaW1lTVMgPj0gdGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNUylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDYW5ub3Qgc3BlY2lmeSBtYXhBd2FpdFRpbWVNUyA+PSB0aW1lb3V0TVMgZm9yIGEgdGFpbGFibGUgYXdhaXREYXRhIGN1cnNvcicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy50aW1lb3V0TW9kZSA9IGV4cG9ydHMuQ3Vyc29yVGltZW91dE1vZGUuSVRFUkFUSU9OO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNb2RlID0gZXhwb3J0cy5DdXJzb3JUaW1lb3V0TW9kZS5MSUZFVElNRTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50YWlsYWJsZSAmJiBvcHRpb25zLnRpbWVvdXRNb2RlID09PSBleHBvcnRzLkN1cnNvclRpbWVvdXRNb2RlLkxJRkVUSU1FKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoXCJDYW5ub3Qgc2V0IHRhaWxhYmxlIGN1cnNvcidzIHRpbWVvdXRNb2RlIHRvIExJRkVUSU1FXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMudGltZW91dE1vZGUgPSBvcHRpb25zLnRpbWVvdXRNb2RlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dE1vZGUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdDYW5ub3Qgc2V0IHRpbWVvdXRNb2RlIHdpdGhvdXQgc2V0dGluZyB0aW1lb3V0TVMnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTZXQgZm9yIGluaXRpYWwgY29tbWFuZFxuICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMub21pdE1heFRpbWVNUyA9XG4gICAgICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMudGltZW91dE1TICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICAoKHRoaXMuY3Vyc29yT3B0aW9ucy50aW1lb3V0TW9kZSA9PT0gZXhwb3J0cy5DdXJzb3JUaW1lb3V0TW9kZS5JVEVSQVRJT04gJiZcbiAgICAgICAgICAgICAgICAgICAgIXRoaXMuY3Vyc29yT3B0aW9ucy50YWlsYWJsZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMuY3Vyc29yT3B0aW9ucy50YWlsYWJsZSAmJiAhdGhpcy5jdXJzb3JPcHRpb25zLmF3YWl0RGF0YSkpO1xuICAgICAgICBjb25zdCByZWFkQ29uY2VybiA9IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICBpZiAocmVhZENvbmNlcm4pIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy5yZWFkQ29uY2VybiA9IHJlYWRDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5iYXRjaFNpemUgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMuYmF0Y2hTaXplID0gb3B0aW9ucy5iYXRjaFNpemU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gd2UgY2hlY2sgZm9yIHVuZGVmaW5lZCBzcGVjaWZpY2FsbHkgaGVyZSB0byBhbGxvdyBmYWxzeSB2YWx1ZXNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgICAgIGlmIChvcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jdXJzb3JPcHRpb25zLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy5tYXhUaW1lTVMgPSBvcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMubWF4QXdhaXRUaW1lTVMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMubWF4QXdhaXRUaW1lTVMgPSBvcHRpb25zLm1heEF3YWl0VGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnNlc3Npb24gaW5zdGFuY2VvZiBzZXNzaW9uc18xLkNsaWVudFNlc3Npb24pIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yU2Vzc2lvbiA9IG9wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yU2Vzc2lvbiA9IHRoaXMuY3Vyc29yQ2xpZW50LnN0YXJ0U2Vzc2lvbih7IG93bmVyOiB0aGlzLCBleHBsaWNpdDogZmFsc2UgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kZXNlcmlhbGl6YXRpb25PcHRpb25zID0ge1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgdmFsaWRhdGlvbjoge1xuICAgICAgICAgICAgICAgIHV0Zjg6IG9wdGlvbnM/LmVuYWJsZVV0ZjhWYWxpZGF0aW9uID09PSBmYWxzZSA/IGZhbHNlIDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0ID0gb3B0aW9ucy50aW1lb3V0Q29udGV4dDtcbiAgICAgICAgdGhpcy5zaWduYWwgPSBvcHRpb25zLnNpZ25hbDtcbiAgICAgICAgdGhpcy5hYm9ydExpc3RlbmVyID0gKDAsIHV0aWxzXzEuYWRkQWJvcnRMaXN0ZW5lcikodGhpcy5zaWduYWwsICgpID0+IHZvaWQgdGhpcy5jbG9zZSgpLnRoZW4odW5kZWZpbmVkLCB1dGlsc18xLnNxdWFzaEVycm9yKSk7XG4gICAgICAgIHRoaXMudHJhY2tDdXJzb3IoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnNvciBoYXMgbm8gaWQgdW50aWwgaXQgcmVjZWl2ZXMgYSByZXNwb25zZSBmcm9tIHRoZSBpbml0aWFsIGN1cnNvciBjcmVhdGluZyBjb21tYW5kLlxuICAgICAqXG4gICAgICogSXQgaXMgbm9uLXplcm8gZm9yIGFzIGxvbmcgYXMgdGhlIGRhdGFiYXNlIGhhcyBhbiBvcGVuIGN1cnNvci5cbiAgICAgKlxuICAgICAqIFRoZSBpbml0aWF0aW5nIGNvbW1hbmQgbWF5IHJlY2VpdmUgYSB6ZXJvIGlkIGlmIHRoZSBlbnRpcmUgcmVzdWx0IGlzIGluIHRoZSBgZmlyc3RCYXRjaGAuXG4gICAgICovXG4gICAgZ2V0IGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJzb3JJZCA/PyB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgaXNEZWFkKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuY3Vyc29ySWQ/LmlzWmVybygpID8/IGZhbHNlKSB8fCB0aGlzLmlzQ2xvc2VkIHx8IHRoaXMuaXNLaWxsZWQ7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgY2xpZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJzb3JDbGllbnQ7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgc2VydmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFNlcnZlcjtcbiAgICB9XG4gICAgZ2V0IG5hbWVzcGFjZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3Vyc29yTmFtZXNwYWNlO1xuICAgIH1cbiAgICBnZXQgcmVhZFByZWZlcmVuY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnNvck9wdGlvbnMucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGdldCByZWFkQ29uY2VybigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3Vyc29yT3B0aW9ucy5yZWFkQ29uY2VybjtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGdldCBzZXNzaW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJzb3JTZXNzaW9uO1xuICAgIH1cbiAgICBzZXQgc2Vzc2lvbihjbGllbnRTZXNzaW9uKSB7XG4gICAgICAgIHRoaXMuY3Vyc29yU2Vzc2lvbiA9IGNsaWVudFNlc3Npb247XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBjdXJzb3IgaXMgY2xvc2VkIGFuZCBhbGwgcmVtYWluaW5nIGxvY2FsbHkgYnVmZmVyZWQgZG9jdW1lbnRzIGhhdmUgYmVlbiBpdGVyYXRlZC5cbiAgICAgKi9cbiAgICBnZXQgY2xvc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0Nsb3NlZCAmJiAodGhpcy5kb2N1bWVudHM/Lmxlbmd0aCA/PyAwKSA9PT0gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBga2lsbEN1cnNvcnNgIGNvbW1hbmQgd2FzIGF0dGVtcHRlZCBvbiB0aGlzIGN1cnNvci5cbiAgICAgKiBUaGlzIGlzIHBlcmZvcm1lZCBpZiB0aGUgY3Vyc29yIGlkIGlzIG5vbiB6ZXJvLlxuICAgICAqL1xuICAgIGdldCBraWxsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzS2lsbGVkO1xuICAgIH1cbiAgICBnZXQgbG9hZEJhbGFuY2VkKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLmN1cnNvckNsaWVudC50b3BvbG9neT8ubG9hZEJhbGFuY2VkO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYXN5bmMgYXN5bmNEaXNwb3NlKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICAgIC8qKiBBZGRzIGN1cnNvciB0byBjbGllbnQncyB0cmFja2luZyBzbyBpdCB3aWxsIGJlIGNsb3NlZCBieSBNb25nb0NsaWVudC5jbG9zZSgpICovXG4gICAgdHJhY2tDdXJzb3IoKSB7XG4gICAgICAgIHRoaXMuY3Vyc29yQ2xpZW50LnMuYWN0aXZlQ3Vyc29ycy5hZGQodGhpcyk7XG4gICAgICAgIGlmICghdGhpcy5saXN0ZW5lcnMoJ2Nsb3NlJykuaW5jbHVkZXMocmVtb3ZlQWN0aXZlQ3Vyc29yKSkge1xuICAgICAgICAgICAgdGhpcy5vbmNlKCdjbG9zZScsIHJlbW92ZUFjdGl2ZUN1cnNvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIFJldHVybnMgY3VycmVudCBidWZmZXJlZCBkb2N1bWVudHMgbGVuZ3RoICovXG4gICAgYnVmZmVyZWRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRzPy5sZW5ndGggPz8gMDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgY3VycmVudCBidWZmZXJlZCBkb2N1bWVudHMgKi9cbiAgICByZWFkQnVmZmVyZWREb2N1bWVudHMobnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcmVkRG9jcyA9IFtdO1xuICAgICAgICBjb25zdCBkb2N1bWVudHNUb1JlYWQgPSBNYXRoLm1pbihudW1iZXIgPz8gdGhpcy5kb2N1bWVudHM/Lmxlbmd0aCA/PyAwLCB0aGlzLmRvY3VtZW50cz8ubGVuZ3RoID8/IDApO1xuICAgICAgICBmb3IgKGxldCBjb3VudCA9IDA7IGNvdW50IDwgZG9jdW1lbnRzVG9SZWFkOyBjb3VudCsrKSB7XG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IHRoaXMuZG9jdW1lbnRzPy5zaGlmdCh0aGlzLmRlc2VyaWFsaXphdGlvbk9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBidWZmZXJlZERvY3MucHVzaChkb2N1bWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZmZlcmVkRG9jcztcbiAgICB9XG4gICAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICAgIHRoaXMuc2lnbmFsPy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0tpbGxlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnNvcklkICE9IG51bGwgJiYgdGhpcy5pc0RlYWQgJiYgKHRoaXMuZG9jdW1lbnRzPy5sZW5ndGggPz8gMCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMubmV4dCgpO1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHlpZWxkIGRvY3VtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmFsPy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgLy8gT25seSBjbG9zZSB0aGUgY3Vyc29yIGlmIGl0IGhhcyBub3QgYWxyZWFkeSBiZWVuIGNsb3NlZC4gVGhpcyBmaW5hbGx5IGNsYXVzZSBoYW5kbGVzXG4gICAgICAgICAgICAvLyB0aGUgY2FzZSB3aGVuIGEgdXNlciB3b3VsZCBicmVhayBvdXQgb2YgYSBmb3IgYXdhaXQgb2YgbG9vcCBlYXJseS5cbiAgICAgICAgICAgIGlmICghdGhpcy5pc0Nsb3NlZCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHN0cmVhbShvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHJlYWRhYmxlID0gbmV3IFJlYWRhYmxlQ3Vyc29yU3RyZWFtKHRoaXMpO1xuICAgICAgICBjb25zdCBhYm9ydExpc3RlbmVyID0gKDAsIHV0aWxzXzEuYWRkQWJvcnRMaXN0ZW5lcikodGhpcy5zaWduYWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlYWRhYmxlLmRlc3Ryb3kodGhpcy5yZWFzb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVhZGFibGUub25jZSgnZW5kJywgKCkgPT4ge1xuICAgICAgICAgICAgYWJvcnRMaXN0ZW5lcj8uW3V0aWxzXzEua0Rpc3Bvc2VdKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAob3B0aW9ucz8udHJhbnNmb3JtKSB7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBvcHRpb25zLnRyYW5zZm9ybTtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkU3RyZWFtID0gcmVhZGFibGUucGlwZShuZXcgc3RyZWFtXzEuVHJhbnNmb3JtKHtcbiAgICAgICAgICAgICAgICBvYmplY3RNb2RlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhpZ2hXYXRlck1hcms6IDEsXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtKGNodW5rLCBfLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWQgPSB0cmFuc2Zvcm0oY2h1bmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB0cmFuc2Zvcm1lZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIC8vIEJ1YmJsZSBlcnJvcnMgdG8gdHJhbnNmb3JtZWQgc3RyZWFtLCBiZWNhdXNlIG90aGVyd2lzZSBubyB3YXlcbiAgICAgICAgICAgIC8vIHRvIGhhbmRsZSB0aGlzIGVycm9yLlxuICAgICAgICAgICAgcmVhZGFibGUub24oJ2Vycm9yJywgZXJyID0+IHRyYW5zZm9ybWVkU3RyZWFtLmVtaXQoJ2Vycm9yJywgZXJyKSk7XG4gICAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWRTdHJlYW07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlYWRhYmxlO1xuICAgIH1cbiAgICBhc3luYyBoYXNOZXh0KCkge1xuICAgICAgICB0aGlzLnNpZ25hbD8udGhyb3dJZkFib3J0ZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuY3Vyc29ySWQgPT09IGJzb25fMS5Mb25nLlpFUk8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNb2RlID09PSBleHBvcnRzLkN1cnNvclRpbWVvdXRNb2RlLklURVJBVElPTiAmJiB0aGlzLmN1cnNvcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LnJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGlmICgodGhpcy5kb2N1bWVudHM/Lmxlbmd0aCA/PyAwKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5mZXRjaEJhdGNoKCk7XG4gICAgICAgICAgICB9IHdoaWxlICghdGhpcy5pc0RlYWQgfHwgKHRoaXMuZG9jdW1lbnRzPy5sZW5ndGggPz8gMCkgIT09IDApO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3Vyc29yT3B0aW9ucy50aW1lb3V0TW9kZSA9PT0gZXhwb3J0cy5DdXJzb3JUaW1lb3V0TW9kZS5JVEVSQVRJT04pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0Py5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqIEdldCB0aGUgbmV4dCBhdmFpbGFibGUgZG9jdW1lbnQgZnJvbSB0aGUgY3Vyc29yLCByZXR1cm5zIG51bGwgaWYgbm8gbW9yZSBkb2N1bWVudHMgYXJlIGF2YWlsYWJsZS4gKi9cbiAgICBhc3luYyBuZXh0KCkge1xuICAgICAgICB0aGlzLnNpZ25hbD8udGhyb3dJZkFib3J0ZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuY3Vyc29ySWQgPT09IGJzb25fMS5Mb25nLlpFUk8pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3IoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNb2RlID09PSBleHBvcnRzLkN1cnNvclRpbWVvdXRNb2RlLklURVJBVElPTiAmJiB0aGlzLmN1cnNvcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LnJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IHRoaXMuZG9jdW1lbnRzPy5zaGlmdCh0aGlzLmRlc2VyaWFsaXphdGlvbk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGlmIChkb2MgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2Zvcm0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnRyYW5zZm9ybURvY3VtZW50KGRvYyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkb2M7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZmV0Y2hCYXRjaCgpO1xuICAgICAgICAgICAgfSB3aGlsZSAoIXRoaXMuaXNEZWFkIHx8ICh0aGlzLmRvY3VtZW50cz8ubGVuZ3RoID8/IDApICE9PSAwKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnNvck9wdGlvbnMudGltZW91dE1vZGUgPT09IGV4cG9ydHMuQ3Vyc29yVGltZW91dE1vZGUuSVRFUkFUSU9OKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dD8uY2xlYXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJ5IHRvIGdldCB0aGUgbmV4dCBhdmFpbGFibGUgZG9jdW1lbnQgZnJvbSB0aGUgY3Vyc29yIG9yIGBudWxsYCBpZiBhbiBlbXB0eSBiYXRjaCBpcyByZXR1cm5lZFxuICAgICAqL1xuICAgIGFzeW5jIHRyeU5leHQoKSB7XG4gICAgICAgIHRoaXMuc2lnbmFsPy50aHJvd0lmQWJvcnRlZCgpO1xuICAgICAgICBpZiAodGhpcy5jdXJzb3JJZCA9PT0gYnNvbl8xLkxvbmcuWkVSTykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmN1cnNvck9wdGlvbnMudGltZW91dE1vZGUgPT09IGV4cG9ydHMuQ3Vyc29yVGltZW91dE1vZGUuSVRFUkFUSU9OICYmIHRoaXMuY3Vyc29ySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dD8ucmVmcmVzaCgpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgZG9jID0gdGhpcy5kb2N1bWVudHM/LnNoaWZ0KHRoaXMuZGVzZXJpYWxpemF0aW9uT3B0aW9ucyk7XG4gICAgICAgICAgICBpZiAoZG9jICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2Zvcm0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudHJhbnNmb3JtRG9jdW1lbnQoZG9jKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5mZXRjaEJhdGNoKCk7XG4gICAgICAgICAgICBkb2MgPSB0aGlzLmRvY3VtZW50cz8uc2hpZnQodGhpcy5kZXNlcmlhbGl6YXRpb25PcHRpb25zKTtcbiAgICAgICAgICAgIGlmIChkb2MgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zZm9ybSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy50cmFuc2Zvcm1Eb2N1bWVudChkb2MpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkb2M7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNb2RlID09PSBleHBvcnRzLkN1cnNvclRpbWVvdXRNb2RlLklURVJBVElPTikge1xuICAgICAgICAgICAgICAgIHRoaXMudGltZW91dENvbnRleHQ/LmNsZWFyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYWxsIHRoZSBkb2N1bWVudHMgZm9yIHRoaXMgY3Vyc29yIHVzaW5nIHRoZSBpdGVyYXRvciwgY2FsbGJhY2sgcGF0dGVybi5cbiAgICAgKlxuICAgICAqIElmIHRoZSBpdGVyYXRvciByZXR1cm5zIGBmYWxzZWAsIGl0ZXJhdGlvbiB3aWxsIHN0b3AuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaXRlcmF0b3IgLSBUaGUgaXRlcmF0aW9uIGNhbGxiYWNrLlxuICAgICAqIEBkZXByZWNhdGVkIC0gV2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHJlbGVhc2UuIFVzZSBmb3IgYXdhaXQuLi5vZiBpbnN0ZWFkLlxuICAgICAqL1xuICAgIGFzeW5jIGZvckVhY2goaXRlcmF0b3IpIHtcbiAgICAgICAgdGhpcy5zaWduYWw/LnRocm93SWZBYm9ydGVkKCk7XG4gICAgICAgIGlmICh0eXBlb2YgaXRlcmF0b3IgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0FyZ3VtZW50IFwiaXRlcmF0b3JcIiBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGRvY3VtZW50IG9mIHRoaXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGl0ZXJhdG9yKGRvY3VtZW50KTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogRnJlZXMgYW55IGNsaWVudC1zaWRlIHJlc291cmNlcyB1c2VkIGJ5IHRoZSBjdXJzb3IuXG4gICAgICovXG4gICAgYXN5bmMgY2xvc2Uob3B0aW9ucykge1xuICAgICAgICBhd2FpdCB0aGlzLmNsZWFudXAob3B0aW9ucz8udGltZW91dE1TKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBkb2N1bWVudHMuIFRoZSBjYWxsZXIgaXMgcmVzcG9uc2libGUgZm9yIG1ha2luZyBzdXJlIHRoYXQgdGhlcmVcbiAgICAgKiBpcyBlbm91Z2ggbWVtb3J5IHRvIHN0b3JlIHRoZSByZXN1bHRzLiBOb3RlIHRoYXQgdGhlIGFycmF5IG9ubHkgY29udGFpbnMgcGFydGlhbFxuICAgICAqIHJlc3VsdHMgd2hlbiB0aGlzIGN1cnNvciBoYWQgYmVlbiBwcmV2aW91c2x5IGFjY2Vzc2VkLiBJbiB0aGF0IGNhc2UsXG4gICAgICogY3Vyc29yLnJld2luZCgpIGNhbiBiZSB1c2VkIHRvIHJlc2V0IHRoZSBjdXJzb3IuXG4gICAgICovXG4gICAgYXN5bmMgdG9BcnJheSgpIHtcbiAgICAgICAgdGhpcy5zaWduYWw/LnRocm93SWZBYm9ydGVkKCk7XG4gICAgICAgIGNvbnN0IGFycmF5ID0gW107XG4gICAgICAgIC8vIGF0IHRoZSBlbmQgb2YgdGhlIGxvb3AgKHNpbmNlIHJlYWRCdWZmZXJlZERvY3VtZW50cyBpcyBjYWxsZWQpIHRoZSBidWZmZXIgd2lsbCBiZSBlbXB0eVxuICAgICAgICAvLyB0aGVuLCB0aGUgJ2F3YWl0IG9mJyBzeW50YXggd2lsbCBydW4gYSBnZXRNb3JlIGNhbGxcbiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBkb2N1bWVudCBvZiB0aGlzKSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKGRvY3VtZW50KTtcbiAgICAgICAgICAgIGNvbnN0IGRvY3MgPSB0aGlzLnJlYWRCdWZmZXJlZERvY3VtZW50cygpO1xuICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNmb3JtICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRvYyBvZiBkb2NzKSB7XG4gICAgICAgICAgICAgICAgICAgIGFycmF5LnB1c2goYXdhaXQgdGhpcy50cmFuc2Zvcm1Eb2N1bWVudChkb2MpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcnJheS5wdXNoKC4uLmRvY3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcnJheTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGEgY3Vyc29yIGZsYWcgdG8gdGhlIGN1cnNvclxuICAgICAqXG4gICAgICogQHBhcmFtIGZsYWcgLSBUaGUgZmxhZyB0byBzZXQsIG11c3QgYmUgb25lIG9mIGZvbGxvd2luZyBbJ3RhaWxhYmxlJywgJ29wbG9nUmVwbGF5JywgJ25vQ3Vyc29yVGltZW91dCcsICdhd2FpdERhdGEnLCAncGFydGlhbCcgLS5cbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgZmxhZyBib29sZWFuIHZhbHVlLlxuICAgICAqL1xuICAgIGFkZEN1cnNvckZsYWcoZmxhZywgdmFsdWUpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgaWYgKCFleHBvcnRzLkNVUlNPUl9GTEFHUy5pbmNsdWRlcyhmbGFnKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgRmxhZyAke2ZsYWd9IGlzIG5vdCBvbmUgb2YgJHtleHBvcnRzLkNVUlNPUl9GTEFHU31gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEZsYWcgJHtmbGFnfSBtdXN0IGJlIGEgYm9vbGVhbiB2YWx1ZWApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3Vyc29yT3B0aW9uc1tmbGFnXSA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFwIGFsbCBkb2N1bWVudHMgdXNpbmcgdGhlIHByb3ZpZGVkIGZ1bmN0aW9uXG4gICAgICogSWYgdGhlcmUgaXMgYSB0cmFuc2Zvcm0gc2V0IG9uIHRoZSBjdXJzb3IsIHRoYXQgd2lsbCBiZSBjYWxsZWQgZmlyc3QgYW5kIHRoZSByZXN1bHQgcGFzc2VkIHRvXG4gICAgICogdGhpcyBmdW5jdGlvbidzIHRyYW5zZm9ybS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICpcbiAgICAgKiAqKk5vdGUqKiBDdXJzb3JzIHVzZSBgbnVsbGAgaW50ZXJuYWxseSB0byBpbmRpY2F0ZSB0aGF0IHRoZXJlIGFyZSBubyBtb3JlIGRvY3VtZW50cyBpbiB0aGUgY3Vyc29yLiBQcm92aWRpbmcgYSBtYXBwaW5nXG4gICAgICogZnVuY3Rpb24gdGhhdCBtYXBzIHZhbHVlcyB0byBgbnVsbGAgd2lsbCByZXN1bHQgaW4gdGhlIGN1cnNvciBjbG9zaW5nIGl0c2VsZiBiZWZvcmUgaXQgaGFzIGZpbmlzaGVkIGl0ZXJhdGluZ1xuICAgICAqIGFsbCBkb2N1bWVudHMuICBUaGlzIHdpbGwgKipub3QqKiByZXN1bHQgaW4gYSBtZW1vcnkgbGVhaywganVzdCBzdXJwcmlzaW5nIGJlaGF2aW9yLiAgRm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgY3Vyc29yID0gY29sbGVjdGlvbi5maW5kKHt9KTtcbiAgICAgKiBjdXJzb3IubWFwKCgpID0+IG51bGwpO1xuICAgICAqXG4gICAgICogY29uc3QgZG9jdW1lbnRzID0gYXdhaXQgY3Vyc29yLnRvQXJyYXkoKTtcbiAgICAgKiAvLyBkb2N1bWVudHMgaXMgYWx3YXlzIFtdLCByZWdhcmRsZXNzIG9mIGhvdyBtYW55IGRvY3VtZW50cyBhcmUgaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBPdGhlciBmYWxzZXkgdmFsdWVzIGFyZSBhbGxvd2VkOlxuICAgICAqXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IGN1cnNvciA9IGNvbGxlY3Rpb24uZmluZCh7fSk7XG4gICAgICogY3Vyc29yLm1hcCgoKSA9PiAnJyk7XG4gICAgICpcbiAgICAgKiBjb25zdCBkb2N1bWVudHMgPSBhd2FpdCBjdXJzb3IudG9BcnJheSgpO1xuICAgICAqIC8vIGRvY3VtZW50cyBpcyBub3cgYW4gYXJyYXkgb2YgZW1wdHkgc3RyaW5nc1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogKipOb3RlIGZvciBUeXBlc2NyaXB0IFVzZXJzOioqIGFkZGluZyBhIHRyYW5zZm9ybSBjaGFuZ2VzIHRoZSByZXR1cm4gdHlwZSBvZiB0aGUgaXRlcmF0aW9uIG9mIHRoaXMgY3Vyc29yLFxuICAgICAqIGl0ICoqZG9lcyBub3QqKiByZXR1cm4gYSBuZXcgaW5zdGFuY2Ugb2YgYSBjdXJzb3IuIFRoaXMgbWVhbnMgd2hlbiBjYWxsaW5nIG1hcCxcbiAgICAgKiB5b3Ugc2hvdWxkIGFsd2F5cyBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIG5ldyB2YXJpYWJsZSBpbiBvcmRlciB0byBnZXQgYSBjb3JyZWN0bHkgdHlwZWQgY3Vyc29yIHZhcmlhYmxlLlxuICAgICAqIFRha2Ugbm90ZSBvZiB0aGUgZm9sbG93aW5nIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCBjdXJzb3I6IEZpbmRDdXJzb3I8RG9jdW1lbnQ+ID0gY29sbC5maW5kKCk7XG4gICAgICogY29uc3QgbWFwcGVkQ3Vyc29yOiBGaW5kQ3Vyc29yPG51bWJlcj4gPSBjdXJzb3IubWFwKGRvYyA9PiBPYmplY3Qua2V5cyhkb2MpLmxlbmd0aCk7XG4gICAgICogY29uc3Qga2V5Q291bnRzOiBudW1iZXJbXSA9IGF3YWl0IG1hcHBlZEN1cnNvci50b0FycmF5KCk7IC8vIGN1cnNvci50b0FycmF5KCkgc3RpbGwgcmV0dXJucyBEb2N1bWVudFtdXG4gICAgICogYGBgXG4gICAgICogQHBhcmFtIHRyYW5zZm9ybSAtIFRoZSBtYXBwaW5nIHRyYW5zZm9ybWF0aW9uIG1ldGhvZC5cbiAgICAgKi9cbiAgICBtYXAodHJhbnNmb3JtKSB7XG4gICAgICAgIHRoaXMudGhyb3dJZkluaXRpYWxpemVkKCk7XG4gICAgICAgIGNvbnN0IG9sZFRyYW5zZm9ybSA9IHRoaXMudHJhbnNmb3JtO1xuICAgICAgICBpZiAob2xkVHJhbnNmb3JtKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybSA9IGRvYyA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybShvbGRUcmFuc2Zvcm0oZG9jKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgUmVhZFByZWZlcmVuY2UgZm9yIHRoZSBjdXJzb3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgbmV3IHJlYWQgcHJlZmVyZW5jZSBmb3IgdGhlIGN1cnNvci5cbiAgICAgKi9cbiAgICB3aXRoUmVhZFByZWZlcmVuY2UocmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgaWYgKHJlYWRQcmVmZXJlbmNlIGluc3RhbmNlb2YgcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy5yZWFkUHJlZmVyZW5jZSA9IHJlYWRQcmVmZXJlbmNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiByZWFkUHJlZmVyZW5jZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy5yZWFkUHJlZmVyZW5jZSA9IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLmZyb21TdHJpbmcocmVhZFByZWZlcmVuY2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgSW52YWxpZCByZWFkIHByZWZlcmVuY2U6ICR7cmVhZFByZWZlcmVuY2V9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgUmVhZFByZWZlcmVuY2UgZm9yIHRoZSBjdXJzb3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgbmV3IHJlYWQgcHJlZmVyZW5jZSBmb3IgdGhlIGN1cnNvci5cbiAgICAgKi9cbiAgICB3aXRoUmVhZENvbmNlcm4ocmVhZENvbmNlcm4pIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgY29uc3QgcmVzb2x2ZWRSZWFkQ29uY2VybiA9IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKHsgcmVhZENvbmNlcm4gfSk7XG4gICAgICAgIGlmIChyZXNvbHZlZFJlYWRDb25jZXJuKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMucmVhZENvbmNlcm4gPSByZXNvbHZlZFJlYWRDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgYSBtYXhUaW1lTVMgb24gdGhlIGN1cnNvciBxdWVyeSwgYWxsb3dpbmcgZm9yIGhhcmQgdGltZW91dCBsaW1pdHMgb24gcXVlcmllcyAoT25seSBzdXBwb3J0ZWQgb24gTW9uZ29EQiAyLjYgb3IgaGlnaGVyKVxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBhYm9ydGluZyB0aGUgcXVlcnkuXG4gICAgICovXG4gICAgbWF4VGltZU1TKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudGhyb3dJZkluaXRpYWxpemVkKCk7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBmb3IgbWF4VGltZU1TIG11c3QgYmUgYSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmN1cnNvck9wdGlvbnMubWF4VGltZU1TID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGJhdGNoIHNpemUgZm9yIHRoZSBjdXJzb3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgbnVtYmVyIG9mIGRvY3VtZW50cyB0byByZXR1cm4gcGVyIGJhdGNoLiBTZWUge0BsaW5rIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9jb21tYW5kL2ZpbmQvfGZpbmQgY29tbWFuZCBkb2N1bWVudGF0aW9ufS5cbiAgICAgKi9cbiAgICBiYXRjaFNpemUodmFsdWUpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuY3Vyc29yT3B0aW9ucy50YWlsYWJsZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yKCdUYWlsYWJsZSBjdXJzb3IgZG9lcyBub3Qgc3VwcG9ydCBiYXRjaFNpemUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3BlcmF0aW9uIFwiYmF0Y2hTaXplXCIgcmVxdWlyZXMgYW4gaW50ZWdlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy5iYXRjaFNpemUgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJld2luZCB0aGlzIGN1cnNvciB0byBpdHMgdW5pbml0aWFsaXplZCBzdGF0ZS4gQW55IG9wdGlvbnMgdGhhdCBhcmUgcHJlc2VudCBvbiB0aGUgY3Vyc29yIHdpbGxcbiAgICAgKiByZW1haW4gaW4gZWZmZWN0LiBJdGVyYXRpbmcgdGhpcyBjdXJzb3Igd2lsbCBjYXVzZSBuZXcgcXVlcmllcyB0byBiZSBzZW50IHRvIHRoZSBzZXJ2ZXIsIGV2ZW5cbiAgICAgKiBpZiB0aGUgcmVzdWx0YW50IGRhdGEgaGFzIGFscmVhZHkgYmVlbiByZXRyaWV2ZWQgYnkgdGhpcyBjdXJzb3IuXG4gICAgICovXG4gICAgcmV3aW5kKCkge1xuICAgICAgICBpZiAodGhpcy50aW1lb3V0Q29udGV4dCAmJiB0aGlzLnRpbWVvdXRDb250ZXh0Lm93bmVyICE9PSB0aGlzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBDYW5ub3QgcmV3aW5kIGN1cnNvciB0aGF0IGRvZXMgbm90IG93biBpdHMgdGltZW91dCBjb250ZXh0LmApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3Vyc29ySWQgPSBudWxsO1xuICAgICAgICB0aGlzLmRvY3VtZW50cz8uY2xlYXIoKTtcbiAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dD8uY2xlYXIoKTtcbiAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0Nsb3NlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzS2lsbGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oYXNFbWl0dGVkQ2xvc2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50cmFja0N1cnNvcigpO1xuICAgICAgICAvLyBXZSBvbmx5IHdhbnQgdG8gZW5kIHRoaXMgc2Vzc2lvbiBpZiB3ZSBjcmVhdGVkIGl0LCBhbmQgaXQgaGFzbid0IGVuZGVkIHlldFxuICAgICAgICBpZiAodGhpcy5jdXJzb3JTZXNzaW9uLmV4cGxpY2l0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmN1cnNvclNlc3Npb24uaGFzRW5kZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnNvclNlc3Npb24uZW5kU2Vzc2lvbigpLnRoZW4odW5kZWZpbmVkLCB1dGlsc18xLnNxdWFzaEVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY3Vyc29yU2Vzc2lvbiA9IHRoaXMuY3Vyc29yQ2xpZW50LnN0YXJ0U2Vzc2lvbih7IG93bmVyOiB0aGlzLCBleHBsaWNpdDogZmFsc2UgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIGdldE1vcmUoYmF0Y2hTaXplKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnNvcklkID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdVbmV4cGVjdGVkIG51bGwgY3Vyc29yIGlkLiBBIGN1cnNvciBjcmVhdGluZyBjb21tYW5kIHNob3VsZCBoYXZlIHNldCB0aGlzJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRTZXJ2ZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1VuZXhwZWN0ZWQgbnVsbCBzZWxlY3RlZFNlcnZlci4gQSBjdXJzb3IgY3JlYXRpbmcgY29tbWFuZCBzaG91bGQgaGF2ZSBzZXQgdGhpcycpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdldE1vcmVPcHRpb25zID0ge1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgc2Vzc2lvbjogdGhpcy5jdXJzb3JTZXNzaW9uLFxuICAgICAgICAgICAgYmF0Y2hTaXplXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGdldE1vcmVPcGVyYXRpb24gPSBuZXcgZ2V0X21vcmVfMS5HZXRNb3JlT3BlcmF0aW9uKHRoaXMuY3Vyc29yTmFtZXNwYWNlLCB0aGlzLmN1cnNvcklkLCB0aGlzLnNlbGVjdGVkU2VydmVyLCBnZXRNb3JlT3B0aW9ucyk7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmN1cnNvckNsaWVudCwgZ2V0TW9yZU9wZXJhdGlvbiwgdGhpcy50aW1lb3V0Q29udGV4dCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBleHBvc2VkIGZvciB0aGUgdW5pZmllZCB0ZXN0IHJ1bm5lcidzIGNyZWF0ZUNoYW5nZVN0cmVhbVxuICAgICAqIG9wZXJhdGlvbi4gIFdlIGNhbm5vdCByZWZhY3RvciB0byB1c2UgdGhlIGFic3RyYWN0IF9pbml0aWFsaXplIG1ldGhvZCB3aXRob3V0XG4gICAgICogYSBzaWduaWZpY2FudCByZWZhY3Rvci5cbiAgICAgKi9cbiAgICBhc3luYyBjdXJzb3JJbml0KCkge1xuICAgICAgICBpZiAodGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNUyAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0ID8/PSBuZXcgQ3Vyc29yVGltZW91dENvbnRleHQodGltZW91dF8xLlRpbWVvdXRDb250ZXh0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiB0aGlzLmNsaWVudC5zLm9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRNUzogdGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNU1xuICAgICAgICAgICAgfSksIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IHRoaXMuX2luaXRpYWxpemUodGhpcy5jdXJzb3JTZXNzaW9uKTtcbiAgICAgICAgICAgIC8vIFNldCBvbWl0TWF4VGltZU1TIHRvIHRoZSB2YWx1ZSBuZWVkZWQgZm9yIHN1YnNlcXVlbnQgZ2V0TW9yZSBjYWxsc1xuICAgICAgICAgICAgdGhpcy5jdXJzb3JPcHRpb25zLm9taXRNYXhUaW1lTVMgPSB0aGlzLmN1cnNvck9wdGlvbnMudGltZW91dE1TICE9IG51bGw7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHN0YXRlLnJlc3BvbnNlO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNlcnZlciA9IHN0YXRlLnNlcnZlcjtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29ySWQgPSByZXNwb25zZS5pZDtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yTmFtZXNwYWNlID0gcmVzcG9uc2UubnMgPz8gdGhpcy5uYW1lc3BhY2U7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50cyA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7IC8vIHRoZSBjdXJzb3IgaXMgbm93IGluaXRpYWxpemVkLCBldmVuIGlmIGl0IGlzIGRlYWRcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIHRoZSBjdXJzb3IgaXMgbm93IGluaXRpYWxpemVkLCBldmVuIGlmIGFuIGVycm9yIG9jY3VycmVkXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCh1bmRlZmluZWQsIGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsIEF0dGVtcHQgdG8gb2J0YWluIG1vcmUgZG9jdW1lbnRzICovXG4gICAgYXN5bmMgZmV0Y2hCYXRjaCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZSBjdXJzb3IgaXMgZGVhZCwgd2UgY2xlYW4gaXQgdXBcbiAgICAgICAgICAgIC8vIGNsZWFudXBDdXJzb3Igc2hvdWxkIG5ldmVyIHRocm93LCBidXQgaWYgaXQgZG9lcyBpdCBpbmRpY2F0ZXMgYSBidWcgaW4gdGhlIGRyaXZlclxuICAgICAgICAgICAgLy8gYW5kIHdlIHNob3VsZCBzdXJmYWNlIHRoZSBlcnJvclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3Vyc29ySWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jdXJzb3JJbml0KCk7XG4gICAgICAgICAgICAvLyBJZiB0aGUgY3Vyc29yIGRpZWQgb3IgcmV0dXJuZWQgZG9jdW1lbnRzLCByZXR1cm5cbiAgICAgICAgICAgIGlmICgodGhpcy5kb2N1bWVudHM/Lmxlbmd0aCA/PyAwKSAhPT0gMCB8fCB0aGlzLmlzRGVhZClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UsIHJ1biBhIGdldE1vcmVcbiAgICAgICAgfVxuICAgICAgICAvLyBvdGhlcndpc2UgbmVlZCB0byBjYWxsIGdldE1vcmVcbiAgICAgICAgY29uc3QgYmF0Y2hTaXplID0gdGhpcy5jdXJzb3JPcHRpb25zLmJhdGNoU2l6ZSB8fCAxMDAwO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdldE1vcmUoYmF0Y2hTaXplKTtcbiAgICAgICAgICAgIHRoaXMuY3Vyc29ySWQgPSByZXNwb25zZS5pZDtcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRzID0gcmVzcG9uc2U7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCh1bmRlZmluZWQsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAvLyBgY2xlYW51cEN1cnNvcmAgc2hvdWxkIG5ldmVyIHRocm93LCBzcXVhc2ggYW5kIHRocm93IHRoZSBvcmlnaW5hbCBlcnJvclxuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShjbGVhbnVwRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNEZWFkKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSBzdWNjZXNzZnVsbHkgcmVjZWl2ZWQgYSByZXNwb25zZSBmcm9tIGEgY3Vyc29yIEJVVCB0aGUgY3Vyc29yIGluZGljYXRlcyB0aGF0IGl0IGlzIGV4aGF1c3RlZCxcbiAgICAgICAgICAgIC8vIHdlIGludGVudGlvbmFsbHkgY2xlYW4gdXAgdGhlIGN1cnNvciB0byByZWxlYXNlIGl0cyBzZXNzaW9uIGJhY2sgaW50byB0aGUgcG9vbCBiZWZvcmUgdGhlIGN1cnNvclxuICAgICAgICAgICAgLy8gaXMgaXRlcmF0ZWQuICBUaGlzIHByZXZlbnRzIGEgY3Vyc29yIHRoYXQgaXMgZXhoYXVzdGVkIG9uIHRoZSBzZXJ2ZXIgZnJvbSBob2xkaW5nXG4gICAgICAgICAgICAvLyBvbnRvIGEgc2Vzc2lvbiBpbmRlZmluaXRlbHkgdW50aWwgdGhlIEFic3RyYWN0Q3Vyc29yIGlzIGl0ZXJhdGVkLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIGNsZWFudXBDdXJzb3JBc3luYyBzaG91bGQgbmV2ZXIgdGhyb3csIGJ1dCBpZiBpdCBkb2VzIGl0IGluZGljYXRlcyBhIGJ1ZyBpbiB0aGUgZHJpdmVyXG4gICAgICAgICAgICAvLyBhbmQgd2Ugc2hvdWxkIHN1cmZhY2UgdGhlIGVycm9yXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNsZWFudXAoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYXN5bmMgY2xlYW51cCh0aW1lb3V0TVMsIGVycm9yKSB7XG4gICAgICAgIHRoaXMuYWJvcnRMaXN0ZW5lcj8uW3V0aWxzXzEua0Rpc3Bvc2VdKCk7XG4gICAgICAgIHRoaXMuaXNDbG9zZWQgPSB0cnVlO1xuICAgICAgICBjb25zdCB0aW1lb3V0Q29udGV4dEZvcktpbGxDdXJzb3JzID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRpbWVvdXRNUyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dD8uY2xlYXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvclRpbWVvdXRDb250ZXh0KHRpbWVvdXRfMS5UaW1lb3V0Q29udGV4dC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IHRoaXMuY2xpZW50LnMub3B0aW9ucy5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXRNU1xuICAgICAgICAgICAgICAgIH0pLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpbWVvdXRDb250ZXh0Py5yZWZyZXNoZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0tpbGxlZCAmJlxuICAgICAgICAgICAgICAgIHRoaXMuY3Vyc29ySWQgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5jdXJzb3JJZC5pc1plcm8oKSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuY3Vyc29yTmFtZXNwYWNlICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNlcnZlciAmJlxuICAgICAgICAgICAgICAgICF0aGlzLmN1cnNvclNlc3Npb24uaGFzRW5kZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzS2lsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJzb3JJZCA9IHRoaXMuY3Vyc29ySWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJzb3JJZCA9IGJzb25fMS5Mb25nLlpFUk87XG4gICAgICAgICAgICAgICAgYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jdXJzb3JDbGllbnQsIG5ldyBraWxsX2N1cnNvcnNfMS5LaWxsQ3Vyc29yc09wZXJhdGlvbihjdXJzb3JJZCwgdGhpcy5jdXJzb3JOYW1lc3BhY2UsIHRoaXMuc2VsZWN0ZWRTZXJ2ZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbjogdGhpcy5jdXJzb3JTZXNzaW9uXG4gICAgICAgICAgICAgICAgfSksIHRpbWVvdXRDb250ZXh0Rm9yS2lsbEN1cnNvcnMoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAoMCwgdXRpbHNfMS5zcXVhc2hFcnJvcikoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJzb3JTZXNzaW9uPy5vd25lciA9PT0gdGhpcykge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmN1cnNvclNlc3Npb24uZW5kU2Vzc2lvbih7IGVycm9yIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3Vyc29yU2Vzc2lvbj8uaW5UcmFuc2FjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgICAgICgwLCBzZXNzaW9uc18xLm1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKSh0aGlzLmN1cnNvclNlc3Npb24sIHsgZXJyb3IgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0Q2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZW1pdENsb3NlKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0VtaXR0ZWRDbG9zZSAmJiAoKHRoaXMuZG9jdW1lbnRzPy5sZW5ndGggPz8gMCkgPT09IDAgfHwgdGhpcy5pc0Nsb3NlZCkpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yOiBDdXJzb3JFdmVudHMgaXMgZ2VuZXJpYyBzbyBQYXJhbWV0ZXJzPEN1cnNvckV2ZW50c1tcImNsb3NlXCJdPiBtYXkgbm90IGJlIGFzc2lnbmFibGUgdG8gYFtdYC4gTm90IHN1cmUgaG93IHRvIHJlcXVpcmUgZXh0ZW5kZXJzIGRvIG5vdCBhZGQgcGFyYW1ldGVycy5cbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2Nsb3NlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLmhhc0VtaXR0ZWRDbG9zZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIHRyYW5zZm9ybURvY3VtZW50KGRvY3VtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLnRyYW5zZm9ybSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWREb2N1bWVudCA9IHRoaXMudHJhbnNmb3JtKGRvY3VtZW50KTtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybWVkRG9jdW1lbnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBUUkFOU0ZPUk1fVE9fTlVMTF9FUlJPUiA9ICdDdXJzb3IgcmV0dXJuZWQgYSBgbnVsbGAgZG9jdW1lbnQsIGJ1dCB0aGUgY3Vyc29yIGlzIG5vdCBleGhhdXN0ZWQuICBNYXBwaW5nIGRvY3VtZW50cyB0byBgbnVsbGAgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGUgY3Vyc29yIHRyYW5zZm9ybS4nO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoVFJBTlNGT1JNX1RPX05VTExfRVJST1IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkRG9jdW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKHRyYW5zZm9ybUVycm9yKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChjbG9zZUVycm9yKSB7XG4gICAgICAgICAgICAgICAgKDAsIHV0aWxzXzEuc3F1YXNoRXJyb3IpKGNsb3NlRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgdHJhbnNmb3JtRXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHRocm93SWZJbml0aWFsaXplZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0N1cnNvckluVXNlRXJyb3IoKTtcbiAgICB9XG59XG5leHBvcnRzLkFic3RyYWN0Q3Vyc29yID0gQWJzdHJhY3RDdXJzb3I7XG4vKiogQGV2ZW50ICovXG5BYnN0cmFjdEN1cnNvci5DTE9TRSA9ICdjbG9zZSc7XG5jbGFzcyBSZWFkYWJsZUN1cnNvclN0cmVhbSBleHRlbmRzIHN0cmVhbV8xLlJlYWRhYmxlIHtcbiAgICBjb25zdHJ1Y3RvcihjdXJzb3IpIHtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAgb2JqZWN0TW9kZTogdHJ1ZSxcbiAgICAgICAgICAgIGF1dG9EZXN0cm95OiBmYWxzZSxcbiAgICAgICAgICAgIGhpZ2hXYXRlck1hcms6IDFcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3JlYWRJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICAgIF9yZWFkKHNpemUpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yZWFkSW5Qcm9ncmVzcykge1xuICAgICAgICAgICAgdGhpcy5fcmVhZEluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fcmVhZE5leHQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZGVzdHJveShlcnJvciwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fY3Vyc29yLmNsb3NlKCkudGhlbigoKSA9PiBjYWxsYmFjayhlcnJvciksIGNsb3NlRXJyb3IgPT4gY2FsbGJhY2soY2xvc2VFcnJvcikpO1xuICAgIH1cbiAgICBfcmVhZE5leHQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jdXJzb3IuaWQgPT09IGJzb25fMS5Mb25nLlpFUk8pIHtcbiAgICAgICAgICAgIHRoaXMucHVzaChudWxsKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdXJzb3JcbiAgICAgICAgICAgIC5uZXh0KClcbiAgICAgICAgICAgIC50aGVuKFxuICAgICAgICAvLyByZXN1bHQgZnJvbSBuZXh0KClcbiAgICAgICAgcmVzdWx0ID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMucHVzaChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZGVzdHJveWVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3Vyc29yLmNsb3NlKCkudGhlbih1bmRlZmluZWQsIHV0aWxzXzEuc3F1YXNoRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHVzaChyZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkTmV4dCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9yZWFkSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBcbiAgICAgICAgLy8gZXJyb3IgZnJvbSBuZXh0KClcbiAgICAgICAgZXJyID0+IHtcbiAgICAgICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgcXVlc3Rpb25hYmxlLCBidXQgd2UgaGF2ZSBhIHRlc3QgYmFja2luZyB0aGUgYmVoYXZpb3IuIEl0IHNlZW1zIHRoZVxuICAgICAgICAgICAgLy8gICAgICAgZGVzaXJlZCBiZWhhdmlvciBpcyB0aGF0IGEgc3RyZWFtIGVuZHMgY2xlYW5seSB3aGVuIGEgdXNlciBleHBsaWNpdGx5IGNsb3Nlc1xuICAgICAgICAgICAgLy8gICAgICAgYSBjbGllbnQgZHVyaW5nIGl0ZXJhdGlvbi4gQWx0ZXJuYXRpdmVseSwgd2UgY291bGQgZG8gdGhlIFwicmlnaHRcIiB0aGluZyBhbmRcbiAgICAgICAgICAgIC8vICAgICAgIHByb3BhZ2F0ZSB0aGUgZXJyb3IgbWVzc2FnZSBieSByZW1vdmluZyB0aGlzIHNwZWNpYWwgY2FzZS5cbiAgICAgICAgICAgIGlmIChlcnIubWVzc2FnZS5tYXRjaCgvc2VydmVyIGlzIGNsb3NlZC8pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3Vyc29yLmNsb3NlKCkudGhlbih1bmRlZmluZWQsIHV0aWxzXzEuc3F1YXNoRXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2gobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBOT1RFOiBUaGlzIGlzIGFsc28gcGVyaGFwcyBxdWVzdGlvbmFibGUuIFRoZSByYXRpb25hbGUgaGVyZSBpcyB0aGF0IHRoZXNlIGVycm9ycyB0ZW5kXG4gICAgICAgICAgICAvLyAgICAgICB0byBiZSBcIm9wZXJhdGlvbiB3YXMgaW50ZXJydXB0ZWRcIiwgd2hlcmUgYSBjdXJzb3IgaGFzIGJlZW4gY2xvc2VkIGJ1dCB0aGVyZSBpcyBhblxuICAgICAgICAgICAgLy8gICAgICAgYWN0aXZlIGdldE1vcmUgaW4tZmxpZ2h0LiBUaGlzIHVzZWQgdG8gY2hlY2sgaWYgdGhlIGN1cnNvciB3YXMga2lsbGVkIGJ1dCBvbmNlXG4gICAgICAgICAgICAvLyAgICAgICB0aGF0IGNoYW5nZWQgdG8gaGFwcGVuIGluIGNsZWFudXAgbGVnaXRpbWF0ZSBlcnJvcnMgd291bGQgbm90IGRlc3Ryb3kgdGhlXG4gICAgICAgICAgICAvLyAgICAgICBzdHJlYW0uIFRoZXJlIGFyZSBjaGFuZ2Ugc3RyZWFtcyB0ZXN0IHNwZWNpZmljYWxseSB0ZXN0IHRoZXNlIGNhc2VzLlxuICAgICAgICAgICAgaWYgKGVyci5tZXNzYWdlLm1hdGNoKC9vcGVyYXRpb24gd2FzIGludGVycnVwdGVkLykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTk9URTogVGhlIHR3byBhYm92ZSBjaGVja3Mgb24gdGhlIG1lc3NhZ2Ugb2YgdGhlIGVycm9yIHdpbGwgY2F1c2UgYSBudWxsIHRvIGJlIHB1c2hlZFxuICAgICAgICAgICAgLy8gICAgICAgdG8gdGhlIHN0cmVhbSwgdGh1cyBjbG9zaW5nIHRoZSBzdHJlYW0gYmVmb3JlIHRoZSBkZXN0cm95IGNhbGwgaGFwcGVucy4gVGhpcyBtZWFuc1xuICAgICAgICAgICAgLy8gICAgICAgdGhhdCBlaXRoZXIgb2YgdGhvc2UgZXJyb3IgbWVzc2FnZXMgb24gYSBjaGFuZ2Ugc3RyZWFtIHdpbGwgbm90IGdldCBhIHByb3BlclxuICAgICAgICAgICAgLy8gICAgICAgJ2Vycm9yJyBldmVudCB0byBiZSBlbWl0dGVkICh0aGUgZXJyb3IgcGFzc2VkIHRvIGRlc3Ryb3kpLiBDaGFuZ2Ugc3RyZWFtIHJlc3VtYWJpbGl0eVxuICAgICAgICAgICAgLy8gICAgICAgcmVsaWVzIG9uIHRoYXQgZXJyb3IgZXZlbnQgdG8gYmUgZW1pdHRlZCB0byBjcmVhdGUgaXRzIG5ldyBjdXJzb3IgYW5kIHRodXMgd2FzIG5vdFxuICAgICAgICAgICAgLy8gICAgICAgd29ya2luZyBvbiA0LjQgc2VydmVycyBiZWNhdXNlIHRoZSBlcnJvciBlbWl0dGVkIG9uIGZhaWxvdmVyIHdhcyBcImludGVycnVwdGVkIGF0XG4gICAgICAgICAgICAvLyAgICAgICBzaHV0ZG93blwiIHdoaWxlIG9uIDUuMCsgaXQgaXMgXCJUaGUgc2VydmVyIGlzIGluIHF1aWVzY2UgbW9kZSBhbmQgd2lsbCBzaHV0IGRvd25cIi5cbiAgICAgICAgICAgIC8vICAgICAgIFNlZSBOT0RFLTQ0NzUuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZXN0cm95KGVycik7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAvLyBpZiBlaXRoZXIgb2YgdGhlIGFib3ZlIGhhbmRsZXJzIHRocm93XG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgdGhpcy5fcmVhZEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveShlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbigwLCByZXNvdXJjZV9tYW5hZ2VtZW50XzEuY29uZmlndXJlUmVzb3VyY2VNYW5hZ2VtZW50KShBYnN0cmFjdEN1cnNvci5wcm90b3R5cGUpO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIFRoZSBjdXJzb3IgdGltZW91dCBjb250ZXh0IGlzIGEgd3JhcHBlciBhcm91bmQgYSB0aW1lb3V0IGNvbnRleHRcbiAqIHRoYXQga2VlcHMgdHJhY2sgb2YgdGhlIFwib3duZXJcIiBvZiB0aGUgY3Vyc29yLiAgRm9yIHRpbWVvdXQgY29udGV4dHNcbiAqIGluc3RhbnRpYXRlZCBpbnNpZGUgYSBjdXJzb3IsIHRoZSBvd25lciB3aWxsIGJlIHRoZSBjdXJzb3IuXG4gKlxuICogQWxsIHRpbWVvdXQgYmVoYXZpb3IgaXMgZXhhY3RseSB0aGUgc2FtZSBhcyB0aGUgd3JhcHBlZCB0aW1lb3V0IGNvbnRleHQncy5cbiAqL1xuY2xhc3MgQ3Vyc29yVGltZW91dENvbnRleHQgZXh0ZW5kcyB0aW1lb3V0XzEuVGltZW91dENvbnRleHQge1xuICAgIGNvbnN0cnVjdG9yKHRpbWVvdXRDb250ZXh0LCBvd25lcikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0ID0gdGltZW91dENvbnRleHQ7XG4gICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcbiAgICB9XG4gICAgZ2V0IHNlcnZlclNlbGVjdGlvblRpbWVvdXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVvdXRDb250ZXh0LnNlcnZlclNlbGVjdGlvblRpbWVvdXQ7XG4gICAgfVxuICAgIGdldCBjb25uZWN0aW9uQ2hlY2tvdXRUaW1lb3V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lb3V0Q29udGV4dC5jb25uZWN0aW9uQ2hlY2tvdXRUaW1lb3V0O1xuICAgIH1cbiAgICBnZXQgY2xlYXJTZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lb3V0Q29udGV4dC5jbGVhclNlcnZlclNlbGVjdGlvblRpbWVvdXQ7XG4gICAgfVxuICAgIGdldCB0aW1lb3V0Rm9yU29ja2V0V3JpdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVvdXRDb250ZXh0LnRpbWVvdXRGb3JTb2NrZXRXcml0ZTtcbiAgICB9XG4gICAgZ2V0IHRpbWVvdXRGb3JTb2NrZXRSZWFkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lb3V0Q29udGV4dC50aW1lb3V0Rm9yU29ja2V0UmVhZDtcbiAgICB9XG4gICAgY3NvdEVuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVvdXRDb250ZXh0LmNzb3RFbmFibGVkKCk7XG4gICAgfVxuICAgIHJlZnJlc2goKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vd25lciAhPT0gJ3N5bWJvbCcpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aW1lb3V0Q29udGV4dC5yZWZyZXNoKCk7XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3duZXIgIT09ICdzeW1ib2wnKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGltZW91dENvbnRleHQuY2xlYXIoKTtcbiAgICB9XG4gICAgZ2V0IG1heFRpbWVNUygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZW91dENvbnRleHQubWF4VGltZU1TO1xuICAgIH1cbiAgICBnZXQgdGltZW91dE1TKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lb3V0Q29udGV4dC5jc290RW5hYmxlZCgpID8gdGhpcy50aW1lb3V0Q29udGV4dC50aW1lb3V0TVMgOiBudWxsO1xuICAgIH1cbiAgICByZWZyZXNoZWQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ3Vyc29yVGltZW91dENvbnRleHQodGhpcy50aW1lb3V0Q29udGV4dC5yZWZyZXNoZWQoKSwgdGhpcy5vd25lcik7XG4gICAgfVxuICAgIGFkZE1heFRpbWVNU1RvQ29tbWFuZChjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMudGltZW91dENvbnRleHQuYWRkTWF4VGltZU1TVG9Db21tYW5kKGNvbW1hbmQsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBnZXRTb2NrZXRUaW1lb3V0TVMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVvdXRDb250ZXh0LmdldFNvY2tldFRpbWVvdXRNUygpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ3Vyc29yVGltZW91dENvbnRleHQgPSBDdXJzb3JUaW1lb3V0Q29udGV4dDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFic3RyYWN0X2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AggregationCursor = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst explain_1 = __webpack_require__(/*! ../explain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\");\nconst aggregate_1 = __webpack_require__(/*! ../operations/aggregate */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/aggregate.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/**\n * The **AggregationCursor** class is an internal class that embodies an aggregation cursor on MongoDB\n * allowing for iteration over the results returned from the underlying query. It supports\n * one by one document iteration, conversion to an array or can be iterated as a Node 4.X\n * or higher stream\n * @public\n */\nclass AggregationCursor extends explain_1.ExplainableCursor {\n    /** @internal */\n    constructor(client, namespace, pipeline = [], options = {}) {\n        super(client, namespace, options);\n        this.pipeline = pipeline;\n        this.aggregateOptions = options;\n        const lastStage = this.pipeline[this.pipeline.length - 1];\n        if (this.cursorOptions.timeoutMS != null &&\n            this.cursorOptions.timeoutMode === abstract_cursor_1.CursorTimeoutMode.ITERATION &&\n            (lastStage?.$merge != null || lastStage?.$out != null))\n            throw new error_1.MongoAPIError('Cannot use $out or $merge stage with ITERATION timeoutMode');\n    }\n    clone() {\n        const clonedOptions = (0, utils_1.mergeOptions)({}, this.aggregateOptions);\n        delete clonedOptions.session;\n        return new AggregationCursor(this.client, this.namespace, this.pipeline, {\n            ...clonedOptions\n        });\n    }\n    map(transform) {\n        return super.map(transform);\n    }\n    /** @internal */\n    async _initialize(session) {\n        const options = {\n            ...this.aggregateOptions,\n            ...this.cursorOptions,\n            session,\n            signal: this.signal\n        };\n        if (options.explain) {\n            try {\n                (0, explain_1.validateExplainTimeoutOptions)(options, explain_1.Explain.fromOptions(options));\n            }\n            catch {\n                throw new error_1.MongoAPIError('timeoutMS cannot be used with explain when explain is specified in aggregateOptions');\n            }\n        }\n        const aggregateOperation = new aggregate_1.AggregateOperation(this.namespace, this.pipeline, options);\n        const response = await (0, execute_operation_1.executeOperation)(this.client, aggregateOperation, this.timeoutContext);\n        return { server: aggregateOperation.server, session, response };\n    }\n    async explain(verbosity, options) {\n        const { explain, timeout } = this.resolveExplainTimeoutOptions(verbosity, options);\n        return (await (0, execute_operation_1.executeOperation)(this.client, new aggregate_1.AggregateOperation(this.namespace, this.pipeline, {\n            ...this.aggregateOptions, // NOTE: order matters here, we may need to refine this\n            ...this.cursorOptions,\n            ...timeout,\n            explain: explain ?? true\n        }))).shift(this.deserializationOptions);\n    }\n    addStage(stage) {\n        this.throwIfInitialized();\n        if (this.cursorOptions.timeoutMS != null &&\n            this.cursorOptions.timeoutMode === abstract_cursor_1.CursorTimeoutMode.ITERATION &&\n            (stage.$out != null || stage.$merge != null)) {\n            throw new error_1.MongoAPIError('Cannot use $out or $merge stage with ITERATION timeoutMode');\n        }\n        this.pipeline.push(stage);\n        return this;\n    }\n    group($group) {\n        return this.addStage({ $group });\n    }\n    /** Add a limit stage to the aggregation pipeline */\n    limit($limit) {\n        return this.addStage({ $limit });\n    }\n    /** Add a match stage to the aggregation pipeline */\n    match($match) {\n        return this.addStage({ $match });\n    }\n    /** Add an out stage to the aggregation pipeline */\n    out($out) {\n        return this.addStage({ $out });\n    }\n    /**\n     * Add a project stage to the aggregation pipeline\n     *\n     * @remarks\n     * In order to strictly type this function you must provide an interface\n     * that represents the effect of your projection on the result documents.\n     *\n     * By default chaining a projection to your cursor changes the returned type to the generic {@link Document} type.\n     * You should specify a parameterized type to have assertions on your final results.\n     *\n     * @example\n     * ```typescript\n     * // Best way\n     * const docs: AggregationCursor<{ a: number }> = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * // Flexible way\n     * const docs: AggregationCursor<Document> = cursor.project({ _id: 0, a: true });\n     * ```\n     *\n     * @remarks\n     * In order to strictly type this function you must provide an interface\n     * that represents the effect of your projection on the result documents.\n     *\n     * **Note for Typescript Users:** adding a transform changes the return type of the iteration of this cursor,\n     * it **does not** return a new instance of a cursor. This means when calling project,\n     * you should always assign the result to a new variable in order to get a correctly typed cursor variable.\n     * Take note of the following example:\n     *\n     * @example\n     * ```typescript\n     * const cursor: AggregationCursor<{ a: number; b: string }> = coll.aggregate([]);\n     * const projectCursor = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * const aPropOnlyArray: {a: number}[] = await projectCursor.toArray();\n     *\n     * // or always use chaining and save the final cursor\n     *\n     * const cursor = coll.aggregate().project<{ a: string }>({\n     *   _id: 0,\n     *   a: { $convert: { input: '$a', to: 'string' }\n     * }});\n     * ```\n     */\n    project($project) {\n        return this.addStage({ $project });\n    }\n    /** Add a lookup stage to the aggregation pipeline */\n    lookup($lookup) {\n        return this.addStage({ $lookup });\n    }\n    /** Add a redact stage to the aggregation pipeline */\n    redact($redact) {\n        return this.addStage({ $redact });\n    }\n    /** Add a skip stage to the aggregation pipeline */\n    skip($skip) {\n        return this.addStage({ $skip });\n    }\n    /** Add a sort stage to the aggregation pipeline */\n    sort($sort) {\n        return this.addStage({ $sort });\n    }\n    /** Add a unwind stage to the aggregation pipeline */\n    unwind($unwind) {\n        return this.addStage({ $unwind });\n    }\n    /** Add a geoNear stage to the aggregation pipeline */\n    geoNear($geoNear) {\n        return this.addStage({ $geoNear });\n    }\n}\nexports.AggregationCursor = AggregationCursor;\n//# sourceMappingURL=aggregation_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9hZ2dyZWdhdGlvbl9jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QseUJBQXlCO0FBQ3pCLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlHQUFZO0FBQ3RDLG9CQUFvQixtQkFBTyxDQUFDLDJIQUF5QjtBQUNyRCw0QkFBNEIsbUJBQU8sQ0FBQywySUFBaUM7QUFDckUsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsMEJBQTBCLG1CQUFPLENBQUMsdUhBQW1CO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGdCQUFnQixtQkFBbUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsTUFBTTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUdBQWlHLGdCQUFnQjtBQUNqSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLFdBQVcscUJBQXFCLFdBQVcsSUFBSSxpQkFBaUI7QUFDdkc7QUFDQSxrRUFBa0UsaUJBQWlCO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLFdBQVcsV0FBVztBQUMvRCw4Q0FBOEMsV0FBVyxJQUFJLGlCQUFpQjtBQUM5RSw4QkFBOEIsVUFBVTtBQUN4QztBQUNBO0FBQ0E7QUFDQSxpREFBaUQsV0FBVztBQUM1RDtBQUNBLGNBQWMsWUFBWTtBQUMxQixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFVBQVU7QUFDekM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFNBQVM7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFNBQVM7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLE9BQU87QUFDdEM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLE9BQU87QUFDdEM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFNBQVM7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFVBQVU7QUFDekM7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9hZ2dyZWdhdGlvbl9jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkFnZ3JlZ2F0aW9uQ3Vyc29yID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGV4cGxhaW5fMSA9IHJlcXVpcmUoXCIuLi9leHBsYWluXCIpO1xuY29uc3QgYWdncmVnYXRlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9hZ2dyZWdhdGVcIik7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgYWJzdHJhY3RfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9hYnN0cmFjdF9jdXJzb3JcIik7XG4vKipcbiAqIFRoZSAqKkFnZ3JlZ2F0aW9uQ3Vyc29yKiogY2xhc3MgaXMgYW4gaW50ZXJuYWwgY2xhc3MgdGhhdCBlbWJvZGllcyBhbiBhZ2dyZWdhdGlvbiBjdXJzb3Igb24gTW9uZ29EQlxuICogYWxsb3dpbmcgZm9yIGl0ZXJhdGlvbiBvdmVyIHRoZSByZXN1bHRzIHJldHVybmVkIGZyb20gdGhlIHVuZGVybHlpbmcgcXVlcnkuIEl0IHN1cHBvcnRzXG4gKiBvbmUgYnkgb25lIGRvY3VtZW50IGl0ZXJhdGlvbiwgY29udmVyc2lvbiB0byBhbiBhcnJheSBvciBjYW4gYmUgaXRlcmF0ZWQgYXMgYSBOb2RlIDQuWFxuICogb3IgaGlnaGVyIHN0cmVhbVxuICogQHB1YmxpY1xuICovXG5jbGFzcyBBZ2dyZWdhdGlvbkN1cnNvciBleHRlbmRzIGV4cGxhaW5fMS5FeHBsYWluYWJsZUN1cnNvciB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKGNsaWVudCwgbmFtZXNwYWNlLCBwaXBlbGluZSA9IFtdLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoY2xpZW50LCBuYW1lc3BhY2UsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBpcGVsaW5lID0gcGlwZWxpbmU7XG4gICAgICAgIHRoaXMuYWdncmVnYXRlT3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIGNvbnN0IGxhc3RTdGFnZSA9IHRoaXMucGlwZWxpbmVbdGhpcy5waXBlbGluZS5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKHRoaXMuY3Vyc29yT3B0aW9ucy50aW1lb3V0TVMgIT0gbnVsbCAmJlxuICAgICAgICAgICAgdGhpcy5jdXJzb3JPcHRpb25zLnRpbWVvdXRNb2RlID09PSBhYnN0cmFjdF9jdXJzb3JfMS5DdXJzb3JUaW1lb3V0TW9kZS5JVEVSQVRJT04gJiZcbiAgICAgICAgICAgIChsYXN0U3RhZ2U/LiRtZXJnZSAhPSBudWxsIHx8IGxhc3RTdGFnZT8uJG91dCAhPSBudWxsKSlcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0Nhbm5vdCB1c2UgJG91dCBvciAkbWVyZ2Ugc3RhZ2Ugd2l0aCBJVEVSQVRJT04gdGltZW91dE1vZGUnKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IGNsb25lZE9wdGlvbnMgPSAoMCwgdXRpbHNfMS5tZXJnZU9wdGlvbnMpKHt9LCB0aGlzLmFnZ3JlZ2F0ZU9wdGlvbnMpO1xuICAgICAgICBkZWxldGUgY2xvbmVkT3B0aW9ucy5zZXNzaW9uO1xuICAgICAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0aW9uQ3Vyc29yKHRoaXMuY2xpZW50LCB0aGlzLm5hbWVzcGFjZSwgdGhpcy5waXBlbGluZSwge1xuICAgICAgICAgICAgLi4uY2xvbmVkT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbWFwKHRyYW5zZm9ybSkge1xuICAgICAgICByZXR1cm4gc3VwZXIubWFwKHRyYW5zZm9ybSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBfaW5pdGlhbGl6ZShzZXNzaW9uKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAuLi50aGlzLmFnZ3JlZ2F0ZU9wdGlvbnMsXG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgc2lnbmFsOiB0aGlzLnNpZ25hbFxuICAgICAgICB9O1xuICAgICAgICBpZiAob3B0aW9ucy5leHBsYWluKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICgwLCBleHBsYWluXzEudmFsaWRhdGVFeHBsYWluVGltZW91dE9wdGlvbnMpKG9wdGlvbnMsIGV4cGxhaW5fMS5FeHBsYWluLmZyb21PcHRpb25zKG9wdGlvbnMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCd0aW1lb3V0TVMgY2Fubm90IGJlIHVzZWQgd2l0aCBleHBsYWluIHdoZW4gZXhwbGFpbiBpcyBzcGVjaWZpZWQgaW4gYWdncmVnYXRlT3B0aW9ucycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFnZ3JlZ2F0ZU9wZXJhdGlvbiA9IG5ldyBhZ2dyZWdhdGVfMS5BZ2dyZWdhdGVPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXMucGlwZWxpbmUsIG9wdGlvbnMpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBhZ2dyZWdhdGVPcGVyYXRpb24sIHRoaXMudGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4geyBzZXJ2ZXI6IGFnZ3JlZ2F0ZU9wZXJhdGlvbi5zZXJ2ZXIsIHNlc3Npb24sIHJlc3BvbnNlIH07XG4gICAgfVxuICAgIGFzeW5jIGV4cGxhaW4odmVyYm9zaXR5LCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHsgZXhwbGFpbiwgdGltZW91dCB9ID0gdGhpcy5yZXNvbHZlRXhwbGFpblRpbWVvdXRPcHRpb25zKHZlcmJvc2l0eSwgb3B0aW9ucyk7XG4gICAgICAgIHJldHVybiAoYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBhZ2dyZWdhdGVfMS5BZ2dyZWdhdGVPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXMucGlwZWxpbmUsIHtcbiAgICAgICAgICAgIC4uLnRoaXMuYWdncmVnYXRlT3B0aW9ucywgLy8gTk9URTogb3JkZXIgbWF0dGVycyBoZXJlLCB3ZSBtYXkgbmVlZCB0byByZWZpbmUgdGhpc1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgLi4udGltZW91dCxcbiAgICAgICAgICAgIGV4cGxhaW46IGV4cGxhaW4gPz8gdHJ1ZVxuICAgICAgICB9KSkpLnNoaWZ0KHRoaXMuZGVzZXJpYWxpemF0aW9uT3B0aW9ucyk7XG4gICAgfVxuICAgIGFkZFN0YWdlKHN0YWdlKSB7XG4gICAgICAgIHRoaXMudGhyb3dJZkluaXRpYWxpemVkKCk7XG4gICAgICAgIGlmICh0aGlzLmN1cnNvck9wdGlvbnMudGltZW91dE1TICE9IG51bGwgJiZcbiAgICAgICAgICAgIHRoaXMuY3Vyc29yT3B0aW9ucy50aW1lb3V0TW9kZSA9PT0gYWJzdHJhY3RfY3Vyc29yXzEuQ3Vyc29yVGltZW91dE1vZGUuSVRFUkFUSU9OICYmXG4gICAgICAgICAgICAoc3RhZ2UuJG91dCAhPSBudWxsIHx8IHN0YWdlLiRtZXJnZSAhPSBudWxsKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignQ2Fubm90IHVzZSAkb3V0IG9yICRtZXJnZSBzdGFnZSB3aXRoIElURVJBVElPTiB0aW1lb3V0TW9kZScpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGlwZWxpbmUucHVzaChzdGFnZSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBncm91cCgkZ3JvdXApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkZ3JvdXAgfSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBsaW1pdCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmUgKi9cbiAgICBsaW1pdCgkbGltaXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkbGltaXQgfSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBtYXRjaCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmUgKi9cbiAgICBtYXRjaCgkbWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkbWF0Y2ggfSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYW4gb3V0IHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIG91dCgkb3V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZFN0YWdlKHsgJG91dCB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGEgcHJvamVjdCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmVcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogSW4gb3JkZXIgdG8gc3RyaWN0bHkgdHlwZSB0aGlzIGZ1bmN0aW9uIHlvdSBtdXN0IHByb3ZpZGUgYW4gaW50ZXJmYWNlXG4gICAgICogdGhhdCByZXByZXNlbnRzIHRoZSBlZmZlY3Qgb2YgeW91ciBwcm9qZWN0aW9uIG9uIHRoZSByZXN1bHQgZG9jdW1lbnRzLlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCBjaGFpbmluZyBhIHByb2plY3Rpb24gdG8geW91ciBjdXJzb3IgY2hhbmdlcyB0aGUgcmV0dXJuZWQgdHlwZSB0byB0aGUgZ2VuZXJpYyB7QGxpbmsgRG9jdW1lbnR9IHR5cGUuXG4gICAgICogWW91IHNob3VsZCBzcGVjaWZ5IGEgcGFyYW1ldGVyaXplZCB0eXBlIHRvIGhhdmUgYXNzZXJ0aW9ucyBvbiB5b3VyIGZpbmFsIHJlc3VsdHMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiAvLyBCZXN0IHdheVxuICAgICAqIGNvbnN0IGRvY3M6IEFnZ3JlZ2F0aW9uQ3Vyc29yPHsgYTogbnVtYmVyIH0+ID0gY3Vyc29yLnByb2plY3Q8eyBhOiBudW1iZXIgfT4oeyBfaWQ6IDAsIGE6IHRydWUgfSk7XG4gICAgICogLy8gRmxleGlibGUgd2F5XG4gICAgICogY29uc3QgZG9jczogQWdncmVnYXRpb25DdXJzb3I8RG9jdW1lbnQ+ID0gY3Vyc29yLnByb2plY3QoeyBfaWQ6IDAsIGE6IHRydWUgfSk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIEluIG9yZGVyIHRvIHN0cmljdGx5IHR5cGUgdGhpcyBmdW5jdGlvbiB5b3UgbXVzdCBwcm92aWRlIGFuIGludGVyZmFjZVxuICAgICAqIHRoYXQgcmVwcmVzZW50cyB0aGUgZWZmZWN0IG9mIHlvdXIgcHJvamVjdGlvbiBvbiB0aGUgcmVzdWx0IGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqICoqTm90ZSBmb3IgVHlwZXNjcmlwdCBVc2VyczoqKiBhZGRpbmcgYSB0cmFuc2Zvcm0gY2hhbmdlcyB0aGUgcmV0dXJuIHR5cGUgb2YgdGhlIGl0ZXJhdGlvbiBvZiB0aGlzIGN1cnNvcixcbiAgICAgKiBpdCAqKmRvZXMgbm90KiogcmV0dXJuIGEgbmV3IGluc3RhbmNlIG9mIGEgY3Vyc29yLiBUaGlzIG1lYW5zIHdoZW4gY2FsbGluZyBwcm9qZWN0LFxuICAgICAqIHlvdSBzaG91bGQgYWx3YXlzIGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgbmV3IHZhcmlhYmxlIGluIG9yZGVyIHRvIGdldCBhIGNvcnJlY3RseSB0eXBlZCBjdXJzb3IgdmFyaWFibGUuXG4gICAgICogVGFrZSBub3RlIG9mIHRoZSBmb2xsb3dpbmcgZXhhbXBsZTpcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IGN1cnNvcjogQWdncmVnYXRpb25DdXJzb3I8eyBhOiBudW1iZXI7IGI6IHN0cmluZyB9PiA9IGNvbGwuYWdncmVnYXRlKFtdKTtcbiAgICAgKiBjb25zdCBwcm9qZWN0Q3Vyc29yID0gY3Vyc29yLnByb2plY3Q8eyBhOiBudW1iZXIgfT4oeyBfaWQ6IDAsIGE6IHRydWUgfSk7XG4gICAgICogY29uc3QgYVByb3BPbmx5QXJyYXk6IHthOiBudW1iZXJ9W10gPSBhd2FpdCBwcm9qZWN0Q3Vyc29yLnRvQXJyYXkoKTtcbiAgICAgKlxuICAgICAqIC8vIG9yIGFsd2F5cyB1c2UgY2hhaW5pbmcgYW5kIHNhdmUgdGhlIGZpbmFsIGN1cnNvclxuICAgICAqXG4gICAgICogY29uc3QgY3Vyc29yID0gY29sbC5hZ2dyZWdhdGUoKS5wcm9qZWN0PHsgYTogc3RyaW5nIH0+KHtcbiAgICAgKiAgIF9pZDogMCxcbiAgICAgKiAgIGE6IHsgJGNvbnZlcnQ6IHsgaW5wdXQ6ICckYScsIHRvOiAnc3RyaW5nJyB9XG4gICAgICogfX0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHByb2plY3QoJHByb2plY3QpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkcHJvamVjdCB9KTtcbiAgICB9XG4gICAgLyoqIEFkZCBhIGxvb2t1cCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmUgKi9cbiAgICBsb29rdXAoJGxvb2t1cCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRTdGFnZSh7ICRsb29rdXAgfSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSByZWRhY3Qgc3RhZ2UgdG8gdGhlIGFnZ3JlZ2F0aW9uIHBpcGVsaW5lICovXG4gICAgcmVkYWN0KCRyZWRhY3QpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkcmVkYWN0IH0pO1xuICAgIH1cbiAgICAvKiogQWRkIGEgc2tpcCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmUgKi9cbiAgICBza2lwKCRza2lwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZFN0YWdlKHsgJHNraXAgfSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBzb3J0IHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIHNvcnQoJHNvcnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkc29ydCB9KTtcbiAgICB9XG4gICAgLyoqIEFkZCBhIHVud2luZCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmUgKi9cbiAgICB1bndpbmQoJHVud2luZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRTdGFnZSh7ICR1bndpbmQgfSk7XG4gICAgfVxuICAgIC8qKiBBZGQgYSBnZW9OZWFyIHN0YWdlIHRvIHRoZSBhZ2dyZWdhdGlvbiBwaXBlbGluZSAqL1xuICAgIGdlb05lYXIoJGdlb05lYXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkU3RhZ2UoeyAkZ2VvTmVhciB9KTtcbiAgICB9XG59XG5leHBvcnRzLkFnZ3JlZ2F0aW9uQ3Vyc29yID0gQWdncmVnYXRpb25DdXJzb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZ2dyZWdhdGlvbl9jdXJzb3IuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/change_stream_cursor.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/change_stream_cursor.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ChangeStreamCursor = void 0;\nconst change_stream_1 = __webpack_require__(/*! ../change_stream */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst aggregate_1 = __webpack_require__(/*! ../operations/aggregate */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/aggregate.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @internal */\nclass ChangeStreamCursor extends abstract_cursor_1.AbstractCursor {\n    constructor(client, namespace, pipeline = [], options = {}) {\n        super(client, namespace, { ...options, tailable: true, awaitData: true });\n        this.pipeline = pipeline;\n        this.changeStreamCursorOptions = options;\n        this._resumeToken = null;\n        this.startAtOperationTime = options.startAtOperationTime ?? null;\n        if (options.startAfter) {\n            this.resumeToken = options.startAfter;\n        }\n        else if (options.resumeAfter) {\n            this.resumeToken = options.resumeAfter;\n        }\n    }\n    set resumeToken(token) {\n        this._resumeToken = token;\n        this.emit(change_stream_1.ChangeStream.RESUME_TOKEN_CHANGED, token);\n    }\n    get resumeToken() {\n        return this._resumeToken;\n    }\n    get resumeOptions() {\n        const options = {\n            ...this.changeStreamCursorOptions\n        };\n        for (const key of ['resumeAfter', 'startAfter', 'startAtOperationTime']) {\n            delete options[key];\n        }\n        if (this.resumeToken != null) {\n            if (this.changeStreamCursorOptions.startAfter && !this.hasReceived) {\n                options.startAfter = this.resumeToken;\n            }\n            else {\n                options.resumeAfter = this.resumeToken;\n            }\n        }\n        else if (this.startAtOperationTime != null && (0, utils_1.maxWireVersion)(this.server) >= 7) {\n            options.startAtOperationTime = this.startAtOperationTime;\n        }\n        return options;\n    }\n    cacheResumeToken(resumeToken) {\n        if (this.bufferedCount() === 0 && this.postBatchResumeToken) {\n            this.resumeToken = this.postBatchResumeToken;\n        }\n        else {\n            this.resumeToken = resumeToken;\n        }\n        this.hasReceived = true;\n    }\n    _processBatch(response) {\n        const { postBatchResumeToken } = response;\n        if (postBatchResumeToken) {\n            this.postBatchResumeToken = postBatchResumeToken;\n            if (response.batchSize === 0) {\n                this.resumeToken = postBatchResumeToken;\n            }\n        }\n    }\n    clone() {\n        return new ChangeStreamCursor(this.client, this.namespace, this.pipeline, {\n            ...this.cursorOptions\n        });\n    }\n    async _initialize(session) {\n        const aggregateOperation = new aggregate_1.AggregateOperation(this.namespace, this.pipeline, {\n            ...this.cursorOptions,\n            ...this.changeStreamCursorOptions,\n            session\n        });\n        const response = await (0, execute_operation_1.executeOperation)(session.client, aggregateOperation, this.timeoutContext);\n        const server = aggregateOperation.server;\n        this.maxWireVersion = (0, utils_1.maxWireVersion)(server);\n        if (this.startAtOperationTime == null &&\n            this.changeStreamCursorOptions.resumeAfter == null &&\n            this.changeStreamCursorOptions.startAfter == null &&\n            this.maxWireVersion >= 7) {\n            this.startAtOperationTime = response.operationTime;\n        }\n        this._processBatch(response);\n        this.emit(constants_1.INIT, response);\n        this.emit(constants_1.RESPONSE);\n        return { server, session, response };\n    }\n    async getMore(batchSize) {\n        const response = await super.getMore(batchSize);\n        this.maxWireVersion = (0, utils_1.maxWireVersion)(this.server);\n        this._processBatch(response);\n        this.emit(change_stream_1.ChangeStream.MORE, response);\n        this.emit(change_stream_1.ChangeStream.RESPONSE);\n        return response;\n    }\n}\nexports.ChangeStreamCursor = ChangeStreamCursor;\n//# sourceMappingURL=change_stream_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9jaGFuZ2Vfc3RyZWFtX2N1cnNvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEI7QUFDMUIsd0JBQXdCLG1CQUFPLENBQUMsNkdBQWtCO0FBQ2xELG9CQUFvQixtQkFBTyxDQUFDLHFHQUFjO0FBQzFDLG9CQUFvQixtQkFBTyxDQUFDLDJIQUF5QjtBQUNyRCw0QkFBNEIsbUJBQU8sQ0FBQywySUFBaUM7QUFDckUsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsMEJBQTBCLG1CQUFPLENBQUMsdUhBQW1CO0FBQ3JEO0FBQ0E7QUFDQSw4REFBOEQ7QUFDOUQsbUNBQW1DLDZDQUE2QztBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsdUJBQXVCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvY2hhbmdlX3N0cmVhbV9jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNoYW5nZVN0cmVhbUN1cnNvciA9IHZvaWQgMDtcbmNvbnN0IGNoYW5nZV9zdHJlYW1fMSA9IHJlcXVpcmUoXCIuLi9jaGFuZ2Vfc3RyZWFtXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuY29uc3QgYWdncmVnYXRlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9hZ2dyZWdhdGVcIik7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgYWJzdHJhY3RfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9hYnN0cmFjdF9jdXJzb3JcIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDaGFuZ2VTdHJlYW1DdXJzb3IgZXh0ZW5kcyBhYnN0cmFjdF9jdXJzb3JfMS5BYnN0cmFjdEN1cnNvciB7XG4gICAgY29uc3RydWN0b3IoY2xpZW50LCBuYW1lc3BhY2UsIHBpcGVsaW5lID0gW10sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihjbGllbnQsIG5hbWVzcGFjZSwgeyAuLi5vcHRpb25zLCB0YWlsYWJsZTogdHJ1ZSwgYXdhaXREYXRhOiB0cnVlIH0pO1xuICAgICAgICB0aGlzLnBpcGVsaW5lID0gcGlwZWxpbmU7XG4gICAgICAgIHRoaXMuY2hhbmdlU3RyZWFtQ3Vyc29yT3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuX3Jlc3VtZVRva2VuID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdGFydEF0T3BlcmF0aW9uVGltZSA9IG9wdGlvbnMuc3RhcnRBdE9wZXJhdGlvblRpbWUgPz8gbnVsbDtcbiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnRBZnRlcikge1xuICAgICAgICAgICAgdGhpcy5yZXN1bWVUb2tlbiA9IG9wdGlvbnMuc3RhcnRBZnRlcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvcHRpb25zLnJlc3VtZUFmdGVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZVRva2VuID0gb3B0aW9ucy5yZXN1bWVBZnRlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXQgcmVzdW1lVG9rZW4odG9rZW4pIHtcbiAgICAgICAgdGhpcy5fcmVzdW1lVG9rZW4gPSB0b2tlbjtcbiAgICAgICAgdGhpcy5lbWl0KGNoYW5nZV9zdHJlYW1fMS5DaGFuZ2VTdHJlYW0uUkVTVU1FX1RPS0VOX0NIQU5HRUQsIHRva2VuKTtcbiAgICB9XG4gICAgZ2V0IHJlc3VtZVRva2VuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVzdW1lVG9rZW47XG4gICAgfVxuICAgIGdldCByZXN1bWVPcHRpb25zKCkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgLi4udGhpcy5jaGFuZ2VTdHJlYW1DdXJzb3JPcHRpb25zXG4gICAgICAgIH07XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIFsncmVzdW1lQWZ0ZXInLCAnc3RhcnRBZnRlcicsICdzdGFydEF0T3BlcmF0aW9uVGltZSddKSB7XG4gICAgICAgICAgICBkZWxldGUgb3B0aW9uc1trZXldO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlc3VtZVRva2VuICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYW5nZVN0cmVhbUN1cnNvck9wdGlvbnMuc3RhcnRBZnRlciAmJiAhdGhpcy5oYXNSZWNlaXZlZCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuc3RhcnRBZnRlciA9IHRoaXMucmVzdW1lVG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnJlc3VtZUFmdGVyID0gdGhpcy5yZXN1bWVUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXJ0QXRPcGVyYXRpb25UaW1lICE9IG51bGwgJiYgKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHRoaXMuc2VydmVyKSA+PSA3KSB7XG4gICAgICAgICAgICBvcHRpb25zLnN0YXJ0QXRPcGVyYXRpb25UaW1lID0gdGhpcy5zdGFydEF0T3BlcmF0aW9uVGltZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9XG4gICAgY2FjaGVSZXN1bWVUb2tlbihyZXN1bWVUb2tlbikge1xuICAgICAgICBpZiAodGhpcy5idWZmZXJlZENvdW50KCkgPT09IDAgJiYgdGhpcy5wb3N0QmF0Y2hSZXN1bWVUb2tlbikge1xuICAgICAgICAgICAgdGhpcy5yZXN1bWVUb2tlbiA9IHRoaXMucG9zdEJhdGNoUmVzdW1lVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZVRva2VuID0gcmVzdW1lVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oYXNSZWNlaXZlZCA9IHRydWU7XG4gICAgfVxuICAgIF9wcm9jZXNzQmF0Y2gocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc3QgeyBwb3N0QmF0Y2hSZXN1bWVUb2tlbiB9ID0gcmVzcG9uc2U7XG4gICAgICAgIGlmIChwb3N0QmF0Y2hSZXN1bWVUb2tlbikge1xuICAgICAgICAgICAgdGhpcy5wb3N0QmF0Y2hSZXN1bWVUb2tlbiA9IHBvc3RCYXRjaFJlc3VtZVRva2VuO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmJhdGNoU2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzdW1lVG9rZW4gPSBwb3N0QmF0Y2hSZXN1bWVUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDaGFuZ2VTdHJlYW1DdXJzb3IodGhpcy5jbGllbnQsIHRoaXMubmFtZXNwYWNlLCB0aGlzLnBpcGVsaW5lLCB7XG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIF9pbml0aWFsaXplKHNlc3Npb24pIHtcbiAgICAgICAgY29uc3QgYWdncmVnYXRlT3BlcmF0aW9uID0gbmV3IGFnZ3JlZ2F0ZV8xLkFnZ3JlZ2F0ZU9wZXJhdGlvbih0aGlzLm5hbWVzcGFjZSwgdGhpcy5waXBlbGluZSwge1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgLi4udGhpcy5jaGFuZ2VTdHJlYW1DdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgc2Vzc2lvblxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKShzZXNzaW9uLmNsaWVudCwgYWdncmVnYXRlT3BlcmF0aW9uLCB0aGlzLnRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgY29uc3Qgc2VydmVyID0gYWdncmVnYXRlT3BlcmF0aW9uLnNlcnZlcjtcbiAgICAgICAgdGhpcy5tYXhXaXJlVmVyc2lvbiA9ICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShzZXJ2ZXIpO1xuICAgICAgICBpZiAodGhpcy5zdGFydEF0T3BlcmF0aW9uVGltZSA9PSBudWxsICYmXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVN0cmVhbUN1cnNvck9wdGlvbnMucmVzdW1lQWZ0ZXIgPT0gbnVsbCAmJlxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VTdHJlYW1DdXJzb3JPcHRpb25zLnN0YXJ0QWZ0ZXIgPT0gbnVsbCAmJlxuICAgICAgICAgICAgdGhpcy5tYXhXaXJlVmVyc2lvbiA+PSA3KSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0QXRPcGVyYXRpb25UaW1lID0gcmVzcG9uc2Uub3BlcmF0aW9uVGltZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9wcm9jZXNzQmF0Y2gocmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmVtaXQoY29uc3RhbnRzXzEuSU5JVCwgcmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmVtaXQoY29uc3RhbnRzXzEuUkVTUE9OU0UpO1xuICAgICAgICByZXR1cm4geyBzZXJ2ZXIsIHNlc3Npb24sIHJlc3BvbnNlIH07XG4gICAgfVxuICAgIGFzeW5jIGdldE1vcmUoYmF0Y2hTaXplKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3VwZXIuZ2V0TW9yZShiYXRjaFNpemUpO1xuICAgICAgICB0aGlzLm1heFdpcmVWZXJzaW9uID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHRoaXMuc2VydmVyKTtcbiAgICAgICAgdGhpcy5fcHJvY2Vzc0JhdGNoKHJlc3BvbnNlKTtcbiAgICAgICAgdGhpcy5lbWl0KGNoYW5nZV9zdHJlYW1fMS5DaGFuZ2VTdHJlYW0uTU9SRSwgcmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmVtaXQoY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbS5SRVNQT05TRSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG59XG5leHBvcnRzLkNoYW5nZVN0cmVhbUN1cnNvciA9IENoYW5nZVN0cmVhbUN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNoYW5nZV9zdHJlYW1fY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/change_stream_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/client_bulk_write_cursor.js":
/*!*******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/client_bulk_write_cursor.js ***!
  \*******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ClientBulkWriteCursor = void 0;\nconst client_bulk_write_1 = __webpack_require__(/*! ../operations/client_bulk_write/client_bulk_write */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/client_bulk_write.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/**\n * This is the cursor that handles client bulk write operations. Note this is never\n * exposed directly to the user and is always immediately exhausted.\n * @internal\n */\nclass ClientBulkWriteCursor extends abstract_cursor_1.AbstractCursor {\n    /** @internal */\n    constructor(client, commandBuilder, options = {}) {\n        super(client, new utils_1.MongoDBNamespace('admin', '$cmd'), options);\n        this.commandBuilder = commandBuilder;\n        this.clientBulkWriteOptions = options;\n    }\n    /**\n     * We need a way to get the top level cursor response fields for\n     * generating the bulk write result, so we expose this here.\n     */\n    get response() {\n        if (this.cursorResponse)\n            return this.cursorResponse;\n        return null;\n    }\n    get operations() {\n        return this.commandBuilder.lastOperations;\n    }\n    clone() {\n        const clonedOptions = (0, utils_1.mergeOptions)({}, this.clientBulkWriteOptions);\n        delete clonedOptions.session;\n        return new ClientBulkWriteCursor(this.client, this.commandBuilder, {\n            ...clonedOptions\n        });\n    }\n    /** @internal */\n    async _initialize(session) {\n        const clientBulkWriteOperation = new client_bulk_write_1.ClientBulkWriteOperation(this.commandBuilder, {\n            ...this.clientBulkWriteOptions,\n            ...this.cursorOptions,\n            session\n        });\n        const response = await (0, execute_operation_1.executeOperation)(this.client, clientBulkWriteOperation, this.timeoutContext);\n        this.cursorResponse = response;\n        return { server: clientBulkWriteOperation.server, session, response };\n    }\n}\nexports.ClientBulkWriteCursor = ClientBulkWriteCursor;\n//# sourceMappingURL=client_bulk_write_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9jbGllbnRfYnVsa193cml0ZV9jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNkJBQTZCO0FBQzdCLDRCQUE0QixtQkFBTyxDQUFDLCtLQUFtRDtBQUN2Riw0QkFBNEIsbUJBQU8sQ0FBQywySUFBaUM7QUFDckUsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsMEJBQTBCLG1CQUFPLENBQUMsdUhBQW1CO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9EO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQ7QUFDMUQ7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9jbGllbnRfYnVsa193cml0ZV9jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNsaWVudEJ1bGtXcml0ZUN1cnNvciA9IHZvaWQgMDtcbmNvbnN0IGNsaWVudF9idWxrX3dyaXRlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9jbGllbnRfYnVsa193cml0ZS9jbGllbnRfYnVsa193cml0ZVwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBhYnN0cmFjdF9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2Fic3RyYWN0X2N1cnNvclwiKTtcbi8qKlxuICogVGhpcyBpcyB0aGUgY3Vyc29yIHRoYXQgaGFuZGxlcyBjbGllbnQgYnVsayB3cml0ZSBvcGVyYXRpb25zLiBOb3RlIHRoaXMgaXMgbmV2ZXJcbiAqIGV4cG9zZWQgZGlyZWN0bHkgdG8gdGhlIHVzZXIgYW5kIGlzIGFsd2F5cyBpbW1lZGlhdGVseSBleGhhdXN0ZWQuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ2xpZW50QnVsa1dyaXRlQ3Vyc29yIGV4dGVuZHMgYWJzdHJhY3RfY3Vyc29yXzEuQWJzdHJhY3RDdXJzb3Ige1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIGNvbW1hbmRCdWlsZGVyLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoY2xpZW50LCBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKCdhZG1pbicsICckY21kJyksIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmNvbW1hbmRCdWlsZGVyID0gY29tbWFuZEJ1aWxkZXI7XG4gICAgICAgIHRoaXMuY2xpZW50QnVsa1dyaXRlT3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdlIG5lZWQgYSB3YXkgdG8gZ2V0IHRoZSB0b3AgbGV2ZWwgY3Vyc29yIHJlc3BvbnNlIGZpZWxkcyBmb3JcbiAgICAgKiBnZW5lcmF0aW5nIHRoZSBidWxrIHdyaXRlIHJlc3VsdCwgc28gd2UgZXhwb3NlIHRoaXMgaGVyZS5cbiAgICAgKi9cbiAgICBnZXQgcmVzcG9uc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnNvclJlc3BvbnNlKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3Vyc29yUmVzcG9uc2U7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBnZXQgb3BlcmF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZEJ1aWxkZXIubGFzdE9wZXJhdGlvbnM7XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICBjb25zdCBjbG9uZWRPcHRpb25zID0gKDAsIHV0aWxzXzEubWVyZ2VPcHRpb25zKSh7fSwgdGhpcy5jbGllbnRCdWxrV3JpdGVPcHRpb25zKTtcbiAgICAgICAgZGVsZXRlIGNsb25lZE9wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRCdWxrV3JpdGVDdXJzb3IodGhpcy5jbGllbnQsIHRoaXMuY29tbWFuZEJ1aWxkZXIsIHtcbiAgICAgICAgICAgIC4uLmNsb25lZE9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBfaW5pdGlhbGl6ZShzZXNzaW9uKSB7XG4gICAgICAgIGNvbnN0IGNsaWVudEJ1bGtXcml0ZU9wZXJhdGlvbiA9IG5ldyBjbGllbnRfYnVsa193cml0ZV8xLkNsaWVudEJ1bGtXcml0ZU9wZXJhdGlvbih0aGlzLmNvbW1hbmRCdWlsZGVyLCB7XG4gICAgICAgICAgICAuLi50aGlzLmNsaWVudEJ1bGtXcml0ZU9wdGlvbnMsXG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICBzZXNzaW9uXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBjbGllbnRCdWxrV3JpdGVPcGVyYXRpb24sIHRoaXMudGltZW91dENvbnRleHQpO1xuICAgICAgICB0aGlzLmN1cnNvclJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICAgIHJldHVybiB7IHNlcnZlcjogY2xpZW50QnVsa1dyaXRlT3BlcmF0aW9uLnNlcnZlciwgc2Vzc2lvbiwgcmVzcG9uc2UgfTtcbiAgICB9XG59XG5leHBvcnRzLkNsaWVudEJ1bGtXcml0ZUN1cnNvciA9IENsaWVudEJ1bGtXcml0ZUN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNsaWVudF9idWxrX3dyaXRlX2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/client_bulk_write_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/find_cursor.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/find_cursor.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FindCursor = exports.FLAGS = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst explain_1 = __webpack_require__(/*! ../explain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\");\nconst count_1 = __webpack_require__(/*! ../operations/count */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/count.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst find_1 = __webpack_require__(/*! ../operations/find */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find.js\");\nconst sort_1 = __webpack_require__(/*! ../sort */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sort.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/** @public Flags allowed for cursor */\nexports.FLAGS = [\n    'tailable',\n    'oplogReplay',\n    'noCursorTimeout',\n    'awaitData',\n    'exhaust',\n    'partial'\n];\n/** @public */\nclass FindCursor extends explain_1.ExplainableCursor {\n    /** @internal */\n    constructor(client, namespace, filter = {}, options = {}) {\n        super(client, namespace, options);\n        /** @internal */\n        this.numReturned = 0;\n        this.cursorFilter = filter;\n        this.findOptions = options;\n        if (options.sort != null) {\n            this.findOptions.sort = (0, sort_1.formatSort)(options.sort);\n        }\n    }\n    clone() {\n        const clonedOptions = (0, utils_1.mergeOptions)({}, this.findOptions);\n        delete clonedOptions.session;\n        return new FindCursor(this.client, this.namespace, this.cursorFilter, {\n            ...clonedOptions\n        });\n    }\n    map(transform) {\n        return super.map(transform);\n    }\n    /** @internal */\n    async _initialize(session) {\n        const options = {\n            ...this.findOptions, // NOTE: order matters here, we may need to refine this\n            ...this.cursorOptions,\n            session,\n            signal: this.signal\n        };\n        if (options.explain) {\n            try {\n                (0, explain_1.validateExplainTimeoutOptions)(options, explain_1.Explain.fromOptions(options));\n            }\n            catch {\n                throw new error_1.MongoAPIError('timeoutMS cannot be used with explain when explain is specified in findOptions');\n            }\n        }\n        const findOperation = new find_1.FindOperation(this.namespace, this.cursorFilter, options);\n        const response = await (0, execute_operation_1.executeOperation)(this.client, findOperation, this.timeoutContext);\n        // the response is not a cursor when `explain` is enabled\n        this.numReturned = response.batchSize;\n        return { server: findOperation.server, session, response };\n    }\n    /** @internal */\n    async getMore(batchSize) {\n        const numReturned = this.numReturned;\n        if (numReturned) {\n            // TODO(DRIVERS-1448): Remove logic to enforce `limit` in the driver\n            const limit = this.findOptions.limit;\n            batchSize =\n                limit && limit > 0 && numReturned + batchSize > limit ? limit - numReturned : batchSize;\n            if (batchSize <= 0) {\n                try {\n                    await this.close();\n                }\n                catch (error) {\n                    (0, utils_1.squashError)(error);\n                    // this is an optimization for the special case of a limit for a find command to avoid an\n                    // extra getMore when the limit has been reached and the limit is a multiple of the batchSize.\n                    // This is a consequence of the new query engine in 5.0 having no knowledge of the limit as it\n                    // produces results for the find command.  Once a batch is filled up, it is returned and only\n                    // on the subsequent getMore will the query framework consider the limit, determine the cursor\n                    // is exhausted and return a cursorId of zero.\n                    // instead, if we determine there are no more documents to request from the server, we preemptively\n                    // close the cursor\n                }\n                return responses_1.CursorResponse.emptyGetMore;\n            }\n        }\n        const response = await super.getMore(batchSize);\n        // TODO: wrap this in some logic to prevent it from happening if we don't need this support\n        this.numReturned = this.numReturned + response.batchSize;\n        return response;\n    }\n    /**\n     * Get the count of documents for this cursor\n     * @deprecated Use `collection.estimatedDocumentCount` or `collection.countDocuments` instead\n     */\n    async count(options) {\n        (0, utils_1.emitWarningOnce)('cursor.count is deprecated and will be removed in the next major version, please use `collection.estimatedDocumentCount` or `collection.countDocuments` instead ');\n        if (typeof options === 'boolean') {\n            throw new error_1.MongoInvalidArgumentError('Invalid first parameter to count');\n        }\n        return await (0, execute_operation_1.executeOperation)(this.client, new count_1.CountOperation(this.namespace, this.cursorFilter, {\n            ...this.findOptions, // NOTE: order matters here, we may need to refine this\n            ...this.cursorOptions,\n            ...options\n        }));\n    }\n    async explain(verbosity, options) {\n        const { explain, timeout } = this.resolveExplainTimeoutOptions(verbosity, options);\n        return (await (0, execute_operation_1.executeOperation)(this.client, new find_1.FindOperation(this.namespace, this.cursorFilter, {\n            ...this.findOptions, // NOTE: order matters here, we may need to refine this\n            ...this.cursorOptions,\n            ...timeout,\n            explain: explain ?? true\n        }))).shift(this.deserializationOptions);\n    }\n    /** Set the cursor query */\n    filter(filter) {\n        this.throwIfInitialized();\n        this.cursorFilter = filter;\n        return this;\n    }\n    /**\n     * Set the cursor hint\n     *\n     * @param hint - If specified, then the query system will only consider plans using the hinted index.\n     */\n    hint(hint) {\n        this.throwIfInitialized();\n        this.findOptions.hint = hint;\n        return this;\n    }\n    /**\n     * Set the cursor min\n     *\n     * @param min - Specify a $min value to specify the inclusive lower bound for a specific index in order to constrain the results of find(). The $min specifies the lower bound for all keys of a specific index in order.\n     */\n    min(min) {\n        this.throwIfInitialized();\n        this.findOptions.min = min;\n        return this;\n    }\n    /**\n     * Set the cursor max\n     *\n     * @param max - Specify a $max value to specify the exclusive upper bound for a specific index in order to constrain the results of find(). The $max specifies the upper bound for all keys of a specific index in order.\n     */\n    max(max) {\n        this.throwIfInitialized();\n        this.findOptions.max = max;\n        return this;\n    }\n    /**\n     * Set the cursor returnKey.\n     * If set to true, modifies the cursor to only return the index field or fields for the results of the query, rather than documents.\n     * If set to true and the query does not use an index to perform the read operation, the returned documents will not contain any fields.\n     *\n     * @param value - the returnKey value.\n     */\n    returnKey(value) {\n        this.throwIfInitialized();\n        this.findOptions.returnKey = value;\n        return this;\n    }\n    /**\n     * Modifies the output of a query by adding a field $recordId to matching documents. $recordId is the internal key which uniquely identifies a document in a collection.\n     *\n     * @param value - The $showDiskLoc option has now been deprecated and replaced with the showRecordId field. $showDiskLoc will still be accepted for OP_QUERY stye find.\n     */\n    showRecordId(value) {\n        this.throwIfInitialized();\n        this.findOptions.showRecordId = value;\n        return this;\n    }\n    /**\n     * Add a query modifier to the cursor query\n     *\n     * @param name - The query modifier (must start with $, such as $orderby etc)\n     * @param value - The modifier value.\n     */\n    addQueryModifier(name, value) {\n        this.throwIfInitialized();\n        if (name[0] !== '$') {\n            throw new error_1.MongoInvalidArgumentError(`${name} is not a valid query modifier`);\n        }\n        // Strip of the $\n        const field = name.substr(1);\n        // NOTE: consider some TS magic for this\n        switch (field) {\n            case 'comment':\n                this.findOptions.comment = value;\n                break;\n            case 'explain':\n                this.findOptions.explain = value;\n                break;\n            case 'hint':\n                this.findOptions.hint = value;\n                break;\n            case 'max':\n                this.findOptions.max = value;\n                break;\n            case 'maxTimeMS':\n                this.findOptions.maxTimeMS = value;\n                break;\n            case 'min':\n                this.findOptions.min = value;\n                break;\n            case 'orderby':\n                this.findOptions.sort = (0, sort_1.formatSort)(value);\n                break;\n            case 'query':\n                this.cursorFilter = value;\n                break;\n            case 'returnKey':\n                this.findOptions.returnKey = value;\n                break;\n            case 'showDiskLoc':\n                this.findOptions.showRecordId = value;\n                break;\n            default:\n                throw new error_1.MongoInvalidArgumentError(`Invalid query modifier: ${name}`);\n        }\n        return this;\n    }\n    /**\n     * Add a comment to the cursor query allowing for tracking the comment in the log.\n     *\n     * @param value - The comment attached to this query.\n     */\n    comment(value) {\n        this.throwIfInitialized();\n        this.findOptions.comment = value;\n        return this;\n    }\n    /**\n     * Set a maxAwaitTimeMS on a tailing cursor query to allow to customize the timeout value for the option awaitData (Only supported on MongoDB 3.2 or higher, ignored otherwise)\n     *\n     * @param value - Number of milliseconds to wait before aborting the tailed query.\n     */\n    maxAwaitTimeMS(value) {\n        this.throwIfInitialized();\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Argument for maxAwaitTimeMS must be a number');\n        }\n        this.findOptions.maxAwaitTimeMS = value;\n        return this;\n    }\n    /**\n     * Set a maxTimeMS on the cursor query, allowing for hard timeout limits on queries (Only supported on MongoDB 2.6 or higher)\n     *\n     * @param value - Number of milliseconds to wait before aborting the query.\n     */\n    maxTimeMS(value) {\n        this.throwIfInitialized();\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Argument for maxTimeMS must be a number');\n        }\n        this.findOptions.maxTimeMS = value;\n        return this;\n    }\n    /**\n     * Add a project stage to the aggregation pipeline\n     *\n     * @remarks\n     * In order to strictly type this function you must provide an interface\n     * that represents the effect of your projection on the result documents.\n     *\n     * By default chaining a projection to your cursor changes the returned type to the generic\n     * {@link Document} type.\n     * You should specify a parameterized type to have assertions on your final results.\n     *\n     * @example\n     * ```typescript\n     * // Best way\n     * const docs: FindCursor<{ a: number }> = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * // Flexible way\n     * const docs: FindCursor<Document> = cursor.project({ _id: 0, a: true });\n     * ```\n     *\n     * @remarks\n     *\n     * **Note for Typescript Users:** adding a transform changes the return type of the iteration of this cursor,\n     * it **does not** return a new instance of a cursor. This means when calling project,\n     * you should always assign the result to a new variable in order to get a correctly typed cursor variable.\n     * Take note of the following example:\n     *\n     * @example\n     * ```typescript\n     * const cursor: FindCursor<{ a: number; b: string }> = coll.find();\n     * const projectCursor = cursor.project<{ a: number }>({ _id: 0, a: true });\n     * const aPropOnlyArray: {a: number}[] = await projectCursor.toArray();\n     *\n     * // or always use chaining and save the final cursor\n     *\n     * const cursor = coll.find().project<{ a: string }>({\n     *   _id: 0,\n     *   a: { $convert: { input: '$a', to: 'string' }\n     * }});\n     * ```\n     */\n    project(value) {\n        this.throwIfInitialized();\n        this.findOptions.projection = value;\n        return this;\n    }\n    /**\n     * Sets the sort order of the cursor query.\n     *\n     * @param sort - The key or keys set for the sort.\n     * @param direction - The direction of the sorting (1 or -1).\n     */\n    sort(sort, direction) {\n        this.throwIfInitialized();\n        if (this.findOptions.tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support sorting');\n        }\n        this.findOptions.sort = (0, sort_1.formatSort)(sort, direction);\n        return this;\n    }\n    /**\n     * Allows disk use for blocking sort operations exceeding 100MB memory. (MongoDB 3.2 or higher)\n     *\n     * @remarks\n     * {@link https://www.mongodb.com/docs/manual/reference/command/find/#find-cmd-allowdiskuse | find command allowDiskUse documentation}\n     */\n    allowDiskUse(allow = true) {\n        this.throwIfInitialized();\n        if (!this.findOptions.sort) {\n            throw new error_1.MongoInvalidArgumentError('Option \"allowDiskUse\" requires a sort specification');\n        }\n        // As of 6.0 the default is true. This allows users to get back to the old behavior.\n        if (!allow) {\n            this.findOptions.allowDiskUse = false;\n            return this;\n        }\n        this.findOptions.allowDiskUse = true;\n        return this;\n    }\n    /**\n     * Set the collation options for the cursor.\n     *\n     * @param value - The cursor collation options (MongoDB 3.4 or higher) settings for update operation (see 3.4 documentation for available fields).\n     */\n    collation(value) {\n        this.throwIfInitialized();\n        this.findOptions.collation = value;\n        return this;\n    }\n    /**\n     * Set the limit for the cursor.\n     *\n     * @param value - The limit for the cursor query.\n     */\n    limit(value) {\n        this.throwIfInitialized();\n        if (this.findOptions.tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support limit');\n        }\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Operation \"limit\" requires an integer');\n        }\n        this.findOptions.limit = value;\n        return this;\n    }\n    /**\n     * Set the skip for the cursor.\n     *\n     * @param value - The skip for the cursor query.\n     */\n    skip(value) {\n        this.throwIfInitialized();\n        if (this.findOptions.tailable) {\n            throw new error_1.MongoTailableCursorError('Tailable cursor does not support skip');\n        }\n        if (typeof value !== 'number') {\n            throw new error_1.MongoInvalidArgumentError('Operation \"skip\" requires an integer');\n        }\n        this.findOptions.skip = value;\n        return this;\n    }\n}\nexports.FindCursor = FindCursor;\n//# sourceMappingURL=find_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9maW5kX2N1cnNvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQkFBa0IsR0FBRyxhQUFhO0FBQ2xDLG9CQUFvQixtQkFBTyxDQUFDLDJJQUFpQztBQUM3RCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQyxpR0FBWTtBQUN0QyxnQkFBZ0IsbUJBQU8sQ0FBQyxtSEFBcUI7QUFDN0MsNEJBQTRCLG1CQUFPLENBQUMsMklBQWlDO0FBQ3JFLGVBQWUsbUJBQU8sQ0FBQyxpSEFBb0I7QUFDM0MsZUFBZSxtQkFBTyxDQUFDLDJGQUFTO0FBQ2hDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQ7QUFDMUQ7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGdCQUFnQixtQkFBbUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELE1BQU07QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUZBQXVGLEtBQUs7QUFDNUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsZ0JBQWdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsV0FBVyxxQkFBcUIsV0FBVyxJQUFJLGlCQUFpQjtBQUNoRztBQUNBLDJEQUEyRCxpQkFBaUI7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxXQUFXLFdBQVc7QUFDeEQsOENBQThDLFdBQVcsSUFBSSxpQkFBaUI7QUFDOUUsOEJBQThCLFVBQVU7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLFdBQVc7QUFDdkQ7QUFDQSxjQUFjLFlBQVk7QUFDMUIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9maW5kX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRmluZEN1cnNvciA9IGV4cG9ydHMuRkxBR1MgPSB2b2lkIDA7XG5jb25zdCByZXNwb25zZXNfMSA9IHJlcXVpcmUoXCIuLi9jbWFwL3dpcmVfcHJvdG9jb2wvcmVzcG9uc2VzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGV4cGxhaW5fMSA9IHJlcXVpcmUoXCIuLi9leHBsYWluXCIpO1xuY29uc3QgY291bnRfMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2NvdW50XCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgZmluZF8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZmluZFwiKTtcbmNvbnN0IHNvcnRfMSA9IHJlcXVpcmUoXCIuLi9zb3J0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbi8qKiBAcHVibGljIEZsYWdzIGFsbG93ZWQgZm9yIGN1cnNvciAqL1xuZXhwb3J0cy5GTEFHUyA9IFtcbiAgICAndGFpbGFibGUnLFxuICAgICdvcGxvZ1JlcGxheScsXG4gICAgJ25vQ3Vyc29yVGltZW91dCcsXG4gICAgJ2F3YWl0RGF0YScsXG4gICAgJ2V4aGF1c3QnLFxuICAgICdwYXJ0aWFsJ1xuXTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBGaW5kQ3Vyc29yIGV4dGVuZHMgZXhwbGFpbl8xLkV4cGxhaW5hYmxlQ3Vyc29yIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY2xpZW50LCBuYW1lc3BhY2UsIGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoY2xpZW50LCBuYW1lc3BhY2UsIG9wdGlvbnMpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubnVtUmV0dXJuZWQgPSAwO1xuICAgICAgICB0aGlzLmN1cnNvckZpbHRlciA9IGZpbHRlcjtcbiAgICAgICAgdGhpcy5maW5kT3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIGlmIChvcHRpb25zLnNvcnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5zb3J0ID0gKDAsIHNvcnRfMS5mb3JtYXRTb3J0KShvcHRpb25zLnNvcnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICBjb25zdCBjbG9uZWRPcHRpb25zID0gKDAsIHV0aWxzXzEubWVyZ2VPcHRpb25zKSh7fSwgdGhpcy5maW5kT3B0aW9ucyk7XG4gICAgICAgIGRlbGV0ZSBjbG9uZWRPcHRpb25zLnNlc3Npb247XG4gICAgICAgIHJldHVybiBuZXcgRmluZEN1cnNvcih0aGlzLmNsaWVudCwgdGhpcy5uYW1lc3BhY2UsIHRoaXMuY3Vyc29yRmlsdGVyLCB7XG4gICAgICAgICAgICAuLi5jbG9uZWRPcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBtYXAodHJhbnNmb3JtKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5tYXAodHJhbnNmb3JtKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIF9pbml0aWFsaXplKHNlc3Npb24pIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIC4uLnRoaXMuZmluZE9wdGlvbnMsIC8vIE5PVEU6IG9yZGVyIG1hdHRlcnMgaGVyZSwgd2UgbWF5IG5lZWQgdG8gcmVmaW5lIHRoaXNcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICBzaWduYWw6IHRoaXMuc2lnbmFsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvcHRpb25zLmV4cGxhaW4pIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgKDAsIGV4cGxhaW5fMS52YWxpZGF0ZUV4cGxhaW5UaW1lb3V0T3B0aW9ucykob3B0aW9ucywgZXhwbGFpbl8xLkV4cGxhaW4uZnJvbU9wdGlvbnMob3B0aW9ucykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ3RpbWVvdXRNUyBjYW5ub3QgYmUgdXNlZCB3aXRoIGV4cGxhaW4gd2hlbiBleHBsYWluIGlzIHNwZWNpZmllZCBpbiBmaW5kT3B0aW9ucycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpbmRPcGVyYXRpb24gPSBuZXcgZmluZF8xLkZpbmRPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXMuY3Vyc29yRmlsdGVyLCBvcHRpb25zKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgZmluZE9wZXJhdGlvbiwgdGhpcy50aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIC8vIHRoZSByZXNwb25zZSBpcyBub3QgYSBjdXJzb3Igd2hlbiBgZXhwbGFpbmAgaXMgZW5hYmxlZFxuICAgICAgICB0aGlzLm51bVJldHVybmVkID0gcmVzcG9uc2UuYmF0Y2hTaXplO1xuICAgICAgICByZXR1cm4geyBzZXJ2ZXI6IGZpbmRPcGVyYXRpb24uc2VydmVyLCBzZXNzaW9uLCByZXNwb25zZSB9O1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYXN5bmMgZ2V0TW9yZShiYXRjaFNpemUpIHtcbiAgICAgICAgY29uc3QgbnVtUmV0dXJuZWQgPSB0aGlzLm51bVJldHVybmVkO1xuICAgICAgICBpZiAobnVtUmV0dXJuZWQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oRFJJVkVSUy0xNDQ4KTogUmVtb3ZlIGxvZ2ljIHRvIGVuZm9yY2UgYGxpbWl0YCBpbiB0aGUgZHJpdmVyXG4gICAgICAgICAgICBjb25zdCBsaW1pdCA9IHRoaXMuZmluZE9wdGlvbnMubGltaXQ7XG4gICAgICAgICAgICBiYXRjaFNpemUgPVxuICAgICAgICAgICAgICAgIGxpbWl0ICYmIGxpbWl0ID4gMCAmJiBudW1SZXR1cm5lZCArIGJhdGNoU2l6ZSA+IGxpbWl0ID8gbGltaXQgLSBudW1SZXR1cm5lZCA6IGJhdGNoU2l6ZTtcbiAgICAgICAgICAgIGlmIChiYXRjaFNpemUgPD0gMCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYW4gb3B0aW1pemF0aW9uIGZvciB0aGUgc3BlY2lhbCBjYXNlIG9mIGEgbGltaXQgZm9yIGEgZmluZCBjb21tYW5kIHRvIGF2b2lkIGFuXG4gICAgICAgICAgICAgICAgICAgIC8vIGV4dHJhIGdldE1vcmUgd2hlbiB0aGUgbGltaXQgaGFzIGJlZW4gcmVhY2hlZCBhbmQgdGhlIGxpbWl0IGlzIGEgbXVsdGlwbGUgb2YgdGhlIGJhdGNoU2l6ZS5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGNvbnNlcXVlbmNlIG9mIHRoZSBuZXcgcXVlcnkgZW5naW5lIGluIDUuMCBoYXZpbmcgbm8ga25vd2xlZGdlIG9mIHRoZSBsaW1pdCBhcyBpdFxuICAgICAgICAgICAgICAgICAgICAvLyBwcm9kdWNlcyByZXN1bHRzIGZvciB0aGUgZmluZCBjb21tYW5kLiAgT25jZSBhIGJhdGNoIGlzIGZpbGxlZCB1cCwgaXQgaXMgcmV0dXJuZWQgYW5kIG9ubHlcbiAgICAgICAgICAgICAgICAgICAgLy8gb24gdGhlIHN1YnNlcXVlbnQgZ2V0TW9yZSB3aWxsIHRoZSBxdWVyeSBmcmFtZXdvcmsgY29uc2lkZXIgdGhlIGxpbWl0LCBkZXRlcm1pbmUgdGhlIGN1cnNvclxuICAgICAgICAgICAgICAgICAgICAvLyBpcyBleGhhdXN0ZWQgYW5kIHJldHVybiBhIGN1cnNvcklkIG9mIHplcm8uXG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RlYWQsIGlmIHdlIGRldGVybWluZSB0aGVyZSBhcmUgbm8gbW9yZSBkb2N1bWVudHMgdG8gcmVxdWVzdCBmcm9tIHRoZSBzZXJ2ZXIsIHdlIHByZWVtcHRpdmVseVxuICAgICAgICAgICAgICAgICAgICAvLyBjbG9zZSB0aGUgY3Vyc29yXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZXNfMS5DdXJzb3JSZXNwb25zZS5lbXB0eUdldE1vcmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlci5nZXRNb3JlKGJhdGNoU2l6ZSk7XG4gICAgICAgIC8vIFRPRE86IHdyYXAgdGhpcyBpbiBzb21lIGxvZ2ljIHRvIHByZXZlbnQgaXQgZnJvbSBoYXBwZW5pbmcgaWYgd2UgZG9uJ3QgbmVlZCB0aGlzIHN1cHBvcnRcbiAgICAgICAgdGhpcy5udW1SZXR1cm5lZCA9IHRoaXMubnVtUmV0dXJuZWQgKyByZXNwb25zZS5iYXRjaFNpemU7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjb3VudCBvZiBkb2N1bWVudHMgZm9yIHRoaXMgY3Vyc29yXG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIGBjb2xsZWN0aW9uLmVzdGltYXRlZERvY3VtZW50Q291bnRgIG9yIGBjb2xsZWN0aW9uLmNvdW50RG9jdW1lbnRzYCBpbnN0ZWFkXG4gICAgICovXG4gICAgYXN5bmMgY291bnQob3B0aW9ucykge1xuICAgICAgICAoMCwgdXRpbHNfMS5lbWl0V2FybmluZ09uY2UpKCdjdXJzb3IuY291bnQgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24sIHBsZWFzZSB1c2UgYGNvbGxlY3Rpb24uZXN0aW1hdGVkRG9jdW1lbnRDb3VudGAgb3IgYGNvbGxlY3Rpb24uY291bnREb2N1bWVudHNgIGluc3RlYWQgJyk7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdJbnZhbGlkIGZpcnN0IHBhcmFtZXRlciB0byBjb3VudCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGNvdW50XzEuQ291bnRPcGVyYXRpb24odGhpcy5uYW1lc3BhY2UsIHRoaXMuY3Vyc29yRmlsdGVyLCB7XG4gICAgICAgICAgICAuLi50aGlzLmZpbmRPcHRpb25zLCAvLyBOT1RFOiBvcmRlciBtYXR0ZXJzIGhlcmUsIHdlIG1heSBuZWVkIHRvIHJlZmluZSB0aGlzXG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYXN5bmMgZXhwbGFpbih2ZXJib3NpdHksIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgeyBleHBsYWluLCB0aW1lb3V0IH0gPSB0aGlzLnJlc29sdmVFeHBsYWluVGltZW91dE9wdGlvbnModmVyYm9zaXR5LCBvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIChhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGZpbmRfMS5GaW5kT3BlcmF0aW9uKHRoaXMubmFtZXNwYWNlLCB0aGlzLmN1cnNvckZpbHRlciwge1xuICAgICAgICAgICAgLi4udGhpcy5maW5kT3B0aW9ucywgLy8gTk9URTogb3JkZXIgbWF0dGVycyBoZXJlLCB3ZSBtYXkgbmVlZCB0byByZWZpbmUgdGhpc1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgLi4udGltZW91dCxcbiAgICAgICAgICAgIGV4cGxhaW46IGV4cGxhaW4gPz8gdHJ1ZVxuICAgICAgICB9KSkpLnNoaWZ0KHRoaXMuZGVzZXJpYWxpemF0aW9uT3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKiBTZXQgdGhlIGN1cnNvciBxdWVyeSAqL1xuICAgIGZpbHRlcihmaWx0ZXIpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgdGhpcy5jdXJzb3JGaWx0ZXIgPSBmaWx0ZXI7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGN1cnNvciBoaW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0gaGludCAtIElmIHNwZWNpZmllZCwgdGhlbiB0aGUgcXVlcnkgc3lzdGVtIHdpbGwgb25seSBjb25zaWRlciBwbGFucyB1c2luZyB0aGUgaGludGVkIGluZGV4LlxuICAgICAqL1xuICAgIGhpbnQoaGludCkge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLmhpbnQgPSBoaW50O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBjdXJzb3IgbWluXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWluIC0gU3BlY2lmeSBhICRtaW4gdmFsdWUgdG8gc3BlY2lmeSB0aGUgaW5jbHVzaXZlIGxvd2VyIGJvdW5kIGZvciBhIHNwZWNpZmljIGluZGV4IGluIG9yZGVyIHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0cyBvZiBmaW5kKCkuIFRoZSAkbWluIHNwZWNpZmllcyB0aGUgbG93ZXIgYm91bmQgZm9yIGFsbCBrZXlzIG9mIGEgc3BlY2lmaWMgaW5kZXggaW4gb3JkZXIuXG4gICAgICovXG4gICAgbWluKG1pbikge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLm1pbiA9IG1pbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY3Vyc29yIG1heFxuICAgICAqXG4gICAgICogQHBhcmFtIG1heCAtIFNwZWNpZnkgYSAkbWF4IHZhbHVlIHRvIHNwZWNpZnkgdGhlIGV4Y2x1c2l2ZSB1cHBlciBib3VuZCBmb3IgYSBzcGVjaWZpYyBpbmRleCBpbiBvcmRlciB0byBjb25zdHJhaW4gdGhlIHJlc3VsdHMgb2YgZmluZCgpLiBUaGUgJG1heCBzcGVjaWZpZXMgdGhlIHVwcGVyIGJvdW5kIGZvciBhbGwga2V5cyBvZiBhIHNwZWNpZmljIGluZGV4IGluIG9yZGVyLlxuICAgICAqL1xuICAgIG1heChtYXgpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5tYXggPSBtYXg7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGN1cnNvciByZXR1cm5LZXkuXG4gICAgICogSWYgc2V0IHRvIHRydWUsIG1vZGlmaWVzIHRoZSBjdXJzb3IgdG8gb25seSByZXR1cm4gdGhlIGluZGV4IGZpZWxkIG9yIGZpZWxkcyBmb3IgdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5LCByYXRoZXIgdGhhbiBkb2N1bWVudHMuXG4gICAgICogSWYgc2V0IHRvIHRydWUgYW5kIHRoZSBxdWVyeSBkb2VzIG5vdCB1c2UgYW4gaW5kZXggdG8gcGVyZm9ybSB0aGUgcmVhZCBvcGVyYXRpb24sIHRoZSByZXR1cm5lZCBkb2N1bWVudHMgd2lsbCBub3QgY29udGFpbiBhbnkgZmllbGRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gdGhlIHJldHVybktleSB2YWx1ZS5cbiAgICAgKi9cbiAgICByZXR1cm5LZXkodmFsdWUpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5yZXR1cm5LZXkgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1vZGlmaWVzIHRoZSBvdXRwdXQgb2YgYSBxdWVyeSBieSBhZGRpbmcgYSBmaWVsZCAkcmVjb3JkSWQgdG8gbWF0Y2hpbmcgZG9jdW1lbnRzLiAkcmVjb3JkSWQgaXMgdGhlIGludGVybmFsIGtleSB3aGljaCB1bmlxdWVseSBpZGVudGlmaWVzIGEgZG9jdW1lbnQgaW4gYSBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlICRzaG93RGlza0xvYyBvcHRpb24gaGFzIG5vdyBiZWVuIGRlcHJlY2F0ZWQgYW5kIHJlcGxhY2VkIHdpdGggdGhlIHNob3dSZWNvcmRJZCBmaWVsZC4gJHNob3dEaXNrTG9jIHdpbGwgc3RpbGwgYmUgYWNjZXB0ZWQgZm9yIE9QX1FVRVJZIHN0eWUgZmluZC5cbiAgICAgKi9cbiAgICBzaG93UmVjb3JkSWQodmFsdWUpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5zaG93UmVjb3JkSWQgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhIHF1ZXJ5IG1vZGlmaWVyIHRvIHRoZSBjdXJzb3IgcXVlcnlcbiAgICAgKlxuICAgICAqIEBwYXJhbSBuYW1lIC0gVGhlIHF1ZXJ5IG1vZGlmaWVyIChtdXN0IHN0YXJ0IHdpdGggJCwgc3VjaCBhcyAkb3JkZXJieSBldGMpXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIG1vZGlmaWVyIHZhbHVlLlxuICAgICAqL1xuICAgIGFkZFF1ZXJ5TW9kaWZpZXIobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgaWYgKG5hbWVbMF0gIT09ICckJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgJHtuYW1lfSBpcyBub3QgYSB2YWxpZCBxdWVyeSBtb2RpZmllcmApO1xuICAgICAgICB9XG4gICAgICAgIC8vIFN0cmlwIG9mIHRoZSAkXG4gICAgICAgIGNvbnN0IGZpZWxkID0gbmFtZS5zdWJzdHIoMSk7XG4gICAgICAgIC8vIE5PVEU6IGNvbnNpZGVyIHNvbWUgVFMgbWFnaWMgZm9yIHRoaXNcbiAgICAgICAgc3dpdGNoIChmaWVsZCkge1xuICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6XG4gICAgICAgICAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5jb21tZW50ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdleHBsYWluJzpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRPcHRpb25zLmV4cGxhaW4gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2hpbnQnOlxuICAgICAgICAgICAgICAgIHRoaXMuZmluZE9wdGlvbnMuaGludCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWF4JzpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRPcHRpb25zLm1heCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWF4VGltZU1TJzpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRPcHRpb25zLm1heFRpbWVNUyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWluJzpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRPcHRpb25zLm1pbiA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnb3JkZXJieSc6XG4gICAgICAgICAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5zb3J0ID0gKDAsIHNvcnRfMS5mb3JtYXRTb3J0KSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdxdWVyeSc6XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJzb3JGaWx0ZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3JldHVybktleSc6XG4gICAgICAgICAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5yZXR1cm5LZXkgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3Nob3dEaXNrTG9jJzpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRPcHRpb25zLnNob3dSZWNvcmRJZCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBJbnZhbGlkIHF1ZXJ5IG1vZGlmaWVyOiAke25hbWV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhIGNvbW1lbnQgdG8gdGhlIGN1cnNvciBxdWVyeSBhbGxvd2luZyBmb3IgdHJhY2tpbmcgdGhlIGNvbW1lbnQgaW4gdGhlIGxvZy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSBjb21tZW50IGF0dGFjaGVkIHRvIHRoaXMgcXVlcnkuXG4gICAgICovXG4gICAgY29tbWVudCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLmNvbW1lbnQgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBhIG1heEF3YWl0VGltZU1TIG9uIGEgdGFpbGluZyBjdXJzb3IgcXVlcnkgdG8gYWxsb3cgdG8gY3VzdG9taXplIHRoZSB0aW1lb3V0IHZhbHVlIGZvciB0aGUgb3B0aW9uIGF3YWl0RGF0YSAoT25seSBzdXBwb3J0ZWQgb24gTW9uZ29EQiAzLjIgb3IgaGlnaGVyLCBpZ25vcmVkIG90aGVyd2lzZSlcbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgYWJvcnRpbmcgdGhlIHRhaWxlZCBxdWVyeS5cbiAgICAgKi9cbiAgICBtYXhBd2FpdFRpbWVNUyh2YWx1ZSkge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgZm9yIG1heEF3YWl0VGltZU1TIG11c3QgYmUgYSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLm1heEF3YWl0VGltZU1TID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgYSBtYXhUaW1lTVMgb24gdGhlIGN1cnNvciBxdWVyeSwgYWxsb3dpbmcgZm9yIGhhcmQgdGltZW91dCBsaW1pdHMgb24gcXVlcmllcyAoT25seSBzdXBwb3J0ZWQgb24gTW9uZ29EQiAyLjYgb3IgaGlnaGVyKVxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBhYm9ydGluZyB0aGUgcXVlcnkuXG4gICAgICovXG4gICAgbWF4VGltZU1TKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudGhyb3dJZkluaXRpYWxpemVkKCk7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBmb3IgbWF4VGltZU1TIG11c3QgYmUgYSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLm1heFRpbWVNUyA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGEgcHJvamVjdCBzdGFnZSB0byB0aGUgYWdncmVnYXRpb24gcGlwZWxpbmVcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogSW4gb3JkZXIgdG8gc3RyaWN0bHkgdHlwZSB0aGlzIGZ1bmN0aW9uIHlvdSBtdXN0IHByb3ZpZGUgYW4gaW50ZXJmYWNlXG4gICAgICogdGhhdCByZXByZXNlbnRzIHRoZSBlZmZlY3Qgb2YgeW91ciBwcm9qZWN0aW9uIG9uIHRoZSByZXN1bHQgZG9jdW1lbnRzLlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCBjaGFpbmluZyBhIHByb2plY3Rpb24gdG8geW91ciBjdXJzb3IgY2hhbmdlcyB0aGUgcmV0dXJuZWQgdHlwZSB0byB0aGUgZ2VuZXJpY1xuICAgICAqIHtAbGluayBEb2N1bWVudH0gdHlwZS5cbiAgICAgKiBZb3Ugc2hvdWxkIHNwZWNpZnkgYSBwYXJhbWV0ZXJpemVkIHR5cGUgdG8gaGF2ZSBhc3NlcnRpb25zIG9uIHlvdXIgZmluYWwgcmVzdWx0cy5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIC8vIEJlc3Qgd2F5XG4gICAgICogY29uc3QgZG9jczogRmluZEN1cnNvcjx7IGE6IG51bWJlciB9PiA9IGN1cnNvci5wcm9qZWN0PHsgYTogbnVtYmVyIH0+KHsgX2lkOiAwLCBhOiB0cnVlIH0pO1xuICAgICAqIC8vIEZsZXhpYmxlIHdheVxuICAgICAqIGNvbnN0IGRvY3M6IEZpbmRDdXJzb3I8RG9jdW1lbnQ+ID0gY3Vyc29yLnByb2plY3QoeyBfaWQ6IDAsIGE6IHRydWUgfSk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqXG4gICAgICogKipOb3RlIGZvciBUeXBlc2NyaXB0IFVzZXJzOioqIGFkZGluZyBhIHRyYW5zZm9ybSBjaGFuZ2VzIHRoZSByZXR1cm4gdHlwZSBvZiB0aGUgaXRlcmF0aW9uIG9mIHRoaXMgY3Vyc29yLFxuICAgICAqIGl0ICoqZG9lcyBub3QqKiByZXR1cm4gYSBuZXcgaW5zdGFuY2Ugb2YgYSBjdXJzb3IuIFRoaXMgbWVhbnMgd2hlbiBjYWxsaW5nIHByb2plY3QsXG4gICAgICogeW91IHNob3VsZCBhbHdheXMgYXNzaWduIHRoZSByZXN1bHQgdG8gYSBuZXcgdmFyaWFibGUgaW4gb3JkZXIgdG8gZ2V0IGEgY29ycmVjdGx5IHR5cGVkIGN1cnNvciB2YXJpYWJsZS5cbiAgICAgKiBUYWtlIG5vdGUgb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlOlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgY3Vyc29yOiBGaW5kQ3Vyc29yPHsgYTogbnVtYmVyOyBiOiBzdHJpbmcgfT4gPSBjb2xsLmZpbmQoKTtcbiAgICAgKiBjb25zdCBwcm9qZWN0Q3Vyc29yID0gY3Vyc29yLnByb2plY3Q8eyBhOiBudW1iZXIgfT4oeyBfaWQ6IDAsIGE6IHRydWUgfSk7XG4gICAgICogY29uc3QgYVByb3BPbmx5QXJyYXk6IHthOiBudW1iZXJ9W10gPSBhd2FpdCBwcm9qZWN0Q3Vyc29yLnRvQXJyYXkoKTtcbiAgICAgKlxuICAgICAqIC8vIG9yIGFsd2F5cyB1c2UgY2hhaW5pbmcgYW5kIHNhdmUgdGhlIGZpbmFsIGN1cnNvclxuICAgICAqXG4gICAgICogY29uc3QgY3Vyc29yID0gY29sbC5maW5kKCkucHJvamVjdDx7IGE6IHN0cmluZyB9Pih7XG4gICAgICogICBfaWQ6IDAsXG4gICAgICogICBhOiB7ICRjb252ZXJ0OiB7IGlucHV0OiAnJGEnLCB0bzogJ3N0cmluZycgfVxuICAgICAqIH19KTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBwcm9qZWN0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMudGhyb3dJZkluaXRpYWxpemVkKCk7XG4gICAgICAgIHRoaXMuZmluZE9wdGlvbnMucHJvamVjdGlvbiA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc29ydCBvcmRlciBvZiB0aGUgY3Vyc29yIHF1ZXJ5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHNvcnQgLSBUaGUga2V5IG9yIGtleXMgc2V0IGZvciB0aGUgc29ydC5cbiAgICAgKiBAcGFyYW0gZGlyZWN0aW9uIC0gVGhlIGRpcmVjdGlvbiBvZiB0aGUgc29ydGluZyAoMSBvciAtMSkuXG4gICAgICovXG4gICAgc29ydChzb3J0LCBkaXJlY3Rpb24pIHtcbiAgICAgICAgdGhpcy50aHJvd0lmSW5pdGlhbGl6ZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuZmluZE9wdGlvbnMudGFpbGFibGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvcignVGFpbGFibGUgY3Vyc29yIGRvZXMgbm90IHN1cHBvcnQgc29ydGluZycpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmluZE9wdGlvbnMuc29ydCA9ICgwLCBzb3J0XzEuZm9ybWF0U29ydCkoc29ydCwgZGlyZWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFsbG93cyBkaXNrIHVzZSBmb3IgYmxvY2tpbmcgc29ydCBvcGVyYXRpb25zIGV4Y2VlZGluZyAxMDBNQiBtZW1vcnkuIChNb25nb0RCIDMuMiBvciBoaWdoZXIpXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvY29tbWFuZC9maW5kLyNmaW5kLWNtZC1hbGxvd2Rpc2t1c2UgfCBmaW5kIGNvbW1hbmQgYWxsb3dEaXNrVXNlIGRvY3VtZW50YXRpb259XG4gICAgICovXG4gICAgYWxsb3dEaXNrVXNlKGFsbG93ID0gdHJ1ZSkge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICBpZiAoIXRoaXMuZmluZE9wdGlvbnMuc29ydCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3B0aW9uIFwiYWxsb3dEaXNrVXNlXCIgcmVxdWlyZXMgYSBzb3J0IHNwZWNpZmljYXRpb24nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBcyBvZiA2LjAgdGhlIGRlZmF1bHQgaXMgdHJ1ZS4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gZ2V0IGJhY2sgdG8gdGhlIG9sZCBiZWhhdmlvci5cbiAgICAgICAgaWYgKCFhbGxvdykge1xuICAgICAgICAgICAgdGhpcy5maW5kT3B0aW9ucy5hbGxvd0Rpc2tVc2UgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmluZE9wdGlvbnMuYWxsb3dEaXNrVXNlID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgY29sbGF0aW9uIG9wdGlvbnMgZm9yIHRoZSBjdXJzb3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgY3Vyc29yIGNvbGxhdGlvbiBvcHRpb25zIChNb25nb0RCIDMuNCBvciBoaWdoZXIpIHNldHRpbmdzIGZvciB1cGRhdGUgb3BlcmF0aW9uIChzZWUgMy40IGRvY3VtZW50YXRpb24gZm9yIGF2YWlsYWJsZSBmaWVsZHMpLlxuICAgICAqL1xuICAgIGNvbGxhdGlvbih2YWx1ZSkge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLmNvbGxhdGlvbiA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBsaW1pdCBmb3IgdGhlIGN1cnNvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSBsaW1pdCBmb3IgdGhlIGN1cnNvciBxdWVyeS5cbiAgICAgKi9cbiAgICBsaW1pdCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnRocm93SWZJbml0aWFsaXplZCgpO1xuICAgICAgICBpZiAodGhpcy5maW5kT3B0aW9ucy50YWlsYWJsZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yKCdUYWlsYWJsZSBjdXJzb3IgZG9lcyBub3Qgc3VwcG9ydCBsaW1pdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdPcGVyYXRpb24gXCJsaW1pdFwiIHJlcXVpcmVzIGFuIGludGVnZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLmxpbWl0ID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIHNraXAgZm9yIHRoZSBjdXJzb3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgc2tpcCBmb3IgdGhlIGN1cnNvciBxdWVyeS5cbiAgICAgKi9cbiAgICBza2lwKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudGhyb3dJZkluaXRpYWxpemVkKCk7XG4gICAgICAgIGlmICh0aGlzLmZpbmRPcHRpb25zLnRhaWxhYmxlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3IoJ1RhaWxhYmxlIGN1cnNvciBkb2VzIG5vdCBzdXBwb3J0IHNraXAnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3BlcmF0aW9uIFwic2tpcFwiIHJlcXVpcmVzIGFuIGludGVnZXInKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbmRPcHRpb25zLnNraXAgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuZXhwb3J0cy5GaW5kQ3Vyc29yID0gRmluZEN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZpbmRfY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/find_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_collections_cursor.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_collections_cursor.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListCollectionsCursor = void 0;\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst list_collections_1 = __webpack_require__(/*! ../operations/list_collections */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_collections.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @public */\nclass ListCollectionsCursor extends abstract_cursor_1.AbstractCursor {\n    constructor(db, filter, options) {\n        super(db.client, db.s.namespace, options);\n        this.parent = db;\n        this.filter = filter;\n        this.options = options;\n    }\n    clone() {\n        return new ListCollectionsCursor(this.parent, this.filter, {\n            ...this.options,\n            ...this.cursorOptions\n        });\n    }\n    /** @internal */\n    async _initialize(session) {\n        const operation = new list_collections_1.ListCollectionsOperation(this.parent, this.filter, {\n            ...this.cursorOptions,\n            ...this.options,\n            session,\n            signal: this.signal\n        });\n        const response = await (0, execute_operation_1.executeOperation)(this.parent.client, operation, this.timeoutContext);\n        return { server: operation.server, session, response };\n    }\n}\nexports.ListCollectionsCursor = ListCollectionsCursor;\n//# sourceMappingURL=list_collections_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9saXN0X2NvbGxlY3Rpb25zX2N1cnNvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw2QkFBNkI7QUFDN0IsNEJBQTRCLG1CQUFPLENBQUMsMklBQWlDO0FBQ3JFLDJCQUEyQixtQkFBTyxDQUFDLHlJQUFnQztBQUNuRSwwQkFBMEIsbUJBQU8sQ0FBQyx1SEFBbUI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9saXN0X2NvbGxlY3Rpb25zX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTGlzdENvbGxlY3Rpb25zQ3Vyc29yID0gdm9pZCAwO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgbGlzdF9jb2xsZWN0aW9uc18xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvbGlzdF9jb2xsZWN0aW9uc1wiKTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4vYWJzdHJhY3RfY3Vyc29yXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmNsYXNzIExpc3RDb2xsZWN0aW9uc0N1cnNvciBleHRlbmRzIGFic3RyYWN0X2N1cnNvcl8xLkFic3RyYWN0Q3Vyc29yIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLmNsaWVudCwgZGIucy5uYW1lc3BhY2UsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBhcmVudCA9IGRiO1xuICAgICAgICB0aGlzLmZpbHRlciA9IGZpbHRlcjtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTGlzdENvbGxlY3Rpb25zQ3Vyc29yKHRoaXMucGFyZW50LCB0aGlzLmZpbHRlciwge1xuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYXN5bmMgX2luaXRpYWxpemUoc2Vzc2lvbikge1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgbGlzdF9jb2xsZWN0aW9uc18xLkxpc3RDb2xsZWN0aW9uc09wZXJhdGlvbih0aGlzLnBhcmVudCwgdGhpcy5maWx0ZXIsIHtcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICBzaWduYWw6IHRoaXMuc2lnbmFsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMucGFyZW50LmNsaWVudCwgb3BlcmF0aW9uLCB0aGlzLnRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgcmV0dXJuIHsgc2VydmVyOiBvcGVyYXRpb24uc2VydmVyLCBzZXNzaW9uLCByZXNwb25zZSB9O1xuICAgIH1cbn1cbmV4cG9ydHMuTGlzdENvbGxlY3Rpb25zQ3Vyc29yID0gTGlzdENvbGxlY3Rpb25zQ3Vyc29yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGlzdF9jb2xsZWN0aW9uc19jdXJzb3IuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_collections_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_indexes_cursor.js":
/*!**************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_indexes_cursor.js ***!
  \**************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListIndexesCursor = void 0;\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst indexes_1 = __webpack_require__(/*! ../operations/indexes */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @public */\nclass ListIndexesCursor extends abstract_cursor_1.AbstractCursor {\n    constructor(collection, options) {\n        super(collection.client, collection.s.namespace, options);\n        this.parent = collection;\n        this.options = options;\n    }\n    clone() {\n        return new ListIndexesCursor(this.parent, {\n            ...this.options,\n            ...this.cursorOptions\n        });\n    }\n    /** @internal */\n    async _initialize(session) {\n        const operation = new indexes_1.ListIndexesOperation(this.parent, {\n            ...this.cursorOptions,\n            ...this.options,\n            session\n        });\n        const response = await (0, execute_operation_1.executeOperation)(this.parent.client, operation, this.timeoutContext);\n        return { server: operation.server, session, response };\n    }\n}\nexports.ListIndexesCursor = ListIndexesCursor;\n//# sourceMappingURL=list_indexes_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9saXN0X2luZGV4ZXNfY3Vyc29yLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QjtBQUN6Qiw0QkFBNEIsbUJBQU8sQ0FBQywySUFBaUM7QUFDckUsa0JBQWtCLG1CQUFPLENBQUMsdUhBQXVCO0FBQ2pELDBCQUEwQixtQkFBTyxDQUFDLHVIQUFtQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvbGlzdF9pbmRleGVzX2N1cnNvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTGlzdEluZGV4ZXNDdXJzb3IgPSB2b2lkIDA7XG5jb25zdCBleGVjdXRlX29wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBpbmRleGVzXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9pbmRleGVzXCIpO1xuY29uc3QgYWJzdHJhY3RfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9hYnN0cmFjdF9jdXJzb3JcIik7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgTGlzdEluZGV4ZXNDdXJzb3IgZXh0ZW5kcyBhYnN0cmFjdF9jdXJzb3JfMS5BYnN0cmFjdEN1cnNvciB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLmNsaWVudCwgY29sbGVjdGlvbi5zLm5hbWVzcGFjZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMucGFyZW50ID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTGlzdEluZGV4ZXNDdXJzb3IodGhpcy5wYXJlbnQsIHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIF9pbml0aWFsaXplKHNlc3Npb24pIHtcbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gbmV3IGluZGV4ZXNfMS5MaXN0SW5kZXhlc09wZXJhdGlvbih0aGlzLnBhcmVudCwge1xuICAgICAgICAgICAgLi4udGhpcy5jdXJzb3JPcHRpb25zLFxuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgc2Vzc2lvblxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLnBhcmVudC5jbGllbnQsIG9wZXJhdGlvbiwgdGhpcy50aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIHJldHVybiB7IHNlcnZlcjogb3BlcmF0aW9uLnNlcnZlciwgc2Vzc2lvbiwgcmVzcG9uc2UgfTtcbiAgICB9XG59XG5leHBvcnRzLkxpc3RJbmRleGVzQ3Vyc29yID0gTGlzdEluZGV4ZXNDdXJzb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1saXN0X2luZGV4ZXNfY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_indexes_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js":
/*!*********************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js ***!
  \*********************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListSearchIndexesCursor = void 0;\nconst aggregation_cursor_1 = __webpack_require__(/*! ./aggregation_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\n/** @public */\nclass ListSearchIndexesCursor extends aggregation_cursor_1.AggregationCursor {\n    /** @internal */\n    constructor({ fullNamespace: ns, client }, name, options = {}) {\n        const pipeline = name == null ? [{ $listSearchIndexes: {} }] : [{ $listSearchIndexes: { name } }];\n        super(client, ns, pipeline, options);\n    }\n}\nexports.ListSearchIndexesCursor = ListSearchIndexesCursor;\n//# sourceMappingURL=list_search_indexes_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9saXN0X3NlYXJjaF9pbmRleGVzX2N1cnNvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwrQkFBK0I7QUFDL0IsNkJBQTZCLG1CQUFPLENBQUMsNkhBQXNCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwyQkFBMkIsb0JBQW9CO0FBQ2pFLDJDQUEyQyx3QkFBd0IsT0FBTyxzQkFBc0IsUUFBUTtBQUN4RztBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9jdXJzb3IvbGlzdF9zZWFyY2hfaW5kZXhlc19jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpc3RTZWFyY2hJbmRleGVzQ3Vyc29yID0gdm9pZCAwO1xuY29uc3QgYWdncmVnYXRpb25fY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9hZ2dyZWdhdGlvbl9jdXJzb3JcIik7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgTGlzdFNlYXJjaEluZGV4ZXNDdXJzb3IgZXh0ZW5kcyBhZ2dyZWdhdGlvbl9jdXJzb3JfMS5BZ2dyZWdhdGlvbkN1cnNvciB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHsgZnVsbE5hbWVzcGFjZTogbnMsIGNsaWVudCB9LCBuYW1lLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgcGlwZWxpbmUgPSBuYW1lID09IG51bGwgPyBbeyAkbGlzdFNlYXJjaEluZGV4ZXM6IHt9IH1dIDogW3sgJGxpc3RTZWFyY2hJbmRleGVzOiB7IG5hbWUgfSB9XTtcbiAgICAgICAgc3VwZXIoY2xpZW50LCBucywgcGlwZWxpbmUsIG9wdGlvbnMpO1xuICAgIH1cbn1cbmV4cG9ydHMuTGlzdFNlYXJjaEluZGV4ZXNDdXJzb3IgPSBMaXN0U2VhcmNoSW5kZXhlc0N1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpc3Rfc2VhcmNoX2luZGV4ZXNfY3Vyc29yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_search_indexes_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/run_command_cursor.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/run_command_cursor.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RunCommandCursor = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst get_more_1 = __webpack_require__(/*! ../operations/get_more */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/get_more.js\");\nconst run_command_1 = __webpack_require__(/*! ../operations/run_command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ./abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n/** @public */\nclass RunCommandCursor extends abstract_cursor_1.AbstractCursor {\n    /**\n     * Controls the `getMore.comment` field\n     * @param comment - any BSON value\n     */\n    setComment(comment) {\n        this.getMoreOptions.comment = comment;\n        return this;\n    }\n    /**\n     * Controls the `getMore.maxTimeMS` field. Only valid when cursor is tailable await\n     * @param maxTimeMS - the number of milliseconds to wait for new data\n     */\n    setMaxTimeMS(maxTimeMS) {\n        this.getMoreOptions.maxAwaitTimeMS = maxTimeMS;\n        return this;\n    }\n    /**\n     * Controls the `getMore.batchSize` field\n     * @param batchSize - the number documents to return in the `nextBatch`\n     */\n    setBatchSize(batchSize) {\n        this.getMoreOptions.batchSize = batchSize;\n        return this;\n    }\n    /** Unsupported for RunCommandCursor */\n    clone() {\n        throw new error_1.MongoAPIError('Clone not supported, create a new cursor with db.runCursorCommand');\n    }\n    /** Unsupported for RunCommandCursor: readConcern must be configured directly on command document */\n    withReadConcern(_) {\n        throw new error_1.MongoAPIError('RunCommandCursor does not support readConcern it must be attached to the command being run');\n    }\n    /** Unsupported for RunCommandCursor: various cursor flags must be configured directly on command document */\n    addCursorFlag(_, __) {\n        throw new error_1.MongoAPIError('RunCommandCursor does not support cursor flags, they must be attached to the command being run');\n    }\n    /**\n     * Unsupported for RunCommandCursor: maxTimeMS must be configured directly on command document\n     */\n    maxTimeMS(_) {\n        throw new error_1.MongoAPIError('maxTimeMS must be configured on the command document directly, to configure getMore.maxTimeMS use cursor.setMaxTimeMS()');\n    }\n    /** Unsupported for RunCommandCursor: batchSize must be configured directly on command document */\n    batchSize(_) {\n        throw new error_1.MongoAPIError('batchSize must be configured on the command document directly, to configure getMore.batchSize use cursor.setBatchSize()');\n    }\n    /** @internal */\n    constructor(db, command, options = {}) {\n        super(db.client, (0, utils_1.ns)(db.namespace), options);\n        this.getMoreOptions = {};\n        this.db = db;\n        this.command = Object.freeze({ ...command });\n    }\n    /** @internal */\n    async _initialize(session) {\n        const operation = new run_command_1.RunCommandOperation(this.db, this.command, {\n            ...this.cursorOptions,\n            session: session,\n            readPreference: this.cursorOptions.readPreference,\n            responseType: responses_1.CursorResponse\n        });\n        const response = await (0, execute_operation_1.executeOperation)(this.client, operation, this.timeoutContext);\n        return {\n            server: operation.server,\n            session,\n            response\n        };\n    }\n    /** @internal */\n    async getMore(_batchSize) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const getMoreOperation = new get_more_1.GetMoreOperation(this.namespace, this.id, this.server, {\n            ...this.cursorOptions,\n            session: this.session,\n            ...this.getMoreOptions\n        });\n        return await (0, execute_operation_1.executeOperation)(this.client, getMoreOperation, this.timeoutContext);\n    }\n}\nexports.RunCommandCursor = RunCommandCursor;\n//# sourceMappingURL=run_command_cursor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9ydW5fY29tbWFuZF9jdXJzb3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLG9CQUFvQixtQkFBTyxDQUFDLDJJQUFpQztBQUM3RCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyw0QkFBNEIsbUJBQU8sQ0FBQywySUFBaUM7QUFDckUsbUJBQW1CLG1CQUFPLENBQUMseUhBQXdCO0FBQ25ELHNCQUFzQixtQkFBTyxDQUFDLCtIQUEyQjtBQUN6RCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQywwQkFBMEIsbUJBQU8sQ0FBQyx1SEFBbUI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLFlBQVk7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2N1cnNvci9ydW5fY29tbWFuZF9jdXJzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJ1bkNvbW1hbmRDdXJzb3IgPSB2b2lkIDA7XG5jb25zdCByZXNwb25zZXNfMSA9IHJlcXVpcmUoXCIuLi9jbWFwL3dpcmVfcHJvdG9jb2wvcmVzcG9uc2VzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IGdldF9tb3JlXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9nZXRfbW9yZVwiKTtcbmNvbnN0IHJ1bl9jb21tYW5kXzEgPSByZXF1aXJlKFwiLi4vb3BlcmF0aW9ucy9ydW5fY29tbWFuZFwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBhYnN0cmFjdF9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2Fic3RyYWN0X2N1cnNvclwiKTtcbi8qKiBAcHVibGljICovXG5jbGFzcyBSdW5Db21tYW5kQ3Vyc29yIGV4dGVuZHMgYWJzdHJhY3RfY3Vyc29yXzEuQWJzdHJhY3RDdXJzb3Ige1xuICAgIC8qKlxuICAgICAqIENvbnRyb2xzIHRoZSBgZ2V0TW9yZS5jb21tZW50YCBmaWVsZFxuICAgICAqIEBwYXJhbSBjb21tZW50IC0gYW55IEJTT04gdmFsdWVcbiAgICAgKi9cbiAgICBzZXRDb21tZW50KGNvbW1lbnQpIHtcbiAgICAgICAgdGhpcy5nZXRNb3JlT3B0aW9ucy5jb21tZW50ID0gY29tbWVudDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnRyb2xzIHRoZSBgZ2V0TW9yZS5tYXhUaW1lTVNgIGZpZWxkLiBPbmx5IHZhbGlkIHdoZW4gY3Vyc29yIGlzIHRhaWxhYmxlIGF3YWl0XG4gICAgICogQHBhcmFtIG1heFRpbWVNUyAtIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgZm9yIG5ldyBkYXRhXG4gICAgICovXG4gICAgc2V0TWF4VGltZU1TKG1heFRpbWVNUykge1xuICAgICAgICB0aGlzLmdldE1vcmVPcHRpb25zLm1heEF3YWl0VGltZU1TID0gbWF4VGltZU1TO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udHJvbHMgdGhlIGBnZXRNb3JlLmJhdGNoU2l6ZWAgZmllbGRcbiAgICAgKiBAcGFyYW0gYmF0Y2hTaXplIC0gdGhlIG51bWJlciBkb2N1bWVudHMgdG8gcmV0dXJuIGluIHRoZSBgbmV4dEJhdGNoYFxuICAgICAqL1xuICAgIHNldEJhdGNoU2l6ZShiYXRjaFNpemUpIHtcbiAgICAgICAgdGhpcy5nZXRNb3JlT3B0aW9ucy5iYXRjaFNpemUgPSBiYXRjaFNpemU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogVW5zdXBwb3J0ZWQgZm9yIFJ1bkNvbW1hbmRDdXJzb3IgKi9cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignQ2xvbmUgbm90IHN1cHBvcnRlZCwgY3JlYXRlIGEgbmV3IGN1cnNvciB3aXRoIGRiLnJ1bkN1cnNvckNvbW1hbmQnKTtcbiAgICB9XG4gICAgLyoqIFVuc3VwcG9ydGVkIGZvciBSdW5Db21tYW5kQ3Vyc29yOiByZWFkQ29uY2VybiBtdXN0IGJlIGNvbmZpZ3VyZWQgZGlyZWN0bHkgb24gY29tbWFuZCBkb2N1bWVudCAqL1xuICAgIHdpdGhSZWFkQ29uY2VybihfKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ1J1bkNvbW1hbmRDdXJzb3IgZG9lcyBub3Qgc3VwcG9ydCByZWFkQ29uY2VybiBpdCBtdXN0IGJlIGF0dGFjaGVkIHRvIHRoZSBjb21tYW5kIGJlaW5nIHJ1bicpO1xuICAgIH1cbiAgICAvKiogVW5zdXBwb3J0ZWQgZm9yIFJ1bkNvbW1hbmRDdXJzb3I6IHZhcmlvdXMgY3Vyc29yIGZsYWdzIG11c3QgYmUgY29uZmlndXJlZCBkaXJlY3RseSBvbiBjb21tYW5kIGRvY3VtZW50ICovXG4gICAgYWRkQ3Vyc29yRmxhZyhfLCBfXykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdSdW5Db21tYW5kQ3Vyc29yIGRvZXMgbm90IHN1cHBvcnQgY3Vyc29yIGZsYWdzLCB0aGV5IG11c3QgYmUgYXR0YWNoZWQgdG8gdGhlIGNvbW1hbmQgYmVpbmcgcnVuJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVuc3VwcG9ydGVkIGZvciBSdW5Db21tYW5kQ3Vyc29yOiBtYXhUaW1lTVMgbXVzdCBiZSBjb25maWd1cmVkIGRpcmVjdGx5IG9uIGNvbW1hbmQgZG9jdW1lbnRcbiAgICAgKi9cbiAgICBtYXhUaW1lTVMoXykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdtYXhUaW1lTVMgbXVzdCBiZSBjb25maWd1cmVkIG9uIHRoZSBjb21tYW5kIGRvY3VtZW50IGRpcmVjdGx5LCB0byBjb25maWd1cmUgZ2V0TW9yZS5tYXhUaW1lTVMgdXNlIGN1cnNvci5zZXRNYXhUaW1lTVMoKScpO1xuICAgIH1cbiAgICAvKiogVW5zdXBwb3J0ZWQgZm9yIFJ1bkNvbW1hbmRDdXJzb3I6IGJhdGNoU2l6ZSBtdXN0IGJlIGNvbmZpZ3VyZWQgZGlyZWN0bHkgb24gY29tbWFuZCBkb2N1bWVudCAqL1xuICAgIGJhdGNoU2l6ZShfKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ2JhdGNoU2l6ZSBtdXN0IGJlIGNvbmZpZ3VyZWQgb24gdGhlIGNvbW1hbmQgZG9jdW1lbnQgZGlyZWN0bHksIHRvIGNvbmZpZ3VyZSBnZXRNb3JlLmJhdGNoU2l6ZSB1c2UgY3Vyc29yLnNldEJhdGNoU2l6ZSgpJyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihkYiwgY29tbWFuZCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKGRiLmNsaWVudCwgKDAsIHV0aWxzXzEubnMpKGRiLm5hbWVzcGFjZSksIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmdldE1vcmVPcHRpb25zID0ge307XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5jb21tYW5kID0gT2JqZWN0LmZyZWV6ZSh7IC4uLmNvbW1hbmQgfSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBfaW5pdGlhbGl6ZShzZXNzaW9uKSB7XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5ldyBydW5fY29tbWFuZF8xLlJ1bkNvbW1hbmRPcGVyYXRpb24odGhpcy5kYiwgdGhpcy5jb21tYW5kLCB7XG4gICAgICAgICAgICAuLi50aGlzLmN1cnNvck9wdGlvbnMsXG4gICAgICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHRoaXMuY3Vyc29yT3B0aW9ucy5yZWFkUHJlZmVyZW5jZSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogcmVzcG9uc2VzXzEuQ3Vyc29yUmVzcG9uc2VcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG9wZXJhdGlvbiwgdGhpcy50aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXJ2ZXI6IG9wZXJhdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIGdldE1vcmUoX2JhdGNoU2l6ZSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICBjb25zdCBnZXRNb3JlT3BlcmF0aW9uID0gbmV3IGdldF9tb3JlXzEuR2V0TW9yZU9wZXJhdGlvbih0aGlzLm5hbWVzcGFjZSwgdGhpcy5pZCwgdGhpcy5zZXJ2ZXIsIHtcbiAgICAgICAgICAgIC4uLnRoaXMuY3Vyc29yT3B0aW9ucyxcbiAgICAgICAgICAgIHNlc3Npb246IHRoaXMuc2Vzc2lvbixcbiAgICAgICAgICAgIC4uLnRoaXMuZ2V0TW9yZU9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgZ2V0TW9yZU9wZXJhdGlvbiwgdGhpcy50aW1lb3V0Q29udGV4dCk7XG4gICAgfVxufVxuZXhwb3J0cy5SdW5Db21tYW5kQ3Vyc29yID0gUnVuQ29tbWFuZEN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJ1bl9jb21tYW5kX2N1cnNvci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/run_command_cursor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/db.js":
/*!**************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/db.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Db = void 0;\nconst admin_1 = __webpack_require__(/*! ./admin */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/admin.js\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\");\nconst collection_1 = __webpack_require__(/*! ./collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\");\nconst CONSTANTS = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst aggregation_cursor_1 = __webpack_require__(/*! ./cursor/aggregation_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\nconst list_collections_cursor_1 = __webpack_require__(/*! ./cursor/list_collections_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_collections_cursor.js\");\nconst run_command_cursor_1 = __webpack_require__(/*! ./cursor/run_command_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/run_command_cursor.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst collections_1 = __webpack_require__(/*! ./operations/collections */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/collections.js\");\nconst create_collection_1 = __webpack_require__(/*! ./operations/create_collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/create_collection.js\");\nconst drop_1 = __webpack_require__(/*! ./operations/drop */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/drop.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst indexes_1 = __webpack_require__(/*! ./operations/indexes */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js\");\nconst profiling_level_1 = __webpack_require__(/*! ./operations/profiling_level */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/profiling_level.js\");\nconst remove_user_1 = __webpack_require__(/*! ./operations/remove_user */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/remove_user.js\");\nconst rename_1 = __webpack_require__(/*! ./operations/rename */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/rename.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js\");\nconst set_profiling_level_1 = __webpack_require__(/*! ./operations/set_profiling_level */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/set_profiling_level.js\");\nconst stats_1 = __webpack_require__(/*! ./operations/stats */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/stats.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\n// Allowed parameters\nconst DB_OPTIONS_ALLOW_LIST = [\n    'writeConcern',\n    'readPreference',\n    'readPreferenceTags',\n    'native_parser',\n    'forceServerObjectId',\n    'pkFactory',\n    'serializeFunctions',\n    'raw',\n    'authSource',\n    'ignoreUndefined',\n    'readConcern',\n    'retryMiliSeconds',\n    'numberOfRetries',\n    'useBigInt64',\n    'promoteBuffers',\n    'promoteLongs',\n    'bsonRegExp',\n    'enableUtf8Validation',\n    'promoteValues',\n    'compression',\n    'retryWrites',\n    'timeoutMS'\n];\n/**\n * The **Db** class is a class that represents a MongoDB Database.\n * @public\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * interface Pet {\n *   name: string;\n *   kind: 'dog' | 'cat' | 'fish';\n * }\n *\n * const client = new MongoClient('mongodb://localhost:27017');\n * const db = client.db();\n *\n * // Create a collection that validates our union\n * await db.createCollection<Pet>('pets', {\n *   validator: { $expr: { $in: ['$kind', ['dog', 'cat', 'fish']] } }\n * })\n * ```\n */\nclass Db {\n    /**\n     * Creates a new Db instance.\n     *\n     * Db name cannot contain a dot, the server may apply more restrictions when an operation is run.\n     *\n     * @param client - The MongoClient for the database.\n     * @param databaseName - The name of the database this instance represents.\n     * @param options - Optional settings for Db construction.\n     */\n    constructor(client, databaseName, options) {\n        options = options ?? {};\n        // Filter the options\n        options = (0, utils_1.filterOptions)(options, DB_OPTIONS_ALLOW_LIST);\n        // Ensure there are no dots in database name\n        if (typeof databaseName === 'string' && databaseName.includes('.')) {\n            throw new error_1.MongoInvalidArgumentError(`Database names cannot contain the character '.'`);\n        }\n        // Internal state of the db object\n        this.s = {\n            // Options\n            options,\n            // Unpack read preference\n            readPreference: read_preference_1.ReadPreference.fromOptions(options),\n            // Merge bson options\n            bsonOptions: (0, bson_1.resolveBSONOptions)(options, client),\n            // Set up the primary key factory or fallback to ObjectId\n            pkFactory: options?.pkFactory ?? utils_1.DEFAULT_PK_FACTORY,\n            // ReadConcern\n            readConcern: read_concern_1.ReadConcern.fromOptions(options),\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options),\n            // Namespace\n            namespace: new utils_1.MongoDBNamespace(databaseName)\n        };\n        this.client = client;\n    }\n    get databaseName() {\n        return this.s.namespace.db;\n    }\n    // Options\n    get options() {\n        return this.s.options;\n    }\n    /**\n     * Check if a secondary can be used (because the read preference is *not* set to primary)\n     */\n    get secondaryOk() {\n        return this.s.readPreference?.preference !== 'primary' || false;\n    }\n    get readConcern() {\n        return this.s.readConcern;\n    }\n    /**\n     * The current readPreference of the Db. If not explicitly defined for\n     * this Db, will be inherited from the parent MongoClient\n     */\n    get readPreference() {\n        if (this.s.readPreference == null) {\n            return this.client.readPreference;\n        }\n        return this.s.readPreference;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    // get the write Concern\n    get writeConcern() {\n        return this.s.writeConcern;\n    }\n    get namespace() {\n        return this.s.namespace.toString();\n    }\n    get timeoutMS() {\n        return this.s.options?.timeoutMS;\n    }\n    /**\n     * Create a new collection on a server with the specified options. Use this to create capped collections.\n     * More information about command options available at https://www.mongodb.com/docs/manual/reference/command/create/\n     *\n     * Collection namespace validation is performed server-side.\n     *\n     * @param name - The name of the collection to create\n     * @param options - Optional settings for the command\n     */\n    async createCollection(name, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new create_collection_1.CreateCollectionOperation(this, name, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Execute a command\n     *\n     * @remarks\n     * This command does not inherit options from the MongoClient.\n     *\n     * The driver will ensure the following fields are attached to the command sent to the server:\n     * - `lsid` - sourced from an implicit session or options.session\n     * - `$readPreference` - defaults to primary or can be configured by options.readPreference\n     * - `$db` - sourced from the name of this database\n     *\n     * If the client has a serverApi setting:\n     * - `apiVersion`\n     * - `apiStrict`\n     * - `apiDeprecationErrors`\n     *\n     * When in a transaction:\n     * - `readConcern` - sourced from readConcern set on the TransactionOptions\n     * - `writeConcern` - sourced from writeConcern set on the TransactionOptions\n     *\n     * Attaching any of the above fields to the command will have no effect as the driver will overwrite the value.\n     *\n     * @param command - The command to run\n     * @param options - Optional settings for the command\n     */\n    async command(command, options) {\n        // Intentionally, we do not inherit options from parent for this operation.\n        return await (0, execute_operation_1.executeOperation)(this.client, new run_command_1.RunCommandOperation(this, command, (0, utils_1.resolveOptions)(undefined, {\n            ...(0, bson_1.resolveBSONOptions)(options),\n            timeoutMS: options?.timeoutMS ?? this.timeoutMS,\n            session: options?.session,\n            readPreference: options?.readPreference,\n            signal: options?.signal\n        })));\n    }\n    /**\n     * Execute an aggregation framework pipeline against the database.\n     *\n     * @param pipeline - An array of aggregation stages to be executed\n     * @param options - Optional settings for the command\n     */\n    aggregate(pipeline = [], options) {\n        return new aggregation_cursor_1.AggregationCursor(this.client, this.s.namespace, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /** Return the Admin db instance */\n    admin() {\n        return new admin_1.Admin(this);\n    }\n    /**\n     * Returns a reference to a MongoDB Collection. If it does not exist it will be created implicitly.\n     *\n     * Collection namespace validation is performed server-side.\n     *\n     * @param name - the collection name we wish to access.\n     * @returns return the new Collection instance\n     */\n    collection(name, options = {}) {\n        if (typeof options === 'function') {\n            throw new error_1.MongoInvalidArgumentError('The callback form of this helper has been removed.');\n        }\n        return new collection_1.Collection(this, name, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Get all the db statistics.\n     *\n     * @param options - Optional settings for the command\n     */\n    async stats(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new stats_1.DbStatsOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    listCollections(filter = {}, options = {}) {\n        return new list_collections_cursor_1.ListCollectionsCursor(this, filter, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Rename a collection.\n     *\n     * @remarks\n     * This operation does not inherit options from the MongoClient.\n     *\n     * @param fromCollection - Name of current collection to rename\n     * @param toCollection - New name of of the collection\n     * @param options - Optional settings for the command\n     */\n    async renameCollection(fromCollection, toCollection, options) {\n        // Intentionally, we do not inherit options from parent for this operation.\n        return await (0, execute_operation_1.executeOperation)(this.client, new rename_1.RenameOperation(this.collection(fromCollection), toCollection, (0, utils_1.resolveOptions)(undefined, {\n            ...options,\n            new_collection: true,\n            readPreference: read_preference_1.ReadPreference.primary\n        })));\n    }\n    /**\n     * Drop a collection from the database, removing it permanently. New accesses will create a new collection.\n     *\n     * @param name - Name of collection to drop\n     * @param options - Optional settings for the command\n     */\n    async dropCollection(name, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new drop_1.DropCollectionOperation(this, name, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Drop a database, removing it permanently from the server.\n     *\n     * @param options - Optional settings for the command\n     */\n    async dropDatabase(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new drop_1.DropDatabaseOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Fetch all collections for the current db.\n     *\n     * @param options - Optional settings for the command\n     */\n    async collections(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new collections_1.CollectionsOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Creates an index on the db and collection.\n     *\n     * @param name - Name of the collection to create the index on.\n     * @param indexSpec - Specify the field to index, or an index specification\n     * @param options - Optional settings for the command\n     */\n    async createIndex(name, indexSpec, options) {\n        const indexes = await (0, execute_operation_1.executeOperation)(this.client, indexes_1.CreateIndexesOperation.fromIndexSpecification(this, name, indexSpec, options));\n        return indexes[0];\n    }\n    /**\n     * Remove a user from a database\n     *\n     * @param username - The username to remove\n     * @param options - Optional settings for the command\n     */\n    async removeUser(username, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new remove_user_1.RemoveUserOperation(this, username, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Set the current profiling level of MongoDB\n     *\n     * @param level - The new profiling level (off, slow_only, all).\n     * @param options - Optional settings for the command\n     */\n    async setProfilingLevel(level, options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new set_profiling_level_1.SetProfilingLevelOperation(this, level, (0, utils_1.resolveOptions)(this, options)));\n    }\n    /**\n     * Retrieve the current profiling Level for MongoDB\n     *\n     * @param options - Optional settings for the command\n     */\n    async profilingLevel(options) {\n        return await (0, execute_operation_1.executeOperation)(this.client, new profiling_level_1.ProfilingLevelOperation(this, (0, utils_1.resolveOptions)(this, options)));\n    }\n    async indexInformation(name, options) {\n        return await this.collection(name).indexInformation((0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * Create a new Change Stream, watching for new changes (insertions, updates,\n     * replacements, deletions, and invalidations) in this database. Will ignore all\n     * changes to system collections.\n     *\n     * @remarks\n     * watch() accepts two generic arguments for distinct use cases:\n     * - The first is to provide the schema that may be defined for all the collections within this database\n     * - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument\n     *\n     * @remarks\n     * When `timeoutMS` is configured for a change stream, it will have different behaviour depending\n     * on whether the change stream is in iterator mode or emitter mode. In both cases, a change\n     * stream will time out if it does not receive a change event within `timeoutMS` of the last change\n     * event.\n     *\n     * Note that if a change stream is consistently timing out when watching a collection, database or\n     * client that is being changed, then this may be due to the server timing out before it can finish\n     * processing the existing oplog. To address this, restart the change stream with a higher\n     * `timeoutMS`.\n     *\n     * If the change stream times out the initial aggregate operation to establish the change stream on\n     * the server, then the client will close the change stream. If the getMore calls to the server\n     * time out, then the change stream will be left open, but will throw a MongoOperationTimeoutError\n     * when in iterator mode and emit an error event that returns a MongoOperationTimeoutError in\n     * emitter mode.\n     *\n     * To determine whether or not the change stream is still open following a timeout, check the\n     * {@link ChangeStream.closed} getter.\n     *\n     * @example\n     * In iterator mode, if a next() call throws a timeout error, it will attempt to resume the change stream.\n     * The next call can just be retried after this succeeds.\n     * ```ts\n     * const changeStream = collection.watch([], { timeoutMS: 100 });\n     * try {\n     *     await changeStream.next();\n     * } catch (e) {\n     *     if (e instanceof MongoOperationTimeoutError && !changeStream.closed) {\n     *       await changeStream.next();\n     *     }\n     *     throw e;\n     * }\n     * ```\n     *\n     * @example\n     * In emitter mode, if the change stream goes `timeoutMS` without emitting a change event, it will\n     * emit an error event that returns a MongoOperationTimeoutError, but will not close the change\n     * stream unless the resume attempt fails. There is no need to re-establish change listeners as\n     * this will automatically continue emitting change events once the resume attempt completes.\n     *\n     * ```ts\n     * const changeStream = collection.watch([], { timeoutMS: 100 });\n     * changeStream.on('change', console.log);\n     * changeStream.on('error', e => {\n     *     if (e instanceof MongoOperationTimeoutError && !changeStream.closed) {\n     *         // do nothing\n     *     } else {\n     *         changeStream.close();\n     *     }\n     * });\n     * ```\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\n     * @param options - Optional settings for the command\n     * @typeParam TSchema - Type of the data being detected by the change stream\n     * @typeParam TChange - Type of the whole change stream document emitted\n     */\n    watch(pipeline = [], options = {}) {\n        // Allow optionally not specifying a pipeline\n        if (!Array.isArray(pipeline)) {\n            options = pipeline;\n            pipeline = [];\n        }\n        return new change_stream_1.ChangeStream(this, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n    /**\n     * A low level cursor API providing basic driver functionality:\n     * - ClientSession management\n     * - ReadPreference for server selection\n     * - Running getMores automatically when a local batch is exhausted\n     *\n     * @param command - The command that will start a cursor on the server.\n     * @param options - Configurations for running the command, bson options will apply to getMores\n     */\n    runCursorCommand(command, options) {\n        return new run_command_cursor_1.RunCommandCursor(this, command, options);\n    }\n}\nexports.Db = Db;\nDb.SYSTEM_NAMESPACE_COLLECTION = CONSTANTS.SYSTEM_NAMESPACE_COLLECTION;\nDb.SYSTEM_INDEX_COLLECTION = CONSTANTS.SYSTEM_INDEX_COLLECTION;\nDb.SYSTEM_PROFILE_COLLECTION = CONSTANTS.SYSTEM_PROFILE_COLLECTION;\nDb.SYSTEM_USER_COLLECTION = CONSTANTS.SYSTEM_USER_COLLECTION;\nDb.SYSTEM_COMMAND_COLLECTION = CONSTANTS.SYSTEM_COMMAND_COLLECTION;\nDb.SYSTEM_JS_COLLECTION = CONSTANTS.SYSTEM_JS_COLLECTION;\n//# sourceMappingURL=db.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2RiLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFVBQVU7QUFDVixnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQyxlQUFlLG1CQUFPLENBQUMsMEZBQVE7QUFDL0Isd0JBQXdCLG1CQUFPLENBQUMsNEdBQWlCO0FBQ2pELHFCQUFxQixtQkFBTyxDQUFDLHNHQUFjO0FBQzNDLGtCQUFrQixtQkFBTyxDQUFDLG9HQUFhO0FBQ3ZDLDZCQUE2QixtQkFBTyxDQUFDLG9JQUE2QjtBQUNsRSxrQ0FBa0MsbUJBQU8sQ0FBQyw4SUFBa0M7QUFDNUUsNkJBQTZCLG1CQUFPLENBQUMsb0lBQTZCO0FBQ2xFLGdCQUFnQixtQkFBTyxDQUFDLDRGQUFTO0FBQ2pDLHNCQUFzQixtQkFBTyxDQUFDLDhIQUEwQjtBQUN4RCw0QkFBNEIsbUJBQU8sQ0FBQywwSUFBZ0M7QUFDcEUsZUFBZSxtQkFBTyxDQUFDLGdIQUFtQjtBQUMxQyw0QkFBNEIsbUJBQU8sQ0FBQywwSUFBZ0M7QUFDcEUsa0JBQWtCLG1CQUFPLENBQUMsc0hBQXNCO0FBQ2hELDBCQUEwQixtQkFBTyxDQUFDLHNJQUE4QjtBQUNoRSxzQkFBc0IsbUJBQU8sQ0FBQyw4SEFBMEI7QUFDeEQsaUJBQWlCLG1CQUFPLENBQUMsb0hBQXFCO0FBQzlDLHNCQUFzQixtQkFBTyxDQUFDLDhIQUEwQjtBQUN4RCw4QkFBOEIsbUJBQU8sQ0FBQyw4SUFBa0M7QUFDeEUsZ0JBQWdCLG1CQUFPLENBQUMsa0hBQW9CO0FBQzVDLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDckQsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsd0JBQXdCLG1CQUFPLENBQUMsNEdBQWlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUztBQUMzQixJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixjQUFjO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsMkJBQTJCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsZ0JBQWdCO0FBQ25FO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxnQkFBZ0I7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLHNDQUFzQyxnSEFBZ0g7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2RiLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EYiA9IHZvaWQgMDtcbmNvbnN0IGFkbWluXzEgPSByZXF1aXJlKFwiLi9hZG1pblwiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5jb25zdCBjaGFuZ2Vfc3RyZWFtXzEgPSByZXF1aXJlKFwiLi9jaGFuZ2Vfc3RyZWFtXCIpO1xuY29uc3QgY29sbGVjdGlvbl8xID0gcmVxdWlyZShcIi4vY29sbGVjdGlvblwiKTtcbmNvbnN0IENPTlNUQU5UUyA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2FnZ3JlZ2F0aW9uX2N1cnNvclwiKTtcbmNvbnN0IGxpc3RfY29sbGVjdGlvbnNfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvbGlzdF9jb2xsZWN0aW9uc19jdXJzb3JcIik7XG5jb25zdCBydW5fY29tbWFuZF9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2N1cnNvci9ydW5fY29tbWFuZF9jdXJzb3JcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBjb2xsZWN0aW9uc18xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9jb2xsZWN0aW9uc1wiKTtcbmNvbnN0IGNyZWF0ZV9jb2xsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2NyZWF0ZV9jb2xsZWN0aW9uXCIpO1xuY29uc3QgZHJvcF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9kcm9wXCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBpbmRleGVzXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2luZGV4ZXNcIik7XG5jb25zdCBwcm9maWxpbmdfbGV2ZWxfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcHJvZmlsaW5nX2xldmVsXCIpO1xuY29uc3QgcmVtb3ZlX3VzZXJfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcmVtb3ZlX3VzZXJcIik7XG5jb25zdCByZW5hbWVfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcmVuYW1lXCIpO1xuY29uc3QgcnVuX2NvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcnVuX2NvbW1hbmRcIik7XG5jb25zdCBzZXRfcHJvZmlsaW5nX2xldmVsXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL3NldF9wcm9maWxpbmdfbGV2ZWxcIik7XG5jb25zdCBzdGF0c18xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9zdGF0c1wiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuLy8gQWxsb3dlZCBwYXJhbWV0ZXJzXG5jb25zdCBEQl9PUFRJT05TX0FMTE9XX0xJU1QgPSBbXG4gICAgJ3dyaXRlQ29uY2VybicsXG4gICAgJ3JlYWRQcmVmZXJlbmNlJyxcbiAgICAncmVhZFByZWZlcmVuY2VUYWdzJyxcbiAgICAnbmF0aXZlX3BhcnNlcicsXG4gICAgJ2ZvcmNlU2VydmVyT2JqZWN0SWQnLFxuICAgICdwa0ZhY3RvcnknLFxuICAgICdzZXJpYWxpemVGdW5jdGlvbnMnLFxuICAgICdyYXcnLFxuICAgICdhdXRoU291cmNlJyxcbiAgICAnaWdub3JlVW5kZWZpbmVkJyxcbiAgICAncmVhZENvbmNlcm4nLFxuICAgICdyZXRyeU1pbGlTZWNvbmRzJyxcbiAgICAnbnVtYmVyT2ZSZXRyaWVzJyxcbiAgICAndXNlQmlnSW50NjQnLFxuICAgICdwcm9tb3RlQnVmZmVycycsXG4gICAgJ3Byb21vdGVMb25ncycsXG4gICAgJ2Jzb25SZWdFeHAnLFxuICAgICdlbmFibGVVdGY4VmFsaWRhdGlvbicsXG4gICAgJ3Byb21vdGVWYWx1ZXMnLFxuICAgICdjb21wcmVzc2lvbicsXG4gICAgJ3JldHJ5V3JpdGVzJyxcbiAgICAndGltZW91dE1TJ1xuXTtcbi8qKlxuICogVGhlICoqRGIqKiBjbGFzcyBpcyBhIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIE1vbmdvREIgRGF0YWJhc2UuXG4gKiBAcHVibGljXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuICpcbiAqIGludGVyZmFjZSBQZXQge1xuICogICBuYW1lOiBzdHJpbmc7XG4gKiAgIGtpbmQ6ICdkb2cnIHwgJ2NhdCcgfCAnZmlzaCc7XG4gKiB9XG4gKlxuICogY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3Jyk7XG4gKiBjb25zdCBkYiA9IGNsaWVudC5kYigpO1xuICpcbiAqIC8vIENyZWF0ZSBhIGNvbGxlY3Rpb24gdGhhdCB2YWxpZGF0ZXMgb3VyIHVuaW9uXG4gKiBhd2FpdCBkYi5jcmVhdGVDb2xsZWN0aW9uPFBldD4oJ3BldHMnLCB7XG4gKiAgIHZhbGlkYXRvcjogeyAkZXhwcjogeyAkaW46IFsnJGtpbmQnLCBbJ2RvZycsICdjYXQnLCAnZmlzaCddXSB9IH1cbiAqIH0pXG4gKiBgYGBcbiAqL1xuY2xhc3MgRGIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRGIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBEYiBuYW1lIGNhbm5vdCBjb250YWluIGEgZG90LCB0aGUgc2VydmVyIG1heSBhcHBseSBtb3JlIHJlc3RyaWN0aW9ucyB3aGVuIGFuIG9wZXJhdGlvbiBpcyBydW4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2xpZW50IC0gVGhlIE1vbmdvQ2xpZW50IGZvciB0aGUgZGF0YWJhc2UuXG4gICAgICogQHBhcmFtIGRhdGFiYXNlTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSB0aGlzIGluc3RhbmNlIHJlcHJlc2VudHMuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgRGIgY29uc3RydWN0aW9uLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNsaWVudCwgZGF0YWJhc2VOYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICAvLyBGaWx0ZXIgdGhlIG9wdGlvbnNcbiAgICAgICAgb3B0aW9ucyA9ICgwLCB1dGlsc18xLmZpbHRlck9wdGlvbnMpKG9wdGlvbnMsIERCX09QVElPTlNfQUxMT1dfTElTVCk7XG4gICAgICAgIC8vIEVuc3VyZSB0aGVyZSBhcmUgbm8gZG90cyBpbiBkYXRhYmFzZSBuYW1lXG4gICAgICAgIGlmICh0eXBlb2YgZGF0YWJhc2VOYW1lID09PSAnc3RyaW5nJyAmJiBkYXRhYmFzZU5hbWUuaW5jbHVkZXMoJy4nKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgRGF0YWJhc2UgbmFtZXMgY2Fubm90IGNvbnRhaW4gdGhlIGNoYXJhY3RlciAnLidgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbnRlcm5hbCBzdGF0ZSBvZiB0aGUgZGIgb2JqZWN0XG4gICAgICAgIHRoaXMucyA9IHtcbiAgICAgICAgICAgIC8vIE9wdGlvbnNcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICAvLyBVbnBhY2sgcmVhZCBwcmVmZXJlbmNlXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMob3B0aW9ucyksXG4gICAgICAgICAgICAvLyBNZXJnZSBic29uIG9wdGlvbnNcbiAgICAgICAgICAgIGJzb25PcHRpb25zOiAoMCwgYnNvbl8xLnJlc29sdmVCU09OT3B0aW9ucykob3B0aW9ucywgY2xpZW50KSxcbiAgICAgICAgICAgIC8vIFNldCB1cCB0aGUgcHJpbWFyeSBrZXkgZmFjdG9yeSBvciBmYWxsYmFjayB0byBPYmplY3RJZFxuICAgICAgICAgICAgcGtGYWN0b3J5OiBvcHRpb25zPy5wa0ZhY3RvcnkgPz8gdXRpbHNfMS5ERUZBVUxUX1BLX0ZBQ1RPUlksXG4gICAgICAgICAgICAvLyBSZWFkQ29uY2VyblxuICAgICAgICAgICAgcmVhZENvbmNlcm46IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpLFxuICAgICAgICAgICAgd3JpdGVDb25jZXJuOiB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpLFxuICAgICAgICAgICAgLy8gTmFtZXNwYWNlXG4gICAgICAgICAgICBuYW1lc3BhY2U6IG5ldyB1dGlsc18xLk1vbmdvREJOYW1lc3BhY2UoZGF0YWJhc2VOYW1lKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcbiAgICB9XG4gICAgZ2V0IGRhdGFiYXNlTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5uYW1lc3BhY2UuZGI7XG4gICAgfVxuICAgIC8vIE9wdGlvbnNcbiAgICBnZXQgb3B0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBhIHNlY29uZGFyeSBjYW4gYmUgdXNlZCAoYmVjYXVzZSB0aGUgcmVhZCBwcmVmZXJlbmNlIGlzICpub3QqIHNldCB0byBwcmltYXJ5KVxuICAgICAqL1xuICAgIGdldCBzZWNvbmRhcnlPaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5yZWFkUHJlZmVyZW5jZT8ucHJlZmVyZW5jZSAhPT0gJ3ByaW1hcnknIHx8IGZhbHNlO1xuICAgIH1cbiAgICBnZXQgcmVhZENvbmNlcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMucmVhZENvbmNlcm47XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHJlYWRQcmVmZXJlbmNlIG9mIHRoZSBEYi4gSWYgbm90IGV4cGxpY2l0bHkgZGVmaW5lZCBmb3JcbiAgICAgKiB0aGlzIERiLCB3aWxsIGJlIGluaGVyaXRlZCBmcm9tIHRoZSBwYXJlbnQgTW9uZ29DbGllbnRcbiAgICAgKi9cbiAgICBnZXQgcmVhZFByZWZlcmVuY2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnMucmVhZFByZWZlcmVuY2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnMucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGdldCBic29uT3B0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5ic29uT3B0aW9ucztcbiAgICB9XG4gICAgLy8gZ2V0IHRoZSB3cml0ZSBDb25jZXJuXG4gICAgZ2V0IHdyaXRlQ29uY2VybigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy53cml0ZUNvbmNlcm47XG4gICAgfVxuICAgIGdldCBuYW1lc3BhY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMubmFtZXNwYWNlLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGdldCB0aW1lb3V0TVMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMub3B0aW9ucz8udGltZW91dE1TO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgY29sbGVjdGlvbiBvbiBhIHNlcnZlciB3aXRoIHRoZSBzcGVjaWZpZWQgb3B0aW9ucy4gVXNlIHRoaXMgdG8gY3JlYXRlIGNhcHBlZCBjb2xsZWN0aW9ucy5cbiAgICAgKiBNb3JlIGluZm9ybWF0aW9uIGFib3V0IGNvbW1hbmQgb3B0aW9ucyBhdmFpbGFibGUgYXQgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL2NvbW1hbmQvY3JlYXRlL1xuICAgICAqXG4gICAgICogQ29sbGVjdGlvbiBuYW1lc3BhY2UgdmFsaWRhdGlvbiBpcyBwZXJmb3JtZWQgc2VydmVyLXNpZGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjb2xsZWN0aW9uIHRvIGNyZWF0ZVxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlQ29sbGVjdGlvbihuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGNyZWF0ZV9jb2xsZWN0aW9uXzEuQ3JlYXRlQ29sbGVjdGlvbk9wZXJhdGlvbih0aGlzLCBuYW1lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhIGNvbW1hbmRcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjb21tYW5kIGRvZXMgbm90IGluaGVyaXQgb3B0aW9ucyBmcm9tIHRoZSBNb25nb0NsaWVudC5cbiAgICAgKlxuICAgICAqIFRoZSBkcml2ZXIgd2lsbCBlbnN1cmUgdGhlIGZvbGxvd2luZyBmaWVsZHMgYXJlIGF0dGFjaGVkIHRvIHRoZSBjb21tYW5kIHNlbnQgdG8gdGhlIHNlcnZlcjpcbiAgICAgKiAtIGBsc2lkYCAtIHNvdXJjZWQgZnJvbSBhbiBpbXBsaWNpdCBzZXNzaW9uIG9yIG9wdGlvbnMuc2Vzc2lvblxuICAgICAqIC0gYCRyZWFkUHJlZmVyZW5jZWAgLSBkZWZhdWx0cyB0byBwcmltYXJ5IG9yIGNhbiBiZSBjb25maWd1cmVkIGJ5IG9wdGlvbnMucmVhZFByZWZlcmVuY2VcbiAgICAgKiAtIGAkZGJgIC0gc291cmNlZCBmcm9tIHRoZSBuYW1lIG9mIHRoaXMgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIElmIHRoZSBjbGllbnQgaGFzIGEgc2VydmVyQXBpIHNldHRpbmc6XG4gICAgICogLSBgYXBpVmVyc2lvbmBcbiAgICAgKiAtIGBhcGlTdHJpY3RgXG4gICAgICogLSBgYXBpRGVwcmVjYXRpb25FcnJvcnNgXG4gICAgICpcbiAgICAgKiBXaGVuIGluIGEgdHJhbnNhY3Rpb246XG4gICAgICogLSBgcmVhZENvbmNlcm5gIC0gc291cmNlZCBmcm9tIHJlYWRDb25jZXJuIHNldCBvbiB0aGUgVHJhbnNhY3Rpb25PcHRpb25zXG4gICAgICogLSBgd3JpdGVDb25jZXJuYCAtIHNvdXJjZWQgZnJvbSB3cml0ZUNvbmNlcm4gc2V0IG9uIHRoZSBUcmFuc2FjdGlvbk9wdGlvbnNcbiAgICAgKlxuICAgICAqIEF0dGFjaGluZyBhbnkgb2YgdGhlIGFib3ZlIGZpZWxkcyB0byB0aGUgY29tbWFuZCB3aWxsIGhhdmUgbm8gZWZmZWN0IGFzIHRoZSBkcml2ZXIgd2lsbCBvdmVyd3JpdGUgdGhlIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbW1hbmQgLSBUaGUgY29tbWFuZCB0byBydW5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIGNvbW1hbmQoY29tbWFuZCwgb3B0aW9ucykge1xuICAgICAgICAvLyBJbnRlbnRpb25hbGx5LCB3ZSBkbyBub3QgaW5oZXJpdCBvcHRpb25zIGZyb20gcGFyZW50IGZvciB0aGlzIG9wZXJhdGlvbi5cbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgcnVuX2NvbW1hbmRfMS5SdW5Db21tYW5kT3BlcmF0aW9uKHRoaXMsIGNvbW1hbmQsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh1bmRlZmluZWQsIHtcbiAgICAgICAgICAgIC4uLigwLCBic29uXzEucmVzb2x2ZUJTT05PcHRpb25zKShvcHRpb25zKSxcbiAgICAgICAgICAgIHRpbWVvdXRNUzogb3B0aW9ucz8udGltZW91dE1TID8/IHRoaXMudGltZW91dE1TLFxuICAgICAgICAgICAgc2Vzc2lvbjogb3B0aW9ucz8uc2Vzc2lvbixcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiBvcHRpb25zPy5yZWFkUHJlZmVyZW5jZSxcbiAgICAgICAgICAgIHNpZ25hbDogb3B0aW9ucz8uc2lnbmFsXG4gICAgICAgIH0pKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgYW4gYWdncmVnYXRpb24gZnJhbWV3b3JrIHBpcGVsaW5lIGFnYWluc3QgdGhlIGRhdGFiYXNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBpcGVsaW5lIC0gQW4gYXJyYXkgb2YgYWdncmVnYXRpb24gc3RhZ2VzIHRvIGJlIGV4ZWN1dGVkXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhZ2dyZWdhdGUocGlwZWxpbmUgPSBbXSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xLkFnZ3JlZ2F0aW9uQ3Vyc29yKHRoaXMuY2xpZW50LCB0aGlzLnMubmFtZXNwYWNlLCBwaXBlbGluZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgLyoqIFJldHVybiB0aGUgQWRtaW4gZGIgaW5zdGFuY2UgKi9cbiAgICBhZG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBhZG1pbl8xLkFkbWluKHRoaXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIGEgTW9uZ29EQiBDb2xsZWN0aW9uLiBJZiBpdCBkb2VzIG5vdCBleGlzdCBpdCB3aWxsIGJlIGNyZWF0ZWQgaW1wbGljaXRseS5cbiAgICAgKlxuICAgICAqIENvbGxlY3Rpb24gbmFtZXNwYWNlIHZhbGlkYXRpb24gaXMgcGVyZm9ybWVkIHNlcnZlci1zaWRlLlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSB0aGUgY29sbGVjdGlvbiBuYW1lIHdlIHdpc2ggdG8gYWNjZXNzLlxuICAgICAqIEByZXR1cm5zIHJldHVybiB0aGUgbmV3IENvbGxlY3Rpb24gaW5zdGFuY2VcbiAgICAgKi9cbiAgICBjb2xsZWN0aW9uKG5hbWUsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1RoZSBjYWxsYmFjayBmb3JtIG9mIHRoaXMgaGVscGVyIGhhcyBiZWVuIHJlbW92ZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBjb2xsZWN0aW9uXzEuQ29sbGVjdGlvbih0aGlzLCBuYW1lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSBkYiBzdGF0aXN0aWNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBzdGF0cyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHN0YXRzXzEuRGJTdGF0c09wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgbGlzdENvbGxlY3Rpb25zKGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xLkxpc3RDb2xsZWN0aW9uc0N1cnNvcih0aGlzLCBmaWx0ZXIsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbmFtZSBhIGNvbGxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgb3BlcmF0aW9uIGRvZXMgbm90IGluaGVyaXQgb3B0aW9ucyBmcm9tIHRoZSBNb25nb0NsaWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmcm9tQ29sbGVjdGlvbiAtIE5hbWUgb2YgY3VycmVudCBjb2xsZWN0aW9uIHRvIHJlbmFtZVxuICAgICAqIEBwYXJhbSB0b0NvbGxlY3Rpb24gLSBOZXcgbmFtZSBvZiBvZiB0aGUgY29sbGVjdGlvblxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgcmVuYW1lQ29sbGVjdGlvbihmcm9tQ29sbGVjdGlvbiwgdG9Db2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIC8vIEludGVudGlvbmFsbHksIHdlIGRvIG5vdCBpbmhlcml0IG9wdGlvbnMgZnJvbSBwYXJlbnQgZm9yIHRoaXMgb3BlcmF0aW9uLlxuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyByZW5hbWVfMS5SZW5hbWVPcGVyYXRpb24odGhpcy5jb2xsZWN0aW9uKGZyb21Db2xsZWN0aW9uKSwgdG9Db2xsZWN0aW9uLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodW5kZWZpbmVkLCB7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgbmV3X2NvbGxlY3Rpb246IHRydWUsXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeVxuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcm9wIGEgY29sbGVjdGlvbiBmcm9tIHRoZSBkYXRhYmFzZSwgcmVtb3ZpbmcgaXQgcGVybWFuZW50bHkuIE5ldyBhY2Nlc3NlcyB3aWxsIGNyZWF0ZSBhIG5ldyBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSBOYW1lIG9mIGNvbGxlY3Rpb24gdG8gZHJvcFxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgZHJvcENvbGxlY3Rpb24obmFtZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBkcm9wXzEuRHJvcENvbGxlY3Rpb25PcGVyYXRpb24odGhpcywgbmFtZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERyb3AgYSBkYXRhYmFzZSwgcmVtb3ZpbmcgaXQgcGVybWFuZW50bHkgZnJvbSB0aGUgc2VydmVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBkcm9wRGF0YWJhc2Uob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBkcm9wXzEuRHJvcERhdGFiYXNlT3BlcmF0aW9uKHRoaXMsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgY29sbGVjdGlvbnMgZm9yIHRoZSBjdXJyZW50IGRiLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBjb2xsZWN0aW9ucyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IGNvbGxlY3Rpb25zXzEuQ29sbGVjdGlvbnNPcGVyYXRpb24odGhpcywgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gaW5kZXggb24gdGhlIGRiIGFuZCBjb2xsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgLSBOYW1lIG9mIHRoZSBjb2xsZWN0aW9uIHRvIGNyZWF0ZSB0aGUgaW5kZXggb24uXG4gICAgICogQHBhcmFtIGluZGV4U3BlYyAtIFNwZWNpZnkgdGhlIGZpZWxkIHRvIGluZGV4LCBvciBhbiBpbmRleCBzcGVjaWZpY2F0aW9uXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBjcmVhdGVJbmRleChuYW1lLCBpbmRleFNwZWMsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgaW5kZXhlcyA9IGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBpbmRleGVzXzEuQ3JlYXRlSW5kZXhlc09wZXJhdGlvbi5mcm9tSW5kZXhTcGVjaWZpY2F0aW9uKHRoaXMsIG5hbWUsIGluZGV4U3BlYywgb3B0aW9ucykpO1xuICAgICAgICByZXR1cm4gaW5kZXhlc1swXTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgdXNlciBmcm9tIGEgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VybmFtZSAtIFRoZSB1c2VybmFtZSB0byByZW1vdmVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgY29tbWFuZFxuICAgICAqL1xuICAgIGFzeW5jIHJlbW92ZVVzZXIodXNlcm5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBuZXcgcmVtb3ZlX3VzZXJfMS5SZW1vdmVVc2VyT3BlcmF0aW9uKHRoaXMsIHVzZXJuYW1lLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBjdXJyZW50IHByb2ZpbGluZyBsZXZlbCBvZiBNb25nb0RCXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbGV2ZWwgLSBUaGUgbmV3IHByb2ZpbGluZyBsZXZlbCAob2ZmLCBzbG93X29ubHksIGFsbCkuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKi9cbiAgICBhc3luYyBzZXRQcm9maWxpbmdMZXZlbChsZXZlbCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBzZXRfcHJvZmlsaW5nX2xldmVsXzEuU2V0UHJvZmlsaW5nTGV2ZWxPcGVyYXRpb24odGhpcywgbGV2ZWwsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSB0aGUgY3VycmVudCBwcm9maWxpbmcgTGV2ZWwgZm9yIE1vbmdvREJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICovXG4gICAgYXN5bmMgcHJvZmlsaW5nTGV2ZWwob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG5ldyBwcm9maWxpbmdfbGV2ZWxfMS5Qcm9maWxpbmdMZXZlbE9wZXJhdGlvbih0aGlzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgYXN5bmMgaW5kZXhJbmZvcm1hdGlvbihuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbGxlY3Rpb24obmFtZSkuaW5kZXhJbmZvcm1hdGlvbigoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbmdlIFN0cmVhbSwgd2F0Y2hpbmcgZm9yIG5ldyBjaGFuZ2VzIChpbnNlcnRpb25zLCB1cGRhdGVzLFxuICAgICAqIHJlcGxhY2VtZW50cywgZGVsZXRpb25zLCBhbmQgaW52YWxpZGF0aW9ucykgaW4gdGhpcyBkYXRhYmFzZS4gV2lsbCBpZ25vcmUgYWxsXG4gICAgICogY2hhbmdlcyB0byBzeXN0ZW0gY29sbGVjdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIHdhdGNoKCkgYWNjZXB0cyB0d28gZ2VuZXJpYyBhcmd1bWVudHMgZm9yIGRpc3RpbmN0IHVzZSBjYXNlczpcbiAgICAgKiAtIFRoZSBmaXJzdCBpcyB0byBwcm92aWRlIHRoZSBzY2hlbWEgdGhhdCBtYXkgYmUgZGVmaW5lZCBmb3IgYWxsIHRoZSBjb2xsZWN0aW9ucyB3aXRoaW4gdGhpcyBkYXRhYmFzZVxuICAgICAqIC0gVGhlIHNlY29uZCBpcyB0byBvdmVycmlkZSB0aGUgc2hhcGUgb2YgdGhlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnQgZW50aXJlbHksIGlmIGl0IGlzIG5vdCBwcm92aWRlZCB0aGUgdHlwZSB3aWxsIGRlZmF1bHQgdG8gQ2hhbmdlU3RyZWFtRG9jdW1lbnQgb2YgdGhlIGZpcnN0IGFyZ3VtZW50XG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFdoZW4gYHRpbWVvdXRNU2AgaXMgY29uZmlndXJlZCBmb3IgYSBjaGFuZ2Ugc3RyZWFtLCBpdCB3aWxsIGhhdmUgZGlmZmVyZW50IGJlaGF2aW91ciBkZXBlbmRpbmdcbiAgICAgKiBvbiB3aGV0aGVyIHRoZSBjaGFuZ2Ugc3RyZWFtIGlzIGluIGl0ZXJhdG9yIG1vZGUgb3IgZW1pdHRlciBtb2RlLiBJbiBib3RoIGNhc2VzLCBhIGNoYW5nZVxuICAgICAqIHN0cmVhbSB3aWxsIHRpbWUgb3V0IGlmIGl0IGRvZXMgbm90IHJlY2VpdmUgYSBjaGFuZ2UgZXZlbnQgd2l0aGluIGB0aW1lb3V0TVNgIG9mIHRoZSBsYXN0IGNoYW5nZVxuICAgICAqIGV2ZW50LlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IGlmIGEgY2hhbmdlIHN0cmVhbSBpcyBjb25zaXN0ZW50bHkgdGltaW5nIG91dCB3aGVuIHdhdGNoaW5nIGEgY29sbGVjdGlvbiwgZGF0YWJhc2Ugb3JcbiAgICAgKiBjbGllbnQgdGhhdCBpcyBiZWluZyBjaGFuZ2VkLCB0aGVuIHRoaXMgbWF5IGJlIGR1ZSB0byB0aGUgc2VydmVyIHRpbWluZyBvdXQgYmVmb3JlIGl0IGNhbiBmaW5pc2hcbiAgICAgKiBwcm9jZXNzaW5nIHRoZSBleGlzdGluZyBvcGxvZy4gVG8gYWRkcmVzcyB0aGlzLCByZXN0YXJ0IHRoZSBjaGFuZ2Ugc3RyZWFtIHdpdGggYSBoaWdoZXJcbiAgICAgKiBgdGltZW91dE1TYC5cbiAgICAgKlxuICAgICAqIElmIHRoZSBjaGFuZ2Ugc3RyZWFtIHRpbWVzIG91dCB0aGUgaW5pdGlhbCBhZ2dyZWdhdGUgb3BlcmF0aW9uIHRvIGVzdGFibGlzaCB0aGUgY2hhbmdlIHN0cmVhbSBvblxuICAgICAqIHRoZSBzZXJ2ZXIsIHRoZW4gdGhlIGNsaWVudCB3aWxsIGNsb3NlIHRoZSBjaGFuZ2Ugc3RyZWFtLiBJZiB0aGUgZ2V0TW9yZSBjYWxscyB0byB0aGUgc2VydmVyXG4gICAgICogdGltZSBvdXQsIHRoZW4gdGhlIGNoYW5nZSBzdHJlYW0gd2lsbCBiZSBsZWZ0IG9wZW4sIGJ1dCB3aWxsIHRocm93IGEgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3JcbiAgICAgKiB3aGVuIGluIGl0ZXJhdG9yIG1vZGUgYW5kIGVtaXQgYW4gZXJyb3IgZXZlbnQgdGhhdCByZXR1cm5zIGEgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgaW5cbiAgICAgKiBlbWl0dGVyIG1vZGUuXG4gICAgICpcbiAgICAgKiBUbyBkZXRlcm1pbmUgd2hldGhlciBvciBub3QgdGhlIGNoYW5nZSBzdHJlYW0gaXMgc3RpbGwgb3BlbiBmb2xsb3dpbmcgYSB0aW1lb3V0LCBjaGVjayB0aGVcbiAgICAgKiB7QGxpbmsgQ2hhbmdlU3RyZWFtLmNsb3NlZH0gZ2V0dGVyLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBJbiBpdGVyYXRvciBtb2RlLCBpZiBhIG5leHQoKSBjYWxsIHRocm93cyBhIHRpbWVvdXQgZXJyb3IsIGl0IHdpbGwgYXR0ZW1wdCB0byByZXN1bWUgdGhlIGNoYW5nZSBzdHJlYW0uXG4gICAgICogVGhlIG5leHQgY2FsbCBjYW4ganVzdCBiZSByZXRyaWVkIGFmdGVyIHRoaXMgc3VjY2VlZHMuXG4gICAgICogYGBgdHNcbiAgICAgKiBjb25zdCBjaGFuZ2VTdHJlYW0gPSBjb2xsZWN0aW9uLndhdGNoKFtdLCB7IHRpbWVvdXRNUzogMTAwIH0pO1xuICAgICAqIHRyeSB7XG4gICAgICogICAgIGF3YWl0IGNoYW5nZVN0cmVhbS5uZXh0KCk7XG4gICAgICogfSBjYXRjaCAoZSkge1xuICAgICAqICAgICBpZiAoZSBpbnN0YW5jZW9mIE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yICYmICFjaGFuZ2VTdHJlYW0uY2xvc2VkKSB7XG4gICAgICogICAgICAgYXdhaXQgY2hhbmdlU3RyZWFtLm5leHQoKTtcbiAgICAgKiAgICAgfVxuICAgICAqICAgICB0aHJvdyBlO1xuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogSW4gZW1pdHRlciBtb2RlLCBpZiB0aGUgY2hhbmdlIHN0cmVhbSBnb2VzIGB0aW1lb3V0TVNgIHdpdGhvdXQgZW1pdHRpbmcgYSBjaGFuZ2UgZXZlbnQsIGl0IHdpbGxcbiAgICAgKiBlbWl0IGFuIGVycm9yIGV2ZW50IHRoYXQgcmV0dXJucyBhIE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yLCBidXQgd2lsbCBub3QgY2xvc2UgdGhlIGNoYW5nZVxuICAgICAqIHN0cmVhbSB1bmxlc3MgdGhlIHJlc3VtZSBhdHRlbXB0IGZhaWxzLiBUaGVyZSBpcyBubyBuZWVkIHRvIHJlLWVzdGFibGlzaCBjaGFuZ2UgbGlzdGVuZXJzIGFzXG4gICAgICogdGhpcyB3aWxsIGF1dG9tYXRpY2FsbHkgY29udGludWUgZW1pdHRpbmcgY2hhbmdlIGV2ZW50cyBvbmNlIHRoZSByZXN1bWUgYXR0ZW1wdCBjb21wbGV0ZXMuXG4gICAgICpcbiAgICAgKiBgYGB0c1xuICAgICAqIGNvbnN0IGNoYW5nZVN0cmVhbSA9IGNvbGxlY3Rpb24ud2F0Y2goW10sIHsgdGltZW91dE1TOiAxMDAgfSk7XG4gICAgICogY2hhbmdlU3RyZWFtLm9uKCdjaGFuZ2UnLCBjb25zb2xlLmxvZyk7XG4gICAgICogY2hhbmdlU3RyZWFtLm9uKCdlcnJvcicsIGUgPT4ge1xuICAgICAqICAgICBpZiAoZSBpbnN0YW5jZW9mIE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yICYmICFjaGFuZ2VTdHJlYW0uY2xvc2VkKSB7XG4gICAgICogICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICogICAgIH0gZWxzZSB7XG4gICAgICogICAgICAgICBjaGFuZ2VTdHJlYW0uY2xvc2UoKTtcbiAgICAgKiAgICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqIEBwYXJhbSBwaXBlbGluZSAtIEFuIGFycmF5IG9mIHtAbGluayBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvYWdncmVnYXRpb24tcGlwZWxpbmUvfGFnZ3JlZ2F0aW9uIHBpcGVsaW5lIHN0YWdlc30gdGhyb3VnaCB3aGljaCB0byBwYXNzIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzLiBUaGlzIGFsbG93cyBmb3IgZmlsdGVyaW5nICh1c2luZyAkbWF0Y2gpIGFuZCBtYW5pcHVsYXRpbmcgdGhlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnRzLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSBjb21tYW5kXG4gICAgICogQHR5cGVQYXJhbSBUU2NoZW1hIC0gVHlwZSBvZiB0aGUgZGF0YSBiZWluZyBkZXRlY3RlZCBieSB0aGUgY2hhbmdlIHN0cmVhbVxuICAgICAqIEB0eXBlUGFyYW0gVENoYW5nZSAtIFR5cGUgb2YgdGhlIHdob2xlIGNoYW5nZSBzdHJlYW0gZG9jdW1lbnQgZW1pdHRlZFxuICAgICAqL1xuICAgIHdhdGNoKHBpcGVsaW5lID0gW10sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICAvLyBBbGxvdyBvcHRpb25hbGx5IG5vdCBzcGVjaWZ5aW5nIGEgcGlwZWxpbmVcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBpcGVsaW5lKSkge1xuICAgICAgICAgICAgb3B0aW9ucyA9IHBpcGVsaW5lO1xuICAgICAgICAgICAgcGlwZWxpbmUgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IGNoYW5nZV9zdHJlYW1fMS5DaGFuZ2VTdHJlYW0odGhpcywgcGlwZWxpbmUsICgwLCB1dGlsc18xLnJlc29sdmVPcHRpb25zKSh0aGlzLCBvcHRpb25zKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgbG93IGxldmVsIGN1cnNvciBBUEkgcHJvdmlkaW5nIGJhc2ljIGRyaXZlciBmdW5jdGlvbmFsaXR5OlxuICAgICAqIC0gQ2xpZW50U2Vzc2lvbiBtYW5hZ2VtZW50XG4gICAgICogLSBSZWFkUHJlZmVyZW5jZSBmb3Igc2VydmVyIHNlbGVjdGlvblxuICAgICAqIC0gUnVubmluZyBnZXRNb3JlcyBhdXRvbWF0aWNhbGx5IHdoZW4gYSBsb2NhbCBiYXRjaCBpcyBleGhhdXN0ZWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb21tYW5kIC0gVGhlIGNvbW1hbmQgdGhhdCB3aWxsIHN0YXJ0IGEgY3Vyc29yIG9uIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBDb25maWd1cmF0aW9ucyBmb3IgcnVubmluZyB0aGUgY29tbWFuZCwgYnNvbiBvcHRpb25zIHdpbGwgYXBwbHkgdG8gZ2V0TW9yZXNcbiAgICAgKi9cbiAgICBydW5DdXJzb3JDb21tYW5kKGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBydW5fY29tbWFuZF9jdXJzb3JfMS5SdW5Db21tYW5kQ3Vyc29yKHRoaXMsIGNvbW1hbmQsIG9wdGlvbnMpO1xuICAgIH1cbn1cbmV4cG9ydHMuRGIgPSBEYjtcbkRiLlNZU1RFTV9OQU1FU1BBQ0VfQ09MTEVDVElPTiA9IENPTlNUQU5UUy5TWVNURU1fTkFNRVNQQUNFX0NPTExFQ1RJT047XG5EYi5TWVNURU1fSU5ERVhfQ09MTEVDVElPTiA9IENPTlNUQU5UUy5TWVNURU1fSU5ERVhfQ09MTEVDVElPTjtcbkRiLlNZU1RFTV9QUk9GSUxFX0NPTExFQ1RJT04gPSBDT05TVEFOVFMuU1lTVEVNX1BST0ZJTEVfQ09MTEVDVElPTjtcbkRiLlNZU1RFTV9VU0VSX0NPTExFQ1RJT04gPSBDT05TVEFOVFMuU1lTVEVNX1VTRVJfQ09MTEVDVElPTjtcbkRiLlNZU1RFTV9DT01NQU5EX0NPTExFQ1RJT04gPSBDT05TVEFOVFMuU1lTVEVNX0NPTU1BTkRfQ09MTEVDVElPTjtcbkRiLlNZU1RFTV9KU19DT0xMRUNUSU9OID0gQ09OU1RBTlRTLlNZU1RFTV9KU19DT0xMRUNUSU9OO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGIuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/db.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js":
/*!****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.aws4 = void 0;\nexports.getKerberos = getKerberos;\nexports.getZstdLibrary = getZstdLibrary;\nexports.getAwsCredentialProvider = getAwsCredentialProvider;\nexports.getGcpMetadata = getGcpMetadata;\nexports.getSnappy = getSnappy;\nexports.getSocks = getSocks;\nexports.getMongoDBClientEncryption = getMongoDBClientEncryption;\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nfunction makeErrorModule(error) {\n    const props = error ? { kModuleError: error } : {};\n    return new Proxy(props, {\n        get: (_, key) => {\n            if (key === 'kModuleError') {\n                return error;\n            }\n            throw error;\n        },\n        set: () => {\n            throw error;\n        }\n    });\n}\nfunction getKerberos() {\n    let kerberos;\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        kerberos = __webpack_require__(/*! kerberos */ \"?1178\");\n    }\n    catch (error) {\n        kerberos = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `kerberos` not found. Please install it to enable kerberos authentication', { cause: error, dependencyName: 'kerberos' }));\n    }\n    return kerberos;\n}\nfunction getZstdLibrary() {\n    let ZStandard;\n    try {\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        ZStandard = __webpack_require__(/*! @mongodb-js/zstd */ \"?8db9\");\n    }\n    catch (error) {\n        ZStandard = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `@mongodb-js/zstd` not found. Please install it to enable zstd compression', { cause: error, dependencyName: 'zstd' }));\n    }\n    return ZStandard;\n}\nfunction getAwsCredentialProvider() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        const credentialProvider = __webpack_require__(/*! @aws-sdk/credential-providers */ \"?2635\");\n        return credentialProvider;\n    }\n    catch (error) {\n        return makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `@aws-sdk/credential-providers` not found.' +\n            ' Please install it to enable getting aws credentials via the official sdk.', { cause: error, dependencyName: '@aws-sdk/credential-providers' }));\n    }\n}\nfunction getGcpMetadata() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        const credentialProvider = __webpack_require__(/*! gcp-metadata */ \"?b327\");\n        return credentialProvider;\n    }\n    catch (error) {\n        return makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `gcp-metadata` not found.' +\n            ' Please install it to enable getting gcp credentials via the official sdk.', { cause: error, dependencyName: 'gcp-metadata' }));\n    }\n}\nfunction getSnappy() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        const value = __webpack_require__(/*! snappy */ \"?16e5\");\n        return value;\n    }\n    catch (error) {\n        const kModuleError = new error_1.MongoMissingDependencyError('Optional module `snappy` not found. Please install it to enable snappy compression', { cause: error, dependencyName: 'snappy' });\n        return { kModuleError };\n    }\n}\nfunction getSocks() {\n    try {\n        // Ensure you always wrap an optional require in the try block NODE-3199\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        const value = __webpack_require__(/*! socks */ \"?f69d\");\n        return value;\n    }\n    catch (error) {\n        const kModuleError = new error_1.MongoMissingDependencyError('Optional module `socks` not found. Please install it to connections over a SOCKS5 proxy', { cause: error, dependencyName: 'socks' });\n        return { kModuleError };\n    }\n}\nexports.aws4 = loadAws4();\nfunction loadAws4() {\n    let aws4;\n    try {\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        aws4 = __webpack_require__(/*! aws4 */ \"?a6db\");\n    }\n    catch (error) {\n        aws4 = makeErrorModule(new error_1.MongoMissingDependencyError('Optional module `aws4` not found. Please install it to enable AWS authentication', { cause: error, dependencyName: 'aws4' }));\n    }\n    return aws4;\n}\n/** A utility function to get the instance of mongodb-client-encryption, if it exists. */\nfunction getMongoDBClientEncryption() {\n    let mongodbClientEncryption = null;\n    try {\n        // NOTE(NODE-3199): Ensure you always wrap an optional require literally in the try block\n        // Cannot be moved to helper utility function, bundlers search and replace the actual require call\n        // in a way that makes this line throw at bundle time, not runtime, catching here will make bundling succeed\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        mongodbClientEncryption = __webpack_require__(/*! mongodb-client-encryption */ \"?8279\");\n    }\n    catch (error) {\n        const kModuleError = new error_1.MongoMissingDependencyError('Optional module `mongodb-client-encryption` not found. Please install it to use auto encryption or ClientEncryption.', { cause: error, dependencyName: 'mongodb-client-encryption' });\n        return { kModuleError };\n    }\n    return mongodbClientEncryption;\n}\n//# sourceMappingURL=deps.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2RlcHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsWUFBWTtBQUNaLG1CQUFtQjtBQUNuQixzQkFBc0I7QUFDdEIsZ0NBQWdDO0FBQ2hDLHNCQUFzQjtBQUN0QixpQkFBaUI7QUFDakIsZ0JBQWdCO0FBQ2hCLGtDQUFrQztBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQztBQUNBLDRCQUE0QixzQkFBc0I7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsbUJBQU8sQ0FBQyx1QkFBVTtBQUNyQztBQUNBO0FBQ0EsMEtBQTBLLDBDQUEwQztBQUNwTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixtQkFBTyxDQUFDLCtCQUFrQjtBQUM5QztBQUNBO0FBQ0EsNEtBQTRLLHNDQUFzQztBQUNsTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxtQkFBTyxDQUFDLDRDQUErQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRGQUE0RiwrREFBK0Q7QUFDM0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLG1CQUFPLENBQUMsMkJBQWM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0RkFBNEYsOENBQThDO0FBQzFJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixtQkFBTyxDQUFDLHFCQUFRO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLDZKQUE2Six3Q0FBd0M7QUFDck0saUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixtQkFBTyxDQUFDLG9CQUFPO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGtLQUFrSyx1Q0FBdUM7QUFDek0saUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLG1CQUFPLENBQUMsbUJBQU07QUFDN0I7QUFDQTtBQUNBLDZKQUE2SixzQ0FBc0M7QUFDbk07QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxtQkFBTyxDQUFDLHdDQUEyQjtBQUNyRTtBQUNBO0FBQ0EsK0xBQStMLDJEQUEyRDtBQUMxUCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9kZXBzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hd3M0ID0gdm9pZCAwO1xuZXhwb3J0cy5nZXRLZXJiZXJvcyA9IGdldEtlcmJlcm9zO1xuZXhwb3J0cy5nZXRac3RkTGlicmFyeSA9IGdldFpzdGRMaWJyYXJ5O1xuZXhwb3J0cy5nZXRBd3NDcmVkZW50aWFsUHJvdmlkZXIgPSBnZXRBd3NDcmVkZW50aWFsUHJvdmlkZXI7XG5leHBvcnRzLmdldEdjcE1ldGFkYXRhID0gZ2V0R2NwTWV0YWRhdGE7XG5leHBvcnRzLmdldFNuYXBweSA9IGdldFNuYXBweTtcbmV4cG9ydHMuZ2V0U29ja3MgPSBnZXRTb2NrcztcbmV4cG9ydHMuZ2V0TW9uZ29EQkNsaWVudEVuY3J5cHRpb24gPSBnZXRNb25nb0RCQ2xpZW50RW5jcnlwdGlvbjtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmZ1bmN0aW9uIG1ha2VFcnJvck1vZHVsZShlcnJvcikge1xuICAgIGNvbnN0IHByb3BzID0gZXJyb3IgPyB7IGtNb2R1bGVFcnJvcjogZXJyb3IgfSA6IHt9O1xuICAgIHJldHVybiBuZXcgUHJveHkocHJvcHMsIHtcbiAgICAgICAgZ2V0OiAoXywga2V5KSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAna01vZHVsZUVycm9yJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6ICgpID0+IHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5mdW5jdGlvbiBnZXRLZXJiZXJvcygpIHtcbiAgICBsZXQga2VyYmVyb3M7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gRW5zdXJlIHlvdSBhbHdheXMgd3JhcCBhbiBvcHRpb25hbCByZXF1aXJlIGluIHRoZSB0cnkgYmxvY2sgTk9ERS0zMTk5XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgICAgIGtlcmJlcm9zID0gcmVxdWlyZSgna2VyYmVyb3MnKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGtlcmJlcm9zID0gbWFrZUVycm9yTW9kdWxlKG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcignT3B0aW9uYWwgbW9kdWxlIGBrZXJiZXJvc2Agbm90IGZvdW5kLiBQbGVhc2UgaW5zdGFsbCBpdCB0byBlbmFibGUga2VyYmVyb3MgYXV0aGVudGljYXRpb24nLCB7IGNhdXNlOiBlcnJvciwgZGVwZW5kZW5jeU5hbWU6ICdrZXJiZXJvcycgfSkpO1xuICAgIH1cbiAgICByZXR1cm4ga2VyYmVyb3M7XG59XG5mdW5jdGlvbiBnZXRac3RkTGlicmFyeSgpIHtcbiAgICBsZXQgWlN0YW5kYXJkO1xuICAgIHRyeSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgICAgIFpTdGFuZGFyZCA9IHJlcXVpcmUoJ0Btb25nb2RiLWpzL3pzdGQnKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIFpTdGFuZGFyZCA9IG1ha2VFcnJvck1vZHVsZShuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ09wdGlvbmFsIG1vZHVsZSBgQG1vbmdvZGItanMvenN0ZGAgbm90IGZvdW5kLiBQbGVhc2UgaW5zdGFsbCBpdCB0byBlbmFibGUgenN0ZCBjb21wcmVzc2lvbicsIHsgY2F1c2U6IGVycm9yLCBkZXBlbmRlbmN5TmFtZTogJ3pzdGQnIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIFpTdGFuZGFyZDtcbn1cbmZ1bmN0aW9uIGdldEF3c0NyZWRlbnRpYWxQcm92aWRlcigpIHtcbiAgICB0cnkge1xuICAgICAgICAvLyBFbnN1cmUgeW91IGFsd2F5cyB3cmFwIGFuIG9wdGlvbmFsIHJlcXVpcmUgaW4gdGhlIHRyeSBibG9jayBOT0RFLTMxOTlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHNcbiAgICAgICAgY29uc3QgY3JlZGVudGlhbFByb3ZpZGVyID0gcmVxdWlyZSgnQGF3cy1zZGsvY3JlZGVudGlhbC1wcm92aWRlcnMnKTtcbiAgICAgICAgcmV0dXJuIGNyZWRlbnRpYWxQcm92aWRlcjtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBtYWtlRXJyb3JNb2R1bGUobmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yKCdPcHRpb25hbCBtb2R1bGUgYEBhd3Mtc2RrL2NyZWRlbnRpYWwtcHJvdmlkZXJzYCBub3QgZm91bmQuJyArXG4gICAgICAgICAgICAnIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSBnZXR0aW5nIGF3cyBjcmVkZW50aWFscyB2aWEgdGhlIG9mZmljaWFsIHNkay4nLCB7IGNhdXNlOiBlcnJvciwgZGVwZW5kZW5jeU5hbWU6ICdAYXdzLXNkay9jcmVkZW50aWFsLXByb3ZpZGVycycgfSkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldEdjcE1ldGFkYXRhKCkge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIEVuc3VyZSB5b3UgYWx3YXlzIHdyYXAgYW4gb3B0aW9uYWwgcmVxdWlyZSBpbiB0aGUgdHJ5IGJsb2NrIE5PREUtMzE5OVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlcXVpcmUtaW1wb3J0c1xuICAgICAgICBjb25zdCBjcmVkZW50aWFsUHJvdmlkZXIgPSByZXF1aXJlKCdnY3AtbWV0YWRhdGEnKTtcbiAgICAgICAgcmV0dXJuIGNyZWRlbnRpYWxQcm92aWRlcjtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBtYWtlRXJyb3JNb2R1bGUobmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yKCdPcHRpb25hbCBtb2R1bGUgYGdjcC1tZXRhZGF0YWAgbm90IGZvdW5kLicgK1xuICAgICAgICAgICAgJyBQbGVhc2UgaW5zdGFsbCBpdCB0byBlbmFibGUgZ2V0dGluZyBnY3AgY3JlZGVudGlhbHMgdmlhIHRoZSBvZmZpY2lhbCBzZGsuJywgeyBjYXVzZTogZXJyb3IsIGRlcGVuZGVuY3lOYW1lOiAnZ2NwLW1ldGFkYXRhJyB9KSk7XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0U25hcHB5KCkge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIEVuc3VyZSB5b3UgYWx3YXlzIHdyYXAgYW4gb3B0aW9uYWwgcmVxdWlyZSBpbiB0aGUgdHJ5IGJsb2NrIE5PREUtMzE5OVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlcXVpcmUtaW1wb3J0c1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHJlcXVpcmUoJ3NuYXBweScpO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBrTW9kdWxlRXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ09wdGlvbmFsIG1vZHVsZSBgc25hcHB5YCBub3QgZm91bmQuIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSBzbmFwcHkgY29tcHJlc3Npb24nLCB7IGNhdXNlOiBlcnJvciwgZGVwZW5kZW5jeU5hbWU6ICdzbmFwcHknIH0pO1xuICAgICAgICByZXR1cm4geyBrTW9kdWxlRXJyb3IgfTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRTb2NrcygpIHtcbiAgICB0cnkge1xuICAgICAgICAvLyBFbnN1cmUgeW91IGFsd2F5cyB3cmFwIGFuIG9wdGlvbmFsIHJlcXVpcmUgaW4gdGhlIHRyeSBibG9jayBOT0RFLTMxOTlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHNcbiAgICAgICAgY29uc3QgdmFsdWUgPSByZXF1aXJlKCdzb2NrcycpO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBrTW9kdWxlRXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ09wdGlvbmFsIG1vZHVsZSBgc29ja3NgIG5vdCBmb3VuZC4gUGxlYXNlIGluc3RhbGwgaXQgdG8gY29ubmVjdGlvbnMgb3ZlciBhIFNPQ0tTNSBwcm94eScsIHsgY2F1c2U6IGVycm9yLCBkZXBlbmRlbmN5TmFtZTogJ3NvY2tzJyB9KTtcbiAgICAgICAgcmV0dXJuIHsga01vZHVsZUVycm9yIH07XG4gICAgfVxufVxuZXhwb3J0cy5hd3M0ID0gbG9hZEF3czQoKTtcbmZ1bmN0aW9uIGxvYWRBd3M0KCkge1xuICAgIGxldCBhd3M0O1xuICAgIHRyeSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgICAgIGF3czQgPSByZXF1aXJlKCdhd3M0Jyk7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBhd3M0ID0gbWFrZUVycm9yTW9kdWxlKG5ldyBlcnJvcl8xLk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcignT3B0aW9uYWwgbW9kdWxlIGBhd3M0YCBub3QgZm91bmQuIFBsZWFzZSBpbnN0YWxsIGl0IHRvIGVuYWJsZSBBV1MgYXV0aGVudGljYXRpb24nLCB7IGNhdXNlOiBlcnJvciwgZGVwZW5kZW5jeU5hbWU6ICdhd3M0JyB9KSk7XG4gICAgfVxuICAgIHJldHVybiBhd3M0O1xufVxuLyoqIEEgdXRpbGl0eSBmdW5jdGlvbiB0byBnZXQgdGhlIGluc3RhbmNlIG9mIG1vbmdvZGItY2xpZW50LWVuY3J5cHRpb24sIGlmIGl0IGV4aXN0cy4gKi9cbmZ1bmN0aW9uIGdldE1vbmdvREJDbGllbnRFbmNyeXB0aW9uKCkge1xuICAgIGxldCBtb25nb2RiQ2xpZW50RW5jcnlwdGlvbiA9IG51bGw7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gTk9URShOT0RFLTMxOTkpOiBFbnN1cmUgeW91IGFsd2F5cyB3cmFwIGFuIG9wdGlvbmFsIHJlcXVpcmUgbGl0ZXJhbGx5IGluIHRoZSB0cnkgYmxvY2tcbiAgICAgICAgLy8gQ2Fubm90IGJlIG1vdmVkIHRvIGhlbHBlciB1dGlsaXR5IGZ1bmN0aW9uLCBidW5kbGVycyBzZWFyY2ggYW5kIHJlcGxhY2UgdGhlIGFjdHVhbCByZXF1aXJlIGNhbGxcbiAgICAgICAgLy8gaW4gYSB3YXkgdGhhdCBtYWtlcyB0aGlzIGxpbmUgdGhyb3cgYXQgYnVuZGxlIHRpbWUsIG5vdCBydW50aW1lLCBjYXRjaGluZyBoZXJlIHdpbGwgbWFrZSBidW5kbGluZyBzdWNjZWVkXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgICAgIG1vbmdvZGJDbGllbnRFbmNyeXB0aW9uID0gcmVxdWlyZSgnbW9uZ29kYi1jbGllbnQtZW5jcnlwdGlvbicpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3Qga01vZHVsZUVycm9yID0gbmV3IGVycm9yXzEuTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yKCdPcHRpb25hbCBtb2R1bGUgYG1vbmdvZGItY2xpZW50LWVuY3J5cHRpb25gIG5vdCBmb3VuZC4gUGxlYXNlIGluc3RhbGwgaXQgdG8gdXNlIGF1dG8gZW5jcnlwdGlvbiBvciBDbGllbnRFbmNyeXB0aW9uLicsIHsgY2F1c2U6IGVycm9yLCBkZXBlbmRlbmN5TmFtZTogJ21vbmdvZGItY2xpZW50LWVuY3J5cHRpb24nIH0pO1xuICAgICAgICByZXR1cm4geyBrTW9kdWxlRXJyb3IgfTtcbiAgICB9XG4gICAgcmV0dXJuIG1vbmdvZGJDbGllbnRFbmNyeXB0aW9uO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGVwcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/encrypter.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/encrypter.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Encrypter = void 0;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst auto_encrypter_1 = __webpack_require__(/*! ./client-side-encryption/auto_encrypter */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/auto_encrypter.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst deps_1 = __webpack_require__(/*! ./deps */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/deps.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\n/** @internal */\nclass Encrypter {\n    constructor(client, uri, options) {\n        if (typeof options.autoEncryption !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Option \"autoEncryption\" must be specified');\n        }\n        // initialize to null, if we call getInternalClient, we may set this it is important to not overwrite those function calls.\n        this.internalClient = null;\n        this.bypassAutoEncryption = !!options.autoEncryption.bypassAutoEncryption;\n        this.needsConnecting = false;\n        if (options.maxPoolSize === 0 && options.autoEncryption.keyVaultClient == null) {\n            options.autoEncryption.keyVaultClient = client;\n        }\n        else if (options.autoEncryption.keyVaultClient == null) {\n            options.autoEncryption.keyVaultClient = this.getInternalClient(client, uri, options);\n        }\n        if (this.bypassAutoEncryption) {\n            options.autoEncryption.metadataClient = undefined;\n        }\n        else if (options.maxPoolSize === 0) {\n            options.autoEncryption.metadataClient = client;\n        }\n        else {\n            options.autoEncryption.metadataClient = this.getInternalClient(client, uri, options);\n        }\n        if (options.proxyHost) {\n            options.autoEncryption.proxyOptions = {\n                proxyHost: options.proxyHost,\n                proxyPort: options.proxyPort,\n                proxyUsername: options.proxyUsername,\n                proxyPassword: options.proxyPassword\n            };\n        }\n        this.autoEncrypter = new auto_encrypter_1.AutoEncrypter(client, options.autoEncryption);\n    }\n    getInternalClient(client, uri, options) {\n        let internalClient = this.internalClient;\n        if (internalClient == null) {\n            const clonedOptions = {};\n            for (const key of [\n                ...Object.getOwnPropertyNames(options),\n                ...Object.getOwnPropertySymbols(options)\n            ]) {\n                if (['autoEncryption', 'minPoolSize', 'servers', 'caseTranslate', 'dbName'].includes(key))\n                    continue;\n                Reflect.set(clonedOptions, key, Reflect.get(options, key));\n            }\n            clonedOptions.minPoolSize = 0;\n            internalClient = new mongo_client_1.MongoClient(uri, clonedOptions);\n            this.internalClient = internalClient;\n            for (const eventName of constants_1.MONGO_CLIENT_EVENTS) {\n                for (const listener of client.listeners(eventName)) {\n                    internalClient.on(eventName, listener);\n                }\n            }\n            client.on('newListener', (eventName, listener) => {\n                internalClient?.on(eventName, listener);\n            });\n            this.needsConnecting = true;\n        }\n        return internalClient;\n    }\n    async connectInternalClient() {\n        const internalClient = this.internalClient;\n        if (this.needsConnecting && internalClient != null) {\n            this.needsConnecting = false;\n            await internalClient.connect();\n        }\n    }\n    closeCallback(client, force, callback) {\n        (0, util_1.callbackify)(this.close.bind(this))(client, force, callback);\n    }\n    async close(client, force) {\n        let error;\n        try {\n            await this.autoEncrypter.teardown(force);\n        }\n        catch (autoEncrypterError) {\n            error = autoEncrypterError;\n        }\n        const internalClient = this.internalClient;\n        if (internalClient != null && client !== internalClient) {\n            return await internalClient.close(force);\n        }\n        if (error != null) {\n            throw error;\n        }\n    }\n    static checkForMongoCrypt() {\n        const mongodbClientEncryption = (0, deps_1.getMongoDBClientEncryption)();\n        if ('kModuleError' in mongodbClientEncryption) {\n            throw new error_1.MongoMissingDependencyError('Auto-encryption requested, but the module is not installed. ' +\n                'Please add `mongodb-client-encryption` as a dependency of your project', {\n                cause: mongodbClientEncryption['kModuleError'],\n                dependencyName: 'mongodb-client-encryption'\n            });\n        }\n    }\n}\nexports.Encrypter = Encrypter;\n//# sourceMappingURL=encrypter.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2VuY3J5cHRlci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxpQkFBaUI7QUFDakIsZUFBZSxtQkFBTyxDQUFDLGtCQUFNO0FBQzdCLHlCQUF5QixtQkFBTyxDQUFDLDRKQUF5QztBQUMxRSxvQkFBb0IsbUJBQU8sQ0FBQyxvR0FBYTtBQUN6QyxlQUFlLG1CQUFPLENBQUMsMEZBQVE7QUFDL0IsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsdUJBQXVCLG1CQUFPLENBQUMsMEdBQWdCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9lbmNyeXB0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkVuY3J5cHRlciA9IHZvaWQgMDtcbmNvbnN0IHV0aWxfMSA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xuY29uc3QgYXV0b19lbmNyeXB0ZXJfMSA9IHJlcXVpcmUoXCIuL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vYXV0b19lbmNyeXB0ZXJcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IGRlcHNfMSA9IHJlcXVpcmUoXCIuL2RlcHNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5jb25zdCBtb25nb19jbGllbnRfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2NsaWVudFwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEVuY3J5cHRlciB7XG4gICAgY29uc3RydWN0b3IoY2xpZW50LCB1cmksIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmF1dG9FbmNyeXB0aW9uICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3B0aW9uIFwiYXV0b0VuY3J5cHRpb25cIiBtdXN0IGJlIHNwZWNpZmllZCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGluaXRpYWxpemUgdG8gbnVsbCwgaWYgd2UgY2FsbCBnZXRJbnRlcm5hbENsaWVudCwgd2UgbWF5IHNldCB0aGlzIGl0IGlzIGltcG9ydGFudCB0byBub3Qgb3ZlcndyaXRlIHRob3NlIGZ1bmN0aW9uIGNhbGxzLlxuICAgICAgICB0aGlzLmludGVybmFsQ2xpZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5ieXBhc3NBdXRvRW5jcnlwdGlvbiA9ICEhb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5ieXBhc3NBdXRvRW5jcnlwdGlvbjtcbiAgICAgICAgdGhpcy5uZWVkc0Nvbm5lY3RpbmcgPSBmYWxzZTtcbiAgICAgICAgaWYgKG9wdGlvbnMubWF4UG9vbFNpemUgPT09IDAgJiYgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5rZXlWYXVsdENsaWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICBvcHRpb25zLmF1dG9FbmNyeXB0aW9uLmtleVZhdWx0Q2xpZW50ID0gY2xpZW50O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdGlvbnMuYXV0b0VuY3J5cHRpb24ua2V5VmF1bHRDbGllbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbi5rZXlWYXVsdENsaWVudCA9IHRoaXMuZ2V0SW50ZXJuYWxDbGllbnQoY2xpZW50LCB1cmksIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmJ5cGFzc0F1dG9FbmNyeXB0aW9uKSB7XG4gICAgICAgICAgICBvcHRpb25zLmF1dG9FbmNyeXB0aW9uLm1ldGFkYXRhQ2xpZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdGlvbnMubWF4UG9vbFNpemUgPT09IDApIHtcbiAgICAgICAgICAgIG9wdGlvbnMuYXV0b0VuY3J5cHRpb24ubWV0YWRhdGFDbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvcHRpb25zLmF1dG9FbmNyeXB0aW9uLm1ldGFkYXRhQ2xpZW50ID0gdGhpcy5nZXRJbnRlcm5hbENsaWVudChjbGllbnQsIHVyaSwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMucHJveHlIb3N0KSB7XG4gICAgICAgICAgICBvcHRpb25zLmF1dG9FbmNyeXB0aW9uLnByb3h5T3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBwcm94eUhvc3Q6IG9wdGlvbnMucHJveHlIb3N0LFxuICAgICAgICAgICAgICAgIHByb3h5UG9ydDogb3B0aW9ucy5wcm94eVBvcnQsXG4gICAgICAgICAgICAgICAgcHJveHlVc2VybmFtZTogb3B0aW9ucy5wcm94eVVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHByb3h5UGFzc3dvcmQ6IG9wdGlvbnMucHJveHlQYXNzd29yZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmF1dG9FbmNyeXB0ZXIgPSBuZXcgYXV0b19lbmNyeXB0ZXJfMS5BdXRvRW5jcnlwdGVyKGNsaWVudCwgb3B0aW9ucy5hdXRvRW5jcnlwdGlvbik7XG4gICAgfVxuICAgIGdldEludGVybmFsQ2xpZW50KGNsaWVudCwgdXJpLCBvcHRpb25zKSB7XG4gICAgICAgIGxldCBpbnRlcm5hbENsaWVudCA9IHRoaXMuaW50ZXJuYWxDbGllbnQ7XG4gICAgICAgIGlmIChpbnRlcm5hbENsaWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCBjbG9uZWRPcHRpb25zID0ge307XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBbXG4gICAgICAgICAgICAgICAgLi4uT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob3B0aW9ucyksXG4gICAgICAgICAgICAgICAgLi4uT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvcHRpb25zKVxuICAgICAgICAgICAgXSkge1xuICAgICAgICAgICAgICAgIGlmIChbJ2F1dG9FbmNyeXB0aW9uJywgJ21pblBvb2xTaXplJywgJ3NlcnZlcnMnLCAnY2FzZVRyYW5zbGF0ZScsICdkYk5hbWUnXS5pbmNsdWRlcyhrZXkpKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBSZWZsZWN0LnNldChjbG9uZWRPcHRpb25zLCBrZXksIFJlZmxlY3QuZ2V0KG9wdGlvbnMsIGtleSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xvbmVkT3B0aW9ucy5taW5Qb29sU2l6ZSA9IDA7XG4gICAgICAgICAgICBpbnRlcm5hbENsaWVudCA9IG5ldyBtb25nb19jbGllbnRfMS5Nb25nb0NsaWVudCh1cmksIGNsb25lZE9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcm5hbENsaWVudCA9IGludGVybmFsQ2xpZW50O1xuICAgICAgICAgICAgZm9yIChjb25zdCBldmVudE5hbWUgb2YgY29uc3RhbnRzXzEuTU9OR09fQ0xJRU5UX0VWRU5UUykge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgY2xpZW50Lmxpc3RlbmVycyhldmVudE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGludGVybmFsQ2xpZW50Lm9uKGV2ZW50TmFtZSwgbGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsaWVudC5vbignbmV3TGlzdGVuZXInLCAoZXZlbnROYW1lLCBsaXN0ZW5lcikgPT4ge1xuICAgICAgICAgICAgICAgIGludGVybmFsQ2xpZW50Py5vbihldmVudE5hbWUsIGxpc3RlbmVyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5uZWVkc0Nvbm5lY3RpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnRlcm5hbENsaWVudDtcbiAgICB9XG4gICAgYXN5bmMgY29ubmVjdEludGVybmFsQ2xpZW50KCkge1xuICAgICAgICBjb25zdCBpbnRlcm5hbENsaWVudCA9IHRoaXMuaW50ZXJuYWxDbGllbnQ7XG4gICAgICAgIGlmICh0aGlzLm5lZWRzQ29ubmVjdGluZyAmJiBpbnRlcm5hbENsaWVudCAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLm5lZWRzQ29ubmVjdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgYXdhaXQgaW50ZXJuYWxDbGllbnQuY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlQ2FsbGJhY2soY2xpZW50LCBmb3JjZSwgY2FsbGJhY2spIHtcbiAgICAgICAgKDAsIHV0aWxfMS5jYWxsYmFja2lmeSkodGhpcy5jbG9zZS5iaW5kKHRoaXMpKShjbGllbnQsIGZvcmNlLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIGFzeW5jIGNsb3NlKGNsaWVudCwgZm9yY2UpIHtcbiAgICAgICAgbGV0IGVycm9yO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRvRW5jcnlwdGVyLnRlYXJkb3duKGZvcmNlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoYXV0b0VuY3J5cHRlckVycm9yKSB7XG4gICAgICAgICAgICBlcnJvciA9IGF1dG9FbmNyeXB0ZXJFcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnRlcm5hbENsaWVudCA9IHRoaXMuaW50ZXJuYWxDbGllbnQ7XG4gICAgICAgIGlmIChpbnRlcm5hbENsaWVudCAhPSBudWxsICYmIGNsaWVudCAhPT0gaW50ZXJuYWxDbGllbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBpbnRlcm5hbENsaWVudC5jbG9zZShmb3JjZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBjaGVja0Zvck1vbmdvQ3J5cHQoKSB7XG4gICAgICAgIGNvbnN0IG1vbmdvZGJDbGllbnRFbmNyeXB0aW9uID0gKDAsIGRlcHNfMS5nZXRNb25nb0RCQ2xpZW50RW5jcnlwdGlvbikoKTtcbiAgICAgICAgaWYgKCdrTW9kdWxlRXJyb3InIGluIG1vbmdvZGJDbGllbnRFbmNyeXB0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IoJ0F1dG8tZW5jcnlwdGlvbiByZXF1ZXN0ZWQsIGJ1dCB0aGUgbW9kdWxlIGlzIG5vdCBpbnN0YWxsZWQuICcgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgYWRkIGBtb25nb2RiLWNsaWVudC1lbmNyeXB0aW9uYCBhcyBhIGRlcGVuZGVuY3kgb2YgeW91ciBwcm9qZWN0Jywge1xuICAgICAgICAgICAgICAgIGNhdXNlOiBtb25nb2RiQ2xpZW50RW5jcnlwdGlvblsna01vZHVsZUVycm9yJ10sXG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeU5hbWU6ICdtb25nb2RiLWNsaWVudC1lbmNyeXB0aW9uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkVuY3J5cHRlciA9IEVuY3J5cHRlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWVuY3J5cHRlci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/encrypter.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoWriteConcernError = exports.MongoServerSelectionError = exports.MongoSystemError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoCompatibilityError = exports.MongoInvalidArgumentError = exports.MongoParseError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.MongoTopologyClosedError = exports.MongoCursorExhaustedError = exports.MongoServerClosedError = exports.MongoCursorInUseError = exports.MongoOperationTimeoutError = exports.MongoUnexpectedServerResponseError = exports.MongoGridFSChunkError = exports.MongoGridFSStreamError = exports.MongoTailableCursorError = exports.MongoChangeStreamError = exports.MongoClientBulkWriteExecutionError = exports.MongoClientBulkWriteCursorError = exports.MongoClientBulkWriteError = exports.MongoGCPError = exports.MongoAzureError = exports.MongoOIDCError = exports.MongoAWSError = exports.MongoKerberosError = exports.MongoExpiredSessionError = exports.MongoTransactionError = exports.MongoNotConnectedError = exports.MongoDecompressionError = exports.MongoBatchReExecutionError = exports.MongoStalePrimaryError = exports.MongoRuntimeError = exports.MongoAPIError = exports.MongoDriverError = exports.MongoServerError = exports.MongoError = exports.MongoErrorLabel = exports.GET_MORE_RESUMABLE_CODES = exports.MONGODB_ERROR_CODES = exports.NODE_IS_RECOVERING_ERROR_MESSAGE = exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = void 0;\nexports.needsRetryableWriteLabel = needsRetryableWriteLabel;\nexports.isRetryableWriteError = isRetryableWriteError;\nexports.isRetryableReadError = isRetryableReadError;\nexports.isNodeShuttingDownError = isNodeShuttingDownError;\nexports.isSDAMUnrecoverableError = isSDAMUnrecoverableError;\nexports.isNetworkTimeoutError = isNetworkTimeoutError;\nexports.isResumableError = isResumableError;\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a writable primary\n * https://github.com/mongodb/specifications/blob/921232976f9913cf17415b5ef937ee772e45e6ae/source/server-discovery-and-monitoring/server-discovery-and-monitoring.md#not-writable-primary-and-node-is-recovering\n */\nexports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = new RegExp('not master', 'i');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a primary or secondary\n * https://github.com/mongodb/specifications/blob/921232976f9913cf17415b5ef937ee772e45e6ae/source/server-discovery-and-monitoring/server-discovery-and-monitoring.md#not-writable-primary-and-node-is-recovering\n */\nexports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = new RegExp('not master or secondary', 'i');\n/**\n * @internal\n * The error message from the server that indicates the node is recovering\n * https://github.com/mongodb/specifications/blob/921232976f9913cf17415b5ef937ee772e45e6ae/source/server-discovery-and-monitoring/server-discovery-and-monitoring.md#not-writable-primary-and-node-is-recovering\n */\nexports.NODE_IS_RECOVERING_ERROR_MESSAGE = new RegExp('node is recovering', 'i');\n/** @internal MongoDB Error Codes */\nexports.MONGODB_ERROR_CODES = Object.freeze({\n    HostUnreachable: 6,\n    HostNotFound: 7,\n    AuthenticationFailed: 18,\n    NetworkTimeout: 89,\n    ShutdownInProgress: 91,\n    PrimarySteppedDown: 189,\n    ExceededTimeLimit: 262,\n    SocketException: 9001,\n    NotWritablePrimary: 10107,\n    InterruptedAtShutdown: 11600,\n    InterruptedDueToReplStateChange: 11602,\n    NotPrimaryNoSecondaryOk: 13435,\n    NotPrimaryOrSecondary: 13436,\n    StaleShardVersion: 63,\n    StaleEpoch: 150,\n    StaleConfig: 13388,\n    RetryChangeStream: 234,\n    FailedToSatisfyReadPreference: 133,\n    CursorNotFound: 43,\n    LegacyNotPrimary: 10058,\n    // WriteConcernTimeout is WriteConcernFailed on pre-8.1 servers\n    WriteConcernTimeout: 64,\n    NamespaceNotFound: 26,\n    IllegalOperation: 20,\n    MaxTimeMSExpired: 50,\n    UnknownReplWriteConcern: 79,\n    UnsatisfiableWriteConcern: 100,\n    Reauthenticate: 391,\n    ReadConcernMajorityNotAvailableYet: 134\n});\n// From spec https://github.com/mongodb/specifications/blob/921232976f9913cf17415b5ef937ee772e45e6ae/source/change-streams/change-streams.md#resumable-error\nexports.GET_MORE_RESUMABLE_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.HostUnreachable,\n    exports.MONGODB_ERROR_CODES.HostNotFound,\n    exports.MONGODB_ERROR_CODES.NetworkTimeout,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.ExceededTimeLimit,\n    exports.MONGODB_ERROR_CODES.SocketException,\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary,\n    exports.MONGODB_ERROR_CODES.StaleShardVersion,\n    exports.MONGODB_ERROR_CODES.StaleEpoch,\n    exports.MONGODB_ERROR_CODES.StaleConfig,\n    exports.MONGODB_ERROR_CODES.RetryChangeStream,\n    exports.MONGODB_ERROR_CODES.FailedToSatisfyReadPreference,\n    exports.MONGODB_ERROR_CODES.CursorNotFound\n]);\n/** @public */\nexports.MongoErrorLabel = Object.freeze({\n    RetryableWriteError: 'RetryableWriteError',\n    TransientTransactionError: 'TransientTransactionError',\n    UnknownTransactionCommitResult: 'UnknownTransactionCommitResult',\n    ResumableChangeStreamError: 'ResumableChangeStreamError',\n    HandshakeError: 'HandshakeError',\n    ResetPool: 'ResetPool',\n    PoolRequstedRetry: 'PoolRequstedRetry',\n    InterruptInUseConnections: 'InterruptInUseConnections',\n    NoWritesPerformed: 'NoWritesPerformed'\n});\nfunction isAggregateError(e) {\n    return e != null && typeof e === 'object' && 'errors' in e && Array.isArray(e.errors);\n}\n/**\n * @public\n * @category Error\n *\n * @privateRemarks\n * mongodb-client-encryption has a dependency on this error, it uses the constructor with a string argument\n */\nclass MongoError extends Error {\n    get errorLabels() {\n        return Array.from(this.errorLabelSet);\n    }\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n        /** @internal */\n        this.errorLabelSet = new Set();\n    }\n    /** @internal */\n    static buildErrorMessage(e) {\n        if (typeof e === 'string') {\n            return e;\n        }\n        if (isAggregateError(e) && e.message.length === 0) {\n            return e.errors.length === 0\n                ? 'AggregateError has an empty errors array. Please check the `cause` property for more information.'\n                : e.errors.map(({ message }) => message).join(', ');\n        }\n        return e != null && typeof e === 'object' && 'message' in e && typeof e.message === 'string'\n            ? e.message\n            : 'empty error message';\n    }\n    get name() {\n        return 'MongoError';\n    }\n    /** Legacy name for server error responses */\n    get errmsg() {\n        return this.message;\n    }\n    /**\n     * Checks the error to see if it has an error label\n     *\n     * @param label - The error label to check for\n     * @returns returns true if the error has the provided error label\n     */\n    hasErrorLabel(label) {\n        return this.errorLabelSet.has(label);\n    }\n    addErrorLabel(label) {\n        this.errorLabelSet.add(label);\n    }\n}\nexports.MongoError = MongoError;\n/**\n * An error coming from the mongo server\n *\n * @public\n * @category Error\n */\nclass MongoServerError extends MongoError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message.message || message.errmsg || message.$err || 'n/a');\n        if (message.errorLabels) {\n            for (const label of message.errorLabels)\n                this.addErrorLabel(label);\n        }\n        this.errorResponse = message;\n        for (const name in message) {\n            if (name !== 'errorLabels' &&\n                name !== 'errmsg' &&\n                name !== 'message' &&\n                name !== 'errorResponse') {\n                this[name] = message[name];\n            }\n        }\n    }\n    get name() {\n        return 'MongoServerError';\n    }\n}\nexports.MongoServerError = MongoServerError;\n/**\n * An error generated by the driver\n *\n * @public\n * @category Error\n */\nclass MongoDriverError extends MongoError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoDriverError';\n    }\n}\nexports.MongoDriverError = MongoDriverError;\n/**\n * An error generated when the driver API is used incorrectly\n *\n * @privateRemarks\n * Should **never** be directly instantiated\n *\n * @public\n * @category Error\n */\nclass MongoAPIError extends MongoDriverError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoAPIError';\n    }\n}\nexports.MongoAPIError = MongoAPIError;\n/**\n * An error generated when the driver encounters unexpected input\n * or reaches an unexpected/invalid internal state.\n *\n * @privateRemarks\n * Should **never** be directly instantiated.\n *\n * @public\n * @category Error\n */\nclass MongoRuntimeError extends MongoDriverError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoRuntimeError';\n    }\n}\nexports.MongoRuntimeError = MongoRuntimeError;\n/**\n * An error generated when a primary server is marked stale, never directly thrown\n *\n * @public\n * @category Error\n */\nclass MongoStalePrimaryError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoStalePrimaryError';\n    }\n}\nexports.MongoStalePrimaryError = MongoStalePrimaryError;\n/**\n * An error generated when a batch command is re-executed after one of the commands in the batch\n * has failed\n *\n * @public\n * @category Error\n */\nclass MongoBatchReExecutionError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message = 'This batch has already been executed, create new batch to execute') {\n        super(message);\n    }\n    get name() {\n        return 'MongoBatchReExecutionError';\n    }\n}\nexports.MongoBatchReExecutionError = MongoBatchReExecutionError;\n/**\n * An error generated when the driver fails to decompress\n * data received from the server.\n *\n * @public\n * @category Error\n */\nclass MongoDecompressionError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoDecompressionError';\n    }\n}\nexports.MongoDecompressionError = MongoDecompressionError;\n/**\n * An error thrown when the user attempts to operate on a database or collection through a MongoClient\n * that has not yet successfully called the \"connect\" method\n *\n * @public\n * @category Error\n */\nclass MongoNotConnectedError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoNotConnectedError';\n    }\n}\nexports.MongoNotConnectedError = MongoNotConnectedError;\n/**\n * An error generated when the user makes a mistake in the usage of transactions.\n * (e.g. attempting to commit a transaction with a readPreference other than primary)\n *\n * @public\n * @category Error\n */\nclass MongoTransactionError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoTransactionError';\n    }\n}\nexports.MongoTransactionError = MongoTransactionError;\n/**\n * An error generated when the user attempts to operate\n * on a session that has expired or has been closed.\n *\n * @public\n * @category Error\n */\nclass MongoExpiredSessionError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message = 'Cannot use a session that has ended') {\n        super(message);\n    }\n    get name() {\n        return 'MongoExpiredSessionError';\n    }\n}\nexports.MongoExpiredSessionError = MongoExpiredSessionError;\n/**\n * A error generated when the user attempts to authenticate\n * via Kerberos, but fails to connect to the Kerberos client.\n *\n * @public\n * @category Error\n */\nclass MongoKerberosError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoKerberosError';\n    }\n}\nexports.MongoKerberosError = MongoKerberosError;\n/**\n * A error generated when the user attempts to authenticate\n * via AWS, but fails\n *\n * @public\n * @category Error\n */\nclass MongoAWSError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoAWSError';\n    }\n}\nexports.MongoAWSError = MongoAWSError;\n/**\n * A error generated when the user attempts to authenticate\n * via OIDC callbacks, but fails.\n *\n * @public\n * @category Error\n */\nclass MongoOIDCError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoOIDCError';\n    }\n}\nexports.MongoOIDCError = MongoOIDCError;\n/**\n * A error generated when the user attempts to authenticate\n * via Azure, but fails.\n *\n * @public\n * @category Error\n */\nclass MongoAzureError extends MongoOIDCError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoAzureError';\n    }\n}\nexports.MongoAzureError = MongoAzureError;\n/**\n * A error generated when the user attempts to authenticate\n * via GCP, but fails.\n *\n * @public\n * @category Error\n */\nclass MongoGCPError extends MongoOIDCError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGCPError';\n    }\n}\nexports.MongoGCPError = MongoGCPError;\n/**\n * An error indicating that an error occurred when executing the bulk write.\n *\n * @public\n * @category Error\n */\nclass MongoClientBulkWriteError extends MongoServerError {\n    /**\n     * Initialize the client bulk write error.\n     * @param message - The error message.\n     */\n    constructor(message) {\n        super(message);\n        this.writeConcernErrors = [];\n        this.writeErrors = new Map();\n    }\n    get name() {\n        return 'MongoClientBulkWriteError';\n    }\n}\nexports.MongoClientBulkWriteError = MongoClientBulkWriteError;\n/**\n * An error indicating that an error occurred when processing bulk write results.\n *\n * @public\n * @category Error\n */\nclass MongoClientBulkWriteCursorError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoClientBulkWriteCursorError';\n    }\n}\nexports.MongoClientBulkWriteCursorError = MongoClientBulkWriteCursorError;\n/**\n * An error indicating that an error occurred on the client when executing a client bulk write.\n *\n * @public\n * @category Error\n */\nclass MongoClientBulkWriteExecutionError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoClientBulkWriteExecutionError';\n    }\n}\nexports.MongoClientBulkWriteExecutionError = MongoClientBulkWriteExecutionError;\n/**\n * An error generated when a ChangeStream operation fails to execute.\n *\n * @public\n * @category Error\n */\nclass MongoChangeStreamError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoChangeStreamError';\n    }\n}\nexports.MongoChangeStreamError = MongoChangeStreamError;\n/**\n * An error thrown when the user calls a function or method not supported on a tailable cursor\n *\n * @public\n * @category Error\n */\nclass MongoTailableCursorError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message = 'Tailable cursor does not support this operation') {\n        super(message);\n    }\n    get name() {\n        return 'MongoTailableCursorError';\n    }\n}\nexports.MongoTailableCursorError = MongoTailableCursorError;\n/** An error generated when a GridFSStream operation fails to execute.\n *\n * @public\n * @category Error\n */\nclass MongoGridFSStreamError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGridFSStreamError';\n    }\n}\nexports.MongoGridFSStreamError = MongoGridFSStreamError;\n/**\n * An error generated when a malformed or invalid chunk is\n * encountered when reading from a GridFSStream.\n *\n * @public\n * @category Error\n */\nclass MongoGridFSChunkError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGridFSChunkError';\n    }\n}\nexports.MongoGridFSChunkError = MongoGridFSChunkError;\n/**\n * An error generated when a **parsable** unexpected response comes from the server.\n * This is generally an error where the driver in a state expecting a certain behavior to occur in\n * the next message from MongoDB but it receives something else.\n * This error **does not** represent an issue with wire message formatting.\n *\n * #### Example\n * When an operation fails, it is the driver's job to retry it. It must perform serverSelection\n * again to make sure that it attempts the operation against a server in a good state. If server\n * selection returns a server that does not support retryable operations, this error is used.\n * This scenario is unlikely as retryable support would also have been determined on the first attempt\n * but it is possible the state change could report a selectable server that does not support retries.\n *\n * @public\n * @category Error\n */\nclass MongoUnexpectedServerResponseError extends MongoRuntimeError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoUnexpectedServerResponseError';\n    }\n}\nexports.MongoUnexpectedServerResponseError = MongoUnexpectedServerResponseError;\n/**\n * @public\n * @category Error\n *\n * The `MongoOperationTimeoutError` class represents an error that occurs when an operation could not be completed within the specified `timeoutMS`.\n * It is generated by the driver in support of the \"client side operation timeout\" feature so inherits from `MongoDriverError`.\n * When `timeoutMS` is enabled `MongoServerError`s relating to `MaxTimeExpired` errors will be converted to `MongoOperationTimeoutError`\n *\n * @example\n * ```ts\n * try {\n *   await blogs.insertOne(blogPost, { timeoutMS: 60_000 })\n * } catch (error) {\n *   if (error instanceof MongoOperationTimeoutError) {\n *     console.log(`Oh no! writer's block!`, error);\n *   }\n * }\n * ```\n */\nclass MongoOperationTimeoutError extends MongoDriverError {\n    get name() {\n        return 'MongoOperationTimeoutError';\n    }\n}\nexports.MongoOperationTimeoutError = MongoOperationTimeoutError;\n/**\n * An error thrown when the user attempts to add options to a cursor that has already been\n * initialized\n *\n * @public\n * @category Error\n */\nclass MongoCursorInUseError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message = 'Cursor is already initialized') {\n        super(message);\n    }\n    get name() {\n        return 'MongoCursorInUseError';\n    }\n}\nexports.MongoCursorInUseError = MongoCursorInUseError;\n/**\n * An error generated when an attempt is made to operate\n * on a closed/closing server.\n *\n * @public\n * @category Error\n */\nclass MongoServerClosedError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message = 'Server is closed') {\n        super(message);\n    }\n    get name() {\n        return 'MongoServerClosedError';\n    }\n}\nexports.MongoServerClosedError = MongoServerClosedError;\n/**\n * An error thrown when an attempt is made to read from a cursor that has been exhausted\n *\n * @public\n * @category Error\n */\nclass MongoCursorExhaustedError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message || 'Cursor is exhausted');\n    }\n    get name() {\n        return 'MongoCursorExhaustedError';\n    }\n}\nexports.MongoCursorExhaustedError = MongoCursorExhaustedError;\n/**\n * An error generated when an attempt is made to operate on a\n * dropped, or otherwise unavailable, database.\n *\n * @public\n * @category Error\n */\nclass MongoTopologyClosedError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message = 'Topology is closed') {\n        super(message);\n    }\n    get name() {\n        return 'MongoTopologyClosedError';\n    }\n}\nexports.MongoTopologyClosedError = MongoTopologyClosedError;\n/**\n * An error indicating an issue with the network, including TCP errors and timeouts.\n * @public\n * @category Error\n */\nclass MongoNetworkError extends MongoError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, { cause: options?.cause });\n        this.beforeHandshake = !!options?.beforeHandshake;\n    }\n    get name() {\n        return 'MongoNetworkError';\n    }\n}\nexports.MongoNetworkError = MongoNetworkError;\n/**\n * An error indicating a network timeout occurred\n * @public\n * @category Error\n *\n * @privateRemarks\n * mongodb-client-encryption has a dependency on this error with an instanceof check\n */\nclass MongoNetworkTimeoutError extends MongoNetworkError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoNetworkTimeoutError';\n    }\n}\nexports.MongoNetworkTimeoutError = MongoNetworkTimeoutError;\n/**\n * An error used when attempting to parse a value (like a connection string)\n * @public\n * @category Error\n */\nclass MongoParseError extends MongoDriverError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoParseError';\n    }\n}\nexports.MongoParseError = MongoParseError;\n/**\n * An error generated when the user supplies malformed or unexpected arguments\n * or when a required argument or field is not provided.\n *\n *\n * @public\n * @category Error\n */\nclass MongoInvalidArgumentError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoInvalidArgumentError';\n    }\n}\nexports.MongoInvalidArgumentError = MongoInvalidArgumentError;\n/**\n * An error generated when a feature that is not enabled or allowed for the current server\n * configuration is used\n *\n *\n * @public\n * @category Error\n */\nclass MongoCompatibilityError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoCompatibilityError';\n    }\n}\nexports.MongoCompatibilityError = MongoCompatibilityError;\n/**\n * An error generated when the user fails to provide authentication credentials before attempting\n * to connect to a mongo server instance.\n *\n *\n * @public\n * @category Error\n */\nclass MongoMissingCredentialsError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoMissingCredentialsError';\n    }\n}\nexports.MongoMissingCredentialsError = MongoMissingCredentialsError;\n/**\n * An error generated when a required module or dependency is not present in the local environment\n *\n * @public\n * @category Error\n */\nclass MongoMissingDependencyError extends MongoAPIError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, options) {\n        super(message, options);\n        this.dependencyName = options.dependencyName;\n    }\n    get name() {\n        return 'MongoMissingDependencyError';\n    }\n}\nexports.MongoMissingDependencyError = MongoMissingDependencyError;\n/**\n * An error signifying a general system issue\n * @public\n * @category Error\n */\nclass MongoSystemError extends MongoError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, reason) {\n        if (reason && reason.error) {\n            super(MongoError.buildErrorMessage(reason.error.message || reason.error), {\n                cause: reason.error\n            });\n        }\n        else {\n            super(message);\n        }\n        if (reason) {\n            this.reason = reason;\n        }\n        this.code = reason.error?.code;\n    }\n    get name() {\n        return 'MongoSystemError';\n    }\n}\nexports.MongoSystemError = MongoSystemError;\n/**\n * An error signifying a client-side server selection error\n * @public\n * @category Error\n */\nclass MongoServerSelectionError extends MongoSystemError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(message, reason) {\n        super(message, reason);\n    }\n    get name() {\n        return 'MongoServerSelectionError';\n    }\n}\nexports.MongoServerSelectionError = MongoServerSelectionError;\n/**\n * An error thrown when the server reports a writeConcernError\n * @public\n * @category Error\n */\nclass MongoWriteConcernError extends MongoServerError {\n    /**\n     * **Do not use this constructor!**\n     *\n     * Meant for internal use only.\n     *\n     * @remarks\n     * This class is only meant to be constructed within the driver. This constructor is\n     * not subject to semantic versioning compatibility guarantees and may change at any time.\n     *\n     * @public\n     **/\n    constructor(result) {\n        super({ ...result.writeConcernError, ...result });\n        this.errInfo = result.writeConcernError.errInfo;\n        this.result = result;\n    }\n    get name() {\n        return 'MongoWriteConcernError';\n    }\n}\nexports.MongoWriteConcernError = MongoWriteConcernError;\n// https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.md#retryable-error\nconst RETRYABLE_READ_ERROR_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.HostUnreachable,\n    exports.MONGODB_ERROR_CODES.HostNotFound,\n    exports.MONGODB_ERROR_CODES.NetworkTimeout,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.SocketException,\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary,\n    exports.MONGODB_ERROR_CODES.ExceededTimeLimit,\n    exports.MONGODB_ERROR_CODES.ReadConcernMajorityNotAvailableYet\n]);\n// see: https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.md#terms\nconst RETRYABLE_WRITE_ERROR_CODES = RETRYABLE_READ_ERROR_CODES;\nfunction needsRetryableWriteLabel(error, maxWireVersion, serverType) {\n    // pre-4.4 server, then the driver adds an error label for every valid case\n    // execute operation will only inspect the label, code/message logic is handled here\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    if (error instanceof MongoError) {\n        if ((maxWireVersion >= 9 || isRetryableWriteError(error)) &&\n            !error.hasErrorLabel(exports.MongoErrorLabel.HandshakeError)) {\n            // If we already have the error label no need to add it again. 4.4+ servers add the label.\n            // In the case where we have a handshake error, need to fall down to the logic checking\n            // the codes.\n            return false;\n        }\n    }\n    if (error instanceof MongoWriteConcernError) {\n        if (serverType === 'Mongos' && maxWireVersion < 9) {\n            // use original top-level code from server response\n            return RETRYABLE_WRITE_ERROR_CODES.has(error.result.code ?? 0);\n        }\n        const code = error.result.writeConcernError.code ?? Number(error.code);\n        return RETRYABLE_WRITE_ERROR_CODES.has(Number.isNaN(code) ? 0 : code);\n    }\n    if (error instanceof MongoError) {\n        return RETRYABLE_WRITE_ERROR_CODES.has(Number(error.code));\n    }\n    const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n    if (isNotWritablePrimaryError) {\n        return true;\n    }\n    const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n    if (isNodeIsRecoveringError) {\n        return true;\n    }\n    return false;\n}\nfunction isRetryableWriteError(error) {\n    return (error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError) ||\n        error.hasErrorLabel(exports.MongoErrorLabel.PoolRequstedRetry));\n}\n/** Determines whether an error is something the driver should attempt to retry */\nfunction isRetryableReadError(error) {\n    const hasRetryableErrorCode = typeof error.code === 'number' ? RETRYABLE_READ_ERROR_CODES.has(error.code) : false;\n    if (hasRetryableErrorCode) {\n        return true;\n    }\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n    if (isNotWritablePrimaryError) {\n        return true;\n    }\n    const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n    if (isNodeIsRecoveringError) {\n        return true;\n    }\n    return false;\n}\nconst SDAM_RECOVERING_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary\n]);\nconst SDAM_NOT_PRIMARY_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.LegacyNotPrimary\n]);\nconst SDAM_NODE_SHUTTING_DOWN_ERROR_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress\n]);\nfunction isRecoveringError(err) {\n    if (typeof err.code === 'number') {\n        // If any error code exists, we ignore the error.message\n        return SDAM_RECOVERING_CODES.has(err.code);\n    }\n    return (exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE.test(err.message) ||\n        exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(err.message));\n}\nfunction isNotWritablePrimaryError(err) {\n    if (typeof err.code === 'number') {\n        // If any error code exists, we ignore the error.message\n        return SDAM_NOT_PRIMARY_CODES.has(err.code);\n    }\n    if (isRecoveringError(err)) {\n        return false;\n    }\n    return exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(err.message);\n}\nfunction isNodeShuttingDownError(err) {\n    return !!(typeof err.code === 'number' && SDAM_NODE_SHUTTING_DOWN_ERROR_CODES.has(err.code));\n}\n/**\n * Determines whether SDAM can recover from a given error. If it cannot\n * then the pool will be cleared, and server state will completely reset\n * locally.\n *\n * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.md#not-writable-primary-and-node-is-recovering\n */\nfunction isSDAMUnrecoverableError(error) {\n    // NOTE: null check is here for a strictly pre-CMAP world, a timeout or\n    //       close event are considered unrecoverable\n    if (error instanceof MongoParseError || error == null) {\n        return true;\n    }\n    return isRecoveringError(error) || isNotWritablePrimaryError(error);\n}\nfunction isNetworkTimeoutError(err) {\n    return !!(err instanceof MongoNetworkError && err.message.match(/timed out/));\n}\nfunction isResumableError(error, wireVersion) {\n    if (error == null || !(error instanceof MongoError)) {\n        return false;\n    }\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    if (wireVersion != null && wireVersion >= 9) {\n        // DRIVERS-1308: For 4.4 drivers running against 4.4 servers, drivers will add a special case to treat the CursorNotFound error code as resumable\n        if (error.code === exports.MONGODB_ERROR_CODES.CursorNotFound) {\n            return true;\n        }\n        return error.hasErrorLabel(exports.MongoErrorLabel.ResumableChangeStreamError);\n    }\n    if (typeof error.code === 'number') {\n        return exports.GET_MORE_RESUMABLE_CODES.has(error.code);\n    }\n    return false;\n}\n//# sourceMappingURL=error.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2Vycm9yLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDhCQUE4QixHQUFHLGlDQUFpQyxHQUFHLHdCQUF3QixHQUFHLG1DQUFtQyxHQUFHLG9DQUFvQyxHQUFHLCtCQUErQixHQUFHLGlDQUFpQyxHQUFHLHVCQUF1QixHQUFHLGdDQUFnQyxHQUFHLHlCQUF5QixHQUFHLGdDQUFnQyxHQUFHLGlDQUFpQyxHQUFHLDhCQUE4QixHQUFHLDZCQUE2QixHQUFHLGtDQUFrQyxHQUFHLDBDQUEwQyxHQUFHLDZCQUE2QixHQUFHLDhCQUE4QixHQUFHLGdDQUFnQyxHQUFHLDhCQUE4QixHQUFHLDBDQUEwQyxHQUFHLHVDQUF1QyxHQUFHLGlDQUFpQyxHQUFHLHFCQUFxQixHQUFHLHVCQUF1QixHQUFHLHNCQUFzQixHQUFHLHFCQUFxQixHQUFHLDBCQUEwQixHQUFHLGdDQUFnQyxHQUFHLDZCQUE2QixHQUFHLDhCQUE4QixHQUFHLCtCQUErQixHQUFHLGtDQUFrQyxHQUFHLDhCQUE4QixHQUFHLHlCQUF5QixHQUFHLHFCQUFxQixHQUFHLHdCQUF3QixHQUFHLHdCQUF3QixHQUFHLGtCQUFrQixHQUFHLHVCQUF1QixHQUFHLGdDQUFnQyxHQUFHLDJCQUEyQixHQUFHLHdDQUF3QyxHQUFHLHFEQUFxRCxHQUFHLGlEQUFpRDtBQUNoK0MsZ0NBQWdDO0FBQ2hDLDZCQUE2QjtBQUM3Qiw0QkFBNEI7QUFDNUIsK0JBQStCO0FBQy9CLGdDQUFnQztBQUNoQyw2QkFBNkI7QUFDN0Isd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQ7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxTQUFTO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLG1CQUFtQjtBQUMxRCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsdUJBQXVCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isd0NBQXdDO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9lcnJvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvciA9IGV4cG9ydHMuTW9uZ29TZXJ2ZXJTZWxlY3Rpb25FcnJvciA9IGV4cG9ydHMuTW9uZ29TeXN0ZW1FcnJvciA9IGV4cG9ydHMuTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yID0gZXhwb3J0cy5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yID0gZXhwb3J0cy5Nb25nb0NvbXBhdGliaWxpdHlFcnJvciA9IGV4cG9ydHMuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvciA9IGV4cG9ydHMuTW9uZ29QYXJzZUVycm9yID0gZXhwb3J0cy5Nb25nb05ldHdvcmtUaW1lb3V0RXJyb3IgPSBleHBvcnRzLk1vbmdvTmV0d29ya0Vycm9yID0gZXhwb3J0cy5Nb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3IgPSBleHBvcnRzLk1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3IgPSBleHBvcnRzLk1vbmdvU2VydmVyQ2xvc2VkRXJyb3IgPSBleHBvcnRzLk1vbmdvQ3Vyc29ySW5Vc2VFcnJvciA9IGV4cG9ydHMuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgPSBleHBvcnRzLk1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3IgPSBleHBvcnRzLk1vbmdvR3JpZEZTQ2h1bmtFcnJvciA9IGV4cG9ydHMuTW9uZ29HcmlkRlNTdHJlYW1FcnJvciA9IGV4cG9ydHMuTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yID0gZXhwb3J0cy5Nb25nb0NoYW5nZVN0cmVhbUVycm9yID0gZXhwb3J0cy5Nb25nb0NsaWVudEJ1bGtXcml0ZUV4ZWN1dGlvbkVycm9yID0gZXhwb3J0cy5Nb25nb0NsaWVudEJ1bGtXcml0ZUN1cnNvckVycm9yID0gZXhwb3J0cy5Nb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yID0gZXhwb3J0cy5Nb25nb0dDUEVycm9yID0gZXhwb3J0cy5Nb25nb0F6dXJlRXJyb3IgPSBleHBvcnRzLk1vbmdvT0lEQ0Vycm9yID0gZXhwb3J0cy5Nb25nb0FXU0Vycm9yID0gZXhwb3J0cy5Nb25nb0tlcmJlcm9zRXJyb3IgPSBleHBvcnRzLk1vbmdvRXhwaXJlZFNlc3Npb25FcnJvciA9IGV4cG9ydHMuTW9uZ29UcmFuc2FjdGlvbkVycm9yID0gZXhwb3J0cy5Nb25nb05vdENvbm5lY3RlZEVycm9yID0gZXhwb3J0cy5Nb25nb0RlY29tcHJlc3Npb25FcnJvciA9IGV4cG9ydHMuTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IgPSBleHBvcnRzLk1vbmdvU3RhbGVQcmltYXJ5RXJyb3IgPSBleHBvcnRzLk1vbmdvUnVudGltZUVycm9yID0gZXhwb3J0cy5Nb25nb0FQSUVycm9yID0gZXhwb3J0cy5Nb25nb0RyaXZlckVycm9yID0gZXhwb3J0cy5Nb25nb1NlcnZlckVycm9yID0gZXhwb3J0cy5Nb25nb0Vycm9yID0gZXhwb3J0cy5Nb25nb0Vycm9yTGFiZWwgPSBleHBvcnRzLkdFVF9NT1JFX1JFU1VNQUJMRV9DT0RFUyA9IGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUyA9IGV4cG9ydHMuTk9ERV9JU19SRUNPVkVSSU5HX0VSUk9SX01FU1NBR0UgPSBleHBvcnRzLkxFR0FDWV9OT1RfUFJJTUFSWV9PUl9TRUNPTkRBUllfRVJST1JfTUVTU0FHRSA9IGV4cG9ydHMuTEVHQUNZX05PVF9XUklUQUJMRV9QUklNQVJZX0VSUk9SX01FU1NBR0UgPSB2b2lkIDA7XG5leHBvcnRzLm5lZWRzUmV0cnlhYmxlV3JpdGVMYWJlbCA9IG5lZWRzUmV0cnlhYmxlV3JpdGVMYWJlbDtcbmV4cG9ydHMuaXNSZXRyeWFibGVXcml0ZUVycm9yID0gaXNSZXRyeWFibGVXcml0ZUVycm9yO1xuZXhwb3J0cy5pc1JldHJ5YWJsZVJlYWRFcnJvciA9IGlzUmV0cnlhYmxlUmVhZEVycm9yO1xuZXhwb3J0cy5pc05vZGVTaHV0dGluZ0Rvd25FcnJvciA9IGlzTm9kZVNodXR0aW5nRG93bkVycm9yO1xuZXhwb3J0cy5pc1NEQU1VbnJlY292ZXJhYmxlRXJyb3IgPSBpc1NEQU1VbnJlY292ZXJhYmxlRXJyb3I7XG5leHBvcnRzLmlzTmV0d29ya1RpbWVvdXRFcnJvciA9IGlzTmV0d29ya1RpbWVvdXRFcnJvcjtcbmV4cG9ydHMuaXNSZXN1bWFibGVFcnJvciA9IGlzUmVzdW1hYmxlRXJyb3I7XG4vKipcbiAqIEBpbnRlcm5hbFxuICogVGhlIGxlZ2FjeSBlcnJvciBtZXNzYWdlIGZyb20gdGhlIHNlcnZlciB0aGF0IGluZGljYXRlcyB0aGUgbm9kZSBpcyBub3QgYSB3cml0YWJsZSBwcmltYXJ5XG4gKiBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iLzkyMTIzMjk3NmY5OTEzY2YxNzQxNWI1ZWY5MzdlZTc3MmU0NWU2YWUvc291cmNlL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3Jpbmcvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy5tZCNub3Qtd3JpdGFibGUtcHJpbWFyeS1hbmQtbm9kZS1pcy1yZWNvdmVyaW5nXG4gKi9cbmV4cG9ydHMuTEVHQUNZX05PVF9XUklUQUJMRV9QUklNQVJZX0VSUk9SX01FU1NBR0UgPSBuZXcgUmVnRXhwKCdub3QgbWFzdGVyJywgJ2knKTtcbi8qKlxuICogQGludGVybmFsXG4gKiBUaGUgbGVnYWN5IGVycm9yIG1lc3NhZ2UgZnJvbSB0aGUgc2VydmVyIHRoYXQgaW5kaWNhdGVzIHRoZSBub2RlIGlzIG5vdCBhIHByaW1hcnkgb3Igc2Vjb25kYXJ5XG4gKiBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iLzkyMTIzMjk3NmY5OTEzY2YxNzQxNWI1ZWY5MzdlZTc3MmU0NWU2YWUvc291cmNlL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3Jpbmcvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy5tZCNub3Qtd3JpdGFibGUtcHJpbWFyeS1hbmQtbm9kZS1pcy1yZWNvdmVyaW5nXG4gKi9cbmV4cG9ydHMuTEVHQUNZX05PVF9QUklNQVJZX09SX1NFQ09OREFSWV9FUlJPUl9NRVNTQUdFID0gbmV3IFJlZ0V4cCgnbm90IG1hc3RlciBvciBzZWNvbmRhcnknLCAnaScpO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIFRoZSBlcnJvciBtZXNzYWdlIGZyb20gdGhlIHNlcnZlciB0aGF0IGluZGljYXRlcyB0aGUgbm9kZSBpcyByZWNvdmVyaW5nXG4gKiBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iLzkyMTIzMjk3NmY5OTEzY2YxNzQxNWI1ZWY5MzdlZTc3MmU0NWU2YWUvc291cmNlL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3Jpbmcvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy5tZCNub3Qtd3JpdGFibGUtcHJpbWFyeS1hbmQtbm9kZS1pcy1yZWNvdmVyaW5nXG4gKi9cbmV4cG9ydHMuTk9ERV9JU19SRUNPVkVSSU5HX0VSUk9SX01FU1NBR0UgPSBuZXcgUmVnRXhwKCdub2RlIGlzIHJlY292ZXJpbmcnLCAnaScpO1xuLyoqIEBpbnRlcm5hbCBNb25nb0RCIEVycm9yIENvZGVzICovXG5leHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMgPSBPYmplY3QuZnJlZXplKHtcbiAgICBIb3N0VW5yZWFjaGFibGU6IDYsXG4gICAgSG9zdE5vdEZvdW5kOiA3LFxuICAgIEF1dGhlbnRpY2F0aW9uRmFpbGVkOiAxOCxcbiAgICBOZXR3b3JrVGltZW91dDogODksXG4gICAgU2h1dGRvd25JblByb2dyZXNzOiA5MSxcbiAgICBQcmltYXJ5U3RlcHBlZERvd246IDE4OSxcbiAgICBFeGNlZWRlZFRpbWVMaW1pdDogMjYyLFxuICAgIFNvY2tldEV4Y2VwdGlvbjogOTAwMSxcbiAgICBOb3RXcml0YWJsZVByaW1hcnk6IDEwMTA3LFxuICAgIEludGVycnVwdGVkQXRTaHV0ZG93bjogMTE2MDAsXG4gICAgSW50ZXJydXB0ZWREdWVUb1JlcGxTdGF0ZUNoYW5nZTogMTE2MDIsXG4gICAgTm90UHJpbWFyeU5vU2Vjb25kYXJ5T2s6IDEzNDM1LFxuICAgIE5vdFByaW1hcnlPclNlY29uZGFyeTogMTM0MzYsXG4gICAgU3RhbGVTaGFyZFZlcnNpb246IDYzLFxuICAgIFN0YWxlRXBvY2g6IDE1MCxcbiAgICBTdGFsZUNvbmZpZzogMTMzODgsXG4gICAgUmV0cnlDaGFuZ2VTdHJlYW06IDIzNCxcbiAgICBGYWlsZWRUb1NhdGlzZnlSZWFkUHJlZmVyZW5jZTogMTMzLFxuICAgIEN1cnNvck5vdEZvdW5kOiA0MyxcbiAgICBMZWdhY3lOb3RQcmltYXJ5OiAxMDA1OCxcbiAgICAvLyBXcml0ZUNvbmNlcm5UaW1lb3V0IGlzIFdyaXRlQ29uY2VybkZhaWxlZCBvbiBwcmUtOC4xIHNlcnZlcnNcbiAgICBXcml0ZUNvbmNlcm5UaW1lb3V0OiA2NCxcbiAgICBOYW1lc3BhY2VOb3RGb3VuZDogMjYsXG4gICAgSWxsZWdhbE9wZXJhdGlvbjogMjAsXG4gICAgTWF4VGltZU1TRXhwaXJlZDogNTAsXG4gICAgVW5rbm93blJlcGxXcml0ZUNvbmNlcm46IDc5LFxuICAgIFVuc2F0aXNmaWFibGVXcml0ZUNvbmNlcm46IDEwMCxcbiAgICBSZWF1dGhlbnRpY2F0ZTogMzkxLFxuICAgIFJlYWRDb25jZXJuTWFqb3JpdHlOb3RBdmFpbGFibGVZZXQ6IDEzNFxufSk7XG4vLyBGcm9tIHNwZWMgaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi85MjEyMzI5NzZmOTkxM2NmMTc0MTViNWVmOTM3ZWU3NzJlNDVlNmFlL3NvdXJjZS9jaGFuZ2Utc3RyZWFtcy9jaGFuZ2Utc3RyZWFtcy5tZCNyZXN1bWFibGUtZXJyb3JcbmV4cG9ydHMuR0VUX01PUkVfUkVTVU1BQkxFX0NPREVTID0gbmV3IFNldChbXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkhvc3RVbnJlYWNoYWJsZSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSG9zdE5vdEZvdW5kLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5OZXR3b3JrVGltZW91dCxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU2h1dGRvd25JblByb2dyZXNzLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5QcmltYXJ5U3RlcHBlZERvd24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkV4Y2VlZGVkVGltZUxpbWl0LFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Tb2NrZXRFeGNlcHRpb24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5vdFdyaXRhYmxlUHJpbWFyeSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSW50ZXJydXB0ZWRBdFNodXRkb3duLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5JbnRlcnJ1cHRlZER1ZVRvUmVwbFN0YXRlQ2hhbmdlLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ob3RQcmltYXJ5Tm9TZWNvbmRhcnlPayxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90UHJpbWFyeU9yU2Vjb25kYXJ5LFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5TdGFsZVNoYXJkVmVyc2lvbixcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU3RhbGVFcG9jaCxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU3RhbGVDb25maWcsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlJldHJ5Q2hhbmdlU3RyZWFtLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5GYWlsZWRUb1NhdGlzZnlSZWFkUHJlZmVyZW5jZSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuQ3Vyc29yTm90Rm91bmRcbl0pO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuTW9uZ29FcnJvckxhYmVsID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgUmV0cnlhYmxlV3JpdGVFcnJvcjogJ1JldHJ5YWJsZVdyaXRlRXJyb3InLFxuICAgIFRyYW5zaWVudFRyYW5zYWN0aW9uRXJyb3I6ICdUcmFuc2llbnRUcmFuc2FjdGlvbkVycm9yJyxcbiAgICBVbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQ6ICdVbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQnLFxuICAgIFJlc3VtYWJsZUNoYW5nZVN0cmVhbUVycm9yOiAnUmVzdW1hYmxlQ2hhbmdlU3RyZWFtRXJyb3InLFxuICAgIEhhbmRzaGFrZUVycm9yOiAnSGFuZHNoYWtlRXJyb3InLFxuICAgIFJlc2V0UG9vbDogJ1Jlc2V0UG9vbCcsXG4gICAgUG9vbFJlcXVzdGVkUmV0cnk6ICdQb29sUmVxdXN0ZWRSZXRyeScsXG4gICAgSW50ZXJydXB0SW5Vc2VDb25uZWN0aW9uczogJ0ludGVycnVwdEluVXNlQ29ubmVjdGlvbnMnLFxuICAgIE5vV3JpdGVzUGVyZm9ybWVkOiAnTm9Xcml0ZXNQZXJmb3JtZWQnXG59KTtcbmZ1bmN0aW9uIGlzQWdncmVnYXRlRXJyb3IoZSkge1xuICAgIHJldHVybiBlICE9IG51bGwgJiYgdHlwZW9mIGUgPT09ICdvYmplY3QnICYmICdlcnJvcnMnIGluIGUgJiYgQXJyYXkuaXNBcnJheShlLmVycm9ycyk7XG59XG4vKipcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICpcbiAqIEBwcml2YXRlUmVtYXJrc1xuICogbW9uZ29kYi1jbGllbnQtZW5jcnlwdGlvbiBoYXMgYSBkZXBlbmRlbmN5IG9uIHRoaXMgZXJyb3IsIGl0IHVzZXMgdGhlIGNvbnN0cnVjdG9yIHdpdGggYSBzdHJpbmcgYXJndW1lbnRcbiAqL1xuY2xhc3MgTW9uZ29FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBnZXQgZXJyb3JMYWJlbHMoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZXJyb3JMYWJlbFNldCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIG9wdGlvbnMpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMuZXJyb3JMYWJlbFNldCA9IG5ldyBTZXQoKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBidWlsZEVycm9yTWVzc2FnZShlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0FnZ3JlZ2F0ZUVycm9yKGUpICYmIGUubWVzc2FnZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBlLmVycm9ycy5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICA/ICdBZ2dyZWdhdGVFcnJvciBoYXMgYW4gZW1wdHkgZXJyb3JzIGFycmF5LiBQbGVhc2UgY2hlY2sgdGhlIGBjYXVzZWAgcHJvcGVydHkgZm9yIG1vcmUgaW5mb3JtYXRpb24uJ1xuICAgICAgICAgICAgICAgIDogZS5lcnJvcnMubWFwKCh7IG1lc3NhZ2UgfSkgPT4gbWVzc2FnZSkuam9pbignLCAnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZSAhPSBudWxsICYmIHR5cGVvZiBlID09PSAnb2JqZWN0JyAmJiAnbWVzc2FnZScgaW4gZSAmJiB0eXBlb2YgZS5tZXNzYWdlID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgPyBlLm1lc3NhZ2VcbiAgICAgICAgICAgIDogJ2VtcHR5IGVycm9yIG1lc3NhZ2UnO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0Vycm9yJztcbiAgICB9XG4gICAgLyoqIExlZ2FjeSBuYW1lIGZvciBzZXJ2ZXIgZXJyb3IgcmVzcG9uc2VzICovXG4gICAgZ2V0IGVycm1zZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHRoZSBlcnJvciB0byBzZWUgaWYgaXQgaGFzIGFuIGVycm9yIGxhYmVsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbGFiZWwgLSBUaGUgZXJyb3IgbGFiZWwgdG8gY2hlY2sgZm9yXG4gICAgICogQHJldHVybnMgcmV0dXJucyB0cnVlIGlmIHRoZSBlcnJvciBoYXMgdGhlIHByb3ZpZGVkIGVycm9yIGxhYmVsXG4gICAgICovXG4gICAgaGFzRXJyb3JMYWJlbChsYWJlbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvckxhYmVsU2V0LmhhcyhsYWJlbCk7XG4gICAgfVxuICAgIGFkZEVycm9yTGFiZWwobGFiZWwpIHtcbiAgICAgICAgdGhpcy5lcnJvckxhYmVsU2V0LmFkZChsYWJlbCk7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0Vycm9yID0gTW9uZ29FcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgY29taW5nIGZyb20gdGhlIG1vbmdvIHNlcnZlclxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1NlcnZlckVycm9yIGV4dGVuZHMgTW9uZ29FcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZS5tZXNzYWdlIHx8IG1lc3NhZ2UuZXJybXNnIHx8IG1lc3NhZ2UuJGVyciB8fCAnbi9hJyk7XG4gICAgICAgIGlmIChtZXNzYWdlLmVycm9yTGFiZWxzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxhYmVsIG9mIG1lc3NhZ2UuZXJyb3JMYWJlbHMpXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRFcnJvckxhYmVsKGxhYmVsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVycm9yUmVzcG9uc2UgPSBtZXNzYWdlO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gbWVzc2FnZSkge1xuICAgICAgICAgICAgaWYgKG5hbWUgIT09ICdlcnJvckxhYmVscycgJiZcbiAgICAgICAgICAgICAgICBuYW1lICE9PSAnZXJybXNnJyAmJlxuICAgICAgICAgICAgICAgIG5hbWUgIT09ICdtZXNzYWdlJyAmJlxuICAgICAgICAgICAgICAgIG5hbWUgIT09ICdlcnJvclJlc3BvbnNlJykge1xuICAgICAgICAgICAgICAgIHRoaXNbbmFtZV0gPSBtZXNzYWdlW25hbWVdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvU2VydmVyRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29TZXJ2ZXJFcnJvciA9IE1vbmdvU2VydmVyRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCBieSB0aGUgZHJpdmVyXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvRHJpdmVyRXJyb3IgZXh0ZW5kcyBNb25nb0Vycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29Ecml2ZXJFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0RyaXZlckVycm9yID0gTW9uZ29Ecml2ZXJFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIGRyaXZlciBBUEkgaXMgdXNlZCBpbmNvcnJlY3RseVxuICpcbiAqIEBwcml2YXRlUmVtYXJrc1xuICogU2hvdWxkICoqbmV2ZXIqKiBiZSBkaXJlY3RseSBpbnN0YW50aWF0ZWRcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29BUElFcnJvciBleHRlbmRzIE1vbmdvRHJpdmVyRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0FQSUVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQVBJRXJyb3IgPSBNb25nb0FQSUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgZHJpdmVyIGVuY291bnRlcnMgdW5leHBlY3RlZCBpbnB1dFxuICogb3IgcmVhY2hlcyBhbiB1bmV4cGVjdGVkL2ludmFsaWQgaW50ZXJuYWwgc3RhdGUuXG4gKlxuICogQHByaXZhdGVSZW1hcmtzXG4gKiBTaG91bGQgKipuZXZlcioqIGJlIGRpcmVjdGx5IGluc3RhbnRpYXRlZC5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29SdW50aW1lRXJyb3IgZXh0ZW5kcyBNb25nb0RyaXZlckVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29SdW50aW1lRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29SdW50aW1lRXJyb3IgPSBNb25nb1J1bnRpbWVFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gYSBwcmltYXJ5IHNlcnZlciBpcyBtYXJrZWQgc3RhbGUsIG5ldmVyIGRpcmVjdGx5IHRocm93blxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1N0YWxlUHJpbWFyeUVycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1N0YWxlUHJpbWFyeUVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvU3RhbGVQcmltYXJ5RXJyb3IgPSBNb25nb1N0YWxlUHJpbWFyeUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIGJhdGNoIGNvbW1hbmQgaXMgcmUtZXhlY3V0ZWQgYWZ0ZXIgb25lIG9mIHRoZSBjb21tYW5kcyBpbiB0aGUgYmF0Y2hcbiAqIGhhcyBmYWlsZWRcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSA9ICdUaGlzIGJhdGNoIGhhcyBhbHJlYWR5IGJlZW4gZXhlY3V0ZWQsIGNyZWF0ZSBuZXcgYmF0Y2ggdG8gZXhlY3V0ZScpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQmF0Y2hSZUV4ZWN1dGlvbkVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQmF0Y2hSZUV4ZWN1dGlvbkVycm9yID0gTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIHRoZSBkcml2ZXIgZmFpbHMgdG8gZGVjb21wcmVzc1xuICogZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvRGVjb21wcmVzc2lvbkVycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0RlY29tcHJlc3Npb25FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0RlY29tcHJlc3Npb25FcnJvciA9IE1vbmdvRGVjb21wcmVzc2lvbkVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciB0aHJvd24gd2hlbiB0aGUgdXNlciBhdHRlbXB0cyB0byBvcGVyYXRlIG9uIGEgZGF0YWJhc2Ugb3IgY29sbGVjdGlvbiB0aHJvdWdoIGEgTW9uZ29DbGllbnRcbiAqIHRoYXQgaGFzIG5vdCB5ZXQgc3VjY2Vzc2Z1bGx5IGNhbGxlZCB0aGUgXCJjb25uZWN0XCIgbWV0aG9kXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvTm90Q29ubmVjdGVkRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29Ob3RDb25uZWN0ZWRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb05vdENvbm5lY3RlZEVycm9yID0gTW9uZ29Ob3RDb25uZWN0ZWRFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIHVzZXIgbWFrZXMgYSBtaXN0YWtlIGluIHRoZSB1c2FnZSBvZiB0cmFuc2FjdGlvbnMuXG4gKiAoZS5nLiBhdHRlbXB0aW5nIHRvIGNvbW1pdCBhIHRyYW5zYWN0aW9uIHdpdGggYSByZWFkUHJlZmVyZW5jZSBvdGhlciB0aGFuIHByaW1hcnkpXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvVHJhbnNhY3Rpb25FcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1RyYW5zYWN0aW9uRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29UcmFuc2FjdGlvbkVycm9yID0gTW9uZ29UcmFuc2FjdGlvbkVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgdXNlciBhdHRlbXB0cyB0byBvcGVyYXRlXG4gKiBvbiBhIHNlc3Npb24gdGhhdCBoYXMgZXhwaXJlZCBvciBoYXMgYmVlbiBjbG9zZWQuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvRXhwaXJlZFNlc3Npb25FcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ0Nhbm5vdCB1c2UgYSBzZXNzaW9uIHRoYXQgaGFzIGVuZGVkJykge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvRXhwaXJlZFNlc3Npb25FcnJvciA9IE1vbmdvRXhwaXJlZFNlc3Npb25FcnJvcjtcbi8qKlxuICogQSBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgdXNlciBhdHRlbXB0cyB0byBhdXRoZW50aWNhdGVcbiAqIHZpYSBLZXJiZXJvcywgYnV0IGZhaWxzIHRvIGNvbm5lY3QgdG8gdGhlIEtlcmJlcm9zIGNsaWVudC5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29LZXJiZXJvc0Vycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0tlcmJlcm9zRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29LZXJiZXJvc0Vycm9yID0gTW9uZ29LZXJiZXJvc0Vycm9yO1xuLyoqXG4gKiBBIGVycm9yIGdlbmVyYXRlZCB3aGVuIHRoZSB1c2VyIGF0dGVtcHRzIHRvIGF1dGhlbnRpY2F0ZVxuICogdmlhIEFXUywgYnV0IGZhaWxzXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvQVdTRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQVdTRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29BV1NFcnJvciA9IE1vbmdvQVdTRXJyb3I7XG4vKipcbiAqIEEgZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIHVzZXIgYXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlXG4gKiB2aWEgT0lEQyBjYWxsYmFja3MsIGJ1dCBmYWlscy5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29PSURDRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvT0lEQ0Vycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvT0lEQ0Vycm9yID0gTW9uZ29PSURDRXJyb3I7XG4vKipcbiAqIEEgZXJyb3IgZ2VuZXJhdGVkIHdoZW4gdGhlIHVzZXIgYXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlXG4gKiB2aWEgQXp1cmUsIGJ1dCBmYWlscy5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29BenVyZUVycm9yIGV4dGVuZHMgTW9uZ29PSURDRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0F6dXJlRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29BenVyZUVycm9yID0gTW9uZ29BenVyZUVycm9yO1xuLyoqXG4gKiBBIGVycm9yIGdlbmVyYXRlZCB3aGVuIHRoZSB1c2VyIGF0dGVtcHRzIHRvIGF1dGhlbnRpY2F0ZVxuICogdmlhIEdDUCwgYnV0IGZhaWxzLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0dDUEVycm9yIGV4dGVuZHMgTW9uZ29PSURDRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0dDUEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvR0NQRXJyb3IgPSBNb25nb0dDUEVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBpbmRpY2F0aW5nIHRoYXQgYW4gZXJyb3Igb2NjdXJyZWQgd2hlbiBleGVjdXRpbmcgdGhlIGJ1bGsgd3JpdGUuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvQ2xpZW50QnVsa1dyaXRlRXJyb3IgZXh0ZW5kcyBNb25nb1NlcnZlckVycm9yIHtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBjbGllbnQgYnVsayB3cml0ZSBlcnJvci5cbiAgICAgKiBAcGFyYW0gbWVzc2FnZSAtIFRoZSBlcnJvciBtZXNzYWdlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIHRoaXMud3JpdGVDb25jZXJuRXJyb3JzID0gW107XG4gICAgICAgIHRoaXMud3JpdGVFcnJvcnMgPSBuZXcgTWFwKCk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQ2xpZW50QnVsa1dyaXRlRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29DbGllbnRCdWxrV3JpdGVFcnJvciA9IE1vbmdvQ2xpZW50QnVsa1dyaXRlRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgdGhhdCBhbiBlcnJvciBvY2N1cnJlZCB3aGVuIHByb2Nlc3NpbmcgYnVsayB3cml0ZSByZXN1bHRzLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0NsaWVudEJ1bGtXcml0ZUN1cnNvckVycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0NsaWVudEJ1bGtXcml0ZUN1cnNvckVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ2xpZW50QnVsa1dyaXRlQ3Vyc29yRXJyb3IgPSBNb25nb0NsaWVudEJ1bGtXcml0ZUN1cnNvckVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBpbmRpY2F0aW5nIHRoYXQgYW4gZXJyb3Igb2NjdXJyZWQgb24gdGhlIGNsaWVudCB3aGVuIGV4ZWN1dGluZyBhIGNsaWVudCBidWxrIHdyaXRlLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0NsaWVudEJ1bGtXcml0ZUV4ZWN1dGlvbkVycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0NsaWVudEJ1bGtXcml0ZUV4ZWN1dGlvbkVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ2xpZW50QnVsa1dyaXRlRXhlY3V0aW9uRXJyb3IgPSBNb25nb0NsaWVudEJ1bGtXcml0ZUV4ZWN1dGlvbkVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIENoYW5nZVN0cmVhbSBvcGVyYXRpb24gZmFpbHMgdG8gZXhlY3V0ZS5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29DaGFuZ2VTdHJlYW1FcnJvciBleHRlbmRzIE1vbmdvUnVudGltZUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29DaGFuZ2VTdHJlYW1FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NoYW5nZVN0cmVhbUVycm9yID0gTW9uZ29DaGFuZ2VTdHJlYW1FcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdGhyb3duIHdoZW4gdGhlIHVzZXIgY2FsbHMgYSBmdW5jdGlvbiBvciBtZXRob2Qgbm90IHN1cHBvcnRlZCBvbiBhIHRhaWxhYmxlIGN1cnNvclxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSA9ICdUYWlsYWJsZSBjdXJzb3IgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIG9wZXJhdGlvbicpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvVGFpbGFibGVDdXJzb3JFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3IgPSBNb25nb1RhaWxhYmxlQ3Vyc29yRXJyb3I7XG4vKiogQW4gZXJyb3IgZ2VuZXJhdGVkIHdoZW4gYSBHcmlkRlNTdHJlYW0gb3BlcmF0aW9uIGZhaWxzIHRvIGV4ZWN1dGUuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvR3JpZEZTU3RyZWFtRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvR3JpZEZTU3RyZWFtRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29HcmlkRlNTdHJlYW1FcnJvciA9IE1vbmdvR3JpZEZTU3RyZWFtRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGEgbWFsZm9ybWVkIG9yIGludmFsaWQgY2h1bmsgaXNcbiAqIGVuY291bnRlcmVkIHdoZW4gcmVhZGluZyBmcm9tIGEgR3JpZEZTU3RyZWFtLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0dyaWRGU0NodW5rRXJyb3IgZXh0ZW5kcyBNb25nb1J1bnRpbWVFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvR3JpZEZTQ2h1bmtFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0dyaWRGU0NodW5rRXJyb3IgPSBNb25nb0dyaWRGU0NodW5rRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGEgKipwYXJzYWJsZSoqIHVuZXhwZWN0ZWQgcmVzcG9uc2UgY29tZXMgZnJvbSB0aGUgc2VydmVyLlxuICogVGhpcyBpcyBnZW5lcmFsbHkgYW4gZXJyb3Igd2hlcmUgdGhlIGRyaXZlciBpbiBhIHN0YXRlIGV4cGVjdGluZyBhIGNlcnRhaW4gYmVoYXZpb3IgdG8gb2NjdXIgaW5cbiAqIHRoZSBuZXh0IG1lc3NhZ2UgZnJvbSBNb25nb0RCIGJ1dCBpdCByZWNlaXZlcyBzb21ldGhpbmcgZWxzZS5cbiAqIFRoaXMgZXJyb3IgKipkb2VzIG5vdCoqIHJlcHJlc2VudCBhbiBpc3N1ZSB3aXRoIHdpcmUgbWVzc2FnZSBmb3JtYXR0aW5nLlxuICpcbiAqICMjIyMgRXhhbXBsZVxuICogV2hlbiBhbiBvcGVyYXRpb24gZmFpbHMsIGl0IGlzIHRoZSBkcml2ZXIncyBqb2IgdG8gcmV0cnkgaXQuIEl0IG11c3QgcGVyZm9ybSBzZXJ2ZXJTZWxlY3Rpb25cbiAqIGFnYWluIHRvIG1ha2Ugc3VyZSB0aGF0IGl0IGF0dGVtcHRzIHRoZSBvcGVyYXRpb24gYWdhaW5zdCBhIHNlcnZlciBpbiBhIGdvb2Qgc3RhdGUuIElmIHNlcnZlclxuICogc2VsZWN0aW9uIHJldHVybnMgYSBzZXJ2ZXIgdGhhdCBkb2VzIG5vdCBzdXBwb3J0IHJldHJ5YWJsZSBvcGVyYXRpb25zLCB0aGlzIGVycm9yIGlzIHVzZWQuXG4gKiBUaGlzIHNjZW5hcmlvIGlzIHVubGlrZWx5IGFzIHJldHJ5YWJsZSBzdXBwb3J0IHdvdWxkIGFsc28gaGF2ZSBiZWVuIGRldGVybWluZWQgb24gdGhlIGZpcnN0IGF0dGVtcHRcbiAqIGJ1dCBpdCBpcyBwb3NzaWJsZSB0aGUgc3RhdGUgY2hhbmdlIGNvdWxkIHJlcG9ydCBhIHNlbGVjdGFibGUgc2VydmVyIHRoYXQgZG9lcyBub3Qgc3VwcG9ydCByZXRyaWVzLlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yIGV4dGVuZHMgTW9uZ29SdW50aW1lRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3IgPSBNb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yO1xuLyoqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqXG4gKiBUaGUgYE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yYCBjbGFzcyByZXByZXNlbnRzIGFuIGVycm9yIHRoYXQgb2NjdXJzIHdoZW4gYW4gb3BlcmF0aW9uIGNvdWxkIG5vdCBiZSBjb21wbGV0ZWQgd2l0aGluIHRoZSBzcGVjaWZpZWQgYHRpbWVvdXRNU2AuXG4gKiBJdCBpcyBnZW5lcmF0ZWQgYnkgdGhlIGRyaXZlciBpbiBzdXBwb3J0IG9mIHRoZSBcImNsaWVudCBzaWRlIG9wZXJhdGlvbiB0aW1lb3V0XCIgZmVhdHVyZSBzbyBpbmhlcml0cyBmcm9tIGBNb25nb0RyaXZlckVycm9yYC5cbiAqIFdoZW4gYHRpbWVvdXRNU2AgaXMgZW5hYmxlZCBgTW9uZ29TZXJ2ZXJFcnJvcmBzIHJlbGF0aW5nIHRvIGBNYXhUaW1lRXhwaXJlZGAgZXJyb3JzIHdpbGwgYmUgY29udmVydGVkIHRvIGBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcmBcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIHRyeSB7XG4gKiAgIGF3YWl0IGJsb2dzLmluc2VydE9uZShibG9nUG9zdCwgeyB0aW1lb3V0TVM6IDYwXzAwMCB9KVxuICogfSBjYXRjaCAoZXJyb3IpIHtcbiAqICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IpIHtcbiAqICAgICBjb25zb2xlLmxvZyhgT2ggbm8hIHdyaXRlcidzIGJsb2NrIWAsIGVycm9yKTtcbiAqICAgfVxuICogfVxuICogYGBgXG4gKi9cbmNsYXNzIE1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yIGV4dGVuZHMgTW9uZ29Ecml2ZXJFcnJvciB7XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgPSBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdGhyb3duIHdoZW4gdGhlIHVzZXIgYXR0ZW1wdHMgdG8gYWRkIG9wdGlvbnMgdG8gYSBjdXJzb3IgdGhhdCBoYXMgYWxyZWFkeSBiZWVuXG4gKiBpbml0aWFsaXplZFxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0N1cnNvckluVXNlRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSA9ICdDdXJzb3IgaXMgYWxyZWFkeSBpbml0aWFsaXplZCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQ3Vyc29ySW5Vc2VFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0N1cnNvckluVXNlRXJyb3IgPSBNb25nb0N1cnNvckluVXNlRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGFuIGF0dGVtcHQgaXMgbWFkZSB0byBvcGVyYXRlXG4gKiBvbiBhIGNsb3NlZC9jbG9zaW5nIHNlcnZlci5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ1NlcnZlciBpcyBjbG9zZWQnKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1NlcnZlckNsb3NlZEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvU2VydmVyQ2xvc2VkRXJyb3IgPSBNb25nb1NlcnZlckNsb3NlZEVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciB0aHJvd24gd2hlbiBhbiBhdHRlbXB0IGlzIG1hZGUgdG8gcmVhZCBmcm9tIGEgY3Vyc29yIHRoYXQgaGFzIGJlZW4gZXhoYXVzdGVkXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlIHx8ICdDdXJzb3IgaXMgZXhoYXVzdGVkJyk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvciA9IE1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGFuIGF0dGVtcHQgaXMgbWFkZSB0byBvcGVyYXRlIG9uIGFcbiAqIGRyb3BwZWQsIG9yIG90aGVyd2lzZSB1bmF2YWlsYWJsZSwgZGF0YWJhc2UuXG4gKlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ1RvcG9sb2d5IGlzIGNsb3NlZCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3IgPSBNb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgYW4gaXNzdWUgd2l0aCB0aGUgbmV0d29yaywgaW5jbHVkaW5nIFRDUCBlcnJvcnMgYW5kIHRpbWVvdXRzLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvTmV0d29ya0Vycm9yIGV4dGVuZHMgTW9uZ29FcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgeyBjYXVzZTogb3B0aW9ucz8uY2F1c2UgfSk7XG4gICAgICAgIHRoaXMuYmVmb3JlSGFuZHNoYWtlID0gISFvcHRpb25zPy5iZWZvcmVIYW5kc2hha2U7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvTmV0d29ya0Vycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvTmV0d29ya0Vycm9yID0gTW9uZ29OZXR3b3JrRXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGluZGljYXRpbmcgYSBuZXR3b3JrIHRpbWVvdXQgb2NjdXJyZWRcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICpcbiAqIEBwcml2YXRlUmVtYXJrc1xuICogbW9uZ29kYi1jbGllbnQtZW5jcnlwdGlvbiBoYXMgYSBkZXBlbmRlbmN5IG9uIHRoaXMgZXJyb3Igd2l0aCBhbiBpbnN0YW5jZW9mIGNoZWNrXG4gKi9cbmNsYXNzIE1vbmdvTmV0d29ya1RpbWVvdXRFcnJvciBleHRlbmRzIE1vbmdvTmV0d29ya0Vycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29OZXR3b3JrVGltZW91dEVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvciA9IE1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcjtcbi8qKlxuICogQW4gZXJyb3IgdXNlZCB3aGVuIGF0dGVtcHRpbmcgdG8gcGFyc2UgYSB2YWx1ZSAobGlrZSBhIGNvbm5lY3Rpb24gc3RyaW5nKVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvUGFyc2VFcnJvciBleHRlbmRzIE1vbmdvRHJpdmVyRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1BhcnNlRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29QYXJzZUVycm9yID0gTW9uZ29QYXJzZUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgdXNlciBzdXBwbGllcyBtYWxmb3JtZWQgb3IgdW5leHBlY3RlZCBhcmd1bWVudHNcbiAqIG9yIHdoZW4gYSByZXF1aXJlZCBhcmd1bWVudCBvciBmaWVsZCBpcyBub3QgcHJvdmlkZWQuXG4gKlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0ludmFsaWRBcmd1bWVudEVycm9yIGV4dGVuZHMgTW9uZ29BUElFcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvciA9IE1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIGdlbmVyYXRlZCB3aGVuIGEgZmVhdHVyZSB0aGF0IGlzIG5vdCBlbmFibGVkIG9yIGFsbG93ZWQgZm9yIHRoZSBjdXJyZW50IHNlcnZlclxuICogY29uZmlndXJhdGlvbiBpcyB1c2VkXG4gKlxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb0NvbXBhdGliaWxpdHlFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb0NvbXBhdGliaWxpdHlFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NvbXBhdGliaWxpdHlFcnJvciA9IE1vbmdvQ29tcGF0aWJpbGl0eUVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiB0aGUgdXNlciBmYWlscyB0byBwcm92aWRlIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIGJlZm9yZSBhdHRlbXB0aW5nXG4gKiB0byBjb25uZWN0IHRvIGEgbW9uZ28gc2VydmVyIGluc3RhbmNlLlxuICpcbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXJyb3JcbiAqL1xuY2xhc3MgTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvciBleHRlbmRzIE1vbmdvQVBJRXJyb3Ige1xuICAgIC8qKlxuICAgICAqICoqRG8gbm90IHVzZSB0aGlzIGNvbnN0cnVjdG9yISoqXG4gICAgICpcbiAgICAgKiBNZWFudCBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoaXMgY2xhc3MgaXMgb25seSBtZWFudCB0byBiZSBjb25zdHJ1Y3RlZCB3aXRoaW4gdGhlIGRyaXZlci4gVGhpcyBjb25zdHJ1Y3RvciBpc1xuICAgICAqIG5vdCBzdWJqZWN0IHRvIHNlbWFudGljIHZlcnNpb25pbmcgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzIGFuZCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqKi9cbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3IgPSBNb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yO1xuLyoqXG4gKiBBbiBlcnJvciBnZW5lcmF0ZWQgd2hlbiBhIHJlcXVpcmVkIG1vZHVsZSBvciBkZXBlbmRlbmN5IGlzIG5vdCBwcmVzZW50IGluIHRoZSBsb2NhbCBlbnZpcm9ubWVudFxuICpcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IgZXh0ZW5kcyBNb25nb0FQSUVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5kZXBlbmRlbmN5TmFtZSA9IG9wdGlvbnMuZGVwZW5kZW5jeU5hbWU7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3IgPSBNb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3I7XG4vKipcbiAqIEFuIGVycm9yIHNpZ25pZnlpbmcgYSBnZW5lcmFsIHN5c3RlbSBpc3N1ZVxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvU3lzdGVtRXJyb3IgZXh0ZW5kcyBNb25nb0Vycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgcmVhc29uKSB7XG4gICAgICAgIGlmIChyZWFzb24gJiYgcmVhc29uLmVycm9yKSB7XG4gICAgICAgICAgICBzdXBlcihNb25nb0Vycm9yLmJ1aWxkRXJyb3JNZXNzYWdlKHJlYXNvbi5lcnJvci5tZXNzYWdlIHx8IHJlYXNvbi5lcnJvciksIHtcbiAgICAgICAgICAgICAgICBjYXVzZTogcmVhc29uLmVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZWFzb24pIHtcbiAgICAgICAgICAgIHRoaXMucmVhc29uID0gcmVhc29uO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29kZSA9IHJlYXNvbi5lcnJvcj8uY29kZTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29TeXN0ZW1FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1N5c3RlbUVycm9yID0gTW9uZ29TeXN0ZW1FcnJvcjtcbi8qKlxuICogQW4gZXJyb3Igc2lnbmlmeWluZyBhIGNsaWVudC1zaWRlIHNlcnZlciBzZWxlY3Rpb24gZXJyb3JcbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFcnJvclxuICovXG5jbGFzcyBNb25nb1NlcnZlclNlbGVjdGlvbkVycm9yIGV4dGVuZHMgTW9uZ29TeXN0ZW1FcnJvciB7XG4gICAgLyoqXG4gICAgICogKipEbyBub3QgdXNlIHRoaXMgY29uc3RydWN0b3IhKipcbiAgICAgKlxuICAgICAqIE1lYW50IGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhpcyBjbGFzcyBpcyBvbmx5IG1lYW50IHRvIGJlIGNvbnN0cnVjdGVkIHdpdGhpbiB0aGUgZHJpdmVyLiBUaGlzIGNvbnN0cnVjdG9yIGlzXG4gICAgICogbm90IHN1YmplY3QgdG8gc2VtYW50aWMgdmVyc2lvbmluZyBjb21wYXRpYmlsaXR5IGd1YXJhbnRlZXMgYW5kIG1heSBjaGFuZ2UgYXQgYW55IHRpbWUuXG4gICAgICpcbiAgICAgKiBAcHVibGljXG4gICAgICoqL1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHJlYXNvbikge1xuICAgICAgICBzdXBlcihtZXNzYWdlLCByZWFzb24pO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNb25nb1NlcnZlclNlbGVjdGlvbkVycm9yJztcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvU2VydmVyU2VsZWN0aW9uRXJyb3IgPSBNb25nb1NlcnZlclNlbGVjdGlvbkVycm9yO1xuLyoqXG4gKiBBbiBlcnJvciB0aHJvd24gd2hlbiB0aGUgc2VydmVyIHJlcG9ydHMgYSB3cml0ZUNvbmNlcm5FcnJvclxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEVycm9yXG4gKi9cbmNsYXNzIE1vbmdvV3JpdGVDb25jZXJuRXJyb3IgZXh0ZW5kcyBNb25nb1NlcnZlckVycm9yIHtcbiAgICAvKipcbiAgICAgKiAqKkRvIG5vdCB1c2UgdGhpcyBjb25zdHJ1Y3RvciEqKlxuICAgICAqXG4gICAgICogTWVhbnQgZm9yIGludGVybmFsIHVzZSBvbmx5LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGlzIGNsYXNzIGlzIG9ubHkgbWVhbnQgdG8gYmUgY29uc3RydWN0ZWQgd2l0aGluIHRoZSBkcml2ZXIuIFRoaXMgY29uc3RydWN0b3IgaXNcbiAgICAgKiBub3Qgc3ViamVjdCB0byBzZW1hbnRpYyB2ZXJzaW9uaW5nIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcyBhbmQgbWF5IGNoYW5nZSBhdCBhbnkgdGltZS5cbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiovXG4gICAgY29uc3RydWN0b3IocmVzdWx0KSB7XG4gICAgICAgIHN1cGVyKHsgLi4ucmVzdWx0LndyaXRlQ29uY2VybkVycm9yLCAuLi5yZXN1bHQgfSk7XG4gICAgICAgIHRoaXMuZXJySW5mbyA9IHJlc3VsdC53cml0ZUNvbmNlcm5FcnJvci5lcnJJbmZvO1xuICAgICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcic7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb1dyaXRlQ29uY2VybkVycm9yID0gTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcjtcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9yZXRyeWFibGUtcmVhZHMvcmV0cnlhYmxlLXJlYWRzLm1kI3JldHJ5YWJsZS1lcnJvclxuY29uc3QgUkVUUllBQkxFX1JFQURfRVJST1JfQ09ERVMgPSBuZXcgU2V0KFtcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSG9zdFVucmVhY2hhYmxlLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ib3N0Tm90Rm91bmQsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5ldHdvcmtUaW1lb3V0LFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5TaHV0ZG93bkluUHJvZ3Jlc3MsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlByaW1hcnlTdGVwcGVkRG93bixcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuU29ja2V0RXhjZXB0aW9uLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5Ob3RXcml0YWJsZVByaW1hcnksXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkludGVycnVwdGVkQXRTaHV0ZG93bixcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSW50ZXJydXB0ZWREdWVUb1JlcGxTdGF0ZUNoYW5nZSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90UHJpbWFyeU5vU2Vjb25kYXJ5T2ssXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5vdFByaW1hcnlPclNlY29uZGFyeSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuRXhjZWVkZWRUaW1lTGltaXQsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlJlYWRDb25jZXJuTWFqb3JpdHlOb3RBdmFpbGFibGVZZXRcbl0pO1xuLy8gc2VlOiBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2UvcmV0cnlhYmxlLXdyaXRlcy9yZXRyeWFibGUtd3JpdGVzLm1kI3Rlcm1zXG5jb25zdCBSRVRSWUFCTEVfV1JJVEVfRVJST1JfQ09ERVMgPSBSRVRSWUFCTEVfUkVBRF9FUlJPUl9DT0RFUztcbmZ1bmN0aW9uIG5lZWRzUmV0cnlhYmxlV3JpdGVMYWJlbChlcnJvciwgbWF4V2lyZVZlcnNpb24sIHNlcnZlclR5cGUpIHtcbiAgICAvLyBwcmUtNC40IHNlcnZlciwgdGhlbiB0aGUgZHJpdmVyIGFkZHMgYW4gZXJyb3IgbGFiZWwgZm9yIGV2ZXJ5IHZhbGlkIGNhc2VcbiAgICAvLyBleGVjdXRlIG9wZXJhdGlvbiB3aWxsIG9ubHkgaW5zcGVjdCB0aGUgbGFiZWwsIGNvZGUvbWVzc2FnZSBsb2dpYyBpcyBoYW5kbGVkIGhlcmVcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBNb25nb05ldHdvcmtFcnJvcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29FcnJvcikge1xuICAgICAgICBpZiAoKG1heFdpcmVWZXJzaW9uID49IDkgfHwgaXNSZXRyeWFibGVXcml0ZUVycm9yKGVycm9yKSkgJiZcbiAgICAgICAgICAgICFlcnJvci5oYXNFcnJvckxhYmVsKGV4cG9ydHMuTW9uZ29FcnJvckxhYmVsLkhhbmRzaGFrZUVycm9yKSkge1xuICAgICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSBlcnJvciBsYWJlbCBubyBuZWVkIHRvIGFkZCBpdCBhZ2Fpbi4gNC40KyBzZXJ2ZXJzIGFkZCB0aGUgbGFiZWwuXG4gICAgICAgICAgICAvLyBJbiB0aGUgY2FzZSB3aGVyZSB3ZSBoYXZlIGEgaGFuZHNoYWtlIGVycm9yLCBuZWVkIHRvIGZhbGwgZG93biB0byB0aGUgbG9naWMgY2hlY2tpbmdcbiAgICAgICAgICAgIC8vIHRoZSBjb2Rlcy5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBNb25nb1dyaXRlQ29uY2VybkVycm9yKSB7XG4gICAgICAgIGlmIChzZXJ2ZXJUeXBlID09PSAnTW9uZ29zJyAmJiBtYXhXaXJlVmVyc2lvbiA8IDkpIHtcbiAgICAgICAgICAgIC8vIHVzZSBvcmlnaW5hbCB0b3AtbGV2ZWwgY29kZSBmcm9tIHNlcnZlciByZXNwb25zZVxuICAgICAgICAgICAgcmV0dXJuIFJFVFJZQUJMRV9XUklURV9FUlJPUl9DT0RFUy5oYXMoZXJyb3IucmVzdWx0LmNvZGUgPz8gMCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29kZSA9IGVycm9yLnJlc3VsdC53cml0ZUNvbmNlcm5FcnJvci5jb2RlID8/IE51bWJlcihlcnJvci5jb2RlKTtcbiAgICAgICAgcmV0dXJuIFJFVFJZQUJMRV9XUklURV9FUlJPUl9DT0RFUy5oYXMoTnVtYmVyLmlzTmFOKGNvZGUpID8gMCA6IGNvZGUpO1xuICAgIH1cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBNb25nb0Vycm9yKSB7XG4gICAgICAgIHJldHVybiBSRVRSWUFCTEVfV1JJVEVfRVJST1JfQ09ERVMuaGFzKE51bWJlcihlcnJvci5jb2RlKSk7XG4gICAgfVxuICAgIGNvbnN0IGlzTm90V3JpdGFibGVQcmltYXJ5RXJyb3IgPSBleHBvcnRzLkxFR0FDWV9OT1RfV1JJVEFCTEVfUFJJTUFSWV9FUlJPUl9NRVNTQUdFLnRlc3QoZXJyb3IubWVzc2FnZSk7XG4gICAgaWYgKGlzTm90V3JpdGFibGVQcmltYXJ5RXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGlzTm9kZUlzUmVjb3ZlcmluZ0Vycm9yID0gZXhwb3J0cy5OT0RFX0lTX1JFQ09WRVJJTkdfRVJST1JfTUVTU0FHRS50ZXN0KGVycm9yLm1lc3NhZ2UpO1xuICAgIGlmIChpc05vZGVJc1JlY292ZXJpbmdFcnJvcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gaXNSZXRyeWFibGVXcml0ZUVycm9yKGVycm9yKSB7XG4gICAgcmV0dXJuIChlcnJvci5oYXNFcnJvckxhYmVsKGV4cG9ydHMuTW9uZ29FcnJvckxhYmVsLlJldHJ5YWJsZVdyaXRlRXJyb3IpIHx8XG4gICAgICAgIGVycm9yLmhhc0Vycm9yTGFiZWwoZXhwb3J0cy5Nb25nb0Vycm9yTGFiZWwuUG9vbFJlcXVzdGVkUmV0cnkpKTtcbn1cbi8qKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gZXJyb3IgaXMgc29tZXRoaW5nIHRoZSBkcml2ZXIgc2hvdWxkIGF0dGVtcHQgdG8gcmV0cnkgKi9cbmZ1bmN0aW9uIGlzUmV0cnlhYmxlUmVhZEVycm9yKGVycm9yKSB7XG4gICAgY29uc3QgaGFzUmV0cnlhYmxlRXJyb3JDb2RlID0gdHlwZW9mIGVycm9yLmNvZGUgPT09ICdudW1iZXInID8gUkVUUllBQkxFX1JFQURfRVJST1JfQ09ERVMuaGFzKGVycm9yLmNvZGUpIDogZmFsc2U7XG4gICAgaWYgKGhhc1JldHJ5YWJsZUVycm9yQ29kZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29OZXR3b3JrRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGlzTm90V3JpdGFibGVQcmltYXJ5RXJyb3IgPSBleHBvcnRzLkxFR0FDWV9OT1RfV1JJVEFCTEVfUFJJTUFSWV9FUlJPUl9NRVNTQUdFLnRlc3QoZXJyb3IubWVzc2FnZSk7XG4gICAgaWYgKGlzTm90V3JpdGFibGVQcmltYXJ5RXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGlzTm9kZUlzUmVjb3ZlcmluZ0Vycm9yID0gZXhwb3J0cy5OT0RFX0lTX1JFQ09WRVJJTkdfRVJST1JfTUVTU0FHRS50ZXN0KGVycm9yLm1lc3NhZ2UpO1xuICAgIGlmIChpc05vZGVJc1JlY292ZXJpbmdFcnJvcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuY29uc3QgU0RBTV9SRUNPVkVSSU5HX0NPREVTID0gbmV3IFNldChbXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLlNodXRkb3duSW5Qcm9ncmVzcyxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuUHJpbWFyeVN0ZXBwZWREb3duLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5JbnRlcnJ1cHRlZEF0U2h1dGRvd24sXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkludGVycnVwdGVkRHVlVG9SZXBsU3RhdGVDaGFuZ2UsXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5vdFByaW1hcnlPclNlY29uZGFyeVxuXSk7XG5jb25zdCBTREFNX05PVF9QUklNQVJZX0NPREVTID0gbmV3IFNldChbXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLk5vdFdyaXRhYmxlUHJpbWFyeSxcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuTm90UHJpbWFyeU5vU2Vjb25kYXJ5T2ssXG4gICAgZXhwb3J0cy5NT05HT0RCX0VSUk9SX0NPREVTLkxlZ2FjeU5vdFByaW1hcnlcbl0pO1xuY29uc3QgU0RBTV9OT0RFX1NIVVRUSU5HX0RPV05fRVJST1JfQ09ERVMgPSBuZXcgU2V0KFtcbiAgICBleHBvcnRzLk1PTkdPREJfRVJST1JfQ09ERVMuSW50ZXJydXB0ZWRBdFNodXRkb3duLFxuICAgIGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5TaHV0ZG93bkluUHJvZ3Jlc3Ncbl0pO1xuZnVuY3Rpb24gaXNSZWNvdmVyaW5nRXJyb3IoZXJyKSB7XG4gICAgaWYgKHR5cGVvZiBlcnIuY29kZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgLy8gSWYgYW55IGVycm9yIGNvZGUgZXhpc3RzLCB3ZSBpZ25vcmUgdGhlIGVycm9yLm1lc3NhZ2VcbiAgICAgICAgcmV0dXJuIFNEQU1fUkVDT1ZFUklOR19DT0RFUy5oYXMoZXJyLmNvZGUpO1xuICAgIH1cbiAgICByZXR1cm4gKGV4cG9ydHMuTEVHQUNZX05PVF9QUklNQVJZX09SX1NFQ09OREFSWV9FUlJPUl9NRVNTQUdFLnRlc3QoZXJyLm1lc3NhZ2UpIHx8XG4gICAgICAgIGV4cG9ydHMuTk9ERV9JU19SRUNPVkVSSU5HX0VSUk9SX01FU1NBR0UudGVzdChlcnIubWVzc2FnZSkpO1xufVxuZnVuY3Rpb24gaXNOb3RXcml0YWJsZVByaW1hcnlFcnJvcihlcnIpIHtcbiAgICBpZiAodHlwZW9mIGVyci5jb2RlID09PSAnbnVtYmVyJykge1xuICAgICAgICAvLyBJZiBhbnkgZXJyb3IgY29kZSBleGlzdHMsIHdlIGlnbm9yZSB0aGUgZXJyb3IubWVzc2FnZVxuICAgICAgICByZXR1cm4gU0RBTV9OT1RfUFJJTUFSWV9DT0RFUy5oYXMoZXJyLmNvZGUpO1xuICAgIH1cbiAgICBpZiAoaXNSZWNvdmVyaW5nRXJyb3IoZXJyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBleHBvcnRzLkxFR0FDWV9OT1RfV1JJVEFCTEVfUFJJTUFSWV9FUlJPUl9NRVNTQUdFLnRlc3QoZXJyLm1lc3NhZ2UpO1xufVxuZnVuY3Rpb24gaXNOb2RlU2h1dHRpbmdEb3duRXJyb3IoZXJyKSB7XG4gICAgcmV0dXJuICEhKHR5cGVvZiBlcnIuY29kZSA9PT0gJ251bWJlcicgJiYgU0RBTV9OT0RFX1NIVVRUSU5HX0RPV05fRVJST1JfQ09ERVMuaGFzKGVyci5jb2RlKSk7XG59XG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBTREFNIGNhbiByZWNvdmVyIGZyb20gYSBnaXZlbiBlcnJvci4gSWYgaXQgY2Fubm90XG4gKiB0aGVuIHRoZSBwb29sIHdpbGwgYmUgY2xlYXJlZCwgYW5kIHNlcnZlciBzdGF0ZSB3aWxsIGNvbXBsZXRlbHkgcmVzZXRcbiAqIGxvY2FsbHkuXG4gKlxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2Uvc2VydmVyLWRpc2NvdmVyeS1hbmQtbW9uaXRvcmluZy9zZXJ2ZXItZGlzY292ZXJ5LWFuZC1tb25pdG9yaW5nLm1kI25vdC13cml0YWJsZS1wcmltYXJ5LWFuZC1ub2RlLWlzLXJlY292ZXJpbmdcbiAqL1xuZnVuY3Rpb24gaXNTREFNVW5yZWNvdmVyYWJsZUVycm9yKGVycm9yKSB7XG4gICAgLy8gTk9URTogbnVsbCBjaGVjayBpcyBoZXJlIGZvciBhIHN0cmljdGx5IHByZS1DTUFQIHdvcmxkLCBhIHRpbWVvdXQgb3JcbiAgICAvLyAgICAgICBjbG9zZSBldmVudCBhcmUgY29uc2lkZXJlZCB1bnJlY292ZXJhYmxlXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTW9uZ29QYXJzZUVycm9yIHx8IGVycm9yID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBpc1JlY292ZXJpbmdFcnJvcihlcnJvcikgfHwgaXNOb3RXcml0YWJsZVByaW1hcnlFcnJvcihlcnJvcik7XG59XG5mdW5jdGlvbiBpc05ldHdvcmtUaW1lb3V0RXJyb3IoZXJyKSB7XG4gICAgcmV0dXJuICEhKGVyciBpbnN0YW5jZW9mIE1vbmdvTmV0d29ya0Vycm9yICYmIGVyci5tZXNzYWdlLm1hdGNoKC90aW1lZCBvdXQvKSk7XG59XG5mdW5jdGlvbiBpc1Jlc3VtYWJsZUVycm9yKGVycm9yLCB3aXJlVmVyc2lvbikge1xuICAgIGlmIChlcnJvciA9PSBudWxsIHx8ICEoZXJyb3IgaW5zdGFuY2VvZiBNb25nb0Vycm9yKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE1vbmdvTmV0d29ya0Vycm9yKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAod2lyZVZlcnNpb24gIT0gbnVsbCAmJiB3aXJlVmVyc2lvbiA+PSA5KSB7XG4gICAgICAgIC8vIERSSVZFUlMtMTMwODogRm9yIDQuNCBkcml2ZXJzIHJ1bm5pbmcgYWdhaW5zdCA0LjQgc2VydmVycywgZHJpdmVycyB3aWxsIGFkZCBhIHNwZWNpYWwgY2FzZSB0byB0cmVhdCB0aGUgQ3Vyc29yTm90Rm91bmQgZXJyb3IgY29kZSBhcyByZXN1bWFibGVcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGV4cG9ydHMuTU9OR09EQl9FUlJPUl9DT0RFUy5DdXJzb3JOb3RGb3VuZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVycm9yLmhhc0Vycm9yTGFiZWwoZXhwb3J0cy5Nb25nb0Vycm9yTGFiZWwuUmVzdW1hYmxlQ2hhbmdlU3RyZWFtRXJyb3IpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGVycm9yLmNvZGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLkdFVF9NT1JFX1JFU1VNQUJMRV9DT0RFUy5oYXMoZXJyb3IuY29kZSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWVycm9yLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ExplainableCursor = exports.Explain = exports.ExplainVerbosity = void 0;\nexports.validateExplainTimeoutOptions = validateExplainTimeoutOptions;\nexports.decorateWithExplain = decorateWithExplain;\nconst abstract_cursor_1 = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/** @public */\nexports.ExplainVerbosity = Object.freeze({\n    queryPlanner: 'queryPlanner',\n    queryPlannerExtended: 'queryPlannerExtended',\n    executionStats: 'executionStats',\n    allPlansExecution: 'allPlansExecution'\n});\n/** @internal */\nclass Explain {\n    constructor(verbosity, maxTimeMS) {\n        if (typeof verbosity === 'boolean') {\n            this.verbosity = verbosity\n                ? exports.ExplainVerbosity.allPlansExecution\n                : exports.ExplainVerbosity.queryPlanner;\n        }\n        else {\n            this.verbosity = verbosity;\n        }\n        this.maxTimeMS = maxTimeMS;\n    }\n    static fromOptions({ explain } = {}) {\n        if (explain == null)\n            return;\n        if (typeof explain === 'boolean' || typeof explain === 'string') {\n            return new Explain(explain);\n        }\n        const { verbosity, maxTimeMS } = explain;\n        return new Explain(verbosity, maxTimeMS);\n    }\n}\nexports.Explain = Explain;\nfunction validateExplainTimeoutOptions(options, explain) {\n    const { maxTimeMS, timeoutMS } = options;\n    if (timeoutMS != null && (maxTimeMS != null || explain?.maxTimeMS != null)) {\n        throw new error_1.MongoAPIError('Cannot use maxTimeMS with timeoutMS for explain commands.');\n    }\n}\n/**\n * Applies an explain to a given command.\n * @internal\n *\n * @param command - the command on which to apply the explain\n * @param options - the options containing the explain verbosity\n */\nfunction decorateWithExplain(command, explain) {\n    const { verbosity, maxTimeMS } = explain;\n    const baseCommand = { explain: command, verbosity };\n    if (typeof maxTimeMS === 'number') {\n        baseCommand.maxTimeMS = maxTimeMS;\n    }\n    return baseCommand;\n}\n/**\n * @public\n *\n * A base class for any cursors that have `explain()` methods.\n */\nclass ExplainableCursor extends abstract_cursor_1.AbstractCursor {\n    resolveExplainTimeoutOptions(verbosity, options) {\n        let explain;\n        let timeout;\n        if (verbosity == null && options == null) {\n            explain = undefined;\n            timeout = undefined;\n        }\n        else if (verbosity != null && options == null) {\n            explain =\n                typeof verbosity !== 'object'\n                    ? verbosity\n                    : 'verbosity' in verbosity\n                        ? verbosity\n                        : undefined;\n            timeout = typeof verbosity === 'object' && 'timeoutMS' in verbosity ? verbosity : undefined;\n        }\n        else {\n            // @ts-expect-error TS isn't smart enough to determine that if both options are provided, the first is explain options\n            explain = verbosity;\n            timeout = options;\n        }\n        return { timeout, explain };\n    }\n}\nexports.ExplainableCursor = ExplainableCursor;\n//# sourceMappingURL=explain.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2V4cGxhaW4uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QseUJBQXlCLEdBQUcsZUFBZSxHQUFHLHdCQUF3QjtBQUN0RSxxQ0FBcUM7QUFDckMsMkJBQTJCO0FBQzNCLDBCQUEwQixtQkFBTyxDQUFDLDhIQUEwQjtBQUM1RCxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQztBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixVQUFVLElBQUk7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix1QkFBdUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0EsWUFBWSx1QkFBdUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1QkFBdUI7QUFDbkMsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2V4cGxhaW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkV4cGxhaW5hYmxlQ3Vyc29yID0gZXhwb3J0cy5FeHBsYWluID0gZXhwb3J0cy5FeHBsYWluVmVyYm9zaXR5ID0gdm9pZCAwO1xuZXhwb3J0cy52YWxpZGF0ZUV4cGxhaW5UaW1lb3V0T3B0aW9ucyA9IHZhbGlkYXRlRXhwbGFpblRpbWVvdXRPcHRpb25zO1xuZXhwb3J0cy5kZWNvcmF0ZVdpdGhFeHBsYWluID0gZGVjb3JhdGVXaXRoRXhwbGFpbjtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2Fic3RyYWN0X2N1cnNvclwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLkV4cGxhaW5WZXJib3NpdHkgPSBPYmplY3QuZnJlZXplKHtcbiAgICBxdWVyeVBsYW5uZXI6ICdxdWVyeVBsYW5uZXInLFxuICAgIHF1ZXJ5UGxhbm5lckV4dGVuZGVkOiAncXVlcnlQbGFubmVyRXh0ZW5kZWQnLFxuICAgIGV4ZWN1dGlvblN0YXRzOiAnZXhlY3V0aW9uU3RhdHMnLFxuICAgIGFsbFBsYW5zRXhlY3V0aW9uOiAnYWxsUGxhbnNFeGVjdXRpb24nXG59KTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEV4cGxhaW4ge1xuICAgIGNvbnN0cnVjdG9yKHZlcmJvc2l0eSwgbWF4VGltZU1TKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmVyYm9zaXR5ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHRoaXMudmVyYm9zaXR5ID0gdmVyYm9zaXR5XG4gICAgICAgICAgICAgICAgPyBleHBvcnRzLkV4cGxhaW5WZXJib3NpdHkuYWxsUGxhbnNFeGVjdXRpb25cbiAgICAgICAgICAgICAgICA6IGV4cG9ydHMuRXhwbGFpblZlcmJvc2l0eS5xdWVyeVBsYW5uZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnZlcmJvc2l0eSA9IHZlcmJvc2l0eTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1heFRpbWVNUyA9IG1heFRpbWVNUztcbiAgICB9XG4gICAgc3RhdGljIGZyb21PcHRpb25zKHsgZXhwbGFpbiB9ID0ge30pIHtcbiAgICAgICAgaWYgKGV4cGxhaW4gPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHR5cGVvZiBleHBsYWluID09PSAnYm9vbGVhbicgfHwgdHlwZW9mIGV4cGxhaW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEV4cGxhaW4oZXhwbGFpbik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyB2ZXJib3NpdHksIG1heFRpbWVNUyB9ID0gZXhwbGFpbjtcbiAgICAgICAgcmV0dXJuIG5ldyBFeHBsYWluKHZlcmJvc2l0eSwgbWF4VGltZU1TKTtcbiAgICB9XG59XG5leHBvcnRzLkV4cGxhaW4gPSBFeHBsYWluO1xuZnVuY3Rpb24gdmFsaWRhdGVFeHBsYWluVGltZW91dE9wdGlvbnMob3B0aW9ucywgZXhwbGFpbikge1xuICAgIGNvbnN0IHsgbWF4VGltZU1TLCB0aW1lb3V0TVMgfSA9IG9wdGlvbnM7XG4gICAgaWYgKHRpbWVvdXRNUyAhPSBudWxsICYmIChtYXhUaW1lTVMgIT0gbnVsbCB8fCBleHBsYWluPy5tYXhUaW1lTVMgIT0gbnVsbCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignQ2Fubm90IHVzZSBtYXhUaW1lTVMgd2l0aCB0aW1lb3V0TVMgZm9yIGV4cGxhaW4gY29tbWFuZHMuJyk7XG4gICAgfVxufVxuLyoqXG4gKiBBcHBsaWVzIGFuIGV4cGxhaW4gdG8gYSBnaXZlbiBjb21tYW5kLlxuICogQGludGVybmFsXG4gKlxuICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZCBvbiB3aGljaCB0byBhcHBseSB0aGUgZXhwbGFpblxuICogQHBhcmFtIG9wdGlvbnMgLSB0aGUgb3B0aW9ucyBjb250YWluaW5nIHRoZSBleHBsYWluIHZlcmJvc2l0eVxuICovXG5mdW5jdGlvbiBkZWNvcmF0ZVdpdGhFeHBsYWluKGNvbW1hbmQsIGV4cGxhaW4pIHtcbiAgICBjb25zdCB7IHZlcmJvc2l0eSwgbWF4VGltZU1TIH0gPSBleHBsYWluO1xuICAgIGNvbnN0IGJhc2VDb21tYW5kID0geyBleHBsYWluOiBjb21tYW5kLCB2ZXJib3NpdHkgfTtcbiAgICBpZiAodHlwZW9mIG1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgYmFzZUNvbW1hbmQubWF4VGltZU1TID0gbWF4VGltZU1TO1xuICAgIH1cbiAgICByZXR1cm4gYmFzZUNvbW1hbmQ7XG59XG4vKipcbiAqIEBwdWJsaWNcbiAqXG4gKiBBIGJhc2UgY2xhc3MgZm9yIGFueSBjdXJzb3JzIHRoYXQgaGF2ZSBgZXhwbGFpbigpYCBtZXRob2RzLlxuICovXG5jbGFzcyBFeHBsYWluYWJsZUN1cnNvciBleHRlbmRzIGFic3RyYWN0X2N1cnNvcl8xLkFic3RyYWN0Q3Vyc29yIHtcbiAgICByZXNvbHZlRXhwbGFpblRpbWVvdXRPcHRpb25zKHZlcmJvc2l0eSwgb3B0aW9ucykge1xuICAgICAgICBsZXQgZXhwbGFpbjtcbiAgICAgICAgbGV0IHRpbWVvdXQ7XG4gICAgICAgIGlmICh2ZXJib3NpdHkgPT0gbnVsbCAmJiBvcHRpb25zID09IG51bGwpIHtcbiAgICAgICAgICAgIGV4cGxhaW4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZlcmJvc2l0eSAhPSBudWxsICYmIG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgZXhwbGFpbiA9XG4gICAgICAgICAgICAgICAgdHlwZW9mIHZlcmJvc2l0eSAhPT0gJ29iamVjdCdcbiAgICAgICAgICAgICAgICAgICAgPyB2ZXJib3NpdHlcbiAgICAgICAgICAgICAgICAgICAgOiAndmVyYm9zaXR5JyBpbiB2ZXJib3NpdHlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdmVyYm9zaXR5XG4gICAgICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRpbWVvdXQgPSB0eXBlb2YgdmVyYm9zaXR5ID09PSAnb2JqZWN0JyAmJiAndGltZW91dE1TJyBpbiB2ZXJib3NpdHkgPyB2ZXJib3NpdHkgOiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRTIGlzbid0IHNtYXJ0IGVub3VnaCB0byBkZXRlcm1pbmUgdGhhdCBpZiBib3RoIG9wdGlvbnMgYXJlIHByb3ZpZGVkLCB0aGUgZmlyc3QgaXMgZXhwbGFpbiBvcHRpb25zXG4gICAgICAgICAgICBleHBsYWluID0gdmVyYm9zaXR5O1xuICAgICAgICAgICAgdGltZW91dCA9IG9wdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgdGltZW91dCwgZXhwbGFpbiB9O1xuICAgIH1cbn1cbmV4cG9ydHMuRXhwbGFpbmFibGVDdXJzb3IgPSBFeHBsYWluYWJsZUN1cnNvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV4cGxhaW4uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/download.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/download.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GridFSBucketReadStream = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst abstract_cursor_1 = __webpack_require__(/*! ../cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\n/**\n * A readable stream that enables you to read buffers from GridFS.\n *\n * Do not instantiate this class directly. Use `openDownloadStream()` instead.\n * @public\n */\nclass GridFSBucketReadStream extends stream_1.Readable {\n    /**\n     * @param chunks - Handle for chunks collection\n     * @param files - Handle for files collection\n     * @param readPreference - The read preference to use\n     * @param filter - The filter to use to find the file document\n     * @internal\n     */\n    constructor(chunks, files, readPreference, filter, options) {\n        super({ emitClose: true });\n        this.s = {\n            bytesToTrim: 0,\n            bytesToSkip: 0,\n            bytesRead: 0,\n            chunks,\n            expected: 0,\n            files,\n            filter,\n            init: false,\n            expectedEnd: 0,\n            options: {\n                start: 0,\n                end: 0,\n                ...options\n            },\n            readPreference,\n            timeoutContext: options?.timeoutMS != null\n                ? new timeout_1.CSOTTimeoutContext({ timeoutMS: options.timeoutMS, serverSelectionTimeoutMS: 0 })\n                : undefined\n        };\n    }\n    /**\n     * Reads from the cursor and pushes to the stream.\n     * Private Impl, do not call directly\n     * @internal\n     */\n    _read() {\n        if (this.destroyed)\n            return;\n        waitForFile(this, () => doRead(this));\n    }\n    /**\n     * Sets the 0-based offset in bytes to start streaming from. Throws\n     * an error if this stream has entered flowing mode\n     * (e.g. if you've already called `on('data')`)\n     *\n     * @param start - 0-based offset in bytes to start streaming from\n     */\n    start(start = 0) {\n        throwIfInitialized(this);\n        this.s.options.start = start;\n        return this;\n    }\n    /**\n     * Sets the 0-based offset in bytes to start streaming from. Throws\n     * an error if this stream has entered flowing mode\n     * (e.g. if you've already called `on('data')`)\n     *\n     * @param end - Offset in bytes to stop reading at\n     */\n    end(end = 0) {\n        throwIfInitialized(this);\n        this.s.options.end = end;\n        return this;\n    }\n    /**\n     * Marks this stream as aborted (will never push another `data` event)\n     * and kills the underlying cursor. Will emit the 'end' event, and then\n     * the 'close' event once the cursor is successfully killed.\n     */\n    async abort() {\n        this.push(null);\n        this.destroy();\n        const remainingTimeMS = this.s.timeoutContext?.getRemainingTimeMSOrThrow();\n        await this.s.cursor?.close({ timeoutMS: remainingTimeMS });\n    }\n}\nexports.GridFSBucketReadStream = GridFSBucketReadStream;\n/**\n * Fires when the stream loaded the file document corresponding to the provided id.\n * @event\n */\nGridFSBucketReadStream.FILE = 'file';\nfunction throwIfInitialized(stream) {\n    if (stream.s.init) {\n        throw new error_1.MongoGridFSStreamError('Options cannot be changed after the stream is initialized');\n    }\n}\nfunction doRead(stream) {\n    if (stream.destroyed)\n        return;\n    if (!stream.s.cursor)\n        return;\n    if (!stream.s.file)\n        return;\n    const handleReadResult = (doc) => {\n        if (stream.destroyed)\n            return;\n        if (!doc) {\n            stream.push(null);\n            stream.s.cursor?.close().then(undefined, error => stream.destroy(error));\n            return;\n        }\n        if (!stream.s.file)\n            return;\n        const bytesRemaining = stream.s.file.length - stream.s.bytesRead;\n        const expectedN = stream.s.expected++;\n        const expectedLength = Math.min(stream.s.file.chunkSize, bytesRemaining);\n        if (doc.n > expectedN) {\n            return stream.destroy(new error_1.MongoGridFSChunkError(`ChunkIsMissing: Got unexpected n: ${doc.n}, expected: ${expectedN}`));\n        }\n        if (doc.n < expectedN) {\n            return stream.destroy(new error_1.MongoGridFSChunkError(`ExtraChunk: Got unexpected n: ${doc.n}, expected: ${expectedN}`));\n        }\n        let buf = Buffer.isBuffer(doc.data) ? doc.data : doc.data.buffer;\n        if (buf.byteLength !== expectedLength) {\n            if (bytesRemaining <= 0) {\n                return stream.destroy(new error_1.MongoGridFSChunkError(`ExtraChunk: Got unexpected n: ${doc.n}, expected file length ${stream.s.file.length} bytes but already read ${stream.s.bytesRead} bytes`));\n            }\n            return stream.destroy(new error_1.MongoGridFSChunkError(`ChunkIsWrongSize: Got unexpected length: ${buf.byteLength}, expected: ${expectedLength}`));\n        }\n        stream.s.bytesRead += buf.byteLength;\n        if (buf.byteLength === 0) {\n            return stream.push(null);\n        }\n        let sliceStart = null;\n        let sliceEnd = null;\n        if (stream.s.bytesToSkip != null) {\n            sliceStart = stream.s.bytesToSkip;\n            stream.s.bytesToSkip = 0;\n        }\n        const atEndOfStream = expectedN === stream.s.expectedEnd - 1;\n        const bytesLeftToRead = stream.s.options.end - stream.s.bytesToSkip;\n        if (atEndOfStream && stream.s.bytesToTrim != null) {\n            sliceEnd = stream.s.file.chunkSize - stream.s.bytesToTrim;\n        }\n        else if (stream.s.options.end && bytesLeftToRead < doc.data.byteLength) {\n            sliceEnd = bytesLeftToRead;\n        }\n        if (sliceStart != null || sliceEnd != null) {\n            buf = buf.slice(sliceStart || 0, sliceEnd || buf.byteLength);\n        }\n        stream.push(buf);\n        return;\n    };\n    stream.s.cursor.next().then(handleReadResult, error => {\n        if (stream.destroyed)\n            return;\n        stream.destroy(error);\n    });\n}\nfunction init(stream) {\n    const findOneOptions = {};\n    if (stream.s.readPreference) {\n        findOneOptions.readPreference = stream.s.readPreference;\n    }\n    if (stream.s.options && stream.s.options.sort) {\n        findOneOptions.sort = stream.s.options.sort;\n    }\n    if (stream.s.options && stream.s.options.skip) {\n        findOneOptions.skip = stream.s.options.skip;\n    }\n    const handleReadResult = (doc) => {\n        if (stream.destroyed)\n            return;\n        if (!doc) {\n            const identifier = stream.s.filter._id\n                ? stream.s.filter._id.toString()\n                : stream.s.filter.filename;\n            const errmsg = `FileNotFound: file ${identifier} was not found`;\n            // TODO(NODE-3483)\n            const err = new error_1.MongoRuntimeError(errmsg);\n            err.code = 'ENOENT'; // TODO: NODE-3338 set property as part of constructor\n            return stream.destroy(err);\n        }\n        // If document is empty, kill the stream immediately and don't\n        // execute any reads\n        if (doc.length <= 0) {\n            stream.push(null);\n            return;\n        }\n        if (stream.destroyed) {\n            // If user destroys the stream before we have a cursor, wait\n            // until the query is done to say we're 'closed' because we can't\n            // cancel a query.\n            stream.destroy();\n            return;\n        }\n        try {\n            stream.s.bytesToSkip = handleStartOption(stream, doc, stream.s.options);\n        }\n        catch (error) {\n            return stream.destroy(error);\n        }\n        const filter = { files_id: doc._id };\n        // Currently (MongoDB 3.4.4) skip function does not support the index,\n        // it needs to retrieve all the documents first and then skip them. (CS-25811)\n        // As work around we use $gte on the \"n\" field.\n        if (stream.s.options && stream.s.options.start != null) {\n            const skip = Math.floor(stream.s.options.start / doc.chunkSize);\n            if (skip > 0) {\n                filter['n'] = { $gte: skip };\n            }\n        }\n        let remainingTimeMS;\n        try {\n            remainingTimeMS = stream.s.timeoutContext?.getRemainingTimeMSOrThrow(`Download timed out after ${stream.s.timeoutContext?.timeoutMS}ms`);\n        }\n        catch (error) {\n            return stream.destroy(error);\n        }\n        stream.s.cursor = stream.s.chunks\n            .find(filter, {\n            timeoutMode: stream.s.options.timeoutMS != null ? abstract_cursor_1.CursorTimeoutMode.LIFETIME : undefined,\n            timeoutMS: remainingTimeMS\n        })\n            .sort({ n: 1 });\n        if (stream.s.readPreference) {\n            stream.s.cursor.withReadPreference(stream.s.readPreference);\n        }\n        stream.s.expectedEnd = Math.ceil(doc.length / doc.chunkSize);\n        stream.s.file = doc;\n        try {\n            stream.s.bytesToTrim = handleEndOption(stream, doc, stream.s.cursor, stream.s.options);\n        }\n        catch (error) {\n            return stream.destroy(error);\n        }\n        stream.emit(GridFSBucketReadStream.FILE, doc);\n        return;\n    };\n    let remainingTimeMS;\n    try {\n        remainingTimeMS = stream.s.timeoutContext?.getRemainingTimeMSOrThrow(`Download timed out after ${stream.s.timeoutContext?.timeoutMS}ms`);\n    }\n    catch (error) {\n        if (!stream.destroyed)\n            stream.destroy(error);\n        return;\n    }\n    findOneOptions.timeoutMS = remainingTimeMS;\n    stream.s.files.findOne(stream.s.filter, findOneOptions).then(handleReadResult, error => {\n        if (stream.destroyed)\n            return;\n        stream.destroy(error);\n    });\n}\nfunction waitForFile(stream, callback) {\n    if (stream.s.file) {\n        return callback();\n    }\n    if (!stream.s.init) {\n        init(stream);\n        stream.s.init = true;\n    }\n    stream.once('file', () => {\n        callback();\n    });\n}\nfunction handleStartOption(stream, doc, options) {\n    if (options && options.start != null) {\n        if (options.start > doc.length) {\n            throw new error_1.MongoInvalidArgumentError(`Stream start (${options.start}) must not be more than the length of the file (${doc.length})`);\n        }\n        if (options.start < 0) {\n            throw new error_1.MongoInvalidArgumentError(`Stream start (${options.start}) must not be negative`);\n        }\n        if (options.end != null && options.end < options.start) {\n            throw new error_1.MongoInvalidArgumentError(`Stream start (${options.start}) must not be greater than stream end (${options.end})`);\n        }\n        stream.s.bytesRead = Math.floor(options.start / doc.chunkSize) * doc.chunkSize;\n        stream.s.expected = Math.floor(options.start / doc.chunkSize);\n        return options.start - stream.s.bytesRead;\n    }\n    throw new error_1.MongoInvalidArgumentError('Start option must be defined');\n}\nfunction handleEndOption(stream, doc, cursor, options) {\n    if (options && options.end != null) {\n        if (options.end > doc.length) {\n            throw new error_1.MongoInvalidArgumentError(`Stream end (${options.end}) must not be more than the length of the file (${doc.length})`);\n        }\n        if (options.start == null || options.start < 0) {\n            throw new error_1.MongoInvalidArgumentError(`Stream end (${options.end}) must not be negative`);\n        }\n        const start = options.start != null ? Math.floor(options.start / doc.chunkSize) : 0;\n        cursor.limit(Math.ceil(options.end / doc.chunkSize) - start);\n        stream.s.expectedEnd = Math.ceil(options.end / doc.chunkSize);\n        return Math.ceil(options.end / doc.chunkSize) * doc.chunkSize - options.end;\n    }\n    throw new error_1.MongoInvalidArgumentError('End option must be defined');\n}\n//# sourceMappingURL=download.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2dyaWRmcy9kb3dubG9hZC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw4QkFBOEI7QUFDOUIsaUJBQWlCLG1CQUFPLENBQUMsc0JBQVE7QUFDakMsMEJBQTBCLG1CQUFPLENBQUMsK0hBQTJCO0FBQzdELGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlHQUFZO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpQkFBaUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EscURBQXFELDJEQUEyRDtBQUNoSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyw0QkFBNEI7QUFDakU7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlHQUF5RyxNQUFNLGNBQWMsVUFBVTtBQUN2STtBQUNBO0FBQ0EscUdBQXFHLE1BQU0sY0FBYyxVQUFVO0FBQ25JO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUdBQXlHLE1BQU0seUJBQXlCLHNCQUFzQix5QkFBeUIsb0JBQW9CO0FBQzNNO0FBQ0EsZ0hBQWdILGVBQWUsY0FBYyxlQUFlO0FBQzVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsWUFBWTtBQUM3RDtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2R0FBNkcsbUNBQW1DO0FBQ2hKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Qsb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5R0FBeUcsbUNBQW1DO0FBQzVJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RSxjQUFjLGtEQUFrRCxXQUFXO0FBQ3BKO0FBQ0E7QUFDQSx5RUFBeUUsY0FBYztBQUN2RjtBQUNBO0FBQ0EseUVBQXlFLGNBQWMseUNBQXlDLFlBQVk7QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsWUFBWSxrREFBa0QsV0FBVztBQUNoSjtBQUNBO0FBQ0EsdUVBQXVFLFlBQVk7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvZ3JpZGZzL2Rvd25sb2FkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5HcmlkRlNCdWNrZXRSZWFkU3RyZWFtID0gdm9pZCAwO1xuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwic3RyZWFtXCIpO1xuY29uc3QgYWJzdHJhY3RfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi4vY3Vyc29yL2Fic3RyYWN0X2N1cnNvclwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB0aW1lb3V0XzEgPSByZXF1aXJlKFwiLi4vdGltZW91dFwiKTtcbi8qKlxuICogQSByZWFkYWJsZSBzdHJlYW0gdGhhdCBlbmFibGVzIHlvdSB0byByZWFkIGJ1ZmZlcnMgZnJvbSBHcmlkRlMuXG4gKlxuICogRG8gbm90IGluc3RhbnRpYXRlIHRoaXMgY2xhc3MgZGlyZWN0bHkuIFVzZSBgb3BlbkRvd25sb2FkU3RyZWFtKClgIGluc3RlYWQuXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0gZXh0ZW5kcyBzdHJlYW1fMS5SZWFkYWJsZSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNodW5rcyAtIEhhbmRsZSBmb3IgY2h1bmtzIGNvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0gZmlsZXMgLSBIYW5kbGUgZm9yIGZpbGVzIGNvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgcmVhZCBwcmVmZXJlbmNlIHRvIHVzZVxuICAgICAqIEBwYXJhbSBmaWx0ZXIgLSBUaGUgZmlsdGVyIHRvIHVzZSB0byBmaW5kIHRoZSBmaWxlIGRvY3VtZW50XG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2h1bmtzLCBmaWxlcywgcmVhZFByZWZlcmVuY2UsIGZpbHRlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcih7IGVtaXRDbG9zZTogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5zID0ge1xuICAgICAgICAgICAgYnl0ZXNUb1RyaW06IDAsXG4gICAgICAgICAgICBieXRlc1RvU2tpcDogMCxcbiAgICAgICAgICAgIGJ5dGVzUmVhZDogMCxcbiAgICAgICAgICAgIGNodW5rcyxcbiAgICAgICAgICAgIGV4cGVjdGVkOiAwLFxuICAgICAgICAgICAgZmlsZXMsXG4gICAgICAgICAgICBmaWx0ZXIsXG4gICAgICAgICAgICBpbml0OiBmYWxzZSxcbiAgICAgICAgICAgIGV4cGVjdGVkRW5kOiAwLFxuICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiAwLFxuICAgICAgICAgICAgICAgIGVuZDogMCxcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UsXG4gICAgICAgICAgICB0aW1lb3V0Q29udGV4dDogb3B0aW9ucz8udGltZW91dE1TICE9IG51bGxcbiAgICAgICAgICAgICAgICA/IG5ldyB0aW1lb3V0XzEuQ1NPVFRpbWVvdXRDb250ZXh0KHsgdGltZW91dE1TOiBvcHRpb25zLnRpbWVvdXRNUywgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiAwIH0pXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSB0aGUgY3Vyc29yIGFuZCBwdXNoZXMgdG8gdGhlIHN0cmVhbS5cbiAgICAgKiBQcml2YXRlIEltcGwsIGRvIG5vdCBjYWxsIGRpcmVjdGx5XG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgX3JlYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmRlc3Ryb3llZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgd2FpdEZvckZpbGUodGhpcywgKCkgPT4gZG9SZWFkKHRoaXMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgMC1iYXNlZCBvZmZzZXQgaW4gYnl0ZXMgdG8gc3RhcnQgc3RyZWFtaW5nIGZyb20uIFRocm93c1xuICAgICAqIGFuIGVycm9yIGlmIHRoaXMgc3RyZWFtIGhhcyBlbnRlcmVkIGZsb3dpbmcgbW9kZVxuICAgICAqIChlLmcuIGlmIHlvdSd2ZSBhbHJlYWR5IGNhbGxlZCBgb24oJ2RhdGEnKWApXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc3RhcnQgLSAwLWJhc2VkIG9mZnNldCBpbiBieXRlcyB0byBzdGFydCBzdHJlYW1pbmcgZnJvbVxuICAgICAqL1xuICAgIHN0YXJ0KHN0YXJ0ID0gMCkge1xuICAgICAgICB0aHJvd0lmSW5pdGlhbGl6ZWQodGhpcyk7XG4gICAgICAgIHRoaXMucy5vcHRpb25zLnN0YXJ0ID0gc3RhcnQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSAwLWJhc2VkIG9mZnNldCBpbiBieXRlcyB0byBzdGFydCBzdHJlYW1pbmcgZnJvbS4gVGhyb3dzXG4gICAgICogYW4gZXJyb3IgaWYgdGhpcyBzdHJlYW0gaGFzIGVudGVyZWQgZmxvd2luZyBtb2RlXG4gICAgICogKGUuZy4gaWYgeW91J3ZlIGFscmVhZHkgY2FsbGVkIGBvbignZGF0YScpYClcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlbmQgLSBPZmZzZXQgaW4gYnl0ZXMgdG8gc3RvcCByZWFkaW5nIGF0XG4gICAgICovXG4gICAgZW5kKGVuZCA9IDApIHtcbiAgICAgICAgdGhyb3dJZkluaXRpYWxpemVkKHRoaXMpO1xuICAgICAgICB0aGlzLnMub3B0aW9ucy5lbmQgPSBlbmQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYXJrcyB0aGlzIHN0cmVhbSBhcyBhYm9ydGVkICh3aWxsIG5ldmVyIHB1c2ggYW5vdGhlciBgZGF0YWAgZXZlbnQpXG4gICAgICogYW5kIGtpbGxzIHRoZSB1bmRlcmx5aW5nIGN1cnNvci4gV2lsbCBlbWl0IHRoZSAnZW5kJyBldmVudCwgYW5kIHRoZW5cbiAgICAgKiB0aGUgJ2Nsb3NlJyBldmVudCBvbmNlIHRoZSBjdXJzb3IgaXMgc3VjY2Vzc2Z1bGx5IGtpbGxlZC5cbiAgICAgKi9cbiAgICBhc3luYyBhYm9ydCgpIHtcbiAgICAgICAgdGhpcy5wdXNoKG51bGwpO1xuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nVGltZU1TID0gdGhpcy5zLnRpbWVvdXRDb250ZXh0Py5nZXRSZW1haW5pbmdUaW1lTVNPclRocm93KCk7XG4gICAgICAgIGF3YWl0IHRoaXMucy5jdXJzb3I/LmNsb3NlKHsgdGltZW91dE1TOiByZW1haW5pbmdUaW1lTVMgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5HcmlkRlNCdWNrZXRSZWFkU3RyZWFtID0gR3JpZEZTQnVja2V0UmVhZFN0cmVhbTtcbi8qKlxuICogRmlyZXMgd2hlbiB0aGUgc3RyZWFtIGxvYWRlZCB0aGUgZmlsZSBkb2N1bWVudCBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm92aWRlZCBpZC5cbiAqIEBldmVudFxuICovXG5HcmlkRlNCdWNrZXRSZWFkU3RyZWFtLkZJTEUgPSAnZmlsZSc7XG5mdW5jdGlvbiB0aHJvd0lmSW5pdGlhbGl6ZWQoc3RyZWFtKSB7XG4gICAgaWYgKHN0cmVhbS5zLmluaXQpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29HcmlkRlNTdHJlYW1FcnJvcignT3B0aW9ucyBjYW5ub3QgYmUgY2hhbmdlZCBhZnRlciB0aGUgc3RyZWFtIGlzIGluaXRpYWxpemVkJyk7XG4gICAgfVxufVxuZnVuY3Rpb24gZG9SZWFkKHN0cmVhbSkge1xuICAgIGlmIChzdHJlYW0uZGVzdHJveWVkKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFzdHJlYW0ucy5jdXJzb3IpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIXN0cmVhbS5zLmZpbGUpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBoYW5kbGVSZWFkUmVzdWx0ID0gKGRvYykgPT4ge1xuICAgICAgICBpZiAoc3RyZWFtLmRlc3Ryb3llZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKCFkb2MpIHtcbiAgICAgICAgICAgIHN0cmVhbS5wdXNoKG51bGwpO1xuICAgICAgICAgICAgc3RyZWFtLnMuY3Vyc29yPy5jbG9zZSgpLnRoZW4odW5kZWZpbmVkLCBlcnJvciA9PiBzdHJlYW0uZGVzdHJveShlcnJvcikpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc3RyZWFtLnMuZmlsZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgYnl0ZXNSZW1haW5pbmcgPSBzdHJlYW0ucy5maWxlLmxlbmd0aCAtIHN0cmVhbS5zLmJ5dGVzUmVhZDtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWROID0gc3RyZWFtLnMuZXhwZWN0ZWQrKztcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRMZW5ndGggPSBNYXRoLm1pbihzdHJlYW0ucy5maWxlLmNodW5rU2l6ZSwgYnl0ZXNSZW1haW5pbmcpO1xuICAgICAgICBpZiAoZG9jLm4gPiBleHBlY3RlZE4pIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZGVzdHJveShuZXcgZXJyb3JfMS5Nb25nb0dyaWRGU0NodW5rRXJyb3IoYENodW5rSXNNaXNzaW5nOiBHb3QgdW5leHBlY3RlZCBuOiAke2RvYy5ufSwgZXhwZWN0ZWQ6ICR7ZXhwZWN0ZWROfWApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9jLm4gPCBleHBlY3RlZE4pIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZGVzdHJveShuZXcgZXJyb3JfMS5Nb25nb0dyaWRGU0NodW5rRXJyb3IoYEV4dHJhQ2h1bms6IEdvdCB1bmV4cGVjdGVkIG46ICR7ZG9jLm59LCBleHBlY3RlZDogJHtleHBlY3RlZE59YCkpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBidWYgPSBCdWZmZXIuaXNCdWZmZXIoZG9jLmRhdGEpID8gZG9jLmRhdGEgOiBkb2MuZGF0YS5idWZmZXI7XG4gICAgICAgIGlmIChidWYuYnl0ZUxlbmd0aCAhPT0gZXhwZWN0ZWRMZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChieXRlc1JlbWFpbmluZyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5kZXN0cm95KG5ldyBlcnJvcl8xLk1vbmdvR3JpZEZTQ2h1bmtFcnJvcihgRXh0cmFDaHVuazogR290IHVuZXhwZWN0ZWQgbjogJHtkb2Mubn0sIGV4cGVjdGVkIGZpbGUgbGVuZ3RoICR7c3RyZWFtLnMuZmlsZS5sZW5ndGh9IGJ5dGVzIGJ1dCBhbHJlYWR5IHJlYWQgJHtzdHJlYW0ucy5ieXRlc1JlYWR9IGJ5dGVzYCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5kZXN0cm95KG5ldyBlcnJvcl8xLk1vbmdvR3JpZEZTQ2h1bmtFcnJvcihgQ2h1bmtJc1dyb25nU2l6ZTogR290IHVuZXhwZWN0ZWQgbGVuZ3RoOiAke2J1Zi5ieXRlTGVuZ3RofSwgZXhwZWN0ZWQ6ICR7ZXhwZWN0ZWRMZW5ndGh9YCkpO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5zLmJ5dGVzUmVhZCArPSBidWYuYnl0ZUxlbmd0aDtcbiAgICAgICAgaWYgKGJ1Zi5ieXRlTGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyZWFtLnB1c2gobnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNsaWNlU3RhcnQgPSBudWxsO1xuICAgICAgICBsZXQgc2xpY2VFbmQgPSBudWxsO1xuICAgICAgICBpZiAoc3RyZWFtLnMuYnl0ZXNUb1NraXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgc2xpY2VTdGFydCA9IHN0cmVhbS5zLmJ5dGVzVG9Ta2lwO1xuICAgICAgICAgICAgc3RyZWFtLnMuYnl0ZXNUb1NraXAgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGF0RW5kT2ZTdHJlYW0gPSBleHBlY3RlZE4gPT09IHN0cmVhbS5zLmV4cGVjdGVkRW5kIC0gMTtcbiAgICAgICAgY29uc3QgYnl0ZXNMZWZ0VG9SZWFkID0gc3RyZWFtLnMub3B0aW9ucy5lbmQgLSBzdHJlYW0ucy5ieXRlc1RvU2tpcDtcbiAgICAgICAgaWYgKGF0RW5kT2ZTdHJlYW0gJiYgc3RyZWFtLnMuYnl0ZXNUb1RyaW0gIT0gbnVsbCkge1xuICAgICAgICAgICAgc2xpY2VFbmQgPSBzdHJlYW0ucy5maWxlLmNodW5rU2l6ZSAtIHN0cmVhbS5zLmJ5dGVzVG9UcmltO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHN0cmVhbS5zLm9wdGlvbnMuZW5kICYmIGJ5dGVzTGVmdFRvUmVhZCA8IGRvYy5kYXRhLmJ5dGVMZW5ndGgpIHtcbiAgICAgICAgICAgIHNsaWNlRW5kID0gYnl0ZXNMZWZ0VG9SZWFkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzbGljZVN0YXJ0ICE9IG51bGwgfHwgc2xpY2VFbmQgIT0gbnVsbCkge1xuICAgICAgICAgICAgYnVmID0gYnVmLnNsaWNlKHNsaWNlU3RhcnQgfHwgMCwgc2xpY2VFbmQgfHwgYnVmLmJ5dGVMZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5wdXNoKGJ1Zik7XG4gICAgICAgIHJldHVybjtcbiAgICB9O1xuICAgIHN0cmVhbS5zLmN1cnNvci5uZXh0KCkudGhlbihoYW5kbGVSZWFkUmVzdWx0LCBlcnJvciA9PiB7XG4gICAgICAgIGlmIChzdHJlYW0uZGVzdHJveWVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBzdHJlYW0uZGVzdHJveShlcnJvcik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBpbml0KHN0cmVhbSkge1xuICAgIGNvbnN0IGZpbmRPbmVPcHRpb25zID0ge307XG4gICAgaWYgKHN0cmVhbS5zLnJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgIGZpbmRPbmVPcHRpb25zLnJlYWRQcmVmZXJlbmNlID0gc3RyZWFtLnMucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGlmIChzdHJlYW0ucy5vcHRpb25zICYmIHN0cmVhbS5zLm9wdGlvbnMuc29ydCkge1xuICAgICAgICBmaW5kT25lT3B0aW9ucy5zb3J0ID0gc3RyZWFtLnMub3B0aW9ucy5zb3J0O1xuICAgIH1cbiAgICBpZiAoc3RyZWFtLnMub3B0aW9ucyAmJiBzdHJlYW0ucy5vcHRpb25zLnNraXApIHtcbiAgICAgICAgZmluZE9uZU9wdGlvbnMuc2tpcCA9IHN0cmVhbS5zLm9wdGlvbnMuc2tpcDtcbiAgICB9XG4gICAgY29uc3QgaGFuZGxlUmVhZFJlc3VsdCA9IChkb2MpID0+IHtcbiAgICAgICAgaWYgKHN0cmVhbS5kZXN0cm95ZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICghZG9jKSB7XG4gICAgICAgICAgICBjb25zdCBpZGVudGlmaWVyID0gc3RyZWFtLnMuZmlsdGVyLl9pZFxuICAgICAgICAgICAgICAgID8gc3RyZWFtLnMuZmlsdGVyLl9pZC50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgOiBzdHJlYW0ucy5maWx0ZXIuZmlsZW5hbWU7XG4gICAgICAgICAgICBjb25zdCBlcnJtc2cgPSBgRmlsZU5vdEZvdW5kOiBmaWxlICR7aWRlbnRpZmllcn0gd2FzIG5vdCBmb3VuZGA7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgIGNvbnN0IGVyciA9IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGVycm1zZyk7XG4gICAgICAgICAgICBlcnIuY29kZSA9ICdFTk9FTlQnOyAvLyBUT0RPOiBOT0RFLTMzMzggc2V0IHByb3BlcnR5IGFzIHBhcnQgb2YgY29uc3RydWN0b3JcbiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uZGVzdHJveShlcnIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIGRvY3VtZW50IGlzIGVtcHR5LCBraWxsIHRoZSBzdHJlYW0gaW1tZWRpYXRlbHkgYW5kIGRvbid0XG4gICAgICAgIC8vIGV4ZWN1dGUgYW55IHJlYWRzXG4gICAgICAgIGlmIChkb2MubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHN0cmVhbS5wdXNoKG51bGwpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJlYW0uZGVzdHJveWVkKSB7XG4gICAgICAgICAgICAvLyBJZiB1c2VyIGRlc3Ryb3lzIHRoZSBzdHJlYW0gYmVmb3JlIHdlIGhhdmUgYSBjdXJzb3IsIHdhaXRcbiAgICAgICAgICAgIC8vIHVudGlsIHRoZSBxdWVyeSBpcyBkb25lIHRvIHNheSB3ZSdyZSAnY2xvc2VkJyBiZWNhdXNlIHdlIGNhbid0XG4gICAgICAgICAgICAvLyBjYW5jZWwgYSBxdWVyeS5cbiAgICAgICAgICAgIHN0cmVhbS5kZXN0cm95KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHN0cmVhbS5zLmJ5dGVzVG9Ta2lwID0gaGFuZGxlU3RhcnRPcHRpb24oc3RyZWFtLCBkb2MsIHN0cmVhbS5zLm9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5kZXN0cm95KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWx0ZXIgPSB7IGZpbGVzX2lkOiBkb2MuX2lkIH07XG4gICAgICAgIC8vIEN1cnJlbnRseSAoTW9uZ29EQiAzLjQuNCkgc2tpcCBmdW5jdGlvbiBkb2VzIG5vdCBzdXBwb3J0IHRoZSBpbmRleCxcbiAgICAgICAgLy8gaXQgbmVlZHMgdG8gcmV0cmlldmUgYWxsIHRoZSBkb2N1bWVudHMgZmlyc3QgYW5kIHRoZW4gc2tpcCB0aGVtLiAoQ1MtMjU4MTEpXG4gICAgICAgIC8vIEFzIHdvcmsgYXJvdW5kIHdlIHVzZSAkZ3RlIG9uIHRoZSBcIm5cIiBmaWVsZC5cbiAgICAgICAgaWYgKHN0cmVhbS5zLm9wdGlvbnMgJiYgc3RyZWFtLnMub3B0aW9ucy5zdGFydCAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCBza2lwID0gTWF0aC5mbG9vcihzdHJlYW0ucy5vcHRpb25zLnN0YXJ0IC8gZG9jLmNodW5rU2l6ZSk7XG4gICAgICAgICAgICBpZiAoc2tpcCA+IDApIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJbJ24nXSA9IHsgJGd0ZTogc2tpcCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCByZW1haW5pbmdUaW1lTVM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZW1haW5pbmdUaW1lTVMgPSBzdHJlYW0ucy50aW1lb3V0Q29udGV4dD8uZ2V0UmVtYWluaW5nVGltZU1TT3JUaHJvdyhgRG93bmxvYWQgdGltZWQgb3V0IGFmdGVyICR7c3RyZWFtLnMudGltZW91dENvbnRleHQ/LnRpbWVvdXRNU31tc2ApO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5kZXN0cm95KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0ucy5jdXJzb3IgPSBzdHJlYW0ucy5jaHVua3NcbiAgICAgICAgICAgIC5maW5kKGZpbHRlciwge1xuICAgICAgICAgICAgdGltZW91dE1vZGU6IHN0cmVhbS5zLm9wdGlvbnMudGltZW91dE1TICE9IG51bGwgPyBhYnN0cmFjdF9jdXJzb3JfMS5DdXJzb3JUaW1lb3V0TW9kZS5MSUZFVElNRSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHRpbWVvdXRNUzogcmVtYWluaW5nVGltZU1TXG4gICAgICAgIH0pXG4gICAgICAgICAgICAuc29ydCh7IG46IDEgfSk7XG4gICAgICAgIGlmIChzdHJlYW0ucy5yZWFkUHJlZmVyZW5jZSkge1xuICAgICAgICAgICAgc3RyZWFtLnMuY3Vyc29yLndpdGhSZWFkUHJlZmVyZW5jZShzdHJlYW0ucy5yZWFkUHJlZmVyZW5jZSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLnMuZXhwZWN0ZWRFbmQgPSBNYXRoLmNlaWwoZG9jLmxlbmd0aCAvIGRvYy5jaHVua1NpemUpO1xuICAgICAgICBzdHJlYW0ucy5maWxlID0gZG9jO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc3RyZWFtLnMuYnl0ZXNUb1RyaW0gPSBoYW5kbGVFbmRPcHRpb24oc3RyZWFtLCBkb2MsIHN0cmVhbS5zLmN1cnNvciwgc3RyZWFtLnMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyZWFtLmRlc3Ryb3koZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5lbWl0KEdyaWRGU0J1Y2tldFJlYWRTdHJlYW0uRklMRSwgZG9jKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH07XG4gICAgbGV0IHJlbWFpbmluZ1RpbWVNUztcbiAgICB0cnkge1xuICAgICAgICByZW1haW5pbmdUaW1lTVMgPSBzdHJlYW0ucy50aW1lb3V0Q29udGV4dD8uZ2V0UmVtYWluaW5nVGltZU1TT3JUaHJvdyhgRG93bmxvYWQgdGltZWQgb3V0IGFmdGVyICR7c3RyZWFtLnMudGltZW91dENvbnRleHQ/LnRpbWVvdXRNU31tc2ApO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKCFzdHJlYW0uZGVzdHJveWVkKVxuICAgICAgICAgICAgc3RyZWFtLmRlc3Ryb3koZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGZpbmRPbmVPcHRpb25zLnRpbWVvdXRNUyA9IHJlbWFpbmluZ1RpbWVNUztcbiAgICBzdHJlYW0ucy5maWxlcy5maW5kT25lKHN0cmVhbS5zLmZpbHRlciwgZmluZE9uZU9wdGlvbnMpLnRoZW4oaGFuZGxlUmVhZFJlc3VsdCwgZXJyb3IgPT4ge1xuICAgICAgICBpZiAoc3RyZWFtLmRlc3Ryb3llZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgc3RyZWFtLmRlc3Ryb3koZXJyb3IpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gd2FpdEZvckZpbGUoc3RyZWFtLCBjYWxsYmFjaykge1xuICAgIGlmIChzdHJlYW0ucy5maWxlKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cbiAgICBpZiAoIXN0cmVhbS5zLmluaXQpIHtcbiAgICAgICAgaW5pdChzdHJlYW0pO1xuICAgICAgICBzdHJlYW0ucy5pbml0ID0gdHJ1ZTtcbiAgICB9XG4gICAgc3RyZWFtLm9uY2UoJ2ZpbGUnLCAoKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBoYW5kbGVTdGFydE9wdGlvbihzdHJlYW0sIGRvYywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc3RhcnQgIT0gbnVsbCkge1xuICAgICAgICBpZiAob3B0aW9ucy5zdGFydCA+IGRvYy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYFN0cmVhbSBzdGFydCAoJHtvcHRpb25zLnN0YXJ0fSkgbXVzdCBub3QgYmUgbW9yZSB0aGFuIHRoZSBsZW5ndGggb2YgdGhlIGZpbGUgKCR7ZG9jLmxlbmd0aH0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBTdHJlYW0gc3RhcnQgKCR7b3B0aW9ucy5zdGFydH0pIG11c3Qgbm90IGJlIG5lZ2F0aXZlYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuZW5kICE9IG51bGwgJiYgb3B0aW9ucy5lbmQgPCBvcHRpb25zLnN0YXJ0KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBTdHJlYW0gc3RhcnQgKCR7b3B0aW9ucy5zdGFydH0pIG11c3Qgbm90IGJlIGdyZWF0ZXIgdGhhbiBzdHJlYW0gZW5kICgke29wdGlvbnMuZW5kfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0ucy5ieXRlc1JlYWQgPSBNYXRoLmZsb29yKG9wdGlvbnMuc3RhcnQgLyBkb2MuY2h1bmtTaXplKSAqIGRvYy5jaHVua1NpemU7XG4gICAgICAgIHN0cmVhbS5zLmV4cGVjdGVkID0gTWF0aC5mbG9vcihvcHRpb25zLnN0YXJ0IC8gZG9jLmNodW5rU2l6ZSk7XG4gICAgICAgIHJldHVybiBvcHRpb25zLnN0YXJ0IC0gc3RyZWFtLnMuYnl0ZXNSZWFkO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdTdGFydCBvcHRpb24gbXVzdCBiZSBkZWZpbmVkJyk7XG59XG5mdW5jdGlvbiBoYW5kbGVFbmRPcHRpb24oc3RyZWFtLCBkb2MsIGN1cnNvciwgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZW5kICE9IG51bGwpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuZW5kID4gZG9jLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgU3RyZWFtIGVuZCAoJHtvcHRpb25zLmVuZH0pIG11c3Qgbm90IGJlIG1vcmUgdGhhbiB0aGUgbGVuZ3RoIG9mIHRoZSBmaWxlICgke2RvYy5sZW5ndGh9KWApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnN0YXJ0ID09IG51bGwgfHwgb3B0aW9ucy5zdGFydCA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYFN0cmVhbSBlbmQgKCR7b3B0aW9ucy5lbmR9KSBtdXN0IG5vdCBiZSBuZWdhdGl2ZWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gb3B0aW9ucy5zdGFydCAhPSBudWxsID8gTWF0aC5mbG9vcihvcHRpb25zLnN0YXJ0IC8gZG9jLmNodW5rU2l6ZSkgOiAwO1xuICAgICAgICBjdXJzb3IubGltaXQoTWF0aC5jZWlsKG9wdGlvbnMuZW5kIC8gZG9jLmNodW5rU2l6ZSkgLSBzdGFydCk7XG4gICAgICAgIHN0cmVhbS5zLmV4cGVjdGVkRW5kID0gTWF0aC5jZWlsKG9wdGlvbnMuZW5kIC8gZG9jLmNodW5rU2l6ZSk7XG4gICAgICAgIHJldHVybiBNYXRoLmNlaWwob3B0aW9ucy5lbmQgLyBkb2MuY2h1bmtTaXplKSAqIGRvYy5jaHVua1NpemUgLSBvcHRpb25zLmVuZDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignRW5kIG9wdGlvbiBtdXN0IGJlIGRlZmluZWQnKTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRvd25sb2FkLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/download.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/index.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/index.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GridFSBucket = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst download_1 = __webpack_require__(/*! ./download */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/download.js\");\nconst upload_1 = __webpack_require__(/*! ./upload */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/upload.js\");\nconst DEFAULT_GRIDFS_BUCKET_OPTIONS = {\n    bucketName: 'fs',\n    chunkSizeBytes: 255 * 1024\n};\n/**\n * Constructor for a streaming GridFS interface\n * @public\n */\nclass GridFSBucket extends mongo_types_1.TypedEventEmitter {\n    constructor(db, options) {\n        super();\n        this.on('error', utils_1.noop);\n        this.setMaxListeners(0);\n        const privateOptions = (0, utils_1.resolveOptions)(db, {\n            ...DEFAULT_GRIDFS_BUCKET_OPTIONS,\n            ...options,\n            writeConcern: write_concern_1.WriteConcern.fromOptions(options)\n        });\n        this.s = {\n            db,\n            options: privateOptions,\n            _chunksCollection: db.collection(privateOptions.bucketName + '.chunks'),\n            _filesCollection: db.collection(privateOptions.bucketName + '.files'),\n            checkedIndexes: false,\n            calledOpenUploadStream: false\n        };\n    }\n    /**\n     * Returns a writable stream (GridFSBucketWriteStream) for writing\n     * buffers to GridFS. The stream's 'id' property contains the resulting\n     * file's id.\n     *\n     * @param filename - The value of the 'filename' key in the files doc\n     * @param options - Optional settings.\n     */\n    openUploadStream(filename, options) {\n        return new upload_1.GridFSBucketWriteStream(this, filename, {\n            timeoutMS: this.s.options.timeoutMS,\n            ...options\n        });\n    }\n    /**\n     * Returns a writable stream (GridFSBucketWriteStream) for writing\n     * buffers to GridFS for a custom file id. The stream's 'id' property contains the resulting\n     * file's id.\n     */\n    openUploadStreamWithId(id, filename, options) {\n        return new upload_1.GridFSBucketWriteStream(this, filename, {\n            timeoutMS: this.s.options.timeoutMS,\n            ...options,\n            id\n        });\n    }\n    /** Returns a readable stream (GridFSBucketReadStream) for streaming file data from GridFS. */\n    openDownloadStream(id, options) {\n        return new download_1.GridFSBucketReadStream(this.s._chunksCollection, this.s._filesCollection, this.s.options.readPreference, { _id: id }, { timeoutMS: this.s.options.timeoutMS, ...options });\n    }\n    /**\n     * Deletes a file with the given id\n     *\n     * @param id - The id of the file doc\n     */\n    async delete(id, options) {\n        const { timeoutMS } = (0, utils_1.resolveOptions)(this.s.db, options);\n        let timeoutContext = undefined;\n        if (timeoutMS) {\n            timeoutContext = new timeout_1.CSOTTimeoutContext({\n                timeoutMS,\n                serverSelectionTimeoutMS: this.s.db.client.s.options.serverSelectionTimeoutMS\n            });\n        }\n        const { deletedCount } = await this.s._filesCollection.deleteOne({ _id: id }, { timeoutMS: timeoutContext?.remainingTimeMS });\n        const remainingTimeMS = timeoutContext?.remainingTimeMS;\n        if (remainingTimeMS != null && remainingTimeMS <= 0)\n            throw new error_1.MongoOperationTimeoutError(`Timed out after ${timeoutMS}ms`);\n        // Delete orphaned chunks before returning FileNotFound\n        await this.s._chunksCollection.deleteMany({ files_id: id }, { timeoutMS: remainingTimeMS });\n        if (deletedCount === 0) {\n            // TODO(NODE-3483): Replace with more appropriate error\n            // Consider creating new error MongoGridFSFileNotFoundError\n            throw new error_1.MongoRuntimeError(`File not found for id ${id}`);\n        }\n    }\n    /** Convenience wrapper around find on the files collection */\n    find(filter = {}, options = {}) {\n        return this.s._filesCollection.find(filter, options);\n    }\n    /**\n     * Returns a readable stream (GridFSBucketReadStream) for streaming the\n     * file with the given name from GridFS. If there are multiple files with\n     * the same name, this will stream the most recent file with the given name\n     * (as determined by the `uploadDate` field). You can set the `revision`\n     * option to change this behavior.\n     */\n    openDownloadStreamByName(filename, options) {\n        let sort = { uploadDate: -1 };\n        let skip = undefined;\n        if (options && options.revision != null) {\n            if (options.revision >= 0) {\n                sort = { uploadDate: 1 };\n                skip = options.revision;\n            }\n            else {\n                skip = -options.revision - 1;\n            }\n        }\n        return new download_1.GridFSBucketReadStream(this.s._chunksCollection, this.s._filesCollection, this.s.options.readPreference, { filename }, { timeoutMS: this.s.options.timeoutMS, ...options, sort, skip });\n    }\n    /**\n     * Renames the file with the given _id to the given string\n     *\n     * @param id - the id of the file to rename\n     * @param filename - new name for the file\n     */\n    async rename(id, filename, options) {\n        const filter = { _id: id };\n        const update = { $set: { filename } };\n        const { matchedCount } = await this.s._filesCollection.updateOne(filter, update, options);\n        if (matchedCount === 0) {\n            throw new error_1.MongoRuntimeError(`File with id ${id} not found`);\n        }\n    }\n    /** Removes this bucket's files collection, followed by its chunks collection. */\n    async drop(options) {\n        const { timeoutMS } = (0, utils_1.resolveOptions)(this.s.db, options);\n        let timeoutContext = undefined;\n        if (timeoutMS) {\n            timeoutContext = new timeout_1.CSOTTimeoutContext({\n                timeoutMS,\n                serverSelectionTimeoutMS: this.s.db.client.s.options.serverSelectionTimeoutMS\n            });\n        }\n        if (timeoutContext) {\n            await this.s._filesCollection.drop({ timeoutMS: timeoutContext.remainingTimeMS });\n            const remainingTimeMS = timeoutContext.getRemainingTimeMSOrThrow(`Timed out after ${timeoutMS}ms`);\n            await this.s._chunksCollection.drop({ timeoutMS: remainingTimeMS });\n        }\n        else {\n            await this.s._filesCollection.drop();\n            await this.s._chunksCollection.drop();\n        }\n    }\n}\nexports.GridFSBucket = GridFSBucket;\n/**\n * When the first call to openUploadStream is made, the upload stream will\n * check to see if it needs to create the proper indexes on the chunks and\n * files collections. This event is fired either when 1) it determines that\n * no index creation is necessary, 2) when it successfully creates the\n * necessary indexes.\n * @event\n */\nGridFSBucket.INDEX = 'index';\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2dyaWRmcy9pbmRleC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxvQkFBb0I7QUFDcEIsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsc0JBQXNCLG1CQUFPLENBQUMseUdBQWdCO0FBQzlDLGtCQUFrQixtQkFBTyxDQUFDLGlHQUFZO0FBQ3RDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLHdCQUF3QixtQkFBTyxDQUFDLDZHQUFrQjtBQUNsRCxtQkFBbUIsbUJBQU8sQ0FBQyx5R0FBWTtBQUN2QyxpQkFBaUIsbUJBQU8sQ0FBQyxxR0FBVTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHlJQUF5SSxTQUFTLElBQUksaURBQWlEO0FBQ3ZNO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFlBQVk7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGdCQUFnQixlQUFlLDRDQUE0QyxTQUFTLElBQUksNENBQTRDO0FBQ3BJO0FBQ0E7QUFDQSw0RUFBNEUsVUFBVTtBQUN0RjtBQUNBLG9EQUFvRCxjQUFjLElBQUksNEJBQTRCO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RSxHQUFHO0FBQzVFO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5SUFBeUksVUFBVSxJQUFJLDZEQUE2RDtBQUNwTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHlCQUF5QixRQUFRO0FBQ2pDLGdCQUFnQixlQUFlO0FBQy9CO0FBQ0EsZ0VBQWdFLElBQUk7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsWUFBWTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpREFBaUQsMkNBQTJDO0FBQzVGLGdHQUFnRyxVQUFVO0FBQzFHLGtEQUFrRCw0QkFBNEI7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9ncmlkZnMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkdyaWRGU0J1Y2tldCA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgdGltZW91dF8xID0gcmVxdWlyZShcIi4uL3RpbWVvdXRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBkb3dubG9hZF8xID0gcmVxdWlyZShcIi4vZG93bmxvYWRcIik7XG5jb25zdCB1cGxvYWRfMSA9IHJlcXVpcmUoXCIuL3VwbG9hZFwiKTtcbmNvbnN0IERFRkFVTFRfR1JJREZTX0JVQ0tFVF9PUFRJT05TID0ge1xuICAgIGJ1Y2tldE5hbWU6ICdmcycsXG4gICAgY2h1bmtTaXplQnl0ZXM6IDI1NSAqIDEwMjRcbn07XG4vKipcbiAqIENvbnN0cnVjdG9yIGZvciBhIHN0cmVhbWluZyBHcmlkRlMgaW50ZXJmYWNlXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdyaWRGU0J1Y2tldCBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMub24oJ2Vycm9yJywgdXRpbHNfMS5ub29wKTtcbiAgICAgICAgdGhpcy5zZXRNYXhMaXN0ZW5lcnMoMCk7XG4gICAgICAgIGNvbnN0IHByaXZhdGVPcHRpb25zID0gKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKGRiLCB7XG4gICAgICAgICAgICAuLi5ERUZBVUxUX0dSSURGU19CVUNLRVRfT1BUSU9OUyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICB3cml0ZUNvbmNlcm46IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucylcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucyA9IHtcbiAgICAgICAgICAgIGRiLFxuICAgICAgICAgICAgb3B0aW9uczogcHJpdmF0ZU9wdGlvbnMsXG4gICAgICAgICAgICBfY2h1bmtzQ29sbGVjdGlvbjogZGIuY29sbGVjdGlvbihwcml2YXRlT3B0aW9ucy5idWNrZXROYW1lICsgJy5jaHVua3MnKSxcbiAgICAgICAgICAgIF9maWxlc0NvbGxlY3Rpb246IGRiLmNvbGxlY3Rpb24ocHJpdmF0ZU9wdGlvbnMuYnVja2V0TmFtZSArICcuZmlsZXMnKSxcbiAgICAgICAgICAgIGNoZWNrZWRJbmRleGVzOiBmYWxzZSxcbiAgICAgICAgICAgIGNhbGxlZE9wZW5VcGxvYWRTdHJlYW06IGZhbHNlXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSB3cml0YWJsZSBzdHJlYW0gKEdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtKSBmb3Igd3JpdGluZ1xuICAgICAqIGJ1ZmZlcnMgdG8gR3JpZEZTLiBUaGUgc3RyZWFtJ3MgJ2lkJyBwcm9wZXJ0eSBjb250YWlucyB0aGUgcmVzdWx0aW5nXG4gICAgICogZmlsZSdzIGlkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbGVuYW1lIC0gVGhlIHZhbHVlIG9mIHRoZSAnZmlsZW5hbWUnIGtleSBpbiB0aGUgZmlsZXMgZG9jXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncy5cbiAgICAgKi9cbiAgICBvcGVuVXBsb2FkU3RyZWFtKGZpbGVuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgdXBsb2FkXzEuR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0odGhpcywgZmlsZW5hbWUsIHtcbiAgICAgICAgICAgIHRpbWVvdXRNUzogdGhpcy5zLm9wdGlvbnMudGltZW91dE1TLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHdyaXRhYmxlIHN0cmVhbSAoR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0pIGZvciB3cml0aW5nXG4gICAgICogYnVmZmVycyB0byBHcmlkRlMgZm9yIGEgY3VzdG9tIGZpbGUgaWQuIFRoZSBzdHJlYW0ncyAnaWQnIHByb3BlcnR5IGNvbnRhaW5zIHRoZSByZXN1bHRpbmdcbiAgICAgKiBmaWxlJ3MgaWQuXG4gICAgICovXG4gICAgb3BlblVwbG9hZFN0cmVhbVdpdGhJZChpZCwgZmlsZW5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB1cGxvYWRfMS5HcmlkRlNCdWNrZXRXcml0ZVN0cmVhbSh0aGlzLCBmaWxlbmFtZSwge1xuICAgICAgICAgICAgdGltZW91dE1TOiB0aGlzLnMub3B0aW9ucy50aW1lb3V0TVMsXG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgaWRcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgcmVhZGFibGUgc3RyZWFtIChHcmlkRlNCdWNrZXRSZWFkU3RyZWFtKSBmb3Igc3RyZWFtaW5nIGZpbGUgZGF0YSBmcm9tIEdyaWRGUy4gKi9cbiAgICBvcGVuRG93bmxvYWRTdHJlYW0oaWQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBkb3dubG9hZF8xLkdyaWRGU0J1Y2tldFJlYWRTdHJlYW0odGhpcy5zLl9jaHVua3NDb2xsZWN0aW9uLCB0aGlzLnMuX2ZpbGVzQ29sbGVjdGlvbiwgdGhpcy5zLm9wdGlvbnMucmVhZFByZWZlcmVuY2UsIHsgX2lkOiBpZCB9LCB7IHRpbWVvdXRNUzogdGhpcy5zLm9wdGlvbnMudGltZW91dE1TLCAuLi5vcHRpb25zIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgZmlsZSB3aXRoIHRoZSBnaXZlbiBpZFxuICAgICAqXG4gICAgICogQHBhcmFtIGlkIC0gVGhlIGlkIG9mIHRoZSBmaWxlIGRvY1xuICAgICAqL1xuICAgIGFzeW5jIGRlbGV0ZShpZCwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCB7IHRpbWVvdXRNUyB9ID0gKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMucy5kYiwgb3B0aW9ucyk7XG4gICAgICAgIGxldCB0aW1lb3V0Q29udGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHRpbWVvdXRNUykge1xuICAgICAgICAgICAgdGltZW91dENvbnRleHQgPSBuZXcgdGltZW91dF8xLkNTT1RUaW1lb3V0Q29udGV4dCh7XG4gICAgICAgICAgICAgICAgdGltZW91dE1TLFxuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogdGhpcy5zLmRiLmNsaWVudC5zLm9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGRlbGV0ZWRDb3VudCB9ID0gYXdhaXQgdGhpcy5zLl9maWxlc0NvbGxlY3Rpb24uZGVsZXRlT25lKHsgX2lkOiBpZCB9LCB7IHRpbWVvdXRNUzogdGltZW91dENvbnRleHQ/LnJlbWFpbmluZ1RpbWVNUyB9KTtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nVGltZU1TID0gdGltZW91dENvbnRleHQ/LnJlbWFpbmluZ1RpbWVNUztcbiAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWVNUyAhPSBudWxsICYmIHJlbWFpbmluZ1RpbWVNUyA8PSAwKVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IoYFRpbWVkIG91dCBhZnRlciAke3RpbWVvdXRNU31tc2ApO1xuICAgICAgICAvLyBEZWxldGUgb3JwaGFuZWQgY2h1bmtzIGJlZm9yZSByZXR1cm5pbmcgRmlsZU5vdEZvdW5kXG4gICAgICAgIGF3YWl0IHRoaXMucy5fY2h1bmtzQ29sbGVjdGlvbi5kZWxldGVNYW55KHsgZmlsZXNfaWQ6IGlkIH0sIHsgdGltZW91dE1TOiByZW1haW5pbmdUaW1lTVMgfSk7XG4gICAgICAgIGlmIChkZWxldGVkQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKTogUmVwbGFjZSB3aXRoIG1vcmUgYXBwcm9wcmlhdGUgZXJyb3JcbiAgICAgICAgICAgIC8vIENvbnNpZGVyIGNyZWF0aW5nIG5ldyBlcnJvciBNb25nb0dyaWRGU0ZpbGVOb3RGb3VuZEVycm9yXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgRmlsZSBub3QgZm91bmQgZm9yIGlkICR7aWR9YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIENvbnZlbmllbmNlIHdyYXBwZXIgYXJvdW5kIGZpbmQgb24gdGhlIGZpbGVzIGNvbGxlY3Rpb24gKi9cbiAgICBmaW5kKGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5fZmlsZXNDb2xsZWN0aW9uLmZpbmQoZmlsdGVyLCBvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHJlYWRhYmxlIHN0cmVhbSAoR3JpZEZTQnVja2V0UmVhZFN0cmVhbSkgZm9yIHN0cmVhbWluZyB0aGVcbiAgICAgKiBmaWxlIHdpdGggdGhlIGdpdmVuIG5hbWUgZnJvbSBHcmlkRlMuIElmIHRoZXJlIGFyZSBtdWx0aXBsZSBmaWxlcyB3aXRoXG4gICAgICogdGhlIHNhbWUgbmFtZSwgdGhpcyB3aWxsIHN0cmVhbSB0aGUgbW9zdCByZWNlbnQgZmlsZSB3aXRoIHRoZSBnaXZlbiBuYW1lXG4gICAgICogKGFzIGRldGVybWluZWQgYnkgdGhlIGB1cGxvYWREYXRlYCBmaWVsZCkuIFlvdSBjYW4gc2V0IHRoZSBgcmV2aXNpb25gXG4gICAgICogb3B0aW9uIHRvIGNoYW5nZSB0aGlzIGJlaGF2aW9yLlxuICAgICAqL1xuICAgIG9wZW5Eb3dubG9hZFN0cmVhbUJ5TmFtZShmaWxlbmFtZSwgb3B0aW9ucykge1xuICAgICAgICBsZXQgc29ydCA9IHsgdXBsb2FkRGF0ZTogLTEgfTtcbiAgICAgICAgbGV0IHNraXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucmV2aXNpb24gIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucmV2aXNpb24gPj0gMCkge1xuICAgICAgICAgICAgICAgIHNvcnQgPSB7IHVwbG9hZERhdGU6IDEgfTtcbiAgICAgICAgICAgICAgICBza2lwID0gb3B0aW9ucy5yZXZpc2lvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNraXAgPSAtb3B0aW9ucy5yZXZpc2lvbiAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBkb3dubG9hZF8xLkdyaWRGU0J1Y2tldFJlYWRTdHJlYW0odGhpcy5zLl9jaHVua3NDb2xsZWN0aW9uLCB0aGlzLnMuX2ZpbGVzQ29sbGVjdGlvbiwgdGhpcy5zLm9wdGlvbnMucmVhZFByZWZlcmVuY2UsIHsgZmlsZW5hbWUgfSwgeyB0aW1lb3V0TVM6IHRoaXMucy5vcHRpb25zLnRpbWVvdXRNUywgLi4ub3B0aW9ucywgc29ydCwgc2tpcCB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVuYW1lcyB0aGUgZmlsZSB3aXRoIHRoZSBnaXZlbiBfaWQgdG8gdGhlIGdpdmVuIHN0cmluZ1xuICAgICAqXG4gICAgICogQHBhcmFtIGlkIC0gdGhlIGlkIG9mIHRoZSBmaWxlIHRvIHJlbmFtZVxuICAgICAqIEBwYXJhbSBmaWxlbmFtZSAtIG5ldyBuYW1lIGZvciB0aGUgZmlsZVxuICAgICAqL1xuICAgIGFzeW5jIHJlbmFtZShpZCwgZmlsZW5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyID0geyBfaWQ6IGlkIH07XG4gICAgICAgIGNvbnN0IHVwZGF0ZSA9IHsgJHNldDogeyBmaWxlbmFtZSB9IH07XG4gICAgICAgIGNvbnN0IHsgbWF0Y2hlZENvdW50IH0gPSBhd2FpdCB0aGlzLnMuX2ZpbGVzQ29sbGVjdGlvbi51cGRhdGVPbmUoZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpO1xuICAgICAgICBpZiAobWF0Y2hlZENvdW50ID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgRmlsZSB3aXRoIGlkICR7aWR9IG5vdCBmb3VuZGApO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoaXMgYnVja2V0J3MgZmlsZXMgY29sbGVjdGlvbiwgZm9sbG93ZWQgYnkgaXRzIGNodW5rcyBjb2xsZWN0aW9uLiAqL1xuICAgIGFzeW5jIGRyb3Aob3B0aW9ucykge1xuICAgICAgICBjb25zdCB7IHRpbWVvdXRNUyB9ID0gKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMucy5kYiwgb3B0aW9ucyk7XG4gICAgICAgIGxldCB0aW1lb3V0Q29udGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHRpbWVvdXRNUykge1xuICAgICAgICAgICAgdGltZW91dENvbnRleHQgPSBuZXcgdGltZW91dF8xLkNTT1RUaW1lb3V0Q29udGV4dCh7XG4gICAgICAgICAgICAgICAgdGltZW91dE1TLFxuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogdGhpcy5zLmRiLmNsaWVudC5zLm9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGltZW91dENvbnRleHQpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucy5fZmlsZXNDb2xsZWN0aW9uLmRyb3AoeyB0aW1lb3V0TVM6IHRpbWVvdXRDb250ZXh0LnJlbWFpbmluZ1RpbWVNUyB9KTtcbiAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ1RpbWVNUyA9IHRpbWVvdXRDb250ZXh0LmdldFJlbWFpbmluZ1RpbWVNU09yVGhyb3coYFRpbWVkIG91dCBhZnRlciAke3RpbWVvdXRNU31tc2ApO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zLl9jaHVua3NDb2xsZWN0aW9uLmRyb3AoeyB0aW1lb3V0TVM6IHJlbWFpbmluZ1RpbWVNUyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucy5fZmlsZXNDb2xsZWN0aW9uLmRyb3AoKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucy5fY2h1bmtzQ29sbGVjdGlvbi5kcm9wKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkdyaWRGU0J1Y2tldCA9IEdyaWRGU0J1Y2tldDtcbi8qKlxuICogV2hlbiB0aGUgZmlyc3QgY2FsbCB0byBvcGVuVXBsb2FkU3RyZWFtIGlzIG1hZGUsIHRoZSB1cGxvYWQgc3RyZWFtIHdpbGxcbiAqIGNoZWNrIHRvIHNlZSBpZiBpdCBuZWVkcyB0byBjcmVhdGUgdGhlIHByb3BlciBpbmRleGVzIG9uIHRoZSBjaHVua3MgYW5kXG4gKiBmaWxlcyBjb2xsZWN0aW9ucy4gVGhpcyBldmVudCBpcyBmaXJlZCBlaXRoZXIgd2hlbiAxKSBpdCBkZXRlcm1pbmVzIHRoYXRcbiAqIG5vIGluZGV4IGNyZWF0aW9uIGlzIG5lY2Vzc2FyeSwgMikgd2hlbiBpdCBzdWNjZXNzZnVsbHkgY3JlYXRlcyB0aGVcbiAqIG5lY2Vzc2FyeSBpbmRleGVzLlxuICogQGV2ZW50XG4gKi9cbkdyaWRGU0J1Y2tldC5JTkRFWCA9ICdpbmRleCc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/upload.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/upload.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GridFSBucketWriteStream = void 0;\nconst stream_1 = __webpack_require__(/*! stream */ \"stream\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst abstract_cursor_1 = __webpack_require__(/*! ../cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\n/**\n * A writable stream that enables you to write buffers to GridFS.\n *\n * Do not instantiate this class directly. Use `openUploadStream()` instead.\n * @public\n */\nclass GridFSBucketWriteStream extends stream_1.Writable {\n    /**\n     * @param bucket - Handle for this stream's corresponding bucket\n     * @param filename - The value of the 'filename' key in the files doc\n     * @param options - Optional settings.\n     * @internal\n     */\n    constructor(bucket, filename, options) {\n        super();\n        /**\n         * The document containing information about the inserted file.\n         * This property is defined _after_ the finish event has been emitted.\n         * It will remain `null` if an error occurs.\n         *\n         * @example\n         * ```ts\n         * fs.createReadStream('file.txt')\n         *   .pipe(bucket.openUploadStream('file.txt'))\n         *   .on('finish', function () {\n         *     console.log(this.gridFSFile)\n         *   })\n         * ```\n         */\n        this.gridFSFile = null;\n        options = options ?? {};\n        this.bucket = bucket;\n        this.chunks = bucket.s._chunksCollection;\n        this.filename = filename;\n        this.files = bucket.s._filesCollection;\n        this.options = options;\n        this.writeConcern = write_concern_1.WriteConcern.fromOptions(options) || bucket.s.options.writeConcern;\n        // Signals the write is all done\n        this.done = false;\n        this.id = options.id ? options.id : new bson_1.ObjectId();\n        // properly inherit the default chunksize from parent\n        this.chunkSizeBytes = options.chunkSizeBytes || this.bucket.s.options.chunkSizeBytes;\n        this.bufToStore = Buffer.alloc(this.chunkSizeBytes);\n        this.length = 0;\n        this.n = 0;\n        this.pos = 0;\n        this.state = {\n            streamEnd: false,\n            outstandingRequests: 0,\n            errored: false,\n            aborted: false\n        };\n        if (options.timeoutMS != null)\n            this.timeoutContext = new timeout_1.CSOTTimeoutContext({\n                timeoutMS: options.timeoutMS,\n                serverSelectionTimeoutMS: (0, utils_1.resolveTimeoutOptions)(this.bucket.s.db.client, {})\n                    .serverSelectionTimeoutMS\n            });\n    }\n    /**\n     * @internal\n     *\n     * The stream is considered constructed when the indexes are done being created\n     */\n    _construct(callback) {\n        if (!this.bucket.s.calledOpenUploadStream) {\n            this.bucket.s.calledOpenUploadStream = true;\n            checkIndexes(this).then(() => {\n                this.bucket.s.checkedIndexes = true;\n                this.bucket.emit('index');\n                callback();\n            }, error => {\n                if (error instanceof error_1.MongoOperationTimeoutError) {\n                    return handleError(this, error, callback);\n                }\n                (0, utils_1.squashError)(error);\n                callback();\n            });\n        }\n        else {\n            return process.nextTick(callback);\n        }\n    }\n    /**\n     * @internal\n     * Write a buffer to the stream.\n     *\n     * @param chunk - Buffer to write\n     * @param encoding - Optional encoding for the buffer\n     * @param callback - Function to call when the chunk was added to the buffer, or if the entire chunk was persisted to MongoDB if this chunk caused a flush.\n     */\n    _write(chunk, encoding, callback) {\n        doWrite(this, chunk, encoding, callback);\n    }\n    /** @internal */\n    _final(callback) {\n        if (this.state.streamEnd) {\n            return process.nextTick(callback);\n        }\n        this.state.streamEnd = true;\n        writeRemnant(this, callback);\n    }\n    /**\n     * Places this write stream into an aborted state (all future writes fail)\n     * and deletes all chunks that have already been written.\n     */\n    async abort() {\n        if (this.state.streamEnd) {\n            // TODO(NODE-3485): Replace with MongoGridFSStreamClosed\n            throw new error_1.MongoAPIError('Cannot abort a stream that has already completed');\n        }\n        if (this.state.aborted) {\n            // TODO(NODE-3485): Replace with MongoGridFSStreamClosed\n            throw new error_1.MongoAPIError('Cannot call abort() on a stream twice');\n        }\n        this.state.aborted = true;\n        const remainingTimeMS = this.timeoutContext?.getRemainingTimeMSOrThrow(`Upload timed out after ${this.timeoutContext?.timeoutMS}ms`);\n        await this.chunks.deleteMany({ files_id: this.id }, { timeoutMS: remainingTimeMS });\n    }\n}\nexports.GridFSBucketWriteStream = GridFSBucketWriteStream;\nfunction handleError(stream, error, callback) {\n    if (stream.state.errored) {\n        process.nextTick(callback);\n        return;\n    }\n    stream.state.errored = true;\n    process.nextTick(callback, error);\n}\nfunction createChunkDoc(filesId, n, data) {\n    return {\n        _id: new bson_1.ObjectId(),\n        files_id: filesId,\n        n,\n        data\n    };\n}\nasync function checkChunksIndex(stream) {\n    const index = { files_id: 1, n: 1 };\n    let remainingTimeMS;\n    remainingTimeMS = stream.timeoutContext?.getRemainingTimeMSOrThrow(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`);\n    let indexes;\n    try {\n        indexes = await stream.chunks\n            .listIndexes({\n            timeoutMode: remainingTimeMS != null ? abstract_cursor_1.CursorTimeoutMode.LIFETIME : undefined,\n            timeoutMS: remainingTimeMS\n        })\n            .toArray();\n    }\n    catch (error) {\n        if (error instanceof error_1.MongoError && error.code === error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n            indexes = [];\n        }\n        else {\n            throw error;\n        }\n    }\n    const hasChunksIndex = !!indexes.find(index => {\n        const keys = Object.keys(index.key);\n        if (keys.length === 2 && index.key.files_id === 1 && index.key.n === 1) {\n            return true;\n        }\n        return false;\n    });\n    if (!hasChunksIndex) {\n        remainingTimeMS = stream.timeoutContext?.getRemainingTimeMSOrThrow(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`);\n        await stream.chunks.createIndex(index, {\n            ...stream.writeConcern,\n            background: true,\n            unique: true,\n            timeoutMS: remainingTimeMS\n        });\n    }\n}\nfunction checkDone(stream, callback) {\n    if (stream.done) {\n        return process.nextTick(callback);\n    }\n    if (stream.state.streamEnd && stream.state.outstandingRequests === 0 && !stream.state.errored) {\n        // Set done so we do not trigger duplicate createFilesDoc\n        stream.done = true;\n        // Create a new files doc\n        const gridFSFile = createFilesDoc(stream.id, stream.length, stream.chunkSizeBytes, stream.filename, stream.options.contentType, stream.options.aliases, stream.options.metadata);\n        if (isAborted(stream, callback)) {\n            return;\n        }\n        const remainingTimeMS = stream.timeoutContext?.remainingTimeMS;\n        if (remainingTimeMS != null && remainingTimeMS <= 0) {\n            return handleError(stream, new error_1.MongoOperationTimeoutError(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`), callback);\n        }\n        stream.files\n            .insertOne(gridFSFile, { writeConcern: stream.writeConcern, timeoutMS: remainingTimeMS })\n            .then(() => {\n            stream.gridFSFile = gridFSFile;\n            callback();\n        }, error => {\n            return handleError(stream, error, callback);\n        });\n        return;\n    }\n    process.nextTick(callback);\n}\nasync function checkIndexes(stream) {\n    let remainingTimeMS = stream.timeoutContext?.getRemainingTimeMSOrThrow(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`);\n    const doc = await stream.files.findOne({}, {\n        projection: { _id: 1 },\n        timeoutMS: remainingTimeMS\n    });\n    if (doc != null) {\n        // If at least one document exists assume the collection has the required index\n        return;\n    }\n    const index = { filename: 1, uploadDate: 1 };\n    let indexes;\n    remainingTimeMS = stream.timeoutContext?.getRemainingTimeMSOrThrow(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`);\n    const listIndexesOptions = {\n        timeoutMode: remainingTimeMS != null ? abstract_cursor_1.CursorTimeoutMode.LIFETIME : undefined,\n        timeoutMS: remainingTimeMS\n    };\n    try {\n        indexes = await stream.files.listIndexes(listIndexesOptions).toArray();\n    }\n    catch (error) {\n        if (error instanceof error_1.MongoError && error.code === error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n            indexes = [];\n        }\n        else {\n            throw error;\n        }\n    }\n    const hasFileIndex = !!indexes.find(index => {\n        const keys = Object.keys(index.key);\n        if (keys.length === 2 && index.key.filename === 1 && index.key.uploadDate === 1) {\n            return true;\n        }\n        return false;\n    });\n    if (!hasFileIndex) {\n        remainingTimeMS = stream.timeoutContext?.getRemainingTimeMSOrThrow(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`);\n        await stream.files.createIndex(index, { background: false, timeoutMS: remainingTimeMS });\n    }\n    await checkChunksIndex(stream);\n}\nfunction createFilesDoc(_id, length, chunkSize, filename, contentType, aliases, metadata) {\n    const ret = {\n        _id,\n        length,\n        chunkSize,\n        uploadDate: new Date(),\n        filename\n    };\n    if (contentType) {\n        ret.contentType = contentType;\n    }\n    if (aliases) {\n        ret.aliases = aliases;\n    }\n    if (metadata) {\n        ret.metadata = metadata;\n    }\n    return ret;\n}\nfunction doWrite(stream, chunk, encoding, callback) {\n    if (isAborted(stream, callback)) {\n        return;\n    }\n    const inputBuf = Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk, encoding);\n    stream.length += inputBuf.length;\n    // Input is small enough to fit in our buffer\n    if (stream.pos + inputBuf.length < stream.chunkSizeBytes) {\n        inputBuf.copy(stream.bufToStore, stream.pos);\n        stream.pos += inputBuf.length;\n        process.nextTick(callback);\n        return;\n    }\n    // Otherwise, buffer is too big for current chunk, so we need to flush\n    // to MongoDB.\n    let inputBufRemaining = inputBuf.length;\n    let spaceRemaining = stream.chunkSizeBytes - stream.pos;\n    let numToCopy = Math.min(spaceRemaining, inputBuf.length);\n    let outstandingRequests = 0;\n    while (inputBufRemaining > 0) {\n        const inputBufPos = inputBuf.length - inputBufRemaining;\n        inputBuf.copy(stream.bufToStore, stream.pos, inputBufPos, inputBufPos + numToCopy);\n        stream.pos += numToCopy;\n        spaceRemaining -= numToCopy;\n        let doc;\n        if (spaceRemaining === 0) {\n            doc = createChunkDoc(stream.id, stream.n, Buffer.from(stream.bufToStore));\n            const remainingTimeMS = stream.timeoutContext?.remainingTimeMS;\n            if (remainingTimeMS != null && remainingTimeMS <= 0) {\n                return handleError(stream, new error_1.MongoOperationTimeoutError(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`), callback);\n            }\n            ++stream.state.outstandingRequests;\n            ++outstandingRequests;\n            if (isAborted(stream, callback)) {\n                return;\n            }\n            stream.chunks\n                .insertOne(doc, { writeConcern: stream.writeConcern, timeoutMS: remainingTimeMS })\n                .then(() => {\n                --stream.state.outstandingRequests;\n                --outstandingRequests;\n                if (!outstandingRequests) {\n                    checkDone(stream, callback);\n                }\n            }, error => {\n                return handleError(stream, error, callback);\n            });\n            spaceRemaining = stream.chunkSizeBytes;\n            stream.pos = 0;\n            ++stream.n;\n        }\n        inputBufRemaining -= numToCopy;\n        numToCopy = Math.min(spaceRemaining, inputBufRemaining);\n    }\n}\nfunction writeRemnant(stream, callback) {\n    // Buffer is empty, so don't bother to insert\n    if (stream.pos === 0) {\n        return checkDone(stream, callback);\n    }\n    // Create a new buffer to make sure the buffer isn't bigger than it needs\n    // to be.\n    const remnant = Buffer.alloc(stream.pos);\n    stream.bufToStore.copy(remnant, 0, 0, stream.pos);\n    const doc = createChunkDoc(stream.id, stream.n, remnant);\n    // If the stream was aborted, do not write remnant\n    if (isAborted(stream, callback)) {\n        return;\n    }\n    const remainingTimeMS = stream.timeoutContext?.remainingTimeMS;\n    if (remainingTimeMS != null && remainingTimeMS <= 0) {\n        return handleError(stream, new error_1.MongoOperationTimeoutError(`Upload timed out after ${stream.timeoutContext?.timeoutMS}ms`), callback);\n    }\n    ++stream.state.outstandingRequests;\n    stream.chunks\n        .insertOne(doc, { writeConcern: stream.writeConcern, timeoutMS: remainingTimeMS })\n        .then(() => {\n        --stream.state.outstandingRequests;\n        checkDone(stream, callback);\n    }, error => {\n        return handleError(stream, error, callback);\n    });\n}\nfunction isAborted(stream, callback) {\n    if (stream.state.aborted) {\n        process.nextTick(callback, new error_1.MongoAPIError('Stream has been aborted'));\n        return true;\n    }\n    return false;\n}\n//# sourceMappingURL=upload.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2dyaWRmcy91cGxvYWQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsK0JBQStCO0FBQy9CLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQywwQkFBMEIsbUJBQU8sQ0FBQywrSEFBMkI7QUFDN0QsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsd0JBQXdCLG1CQUFPLENBQUMsK0dBQW9CO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3R0FBd0c7QUFDeEc7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUdBQXlHLCtCQUErQjtBQUN4SSx1Q0FBdUMsbUJBQW1CLElBQUksNEJBQTRCO0FBQzFGO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBLGlHQUFpRyxpQ0FBaUM7QUFDbEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EscUdBQXFHLGlDQUFpQztBQUN0STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0dBQXdHLGlDQUFpQztBQUN6STtBQUNBO0FBQ0EscUNBQXFDLCtEQUErRDtBQUNwRztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFHQUFxRyxpQ0FBaUM7QUFDdEksNkNBQTZDO0FBQzdDLHNCQUFzQixRQUFRO0FBQzlCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0EsaUdBQWlHLGlDQUFpQztBQUNsSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxxR0FBcUcsaUNBQWlDO0FBQ3RJLGdEQUFnRCwrQ0FBK0M7QUFDL0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEdBQTRHLGlDQUFpQztBQUM3STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywrREFBK0Q7QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9HQUFvRyxpQ0FBaUM7QUFDckk7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLCtEQUErRDtBQUN6RjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvZ3JpZGZzL3VwbG9hZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0gPSB2b2lkIDA7XG5jb25zdCBzdHJlYW1fMSA9IHJlcXVpcmUoXCJzdHJlYW1cIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4uL2N1cnNvci9hYnN0cmFjdF9jdXJzb3JcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgdGltZW91dF8xID0gcmVxdWlyZShcIi4uL3RpbWVvdXRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vLi4vd3JpdGVfY29uY2VyblwiKTtcbi8qKlxuICogQSB3cml0YWJsZSBzdHJlYW0gdGhhdCBlbmFibGVzIHlvdSB0byB3cml0ZSBidWZmZXJzIHRvIEdyaWRGUy5cbiAqXG4gKiBEbyBub3QgaW5zdGFudGlhdGUgdGhpcyBjbGFzcyBkaXJlY3RseS4gVXNlIGBvcGVuVXBsb2FkU3RyZWFtKClgIGluc3RlYWQuXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtIGV4dGVuZHMgc3RyZWFtXzEuV3JpdGFibGUge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBidWNrZXQgLSBIYW5kbGUgZm9yIHRoaXMgc3RyZWFtJ3MgY29ycmVzcG9uZGluZyBidWNrZXRcbiAgICAgKiBAcGFyYW0gZmlsZW5hbWUgLSBUaGUgdmFsdWUgb2YgdGhlICdmaWxlbmFtZScga2V5IGluIHRoZSBmaWxlcyBkb2NcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGJ1Y2tldCwgZmlsZW5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkb2N1bWVudCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBpbnNlcnRlZCBmaWxlLlxuICAgICAgICAgKiBUaGlzIHByb3BlcnR5IGlzIGRlZmluZWQgX2FmdGVyXyB0aGUgZmluaXNoIGV2ZW50IGhhcyBiZWVuIGVtaXR0ZWQuXG4gICAgICAgICAqIEl0IHdpbGwgcmVtYWluIGBudWxsYCBpZiBhbiBlcnJvciBvY2N1cnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBleGFtcGxlXG4gICAgICAgICAqIGBgYHRzXG4gICAgICAgICAqIGZzLmNyZWF0ZVJlYWRTdHJlYW0oJ2ZpbGUudHh0JylcbiAgICAgICAgICogICAucGlwZShidWNrZXQub3BlblVwbG9hZFN0cmVhbSgnZmlsZS50eHQnKSlcbiAgICAgICAgICogICAub24oJ2ZpbmlzaCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICogICAgIGNvbnNvbGUubG9nKHRoaXMuZ3JpZEZTRmlsZSlcbiAgICAgICAgICogICB9KVxuICAgICAgICAgKiBgYGBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3JpZEZTRmlsZSA9IG51bGw7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICB0aGlzLmJ1Y2tldCA9IGJ1Y2tldDtcbiAgICAgICAgdGhpcy5jaHVua3MgPSBidWNrZXQucy5fY2h1bmtzQ29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5maWxlbmFtZSA9IGZpbGVuYW1lO1xuICAgICAgICB0aGlzLmZpbGVzID0gYnVja2V0LnMuX2ZpbGVzQ29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy53cml0ZUNvbmNlcm4gPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpIHx8IGJ1Y2tldC5zLm9wdGlvbnMud3JpdGVDb25jZXJuO1xuICAgICAgICAvLyBTaWduYWxzIHRoZSB3cml0ZSBpcyBhbGwgZG9uZVxuICAgICAgICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQgPyBvcHRpb25zLmlkIDogbmV3IGJzb25fMS5PYmplY3RJZCgpO1xuICAgICAgICAvLyBwcm9wZXJseSBpbmhlcml0IHRoZSBkZWZhdWx0IGNodW5rc2l6ZSBmcm9tIHBhcmVudFxuICAgICAgICB0aGlzLmNodW5rU2l6ZUJ5dGVzID0gb3B0aW9ucy5jaHVua1NpemVCeXRlcyB8fCB0aGlzLmJ1Y2tldC5zLm9wdGlvbnMuY2h1bmtTaXplQnl0ZXM7XG4gICAgICAgIHRoaXMuYnVmVG9TdG9yZSA9IEJ1ZmZlci5hbGxvYyh0aGlzLmNodW5rU2l6ZUJ5dGVzKTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLm4gPSAwO1xuICAgICAgICB0aGlzLnBvcyA9IDA7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBzdHJlYW1FbmQ6IGZhbHNlLFxuICAgICAgICAgICAgb3V0c3RhbmRpbmdSZXF1ZXN0czogMCxcbiAgICAgICAgICAgIGVycm9yZWQ6IGZhbHNlLFxuICAgICAgICAgICAgYWJvcnRlZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dE1TICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLnRpbWVvdXRDb250ZXh0ID0gbmV3IHRpbWVvdXRfMS5DU09UVGltZW91dENvbnRleHQoe1xuICAgICAgICAgICAgICAgIHRpbWVvdXRNUzogb3B0aW9ucy50aW1lb3V0TVMsXG4gICAgICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiAoMCwgdXRpbHNfMS5yZXNvbHZlVGltZW91dE9wdGlvbnMpKHRoaXMuYnVja2V0LnMuZGIuY2xpZW50LCB7fSlcbiAgICAgICAgICAgICAgICAgICAgLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNU1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogVGhlIHN0cmVhbSBpcyBjb25zaWRlcmVkIGNvbnN0cnVjdGVkIHdoZW4gdGhlIGluZGV4ZXMgYXJlIGRvbmUgYmVpbmcgY3JlYXRlZFxuICAgICAqL1xuICAgIF9jb25zdHJ1Y3QoY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCF0aGlzLmJ1Y2tldC5zLmNhbGxlZE9wZW5VcGxvYWRTdHJlYW0pIHtcbiAgICAgICAgICAgIHRoaXMuYnVja2V0LnMuY2FsbGVkT3BlblVwbG9hZFN0cmVhbSA9IHRydWU7XG4gICAgICAgICAgICBjaGVja0luZGV4ZXModGhpcykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5idWNrZXQucy5jaGVja2VkSW5kZXhlcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5idWNrZXQuZW1pdCgnaW5kZXgnKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKHRoaXMsIGVycm9yLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MubmV4dFRpY2soY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIFdyaXRlIGEgYnVmZmVyIHRvIHRoZSBzdHJlYW0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2h1bmsgLSBCdWZmZXIgdG8gd3JpdGVcbiAgICAgKiBAcGFyYW0gZW5jb2RpbmcgLSBPcHRpb25hbCBlbmNvZGluZyBmb3IgdGhlIGJ1ZmZlclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIEZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgY2h1bmsgd2FzIGFkZGVkIHRvIHRoZSBidWZmZXIsIG9yIGlmIHRoZSBlbnRpcmUgY2h1bmsgd2FzIHBlcnNpc3RlZCB0byBNb25nb0RCIGlmIHRoaXMgY2h1bmsgY2F1c2VkIGEgZmx1c2guXG4gICAgICovXG4gICAgX3dyaXRlKGNodW5rLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgICAgICAgZG9Xcml0ZSh0aGlzLCBjaHVuaywgZW5jb2RpbmcsIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9maW5hbChjYWxsYmFjaykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5zdHJlYW1FbmQpIHtcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzLm5leHRUaWNrKGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXRlLnN0cmVhbUVuZCA9IHRydWU7XG4gICAgICAgIHdyaXRlUmVtbmFudCh0aGlzLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBsYWNlcyB0aGlzIHdyaXRlIHN0cmVhbSBpbnRvIGFuIGFib3J0ZWQgc3RhdGUgKGFsbCBmdXR1cmUgd3JpdGVzIGZhaWwpXG4gICAgICogYW5kIGRlbGV0ZXMgYWxsIGNodW5rcyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHdyaXR0ZW4uXG4gICAgICovXG4gICAgYXN5bmMgYWJvcnQoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnN0cmVhbUVuZCkge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODUpOiBSZXBsYWNlIHdpdGggTW9uZ29HcmlkRlNTdHJlYW1DbG9zZWRcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0Nhbm5vdCBhYm9ydCBhIHN0cmVhbSB0aGF0IGhhcyBhbHJlYWR5IGNvbXBsZXRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmFib3J0ZWQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oTk9ERS0zNDg1KTogUmVwbGFjZSB3aXRoIE1vbmdvR3JpZEZTU3RyZWFtQ2xvc2VkXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdDYW5ub3QgY2FsbCBhYm9ydCgpIG9uIGEgc3RyZWFtIHR3aWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZS5hYm9ydGVkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nVGltZU1TID0gdGhpcy50aW1lb3V0Q29udGV4dD8uZ2V0UmVtYWluaW5nVGltZU1TT3JUaHJvdyhgVXBsb2FkIHRpbWVkIG91dCBhZnRlciAke3RoaXMudGltZW91dENvbnRleHQ/LnRpbWVvdXRNU31tc2ApO1xuICAgICAgICBhd2FpdCB0aGlzLmNodW5rcy5kZWxldGVNYW55KHsgZmlsZXNfaWQ6IHRoaXMuaWQgfSwgeyB0aW1lb3V0TVM6IHJlbWFpbmluZ1RpbWVNUyB9KTtcbiAgICB9XG59XG5leHBvcnRzLkdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtID0gR3JpZEZTQnVja2V0V3JpdGVTdHJlYW07XG5mdW5jdGlvbiBoYW5kbGVFcnJvcihzdHJlYW0sIGVycm9yLCBjYWxsYmFjaykge1xuICAgIGlmIChzdHJlYW0uc3RhdGUuZXJyb3JlZCkge1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzdHJlYW0uc3RhdGUuZXJyb3JlZCA9IHRydWU7XG4gICAgcHJvY2Vzcy5uZXh0VGljayhjYWxsYmFjaywgZXJyb3IpO1xufVxuZnVuY3Rpb24gY3JlYXRlQ2h1bmtEb2MoZmlsZXNJZCwgbiwgZGF0YSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIF9pZDogbmV3IGJzb25fMS5PYmplY3RJZCgpLFxuICAgICAgICBmaWxlc19pZDogZmlsZXNJZCxcbiAgICAgICAgbixcbiAgICAgICAgZGF0YVxuICAgIH07XG59XG5hc3luYyBmdW5jdGlvbiBjaGVja0NodW5rc0luZGV4KHN0cmVhbSkge1xuICAgIGNvbnN0IGluZGV4ID0geyBmaWxlc19pZDogMSwgbjogMSB9O1xuICAgIGxldCByZW1haW5pbmdUaW1lTVM7XG4gICAgcmVtYWluaW5nVGltZU1TID0gc3RyZWFtLnRpbWVvdXRDb250ZXh0Py5nZXRSZW1haW5pbmdUaW1lTVNPclRocm93KGBVcGxvYWQgdGltZWQgb3V0IGFmdGVyICR7c3RyZWFtLnRpbWVvdXRDb250ZXh0Py50aW1lb3V0TVN9bXNgKTtcbiAgICBsZXQgaW5kZXhlcztcbiAgICB0cnkge1xuICAgICAgICBpbmRleGVzID0gYXdhaXQgc3RyZWFtLmNodW5rc1xuICAgICAgICAgICAgLmxpc3RJbmRleGVzKHtcbiAgICAgICAgICAgIHRpbWVvdXRNb2RlOiByZW1haW5pbmdUaW1lTVMgIT0gbnVsbCA/IGFic3RyYWN0X2N1cnNvcl8xLkN1cnNvclRpbWVvdXRNb2RlLkxJRkVUSU1FIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgdGltZW91dE1TOiByZW1haW5pbmdUaW1lTVNcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50b0FycmF5KCk7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IgJiYgZXJyb3IuY29kZSA9PT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLk5hbWVzcGFjZU5vdEZvdW5kKSB7XG4gICAgICAgICAgICBpbmRleGVzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBoYXNDaHVua3NJbmRleCA9ICEhaW5kZXhlcy5maW5kKGluZGV4ID0+IHtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGluZGV4LmtleSk7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMiAmJiBpbmRleC5rZXkuZmlsZXNfaWQgPT09IDEgJiYgaW5kZXgua2V5Lm4gPT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgICBpZiAoIWhhc0NodW5rc0luZGV4KSB7XG4gICAgICAgIHJlbWFpbmluZ1RpbWVNUyA9IHN0cmVhbS50aW1lb3V0Q29udGV4dD8uZ2V0UmVtYWluaW5nVGltZU1TT3JUaHJvdyhgVXBsb2FkIHRpbWVkIG91dCBhZnRlciAke3N0cmVhbS50aW1lb3V0Q29udGV4dD8udGltZW91dE1TfW1zYCk7XG4gICAgICAgIGF3YWl0IHN0cmVhbS5jaHVua3MuY3JlYXRlSW5kZXgoaW5kZXgsIHtcbiAgICAgICAgICAgIC4uLnN0cmVhbS53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cnVlLFxuICAgICAgICAgICAgdW5pcXVlOiB0cnVlLFxuICAgICAgICAgICAgdGltZW91dE1TOiByZW1haW5pbmdUaW1lTVNcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2hlY2tEb25lKHN0cmVhbSwgY2FsbGJhY2spIHtcbiAgICBpZiAoc3RyZWFtLmRvbmUpIHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3MubmV4dFRpY2soY2FsbGJhY2spO1xuICAgIH1cbiAgICBpZiAoc3RyZWFtLnN0YXRlLnN0cmVhbUVuZCAmJiBzdHJlYW0uc3RhdGUub3V0c3RhbmRpbmdSZXF1ZXN0cyA9PT0gMCAmJiAhc3RyZWFtLnN0YXRlLmVycm9yZWQpIHtcbiAgICAgICAgLy8gU2V0IGRvbmUgc28gd2UgZG8gbm90IHRyaWdnZXIgZHVwbGljYXRlIGNyZWF0ZUZpbGVzRG9jXG4gICAgICAgIHN0cmVhbS5kb25lID0gdHJ1ZTtcbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGZpbGVzIGRvY1xuICAgICAgICBjb25zdCBncmlkRlNGaWxlID0gY3JlYXRlRmlsZXNEb2Moc3RyZWFtLmlkLCBzdHJlYW0ubGVuZ3RoLCBzdHJlYW0uY2h1bmtTaXplQnl0ZXMsIHN0cmVhbS5maWxlbmFtZSwgc3RyZWFtLm9wdGlvbnMuY29udGVudFR5cGUsIHN0cmVhbS5vcHRpb25zLmFsaWFzZXMsIHN0cmVhbS5vcHRpb25zLm1ldGFkYXRhKTtcbiAgICAgICAgaWYgKGlzQWJvcnRlZChzdHJlYW0sIGNhbGxiYWNrKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ1RpbWVNUyA9IHN0cmVhbS50aW1lb3V0Q29udGV4dD8ucmVtYWluaW5nVGltZU1TO1xuICAgICAgICBpZiAocmVtYWluaW5nVGltZU1TICE9IG51bGwgJiYgcmVtYWluaW5nVGltZU1TIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihzdHJlYW0sIG5ldyBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKGBVcGxvYWQgdGltZWQgb3V0IGFmdGVyICR7c3RyZWFtLnRpbWVvdXRDb250ZXh0Py50aW1lb3V0TVN9bXNgKSwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5maWxlc1xuICAgICAgICAgICAgLmluc2VydE9uZShncmlkRlNGaWxlLCB7IHdyaXRlQ29uY2Vybjogc3RyZWFtLndyaXRlQ29uY2VybiwgdGltZW91dE1TOiByZW1haW5pbmdUaW1lTVMgfSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHN0cmVhbS5ncmlkRlNGaWxlID0gZ3JpZEZTRmlsZTtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihzdHJlYW0sIGVycm9yLCBjYWxsYmFjayk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHByb2Nlc3MubmV4dFRpY2soY2FsbGJhY2spO1xufVxuYXN5bmMgZnVuY3Rpb24gY2hlY2tJbmRleGVzKHN0cmVhbSkge1xuICAgIGxldCByZW1haW5pbmdUaW1lTVMgPSBzdHJlYW0udGltZW91dENvbnRleHQ/LmdldFJlbWFpbmluZ1RpbWVNU09yVGhyb3coYFVwbG9hZCB0aW1lZCBvdXQgYWZ0ZXIgJHtzdHJlYW0udGltZW91dENvbnRleHQ/LnRpbWVvdXRNU31tc2ApO1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IHN0cmVhbS5maWxlcy5maW5kT25lKHt9LCB7XG4gICAgICAgIHByb2plY3Rpb246IHsgX2lkOiAxIH0sXG4gICAgICAgIHRpbWVvdXRNUzogcmVtYWluaW5nVGltZU1TXG4gICAgfSk7XG4gICAgaWYgKGRvYyAhPSBudWxsKSB7XG4gICAgICAgIC8vIElmIGF0IGxlYXN0IG9uZSBkb2N1bWVudCBleGlzdHMgYXNzdW1lIHRoZSBjb2xsZWN0aW9uIGhhcyB0aGUgcmVxdWlyZWQgaW5kZXhcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpbmRleCA9IHsgZmlsZW5hbWU6IDEsIHVwbG9hZERhdGU6IDEgfTtcbiAgICBsZXQgaW5kZXhlcztcbiAgICByZW1haW5pbmdUaW1lTVMgPSBzdHJlYW0udGltZW91dENvbnRleHQ/LmdldFJlbWFpbmluZ1RpbWVNU09yVGhyb3coYFVwbG9hZCB0aW1lZCBvdXQgYWZ0ZXIgJHtzdHJlYW0udGltZW91dENvbnRleHQ/LnRpbWVvdXRNU31tc2ApO1xuICAgIGNvbnN0IGxpc3RJbmRleGVzT3B0aW9ucyA9IHtcbiAgICAgICAgdGltZW91dE1vZGU6IHJlbWFpbmluZ1RpbWVNUyAhPSBudWxsID8gYWJzdHJhY3RfY3Vyc29yXzEuQ3Vyc29yVGltZW91dE1vZGUuTElGRVRJTUUgOiB1bmRlZmluZWQsXG4gICAgICAgIHRpbWVvdXRNUzogcmVtYWluaW5nVGltZU1TXG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgICBpbmRleGVzID0gYXdhaXQgc3RyZWFtLmZpbGVzLmxpc3RJbmRleGVzKGxpc3RJbmRleGVzT3B0aW9ucykudG9BcnJheSgpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmIGVycm9yLmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5OYW1lc3BhY2VOb3RGb3VuZCkge1xuICAgICAgICAgICAgaW5kZXhlcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgaGFzRmlsZUluZGV4ID0gISFpbmRleGVzLmZpbmQoaW5kZXggPT4ge1xuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoaW5kZXgua2V5KTtcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoID09PSAyICYmIGluZGV4LmtleS5maWxlbmFtZSA9PT0gMSAmJiBpbmRleC5rZXkudXBsb2FkRGF0ZSA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICAgIGlmICghaGFzRmlsZUluZGV4KSB7XG4gICAgICAgIHJlbWFpbmluZ1RpbWVNUyA9IHN0cmVhbS50aW1lb3V0Q29udGV4dD8uZ2V0UmVtYWluaW5nVGltZU1TT3JUaHJvdyhgVXBsb2FkIHRpbWVkIG91dCBhZnRlciAke3N0cmVhbS50aW1lb3V0Q29udGV4dD8udGltZW91dE1TfW1zYCk7XG4gICAgICAgIGF3YWl0IHN0cmVhbS5maWxlcy5jcmVhdGVJbmRleChpbmRleCwgeyBiYWNrZ3JvdW5kOiBmYWxzZSwgdGltZW91dE1TOiByZW1haW5pbmdUaW1lTVMgfSk7XG4gICAgfVxuICAgIGF3YWl0IGNoZWNrQ2h1bmtzSW5kZXgoc3RyZWFtKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUZpbGVzRG9jKF9pZCwgbGVuZ3RoLCBjaHVua1NpemUsIGZpbGVuYW1lLCBjb250ZW50VHlwZSwgYWxpYXNlcywgbWV0YWRhdGEpIHtcbiAgICBjb25zdCByZXQgPSB7XG4gICAgICAgIF9pZCxcbiAgICAgICAgbGVuZ3RoLFxuICAgICAgICBjaHVua1NpemUsXG4gICAgICAgIHVwbG9hZERhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIGZpbGVuYW1lXG4gICAgfTtcbiAgICBpZiAoY29udGVudFR5cGUpIHtcbiAgICAgICAgcmV0LmNvbnRlbnRUeXBlID0gY29udGVudFR5cGU7XG4gICAgfVxuICAgIGlmIChhbGlhc2VzKSB7XG4gICAgICAgIHJldC5hbGlhc2VzID0gYWxpYXNlcztcbiAgICB9XG4gICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgIHJldC5tZXRhZGF0YSA9IG1ldGFkYXRhO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZnVuY3Rpb24gZG9Xcml0ZShzdHJlYW0sIGNodW5rLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgICBpZiAoaXNBYm9ydGVkKHN0cmVhbSwgY2FsbGJhY2spKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaW5wdXRCdWYgPSBCdWZmZXIuaXNCdWZmZXIoY2h1bmspID8gY2h1bmsgOiBCdWZmZXIuZnJvbShjaHVuaywgZW5jb2RpbmcpO1xuICAgIHN0cmVhbS5sZW5ndGggKz0gaW5wdXRCdWYubGVuZ3RoO1xuICAgIC8vIElucHV0IGlzIHNtYWxsIGVub3VnaCB0byBmaXQgaW4gb3VyIGJ1ZmZlclxuICAgIGlmIChzdHJlYW0ucG9zICsgaW5wdXRCdWYubGVuZ3RoIDwgc3RyZWFtLmNodW5rU2l6ZUJ5dGVzKSB7XG4gICAgICAgIGlucHV0QnVmLmNvcHkoc3RyZWFtLmJ1ZlRvU3RvcmUsIHN0cmVhbS5wb3MpO1xuICAgICAgICBzdHJlYW0ucG9zICs9IGlucHV0QnVmLmxlbmd0aDtcbiAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhjYWxsYmFjayk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gT3RoZXJ3aXNlLCBidWZmZXIgaXMgdG9vIGJpZyBmb3IgY3VycmVudCBjaHVuaywgc28gd2UgbmVlZCB0byBmbHVzaFxuICAgIC8vIHRvIE1vbmdvREIuXG4gICAgbGV0IGlucHV0QnVmUmVtYWluaW5nID0gaW5wdXRCdWYubGVuZ3RoO1xuICAgIGxldCBzcGFjZVJlbWFpbmluZyA9IHN0cmVhbS5jaHVua1NpemVCeXRlcyAtIHN0cmVhbS5wb3M7XG4gICAgbGV0IG51bVRvQ29weSA9IE1hdGgubWluKHNwYWNlUmVtYWluaW5nLCBpbnB1dEJ1Zi5sZW5ndGgpO1xuICAgIGxldCBvdXRzdGFuZGluZ1JlcXVlc3RzID0gMDtcbiAgICB3aGlsZSAoaW5wdXRCdWZSZW1haW5pbmcgPiAwKSB7XG4gICAgICAgIGNvbnN0IGlucHV0QnVmUG9zID0gaW5wdXRCdWYubGVuZ3RoIC0gaW5wdXRCdWZSZW1haW5pbmc7XG4gICAgICAgIGlucHV0QnVmLmNvcHkoc3RyZWFtLmJ1ZlRvU3RvcmUsIHN0cmVhbS5wb3MsIGlucHV0QnVmUG9zLCBpbnB1dEJ1ZlBvcyArIG51bVRvQ29weSk7XG4gICAgICAgIHN0cmVhbS5wb3MgKz0gbnVtVG9Db3B5O1xuICAgICAgICBzcGFjZVJlbWFpbmluZyAtPSBudW1Ub0NvcHk7XG4gICAgICAgIGxldCBkb2M7XG4gICAgICAgIGlmIChzcGFjZVJlbWFpbmluZyA9PT0gMCkge1xuICAgICAgICAgICAgZG9jID0gY3JlYXRlQ2h1bmtEb2Moc3RyZWFtLmlkLCBzdHJlYW0ubiwgQnVmZmVyLmZyb20oc3RyZWFtLmJ1ZlRvU3RvcmUpKTtcbiAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ1RpbWVNUyA9IHN0cmVhbS50aW1lb3V0Q29udGV4dD8ucmVtYWluaW5nVGltZU1TO1xuICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWVNUyAhPSBudWxsICYmIHJlbWFpbmluZ1RpbWVNUyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKHN0cmVhbSwgbmV3IGVycm9yXzEuTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IoYFVwbG9hZCB0aW1lZCBvdXQgYWZ0ZXIgJHtzdHJlYW0udGltZW91dENvbnRleHQ/LnRpbWVvdXRNU31tc2ApLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICArK3N0cmVhbS5zdGF0ZS5vdXRzdGFuZGluZ1JlcXVlc3RzO1xuICAgICAgICAgICAgKytvdXRzdGFuZGluZ1JlcXVlc3RzO1xuICAgICAgICAgICAgaWYgKGlzQWJvcnRlZChzdHJlYW0sIGNhbGxiYWNrKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0cmVhbS5jaHVua3NcbiAgICAgICAgICAgICAgICAuaW5zZXJ0T25lKGRvYywgeyB3cml0ZUNvbmNlcm46IHN0cmVhbS53cml0ZUNvbmNlcm4sIHRpbWVvdXRNUzogcmVtYWluaW5nVGltZU1TIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIC0tc3RyZWFtLnN0YXRlLm91dHN0YW5kaW5nUmVxdWVzdHM7XG4gICAgICAgICAgICAgICAgLS1vdXRzdGFuZGluZ1JlcXVlc3RzO1xuICAgICAgICAgICAgICAgIGlmICghb3V0c3RhbmRpbmdSZXF1ZXN0cykge1xuICAgICAgICAgICAgICAgICAgICBjaGVja0RvbmUoc3RyZWFtLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihzdHJlYW0sIGVycm9yLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNwYWNlUmVtYWluaW5nID0gc3RyZWFtLmNodW5rU2l6ZUJ5dGVzO1xuICAgICAgICAgICAgc3RyZWFtLnBvcyA9IDA7XG4gICAgICAgICAgICArK3N0cmVhbS5uO1xuICAgICAgICB9XG4gICAgICAgIGlucHV0QnVmUmVtYWluaW5nIC09IG51bVRvQ29weTtcbiAgICAgICAgbnVtVG9Db3B5ID0gTWF0aC5taW4oc3BhY2VSZW1haW5pbmcsIGlucHV0QnVmUmVtYWluaW5nKTtcbiAgICB9XG59XG5mdW5jdGlvbiB3cml0ZVJlbW5hbnQoc3RyZWFtLCBjYWxsYmFjaykge1xuICAgIC8vIEJ1ZmZlciBpcyBlbXB0eSwgc28gZG9uJ3QgYm90aGVyIHRvIGluc2VydFxuICAgIGlmIChzdHJlYW0ucG9zID09PSAwKSB7XG4gICAgICAgIHJldHVybiBjaGVja0RvbmUoc3RyZWFtLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIC8vIENyZWF0ZSBhIG5ldyBidWZmZXIgdG8gbWFrZSBzdXJlIHRoZSBidWZmZXIgaXNuJ3QgYmlnZ2VyIHRoYW4gaXQgbmVlZHNcbiAgICAvLyB0byBiZS5cbiAgICBjb25zdCByZW1uYW50ID0gQnVmZmVyLmFsbG9jKHN0cmVhbS5wb3MpO1xuICAgIHN0cmVhbS5idWZUb1N0b3JlLmNvcHkocmVtbmFudCwgMCwgMCwgc3RyZWFtLnBvcyk7XG4gICAgY29uc3QgZG9jID0gY3JlYXRlQ2h1bmtEb2Moc3RyZWFtLmlkLCBzdHJlYW0ubiwgcmVtbmFudCk7XG4gICAgLy8gSWYgdGhlIHN0cmVhbSB3YXMgYWJvcnRlZCwgZG8gbm90IHdyaXRlIHJlbW5hbnRcbiAgICBpZiAoaXNBYm9ydGVkKHN0cmVhbSwgY2FsbGJhY2spKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVtYWluaW5nVGltZU1TID0gc3RyZWFtLnRpbWVvdXRDb250ZXh0Py5yZW1haW5pbmdUaW1lTVM7XG4gICAgaWYgKHJlbWFpbmluZ1RpbWVNUyAhPSBudWxsICYmIHJlbWFpbmluZ1RpbWVNUyA8PSAwKSB7XG4gICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihzdHJlYW0sIG5ldyBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKGBVcGxvYWQgdGltZWQgb3V0IGFmdGVyICR7c3RyZWFtLnRpbWVvdXRDb250ZXh0Py50aW1lb3V0TVN9bXNgKSwgY2FsbGJhY2spO1xuICAgIH1cbiAgICArK3N0cmVhbS5zdGF0ZS5vdXRzdGFuZGluZ1JlcXVlc3RzO1xuICAgIHN0cmVhbS5jaHVua3NcbiAgICAgICAgLmluc2VydE9uZShkb2MsIHsgd3JpdGVDb25jZXJuOiBzdHJlYW0ud3JpdGVDb25jZXJuLCB0aW1lb3V0TVM6IHJlbWFpbmluZ1RpbWVNUyB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIC0tc3RyZWFtLnN0YXRlLm91dHN0YW5kaW5nUmVxdWVzdHM7XG4gICAgICAgIGNoZWNrRG9uZShzdHJlYW0sIGNhbGxiYWNrKTtcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihzdHJlYW0sIGVycm9yLCBjYWxsYmFjayk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBpc0Fib3J0ZWQoc3RyZWFtLCBjYWxsYmFjaykge1xuICAgIGlmIChzdHJlYW0uc3RhdGUuYWJvcnRlZCkge1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGNhbGxiYWNrLCBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdTdHJlYW0gaGFzIGJlZW4gYWJvcnRlZCcpKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVwbG9hZC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/upload.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/index.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/index.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoServerError = exports.MongoServerClosedError = exports.MongoRuntimeError = exports.MongoParseError = exports.MongoOperationTimeoutError = exports.MongoOIDCError = exports.MongoNotConnectedError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoKerberosError = exports.MongoInvalidArgumentError = exports.MongoGridFSStreamError = exports.MongoGridFSChunkError = exports.MongoGCPError = exports.MongoExpiredSessionError = exports.MongoError = exports.MongoDriverError = exports.MongoDecompressionError = exports.MongoCursorInUseError = exports.MongoCursorExhaustedError = exports.MongoCompatibilityError = exports.MongoClientBulkWriteExecutionError = exports.MongoClientBulkWriteError = exports.MongoClientBulkWriteCursorError = exports.MongoChangeStreamError = exports.MongoBatchReExecutionError = exports.MongoAzureError = exports.MongoAWSError = exports.MongoAPIError = exports.ChangeStreamCursor = exports.ClientEncryption = exports.MongoBulkWriteError = exports.UUID = exports.Timestamp = exports.ObjectId = exports.MinKey = exports.MaxKey = exports.Long = exports.Int32 = exports.Double = exports.Decimal128 = exports.DBRef = exports.Code = exports.BSONType = exports.BSONSymbol = exports.BSONRegExp = exports.Binary = exports.BSON = void 0;\nexports.CommandStartedEvent = exports.CommandFailedEvent = exports.WriteConcern = exports.ReadPreference = exports.ReadConcern = exports.TopologyType = exports.ServerType = exports.ReadPreferenceMode = exports.ReadConcernLevel = exports.ProfilingLevel = exports.ReturnDocument = exports.SeverityLevel = exports.MongoLoggableComponent = exports.ServerApiVersion = exports.ExplainVerbosity = exports.MongoErrorLabel = exports.CursorTimeoutMode = exports.CURSOR_FLAGS = exports.Compressor = exports.AuthMechanism = exports.GSSAPICanonicalizationValue = exports.AutoEncryptionLoggerLevel = exports.BatchType = exports.UnorderedBulkOperation = exports.OrderedBulkOperation = exports.MongoClient = exports.ListIndexesCursor = exports.ListCollectionsCursor = exports.GridFSBucketWriteStream = exports.GridFSBucketReadStream = exports.GridFSBucket = exports.FindCursor = exports.ExplainableCursor = exports.Db = exports.Collection = exports.ClientSession = exports.ChangeStream = exports.CancellationToken = exports.AggregationCursor = exports.Admin = exports.AbstractCursor = exports.configureExplicitResourceManagement = exports.MongoWriteConcernError = exports.MongoUnexpectedServerResponseError = exports.MongoTransactionError = exports.MongoTopologyClosedError = exports.MongoTailableCursorError = exports.MongoSystemError = exports.MongoStalePrimaryError = exports.MongoServerSelectionError = void 0;\nexports.MongoClientAuthProviders = exports.MongoCryptKMSRequestNetworkTimeoutError = exports.MongoCryptInvalidArgumentError = exports.MongoCryptError = exports.MongoCryptCreateEncryptedCollectionError = exports.MongoCryptCreateDataKeyError = exports.MongoCryptAzureKMSRequestError = exports.SrvPollingEvent = exports.WaitingForSuitableServerEvent = exports.ServerSelectionSucceededEvent = exports.ServerSelectionStartedEvent = exports.ServerSelectionFailedEvent = exports.ServerSelectionEvent = exports.TopologyOpeningEvent = exports.TopologyDescriptionChangedEvent = exports.TopologyClosedEvent = exports.ServerOpeningEvent = exports.ServerHeartbeatSucceededEvent = exports.ServerHeartbeatStartedEvent = exports.ServerHeartbeatFailedEvent = exports.ServerDescriptionChangedEvent = exports.ServerClosedEvent = exports.ConnectionReadyEvent = exports.ConnectionPoolReadyEvent = exports.ConnectionPoolMonitoringEvent = exports.ConnectionPoolCreatedEvent = exports.ConnectionPoolClosedEvent = exports.ConnectionPoolClearedEvent = exports.ConnectionCreatedEvent = exports.ConnectionClosedEvent = exports.ConnectionCheckOutStartedEvent = exports.ConnectionCheckOutFailedEvent = exports.ConnectionCheckedOutEvent = exports.ConnectionCheckedInEvent = exports.CommandSucceededEvent = void 0;\nconst admin_1 = __webpack_require__(/*! ./admin */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/admin.js\");\nObject.defineProperty(exports, \"Admin\", ({ enumerable: true, get: function () { return admin_1.Admin; } }));\nconst ordered_1 = __webpack_require__(/*! ./bulk/ordered */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/ordered.js\");\nObject.defineProperty(exports, \"OrderedBulkOperation\", ({ enumerable: true, get: function () { return ordered_1.OrderedBulkOperation; } }));\nconst unordered_1 = __webpack_require__(/*! ./bulk/unordered */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/unordered.js\");\nObject.defineProperty(exports, \"UnorderedBulkOperation\", ({ enumerable: true, get: function () { return unordered_1.UnorderedBulkOperation; } }));\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\");\nObject.defineProperty(exports, \"ChangeStream\", ({ enumerable: true, get: function () { return change_stream_1.ChangeStream; } }));\nconst collection_1 = __webpack_require__(/*! ./collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\");\nObject.defineProperty(exports, \"Collection\", ({ enumerable: true, get: function () { return collection_1.Collection; } }));\nconst abstract_cursor_1 = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nObject.defineProperty(exports, \"AbstractCursor\", ({ enumerable: true, get: function () { return abstract_cursor_1.AbstractCursor; } }));\nconst aggregation_cursor_1 = __webpack_require__(/*! ./cursor/aggregation_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/aggregation_cursor.js\");\nObject.defineProperty(exports, \"AggregationCursor\", ({ enumerable: true, get: function () { return aggregation_cursor_1.AggregationCursor; } }));\nconst find_cursor_1 = __webpack_require__(/*! ./cursor/find_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/find_cursor.js\");\nObject.defineProperty(exports, \"FindCursor\", ({ enumerable: true, get: function () { return find_cursor_1.FindCursor; } }));\nconst list_collections_cursor_1 = __webpack_require__(/*! ./cursor/list_collections_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_collections_cursor.js\");\nObject.defineProperty(exports, \"ListCollectionsCursor\", ({ enumerable: true, get: function () { return list_collections_cursor_1.ListCollectionsCursor; } }));\nconst list_indexes_cursor_1 = __webpack_require__(/*! ./cursor/list_indexes_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/list_indexes_cursor.js\");\nObject.defineProperty(exports, \"ListIndexesCursor\", ({ enumerable: true, get: function () { return list_indexes_cursor_1.ListIndexesCursor; } }));\nconst db_1 = __webpack_require__(/*! ./db */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/db.js\");\nObject.defineProperty(exports, \"Db\", ({ enumerable: true, get: function () { return db_1.Db; } }));\nconst explain_1 = __webpack_require__(/*! ./explain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\");\nObject.defineProperty(exports, \"ExplainableCursor\", ({ enumerable: true, get: function () { return explain_1.ExplainableCursor; } }));\nconst gridfs_1 = __webpack_require__(/*! ./gridfs */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/index.js\");\nObject.defineProperty(exports, \"GridFSBucket\", ({ enumerable: true, get: function () { return gridfs_1.GridFSBucket; } }));\nconst download_1 = __webpack_require__(/*! ./gridfs/download */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/download.js\");\nObject.defineProperty(exports, \"GridFSBucketReadStream\", ({ enumerable: true, get: function () { return download_1.GridFSBucketReadStream; } }));\nconst upload_1 = __webpack_require__(/*! ./gridfs/upload */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/gridfs/upload.js\");\nObject.defineProperty(exports, \"GridFSBucketWriteStream\", ({ enumerable: true, get: function () { return upload_1.GridFSBucketWriteStream; } }));\nconst mongo_client_1 = __webpack_require__(/*! ./mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\nObject.defineProperty(exports, \"MongoClient\", ({ enumerable: true, get: function () { return mongo_client_1.MongoClient; } }));\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nObject.defineProperty(exports, \"CancellationToken\", ({ enumerable: true, get: function () { return mongo_types_1.CancellationToken; } }));\nconst sessions_1 = __webpack_require__(/*! ./sessions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js\");\nObject.defineProperty(exports, \"ClientSession\", ({ enumerable: true, get: function () { return sessions_1.ClientSession; } }));\n/** @public */\nvar bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nObject.defineProperty(exports, \"BSON\", ({ enumerable: true, get: function () { return bson_1.BSON; } }));\nvar bson_2 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nObject.defineProperty(exports, \"Binary\", ({ enumerable: true, get: function () { return bson_2.Binary; } }));\nObject.defineProperty(exports, \"BSONRegExp\", ({ enumerable: true, get: function () { return bson_2.BSONRegExp; } }));\nObject.defineProperty(exports, \"BSONSymbol\", ({ enumerable: true, get: function () { return bson_2.BSONSymbol; } }));\nObject.defineProperty(exports, \"BSONType\", ({ enumerable: true, get: function () { return bson_2.BSONType; } }));\nObject.defineProperty(exports, \"Code\", ({ enumerable: true, get: function () { return bson_2.Code; } }));\nObject.defineProperty(exports, \"DBRef\", ({ enumerable: true, get: function () { return bson_2.DBRef; } }));\nObject.defineProperty(exports, \"Decimal128\", ({ enumerable: true, get: function () { return bson_2.Decimal128; } }));\nObject.defineProperty(exports, \"Double\", ({ enumerable: true, get: function () { return bson_2.Double; } }));\nObject.defineProperty(exports, \"Int32\", ({ enumerable: true, get: function () { return bson_2.Int32; } }));\nObject.defineProperty(exports, \"Long\", ({ enumerable: true, get: function () { return bson_2.Long; } }));\nObject.defineProperty(exports, \"MaxKey\", ({ enumerable: true, get: function () { return bson_2.MaxKey; } }));\nObject.defineProperty(exports, \"MinKey\", ({ enumerable: true, get: function () { return bson_2.MinKey; } }));\nObject.defineProperty(exports, \"ObjectId\", ({ enumerable: true, get: function () { return bson_2.ObjectId; } }));\nObject.defineProperty(exports, \"Timestamp\", ({ enumerable: true, get: function () { return bson_2.Timestamp; } }));\nObject.defineProperty(exports, \"UUID\", ({ enumerable: true, get: function () { return bson_2.UUID; } }));\nvar common_1 = __webpack_require__(/*! ./bulk/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js\");\nObject.defineProperty(exports, \"MongoBulkWriteError\", ({ enumerable: true, get: function () { return common_1.MongoBulkWriteError; } }));\nvar client_encryption_1 = __webpack_require__(/*! ./client-side-encryption/client_encryption */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/client_encryption.js\");\nObject.defineProperty(exports, \"ClientEncryption\", ({ enumerable: true, get: function () { return client_encryption_1.ClientEncryption; } }));\nvar change_stream_cursor_1 = __webpack_require__(/*! ./cursor/change_stream_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/change_stream_cursor.js\");\nObject.defineProperty(exports, \"ChangeStreamCursor\", ({ enumerable: true, get: function () { return change_stream_cursor_1.ChangeStreamCursor; } }));\nvar error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nObject.defineProperty(exports, \"MongoAPIError\", ({ enumerable: true, get: function () { return error_1.MongoAPIError; } }));\nObject.defineProperty(exports, \"MongoAWSError\", ({ enumerable: true, get: function () { return error_1.MongoAWSError; } }));\nObject.defineProperty(exports, \"MongoAzureError\", ({ enumerable: true, get: function () { return error_1.MongoAzureError; } }));\nObject.defineProperty(exports, \"MongoBatchReExecutionError\", ({ enumerable: true, get: function () { return error_1.MongoBatchReExecutionError; } }));\nObject.defineProperty(exports, \"MongoChangeStreamError\", ({ enumerable: true, get: function () { return error_1.MongoChangeStreamError; } }));\nObject.defineProperty(exports, \"MongoClientBulkWriteCursorError\", ({ enumerable: true, get: function () { return error_1.MongoClientBulkWriteCursorError; } }));\nObject.defineProperty(exports, \"MongoClientBulkWriteError\", ({ enumerable: true, get: function () { return error_1.MongoClientBulkWriteError; } }));\nObject.defineProperty(exports, \"MongoClientBulkWriteExecutionError\", ({ enumerable: true, get: function () { return error_1.MongoClientBulkWriteExecutionError; } }));\nObject.defineProperty(exports, \"MongoCompatibilityError\", ({ enumerable: true, get: function () { return error_1.MongoCompatibilityError; } }));\nObject.defineProperty(exports, \"MongoCursorExhaustedError\", ({ enumerable: true, get: function () { return error_1.MongoCursorExhaustedError; } }));\nObject.defineProperty(exports, \"MongoCursorInUseError\", ({ enumerable: true, get: function () { return error_1.MongoCursorInUseError; } }));\nObject.defineProperty(exports, \"MongoDecompressionError\", ({ enumerable: true, get: function () { return error_1.MongoDecompressionError; } }));\nObject.defineProperty(exports, \"MongoDriverError\", ({ enumerable: true, get: function () { return error_1.MongoDriverError; } }));\nObject.defineProperty(exports, \"MongoError\", ({ enumerable: true, get: function () { return error_1.MongoError; } }));\nObject.defineProperty(exports, \"MongoExpiredSessionError\", ({ enumerable: true, get: function () { return error_1.MongoExpiredSessionError; } }));\nObject.defineProperty(exports, \"MongoGCPError\", ({ enumerable: true, get: function () { return error_1.MongoGCPError; } }));\nObject.defineProperty(exports, \"MongoGridFSChunkError\", ({ enumerable: true, get: function () { return error_1.MongoGridFSChunkError; } }));\nObject.defineProperty(exports, \"MongoGridFSStreamError\", ({ enumerable: true, get: function () { return error_1.MongoGridFSStreamError; } }));\nObject.defineProperty(exports, \"MongoInvalidArgumentError\", ({ enumerable: true, get: function () { return error_1.MongoInvalidArgumentError; } }));\nObject.defineProperty(exports, \"MongoKerberosError\", ({ enumerable: true, get: function () { return error_1.MongoKerberosError; } }));\nObject.defineProperty(exports, \"MongoMissingCredentialsError\", ({ enumerable: true, get: function () { return error_1.MongoMissingCredentialsError; } }));\nObject.defineProperty(exports, \"MongoMissingDependencyError\", ({ enumerable: true, get: function () { return error_1.MongoMissingDependencyError; } }));\nObject.defineProperty(exports, \"MongoNetworkError\", ({ enumerable: true, get: function () { return error_1.MongoNetworkError; } }));\nObject.defineProperty(exports, \"MongoNetworkTimeoutError\", ({ enumerable: true, get: function () { return error_1.MongoNetworkTimeoutError; } }));\nObject.defineProperty(exports, \"MongoNotConnectedError\", ({ enumerable: true, get: function () { return error_1.MongoNotConnectedError; } }));\nObject.defineProperty(exports, \"MongoOIDCError\", ({ enumerable: true, get: function () { return error_1.MongoOIDCError; } }));\nObject.defineProperty(exports, \"MongoOperationTimeoutError\", ({ enumerable: true, get: function () { return error_1.MongoOperationTimeoutError; } }));\nObject.defineProperty(exports, \"MongoParseError\", ({ enumerable: true, get: function () { return error_1.MongoParseError; } }));\nObject.defineProperty(exports, \"MongoRuntimeError\", ({ enumerable: true, get: function () { return error_1.MongoRuntimeError; } }));\nObject.defineProperty(exports, \"MongoServerClosedError\", ({ enumerable: true, get: function () { return error_1.MongoServerClosedError; } }));\nObject.defineProperty(exports, \"MongoServerError\", ({ enumerable: true, get: function () { return error_1.MongoServerError; } }));\nObject.defineProperty(exports, \"MongoServerSelectionError\", ({ enumerable: true, get: function () { return error_1.MongoServerSelectionError; } }));\nObject.defineProperty(exports, \"MongoStalePrimaryError\", ({ enumerable: true, get: function () { return error_1.MongoStalePrimaryError; } }));\nObject.defineProperty(exports, \"MongoSystemError\", ({ enumerable: true, get: function () { return error_1.MongoSystemError; } }));\nObject.defineProperty(exports, \"MongoTailableCursorError\", ({ enumerable: true, get: function () { return error_1.MongoTailableCursorError; } }));\nObject.defineProperty(exports, \"MongoTopologyClosedError\", ({ enumerable: true, get: function () { return error_1.MongoTopologyClosedError; } }));\nObject.defineProperty(exports, \"MongoTransactionError\", ({ enumerable: true, get: function () { return error_1.MongoTransactionError; } }));\nObject.defineProperty(exports, \"MongoUnexpectedServerResponseError\", ({ enumerable: true, get: function () { return error_1.MongoUnexpectedServerResponseError; } }));\nObject.defineProperty(exports, \"MongoWriteConcernError\", ({ enumerable: true, get: function () { return error_1.MongoWriteConcernError; } }));\nvar resource_management_1 = __webpack_require__(/*! ./resource_management */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js\");\nObject.defineProperty(exports, \"configureExplicitResourceManagement\", ({ enumerable: true, get: function () { return resource_management_1.configureExplicitResourceManagement; } }));\n// enums\nvar common_2 = __webpack_require__(/*! ./bulk/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bulk/common.js\");\nObject.defineProperty(exports, \"BatchType\", ({ enumerable: true, get: function () { return common_2.BatchType; } }));\nvar auto_encrypter_1 = __webpack_require__(/*! ./client-side-encryption/auto_encrypter */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/auto_encrypter.js\");\nObject.defineProperty(exports, \"AutoEncryptionLoggerLevel\", ({ enumerable: true, get: function () { return auto_encrypter_1.AutoEncryptionLoggerLevel; } }));\nvar gssapi_1 = __webpack_require__(/*! ./cmap/auth/gssapi */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/gssapi.js\");\nObject.defineProperty(exports, \"GSSAPICanonicalizationValue\", ({ enumerable: true, get: function () { return gssapi_1.GSSAPICanonicalizationValue; } }));\nvar providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nObject.defineProperty(exports, \"AuthMechanism\", ({ enumerable: true, get: function () { return providers_1.AuthMechanism; } }));\nvar compression_1 = __webpack_require__(/*! ./cmap/wire_protocol/compression */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/compression.js\");\nObject.defineProperty(exports, \"Compressor\", ({ enumerable: true, get: function () { return compression_1.Compressor; } }));\nvar abstract_cursor_2 = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nObject.defineProperty(exports, \"CURSOR_FLAGS\", ({ enumerable: true, get: function () { return abstract_cursor_2.CURSOR_FLAGS; } }));\nObject.defineProperty(exports, \"CursorTimeoutMode\", ({ enumerable: true, get: function () { return abstract_cursor_2.CursorTimeoutMode; } }));\nvar error_2 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nObject.defineProperty(exports, \"MongoErrorLabel\", ({ enumerable: true, get: function () { return error_2.MongoErrorLabel; } }));\nvar explain_2 = __webpack_require__(/*! ./explain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\");\nObject.defineProperty(exports, \"ExplainVerbosity\", ({ enumerable: true, get: function () { return explain_2.ExplainVerbosity; } }));\nvar mongo_client_2 = __webpack_require__(/*! ./mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\nObject.defineProperty(exports, \"ServerApiVersion\", ({ enumerable: true, get: function () { return mongo_client_2.ServerApiVersion; } }));\nvar mongo_logger_1 = __webpack_require__(/*! ./mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nObject.defineProperty(exports, \"MongoLoggableComponent\", ({ enumerable: true, get: function () { return mongo_logger_1.MongoLoggableComponent; } }));\nObject.defineProperty(exports, \"SeverityLevel\", ({ enumerable: true, get: function () { return mongo_logger_1.SeverityLevel; } }));\nvar find_and_modify_1 = __webpack_require__(/*! ./operations/find_and_modify */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find_and_modify.js\");\nObject.defineProperty(exports, \"ReturnDocument\", ({ enumerable: true, get: function () { return find_and_modify_1.ReturnDocument; } }));\nvar set_profiling_level_1 = __webpack_require__(/*! ./operations/set_profiling_level */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/set_profiling_level.js\");\nObject.defineProperty(exports, \"ProfilingLevel\", ({ enumerable: true, get: function () { return set_profiling_level_1.ProfilingLevel; } }));\nvar read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nObject.defineProperty(exports, \"ReadConcernLevel\", ({ enumerable: true, get: function () { return read_concern_1.ReadConcernLevel; } }));\nvar read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nObject.defineProperty(exports, \"ReadPreferenceMode\", ({ enumerable: true, get: function () { return read_preference_1.ReadPreferenceMode; } }));\nvar common_3 = __webpack_require__(/*! ./sdam/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nObject.defineProperty(exports, \"ServerType\", ({ enumerable: true, get: function () { return common_3.ServerType; } }));\nObject.defineProperty(exports, \"TopologyType\", ({ enumerable: true, get: function () { return common_3.TopologyType; } }));\nvar read_concern_2 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nObject.defineProperty(exports, \"ReadConcern\", ({ enumerable: true, get: function () { return read_concern_2.ReadConcern; } }));\nvar read_preference_2 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nObject.defineProperty(exports, \"ReadPreference\", ({ enumerable: true, get: function () { return read_preference_2.ReadPreference; } }));\nvar write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nObject.defineProperty(exports, \"WriteConcern\", ({ enumerable: true, get: function () { return write_concern_1.WriteConcern; } }));\n// events\nvar command_monitoring_events_1 = __webpack_require__(/*! ./cmap/command_monitoring_events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/command_monitoring_events.js\");\nObject.defineProperty(exports, \"CommandFailedEvent\", ({ enumerable: true, get: function () { return command_monitoring_events_1.CommandFailedEvent; } }));\nObject.defineProperty(exports, \"CommandStartedEvent\", ({ enumerable: true, get: function () { return command_monitoring_events_1.CommandStartedEvent; } }));\nObject.defineProperty(exports, \"CommandSucceededEvent\", ({ enumerable: true, get: function () { return command_monitoring_events_1.CommandSucceededEvent; } }));\nvar connection_pool_events_1 = __webpack_require__(/*! ./cmap/connection_pool_events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool_events.js\");\nObject.defineProperty(exports, \"ConnectionCheckedInEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckedInEvent; } }));\nObject.defineProperty(exports, \"ConnectionCheckedOutEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckedOutEvent; } }));\nObject.defineProperty(exports, \"ConnectionCheckOutFailedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckOutFailedEvent; } }));\nObject.defineProperty(exports, \"ConnectionCheckOutStartedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCheckOutStartedEvent; } }));\nObject.defineProperty(exports, \"ConnectionClosedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionClosedEvent; } }));\nObject.defineProperty(exports, \"ConnectionCreatedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionCreatedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolClearedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolClearedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolClosedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolClosedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolCreatedEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolCreatedEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolMonitoringEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolMonitoringEvent; } }));\nObject.defineProperty(exports, \"ConnectionPoolReadyEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionPoolReadyEvent; } }));\nObject.defineProperty(exports, \"ConnectionReadyEvent\", ({ enumerable: true, get: function () { return connection_pool_events_1.ConnectionReadyEvent; } }));\nvar events_1 = __webpack_require__(/*! ./sdam/events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/events.js\");\nObject.defineProperty(exports, \"ServerClosedEvent\", ({ enumerable: true, get: function () { return events_1.ServerClosedEvent; } }));\nObject.defineProperty(exports, \"ServerDescriptionChangedEvent\", ({ enumerable: true, get: function () { return events_1.ServerDescriptionChangedEvent; } }));\nObject.defineProperty(exports, \"ServerHeartbeatFailedEvent\", ({ enumerable: true, get: function () { return events_1.ServerHeartbeatFailedEvent; } }));\nObject.defineProperty(exports, \"ServerHeartbeatStartedEvent\", ({ enumerable: true, get: function () { return events_1.ServerHeartbeatStartedEvent; } }));\nObject.defineProperty(exports, \"ServerHeartbeatSucceededEvent\", ({ enumerable: true, get: function () { return events_1.ServerHeartbeatSucceededEvent; } }));\nObject.defineProperty(exports, \"ServerOpeningEvent\", ({ enumerable: true, get: function () { return events_1.ServerOpeningEvent; } }));\nObject.defineProperty(exports, \"TopologyClosedEvent\", ({ enumerable: true, get: function () { return events_1.TopologyClosedEvent; } }));\nObject.defineProperty(exports, \"TopologyDescriptionChangedEvent\", ({ enumerable: true, get: function () { return events_1.TopologyDescriptionChangedEvent; } }));\nObject.defineProperty(exports, \"TopologyOpeningEvent\", ({ enumerable: true, get: function () { return events_1.TopologyOpeningEvent; } }));\nvar server_selection_events_1 = __webpack_require__(/*! ./sdam/server_selection_events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection_events.js\");\nObject.defineProperty(exports, \"ServerSelectionEvent\", ({ enumerable: true, get: function () { return server_selection_events_1.ServerSelectionEvent; } }));\nObject.defineProperty(exports, \"ServerSelectionFailedEvent\", ({ enumerable: true, get: function () { return server_selection_events_1.ServerSelectionFailedEvent; } }));\nObject.defineProperty(exports, \"ServerSelectionStartedEvent\", ({ enumerable: true, get: function () { return server_selection_events_1.ServerSelectionStartedEvent; } }));\nObject.defineProperty(exports, \"ServerSelectionSucceededEvent\", ({ enumerable: true, get: function () { return server_selection_events_1.ServerSelectionSucceededEvent; } }));\nObject.defineProperty(exports, \"WaitingForSuitableServerEvent\", ({ enumerable: true, get: function () { return server_selection_events_1.WaitingForSuitableServerEvent; } }));\nvar srv_polling_1 = __webpack_require__(/*! ./sdam/srv_polling */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/srv_polling.js\");\nObject.defineProperty(exports, \"SrvPollingEvent\", ({ enumerable: true, get: function () { return srv_polling_1.SrvPollingEvent; } }));\nvar errors_1 = __webpack_require__(/*! ./client-side-encryption/errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/client-side-encryption/errors.js\");\nObject.defineProperty(exports, \"MongoCryptAzureKMSRequestError\", ({ enumerable: true, get: function () { return errors_1.MongoCryptAzureKMSRequestError; } }));\nObject.defineProperty(exports, \"MongoCryptCreateDataKeyError\", ({ enumerable: true, get: function () { return errors_1.MongoCryptCreateDataKeyError; } }));\nObject.defineProperty(exports, \"MongoCryptCreateEncryptedCollectionError\", ({ enumerable: true, get: function () { return errors_1.MongoCryptCreateEncryptedCollectionError; } }));\nObject.defineProperty(exports, \"MongoCryptError\", ({ enumerable: true, get: function () { return errors_1.MongoCryptError; } }));\nObject.defineProperty(exports, \"MongoCryptInvalidArgumentError\", ({ enumerable: true, get: function () { return errors_1.MongoCryptInvalidArgumentError; } }));\nObject.defineProperty(exports, \"MongoCryptKMSRequestNetworkTimeoutError\", ({ enumerable: true, get: function () { return errors_1.MongoCryptKMSRequestNetworkTimeoutError; } }));\nvar mongo_client_auth_providers_1 = __webpack_require__(/*! ./mongo_client_auth_providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client_auth_providers.js\");\nObject.defineProperty(exports, \"MongoClientAuthProviders\", ({ enumerable: true, get: function () { return mongo_client_auth_providers_1.MongoClientAuthProviders; } }));\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QixHQUFHLDhCQUE4QixHQUFHLHlCQUF5QixHQUFHLHVCQUF1QixHQUFHLGtDQUFrQyxHQUFHLHNCQUFzQixHQUFHLDhCQUE4QixHQUFHLGdDQUFnQyxHQUFHLHlCQUF5QixHQUFHLG1DQUFtQyxHQUFHLG9DQUFvQyxHQUFHLDBCQUEwQixHQUFHLGlDQUFpQyxHQUFHLDhCQUE4QixHQUFHLDZCQUE2QixHQUFHLHFCQUFxQixHQUFHLGdDQUFnQyxHQUFHLGtCQUFrQixHQUFHLHdCQUF3QixHQUFHLCtCQUErQixHQUFHLDZCQUE2QixHQUFHLGlDQUFpQyxHQUFHLCtCQUErQixHQUFHLDBDQUEwQyxHQUFHLGlDQUFpQyxHQUFHLHVDQUF1QyxHQUFHLDhCQUE4QixHQUFHLGtDQUFrQyxHQUFHLHVCQUF1QixHQUFHLHFCQUFxQixHQUFHLHFCQUFxQixHQUFHLDBCQUEwQixHQUFHLHdCQUF3QixHQUFHLDJCQUEyQixHQUFHLFlBQVksR0FBRyxpQkFBaUIsR0FBRyxnQkFBZ0IsR0FBRyxjQUFjLEdBQUcsY0FBYyxHQUFHLFlBQVksR0FBRyxhQUFhLEdBQUcsY0FBYyxHQUFHLGtCQUFrQixHQUFHLGFBQWEsR0FBRyxZQUFZLEdBQUcsZ0JBQWdCLEdBQUcsa0JBQWtCLEdBQUcsa0JBQWtCLEdBQUcsY0FBYyxHQUFHLFlBQVk7QUFDejBDLDJCQUEyQixHQUFHLDBCQUEwQixHQUFHLG9CQUFvQixHQUFHLHNCQUFzQixHQUFHLG1CQUFtQixHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLDBCQUEwQixHQUFHLHdCQUF3QixHQUFHLHNCQUFzQixHQUFHLHNCQUFzQixHQUFHLHFCQUFxQixHQUFHLDhCQUE4QixHQUFHLHdCQUF3QixHQUFHLHdCQUF3QixHQUFHLHVCQUF1QixHQUFHLHlCQUF5QixHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLHFCQUFxQixHQUFHLG1DQUFtQyxHQUFHLGlDQUFpQyxHQUFHLGlCQUFpQixHQUFHLDhCQUE4QixHQUFHLDRCQUE0QixHQUFHLG1CQUFtQixHQUFHLHlCQUF5QixHQUFHLDZCQUE2QixHQUFHLCtCQUErQixHQUFHLDhCQUE4QixHQUFHLG9CQUFvQixHQUFHLGtCQUFrQixHQUFHLHlCQUF5QixHQUFHLFVBQVUsR0FBRyxrQkFBa0IsR0FBRyxxQkFBcUIsR0FBRyxvQkFBb0IsR0FBRyx5QkFBeUIsR0FBRyx5QkFBeUIsR0FBRyxhQUFhLEdBQUcsc0JBQXNCLEdBQUcsMkNBQTJDLEdBQUcsOEJBQThCLEdBQUcsMENBQTBDLEdBQUcsNkJBQTZCLEdBQUcsZ0NBQWdDLEdBQUcsZ0NBQWdDLEdBQUcsd0JBQXdCLEdBQUcsOEJBQThCLEdBQUcsaUNBQWlDO0FBQzUyQyxnQ0FBZ0MsR0FBRywrQ0FBK0MsR0FBRyxzQ0FBc0MsR0FBRyx1QkFBdUIsR0FBRyxnREFBZ0QsR0FBRyxvQ0FBb0MsR0FBRyxzQ0FBc0MsR0FBRyx1QkFBdUIsR0FBRyxxQ0FBcUMsR0FBRyxxQ0FBcUMsR0FBRyxtQ0FBbUMsR0FBRyxrQ0FBa0MsR0FBRyw0QkFBNEIsR0FBRyw0QkFBNEIsR0FBRyx1Q0FBdUMsR0FBRywyQkFBMkIsR0FBRywwQkFBMEIsR0FBRyxxQ0FBcUMsR0FBRyxtQ0FBbUMsR0FBRyxrQ0FBa0MsR0FBRyxxQ0FBcUMsR0FBRyx5QkFBeUIsR0FBRyw0QkFBNEIsR0FBRyxnQ0FBZ0MsR0FBRyxxQ0FBcUMsR0FBRyxrQ0FBa0MsR0FBRyxpQ0FBaUMsR0FBRyxrQ0FBa0MsR0FBRyw4QkFBOEIsR0FBRyw2QkFBNkIsR0FBRyxzQ0FBc0MsR0FBRyxxQ0FBcUMsR0FBRyxpQ0FBaUMsR0FBRyxnQ0FBZ0MsR0FBRyw2QkFBNkI7QUFDeHZDLGdCQUFnQixtQkFBTyxDQUFDLDRGQUFTO0FBQ2pDLHlDQUF3QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUN6RyxrQkFBa0IsbUJBQU8sQ0FBQywwR0FBZ0I7QUFDMUMsd0RBQXVELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQ3pJLG9CQUFvQixtQkFBTyxDQUFDLDhHQUFrQjtBQUM5QywwREFBeUQsRUFBRSxxQ0FBcUMsOENBQThDLEVBQUM7QUFDL0ksd0JBQXdCLG1CQUFPLENBQUMsNEdBQWlCO0FBQ2pELGdEQUErQyxFQUFFLHFDQUFxQyx3Q0FBd0MsRUFBQztBQUMvSCxxQkFBcUIsbUJBQU8sQ0FBQyxzR0FBYztBQUMzQyw4Q0FBNkMsRUFBRSxxQ0FBcUMsbUNBQW1DLEVBQUM7QUFDeEgsMEJBQTBCLG1CQUFPLENBQUMsOEhBQTBCO0FBQzVELGtEQUFpRCxFQUFFLHFDQUFxQyw0Q0FBNEMsRUFBQztBQUNySSw2QkFBNkIsbUJBQU8sQ0FBQyxvSUFBNkI7QUFDbEUscURBQW9ELEVBQUUscUNBQXFDLGtEQUFrRCxFQUFDO0FBQzlJLHNCQUFzQixtQkFBTyxDQUFDLHNIQUFzQjtBQUNwRCw4Q0FBNkMsRUFBRSxxQ0FBcUMsb0NBQW9DLEVBQUM7QUFDekgsa0NBQWtDLG1CQUFPLENBQUMsOElBQWtDO0FBQzVFLHlEQUF3RCxFQUFFLHFDQUFxQywyREFBMkQsRUFBQztBQUMzSiw4QkFBOEIsbUJBQU8sQ0FBQyxzSUFBOEI7QUFDcEUscURBQW9ELEVBQUUscUNBQXFDLG1EQUFtRCxFQUFDO0FBQy9JLGFBQWEsbUJBQU8sQ0FBQyxzRkFBTTtBQUMzQixzQ0FBcUMsRUFBRSxxQ0FBcUMsbUJBQW1CLEVBQUM7QUFDaEcsa0JBQWtCLG1CQUFPLENBQUMsZ0dBQVc7QUFDckMscURBQW9ELEVBQUUscUNBQXFDLHVDQUF1QyxFQUFDO0FBQ25JLGlCQUFpQixtQkFBTyxDQUFDLG9HQUFVO0FBQ25DLGdEQUErQyxFQUFFLHFDQUFxQyxpQ0FBaUMsRUFBQztBQUN4SCxtQkFBbUIsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDOUMsMERBQXlELEVBQUUscUNBQXFDLDZDQUE2QyxFQUFDO0FBQzlJLGlCQUFpQixtQkFBTyxDQUFDLDRHQUFpQjtBQUMxQywyREFBMEQsRUFBRSxxQ0FBcUMsNENBQTRDLEVBQUM7QUFDOUksdUJBQXVCLG1CQUFPLENBQUMsMEdBQWdCO0FBQy9DLCtDQUE4QyxFQUFFLHFDQUFxQyxzQ0FBc0MsRUFBQztBQUM1SCxzQkFBc0IsbUJBQU8sQ0FBQyx3R0FBZTtBQUM3QyxxREFBb0QsRUFBRSxxQ0FBcUMsMkNBQTJDLEVBQUM7QUFDdkksbUJBQW1CLG1CQUFPLENBQUMsa0dBQVk7QUFDdkMsaURBQWdELEVBQUUscUNBQXFDLG9DQUFvQyxFQUFDO0FBQzVIO0FBQ0EsYUFBYSxtQkFBTyxDQUFDLDBGQUFRO0FBQzdCLHdDQUF1QyxFQUFFLHFDQUFxQyx1QkFBdUIsRUFBQztBQUN0RyxhQUFhLG1CQUFPLENBQUMsMEZBQVE7QUFDN0IsMENBQXlDLEVBQUUscUNBQXFDLHlCQUF5QixFQUFDO0FBQzFHLDhDQUE2QyxFQUFFLHFDQUFxQyw2QkFBNkIsRUFBQztBQUNsSCw4Q0FBNkMsRUFBRSxxQ0FBcUMsNkJBQTZCLEVBQUM7QUFDbEgsNENBQTJDLEVBQUUscUNBQXFDLDJCQUEyQixFQUFDO0FBQzlHLHdDQUF1QyxFQUFFLHFDQUFxQyx1QkFBdUIsRUFBQztBQUN0Ryx5Q0FBd0MsRUFBRSxxQ0FBcUMsd0JBQXdCLEVBQUM7QUFDeEcsOENBQTZDLEVBQUUscUNBQXFDLDZCQUE2QixFQUFDO0FBQ2xILDBDQUF5QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUMxRyx5Q0FBd0MsRUFBRSxxQ0FBcUMsd0JBQXdCLEVBQUM7QUFDeEcsd0NBQXVDLEVBQUUscUNBQXFDLHVCQUF1QixFQUFDO0FBQ3RHLDBDQUF5QyxFQUFFLHFDQUFxQyx5QkFBeUIsRUFBQztBQUMxRywwQ0FBeUMsRUFBRSxxQ0FBcUMseUJBQXlCLEVBQUM7QUFDMUcsNENBQTJDLEVBQUUscUNBQXFDLDJCQUEyQixFQUFDO0FBQzlHLDZDQUE0QyxFQUFFLHFDQUFxQyw0QkFBNEIsRUFBQztBQUNoSCx3Q0FBdUMsRUFBRSxxQ0FBcUMsdUJBQXVCLEVBQUM7QUFDdEcsZUFBZSxtQkFBTyxDQUFDLHdHQUFlO0FBQ3RDLHVEQUFzRCxFQUFFLHFDQUFxQyx3Q0FBd0MsRUFBQztBQUN0SSwwQkFBMEIsbUJBQU8sQ0FBQyxrS0FBNEM7QUFDOUUsb0RBQW1ELEVBQUUscUNBQXFDLGdEQUFnRCxFQUFDO0FBQzNJLDZCQUE2QixtQkFBTyxDQUFDLHdJQUErQjtBQUNwRSxzREFBcUQsRUFBRSxxQ0FBcUMscURBQXFELEVBQUM7QUFDbEosY0FBYyxtQkFBTyxDQUFDLDRGQUFTO0FBQy9CLGlEQUFnRCxFQUFFLHFDQUFxQyxpQ0FBaUMsRUFBQztBQUN6SCxpREFBZ0QsRUFBRSxxQ0FBcUMsaUNBQWlDLEVBQUM7QUFDekgsbURBQWtELEVBQUUscUNBQXFDLG1DQUFtQyxFQUFDO0FBQzdILDhEQUE2RCxFQUFFLHFDQUFxQyw4Q0FBOEMsRUFBQztBQUNuSiwwREFBeUQsRUFBRSxxQ0FBcUMsMENBQTBDLEVBQUM7QUFDM0ksbUVBQWtFLEVBQUUscUNBQXFDLG1EQUFtRCxFQUFDO0FBQzdKLDZEQUE0RCxFQUFFLHFDQUFxQyw2Q0FBNkMsRUFBQztBQUNqSixzRUFBcUUsRUFBRSxxQ0FBcUMsc0RBQXNELEVBQUM7QUFDbkssMkRBQTBELEVBQUUscUNBQXFDLDJDQUEyQyxFQUFDO0FBQzdJLDZEQUE0RCxFQUFFLHFDQUFxQyw2Q0FBNkMsRUFBQztBQUNqSix5REFBd0QsRUFBRSxxQ0FBcUMseUNBQXlDLEVBQUM7QUFDekksMkRBQTBELEVBQUUscUNBQXFDLDJDQUEyQyxFQUFDO0FBQzdJLG9EQUFtRCxFQUFFLHFDQUFxQyxvQ0FBb0MsRUFBQztBQUMvSCw4Q0FBNkMsRUFBRSxxQ0FBcUMsOEJBQThCLEVBQUM7QUFDbkgsNERBQTJELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQy9JLGlEQUFnRCxFQUFFLHFDQUFxQyxpQ0FBaUMsRUFBQztBQUN6SCx5REFBd0QsRUFBRSxxQ0FBcUMseUNBQXlDLEVBQUM7QUFDekksMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJLDZEQUE0RCxFQUFFLHFDQUFxQyw2Q0FBNkMsRUFBQztBQUNqSixzREFBcUQsRUFBRSxxQ0FBcUMsc0NBQXNDLEVBQUM7QUFDbkksZ0VBQStELEVBQUUscUNBQXFDLGdEQUFnRCxFQUFDO0FBQ3ZKLCtEQUE4RCxFQUFFLHFDQUFxQywrQ0FBK0MsRUFBQztBQUNySixxREFBb0QsRUFBRSxxQ0FBcUMscUNBQXFDLEVBQUM7QUFDakksNERBQTJELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQy9JLDBEQUF5RCxFQUFFLHFDQUFxQywwQ0FBMEMsRUFBQztBQUMzSSxrREFBaUQsRUFBRSxxQ0FBcUMsa0NBQWtDLEVBQUM7QUFDM0gsOERBQTZELEVBQUUscUNBQXFDLDhDQUE4QyxFQUFDO0FBQ25KLG1EQUFrRCxFQUFFLHFDQUFxQyxtQ0FBbUMsRUFBQztBQUM3SCxxREFBb0QsRUFBRSxxQ0FBcUMscUNBQXFDLEVBQUM7QUFDakksMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJLG9EQUFtRCxFQUFFLHFDQUFxQyxvQ0FBb0MsRUFBQztBQUMvSCw2REFBNEQsRUFBRSxxQ0FBcUMsNkNBQTZDLEVBQUM7QUFDakosMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJLG9EQUFtRCxFQUFFLHFDQUFxQyxvQ0FBb0MsRUFBQztBQUMvSCw0REFBMkQsRUFBRSxxQ0FBcUMsNENBQTRDLEVBQUM7QUFDL0ksNERBQTJELEVBQUUscUNBQXFDLDRDQUE0QyxFQUFDO0FBQy9JLHlEQUF3RCxFQUFFLHFDQUFxQyx5Q0FBeUMsRUFBQztBQUN6SSxzRUFBcUUsRUFBRSxxQ0FBcUMsc0RBQXNELEVBQUM7QUFDbkssMERBQXlELEVBQUUscUNBQXFDLDBDQUEwQyxFQUFDO0FBQzNJLDRCQUE0QixtQkFBTyxDQUFDLHdIQUF1QjtBQUMzRCx1RUFBc0UsRUFBRSxxQ0FBcUMscUVBQXFFLEVBQUM7QUFDbkw7QUFDQSxlQUFlLG1CQUFPLENBQUMsd0dBQWU7QUFDdEMsNkNBQTRDLEVBQUUscUNBQXFDLDhCQUE4QixFQUFDO0FBQ2xILHVCQUF1QixtQkFBTyxDQUFDLDRKQUF5QztBQUN4RSw2REFBNEQsRUFBRSxxQ0FBcUMsc0RBQXNELEVBQUM7QUFDMUosZUFBZSxtQkFBTyxDQUFDLGtIQUFvQjtBQUMzQywrREFBOEQsRUFBRSxxQ0FBcUMsZ0RBQWdELEVBQUM7QUFDdEosa0JBQWtCLG1CQUFPLENBQUMsd0hBQXVCO0FBQ2pELGlEQUFnRCxFQUFFLHFDQUFxQyxxQ0FBcUMsRUFBQztBQUM3SCxvQkFBb0IsbUJBQU8sQ0FBQyw4SUFBa0M7QUFDOUQsOENBQTZDLEVBQUUscUNBQXFDLG9DQUFvQyxFQUFDO0FBQ3pILHdCQUF3QixtQkFBTyxDQUFDLDhIQUEwQjtBQUMxRCxnREFBK0MsRUFBRSxxQ0FBcUMsMENBQTBDLEVBQUM7QUFDakkscURBQW9ELEVBQUUscUNBQXFDLCtDQUErQyxFQUFDO0FBQzNJLGNBQWMsbUJBQU8sQ0FBQyw0RkFBUztBQUMvQixtREFBa0QsRUFBRSxxQ0FBcUMsbUNBQW1DLEVBQUM7QUFDN0gsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQVc7QUFDbkMsb0RBQW1ELEVBQUUscUNBQXFDLHNDQUFzQyxFQUFDO0FBQ2pJLHFCQUFxQixtQkFBTyxDQUFDLDBHQUFnQjtBQUM3QyxvREFBbUQsRUFBRSxxQ0FBcUMsMkNBQTJDLEVBQUM7QUFDdEkscUJBQXFCLG1CQUFPLENBQUMsMEdBQWdCO0FBQzdDLDBEQUF5RCxFQUFFLHFDQUFxQyxpREFBaUQsRUFBQztBQUNsSixpREFBZ0QsRUFBRSxxQ0FBcUMsd0NBQXdDLEVBQUM7QUFDaEksd0JBQXdCLG1CQUFPLENBQUMsc0lBQThCO0FBQzlELGtEQUFpRCxFQUFFLHFDQUFxQyw0Q0FBNEMsRUFBQztBQUNySSw0QkFBNEIsbUJBQU8sQ0FBQyw4SUFBa0M7QUFDdEUsa0RBQWlELEVBQUUscUNBQXFDLGdEQUFnRCxFQUFDO0FBQ3pJLHFCQUFxQixtQkFBTyxDQUFDLDBHQUFnQjtBQUM3QyxvREFBbUQsRUFBRSxxQ0FBcUMsMkNBQTJDLEVBQUM7QUFDdEksd0JBQXdCLG1CQUFPLENBQUMsZ0hBQW1CO0FBQ25ELHNEQUFxRCxFQUFFLHFDQUFxQyxnREFBZ0QsRUFBQztBQUM3SSxlQUFlLG1CQUFPLENBQUMsd0dBQWU7QUFDdEMsOENBQTZDLEVBQUUscUNBQXFDLCtCQUErQixFQUFDO0FBQ3BILGdEQUErQyxFQUFFLHFDQUFxQyxpQ0FBaUMsRUFBQztBQUN4SCxxQkFBcUIsbUJBQU8sQ0FBQywwR0FBZ0I7QUFDN0MsK0NBQThDLEVBQUUscUNBQXFDLHNDQUFzQyxFQUFDO0FBQzVILHdCQUF3QixtQkFBTyxDQUFDLGdIQUFtQjtBQUNuRCxrREFBaUQsRUFBRSxxQ0FBcUMsNENBQTRDLEVBQUM7QUFDckksc0JBQXNCLG1CQUFPLENBQUMsNEdBQWlCO0FBQy9DLGdEQUErQyxFQUFFLHFDQUFxQyx3Q0FBd0MsRUFBQztBQUMvSDtBQUNBLGtDQUFrQyxtQkFBTyxDQUFDLDhJQUFrQztBQUM1RSxzREFBcUQsRUFBRSxxQ0FBcUMsMERBQTBELEVBQUM7QUFDdkosdURBQXNELEVBQUUscUNBQXFDLDJEQUEyRCxFQUFDO0FBQ3pKLHlEQUF3RCxFQUFFLHFDQUFxQyw2REFBNkQsRUFBQztBQUM3SiwrQkFBK0IsbUJBQU8sQ0FBQyx3SUFBK0I7QUFDdEUsNERBQTJELEVBQUUscUNBQXFDLDZEQUE2RCxFQUFDO0FBQ2hLLDZEQUE0RCxFQUFFLHFDQUFxQyw4REFBOEQsRUFBQztBQUNsSyxpRUFBZ0UsRUFBRSxxQ0FBcUMsa0VBQWtFLEVBQUM7QUFDMUssa0VBQWlFLEVBQUUscUNBQXFDLG1FQUFtRSxFQUFDO0FBQzVLLHlEQUF3RCxFQUFFLHFDQUFxQywwREFBMEQsRUFBQztBQUMxSiwwREFBeUQsRUFBRSxxQ0FBcUMsMkRBQTJELEVBQUM7QUFDNUosOERBQTZELEVBQUUscUNBQXFDLCtEQUErRCxFQUFDO0FBQ3BLLDZEQUE0RCxFQUFFLHFDQUFxQyw4REFBOEQsRUFBQztBQUNsSyw4REFBNkQsRUFBRSxxQ0FBcUMsK0RBQStELEVBQUM7QUFDcEssaUVBQWdFLEVBQUUscUNBQXFDLGtFQUFrRSxFQUFDO0FBQzFLLDREQUEyRCxFQUFFLHFDQUFxQyw2REFBNkQsRUFBQztBQUNoSyx3REFBdUQsRUFBRSxxQ0FBcUMseURBQXlELEVBQUM7QUFDeEosZUFBZSxtQkFBTyxDQUFDLHdHQUFlO0FBQ3RDLHFEQUFvRCxFQUFFLHFDQUFxQyxzQ0FBc0MsRUFBQztBQUNsSSxpRUFBZ0UsRUFBRSxxQ0FBcUMsa0RBQWtELEVBQUM7QUFDMUosOERBQTZELEVBQUUscUNBQXFDLCtDQUErQyxFQUFDO0FBQ3BKLCtEQUE4RCxFQUFFLHFDQUFxQyxnREFBZ0QsRUFBQztBQUN0SixpRUFBZ0UsRUFBRSxxQ0FBcUMsa0RBQWtELEVBQUM7QUFDMUosc0RBQXFELEVBQUUscUNBQXFDLHVDQUF1QyxFQUFDO0FBQ3BJLHVEQUFzRCxFQUFFLHFDQUFxQyx3Q0FBd0MsRUFBQztBQUN0SSxtRUFBa0UsRUFBRSxxQ0FBcUMsb0RBQW9ELEVBQUM7QUFDOUosd0RBQXVELEVBQUUscUNBQXFDLHlDQUF5QyxFQUFDO0FBQ3hJLGdDQUFnQyxtQkFBTyxDQUFDLDBJQUFnQztBQUN4RSx3REFBdUQsRUFBRSxxQ0FBcUMsMERBQTBELEVBQUM7QUFDekosOERBQTZELEVBQUUscUNBQXFDLGdFQUFnRSxFQUFDO0FBQ3JLLCtEQUE4RCxFQUFFLHFDQUFxQyxpRUFBaUUsRUFBQztBQUN2SyxpRUFBZ0UsRUFBRSxxQ0FBcUMsbUVBQW1FLEVBQUM7QUFDM0ssaUVBQWdFLEVBQUUscUNBQXFDLG1FQUFtRSxFQUFDO0FBQzNLLG9CQUFvQixtQkFBTyxDQUFDLGtIQUFvQjtBQUNoRCxtREFBa0QsRUFBRSxxQ0FBcUMseUNBQXlDLEVBQUM7QUFDbkksZUFBZSxtQkFBTyxDQUFDLDRJQUFpQztBQUN4RCxrRUFBaUUsRUFBRSxxQ0FBcUMsbURBQW1ELEVBQUM7QUFDNUosZ0VBQStELEVBQUUscUNBQXFDLGlEQUFpRCxFQUFDO0FBQ3hKLDRFQUEyRSxFQUFFLHFDQUFxQyw2REFBNkQsRUFBQztBQUNoTCxtREFBa0QsRUFBRSxxQ0FBcUMsb0NBQW9DLEVBQUM7QUFDOUgsa0VBQWlFLEVBQUUscUNBQXFDLG1EQUFtRCxFQUFDO0FBQzVKLDJFQUEwRSxFQUFFLHFDQUFxQyw0REFBNEQsRUFBQztBQUM5SyxvQ0FBb0MsbUJBQU8sQ0FBQyx3SUFBK0I7QUFDM0UsNERBQTJELEVBQUUscUNBQXFDLGtFQUFrRSxFQUFDO0FBQ3JLIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vbmdvU2VydmVyRXJyb3IgPSBleHBvcnRzLk1vbmdvU2VydmVyQ2xvc2VkRXJyb3IgPSBleHBvcnRzLk1vbmdvUnVudGltZUVycm9yID0gZXhwb3J0cy5Nb25nb1BhcnNlRXJyb3IgPSBleHBvcnRzLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yID0gZXhwb3J0cy5Nb25nb09JRENFcnJvciA9IGV4cG9ydHMuTW9uZ29Ob3RDb25uZWN0ZWRFcnJvciA9IGV4cG9ydHMuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yID0gZXhwb3J0cy5Nb25nb05ldHdvcmtFcnJvciA9IGV4cG9ydHMuTW9uZ29NaXNzaW5nRGVwZW5kZW5jeUVycm9yID0gZXhwb3J0cy5Nb25nb01pc3NpbmdDcmVkZW50aWFsc0Vycm9yID0gZXhwb3J0cy5Nb25nb0tlcmJlcm9zRXJyb3IgPSBleHBvcnRzLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IgPSBleHBvcnRzLk1vbmdvR3JpZEZTU3RyZWFtRXJyb3IgPSBleHBvcnRzLk1vbmdvR3JpZEZTQ2h1bmtFcnJvciA9IGV4cG9ydHMuTW9uZ29HQ1BFcnJvciA9IGV4cG9ydHMuTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yID0gZXhwb3J0cy5Nb25nb0Vycm9yID0gZXhwb3J0cy5Nb25nb0RyaXZlckVycm9yID0gZXhwb3J0cy5Nb25nb0RlY29tcHJlc3Npb25FcnJvciA9IGV4cG9ydHMuTW9uZ29DdXJzb3JJblVzZUVycm9yID0gZXhwb3J0cy5Nb25nb0N1cnNvckV4aGF1c3RlZEVycm9yID0gZXhwb3J0cy5Nb25nb0NvbXBhdGliaWxpdHlFcnJvciA9IGV4cG9ydHMuTW9uZ29DbGllbnRCdWxrV3JpdGVFeGVjdXRpb25FcnJvciA9IGV4cG9ydHMuTW9uZ29DbGllbnRCdWxrV3JpdGVFcnJvciA9IGV4cG9ydHMuTW9uZ29DbGllbnRCdWxrV3JpdGVDdXJzb3JFcnJvciA9IGV4cG9ydHMuTW9uZ29DaGFuZ2VTdHJlYW1FcnJvciA9IGV4cG9ydHMuTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3IgPSBleHBvcnRzLk1vbmdvQXp1cmVFcnJvciA9IGV4cG9ydHMuTW9uZ29BV1NFcnJvciA9IGV4cG9ydHMuTW9uZ29BUElFcnJvciA9IGV4cG9ydHMuQ2hhbmdlU3RyZWFtQ3Vyc29yID0gZXhwb3J0cy5DbGllbnRFbmNyeXB0aW9uID0gZXhwb3J0cy5Nb25nb0J1bGtXcml0ZUVycm9yID0gZXhwb3J0cy5VVUlEID0gZXhwb3J0cy5UaW1lc3RhbXAgPSBleHBvcnRzLk9iamVjdElkID0gZXhwb3J0cy5NaW5LZXkgPSBleHBvcnRzLk1heEtleSA9IGV4cG9ydHMuTG9uZyA9IGV4cG9ydHMuSW50MzIgPSBleHBvcnRzLkRvdWJsZSA9IGV4cG9ydHMuRGVjaW1hbDEyOCA9IGV4cG9ydHMuREJSZWYgPSBleHBvcnRzLkNvZGUgPSBleHBvcnRzLkJTT05UeXBlID0gZXhwb3J0cy5CU09OU3ltYm9sID0gZXhwb3J0cy5CU09OUmVnRXhwID0gZXhwb3J0cy5CaW5hcnkgPSBleHBvcnRzLkJTT04gPSB2b2lkIDA7XG5leHBvcnRzLkNvbW1hbmRTdGFydGVkRXZlbnQgPSBleHBvcnRzLkNvbW1hbmRGYWlsZWRFdmVudCA9IGV4cG9ydHMuV3JpdGVDb25jZXJuID0gZXhwb3J0cy5SZWFkUHJlZmVyZW5jZSA9IGV4cG9ydHMuUmVhZENvbmNlcm4gPSBleHBvcnRzLlRvcG9sb2d5VHlwZSA9IGV4cG9ydHMuU2VydmVyVHlwZSA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlID0gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsID0gZXhwb3J0cy5Qcm9maWxpbmdMZXZlbCA9IGV4cG9ydHMuUmV0dXJuRG9jdW1lbnQgPSBleHBvcnRzLlNldmVyaXR5TGV2ZWwgPSBleHBvcnRzLk1vbmdvTG9nZ2FibGVDb21wb25lbnQgPSBleHBvcnRzLlNlcnZlckFwaVZlcnNpb24gPSBleHBvcnRzLkV4cGxhaW5WZXJib3NpdHkgPSBleHBvcnRzLk1vbmdvRXJyb3JMYWJlbCA9IGV4cG9ydHMuQ3Vyc29yVGltZW91dE1vZGUgPSBleHBvcnRzLkNVUlNPUl9GTEFHUyA9IGV4cG9ydHMuQ29tcHJlc3NvciA9IGV4cG9ydHMuQXV0aE1lY2hhbmlzbSA9IGV4cG9ydHMuR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlID0gZXhwb3J0cy5BdXRvRW5jcnlwdGlvbkxvZ2dlckxldmVsID0gZXhwb3J0cy5CYXRjaFR5cGUgPSBleHBvcnRzLlVub3JkZXJlZEJ1bGtPcGVyYXRpb24gPSBleHBvcnRzLk9yZGVyZWRCdWxrT3BlcmF0aW9uID0gZXhwb3J0cy5Nb25nb0NsaWVudCA9IGV4cG9ydHMuTGlzdEluZGV4ZXNDdXJzb3IgPSBleHBvcnRzLkxpc3RDb2xsZWN0aW9uc0N1cnNvciA9IGV4cG9ydHMuR3JpZEZTQnVja2V0V3JpdGVTdHJlYW0gPSBleHBvcnRzLkdyaWRGU0J1Y2tldFJlYWRTdHJlYW0gPSBleHBvcnRzLkdyaWRGU0J1Y2tldCA9IGV4cG9ydHMuRmluZEN1cnNvciA9IGV4cG9ydHMuRXhwbGFpbmFibGVDdXJzb3IgPSBleHBvcnRzLkRiID0gZXhwb3J0cy5Db2xsZWN0aW9uID0gZXhwb3J0cy5DbGllbnRTZXNzaW9uID0gZXhwb3J0cy5DaGFuZ2VTdHJlYW0gPSBleHBvcnRzLkNhbmNlbGxhdGlvblRva2VuID0gZXhwb3J0cy5BZ2dyZWdhdGlvbkN1cnNvciA9IGV4cG9ydHMuQWRtaW4gPSBleHBvcnRzLkFic3RyYWN0Q3Vyc29yID0gZXhwb3J0cy5jb25maWd1cmVFeHBsaWNpdFJlc291cmNlTWFuYWdlbWVudCA9IGV4cG9ydHMuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvciA9IGV4cG9ydHMuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvciA9IGV4cG9ydHMuTW9uZ29UcmFuc2FjdGlvbkVycm9yID0gZXhwb3J0cy5Nb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3IgPSBleHBvcnRzLk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvciA9IGV4cG9ydHMuTW9uZ29TeXN0ZW1FcnJvciA9IGV4cG9ydHMuTW9uZ29TdGFsZVByaW1hcnlFcnJvciA9IGV4cG9ydHMuTW9uZ29TZXJ2ZXJTZWxlY3Rpb25FcnJvciA9IHZvaWQgMDtcbmV4cG9ydHMuTW9uZ29DbGllbnRBdXRoUHJvdmlkZXJzID0gZXhwb3J0cy5Nb25nb0NyeXB0S01TUmVxdWVzdE5ldHdvcmtUaW1lb3V0RXJyb3IgPSBleHBvcnRzLk1vbmdvQ3J5cHRJbnZhbGlkQXJndW1lbnRFcnJvciA9IGV4cG9ydHMuTW9uZ29DcnlwdEVycm9yID0gZXhwb3J0cy5Nb25nb0NyeXB0Q3JlYXRlRW5jcnlwdGVkQ29sbGVjdGlvbkVycm9yID0gZXhwb3J0cy5Nb25nb0NyeXB0Q3JlYXRlRGF0YUtleUVycm9yID0gZXhwb3J0cy5Nb25nb0NyeXB0QXp1cmVLTVNSZXF1ZXN0RXJyb3IgPSBleHBvcnRzLlNydlBvbGxpbmdFdmVudCA9IGV4cG9ydHMuV2FpdGluZ0ZvclN1aXRhYmxlU2VydmVyRXZlbnQgPSBleHBvcnRzLlNlcnZlclNlbGVjdGlvblN1Y2NlZWRlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJTZWxlY3Rpb25TdGFydGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlclNlbGVjdGlvbkZhaWxlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJTZWxlY3Rpb25FdmVudCA9IGV4cG9ydHMuVG9wb2xvZ3lPcGVuaW5nRXZlbnQgPSBleHBvcnRzLlRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlRvcG9sb2d5Q2xvc2VkRXZlbnQgPSBleHBvcnRzLlNlcnZlck9wZW5pbmdFdmVudCA9IGV4cG9ydHMuU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudCA9IGV4cG9ydHMuU2VydmVySGVhcnRiZWF0RmFpbGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJDbG9zZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblJlYWR5RXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25Qb29sUmVhZHlFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvblBvb2xNb25pdG9yaW5nRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25Qb29sQ3JlYXRlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uUG9vbENsb3NlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uUG9vbENsZWFyZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNyZWF0ZWRFdmVudCA9IGV4cG9ydHMuQ29ubmVjdGlvbkNsb3NlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkRXZlbnQgPSBleHBvcnRzLkNvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tlZE91dEV2ZW50ID0gZXhwb3J0cy5Db25uZWN0aW9uQ2hlY2tlZEluRXZlbnQgPSBleHBvcnRzLkNvbW1hbmRTdWNjZWVkZWRFdmVudCA9IHZvaWQgMDtcbmNvbnN0IGFkbWluXzEgPSByZXF1aXJlKFwiLi9hZG1pblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkFkbWluXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhZG1pbl8xLkFkbWluOyB9IH0pO1xuY29uc3Qgb3JkZXJlZF8xID0gcmVxdWlyZShcIi4vYnVsay9vcmRlcmVkXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiT3JkZXJlZEJ1bGtPcGVyYXRpb25cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9yZGVyZWRfMS5PcmRlcmVkQnVsa09wZXJhdGlvbjsgfSB9KTtcbmNvbnN0IHVub3JkZXJlZF8xID0gcmVxdWlyZShcIi4vYnVsay91bm9yZGVyZWRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJVbm9yZGVyZWRCdWxrT3BlcmF0aW9uXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB1bm9yZGVyZWRfMS5Vbm9yZGVyZWRCdWxrT3BlcmF0aW9uOyB9IH0pO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4vY2hhbmdlX3N0cmVhbVwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNoYW5nZVN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbTsgfSB9KTtcbmNvbnN0IGNvbGxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuL2NvbGxlY3Rpb25cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb2xsZWN0aW9uXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb2xsZWN0aW9uXzEuQ29sbGVjdGlvbjsgfSB9KTtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2Fic3RyYWN0X2N1cnNvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkFic3RyYWN0Q3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhYnN0cmFjdF9jdXJzb3JfMS5BYnN0cmFjdEN1cnNvcjsgfSB9KTtcbmNvbnN0IGFnZ3JlZ2F0aW9uX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2FnZ3JlZ2F0aW9uX2N1cnNvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkFnZ3JlZ2F0aW9uQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhZ2dyZWdhdGlvbl9jdXJzb3JfMS5BZ2dyZWdhdGlvbkN1cnNvcjsgfSB9KTtcbmNvbnN0IGZpbmRfY3Vyc29yXzEgPSByZXF1aXJlKFwiLi9jdXJzb3IvZmluZF9jdXJzb3JcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJGaW5kQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBmaW5kX2N1cnNvcl8xLkZpbmRDdXJzb3I7IH0gfSk7XG5jb25zdCBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2xpc3RfY29sbGVjdGlvbnNfY3Vyc29yXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTGlzdENvbGxlY3Rpb25zQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBsaXN0X2NvbGxlY3Rpb25zX2N1cnNvcl8xLkxpc3RDb2xsZWN0aW9uc0N1cnNvcjsgfSB9KTtcbmNvbnN0IGxpc3RfaW5kZXhlc19jdXJzb3JfMSA9IHJlcXVpcmUoXCIuL2N1cnNvci9saXN0X2luZGV4ZXNfY3Vyc29yXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTGlzdEluZGV4ZXNDdXJzb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGxpc3RfaW5kZXhlc19jdXJzb3JfMS5MaXN0SW5kZXhlc0N1cnNvcjsgfSB9KTtcbmNvbnN0IGRiXzEgPSByZXF1aXJlKFwiLi9kYlwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkRiXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBkYl8xLkRiOyB9IH0pO1xuY29uc3QgZXhwbGFpbl8xID0gcmVxdWlyZShcIi4vZXhwbGFpblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkV4cGxhaW5hYmxlQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBleHBsYWluXzEuRXhwbGFpbmFibGVDdXJzb3I7IH0gfSk7XG5jb25zdCBncmlkZnNfMSA9IHJlcXVpcmUoXCIuL2dyaWRmc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkdyaWRGU0J1Y2tldFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZ3JpZGZzXzEuR3JpZEZTQnVja2V0OyB9IH0pO1xuY29uc3QgZG93bmxvYWRfMSA9IHJlcXVpcmUoXCIuL2dyaWRmcy9kb3dubG9hZFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkdyaWRGU0J1Y2tldFJlYWRTdHJlYW1cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRvd25sb2FkXzEuR3JpZEZTQnVja2V0UmVhZFN0cmVhbTsgfSB9KTtcbmNvbnN0IHVwbG9hZF8xID0gcmVxdWlyZShcIi4vZ3JpZGZzL3VwbG9hZFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkdyaWRGU0J1Y2tldFdyaXRlU3RyZWFtXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB1cGxvYWRfMS5HcmlkRlNCdWNrZXRXcml0ZVN0cmVhbTsgfSB9KTtcbmNvbnN0IG1vbmdvX2NsaWVudF8xID0gcmVxdWlyZShcIi4vbW9uZ29fY2xpZW50XCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29DbGllbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1vbmdvX2NsaWVudF8xLk1vbmdvQ2xpZW50OyB9IH0pO1xuY29uc3QgbW9uZ29fdHlwZXNfMSA9IHJlcXVpcmUoXCIuL21vbmdvX3R5cGVzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ2FuY2VsbGF0aW9uVG9rZW5cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1vbmdvX3R5cGVzXzEuQ2FuY2VsbGF0aW9uVG9rZW47IH0gfSk7XG5jb25zdCBzZXNzaW9uc18xID0gcmVxdWlyZShcIi4vc2Vzc2lvbnNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDbGllbnRTZXNzaW9uXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBzZXNzaW9uc18xLkNsaWVudFNlc3Npb247IH0gfSk7XG4vKiogQHB1YmxpYyAqL1xudmFyIGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzEuQlNPTjsgfSB9KTtcbnZhciBic29uXzIgPSByZXF1aXJlKFwiLi9ic29uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQmluYXJ5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuQmluYXJ5OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQlNPTlJlZ0V4cFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkJTT05SZWdFeHA7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJCU09OU3ltYm9sXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuQlNPTlN5bWJvbDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkJTT05UeXBlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuQlNPTlR5cGU7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb2RlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuQ29kZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkRCUmVmXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuREJSZWY7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEZWNpbWFsMTI4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuRGVjaW1hbDEyODsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkRvdWJsZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLkRvdWJsZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkludDMyXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuSW50MzI7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJMb25nXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuTG9uZzsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1heEtleVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLk1heEtleTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1pbktleVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnNvbl8yLk1pbktleTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk9iamVjdElkXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuT2JqZWN0SWQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJUaW1lc3RhbXBcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJzb25fMi5UaW1lc3RhbXA7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJVVUlEXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBic29uXzIuVVVJRDsgfSB9KTtcbnZhciBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2J1bGsvY29tbW9uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29CdWxrV3JpdGVFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzEuTW9uZ29CdWxrV3JpdGVFcnJvcjsgfSB9KTtcbnZhciBjbGllbnRfZW5jcnlwdGlvbl8xID0gcmVxdWlyZShcIi4vY2xpZW50LXNpZGUtZW5jcnlwdGlvbi9jbGllbnRfZW5jcnlwdGlvblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNsaWVudEVuY3J5cHRpb25cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNsaWVudF9lbmNyeXB0aW9uXzEuQ2xpZW50RW5jcnlwdGlvbjsgfSB9KTtcbnZhciBjaGFuZ2Vfc3RyZWFtX2N1cnNvcl8xID0gcmVxdWlyZShcIi4vY3Vyc29yL2NoYW5nZV9zdHJlYW1fY3Vyc29yXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ2hhbmdlU3RyZWFtQ3Vyc29yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjaGFuZ2Vfc3RyZWFtX2N1cnNvcl8xLkNoYW5nZVN0cmVhbUN1cnNvcjsgfSB9KTtcbnZhciBlcnJvcl8xID0gcmVxdWlyZShcIi4vZXJyb3JcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0FQSUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQVBJRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0FXU0Vycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQVdTRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0F6dXJlRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29BenVyZUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29CYXRjaFJlRXhlY3V0aW9uRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NoYW5nZVN0cmVhbUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQ2hhbmdlU3RyZWFtRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NsaWVudEJ1bGtXcml0ZUN1cnNvckVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQ2xpZW50QnVsa1dyaXRlQ3Vyc29yRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQ2xpZW50QnVsa1dyaXRlRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NsaWVudEJ1bGtXcml0ZUV4ZWN1dGlvbkVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvQ2xpZW50QnVsa1dyaXRlRXhlY3V0aW9uRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NvbXBhdGliaWxpdHlFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ3Vyc29yRXhoYXVzdGVkRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29DdXJzb3JFeGhhdXN0ZWRFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ3Vyc29ySW5Vc2VFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0N1cnNvckluVXNlRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0RlY29tcHJlc3Npb25FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0RlY29tcHJlc3Npb25FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvRHJpdmVyRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29Ecml2ZXJFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvRXhwaXJlZFNlc3Npb25FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0V4cGlyZWRTZXNzaW9uRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0dDUEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvR0NQRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0dyaWRGU0NodW5rRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29HcmlkRlNDaHVua0Vycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29HcmlkRlNTdHJlYW1FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0dyaWRGU1N0cmVhbUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29LZXJiZXJvc0Vycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvS2VyYmVyb3NFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvTWlzc2luZ0NyZWRlbnRpYWxzRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29NaXNzaW5nQ3JlZGVudGlhbHNFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvTWlzc2luZ0RlcGVuZGVuY3lFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb01pc3NpbmdEZXBlbmRlbmN5RXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb05ldHdvcmtFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb05ldHdvcmtUaW1lb3V0RXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb05vdENvbm5lY3RlZEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvTm90Q29ubmVjdGVkRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb09JRENFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb09JRENFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29QYXJzZUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvUnVudGltZUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29TZXJ2ZXJDbG9zZWRFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1NlcnZlckNsb3NlZEVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29TZXJ2ZXJFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29TZXJ2ZXJTZWxlY3Rpb25FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1NlcnZlclNlbGVjdGlvbkVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29TdGFsZVByaW1hcnlFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1N0YWxlUHJpbWFyeUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29TeXN0ZW1FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1N5c3RlbUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29UYWlsYWJsZUN1cnNvckVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcl8xLk1vbmdvVGFpbGFibGVDdXJzb3JFcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb1RyYW5zYWN0aW9uRXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29Xcml0ZUNvbmNlcm5FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMS5Nb25nb1dyaXRlQ29uY2VybkVycm9yOyB9IH0pO1xudmFyIHJlc291cmNlX21hbmFnZW1lbnRfMSA9IHJlcXVpcmUoXCIuL3Jlc291cmNlX21hbmFnZW1lbnRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJjb25maWd1cmVFeHBsaWNpdFJlc291cmNlTWFuYWdlbWVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVzb3VyY2VfbWFuYWdlbWVudF8xLmNvbmZpZ3VyZUV4cGxpY2l0UmVzb3VyY2VNYW5hZ2VtZW50OyB9IH0pO1xuLy8gZW51bXNcbnZhciBjb21tb25fMiA9IHJlcXVpcmUoXCIuL2J1bGsvY29tbW9uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQmF0Y2hUeXBlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb21tb25fMi5CYXRjaFR5cGU7IH0gfSk7XG52YXIgYXV0b19lbmNyeXB0ZXJfMSA9IHJlcXVpcmUoXCIuL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vYXV0b19lbmNyeXB0ZXJcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJBdXRvRW5jcnlwdGlvbkxvZ2dlckxldmVsXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhdXRvX2VuY3J5cHRlcl8xLkF1dG9FbmNyeXB0aW9uTG9nZ2VyTGV2ZWw7IH0gfSk7XG52YXIgZ3NzYXBpXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvZ3NzYXBpXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiR1NTQVBJQ2Fub25pY2FsaXphdGlvblZhbHVlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBnc3NhcGlfMS5HU1NBUElDYW5vbmljYWxpemF0aW9uVmFsdWU7IH0gfSk7XG52YXIgcHJvdmlkZXJzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvcHJvdmlkZXJzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQXV0aE1lY2hhbmlzbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbTsgfSB9KTtcbnZhciBjb21wcmVzc2lvbl8xID0gcmVxdWlyZShcIi4vY21hcC93aXJlX3Byb3RvY29sL2NvbXByZXNzaW9uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29tcHJlc3NvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tcHJlc3Npb25fMS5Db21wcmVzc29yOyB9IH0pO1xudmFyIGFic3RyYWN0X2N1cnNvcl8yID0gcmVxdWlyZShcIi4vY3Vyc29yL2Fic3RyYWN0X2N1cnNvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNVUlNPUl9GTEFHU1wiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYWJzdHJhY3RfY3Vyc29yXzIuQ1VSU09SX0ZMQUdTOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ3Vyc29yVGltZW91dE1vZGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFic3RyYWN0X2N1cnNvcl8yLkN1cnNvclRpbWVvdXRNb2RlOyB9IH0pO1xudmFyIGVycm9yXzIgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvRXJyb3JMYWJlbFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JfMi5Nb25nb0Vycm9yTGFiZWw7IH0gfSk7XG52YXIgZXhwbGFpbl8yID0gcmVxdWlyZShcIi4vZXhwbGFpblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkV4cGxhaW5WZXJib3NpdHlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV4cGxhaW5fMi5FeHBsYWluVmVyYm9zaXR5OyB9IH0pO1xudmFyIG1vbmdvX2NsaWVudF8yID0gcmVxdWlyZShcIi4vbW9uZ29fY2xpZW50XCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyQXBpVmVyc2lvblwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbW9uZ29fY2xpZW50XzIuU2VydmVyQXBpVmVyc2lvbjsgfSB9KTtcbnZhciBtb25nb19sb2dnZXJfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2xvZ2dlclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvTG9nZ2FibGVDb21wb25lbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTZXZlcml0eUxldmVsXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBtb25nb19sb2dnZXJfMS5TZXZlcml0eUxldmVsOyB9IH0pO1xudmFyIGZpbmRfYW5kX21vZGlmeV8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9maW5kX2FuZF9tb2RpZnlcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJSZXR1cm5Eb2N1bWVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZmluZF9hbmRfbW9kaWZ5XzEuUmV0dXJuRG9jdW1lbnQ7IH0gfSk7XG52YXIgc2V0X3Byb2ZpbGluZ19sZXZlbF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9zZXRfcHJvZmlsaW5nX2xldmVsXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiUHJvZmlsaW5nTGV2ZWxcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNldF9wcm9maWxpbmdfbGV2ZWxfMS5Qcm9maWxpbmdMZXZlbDsgfSB9KTtcbnZhciByZWFkX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3JlYWRfY29uY2VyblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlJlYWRDb25jZXJuTGV2ZWxcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuTGV2ZWw7IH0gfSk7XG52YXIgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJSZWFkUHJlZmVyZW5jZU1vZGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlTW9kZTsgfSB9KTtcbnZhciBjb21tb25fMyA9IHJlcXVpcmUoXCIuL3NkYW0vY29tbW9uXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyVHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzMuU2VydmVyVHlwZTsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRvcG9sb2d5VHlwZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzMuVG9wb2xvZ3lUeXBlOyB9IH0pO1xudmFyIHJlYWRfY29uY2Vybl8yID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiUmVhZENvbmNlcm5cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlYWRfY29uY2Vybl8yLlJlYWRDb25jZXJuOyB9IH0pO1xudmFyIHJlYWRfcHJlZmVyZW5jZV8yID0gcmVxdWlyZShcIi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiUmVhZFByZWZlcmVuY2VcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlYWRfcHJlZmVyZW5jZV8yLlJlYWRQcmVmZXJlbmNlOyB9IH0pO1xudmFyIHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3dyaXRlX2NvbmNlcm5cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJXcml0ZUNvbmNlcm5cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm47IH0gfSk7XG4vLyBldmVudHNcbnZhciBjb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2NvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb21tYW5kRmFpbGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbW1hbmRfbW9uaXRvcmluZ19ldmVudHNfMS5Db21tYW5kRmFpbGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb21tYW5kU3RhcnRlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb21tYW5kX21vbml0b3JpbmdfZXZlbnRzXzEuQ29tbWFuZFN0YXJ0ZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbW1hbmRTdWNjZWVkZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbWFuZF9tb25pdG9yaW5nX2V2ZW50c18xLkNvbW1hbmRTdWNjZWVkZWRFdmVudDsgfSB9KTtcbnZhciBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2Nvbm5lY3Rpb25fcG9vbF9ldmVudHNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uQ2hlY2tlZEluRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2hlY2tlZEluRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uQ2hlY2tlZE91dEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrZWRPdXRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbm5lY3Rpb25DaGVja091dEZhaWxlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNoZWNrT3V0RmFpbGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2hlY2tPdXRTdGFydGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uQ2xvc2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uQ2xvc2VkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uQ3JlYXRlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvbkNyZWF0ZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbm5lY3Rpb25Qb29sQ2xlYXJlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xDbGVhcmVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uUG9vbENsb3NlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xDbG9zZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkNvbm5lY3Rpb25Qb29sQ3JlYXRlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xDcmVhdGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJDb25uZWN0aW9uUG9vbE1vbml0b3JpbmdFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdGlvbl9wb29sX2V2ZW50c18xLkNvbm5lY3Rpb25Qb29sTW9uaXRvcmluZ0V2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25uZWN0aW9uX3Bvb2xfZXZlbnRzXzEuQ29ubmVjdGlvblBvb2xSZWFkeUV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ29ubmVjdGlvblJlYWR5RXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbm5lY3Rpb25fcG9vbF9ldmVudHNfMS5Db25uZWN0aW9uUmVhZHlFdmVudDsgfSB9KTtcbnZhciBldmVudHNfMSA9IHJlcXVpcmUoXCIuL3NkYW0vZXZlbnRzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyQ2xvc2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlNlcnZlckNsb3NlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyRGVzY3JpcHRpb25DaGFuZ2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVySGVhcnRiZWF0RmFpbGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdEZhaWxlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVySGVhcnRiZWF0U3RhcnRlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5TZXJ2ZXJIZWFydGJlYXRTdGFydGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTZXJ2ZXJIZWFydGJlYXRTdWNjZWVkZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXZlbnRzXzEuU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTZXJ2ZXJPcGVuaW5nRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlNlcnZlck9wZW5pbmdFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRvcG9sb2d5Q2xvc2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlRvcG9sb2d5Q2xvc2VkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJUb3BvbG9neURlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBldmVudHNfMS5Ub3BvbG9neURlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVG9wb2xvZ3lPcGVuaW5nRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGV2ZW50c18xLlRvcG9sb2d5T3BlbmluZ0V2ZW50OyB9IH0pO1xudmFyIHNlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXzEgPSByZXF1aXJlKFwiLi9zZGFtL3NlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU2VydmVyU2VsZWN0aW9uRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXzEuU2VydmVyU2VsZWN0aW9uRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTZXJ2ZXJTZWxlY3Rpb25GYWlsZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2VydmVyX3NlbGVjdGlvbl9ldmVudHNfMS5TZXJ2ZXJTZWxlY3Rpb25GYWlsZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNlcnZlclNlbGVjdGlvblN0YXJ0ZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2VydmVyX3NlbGVjdGlvbl9ldmVudHNfMS5TZXJ2ZXJTZWxlY3Rpb25TdGFydGVkRXZlbnQ7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTZXJ2ZXJTZWxlY3Rpb25TdWNjZWVkZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2VydmVyX3NlbGVjdGlvbl9ldmVudHNfMS5TZXJ2ZXJTZWxlY3Rpb25TdWNjZWVkZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIldhaXRpbmdGb3JTdWl0YWJsZVNlcnZlckV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBzZXJ2ZXJfc2VsZWN0aW9uX2V2ZW50c18xLldhaXRpbmdGb3JTdWl0YWJsZVNlcnZlckV2ZW50OyB9IH0pO1xudmFyIHNydl9wb2xsaW5nXzEgPSByZXF1aXJlKFwiLi9zZGFtL3Nydl9wb2xsaW5nXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU3J2UG9sbGluZ0V2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBzcnZfcG9sbGluZ18xLlNydlBvbGxpbmdFdmVudDsgfSB9KTtcbnZhciBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuL2NsaWVudC1zaWRlLWVuY3J5cHRpb24vZXJyb3JzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29DcnlwdEF6dXJlS01TUmVxdWVzdEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcnNfMS5Nb25nb0NyeXB0QXp1cmVLTVNSZXF1ZXN0RXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NyeXB0Q3JlYXRlRGF0YUtleUVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcnNfMS5Nb25nb0NyeXB0Q3JlYXRlRGF0YUtleUVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JzXzEuTW9uZ29DcnlwdENyZWF0ZUVuY3J5cHRlZENvbGxlY3Rpb25FcnJvcjsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ3J5cHRFcnJvclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXJyb3JzXzEuTW9uZ29DcnlwdEVycm9yOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiTW9uZ29DcnlwdEludmFsaWRBcmd1bWVudEVycm9yXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcnNfMS5Nb25nb0NyeXB0SW52YWxpZEFyZ3VtZW50RXJyb3I7IH0gfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJNb25nb0NyeXB0S01TUmVxdWVzdE5ldHdvcmtUaW1lb3V0RXJyb3JcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVycm9yc18xLk1vbmdvQ3J5cHRLTVNSZXF1ZXN0TmV0d29ya1RpbWVvdXRFcnJvcjsgfSB9KTtcbnZhciBtb25nb19jbGllbnRfYXV0aF9wcm92aWRlcnNfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2NsaWVudF9hdXRoX3Byb3ZpZGVyc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1vbmdvQ2xpZW50QXV0aFByb3ZpZGVyc1wiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbW9uZ29fY2xpZW50X2F1dGhfcHJvdmlkZXJzXzEuTW9uZ29DbGllbnRBdXRoUHJvdmlkZXJzOyB9IH0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoClient = exports.ServerApiVersion = void 0;\nconst fs_1 = __webpack_require__(/*! fs */ \"fs\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst change_stream_1 = __webpack_require__(/*! ./change_stream */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\");\nconst mongo_credentials_1 = __webpack_require__(/*! ./cmap/auth/mongo_credentials */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js\");\nconst providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst connection_string_1 = __webpack_require__(/*! ./connection_string */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/connection_string.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst db_1 = __webpack_require__(/*! ./db */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/db.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_client_auth_providers_1 = __webpack_require__(/*! ./mongo_client_auth_providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client_auth_providers.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ./mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst executor_1 = __webpack_require__(/*! ./operations/client_bulk_write/executor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/executor.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst resource_management_1 = __webpack_require__(/*! ./resource_management */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js\");\nconst server_selection_1 = __webpack_require__(/*! ./sdam/server_selection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst topology_1 = __webpack_require__(/*! ./sdam/topology */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology.js\");\nconst sessions_1 = __webpack_require__(/*! ./sessions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/** @public */\nexports.ServerApiVersion = Object.freeze({\n    v1: '1'\n});\n/**\n * The **MongoClient** class is a class that allows for making Connections to MongoDB.\n * @public\n *\n * @remarks\n * The programmatically provided options take precedence over the URI options.\n *\n * @example\n * ```ts\n * import { MongoClient } from 'mongodb';\n *\n * // Enable command monitoring for debugging\n * const client = new MongoClient('mongodb://localhost:27017', { monitorCommands: true });\n *\n * client.on('commandStarted', started => console.log(started));\n * client.db().collection('pets');\n * await client.insertOne({ name: 'spot', kind: 'dog' });\n * ```\n */\nclass MongoClient extends mongo_types_1.TypedEventEmitter {\n    constructor(url, options) {\n        super();\n        this.on('error', utils_1.noop);\n        this.options = (0, connection_string_1.parseOptions)(url, this, options);\n        const shouldSetLogger = Object.values(this.options.mongoLoggerOptions.componentSeverities).some(value => value !== mongo_logger_1.SeverityLevel.OFF);\n        this.mongoLogger = shouldSetLogger\n            ? new mongo_logger_1.MongoLogger(this.options.mongoLoggerOptions)\n            : undefined;\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const client = this;\n        // The internal state\n        this.s = {\n            url,\n            bsonOptions: (0, bson_1.resolveBSONOptions)(this.options),\n            namespace: (0, utils_1.ns)('admin'),\n            hasBeenClosed: false,\n            sessionPool: new sessions_1.ServerSessionPool(this),\n            activeSessions: new Set(),\n            activeCursors: new Set(),\n            authProviders: new mongo_client_auth_providers_1.MongoClientAuthProviders(),\n            get options() {\n                return client.options;\n            },\n            get readConcern() {\n                return client.options.readConcern;\n            },\n            get writeConcern() {\n                return client.options.writeConcern;\n            },\n            get readPreference() {\n                return client.options.readPreference;\n            },\n            get isMongoClient() {\n                return true;\n            }\n        };\n        this.checkForNonGenuineHosts();\n    }\n    /** @internal */\n    async asyncDispose() {\n        await this.close();\n    }\n    /** @internal */\n    checkForNonGenuineHosts() {\n        const documentDBHostnames = this.options.hosts.filter((hostAddress) => (0, utils_1.isHostMatch)(utils_1.DOCUMENT_DB_CHECK, hostAddress.host));\n        const srvHostIsDocumentDB = (0, utils_1.isHostMatch)(utils_1.DOCUMENT_DB_CHECK, this.options.srvHost);\n        const cosmosDBHostnames = this.options.hosts.filter((hostAddress) => (0, utils_1.isHostMatch)(utils_1.COSMOS_DB_CHECK, hostAddress.host));\n        const srvHostIsCosmosDB = (0, utils_1.isHostMatch)(utils_1.COSMOS_DB_CHECK, this.options.srvHost);\n        if (documentDBHostnames.length !== 0 || srvHostIsDocumentDB) {\n            this.mongoLogger?.info('client', utils_1.DOCUMENT_DB_MSG);\n        }\n        else if (cosmosDBHostnames.length !== 0 || srvHostIsCosmosDB) {\n            this.mongoLogger?.info('client', utils_1.COSMOS_DB_MSG);\n        }\n    }\n    get serverApi() {\n        return this.options.serverApi && Object.freeze({ ...this.options.serverApi });\n    }\n    /**\n     * Intended for APM use only\n     * @internal\n     */\n    get monitorCommands() {\n        return this.options.monitorCommands;\n    }\n    set monitorCommands(value) {\n        this.options.monitorCommands = value;\n    }\n    /** @internal */\n    get autoEncrypter() {\n        return this.options.autoEncrypter;\n    }\n    get readConcern() {\n        return this.s.readConcern;\n    }\n    get writeConcern() {\n        return this.s.writeConcern;\n    }\n    get readPreference() {\n        return this.s.readPreference;\n    }\n    get bsonOptions() {\n        return this.s.bsonOptions;\n    }\n    get timeoutMS() {\n        return this.s.options.timeoutMS;\n    }\n    /**\n     * Executes a client bulk write operation, available on server 8.0+.\n     * @param models - The client bulk write models.\n     * @param options - The client bulk write options.\n     * @returns A ClientBulkWriteResult for acknowledged writes and ok: 1 for unacknowledged writes.\n     */\n    async bulkWrite(models, options) {\n        if (this.autoEncrypter) {\n            throw new error_1.MongoInvalidArgumentError('MongoClient bulkWrite does not currently support automatic encryption.');\n        }\n        // We do not need schema type information past this point (\"as any\" is fine)\n        return await new executor_1.ClientBulkWriteExecutor(this, models, (0, utils_1.resolveOptions)(this, options)).execute();\n    }\n    /**\n     * Connect to MongoDB using a url\n     *\n     * @remarks\n     * Calling `connect` is optional since the first operation you perform will call `connect` if it's needed.\n     * `timeoutMS` will bound the time any operation can take before throwing a timeout error.\n     * However, when the operation being run is automatically connecting your `MongoClient` the `timeoutMS` will not apply to the time taken to connect the MongoClient.\n     * This means the time to setup the `MongoClient` does not count against `timeoutMS`.\n     * If you are using `timeoutMS` we recommend connecting your client explicitly in advance of any operation to avoid this inconsistent execution time.\n     *\n     * @remarks\n     * The driver will look up corresponding SRV and TXT records if the connection string starts with `mongodb+srv://`.\n     * If those look ups throw a DNS Timeout error, the driver will retry the look up once.\n     *\n     * @see docs.mongodb.org/manual/reference/connection-string/\n     */\n    async connect() {\n        if (this.connectionLock) {\n            return await this.connectionLock;\n        }\n        try {\n            this.connectionLock = this._connect();\n            await this.connectionLock;\n        }\n        finally {\n            // release\n            this.connectionLock = undefined;\n        }\n        return this;\n    }\n    /**\n     * Create a topology to open the connection, must be locked to avoid topology leaks in concurrency scenario.\n     * Locking is enforced by the connect method.\n     *\n     * @internal\n     */\n    async _connect() {\n        if (this.topology && this.topology.isConnected()) {\n            return this;\n        }\n        const options = this.options;\n        if (options.tls) {\n            if (typeof options.tlsCAFile === 'string') {\n                options.ca ??= await fs_1.promises.readFile(options.tlsCAFile);\n            }\n            if (typeof options.tlsCRLFile === 'string') {\n                options.crl ??= await fs_1.promises.readFile(options.tlsCRLFile);\n            }\n            if (typeof options.tlsCertificateKeyFile === 'string') {\n                if (!options.key || !options.cert) {\n                    const contents = await fs_1.promises.readFile(options.tlsCertificateKeyFile);\n                    options.key ??= contents;\n                    options.cert ??= contents;\n                }\n            }\n        }\n        if (typeof options.srvHost === 'string') {\n            const hosts = await (0, connection_string_1.resolveSRVRecord)(options);\n            for (const [index, host] of hosts.entries()) {\n                options.hosts[index] = host;\n            }\n        }\n        // It is important to perform validation of hosts AFTER SRV resolution, to check the real hostname,\n        // but BEFORE we even attempt connecting with a potentially not allowed hostname\n        if (options.credentials?.mechanism === providers_1.AuthMechanism.MONGODB_OIDC) {\n            const allowedHosts = options.credentials?.mechanismProperties?.ALLOWED_HOSTS || mongo_credentials_1.DEFAULT_ALLOWED_HOSTS;\n            const isServiceAuth = !!options.credentials?.mechanismProperties?.ENVIRONMENT;\n            if (!isServiceAuth) {\n                for (const host of options.hosts) {\n                    if (!(0, utils_1.hostMatchesWildcards)(host.toHostPort().host, allowedHosts)) {\n                        throw new error_1.MongoInvalidArgumentError(`Host '${host}' is not valid for OIDC authentication with ALLOWED_HOSTS of '${allowedHosts.join(',')}'`);\n                    }\n                }\n            }\n        }\n        this.topology = new topology_1.Topology(this, options.hosts, options);\n        // Events can be emitted before initialization is complete so we have to\n        // save the reference to the topology on the client ASAP if the event handlers need to access it\n        this.topology.once(topology_1.Topology.OPEN, () => this.emit('open', this));\n        for (const event of constants_1.MONGO_CLIENT_EVENTS) {\n            this.topology.on(event, (...args) => this.emit(event, ...args));\n        }\n        const topologyConnect = async () => {\n            try {\n                await this.topology?.connect(options);\n            }\n            catch (error) {\n                this.topology?.close();\n                throw error;\n            }\n        };\n        if (this.autoEncrypter) {\n            await this.autoEncrypter?.init();\n            await topologyConnect();\n            await options.encrypter.connectInternalClient();\n        }\n        else {\n            await topologyConnect();\n        }\n        return this;\n    }\n    /**\n     * Cleans up client-side resources used by the MongoCLient and .  This includes:\n     *\n     * - Closes all open, unused connections (see note).\n     * - Ends all in-use sessions with {@link ClientSession#endSession|ClientSession.endSession()}.\n     * - Ends all unused sessions server-side.\n     * - Cleans up any resources being used for auto encryption if auto encryption is enabled.\n     *\n     * @remarks Any in-progress operations are not killed and any connections used by in progress operations\n     * will be cleaned up lazily as operations finish.\n     *\n     * @param force - Force close, emitting no events\n     */\n    async close(force = false) {\n        if (this.closeLock) {\n            return await this.closeLock;\n        }\n        try {\n            this.closeLock = this._close(force);\n            await this.closeLock;\n        }\n        finally {\n            // release\n            this.closeLock = undefined;\n        }\n    }\n    /* @internal */\n    async _close(force = false) {\n        // There's no way to set hasBeenClosed back to false\n        Object.defineProperty(this.s, 'hasBeenClosed', {\n            value: true,\n            enumerable: true,\n            configurable: false,\n            writable: false\n        });\n        const activeCursorCloses = Array.from(this.s.activeCursors, cursor => cursor.close());\n        this.s.activeCursors.clear();\n        await Promise.all(activeCursorCloses);\n        const activeSessionEnds = Array.from(this.s.activeSessions, session => session.endSession());\n        this.s.activeSessions.clear();\n        await Promise.all(activeSessionEnds);\n        if (this.topology == null) {\n            return;\n        }\n        // If we would attempt to select a server and get nothing back we short circuit\n        // to avoid the server selection timeout.\n        const selector = (0, server_selection_1.readPreferenceServerSelector)(read_preference_1.ReadPreference.primaryPreferred);\n        const topologyDescription = this.topology.description;\n        const serverDescriptions = Array.from(topologyDescription.servers.values());\n        const servers = selector(topologyDescription, serverDescriptions);\n        if (servers.length !== 0) {\n            const endSessions = Array.from(this.s.sessionPool.sessions, ({ id }) => id);\n            if (endSessions.length !== 0) {\n                try {\n                    await (0, execute_operation_1.executeOperation)(this, new run_command_1.RunAdminCommandOperation({ endSessions }, { readPreference: read_preference_1.ReadPreference.primaryPreferred, noResponse: true }));\n                }\n                catch (error) {\n                    (0, utils_1.squashError)(error);\n                }\n            }\n        }\n        // clear out references to old topology\n        const topology = this.topology;\n        this.topology = undefined;\n        topology.close();\n        const { encrypter } = this.options;\n        if (encrypter) {\n            await encrypter.close(this, force);\n        }\n    }\n    /**\n     * Create a new Db instance sharing the current socket connections.\n     *\n     * @param dbName - The name of the database we want to use. If not provided, use database name from connection string.\n     * @param options - Optional settings for Db construction\n     */\n    db(dbName, options) {\n        options = options ?? {};\n        // Default to db from connection string if not provided\n        if (!dbName) {\n            dbName = this.s.options.dbName;\n        }\n        // Copy the options and add out internal override of the not shared flag\n        const finalOptions = Object.assign({}, this.options, options);\n        // Return the db object\n        const db = new db_1.Db(this, dbName, finalOptions);\n        // Return the database\n        return db;\n    }\n    /**\n     * Connect to MongoDB using a url\n     *\n     * @remarks\n     * Calling `connect` is optional since the first operation you perform will call `connect` if it's needed.\n     * `timeoutMS` will bound the time any operation can take before throwing a timeout error.\n     * However, when the operation being run is automatically connecting your `MongoClient` the `timeoutMS` will not apply to the time taken to connect the MongoClient.\n     * This means the time to setup the `MongoClient` does not count against `timeoutMS`.\n     * If you are using `timeoutMS` we recommend connecting your client explicitly in advance of any operation to avoid this inconsistent execution time.\n     *\n     * @remarks\n     * The programmatically provided options take precedence over the URI options.\n     *\n     * @remarks\n     * The driver will look up corresponding SRV and TXT records if the connection string starts with `mongodb+srv://`.\n     * If those look ups throw a DNS Timeout error, the driver will retry the look up once.\n     *\n     * @see https://www.mongodb.com/docs/manual/reference/connection-string/\n     */\n    static async connect(url, options) {\n        const client = new this(url, options);\n        return await client.connect();\n    }\n    /**\n     * Creates a new ClientSession. When using the returned session in an operation\n     * a corresponding ServerSession will be created.\n     *\n     * @remarks\n     * A ClientSession instance may only be passed to operations being performed on the same\n     * MongoClient it was started from.\n     */\n    startSession(options) {\n        const session = new sessions_1.ClientSession(this, this.s.sessionPool, { explicit: true, ...options }, this.options);\n        this.s.activeSessions.add(session);\n        session.once('ended', () => {\n            this.s.activeSessions.delete(session);\n        });\n        return session;\n    }\n    async withSession(optionsOrExecutor, executor) {\n        const options = {\n            // Always define an owner\n            owner: Symbol(),\n            // If it's an object inherit the options\n            ...(typeof optionsOrExecutor === 'object' ? optionsOrExecutor : {})\n        };\n        const withSessionCallback = typeof optionsOrExecutor === 'function' ? optionsOrExecutor : executor;\n        if (withSessionCallback == null) {\n            throw new error_1.MongoInvalidArgumentError('Missing required callback parameter');\n        }\n        const session = this.startSession(options);\n        try {\n            return await withSessionCallback(session);\n        }\n        finally {\n            try {\n                await session.endSession();\n            }\n            catch (error) {\n                (0, utils_1.squashError)(error);\n            }\n        }\n    }\n    /**\n     * Create a new Change Stream, watching for new changes (insertions, updates,\n     * replacements, deletions, and invalidations) in this cluster. Will ignore all\n     * changes to system collections, as well as the local, admin, and config databases.\n     *\n     * @remarks\n     * watch() accepts two generic arguments for distinct use cases:\n     * - The first is to provide the schema that may be defined for all the data within the current cluster\n     * - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument\n     *\n     * @remarks\n     * When `timeoutMS` is configured for a change stream, it will have different behaviour depending\n     * on whether the change stream is in iterator mode or emitter mode. In both cases, a change\n     * stream will time out if it does not receive a change event within `timeoutMS` of the last change\n     * event.\n     *\n     * Note that if a change stream is consistently timing out when watching a collection, database or\n     * client that is being changed, then this may be due to the server timing out before it can finish\n     * processing the existing oplog. To address this, restart the change stream with a higher\n     * `timeoutMS`.\n     *\n     * If the change stream times out the initial aggregate operation to establish the change stream on\n     * the server, then the client will close the change stream. If the getMore calls to the server\n     * time out, then the change stream will be left open, but will throw a MongoOperationTimeoutError\n     * when in iterator mode and emit an error event that returns a MongoOperationTimeoutError in\n     * emitter mode.\n     *\n     * To determine whether or not the change stream is still open following a timeout, check the\n     * {@link ChangeStream.closed} getter.\n     *\n     * @example\n     * In iterator mode, if a next() call throws a timeout error, it will attempt to resume the change stream.\n     * The next call can just be retried after this succeeds.\n     * ```ts\n     * const changeStream = collection.watch([], { timeoutMS: 100 });\n     * try {\n     *     await changeStream.next();\n     * } catch (e) {\n     *     if (e instanceof MongoOperationTimeoutError && !changeStream.closed) {\n     *       await changeStream.next();\n     *     }\n     *     throw e;\n     * }\n     * ```\n     *\n     * @example\n     * In emitter mode, if the change stream goes `timeoutMS` without emitting a change event, it will\n     * emit an error event that returns a MongoOperationTimeoutError, but will not close the change\n     * stream unless the resume attempt fails. There is no need to re-establish change listeners as\n     * this will automatically continue emitting change events once the resume attempt completes.\n     *\n     * ```ts\n     * const changeStream = collection.watch([], { timeoutMS: 100 });\n     * changeStream.on('change', console.log);\n     * changeStream.on('error', e => {\n     *     if (e instanceof MongoOperationTimeoutError && !changeStream.closed) {\n     *         // do nothing\n     *     } else {\n     *         changeStream.close();\n     *     }\n     * });\n     * ```\n     * @param pipeline - An array of {@link https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\n     * @param options - Optional settings for the command\n     * @typeParam TSchema - Type of the data being detected by the change stream\n     * @typeParam TChange - Type of the whole change stream document emitted\n     */\n    watch(pipeline = [], options = {}) {\n        // Allow optionally not specifying a pipeline\n        if (!Array.isArray(pipeline)) {\n            options = pipeline;\n            pipeline = [];\n        }\n        return new change_stream_1.ChangeStream(this, pipeline, (0, utils_1.resolveOptions)(this, options));\n    }\n}\nexports.MongoClient = MongoClient;\n(0, resource_management_1.configureResourceManagement)(MongoClient.prototype);\n//# sourceMappingURL=mongo_client.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL21vbmdvX2NsaWVudC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxtQkFBbUIsR0FBRyx3QkFBd0I7QUFDOUMsYUFBYSxtQkFBTyxDQUFDLGNBQUk7QUFDekIsZUFBZSxtQkFBTyxDQUFDLDBGQUFRO0FBQy9CLHdCQUF3QixtQkFBTyxDQUFDLDRHQUFpQjtBQUNqRCw0QkFBNEIsbUJBQU8sQ0FBQyx3SUFBK0I7QUFDbkUsb0JBQW9CLG1CQUFPLENBQUMsd0hBQXVCO0FBQ25ELDRCQUE0QixtQkFBTyxDQUFDLG9IQUFxQjtBQUN6RCxvQkFBb0IsbUJBQU8sQ0FBQyxvR0FBYTtBQUN6QyxhQUFhLG1CQUFPLENBQUMsc0ZBQU07QUFDM0IsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsc0NBQXNDLG1CQUFPLENBQUMsd0lBQStCO0FBQzdFLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQyxzQkFBc0IsbUJBQU8sQ0FBQyx3R0FBZTtBQUM3QyxtQkFBbUIsbUJBQU8sQ0FBQyw0SkFBeUM7QUFDcEUsNEJBQTRCLG1CQUFPLENBQUMsMElBQWdDO0FBQ3BFLHNCQUFzQixtQkFBTyxDQUFDLDhIQUEwQjtBQUN4RCwwQkFBMEIsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDckQsOEJBQThCLG1CQUFPLENBQUMsd0hBQXVCO0FBQzdELDJCQUEyQixtQkFBTyxDQUFDLDRIQUF5QjtBQUM1RCxtQkFBbUIsbUJBQU8sQ0FBQyw0R0FBaUI7QUFDNUMsbUJBQW1CLG1CQUFPLENBQUMsa0dBQVk7QUFDdkMsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakM7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQSxpRUFBaUUsdUJBQXVCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwyQkFBMkI7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELDJCQUEyQjtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLEtBQUssZ0VBQWdFLHVCQUF1QjtBQUN6SztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QywwREFBMEQ7QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSxJQUFJO0FBQy9FO0FBQ0E7QUFDQSx1SEFBdUgsYUFBYSxJQUFJLHFGQUFxRjtBQUM3TjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixZQUFZO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsNEJBQTRCO0FBQzdHO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhFQUE4RTtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsMkJBQTJCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsZ0JBQWdCO0FBQ25FO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxnQkFBZ0I7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLHNDQUFzQyxnSEFBZ0g7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvbW9uZ29fY2xpZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Nb25nb0NsaWVudCA9IGV4cG9ydHMuU2VydmVyQXBpVmVyc2lvbiA9IHZvaWQgMDtcbmNvbnN0IGZzXzEgPSByZXF1aXJlKFwiZnNcIik7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi9ic29uXCIpO1xuY29uc3QgY2hhbmdlX3N0cmVhbV8xID0gcmVxdWlyZShcIi4vY2hhbmdlX3N0cmVhbVwiKTtcbmNvbnN0IG1vbmdvX2NyZWRlbnRpYWxzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvbW9uZ29fY3JlZGVudGlhbHNcIik7XG5jb25zdCBwcm92aWRlcnNfMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC9wcm92aWRlcnNcIik7XG5jb25zdCBjb25uZWN0aW9uX3N0cmluZ18xID0gcmVxdWlyZShcIi4vY29ubmVjdGlvbl9zdHJpbmdcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IGRiXzEgPSByZXF1aXJlKFwiLi9kYlwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX2NsaWVudF9hdXRoX3Byb3ZpZGVyc18xID0gcmVxdWlyZShcIi4vbW9uZ29fY2xpZW50X2F1dGhfcHJvdmlkZXJzXCIpO1xuY29uc3QgbW9uZ29fbG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9tb25nb19sb2dnZXJcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCBleGVjdXRvcl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9jbGllbnRfYnVsa193cml0ZS9leGVjdXRvclwiKTtcbmNvbnN0IGV4ZWN1dGVfb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uXCIpO1xuY29uc3QgcnVuX2NvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvcnVuX2NvbW1hbmRcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IHJlc291cmNlX21hbmFnZW1lbnRfMSA9IHJlcXVpcmUoXCIuL3Jlc291cmNlX21hbmFnZW1lbnRcIik7XG5jb25zdCBzZXJ2ZXJfc2VsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9zZGFtL3NlcnZlcl9zZWxlY3Rpb25cIik7XG5jb25zdCB0b3BvbG9neV8xID0gcmVxdWlyZShcIi4vc2RhbS90b3BvbG9neVwiKTtcbmNvbnN0IHNlc3Npb25zXzEgPSByZXF1aXJlKFwiLi9zZXNzaW9uc1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLlNlcnZlckFwaVZlcnNpb24gPSBPYmplY3QuZnJlZXplKHtcbiAgICB2MTogJzEnXG59KTtcbi8qKlxuICogVGhlICoqTW9uZ29DbGllbnQqKiBjbGFzcyBpcyBhIGNsYXNzIHRoYXQgYWxsb3dzIGZvciBtYWtpbmcgQ29ubmVjdGlvbnMgdG8gTW9uZ29EQi5cbiAqIEBwdWJsaWNcbiAqXG4gKiBAcmVtYXJrc1xuICogVGhlIHByb2dyYW1tYXRpY2FsbHkgcHJvdmlkZWQgb3B0aW9ucyB0YWtlIHByZWNlZGVuY2Ugb3ZlciB0aGUgVVJJIG9wdGlvbnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuICpcbiAqIC8vIEVuYWJsZSBjb21tYW5kIG1vbml0b3JpbmcgZm9yIGRlYnVnZ2luZ1xuICogY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3JywgeyBtb25pdG9yQ29tbWFuZHM6IHRydWUgfSk7XG4gKlxuICogY2xpZW50Lm9uKCdjb21tYW5kU3RhcnRlZCcsIHN0YXJ0ZWQgPT4gY29uc29sZS5sb2coc3RhcnRlZCkpO1xuICogY2xpZW50LmRiKCkuY29sbGVjdGlvbigncGV0cycpO1xuICogYXdhaXQgY2xpZW50Lmluc2VydE9uZSh7IG5hbWU6ICdzcG90Jywga2luZDogJ2RvZycgfSk7XG4gKiBgYGBcbiAqL1xuY2xhc3MgTW9uZ29DbGllbnQgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3Rvcih1cmwsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5vbignZXJyb3InLCB1dGlsc18xLm5vb3ApO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSAoMCwgY29ubmVjdGlvbl9zdHJpbmdfMS5wYXJzZU9wdGlvbnMpKHVybCwgdGhpcywgb3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IHNob3VsZFNldExvZ2dlciA9IE9iamVjdC52YWx1ZXModGhpcy5vcHRpb25zLm1vbmdvTG9nZ2VyT3B0aW9ucy5jb21wb25lbnRTZXZlcml0aWVzKS5zb21lKHZhbHVlID0+IHZhbHVlICE9PSBtb25nb19sb2dnZXJfMS5TZXZlcml0eUxldmVsLk9GRik7XG4gICAgICAgIHRoaXMubW9uZ29Mb2dnZXIgPSBzaG91bGRTZXRMb2dnZXJcbiAgICAgICAgICAgID8gbmV3IG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2VyKHRoaXMub3B0aW9ucy5tb25nb0xvZ2dlck9wdGlvbnMpXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IHRoaXM7XG4gICAgICAgIC8vIFRoZSBpbnRlcm5hbCBzdGF0ZVxuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICBic29uT3B0aW9uczogKDAsIGJzb25fMS5yZXNvbHZlQlNPTk9wdGlvbnMpKHRoaXMub3B0aW9ucyksXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICgwLCB1dGlsc18xLm5zKSgnYWRtaW4nKSxcbiAgICAgICAgICAgIGhhc0JlZW5DbG9zZWQ6IGZhbHNlLFxuICAgICAgICAgICAgc2Vzc2lvblBvb2w6IG5ldyBzZXNzaW9uc18xLlNlcnZlclNlc3Npb25Qb29sKHRoaXMpLFxuICAgICAgICAgICAgYWN0aXZlU2Vzc2lvbnM6IG5ldyBTZXQoKSxcbiAgICAgICAgICAgIGFjdGl2ZUN1cnNvcnM6IG5ldyBTZXQoKSxcbiAgICAgICAgICAgIGF1dGhQcm92aWRlcnM6IG5ldyBtb25nb19jbGllbnRfYXV0aF9wcm92aWRlcnNfMS5Nb25nb0NsaWVudEF1dGhQcm92aWRlcnMoKSxcbiAgICAgICAgICAgIGdldCBvcHRpb25zKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnQub3B0aW9ucztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXQgcmVhZENvbmNlcm4oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5vcHRpb25zLnJlYWRDb25jZXJuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldCB3cml0ZUNvbmNlcm4oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5vcHRpb25zLndyaXRlQ29uY2VybjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXQgcmVhZFByZWZlcmVuY2UoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5vcHRpb25zLnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldCBpc01vbmdvQ2xpZW50KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNoZWNrRm9yTm9uR2VudWluZUhvc3RzKCk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBhc3luY0Rpc3Bvc2UoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNoZWNrRm9yTm9uR2VudWluZUhvc3RzKCkge1xuICAgICAgICBjb25zdCBkb2N1bWVudERCSG9zdG5hbWVzID0gdGhpcy5vcHRpb25zLmhvc3RzLmZpbHRlcigoaG9zdEFkZHJlc3MpID0+ICgwLCB1dGlsc18xLmlzSG9zdE1hdGNoKSh1dGlsc18xLkRPQ1VNRU5UX0RCX0NIRUNLLCBob3N0QWRkcmVzcy5ob3N0KSk7XG4gICAgICAgIGNvbnN0IHNydkhvc3RJc0RvY3VtZW50REIgPSAoMCwgdXRpbHNfMS5pc0hvc3RNYXRjaCkodXRpbHNfMS5ET0NVTUVOVF9EQl9DSEVDSywgdGhpcy5vcHRpb25zLnNydkhvc3QpO1xuICAgICAgICBjb25zdCBjb3Ntb3NEQkhvc3RuYW1lcyA9IHRoaXMub3B0aW9ucy5ob3N0cy5maWx0ZXIoKGhvc3RBZGRyZXNzKSA9PiAoMCwgdXRpbHNfMS5pc0hvc3RNYXRjaCkodXRpbHNfMS5DT1NNT1NfREJfQ0hFQ0ssIGhvc3RBZGRyZXNzLmhvc3QpKTtcbiAgICAgICAgY29uc3Qgc3J2SG9zdElzQ29zbW9zREIgPSAoMCwgdXRpbHNfMS5pc0hvc3RNYXRjaCkodXRpbHNfMS5DT1NNT1NfREJfQ0hFQ0ssIHRoaXMub3B0aW9ucy5zcnZIb3N0KTtcbiAgICAgICAgaWYgKGRvY3VtZW50REJIb3N0bmFtZXMubGVuZ3RoICE9PSAwIHx8IHNydkhvc3RJc0RvY3VtZW50REIpIHtcbiAgICAgICAgICAgIHRoaXMubW9uZ29Mb2dnZXI/LmluZm8oJ2NsaWVudCcsIHV0aWxzXzEuRE9DVU1FTlRfREJfTVNHKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb3Ntb3NEQkhvc3RuYW1lcy5sZW5ndGggIT09IDAgfHwgc3J2SG9zdElzQ29zbW9zREIpIHtcbiAgICAgICAgICAgIHRoaXMubW9uZ29Mb2dnZXI/LmluZm8oJ2NsaWVudCcsIHV0aWxzXzEuQ09TTU9TX0RCX01TRyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHNlcnZlckFwaSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zZXJ2ZXJBcGkgJiYgT2JqZWN0LmZyZWV6ZSh7IC4uLnRoaXMub3B0aW9ucy5zZXJ2ZXJBcGkgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEludGVuZGVkIGZvciBBUE0gdXNlIG9ubHlcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBnZXQgbW9uaXRvckNvbW1hbmRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1vbml0b3JDb21tYW5kcztcbiAgICB9XG4gICAgc2V0IG1vbml0b3JDb21tYW5kcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMubW9uaXRvckNvbW1hbmRzID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXQgYXV0b0VuY3J5cHRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5hdXRvRW5jcnlwdGVyO1xuICAgIH1cbiAgICBnZXQgcmVhZENvbmNlcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMucmVhZENvbmNlcm47XG4gICAgfVxuICAgIGdldCB3cml0ZUNvbmNlcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMud3JpdGVDb25jZXJuO1xuICAgIH1cbiAgICBnZXQgcmVhZFByZWZlcmVuY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGdldCBic29uT3B0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5ic29uT3B0aW9ucztcbiAgICB9XG4gICAgZ2V0IHRpbWVvdXRNUygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLnRpbWVvdXRNUztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZXMgYSBjbGllbnQgYnVsayB3cml0ZSBvcGVyYXRpb24sIGF2YWlsYWJsZSBvbiBzZXJ2ZXIgOC4wKy5cbiAgICAgKiBAcGFyYW0gbW9kZWxzIC0gVGhlIGNsaWVudCBidWxrIHdyaXRlIG1vZGVscy5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIFRoZSBjbGllbnQgYnVsayB3cml0ZSBvcHRpb25zLlxuICAgICAqIEByZXR1cm5zIEEgQ2xpZW50QnVsa1dyaXRlUmVzdWx0IGZvciBhY2tub3dsZWRnZWQgd3JpdGVzIGFuZCBvazogMSBmb3IgdW5hY2tub3dsZWRnZWQgd3JpdGVzLlxuICAgICAqL1xuICAgIGFzeW5jIGJ1bGtXcml0ZShtb2RlbHMsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHRoaXMuYXV0b0VuY3J5cHRlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignTW9uZ29DbGllbnQgYnVsa1dyaXRlIGRvZXMgbm90IGN1cnJlbnRseSBzdXBwb3J0IGF1dG9tYXRpYyBlbmNyeXB0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGRvIG5vdCBuZWVkIHNjaGVtYSB0eXBlIGluZm9ybWF0aW9uIHBhc3QgdGhpcyBwb2ludCAoXCJhcyBhbnlcIiBpcyBmaW5lKVxuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IGV4ZWN1dG9yXzEuQ2xpZW50QnVsa1dyaXRlRXhlY3V0b3IodGhpcywgbW9kZWxzLCAoMCwgdXRpbHNfMS5yZXNvbHZlT3B0aW9ucykodGhpcywgb3B0aW9ucykpLmV4ZWN1dGUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29ubmVjdCB0byBNb25nb0RCIHVzaW5nIGEgdXJsXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIENhbGxpbmcgYGNvbm5lY3RgIGlzIG9wdGlvbmFsIHNpbmNlIHRoZSBmaXJzdCBvcGVyYXRpb24geW91IHBlcmZvcm0gd2lsbCBjYWxsIGBjb25uZWN0YCBpZiBpdCdzIG5lZWRlZC5cbiAgICAgKiBgdGltZW91dE1TYCB3aWxsIGJvdW5kIHRoZSB0aW1lIGFueSBvcGVyYXRpb24gY2FuIHRha2UgYmVmb3JlIHRocm93aW5nIGEgdGltZW91dCBlcnJvci5cbiAgICAgKiBIb3dldmVyLCB3aGVuIHRoZSBvcGVyYXRpb24gYmVpbmcgcnVuIGlzIGF1dG9tYXRpY2FsbHkgY29ubmVjdGluZyB5b3VyIGBNb25nb0NsaWVudGAgdGhlIGB0aW1lb3V0TVNgIHdpbGwgbm90IGFwcGx5IHRvIHRoZSB0aW1lIHRha2VuIHRvIGNvbm5lY3QgdGhlIE1vbmdvQ2xpZW50LlxuICAgICAqIFRoaXMgbWVhbnMgdGhlIHRpbWUgdG8gc2V0dXAgdGhlIGBNb25nb0NsaWVudGAgZG9lcyBub3QgY291bnQgYWdhaW5zdCBgdGltZW91dE1TYC5cbiAgICAgKiBJZiB5b3UgYXJlIHVzaW5nIGB0aW1lb3V0TVNgIHdlIHJlY29tbWVuZCBjb25uZWN0aW5nIHlvdXIgY2xpZW50IGV4cGxpY2l0bHkgaW4gYWR2YW5jZSBvZiBhbnkgb3BlcmF0aW9uIHRvIGF2b2lkIHRoaXMgaW5jb25zaXN0ZW50IGV4ZWN1dGlvbiB0aW1lLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGUgZHJpdmVyIHdpbGwgbG9vayB1cCBjb3JyZXNwb25kaW5nIFNSViBhbmQgVFhUIHJlY29yZHMgaWYgdGhlIGNvbm5lY3Rpb24gc3RyaW5nIHN0YXJ0cyB3aXRoIGBtb25nb2RiK3NydjovL2AuXG4gICAgICogSWYgdGhvc2UgbG9vayB1cHMgdGhyb3cgYSBETlMgVGltZW91dCBlcnJvciwgdGhlIGRyaXZlciB3aWxsIHJldHJ5IHRoZSBsb29rIHVwIG9uY2UuXG4gICAgICpcbiAgICAgKiBAc2VlIGRvY3MubW9uZ29kYi5vcmcvbWFudWFsL3JlZmVyZW5jZS9jb25uZWN0aW9uLXN0cmluZy9cbiAgICAgKi9cbiAgICBhc3luYyBjb25uZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uTG9jaykge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29ubmVjdGlvbkxvY2s7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbkxvY2sgPSB0aGlzLl9jb25uZWN0KCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNvbm5lY3Rpb25Mb2NrO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgLy8gcmVsZWFzZVxuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uTG9jayA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgdG9wb2xvZ3kgdG8gb3BlbiB0aGUgY29ubmVjdGlvbiwgbXVzdCBiZSBsb2NrZWQgdG8gYXZvaWQgdG9wb2xvZ3kgbGVha3MgaW4gY29uY3VycmVuY3kgc2NlbmFyaW8uXG4gICAgICogTG9ja2luZyBpcyBlbmZvcmNlZCBieSB0aGUgY29ubmVjdCBtZXRob2QuXG4gICAgICpcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBhc3luYyBfY29ubmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMudG9wb2xvZ3kgJiYgdGhpcy50b3BvbG9neS5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBpZiAob3B0aW9ucy50bHMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50bHNDQUZpbGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jYSA/Pz0gYXdhaXQgZnNfMS5wcm9taXNlcy5yZWFkRmlsZShvcHRpb25zLnRsc0NBRmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMudGxzQ1JMRmlsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNybCA/Pz0gYXdhaXQgZnNfMS5wcm9taXNlcy5yZWFkRmlsZShvcHRpb25zLnRsc0NSTEZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnRsc0NlcnRpZmljYXRlS2V5RmlsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMua2V5IHx8ICFvcHRpb25zLmNlcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudHMgPSBhd2FpdCBmc18xLnByb21pc2VzLnJlYWRGaWxlKG9wdGlvbnMudGxzQ2VydGlmaWNhdGVLZXlGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5rZXkgPz89IGNvbnRlbnRzO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNlcnQgPz89IGNvbnRlbnRzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuc3J2SG9zdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IGhvc3RzID0gYXdhaXQgKDAsIGNvbm5lY3Rpb25fc3RyaW5nXzEucmVzb2x2ZVNSVlJlY29yZCkob3B0aW9ucyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtpbmRleCwgaG9zdF0gb2YgaG9zdHMuZW50cmllcygpKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5ob3N0c1tpbmRleF0gPSBob3N0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEl0IGlzIGltcG9ydGFudCB0byBwZXJmb3JtIHZhbGlkYXRpb24gb2YgaG9zdHMgQUZURVIgU1JWIHJlc29sdXRpb24sIHRvIGNoZWNrIHRoZSByZWFsIGhvc3RuYW1lLFxuICAgICAgICAvLyBidXQgQkVGT1JFIHdlIGV2ZW4gYXR0ZW1wdCBjb25uZWN0aW5nIHdpdGggYSBwb3RlbnRpYWxseSBub3QgYWxsb3dlZCBob3N0bmFtZVxuICAgICAgICBpZiAob3B0aW9ucy5jcmVkZW50aWFscz8ubWVjaGFuaXNtID09PSBwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQykge1xuICAgICAgICAgICAgY29uc3QgYWxsb3dlZEhvc3RzID0gb3B0aW9ucy5jcmVkZW50aWFscz8ubWVjaGFuaXNtUHJvcGVydGllcz8uQUxMT1dFRF9IT1NUUyB8fCBtb25nb19jcmVkZW50aWFsc18xLkRFRkFVTFRfQUxMT1dFRF9IT1NUUztcbiAgICAgICAgICAgIGNvbnN0IGlzU2VydmljZUF1dGggPSAhIW9wdGlvbnMuY3JlZGVudGlhbHM/Lm1lY2hhbmlzbVByb3BlcnRpZXM/LkVOVklST05NRU5UO1xuICAgICAgICAgICAgaWYgKCFpc1NlcnZpY2VBdXRoKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBob3N0IG9mIG9wdGlvbnMuaG9zdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5ob3N0TWF0Y2hlc1dpbGRjYXJkcykoaG9zdC50b0hvc3RQb3J0KCkuaG9zdCwgYWxsb3dlZEhvc3RzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgSG9zdCAnJHtob3N0fScgaXMgbm90IHZhbGlkIGZvciBPSURDIGF1dGhlbnRpY2F0aW9uIHdpdGggQUxMT1dFRF9IT1NUUyBvZiAnJHthbGxvd2VkSG9zdHMuam9pbignLCcpfSdgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRvcG9sb2d5ID0gbmV3IHRvcG9sb2d5XzEuVG9wb2xvZ3kodGhpcywgb3B0aW9ucy5ob3N0cywgb3B0aW9ucyk7XG4gICAgICAgIC8vIEV2ZW50cyBjYW4gYmUgZW1pdHRlZCBiZWZvcmUgaW5pdGlhbGl6YXRpb24gaXMgY29tcGxldGUgc28gd2UgaGF2ZSB0b1xuICAgICAgICAvLyBzYXZlIHRoZSByZWZlcmVuY2UgdG8gdGhlIHRvcG9sb2d5IG9uIHRoZSBjbGllbnQgQVNBUCBpZiB0aGUgZXZlbnQgaGFuZGxlcnMgbmVlZCB0byBhY2Nlc3MgaXRcbiAgICAgICAgdGhpcy50b3BvbG9neS5vbmNlKHRvcG9sb2d5XzEuVG9wb2xvZ3kuT1BFTiwgKCkgPT4gdGhpcy5lbWl0KCdvcGVuJywgdGhpcykpO1xuICAgICAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGNvbnN0YW50c18xLk1PTkdPX0NMSUVOVF9FVkVOVFMpIHtcbiAgICAgICAgICAgIHRoaXMudG9wb2xvZ3kub24oZXZlbnQsICguLi5hcmdzKSA9PiB0aGlzLmVtaXQoZXZlbnQsIC4uLmFyZ3MpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0b3BvbG9neUNvbm5lY3QgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudG9wb2xvZ3k/LmNvbm5lY3Qob3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvcG9sb2d5Py5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5hdXRvRW5jcnlwdGVyKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmF1dG9FbmNyeXB0ZXI/LmluaXQoKTtcbiAgICAgICAgICAgIGF3YWl0IHRvcG9sb2d5Q29ubmVjdCgpO1xuICAgICAgICAgICAgYXdhaXQgb3B0aW9ucy5lbmNyeXB0ZXIuY29ubmVjdEludGVybmFsQ2xpZW50KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0b3BvbG9neUNvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYW5zIHVwIGNsaWVudC1zaWRlIHJlc291cmNlcyB1c2VkIGJ5IHRoZSBNb25nb0NMaWVudCBhbmQgLiAgVGhpcyBpbmNsdWRlczpcbiAgICAgKlxuICAgICAqIC0gQ2xvc2VzIGFsbCBvcGVuLCB1bnVzZWQgY29ubmVjdGlvbnMgKHNlZSBub3RlKS5cbiAgICAgKiAtIEVuZHMgYWxsIGluLXVzZSBzZXNzaW9ucyB3aXRoIHtAbGluayBDbGllbnRTZXNzaW9uI2VuZFNlc3Npb258Q2xpZW50U2Vzc2lvbi5lbmRTZXNzaW9uKCl9LlxuICAgICAqIC0gRW5kcyBhbGwgdW51c2VkIHNlc3Npb25zIHNlcnZlci1zaWRlLlxuICAgICAqIC0gQ2xlYW5zIHVwIGFueSByZXNvdXJjZXMgYmVpbmcgdXNlZCBmb3IgYXV0byBlbmNyeXB0aW9uIGlmIGF1dG8gZW5jcnlwdGlvbiBpcyBlbmFibGVkLlxuICAgICAqXG4gICAgICogQHJlbWFya3MgQW55IGluLXByb2dyZXNzIG9wZXJhdGlvbnMgYXJlIG5vdCBraWxsZWQgYW5kIGFueSBjb25uZWN0aW9ucyB1c2VkIGJ5IGluIHByb2dyZXNzIG9wZXJhdGlvbnNcbiAgICAgKiB3aWxsIGJlIGNsZWFuZWQgdXAgbGF6aWx5IGFzIG9wZXJhdGlvbnMgZmluaXNoLlxuICAgICAqXG4gICAgICogQHBhcmFtIGZvcmNlIC0gRm9yY2UgY2xvc2UsIGVtaXR0aW5nIG5vIGV2ZW50c1xuICAgICAqL1xuICAgIGFzeW5jIGNsb3NlKGZvcmNlID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VMb2NrKSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jbG9zZUxvY2s7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VMb2NrID0gdGhpcy5fY2xvc2UoZm9yY2UpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jbG9zZUxvY2s7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAvLyByZWxlYXNlXG4gICAgICAgICAgICB0aGlzLmNsb3NlTG9jayA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBfY2xvc2UoZm9yY2UgPSBmYWxzZSkge1xuICAgICAgICAvLyBUaGVyZSdzIG5vIHdheSB0byBzZXQgaGFzQmVlbkNsb3NlZCBiYWNrIHRvIGZhbHNlXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLnMsICdoYXNCZWVuQ2xvc2VkJywge1xuICAgICAgICAgICAgdmFsdWU6IHRydWUsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYWN0aXZlQ3Vyc29yQ2xvc2VzID0gQXJyYXkuZnJvbSh0aGlzLnMuYWN0aXZlQ3Vyc29ycywgY3Vyc29yID0+IGN1cnNvci5jbG9zZSgpKTtcbiAgICAgICAgdGhpcy5zLmFjdGl2ZUN1cnNvcnMuY2xlYXIoKTtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWN0aXZlQ3Vyc29yQ2xvc2VzKTtcbiAgICAgICAgY29uc3QgYWN0aXZlU2Vzc2lvbkVuZHMgPSBBcnJheS5mcm9tKHRoaXMucy5hY3RpdmVTZXNzaW9ucywgc2Vzc2lvbiA9PiBzZXNzaW9uLmVuZFNlc3Npb24oKSk7XG4gICAgICAgIHRoaXMucy5hY3RpdmVTZXNzaW9ucy5jbGVhcigpO1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChhY3RpdmVTZXNzaW9uRW5kcyk7XG4gICAgICAgIGlmICh0aGlzLnRvcG9sb2d5ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSB3b3VsZCBhdHRlbXB0IHRvIHNlbGVjdCBhIHNlcnZlciBhbmQgZ2V0IG5vdGhpbmcgYmFjayB3ZSBzaG9ydCBjaXJjdWl0XG4gICAgICAgIC8vIHRvIGF2b2lkIHRoZSBzZXJ2ZXIgc2VsZWN0aW9uIHRpbWVvdXQuXG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yKShyZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5UHJlZmVycmVkKTtcbiAgICAgICAgY29uc3QgdG9wb2xvZ3lEZXNjcmlwdGlvbiA9IHRoaXMudG9wb2xvZ3kuZGVzY3JpcHRpb247XG4gICAgICAgIGNvbnN0IHNlcnZlckRlc2NyaXB0aW9ucyA9IEFycmF5LmZyb20odG9wb2xvZ3lEZXNjcmlwdGlvbi5zZXJ2ZXJzLnZhbHVlcygpKTtcbiAgICAgICAgY29uc3Qgc2VydmVycyA9IHNlbGVjdG9yKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlckRlc2NyaXB0aW9ucyk7XG4gICAgICAgIGlmIChzZXJ2ZXJzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgY29uc3QgZW5kU2Vzc2lvbnMgPSBBcnJheS5mcm9tKHRoaXMucy5zZXNzaW9uUG9vbC5zZXNzaW9ucywgKHsgaWQgfSkgPT4gaWQpO1xuICAgICAgICAgICAgaWYgKGVuZFNlc3Npb25zLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMsIG5ldyBydW5fY29tbWFuZF8xLlJ1bkFkbWluQ29tbWFuZE9wZXJhdGlvbih7IGVuZFNlc3Npb25zIH0sIHsgcmVhZFByZWZlcmVuY2U6IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnlQcmVmZXJyZWQsIG5vUmVzcG9uc2U6IHRydWUgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgKDAsIHV0aWxzXzEuc3F1YXNoRXJyb3IpKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gY2xlYXIgb3V0IHJlZmVyZW5jZXMgdG8gb2xkIHRvcG9sb2d5XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5ID0gdGhpcy50b3BvbG9neTtcbiAgICAgICAgdGhpcy50b3BvbG9neSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdG9wb2xvZ3kuY2xvc2UoKTtcbiAgICAgICAgY29uc3QgeyBlbmNyeXB0ZXIgfSA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgaWYgKGVuY3J5cHRlcikge1xuICAgICAgICAgICAgYXdhaXQgZW5jcnlwdGVyLmNsb3NlKHRoaXMsIGZvcmNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgRGIgaW5zdGFuY2Ugc2hhcmluZyB0aGUgY3VycmVudCBzb2NrZXQgY29ubmVjdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGJOYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGRhdGFiYXNlIHdlIHdhbnQgdG8gdXNlLiBJZiBub3QgcHJvdmlkZWQsIHVzZSBkYXRhYmFzZSBuYW1lIGZyb20gY29ubmVjdGlvbiBzdHJpbmcuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgRGIgY29uc3RydWN0aW9uXG4gICAgICovXG4gICAgZGIoZGJOYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICAvLyBEZWZhdWx0IHRvIGRiIGZyb20gY29ubmVjdGlvbiBzdHJpbmcgaWYgbm90IHByb3ZpZGVkXG4gICAgICAgIGlmICghZGJOYW1lKSB7XG4gICAgICAgICAgICBkYk5hbWUgPSB0aGlzLnMub3B0aW9ucy5kYk5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ29weSB0aGUgb3B0aW9ucyBhbmQgYWRkIG91dCBpbnRlcm5hbCBvdmVycmlkZSBvZiB0aGUgbm90IHNoYXJlZCBmbGFnXG4gICAgICAgIGNvbnN0IGZpbmFsT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICAgIC8vIFJldHVybiB0aGUgZGIgb2JqZWN0XG4gICAgICAgIGNvbnN0IGRiID0gbmV3IGRiXzEuRGIodGhpcywgZGJOYW1lLCBmaW5hbE9wdGlvbnMpO1xuICAgICAgICAvLyBSZXR1cm4gdGhlIGRhdGFiYXNlXG4gICAgICAgIHJldHVybiBkYjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29ubmVjdCB0byBNb25nb0RCIHVzaW5nIGEgdXJsXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIENhbGxpbmcgYGNvbm5lY3RgIGlzIG9wdGlvbmFsIHNpbmNlIHRoZSBmaXJzdCBvcGVyYXRpb24geW91IHBlcmZvcm0gd2lsbCBjYWxsIGBjb25uZWN0YCBpZiBpdCdzIG5lZWRlZC5cbiAgICAgKiBgdGltZW91dE1TYCB3aWxsIGJvdW5kIHRoZSB0aW1lIGFueSBvcGVyYXRpb24gY2FuIHRha2UgYmVmb3JlIHRocm93aW5nIGEgdGltZW91dCBlcnJvci5cbiAgICAgKiBIb3dldmVyLCB3aGVuIHRoZSBvcGVyYXRpb24gYmVpbmcgcnVuIGlzIGF1dG9tYXRpY2FsbHkgY29ubmVjdGluZyB5b3VyIGBNb25nb0NsaWVudGAgdGhlIGB0aW1lb3V0TVNgIHdpbGwgbm90IGFwcGx5IHRvIHRoZSB0aW1lIHRha2VuIHRvIGNvbm5lY3QgdGhlIE1vbmdvQ2xpZW50LlxuICAgICAqIFRoaXMgbWVhbnMgdGhlIHRpbWUgdG8gc2V0dXAgdGhlIGBNb25nb0NsaWVudGAgZG9lcyBub3QgY291bnQgYWdhaW5zdCBgdGltZW91dE1TYC5cbiAgICAgKiBJZiB5b3UgYXJlIHVzaW5nIGB0aW1lb3V0TVNgIHdlIHJlY29tbWVuZCBjb25uZWN0aW5nIHlvdXIgY2xpZW50IGV4cGxpY2l0bHkgaW4gYWR2YW5jZSBvZiBhbnkgb3BlcmF0aW9uIHRvIGF2b2lkIHRoaXMgaW5jb25zaXN0ZW50IGV4ZWN1dGlvbiB0aW1lLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGUgcHJvZ3JhbW1hdGljYWxseSBwcm92aWRlZCBvcHRpb25zIHRha2UgcHJlY2VkZW5jZSBvdmVyIHRoZSBVUkkgb3B0aW9ucy5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhlIGRyaXZlciB3aWxsIGxvb2sgdXAgY29ycmVzcG9uZGluZyBTUlYgYW5kIFRYVCByZWNvcmRzIGlmIHRoZSBjb25uZWN0aW9uIHN0cmluZyBzdGFydHMgd2l0aCBgbW9uZ29kYitzcnY6Ly9gLlxuICAgICAqIElmIHRob3NlIGxvb2sgdXBzIHRocm93IGEgRE5TIFRpbWVvdXQgZXJyb3IsIHRoZSBkcml2ZXIgd2lsbCByZXRyeSB0aGUgbG9vayB1cCBvbmNlLlxuICAgICAqXG4gICAgICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvY29ubmVjdGlvbi1zdHJpbmcvXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGNvbm5lY3QodXJsLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyB0aGlzKHVybCwgb3B0aW9ucyk7XG4gICAgICAgIHJldHVybiBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IENsaWVudFNlc3Npb24uIFdoZW4gdXNpbmcgdGhlIHJldHVybmVkIHNlc3Npb24gaW4gYW4gb3BlcmF0aW9uXG4gICAgICogYSBjb3JyZXNwb25kaW5nIFNlcnZlclNlc3Npb24gd2lsbCBiZSBjcmVhdGVkLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBBIENsaWVudFNlc3Npb24gaW5zdGFuY2UgbWF5IG9ubHkgYmUgcGFzc2VkIHRvIG9wZXJhdGlvbnMgYmVpbmcgcGVyZm9ybWVkIG9uIHRoZSBzYW1lXG4gICAgICogTW9uZ29DbGllbnQgaXQgd2FzIHN0YXJ0ZWQgZnJvbS5cbiAgICAgKi9cbiAgICBzdGFydFNlc3Npb24ob3B0aW9ucykge1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gbmV3IHNlc3Npb25zXzEuQ2xpZW50U2Vzc2lvbih0aGlzLCB0aGlzLnMuc2Vzc2lvblBvb2wsIHsgZXhwbGljaXQ6IHRydWUsIC4uLm9wdGlvbnMgfSwgdGhpcy5vcHRpb25zKTtcbiAgICAgICAgdGhpcy5zLmFjdGl2ZVNlc3Npb25zLmFkZChzZXNzaW9uKTtcbiAgICAgICAgc2Vzc2lvbi5vbmNlKCdlbmRlZCcsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucy5hY3RpdmVTZXNzaW9ucy5kZWxldGUoc2Vzc2lvbik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICB9XG4gICAgYXN5bmMgd2l0aFNlc3Npb24ob3B0aW9uc09yRXhlY3V0b3IsIGV4ZWN1dG9yKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAvLyBBbHdheXMgZGVmaW5lIGFuIG93bmVyXG4gICAgICAgICAgICBvd25lcjogU3ltYm9sKCksXG4gICAgICAgICAgICAvLyBJZiBpdCdzIGFuIG9iamVjdCBpbmhlcml0IHRoZSBvcHRpb25zXG4gICAgICAgICAgICAuLi4odHlwZW9mIG9wdGlvbnNPckV4ZWN1dG9yID09PSAnb2JqZWN0JyA/IG9wdGlvbnNPckV4ZWN1dG9yIDoge30pXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHdpdGhTZXNzaW9uQ2FsbGJhY2sgPSB0eXBlb2Ygb3B0aW9uc09yRXhlY3V0b3IgPT09ICdmdW5jdGlvbicgPyBvcHRpb25zT3JFeGVjdXRvciA6IGV4ZWN1dG9yO1xuICAgICAgICBpZiAod2l0aFNlc3Npb25DYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdNaXNzaW5nIHJlcXVpcmVkIGNhbGxiYWNrIHBhcmFtZXRlcicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnN0YXJ0U2Vzc2lvbihvcHRpb25zKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB3aXRoU2Vzc2lvbkNhbGxiYWNrKHNlc3Npb24pO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzZXNzaW9uLmVuZFNlc3Npb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IENoYW5nZSBTdHJlYW0sIHdhdGNoaW5nIGZvciBuZXcgY2hhbmdlcyAoaW5zZXJ0aW9ucywgdXBkYXRlcyxcbiAgICAgKiByZXBsYWNlbWVudHMsIGRlbGV0aW9ucywgYW5kIGludmFsaWRhdGlvbnMpIGluIHRoaXMgY2x1c3Rlci4gV2lsbCBpZ25vcmUgYWxsXG4gICAgICogY2hhbmdlcyB0byBzeXN0ZW0gY29sbGVjdGlvbnMsIGFzIHdlbGwgYXMgdGhlIGxvY2FsLCBhZG1pbiwgYW5kIGNvbmZpZyBkYXRhYmFzZXMuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIHdhdGNoKCkgYWNjZXB0cyB0d28gZ2VuZXJpYyBhcmd1bWVudHMgZm9yIGRpc3RpbmN0IHVzZSBjYXNlczpcbiAgICAgKiAtIFRoZSBmaXJzdCBpcyB0byBwcm92aWRlIHRoZSBzY2hlbWEgdGhhdCBtYXkgYmUgZGVmaW5lZCBmb3IgYWxsIHRoZSBkYXRhIHdpdGhpbiB0aGUgY3VycmVudCBjbHVzdGVyXG4gICAgICogLSBUaGUgc2Vjb25kIGlzIHRvIG92ZXJyaWRlIHRoZSBzaGFwZSBvZiB0aGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBlbnRpcmVseSwgaWYgaXQgaXMgbm90IHByb3ZpZGVkIHRoZSB0eXBlIHdpbGwgZGVmYXVsdCB0byBDaGFuZ2VTdHJlYW1Eb2N1bWVudCBvZiB0aGUgZmlyc3QgYXJndW1lbnRcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogV2hlbiBgdGltZW91dE1TYCBpcyBjb25maWd1cmVkIGZvciBhIGNoYW5nZSBzdHJlYW0sIGl0IHdpbGwgaGF2ZSBkaWZmZXJlbnQgYmVoYXZpb3VyIGRlcGVuZGluZ1xuICAgICAqIG9uIHdoZXRoZXIgdGhlIGNoYW5nZSBzdHJlYW0gaXMgaW4gaXRlcmF0b3IgbW9kZSBvciBlbWl0dGVyIG1vZGUuIEluIGJvdGggY2FzZXMsIGEgY2hhbmdlXG4gICAgICogc3RyZWFtIHdpbGwgdGltZSBvdXQgaWYgaXQgZG9lcyBub3QgcmVjZWl2ZSBhIGNoYW5nZSBldmVudCB3aXRoaW4gYHRpbWVvdXRNU2Agb2YgdGhlIGxhc3QgY2hhbmdlXG4gICAgICogZXZlbnQuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgaWYgYSBjaGFuZ2Ugc3RyZWFtIGlzIGNvbnNpc3RlbnRseSB0aW1pbmcgb3V0IHdoZW4gd2F0Y2hpbmcgYSBjb2xsZWN0aW9uLCBkYXRhYmFzZSBvclxuICAgICAqIGNsaWVudCB0aGF0IGlzIGJlaW5nIGNoYW5nZWQsIHRoZW4gdGhpcyBtYXkgYmUgZHVlIHRvIHRoZSBzZXJ2ZXIgdGltaW5nIG91dCBiZWZvcmUgaXQgY2FuIGZpbmlzaFxuICAgICAqIHByb2Nlc3NpbmcgdGhlIGV4aXN0aW5nIG9wbG9nLiBUbyBhZGRyZXNzIHRoaXMsIHJlc3RhcnQgdGhlIGNoYW5nZSBzdHJlYW0gd2l0aCBhIGhpZ2hlclxuICAgICAqIGB0aW1lb3V0TVNgLlxuICAgICAqXG4gICAgICogSWYgdGhlIGNoYW5nZSBzdHJlYW0gdGltZXMgb3V0IHRoZSBpbml0aWFsIGFnZ3JlZ2F0ZSBvcGVyYXRpb24gdG8gZXN0YWJsaXNoIHRoZSBjaGFuZ2Ugc3RyZWFtIG9uXG4gICAgICogdGhlIHNlcnZlciwgdGhlbiB0aGUgY2xpZW50IHdpbGwgY2xvc2UgdGhlIGNoYW5nZSBzdHJlYW0uIElmIHRoZSBnZXRNb3JlIGNhbGxzIHRvIHRoZSBzZXJ2ZXJcbiAgICAgKiB0aW1lIG91dCwgdGhlbiB0aGUgY2hhbmdlIHN0cmVhbSB3aWxsIGJlIGxlZnQgb3BlbiwgYnV0IHdpbGwgdGhyb3cgYSBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvclxuICAgICAqIHdoZW4gaW4gaXRlcmF0b3IgbW9kZSBhbmQgZW1pdCBhbiBlcnJvciBldmVudCB0aGF0IHJldHVybnMgYSBNb25nb09wZXJhdGlvblRpbWVvdXRFcnJvciBpblxuICAgICAqIGVtaXR0ZXIgbW9kZS5cbiAgICAgKlxuICAgICAqIFRvIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0aGUgY2hhbmdlIHN0cmVhbSBpcyBzdGlsbCBvcGVuIGZvbGxvd2luZyBhIHRpbWVvdXQsIGNoZWNrIHRoZVxuICAgICAqIHtAbGluayBDaGFuZ2VTdHJlYW0uY2xvc2VkfSBnZXR0ZXIuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIEluIGl0ZXJhdG9yIG1vZGUsIGlmIGEgbmV4dCgpIGNhbGwgdGhyb3dzIGEgdGltZW91dCBlcnJvciwgaXQgd2lsbCBhdHRlbXB0IHRvIHJlc3VtZSB0aGUgY2hhbmdlIHN0cmVhbS5cbiAgICAgKiBUaGUgbmV4dCBjYWxsIGNhbiBqdXN0IGJlIHJldHJpZWQgYWZ0ZXIgdGhpcyBzdWNjZWVkcy5cbiAgICAgKiBgYGB0c1xuICAgICAqIGNvbnN0IGNoYW5nZVN0cmVhbSA9IGNvbGxlY3Rpb24ud2F0Y2goW10sIHsgdGltZW91dE1TOiAxMDAgfSk7XG4gICAgICogdHJ5IHtcbiAgICAgKiAgICAgYXdhaXQgY2hhbmdlU3RyZWFtLm5leHQoKTtcbiAgICAgKiB9IGNhdGNoIChlKSB7XG4gICAgICogICAgIGlmIChlIGluc3RhbmNlb2YgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgJiYgIWNoYW5nZVN0cmVhbS5jbG9zZWQpIHtcbiAgICAgKiAgICAgICBhd2FpdCBjaGFuZ2VTdHJlYW0ubmV4dCgpO1xuICAgICAqICAgICB9XG4gICAgICogICAgIHRocm93IGU7XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBJbiBlbWl0dGVyIG1vZGUsIGlmIHRoZSBjaGFuZ2Ugc3RyZWFtIGdvZXMgYHRpbWVvdXRNU2Agd2l0aG91dCBlbWl0dGluZyBhIGNoYW5nZSBldmVudCwgaXQgd2lsbFxuICAgICAqIGVtaXQgYW4gZXJyb3IgZXZlbnQgdGhhdCByZXR1cm5zIGEgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IsIGJ1dCB3aWxsIG5vdCBjbG9zZSB0aGUgY2hhbmdlXG4gICAgICogc3RyZWFtIHVubGVzcyB0aGUgcmVzdW1lIGF0dGVtcHQgZmFpbHMuIFRoZXJlIGlzIG5vIG5lZWQgdG8gcmUtZXN0YWJsaXNoIGNoYW5nZSBsaXN0ZW5lcnMgYXNcbiAgICAgKiB0aGlzIHdpbGwgYXV0b21hdGljYWxseSBjb250aW51ZSBlbWl0dGluZyBjaGFuZ2UgZXZlbnRzIG9uY2UgdGhlIHJlc3VtZSBhdHRlbXB0IGNvbXBsZXRlcy5cbiAgICAgKlxuICAgICAqIGBgYHRzXG4gICAgICogY29uc3QgY2hhbmdlU3RyZWFtID0gY29sbGVjdGlvbi53YXRjaChbXSwgeyB0aW1lb3V0TVM6IDEwMCB9KTtcbiAgICAgKiBjaGFuZ2VTdHJlYW0ub24oJ2NoYW5nZScsIGNvbnNvbGUubG9nKTtcbiAgICAgKiBjaGFuZ2VTdHJlYW0ub24oJ2Vycm9yJywgZSA9PiB7XG4gICAgICogICAgIGlmIChlIGluc3RhbmNlb2YgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgJiYgIWNoYW5nZVN0cmVhbS5jbG9zZWQpIHtcbiAgICAgKiAgICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgKiAgICAgfSBlbHNlIHtcbiAgICAgKiAgICAgICAgIGNoYW5nZVN0cmVhbS5jbG9zZSgpO1xuICAgICAqICAgICB9XG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICogQHBhcmFtIHBpcGVsaW5lIC0gQW4gYXJyYXkgb2Yge0BsaW5rIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9vcGVyYXRvci9hZ2dyZWdhdGlvbi1waXBlbGluZS98YWdncmVnYXRpb24gcGlwZWxpbmUgc3RhZ2VzfSB0aHJvdWdoIHdoaWNoIHRvIHBhc3MgY2hhbmdlIHN0cmVhbSBkb2N1bWVudHMuIFRoaXMgYWxsb3dzIGZvciBmaWx0ZXJpbmcgKHVzaW5nICRtYXRjaCkgYW5kIG1hbmlwdWxhdGluZyB0aGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudHMuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBmb3IgdGhlIGNvbW1hbmRcbiAgICAgKiBAdHlwZVBhcmFtIFRTY2hlbWEgLSBUeXBlIG9mIHRoZSBkYXRhIGJlaW5nIGRldGVjdGVkIGJ5IHRoZSBjaGFuZ2Ugc3RyZWFtXG4gICAgICogQHR5cGVQYXJhbSBUQ2hhbmdlIC0gVHlwZSBvZiB0aGUgd2hvbGUgY2hhbmdlIHN0cmVhbSBkb2N1bWVudCBlbWl0dGVkXG4gICAgICovXG4gICAgd2F0Y2gocGlwZWxpbmUgPSBbXSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIC8vIEFsbG93IG9wdGlvbmFsbHkgbm90IHNwZWNpZnlpbmcgYSBwaXBlbGluZVxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGlwZWxpbmUpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gcGlwZWxpbmU7XG4gICAgICAgICAgICBwaXBlbGluZSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgY2hhbmdlX3N0cmVhbV8xLkNoYW5nZVN0cmVhbSh0aGlzLCBwaXBlbGluZSwgKDAsIHV0aWxzXzEucmVzb2x2ZU9wdGlvbnMpKHRoaXMsIG9wdGlvbnMpKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvQ2xpZW50ID0gTW9uZ29DbGllbnQ7XG4oMCwgcmVzb3VyY2VfbWFuYWdlbWVudF8xLmNvbmZpZ3VyZVJlc291cmNlTWFuYWdlbWVudCkoTW9uZ29DbGllbnQucHJvdG90eXBlKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vbmdvX2NsaWVudC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client_auth_providers.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client_auth_providers.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoClientAuthProviders = void 0;\nconst gssapi_1 = __webpack_require__(/*! ./cmap/auth/gssapi */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/gssapi.js\");\nconst mongodb_aws_1 = __webpack_require__(/*! ./cmap/auth/mongodb_aws */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js\");\nconst mongodb_oidc_1 = __webpack_require__(/*! ./cmap/auth/mongodb_oidc */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc.js\");\nconst automated_callback_workflow_1 = __webpack_require__(/*! ./cmap/auth/mongodb_oidc/automated_callback_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/automated_callback_workflow.js\");\nconst human_callback_workflow_1 = __webpack_require__(/*! ./cmap/auth/mongodb_oidc/human_callback_workflow */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/human_callback_workflow.js\");\nconst token_cache_1 = __webpack_require__(/*! ./cmap/auth/mongodb_oidc/token_cache */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/mongodb_oidc/token_cache.js\");\nconst plain_1 = __webpack_require__(/*! ./cmap/auth/plain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/plain.js\");\nconst providers_1 = __webpack_require__(/*! ./cmap/auth/providers */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/providers.js\");\nconst scram_1 = __webpack_require__(/*! ./cmap/auth/scram */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/scram.js\");\nconst x509_1 = __webpack_require__(/*! ./cmap/auth/x509 */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/auth/x509.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/** @internal */\nconst AUTH_PROVIDERS = new Map([\n    [\n        providers_1.AuthMechanism.MONGODB_AWS,\n        ({ AWS_CREDENTIAL_PROVIDER }) => new mongodb_aws_1.MongoDBAWS(AWS_CREDENTIAL_PROVIDER)\n    ],\n    [\n        providers_1.AuthMechanism.MONGODB_CR,\n        () => {\n            throw new error_1.MongoInvalidArgumentError('MONGODB-CR is no longer a supported auth mechanism in MongoDB 4.0+');\n        }\n    ],\n    [providers_1.AuthMechanism.MONGODB_GSSAPI, () => new gssapi_1.GSSAPI()],\n    [providers_1.AuthMechanism.MONGODB_OIDC, properties => new mongodb_oidc_1.MongoDBOIDC(getWorkflow(properties))],\n    [providers_1.AuthMechanism.MONGODB_PLAIN, () => new plain_1.Plain()],\n    [providers_1.AuthMechanism.MONGODB_SCRAM_SHA1, () => new scram_1.ScramSHA1()],\n    [providers_1.AuthMechanism.MONGODB_SCRAM_SHA256, () => new scram_1.ScramSHA256()],\n    [providers_1.AuthMechanism.MONGODB_X509, () => new x509_1.X509()]\n]);\n/**\n * Create a set of providers per client\n * to avoid sharing the provider's cache between different clients.\n * @internal\n */\nclass MongoClientAuthProviders {\n    constructor() {\n        this.existingProviders = new Map();\n    }\n    /**\n     * Get or create an authentication provider based on the provided mechanism.\n     * We don't want to create all providers at once, as some providers may not be used.\n     * @param name - The name of the provider to get or create.\n     * @param credentials - The credentials.\n     * @returns The provider.\n     * @throws MongoInvalidArgumentError if the mechanism is not supported.\n     * @internal\n     */\n    getOrCreateProvider(name, authMechanismProperties) {\n        const authProvider = this.existingProviders.get(name);\n        if (authProvider) {\n            return authProvider;\n        }\n        const providerFunction = AUTH_PROVIDERS.get(name);\n        if (!providerFunction) {\n            throw new error_1.MongoInvalidArgumentError(`authMechanism ${name} not supported`);\n        }\n        const provider = providerFunction(authMechanismProperties);\n        this.existingProviders.set(name, provider);\n        return provider;\n    }\n}\nexports.MongoClientAuthProviders = MongoClientAuthProviders;\n/**\n * Gets either a device workflow or callback workflow.\n */\nfunction getWorkflow(authMechanismProperties) {\n    if (authMechanismProperties.OIDC_HUMAN_CALLBACK) {\n        return new human_callback_workflow_1.HumanCallbackWorkflow(new token_cache_1.TokenCache(), authMechanismProperties.OIDC_HUMAN_CALLBACK);\n    }\n    else if (authMechanismProperties.OIDC_CALLBACK) {\n        return new automated_callback_workflow_1.AutomatedCallbackWorkflow(new token_cache_1.TokenCache(), authMechanismProperties.OIDC_CALLBACK);\n    }\n    else {\n        const environment = authMechanismProperties.ENVIRONMENT;\n        const workflow = mongodb_oidc_1.OIDC_WORKFLOWS.get(environment)?.();\n        if (!workflow) {\n            throw new error_1.MongoInvalidArgumentError(`Could not load workflow for environment ${authMechanismProperties.ENVIRONMENT}`);\n        }\n        return workflow;\n    }\n}\n//# sourceMappingURL=mongo_client_auth_providers.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL21vbmdvX2NsaWVudF9hdXRoX3Byb3ZpZGVycy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxnQ0FBZ0M7QUFDaEMsaUJBQWlCLG1CQUFPLENBQUMsa0hBQW9CO0FBQzdDLHNCQUFzQixtQkFBTyxDQUFDLDRIQUF5QjtBQUN2RCx1QkFBdUIsbUJBQU8sQ0FBQyw4SEFBMEI7QUFDekQsc0NBQXNDLG1CQUFPLENBQUMsc0xBQXNEO0FBQ3BHLGtDQUFrQyxtQkFBTyxDQUFDLDhLQUFrRDtBQUM1RixzQkFBc0IsbUJBQU8sQ0FBQyxzSkFBc0M7QUFDcEUsZ0JBQWdCLG1CQUFPLENBQUMsZ0hBQW1CO0FBQzNDLG9CQUFvQixtQkFBTyxDQUFDLHdIQUF1QjtBQUNuRCxnQkFBZ0IsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDM0MsZUFBZSxtQkFBTyxDQUFDLDhHQUFrQjtBQUN6QyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcseUJBQXlCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RSxNQUFNO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUdBQW1HLG9DQUFvQztBQUN2STtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvbW9uZ29fY2xpZW50X2F1dGhfcHJvdmlkZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Nb25nb0NsaWVudEF1dGhQcm92aWRlcnMgPSB2b2lkIDA7XG5jb25zdCBnc3NhcGlfMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC9nc3NhcGlcIik7XG5jb25zdCBtb25nb2RiX2F3c18xID0gcmVxdWlyZShcIi4vY21hcC9hdXRoL21vbmdvZGJfYXdzXCIpO1xuY29uc3QgbW9uZ29kYl9vaWRjXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjXCIpO1xuY29uc3QgYXV0b21hdGVkX2NhbGxiYWNrX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2F1dG9tYXRlZF9jYWxsYmFja193b3JrZmxvd1wiKTtcbmNvbnN0IGh1bWFuX2NhbGxiYWNrX3dvcmtmbG93XzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvbW9uZ29kYl9vaWRjL2h1bWFuX2NhbGxiYWNrX3dvcmtmbG93XCIpO1xuY29uc3QgdG9rZW5fY2FjaGVfMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC9tb25nb2RiX29pZGMvdG9rZW5fY2FjaGVcIik7XG5jb25zdCBwbGFpbl8xID0gcmVxdWlyZShcIi4vY21hcC9hdXRoL3BsYWluXCIpO1xuY29uc3QgcHJvdmlkZXJzXzEgPSByZXF1aXJlKFwiLi9jbWFwL2F1dGgvcHJvdmlkZXJzXCIpO1xuY29uc3Qgc2NyYW1fMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC9zY3JhbVwiKTtcbmNvbnN0IHg1MDlfMSA9IHJlcXVpcmUoXCIuL2NtYXAvYXV0aC94NTA5XCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgQVVUSF9QUk9WSURFUlMgPSBuZXcgTWFwKFtcbiAgICBbXG4gICAgICAgIHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9BV1MsXG4gICAgICAgICh7IEFXU19DUkVERU5USUFMX1BST1ZJREVSIH0pID0+IG5ldyBtb25nb2RiX2F3c18xLk1vbmdvREJBV1MoQVdTX0NSRURFTlRJQUxfUFJPVklERVIpXG4gICAgXSxcbiAgICBbXG4gICAgICAgIHByb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9DUixcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignTU9OR09EQi1DUiBpcyBubyBsb25nZXIgYSBzdXBwb3J0ZWQgYXV0aCBtZWNoYW5pc20gaW4gTW9uZ29EQiA0LjArJyk7XG4gICAgICAgIH1cbiAgICBdLFxuICAgIFtwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfR1NTQVBJLCAoKSA9PiBuZXcgZ3NzYXBpXzEuR1NTQVBJKCldLFxuICAgIFtwcm92aWRlcnNfMS5BdXRoTWVjaGFuaXNtLk1PTkdPREJfT0lEQywgcHJvcGVydGllcyA9PiBuZXcgbW9uZ29kYl9vaWRjXzEuTW9uZ29EQk9JREMoZ2V0V29ya2Zsb3cocHJvcGVydGllcykpXSxcbiAgICBbcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1BMQUlOLCAoKSA9PiBuZXcgcGxhaW5fMS5QbGFpbigpXSxcbiAgICBbcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTEsICgpID0+IG5ldyBzY3JhbV8xLlNjcmFtU0hBMSgpXSxcbiAgICBbcHJvdmlkZXJzXzEuQXV0aE1lY2hhbmlzbS5NT05HT0RCX1NDUkFNX1NIQTI1NiwgKCkgPT4gbmV3IHNjcmFtXzEuU2NyYW1TSEEyNTYoKV0sXG4gICAgW3Byb3ZpZGVyc18xLkF1dGhNZWNoYW5pc20uTU9OR09EQl9YNTA5LCAoKSA9PiBuZXcgeDUwOV8xLlg1MDkoKV1cbl0pO1xuLyoqXG4gKiBDcmVhdGUgYSBzZXQgb2YgcHJvdmlkZXJzIHBlciBjbGllbnRcbiAqIHRvIGF2b2lkIHNoYXJpbmcgdGhlIHByb3ZpZGVyJ3MgY2FjaGUgYmV0d2VlbiBkaWZmZXJlbnQgY2xpZW50cy5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBNb25nb0NsaWVudEF1dGhQcm92aWRlcnMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmV4aXN0aW5nUHJvdmlkZXJzID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgb3IgY3JlYXRlIGFuIGF1dGhlbnRpY2F0aW9uIHByb3ZpZGVyIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBtZWNoYW5pc20uXG4gICAgICogV2UgZG9uJ3Qgd2FudCB0byBjcmVhdGUgYWxsIHByb3ZpZGVycyBhdCBvbmNlLCBhcyBzb21lIHByb3ZpZGVycyBtYXkgbm90IGJlIHVzZWQuXG4gICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcHJvdmlkZXIgdG8gZ2V0IG9yIGNyZWF0ZS5cbiAgICAgKiBAcGFyYW0gY3JlZGVudGlhbHMgLSBUaGUgY3JlZGVudGlhbHMuXG4gICAgICogQHJldHVybnMgVGhlIHByb3ZpZGVyLlxuICAgICAqIEB0aHJvd3MgTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvciBpZiB0aGUgbWVjaGFuaXNtIGlzIG5vdCBzdXBwb3J0ZWQuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgZ2V0T3JDcmVhdGVQcm92aWRlcihuYW1lLCBhdXRoTWVjaGFuaXNtUHJvcGVydGllcykge1xuICAgICAgICBjb25zdCBhdXRoUHJvdmlkZXIgPSB0aGlzLmV4aXN0aW5nUHJvdmlkZXJzLmdldChuYW1lKTtcbiAgICAgICAgaWYgKGF1dGhQcm92aWRlcikge1xuICAgICAgICAgICAgcmV0dXJuIGF1dGhQcm92aWRlcjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcm92aWRlckZ1bmN0aW9uID0gQVVUSF9QUk9WSURFUlMuZ2V0KG5hbWUpO1xuICAgICAgICBpZiAoIXByb3ZpZGVyRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYGF1dGhNZWNoYW5pc20gJHtuYW1lfSBub3Qgc3VwcG9ydGVkYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBwcm92aWRlckZ1bmN0aW9uKGF1dGhNZWNoYW5pc21Qcm9wZXJ0aWVzKTtcbiAgICAgICAgdGhpcy5leGlzdGluZ1Byb3ZpZGVycy5zZXQobmFtZSwgcHJvdmlkZXIpO1xuICAgICAgICByZXR1cm4gcHJvdmlkZXI7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0NsaWVudEF1dGhQcm92aWRlcnMgPSBNb25nb0NsaWVudEF1dGhQcm92aWRlcnM7XG4vKipcbiAqIEdldHMgZWl0aGVyIGEgZGV2aWNlIHdvcmtmbG93IG9yIGNhbGxiYWNrIHdvcmtmbG93LlxuICovXG5mdW5jdGlvbiBnZXRXb3JrZmxvdyhhdXRoTWVjaGFuaXNtUHJvcGVydGllcykge1xuICAgIGlmIChhdXRoTWVjaGFuaXNtUHJvcGVydGllcy5PSURDX0hVTUFOX0NBTExCQUNLKSB7XG4gICAgICAgIHJldHVybiBuZXcgaHVtYW5fY2FsbGJhY2tfd29ya2Zsb3dfMS5IdW1hbkNhbGxiYWNrV29ya2Zsb3cobmV3IHRva2VuX2NhY2hlXzEuVG9rZW5DYWNoZSgpLCBhdXRoTWVjaGFuaXNtUHJvcGVydGllcy5PSURDX0hVTUFOX0NBTExCQUNLKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYXV0aE1lY2hhbmlzbVByb3BlcnRpZXMuT0lEQ19DQUxMQkFDSykge1xuICAgICAgICByZXR1cm4gbmV3IGF1dG9tYXRlZF9jYWxsYmFja193b3JrZmxvd18xLkF1dG9tYXRlZENhbGxiYWNrV29ya2Zsb3cobmV3IHRva2VuX2NhY2hlXzEuVG9rZW5DYWNoZSgpLCBhdXRoTWVjaGFuaXNtUHJvcGVydGllcy5PSURDX0NBTExCQUNLKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGVudmlyb25tZW50ID0gYXV0aE1lY2hhbmlzbVByb3BlcnRpZXMuRU5WSVJPTk1FTlQ7XG4gICAgICAgIGNvbnN0IHdvcmtmbG93ID0gbW9uZ29kYl9vaWRjXzEuT0lEQ19XT1JLRkxPV1MuZ2V0KGVudmlyb25tZW50KT8uKCk7XG4gICAgICAgIGlmICghd29ya2Zsb3cpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYENvdWxkIG5vdCBsb2FkIHdvcmtmbG93IGZvciBlbnZpcm9ubWVudCAke2F1dGhNZWNoYW5pc21Qcm9wZXJ0aWVzLkVOVklST05NRU5UfWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3b3JrZmxvdztcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb25nb19jbGllbnRfYXV0aF9wcm92aWRlcnMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client_auth_providers.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MongoLogger = exports.MongoLoggableComponent = exports.SEVERITY_LEVEL_MAP = exports.DEFAULT_MAX_DOCUMENT_LENGTH = exports.SeverityLevel = void 0;\nexports.parseSeverityFromString = parseSeverityFromString;\nexports.createStdioLogger = createStdioLogger;\nexports.stringifyWithMaxLen = stringifyWithMaxLen;\nexports.defaultLogTransform = defaultLogTransform;\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/**\n * @public\n * Severity levels align with unix syslog.\n * Most typical driver functions will log to debug.\n */\nexports.SeverityLevel = Object.freeze({\n    EMERGENCY: 'emergency',\n    ALERT: 'alert',\n    CRITICAL: 'critical',\n    ERROR: 'error',\n    WARNING: 'warn',\n    NOTICE: 'notice',\n    INFORMATIONAL: 'info',\n    DEBUG: 'debug',\n    TRACE: 'trace',\n    OFF: 'off'\n});\n/** @internal */\nexports.DEFAULT_MAX_DOCUMENT_LENGTH = 1000;\n/** @internal */\nclass SeverityLevelMap extends Map {\n    constructor(entries) {\n        const newEntries = [];\n        for (const [level, value] of entries) {\n            newEntries.push([value, level]);\n        }\n        newEntries.push(...entries);\n        super(newEntries);\n    }\n    getNumericSeverityLevel(severity) {\n        return this.get(severity);\n    }\n    getSeverityLevelName(level) {\n        return this.get(level);\n    }\n}\n/** @internal */\nexports.SEVERITY_LEVEL_MAP = new SeverityLevelMap([\n    [exports.SeverityLevel.OFF, -Infinity],\n    [exports.SeverityLevel.EMERGENCY, 0],\n    [exports.SeverityLevel.ALERT, 1],\n    [exports.SeverityLevel.CRITICAL, 2],\n    [exports.SeverityLevel.ERROR, 3],\n    [exports.SeverityLevel.WARNING, 4],\n    [exports.SeverityLevel.NOTICE, 5],\n    [exports.SeverityLevel.INFORMATIONAL, 6],\n    [exports.SeverityLevel.DEBUG, 7],\n    [exports.SeverityLevel.TRACE, 8]\n]);\n/** @public */\nexports.MongoLoggableComponent = Object.freeze({\n    COMMAND: 'command',\n    TOPOLOGY: 'topology',\n    SERVER_SELECTION: 'serverSelection',\n    CONNECTION: 'connection',\n    CLIENT: 'client'\n});\n/**\n * Parses a string as one of SeverityLevel\n * @internal\n *\n * @param s - the value to be parsed\n * @returns one of SeverityLevel if value can be parsed as such, otherwise null\n */\nfunction parseSeverityFromString(s) {\n    const validSeverities = Object.values(exports.SeverityLevel);\n    const lowerSeverity = s?.toLowerCase();\n    if (lowerSeverity != null && validSeverities.includes(lowerSeverity)) {\n        return lowerSeverity;\n    }\n    return null;\n}\n/** @internal */\nfunction createStdioLogger(stream) {\n    return {\n        write: (0, util_1.promisify)((log, cb) => {\n            const logLine = (0, util_1.inspect)(log, { compact: true, breakLength: Infinity });\n            stream.write(`${logLine}\\n`, 'utf-8', cb);\n            return;\n        })\n    };\n}\n/**\n * resolves the MONGODB_LOG_PATH and mongodbLogPath options from the environment and the\n * mongo client options respectively. The mongodbLogPath can be either 'stdout', 'stderr', a NodeJS\n * Writable or an object which has a `write` method with the signature:\n * ```ts\n * write(log: Log): void\n * ```\n *\n * @returns the MongoDBLogWritable object to write logs to\n */\nfunction resolveLogPath({ MONGODB_LOG_PATH }, { mongodbLogPath }) {\n    if (typeof mongodbLogPath === 'string' && /^stderr$/i.test(mongodbLogPath)) {\n        return { mongodbLogPath: createStdioLogger(process.stderr), mongodbLogPathIsStdErr: true };\n    }\n    if (typeof mongodbLogPath === 'string' && /^stdout$/i.test(mongodbLogPath)) {\n        return { mongodbLogPath: createStdioLogger(process.stdout), mongodbLogPathIsStdErr: false };\n    }\n    if (typeof mongodbLogPath === 'object' && typeof mongodbLogPath?.write === 'function') {\n        return { mongodbLogPath: mongodbLogPath, mongodbLogPathIsStdErr: false };\n    }\n    if (MONGODB_LOG_PATH && /^stderr$/i.test(MONGODB_LOG_PATH)) {\n        return { mongodbLogPath: createStdioLogger(process.stderr), mongodbLogPathIsStdErr: true };\n    }\n    if (MONGODB_LOG_PATH && /^stdout$/i.test(MONGODB_LOG_PATH)) {\n        return { mongodbLogPath: createStdioLogger(process.stdout), mongodbLogPathIsStdErr: false };\n    }\n    return { mongodbLogPath: createStdioLogger(process.stderr), mongodbLogPathIsStdErr: true };\n}\nfunction resolveSeverityConfiguration(clientOption, environmentOption, defaultSeverity) {\n    return (parseSeverityFromString(clientOption) ??\n        parseSeverityFromString(environmentOption) ??\n        defaultSeverity);\n}\nfunction compareSeverity(s0, s1) {\n    const s0Num = exports.SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s0);\n    const s1Num = exports.SEVERITY_LEVEL_MAP.getNumericSeverityLevel(s1);\n    return s0Num < s1Num ? -1 : s0Num > s1Num ? 1 : 0;\n}\n/** @internal */\nfunction stringifyWithMaxLen(value, maxDocumentLength, options = {}) {\n    let strToTruncate = '';\n    let currentLength = 0;\n    const maxDocumentLengthEnsurer = function maxDocumentLengthEnsurer(key, value) {\n        if (currentLength >= maxDocumentLength) {\n            return undefined;\n        }\n        // Account for root document\n        if (key === '') {\n            // Account for starting brace\n            currentLength += 1;\n            return value;\n        }\n        // +4 accounts for 2 quotation marks, colon and comma after value\n        // Note that this potentially undercounts since it does not account for escape sequences which\n        // will have an additional backslash added to them once passed through JSON.stringify.\n        currentLength += key.length + 4;\n        if (value == null)\n            return value;\n        switch (typeof value) {\n            case 'string':\n                // +2 accounts for quotes\n                // Note that this potentially undercounts similarly to the key length calculation\n                currentLength += value.length + 2;\n                break;\n            case 'number':\n            case 'bigint':\n                currentLength += String(value).length;\n                break;\n            case 'boolean':\n                currentLength += value ? 4 : 5;\n                break;\n            case 'object':\n                if ((0, utils_1.isUint8Array)(value)) {\n                    // '{\"$binary\":{\"base64\":\"<base64 string>\",\"subType\":\"XX\"}}'\n                    // This is an estimate based on the fact that the base64 is approximately 1.33x the length of\n                    // the actual binary sequence https://en.wikipedia.org/wiki/Base64\n                    currentLength += (22 + value.byteLength + value.byteLength * 0.33 + 18) | 0;\n                }\n                else if ('_bsontype' in value) {\n                    const v = value;\n                    switch (v._bsontype) {\n                        case 'Int32':\n                            currentLength += String(v.value).length;\n                            break;\n                        case 'Double':\n                            // Account for representing integers as <value>.0\n                            currentLength +=\n                                (v.value | 0) === v.value ? String(v.value).length + 2 : String(v.value).length;\n                            break;\n                        case 'Long':\n                            currentLength += v.toString().length;\n                            break;\n                        case 'ObjectId':\n                            // '{\"$oid\":\"XXXXXXXXXXXXXXXXXXXXXXXX\"}'\n                            currentLength += 35;\n                            break;\n                        case 'MaxKey':\n                        case 'MinKey':\n                            // '{\"$maxKey\":1}' or '{\"$minKey\":1}'\n                            currentLength += 13;\n                            break;\n                        case 'Binary':\n                            // '{\"$binary\":{\"base64\":\"<base64 string>\",\"subType\":\"XX\"}}'\n                            // This is an estimate based on the fact that the base64 is approximately 1.33x the length of\n                            // the actual binary sequence https://en.wikipedia.org/wiki/Base64\n                            currentLength += (22 + value.position + value.position * 0.33 + 18) | 0;\n                            break;\n                        case 'Timestamp':\n                            // '{\"$timestamp\":{\"t\":<t>,\"i\":<i>}}'\n                            currentLength += 19 + String(v.t).length + 5 + String(v.i).length + 2;\n                            break;\n                        case 'Code':\n                            // '{\"$code\":\"<code>\"}' or '{\"$code\":\"<code>\",\"$scope\":<scope>}'\n                            if (v.scope == null) {\n                                currentLength += v.code.length + 10 + 2;\n                            }\n                            else {\n                                // Ignoring actual scope object, so this undercounts by a significant amount\n                                currentLength += v.code.length + 10 + 11;\n                            }\n                            break;\n                        case 'BSONRegExp':\n                            // '{\"$regularExpression\":{\"pattern\":\"<pattern>\",\"options\":\"<options>\"}}'\n                            currentLength += 34 + v.pattern.length + 13 + v.options.length + 3;\n                            break;\n                    }\n                }\n        }\n        return value;\n    };\n    if (typeof value === 'string') {\n        strToTruncate = value;\n    }\n    else if (typeof value === 'function') {\n        strToTruncate = value.name;\n    }\n    else {\n        try {\n            if (maxDocumentLength !== 0) {\n                strToTruncate = bson_1.EJSON.stringify(value, maxDocumentLengthEnsurer, 0, options);\n            }\n            else {\n                strToTruncate = bson_1.EJSON.stringify(value, options);\n            }\n        }\n        catch (e) {\n            strToTruncate = `Extended JSON serialization failed with: ${e.message}`;\n        }\n    }\n    // handle truncation that occurs in the middle of multi-byte codepoints\n    if (maxDocumentLength !== 0 &&\n        strToTruncate.length > maxDocumentLength &&\n        strToTruncate.charCodeAt(maxDocumentLength - 1) !==\n            strToTruncate.codePointAt(maxDocumentLength - 1)) {\n        maxDocumentLength--;\n        if (maxDocumentLength === 0) {\n            return '';\n        }\n    }\n    return maxDocumentLength !== 0 && strToTruncate.length > maxDocumentLength\n        ? `${strToTruncate.slice(0, maxDocumentLength)}...`\n        : strToTruncate;\n}\nfunction isLogConvertible(obj) {\n    const objAsLogConvertible = obj;\n    // eslint-disable-next-line no-restricted-syntax\n    return objAsLogConvertible.toLog !== undefined && typeof objAsLogConvertible.toLog === 'function';\n}\nfunction attachServerSelectionFields(log, serverSelectionEvent, maxDocumentLength = exports.DEFAULT_MAX_DOCUMENT_LENGTH) {\n    const { selector, operation, topologyDescription, message } = serverSelectionEvent;\n    log.selector = stringifyWithMaxLen(selector, maxDocumentLength);\n    log.operation = operation;\n    log.topologyDescription = stringifyWithMaxLen(topologyDescription, maxDocumentLength);\n    log.message = message;\n    return log;\n}\nfunction attachCommandFields(log, commandEvent) {\n    log.commandName = commandEvent.commandName;\n    log.requestId = commandEvent.requestId;\n    log.driverConnectionId = commandEvent.connectionId;\n    const { host, port } = utils_1.HostAddress.fromString(commandEvent.address).toHostPort();\n    log.serverHost = host;\n    log.serverPort = port;\n    if (commandEvent?.serviceId) {\n        log.serviceId = commandEvent.serviceId.toHexString();\n    }\n    log.databaseName = commandEvent.databaseName;\n    log.serverConnectionId = commandEvent.serverConnectionId;\n    return log;\n}\nfunction attachConnectionFields(log, event) {\n    const { host, port } = utils_1.HostAddress.fromString(event.address).toHostPort();\n    log.serverHost = host;\n    log.serverPort = port;\n    return log;\n}\nfunction attachSDAMFields(log, sdamEvent) {\n    log.topologyId = sdamEvent.topologyId;\n    return log;\n}\nfunction attachServerHeartbeatFields(log, serverHeartbeatEvent) {\n    const { awaited, connectionId } = serverHeartbeatEvent;\n    log.awaited = awaited;\n    log.driverConnectionId = serverHeartbeatEvent.connectionId;\n    const { host, port } = utils_1.HostAddress.fromString(connectionId).toHostPort();\n    log.serverHost = host;\n    log.serverPort = port;\n    return log;\n}\n/** @internal */\nfunction defaultLogTransform(logObject, maxDocumentLength = exports.DEFAULT_MAX_DOCUMENT_LENGTH) {\n    let log = Object.create(null);\n    switch (logObject.name) {\n        case constants_1.SERVER_SELECTION_STARTED:\n            log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n            return log;\n        case constants_1.SERVER_SELECTION_FAILED:\n            log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n            log.failure = logObject.failure?.message;\n            return log;\n        case constants_1.SERVER_SELECTION_SUCCEEDED:\n            log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n            log.serverHost = logObject.serverHost;\n            log.serverPort = logObject.serverPort;\n            return log;\n        case constants_1.WAITING_FOR_SUITABLE_SERVER:\n            log = attachServerSelectionFields(log, logObject, maxDocumentLength);\n            log.remainingTimeMS = logObject.remainingTimeMS;\n            return log;\n        case constants_1.COMMAND_STARTED:\n            log = attachCommandFields(log, logObject);\n            log.message = 'Command started';\n            log.command = stringifyWithMaxLen(logObject.command, maxDocumentLength, { relaxed: true });\n            log.databaseName = logObject.databaseName;\n            return log;\n        case constants_1.COMMAND_SUCCEEDED:\n            log = attachCommandFields(log, logObject);\n            log.message = 'Command succeeded';\n            log.durationMS = logObject.duration;\n            log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength, { relaxed: true });\n            return log;\n        case constants_1.COMMAND_FAILED:\n            log = attachCommandFields(log, logObject);\n            log.message = 'Command failed';\n            log.durationMS = logObject.duration;\n            log.failure = logObject.failure?.message ?? '(redacted)';\n            return log;\n        case constants_1.CONNECTION_POOL_CREATED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool created';\n            if (logObject.options) {\n                const { maxIdleTimeMS, minPoolSize, maxPoolSize, maxConnecting, waitQueueTimeoutMS } = logObject.options;\n                log = {\n                    ...log,\n                    maxIdleTimeMS,\n                    minPoolSize,\n                    maxPoolSize,\n                    maxConnecting,\n                    waitQueueTimeoutMS\n                };\n            }\n            return log;\n        case constants_1.CONNECTION_POOL_READY:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool ready';\n            return log;\n        case constants_1.CONNECTION_POOL_CLEARED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool cleared';\n            if (logObject.serviceId?._bsontype === 'ObjectId') {\n                log.serviceId = logObject.serviceId?.toHexString();\n            }\n            return log;\n        case constants_1.CONNECTION_POOL_CLOSED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection pool closed';\n            return log;\n        case constants_1.CONNECTION_CREATED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection created';\n            log.driverConnectionId = logObject.connectionId;\n            return log;\n        case constants_1.CONNECTION_READY:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection ready';\n            log.driverConnectionId = logObject.connectionId;\n            log.durationMS = logObject.durationMS;\n            return log;\n        case constants_1.CONNECTION_CLOSED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection closed';\n            log.driverConnectionId = logObject.connectionId;\n            switch (logObject.reason) {\n                case 'stale':\n                    log.reason = 'Connection became stale because the pool was cleared';\n                    break;\n                case 'idle':\n                    log.reason =\n                        'Connection has been available but unused for longer than the configured max idle time';\n                    break;\n                case 'error':\n                    log.reason = 'An error occurred while using the connection';\n                    if (logObject.error) {\n                        log.error = logObject.error;\n                    }\n                    break;\n                case 'poolClosed':\n                    log.reason = 'Connection pool was closed';\n                    break;\n                default:\n                    log.reason = `Unknown close reason: ${logObject.reason}`;\n            }\n            return log;\n        case constants_1.CONNECTION_CHECK_OUT_STARTED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checkout started';\n            return log;\n        case constants_1.CONNECTION_CHECK_OUT_FAILED:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checkout failed';\n            switch (logObject.reason) {\n                case 'poolClosed':\n                    log.reason = 'Connection pool was closed';\n                    break;\n                case 'timeout':\n                    log.reason = 'Wait queue timeout elapsed without a connection becoming available';\n                    break;\n                case 'connectionError':\n                    log.reason = 'An error occurred while trying to establish a new connection';\n                    if (logObject.error) {\n                        log.error = logObject.error;\n                    }\n                    break;\n                default:\n                    log.reason = `Unknown close reason: ${logObject.reason}`;\n            }\n            log.durationMS = logObject.durationMS;\n            return log;\n        case constants_1.CONNECTION_CHECKED_OUT:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checked out';\n            log.driverConnectionId = logObject.connectionId;\n            log.durationMS = logObject.durationMS;\n            return log;\n        case constants_1.CONNECTION_CHECKED_IN:\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Connection checked in';\n            log.driverConnectionId = logObject.connectionId;\n            return log;\n        case constants_1.SERVER_OPENING:\n            log = attachSDAMFields(log, logObject);\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Starting server monitoring';\n            return log;\n        case constants_1.SERVER_CLOSED:\n            log = attachSDAMFields(log, logObject);\n            log = attachConnectionFields(log, logObject);\n            log.message = 'Stopped server monitoring';\n            return log;\n        case constants_1.SERVER_HEARTBEAT_STARTED:\n            log = attachSDAMFields(log, logObject);\n            log = attachServerHeartbeatFields(log, logObject);\n            log.message = 'Server heartbeat started';\n            return log;\n        case constants_1.SERVER_HEARTBEAT_SUCCEEDED:\n            log = attachSDAMFields(log, logObject);\n            log = attachServerHeartbeatFields(log, logObject);\n            log.message = 'Server heartbeat succeeded';\n            log.durationMS = logObject.duration;\n            log.serverConnectionId = logObject.serverConnectionId;\n            log.reply = stringifyWithMaxLen(logObject.reply, maxDocumentLength, { relaxed: true });\n            return log;\n        case constants_1.SERVER_HEARTBEAT_FAILED:\n            log = attachSDAMFields(log, logObject);\n            log = attachServerHeartbeatFields(log, logObject);\n            log.message = 'Server heartbeat failed';\n            log.durationMS = logObject.duration;\n            log.failure = logObject.failure?.message;\n            return log;\n        case constants_1.TOPOLOGY_OPENING:\n            log = attachSDAMFields(log, logObject);\n            log.message = 'Starting topology monitoring';\n            return log;\n        case constants_1.TOPOLOGY_CLOSED:\n            log = attachSDAMFields(log, logObject);\n            log.message = 'Stopped topology monitoring';\n            return log;\n        case constants_1.TOPOLOGY_DESCRIPTION_CHANGED:\n            log = attachSDAMFields(log, logObject);\n            log.message = 'Topology description changed';\n            log.previousDescription = log.reply = stringifyWithMaxLen(logObject.previousDescription, maxDocumentLength);\n            log.newDescription = log.reply = stringifyWithMaxLen(logObject.newDescription, maxDocumentLength);\n            return log;\n        default:\n            for (const [key, value] of Object.entries(logObject)) {\n                if (value != null)\n                    log[key] = value;\n            }\n    }\n    return log;\n}\n/** @internal */\nclass MongoLogger {\n    constructor(options) {\n        this.pendingLog = null;\n        /**\n         * This method should be used when logging errors that do not have a public driver API for\n         * reporting errors.\n         */\n        this.error = this.log.bind(this, 'error');\n        /**\n         * This method should be used to log situations where undesirable application behaviour might\n         * occur. For example, failing to end sessions on `MongoClient.close`.\n         */\n        this.warn = this.log.bind(this, 'warn');\n        /**\n         * This method should be used to report high-level information about normal driver behaviour.\n         * For example, the creation of a `MongoClient`.\n         */\n        this.info = this.log.bind(this, 'info');\n        /**\n         * This method should be used to report information that would be helpful when debugging an\n         * application. For example, a command starting, succeeding or failing.\n         */\n        this.debug = this.log.bind(this, 'debug');\n        /**\n         * This method should be used to report fine-grained details related to logic flow. For example,\n         * entering and exiting a function body.\n         */\n        this.trace = this.log.bind(this, 'trace');\n        this.componentSeverities = options.componentSeverities;\n        this.maxDocumentLength = options.maxDocumentLength;\n        this.logDestination = options.logDestination;\n        this.logDestinationIsStdErr = options.logDestinationIsStdErr;\n        this.severities = this.createLoggingSeverities();\n    }\n    createLoggingSeverities() {\n        const severities = Object();\n        for (const component of Object.values(exports.MongoLoggableComponent)) {\n            severities[component] = {};\n            for (const severityLevel of Object.values(exports.SeverityLevel)) {\n                severities[component][severityLevel] =\n                    compareSeverity(severityLevel, this.componentSeverities[component]) <= 0;\n            }\n        }\n        return severities;\n    }\n    turnOffSeverities() {\n        for (const component of Object.values(exports.MongoLoggableComponent)) {\n            this.componentSeverities[component] = exports.SeverityLevel.OFF;\n            for (const severityLevel of Object.values(exports.SeverityLevel)) {\n                this.severities[component][severityLevel] = false;\n            }\n        }\n    }\n    logWriteFailureHandler(error) {\n        if (this.logDestinationIsStdErr) {\n            this.turnOffSeverities();\n            this.clearPendingLog();\n            return;\n        }\n        this.logDestination = createStdioLogger(process.stderr);\n        this.logDestinationIsStdErr = true;\n        this.clearPendingLog();\n        this.error(exports.MongoLoggableComponent.CLIENT, {\n            toLog: function () {\n                return {\n                    message: 'User input for mongodbLogPath is now invalid. Logging is halted.',\n                    error: error.message\n                };\n            }\n        });\n        this.turnOffSeverities();\n        this.clearPendingLog();\n    }\n    clearPendingLog() {\n        this.pendingLog = null;\n    }\n    willLog(component, severity) {\n        if (severity === exports.SeverityLevel.OFF)\n            return false;\n        return this.severities[component][severity];\n    }\n    log(severity, component, message) {\n        if (!this.willLog(component, severity))\n            return;\n        let logMessage = { t: new Date(), c: component, s: severity };\n        if (typeof message === 'string') {\n            logMessage.message = message;\n        }\n        else if (typeof message === 'object') {\n            if (isLogConvertible(message)) {\n                logMessage = { ...logMessage, ...message.toLog() };\n            }\n            else {\n                logMessage = { ...logMessage, ...defaultLogTransform(message, this.maxDocumentLength) };\n            }\n        }\n        if ((0, utils_1.isPromiseLike)(this.pendingLog)) {\n            this.pendingLog = this.pendingLog\n                .then(() => this.logDestination.write(logMessage))\n                .then(this.clearPendingLog.bind(this), this.logWriteFailureHandler.bind(this));\n            return;\n        }\n        try {\n            const logResult = this.logDestination.write(logMessage);\n            if ((0, utils_1.isPromiseLike)(logResult)) {\n                this.pendingLog = logResult.then(this.clearPendingLog.bind(this), this.logWriteFailureHandler.bind(this));\n            }\n        }\n        catch (error) {\n            this.logWriteFailureHandler(error);\n        }\n    }\n    /**\n     * Merges options set through environment variables and the MongoClient, preferring environment\n     * variables when both are set, and substituting defaults for values not set. Options set in\n     * constructor take precedence over both environment variables and MongoClient options.\n     *\n     * @remarks\n     * When parsing component severity levels, invalid values are treated as unset and replaced with\n     * the default severity.\n     *\n     * @param envOptions - options set for the logger from the environment\n     * @param clientOptions - options set for the logger in the MongoClient options\n     * @returns a MongoLoggerOptions object to be used when instantiating a new MongoLogger\n     */\n    static resolveOptions(envOptions, clientOptions) {\n        // client options take precedence over env options\n        const resolvedLogPath = resolveLogPath(envOptions, clientOptions);\n        const combinedOptions = {\n            ...envOptions,\n            ...clientOptions,\n            mongodbLogPath: resolvedLogPath.mongodbLogPath,\n            mongodbLogPathIsStdErr: resolvedLogPath.mongodbLogPathIsStdErr\n        };\n        const defaultSeverity = resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.default, combinedOptions.MONGODB_LOG_ALL, exports.SeverityLevel.OFF);\n        return {\n            componentSeverities: {\n                command: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.command, combinedOptions.MONGODB_LOG_COMMAND, defaultSeverity),\n                topology: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.topology, combinedOptions.MONGODB_LOG_TOPOLOGY, defaultSeverity),\n                serverSelection: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.serverSelection, combinedOptions.MONGODB_LOG_SERVER_SELECTION, defaultSeverity),\n                connection: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.connection, combinedOptions.MONGODB_LOG_CONNECTION, defaultSeverity),\n                client: resolveSeverityConfiguration(combinedOptions.mongodbLogComponentSeverities?.client, combinedOptions.MONGODB_LOG_CLIENT, defaultSeverity),\n                default: defaultSeverity\n            },\n            maxDocumentLength: combinedOptions.mongodbLogMaxDocumentLength ??\n                (0, utils_1.parseUnsignedInteger)(combinedOptions.MONGODB_LOG_MAX_DOCUMENT_LENGTH) ??\n                1000,\n            logDestination: combinedOptions.mongodbLogPath,\n            logDestinationIsStdErr: combinedOptions.mongodbLogPathIsStdErr\n        };\n    }\n}\nexports.MongoLogger = MongoLogger;\n//# sourceMappingURL=mongo_logger.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL21vbmdvX2xvZ2dlci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxtQkFBbUIsR0FBRyw4QkFBOEIsR0FBRywwQkFBMEIsR0FBRyxtQ0FBbUMsR0FBRyxxQkFBcUI7QUFDL0ksK0JBQStCO0FBQy9CLHlCQUF5QjtBQUN6QiwyQkFBMkI7QUFDM0IsMkJBQTJCO0FBQzNCLGVBQWUsbUJBQU8sQ0FBQyxrQkFBTTtBQUM3QixlQUFlLG1CQUFPLENBQUMsMEZBQVE7QUFDL0Isb0JBQW9CLG1CQUFPLENBQUMsb0dBQWE7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsc0NBQXNDO0FBQzdGLDRCQUE0QixRQUFRO0FBQ3BDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixrQkFBa0IsSUFBSSxnQkFBZ0I7QUFDaEU7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLFdBQVcsMkNBQTJDO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLGtDQUFrQztBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxZQUFZLE9BQU8sWUFBWTtBQUNoRTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsV0FBVywyQ0FBMkM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxjQUFjLGlCQUFpQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsaUJBQWlCLE9BQU8sa0NBQWtDO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxzQkFBc0IsNkNBQTZDO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsVUFBVTtBQUNsRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsMENBQTBDO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG9EQUFvRDtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksYUFBYTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksYUFBYTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHdCQUF3QjtBQUNwQztBQUNBO0FBQ0EsWUFBWSxhQUFhO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNGQUFzRixlQUFlO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRixlQUFlO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNkVBQTZFO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELGlCQUFpQjtBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELGlCQUFpQjtBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0ZBQWtGLGVBQWU7QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL21vbmdvX2xvZ2dlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW9uZ29Mb2dnZXIgPSBleHBvcnRzLk1vbmdvTG9nZ2FibGVDb21wb25lbnQgPSBleHBvcnRzLlNFVkVSSVRZX0xFVkVMX01BUCA9IGV4cG9ydHMuREVGQVVMVF9NQVhfRE9DVU1FTlRfTEVOR1RIID0gZXhwb3J0cy5TZXZlcml0eUxldmVsID0gdm9pZCAwO1xuZXhwb3J0cy5wYXJzZVNldmVyaXR5RnJvbVN0cmluZyA9IHBhcnNlU2V2ZXJpdHlGcm9tU3RyaW5nO1xuZXhwb3J0cy5jcmVhdGVTdGRpb0xvZ2dlciA9IGNyZWF0ZVN0ZGlvTG9nZ2VyO1xuZXhwb3J0cy5zdHJpbmdpZnlXaXRoTWF4TGVuID0gc3RyaW5naWZ5V2l0aE1heExlbjtcbmV4cG9ydHMuZGVmYXVsdExvZ1RyYW5zZm9ybSA9IGRlZmF1bHRMb2dUcmFuc2Zvcm07XG5jb25zdCB1dGlsXzEgPSByZXF1aXJlKFwidXRpbFwiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuL2Jzb25cIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbi8qKlxuICogQHB1YmxpY1xuICogU2V2ZXJpdHkgbGV2ZWxzIGFsaWduIHdpdGggdW5peCBzeXNsb2cuXG4gKiBNb3N0IHR5cGljYWwgZHJpdmVyIGZ1bmN0aW9ucyB3aWxsIGxvZyB0byBkZWJ1Zy5cbiAqL1xuZXhwb3J0cy5TZXZlcml0eUxldmVsID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgRU1FUkdFTkNZOiAnZW1lcmdlbmN5JyxcbiAgICBBTEVSVDogJ2FsZXJ0JyxcbiAgICBDUklUSUNBTDogJ2NyaXRpY2FsJyxcbiAgICBFUlJPUjogJ2Vycm9yJyxcbiAgICBXQVJOSU5HOiAnd2FybicsXG4gICAgTk9USUNFOiAnbm90aWNlJyxcbiAgICBJTkZPUk1BVElPTkFMOiAnaW5mbycsXG4gICAgREVCVUc6ICdkZWJ1ZycsXG4gICAgVFJBQ0U6ICd0cmFjZScsXG4gICAgT0ZGOiAnb2ZmJ1xufSk7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkRFRkFVTFRfTUFYX0RPQ1VNRU5UX0xFTkdUSCA9IDEwMDA7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBTZXZlcml0eUxldmVsTWFwIGV4dGVuZHMgTWFwIHtcbiAgICBjb25zdHJ1Y3RvcihlbnRyaWVzKSB7XG4gICAgICAgIGNvbnN0IG5ld0VudHJpZXMgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBbbGV2ZWwsIHZhbHVlXSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgICBuZXdFbnRyaWVzLnB1c2goW3ZhbHVlLCBsZXZlbF0pO1xuICAgICAgICB9XG4gICAgICAgIG5ld0VudHJpZXMucHVzaCguLi5lbnRyaWVzKTtcbiAgICAgICAgc3VwZXIobmV3RW50cmllcyk7XG4gICAgfVxuICAgIGdldE51bWVyaWNTZXZlcml0eUxldmVsKHNldmVyaXR5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChzZXZlcml0eSk7XG4gICAgfVxuICAgIGdldFNldmVyaXR5TGV2ZWxOYW1lKGxldmVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChsZXZlbCk7XG4gICAgfVxufVxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5TRVZFUklUWV9MRVZFTF9NQVAgPSBuZXcgU2V2ZXJpdHlMZXZlbE1hcChbXG4gICAgW2V4cG9ydHMuU2V2ZXJpdHlMZXZlbC5PRkYsIC1JbmZpbml0eV0sXG4gICAgW2V4cG9ydHMuU2V2ZXJpdHlMZXZlbC5FTUVSR0VOQ1ksIDBdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuQUxFUlQsIDFdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuQ1JJVElDQUwsIDJdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuRVJST1IsIDNdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuV0FSTklORywgNF0sXG4gICAgW2V4cG9ydHMuU2V2ZXJpdHlMZXZlbC5OT1RJQ0UsIDVdLFxuICAgIFtleHBvcnRzLlNldmVyaXR5TGV2ZWwuSU5GT1JNQVRJT05BTCwgNl0sXG4gICAgW2V4cG9ydHMuU2V2ZXJpdHlMZXZlbC5ERUJVRywgN10sXG4gICAgW2V4cG9ydHMuU2V2ZXJpdHlMZXZlbC5UUkFDRSwgOF1cbl0pO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudCA9IE9iamVjdC5mcmVlemUoe1xuICAgIENPTU1BTkQ6ICdjb21tYW5kJyxcbiAgICBUT1BPTE9HWTogJ3RvcG9sb2d5JyxcbiAgICBTRVJWRVJfU0VMRUNUSU9OOiAnc2VydmVyU2VsZWN0aW9uJyxcbiAgICBDT05ORUNUSU9OOiAnY29ubmVjdGlvbicsXG4gICAgQ0xJRU5UOiAnY2xpZW50J1xufSk7XG4vKipcbiAqIFBhcnNlcyBhIHN0cmluZyBhcyBvbmUgb2YgU2V2ZXJpdHlMZXZlbFxuICogQGludGVybmFsXG4gKlxuICogQHBhcmFtIHMgLSB0aGUgdmFsdWUgdG8gYmUgcGFyc2VkXG4gKiBAcmV0dXJucyBvbmUgb2YgU2V2ZXJpdHlMZXZlbCBpZiB2YWx1ZSBjYW4gYmUgcGFyc2VkIGFzIHN1Y2gsIG90aGVyd2lzZSBudWxsXG4gKi9cbmZ1bmN0aW9uIHBhcnNlU2V2ZXJpdHlGcm9tU3RyaW5nKHMpIHtcbiAgICBjb25zdCB2YWxpZFNldmVyaXRpZXMgPSBPYmplY3QudmFsdWVzKGV4cG9ydHMuU2V2ZXJpdHlMZXZlbCk7XG4gICAgY29uc3QgbG93ZXJTZXZlcml0eSA9IHM/LnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxvd2VyU2V2ZXJpdHkgIT0gbnVsbCAmJiB2YWxpZFNldmVyaXRpZXMuaW5jbHVkZXMobG93ZXJTZXZlcml0eSkpIHtcbiAgICAgICAgcmV0dXJuIGxvd2VyU2V2ZXJpdHk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gY3JlYXRlU3RkaW9Mb2dnZXIoc3RyZWFtKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd3JpdGU6ICgwLCB1dGlsXzEucHJvbWlzaWZ5KSgobG9nLCBjYikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbG9nTGluZSA9ICgwLCB1dGlsXzEuaW5zcGVjdCkobG9nLCB7IGNvbXBhY3Q6IHRydWUsIGJyZWFrTGVuZ3RoOiBJbmZpbml0eSB9KTtcbiAgICAgICAgICAgIHN0cmVhbS53cml0ZShgJHtsb2dMaW5lfVxcbmAsICd1dGYtOCcsIGNiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSlcbiAgICB9O1xufVxuLyoqXG4gKiByZXNvbHZlcyB0aGUgTU9OR09EQl9MT0dfUEFUSCBhbmQgbW9uZ29kYkxvZ1BhdGggb3B0aW9ucyBmcm9tIHRoZSBlbnZpcm9ubWVudCBhbmQgdGhlXG4gKiBtb25nbyBjbGllbnQgb3B0aW9ucyByZXNwZWN0aXZlbHkuIFRoZSBtb25nb2RiTG9nUGF0aCBjYW4gYmUgZWl0aGVyICdzdGRvdXQnLCAnc3RkZXJyJywgYSBOb2RlSlNcbiAqIFdyaXRhYmxlIG9yIGFuIG9iamVjdCB3aGljaCBoYXMgYSBgd3JpdGVgIG1ldGhvZCB3aXRoIHRoZSBzaWduYXR1cmU6XG4gKiBgYGB0c1xuICogd3JpdGUobG9nOiBMb2cpOiB2b2lkXG4gKiBgYGBcbiAqXG4gKiBAcmV0dXJucyB0aGUgTW9uZ29EQkxvZ1dyaXRhYmxlIG9iamVjdCB0byB3cml0ZSBsb2dzIHRvXG4gKi9cbmZ1bmN0aW9uIHJlc29sdmVMb2dQYXRoKHsgTU9OR09EQl9MT0dfUEFUSCB9LCB7IG1vbmdvZGJMb2dQYXRoIH0pIHtcbiAgICBpZiAodHlwZW9mIG1vbmdvZGJMb2dQYXRoID09PSAnc3RyaW5nJyAmJiAvXnN0ZGVyciQvaS50ZXN0KG1vbmdvZGJMb2dQYXRoKSkge1xuICAgICAgICByZXR1cm4geyBtb25nb2RiTG9nUGF0aDogY3JlYXRlU3RkaW9Mb2dnZXIocHJvY2Vzcy5zdGRlcnIpLCBtb25nb2RiTG9nUGF0aElzU3RkRXJyOiB0cnVlIH07XG4gICAgfVxuICAgIGlmICh0eXBlb2YgbW9uZ29kYkxvZ1BhdGggPT09ICdzdHJpbmcnICYmIC9ec3Rkb3V0JC9pLnRlc3QobW9uZ29kYkxvZ1BhdGgpKSB7XG4gICAgICAgIHJldHVybiB7IG1vbmdvZGJMb2dQYXRoOiBjcmVhdGVTdGRpb0xvZ2dlcihwcm9jZXNzLnN0ZG91dCksIG1vbmdvZGJMb2dQYXRoSXNTdGRFcnI6IGZhbHNlIH07XG4gICAgfVxuICAgIGlmICh0eXBlb2YgbW9uZ29kYkxvZ1BhdGggPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb25nb2RiTG9nUGF0aD8ud3JpdGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIHsgbW9uZ29kYkxvZ1BhdGg6IG1vbmdvZGJMb2dQYXRoLCBtb25nb2RiTG9nUGF0aElzU3RkRXJyOiBmYWxzZSB9O1xuICAgIH1cbiAgICBpZiAoTU9OR09EQl9MT0dfUEFUSCAmJiAvXnN0ZGVyciQvaS50ZXN0KE1PTkdPREJfTE9HX1BBVEgpKSB7XG4gICAgICAgIHJldHVybiB7IG1vbmdvZGJMb2dQYXRoOiBjcmVhdGVTdGRpb0xvZ2dlcihwcm9jZXNzLnN0ZGVyciksIG1vbmdvZGJMb2dQYXRoSXNTdGRFcnI6IHRydWUgfTtcbiAgICB9XG4gICAgaWYgKE1PTkdPREJfTE9HX1BBVEggJiYgL15zdGRvdXQkL2kudGVzdChNT05HT0RCX0xPR19QQVRIKSkge1xuICAgICAgICByZXR1cm4geyBtb25nb2RiTG9nUGF0aDogY3JlYXRlU3RkaW9Mb2dnZXIocHJvY2Vzcy5zdGRvdXQpLCBtb25nb2RiTG9nUGF0aElzU3RkRXJyOiBmYWxzZSB9O1xuICAgIH1cbiAgICByZXR1cm4geyBtb25nb2RiTG9nUGF0aDogY3JlYXRlU3RkaW9Mb2dnZXIocHJvY2Vzcy5zdGRlcnIpLCBtb25nb2RiTG9nUGF0aElzU3RkRXJyOiB0cnVlIH07XG59XG5mdW5jdGlvbiByZXNvbHZlU2V2ZXJpdHlDb25maWd1cmF0aW9uKGNsaWVudE9wdGlvbiwgZW52aXJvbm1lbnRPcHRpb24sIGRlZmF1bHRTZXZlcml0eSkge1xuICAgIHJldHVybiAocGFyc2VTZXZlcml0eUZyb21TdHJpbmcoY2xpZW50T3B0aW9uKSA/P1xuICAgICAgICBwYXJzZVNldmVyaXR5RnJvbVN0cmluZyhlbnZpcm9ubWVudE9wdGlvbikgPz9cbiAgICAgICAgZGVmYXVsdFNldmVyaXR5KTtcbn1cbmZ1bmN0aW9uIGNvbXBhcmVTZXZlcml0eShzMCwgczEpIHtcbiAgICBjb25zdCBzME51bSA9IGV4cG9ydHMuU0VWRVJJVFlfTEVWRUxfTUFQLmdldE51bWVyaWNTZXZlcml0eUxldmVsKHMwKTtcbiAgICBjb25zdCBzMU51bSA9IGV4cG9ydHMuU0VWRVJJVFlfTEVWRUxfTUFQLmdldE51bWVyaWNTZXZlcml0eUxldmVsKHMxKTtcbiAgICByZXR1cm4gczBOdW0gPCBzMU51bSA/IC0xIDogczBOdW0gPiBzMU51bSA/IDEgOiAwO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gc3RyaW5naWZ5V2l0aE1heExlbih2YWx1ZSwgbWF4RG9jdW1lbnRMZW5ndGgsIG9wdGlvbnMgPSB7fSkge1xuICAgIGxldCBzdHJUb1RydW5jYXRlID0gJyc7XG4gICAgbGV0IGN1cnJlbnRMZW5ndGggPSAwO1xuICAgIGNvbnN0IG1heERvY3VtZW50TGVuZ3RoRW5zdXJlciA9IGZ1bmN0aW9uIG1heERvY3VtZW50TGVuZ3RoRW5zdXJlcihrZXksIHZhbHVlKSB7XG4gICAgICAgIGlmIChjdXJyZW50TGVuZ3RoID49IG1heERvY3VtZW50TGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFjY291bnQgZm9yIHJvb3QgZG9jdW1lbnRcbiAgICAgICAgaWYgKGtleSA9PT0gJycpIHtcbiAgICAgICAgICAgIC8vIEFjY291bnQgZm9yIHN0YXJ0aW5nIGJyYWNlXG4gICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IDE7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gKzQgYWNjb3VudHMgZm9yIDIgcXVvdGF0aW9uIG1hcmtzLCBjb2xvbiBhbmQgY29tbWEgYWZ0ZXIgdmFsdWVcbiAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgcG90ZW50aWFsbHkgdW5kZXJjb3VudHMgc2luY2UgaXQgZG9lcyBub3QgYWNjb3VudCBmb3IgZXNjYXBlIHNlcXVlbmNlcyB3aGljaFxuICAgICAgICAvLyB3aWxsIGhhdmUgYW4gYWRkaXRpb25hbCBiYWNrc2xhc2ggYWRkZWQgdG8gdGhlbSBvbmNlIHBhc3NlZCB0aHJvdWdoIEpTT04uc3RyaW5naWZ5LlxuICAgICAgICBjdXJyZW50TGVuZ3RoICs9IGtleS5sZW5ndGggKyA0O1xuICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgLy8gKzIgYWNjb3VudHMgZm9yIHF1b3Rlc1xuICAgICAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIHBvdGVudGlhbGx5IHVuZGVyY291bnRzIHNpbWlsYXJseSB0byB0aGUga2V5IGxlbmd0aCBjYWxjdWxhdGlvblxuICAgICAgICAgICAgICAgIGN1cnJlbnRMZW5ndGggKz0gdmFsdWUubGVuZ3RoICsgMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICBjYXNlICdiaWdpbnQnOlxuICAgICAgICAgICAgICAgIGN1cnJlbnRMZW5ndGggKz0gU3RyaW5nKHZhbHVlKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IHZhbHVlID8gNCA6IDU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgIGlmICgoMCwgdXRpbHNfMS5pc1VpbnQ4QXJyYXkpKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyAne1wiJGJpbmFyeVwiOntcImJhc2U2NFwiOlwiPGJhc2U2NCBzdHJpbmc+XCIsXCJzdWJUeXBlXCI6XCJYWFwifX0nXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYW4gZXN0aW1hdGUgYmFzZWQgb24gdGhlIGZhY3QgdGhhdCB0aGUgYmFzZTY0IGlzIGFwcHJveGltYXRlbHkgMS4zM3ggdGhlIGxlbmd0aCBvZlxuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgYWN0dWFsIGJpbmFyeSBzZXF1ZW5jZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXNlNjRcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSAoMjIgKyB2YWx1ZS5ieXRlTGVuZ3RoICsgdmFsdWUuYnl0ZUxlbmd0aCAqIDAuMzMgKyAxOCkgfCAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgnX2Jzb250eXBlJyBpbiB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodi5fYnNvbnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0ludDMyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IFN0cmluZyh2LnZhbHVlKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdEb3VibGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFjY291bnQgZm9yIHJlcHJlc2VudGluZyBpbnRlZ2VycyBhcyA8dmFsdWU+LjBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh2LnZhbHVlIHwgMCkgPT09IHYudmFsdWUgPyBTdHJpbmcodi52YWx1ZSkubGVuZ3RoICsgMiA6IFN0cmluZyh2LnZhbHVlKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdMb25nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IHYudG9TdHJpbmcoKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdPYmplY3RJZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJ3tcIiRvaWRcIjpcIlhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFwifSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IDM1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnTWF4S2V5JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ01pbktleSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJ3tcIiRtYXhLZXlcIjoxfScgb3IgJ3tcIiRtaW5LZXlcIjoxfSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IDEzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQmluYXJ5JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAne1wiJGJpbmFyeVwiOntcImJhc2U2NFwiOlwiPGJhc2U2NCBzdHJpbmc+XCIsXCJzdWJUeXBlXCI6XCJYWFwifX0nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhbiBlc3RpbWF0ZSBiYXNlZCBvbiB0aGUgZmFjdCB0aGF0IHRoZSBiYXNlNjQgaXMgYXBwcm94aW1hdGVseSAxLjMzeCB0aGUgbGVuZ3RoIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGFjdHVhbCBiaW5hcnkgc2VxdWVuY2UgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQmFzZTY0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSAoMjIgKyB2YWx1ZS5wb3NpdGlvbiArIHZhbHVlLnBvc2l0aW9uICogMC4zMyArIDE4KSB8IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdUaW1lc3RhbXAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICd7XCIkdGltZXN0YW1wXCI6e1widFwiOjx0PixcImlcIjo8aT59fSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IDE5ICsgU3RyaW5nKHYudCkubGVuZ3RoICsgNSArIFN0cmluZyh2LmkpLmxlbmd0aCArIDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdDb2RlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAne1wiJGNvZGVcIjpcIjxjb2RlPlwifScgb3IgJ3tcIiRjb2RlXCI6XCI8Y29kZT5cIixcIiRzY29wZVwiOjxzY29wZT59J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2LnNjb3BlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSB2LmNvZGUubGVuZ3RoICsgMTAgKyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JpbmcgYWN0dWFsIHNjb3BlIG9iamVjdCwgc28gdGhpcyB1bmRlcmNvdW50cyBieSBhIHNpZ25pZmljYW50IGFtb3VudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IHYuY29kZS5sZW5ndGggKyAxMCArIDExO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0JTT05SZWdFeHAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICd7XCIkcmVndWxhckV4cHJlc3Npb25cIjp7XCJwYXR0ZXJuXCI6XCI8cGF0dGVybj5cIixcIm9wdGlvbnNcIjpcIjxvcHRpb25zPlwifX0nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSAzNCArIHYucGF0dGVybi5sZW5ndGggKyAxMyArIHYub3B0aW9ucy5sZW5ndGggKyAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9O1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHN0clRvVHJ1bmNhdGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHN0clRvVHJ1bmNhdGUgPSB2YWx1ZS5uYW1lO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChtYXhEb2N1bWVudExlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHN0clRvVHJ1bmNhdGUgPSBic29uXzEuRUpTT04uc3RyaW5naWZ5KHZhbHVlLCBtYXhEb2N1bWVudExlbmd0aEVuc3VyZXIsIDAsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3RyVG9UcnVuY2F0ZSA9IGJzb25fMS5FSlNPTi5zdHJpbmdpZnkodmFsdWUsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBzdHJUb1RydW5jYXRlID0gYEV4dGVuZGVkIEpTT04gc2VyaWFsaXphdGlvbiBmYWlsZWQgd2l0aDogJHtlLm1lc3NhZ2V9YDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBoYW5kbGUgdHJ1bmNhdGlvbiB0aGF0IG9jY3VycyBpbiB0aGUgbWlkZGxlIG9mIG11bHRpLWJ5dGUgY29kZXBvaW50c1xuICAgIGlmIChtYXhEb2N1bWVudExlbmd0aCAhPT0gMCAmJlxuICAgICAgICBzdHJUb1RydW5jYXRlLmxlbmd0aCA+IG1heERvY3VtZW50TGVuZ3RoICYmXG4gICAgICAgIHN0clRvVHJ1bmNhdGUuY2hhckNvZGVBdChtYXhEb2N1bWVudExlbmd0aCAtIDEpICE9PVxuICAgICAgICAgICAgc3RyVG9UcnVuY2F0ZS5jb2RlUG9pbnRBdChtYXhEb2N1bWVudExlbmd0aCAtIDEpKSB7XG4gICAgICAgIG1heERvY3VtZW50TGVuZ3RoLS07XG4gICAgICAgIGlmIChtYXhEb2N1bWVudExlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtYXhEb2N1bWVudExlbmd0aCAhPT0gMCAmJiBzdHJUb1RydW5jYXRlLmxlbmd0aCA+IG1heERvY3VtZW50TGVuZ3RoXG4gICAgICAgID8gYCR7c3RyVG9UcnVuY2F0ZS5zbGljZSgwLCBtYXhEb2N1bWVudExlbmd0aCl9Li4uYFxuICAgICAgICA6IHN0clRvVHJ1bmNhdGU7XG59XG5mdW5jdGlvbiBpc0xvZ0NvbnZlcnRpYmxlKG9iaikge1xuICAgIGNvbnN0IG9iakFzTG9nQ29udmVydGlibGUgPSBvYmo7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgcmV0dXJuIG9iakFzTG9nQ29udmVydGlibGUudG9Mb2cgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb2JqQXNMb2dDb252ZXJ0aWJsZS50b0xvZyA9PT0gJ2Z1bmN0aW9uJztcbn1cbmZ1bmN0aW9uIGF0dGFjaFNlcnZlclNlbGVjdGlvbkZpZWxkcyhsb2csIHNlcnZlclNlbGVjdGlvbkV2ZW50LCBtYXhEb2N1bWVudExlbmd0aCA9IGV4cG9ydHMuREVGQVVMVF9NQVhfRE9DVU1FTlRfTEVOR1RIKSB7XG4gICAgY29uc3QgeyBzZWxlY3Rvciwgb3BlcmF0aW9uLCB0b3BvbG9neURlc2NyaXB0aW9uLCBtZXNzYWdlIH0gPSBzZXJ2ZXJTZWxlY3Rpb25FdmVudDtcbiAgICBsb2cuc2VsZWN0b3IgPSBzdHJpbmdpZnlXaXRoTWF4TGVuKHNlbGVjdG9yLCBtYXhEb2N1bWVudExlbmd0aCk7XG4gICAgbG9nLm9wZXJhdGlvbiA9IG9wZXJhdGlvbjtcbiAgICBsb2cudG9wb2xvZ3lEZXNjcmlwdGlvbiA9IHN0cmluZ2lmeVdpdGhNYXhMZW4odG9wb2xvZ3lEZXNjcmlwdGlvbiwgbWF4RG9jdW1lbnRMZW5ndGgpO1xuICAgIGxvZy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICByZXR1cm4gbG9nO1xufVxuZnVuY3Rpb24gYXR0YWNoQ29tbWFuZEZpZWxkcyhsb2csIGNvbW1hbmRFdmVudCkge1xuICAgIGxvZy5jb21tYW5kTmFtZSA9IGNvbW1hbmRFdmVudC5jb21tYW5kTmFtZTtcbiAgICBsb2cucmVxdWVzdElkID0gY29tbWFuZEV2ZW50LnJlcXVlc3RJZDtcbiAgICBsb2cuZHJpdmVyQ29ubmVjdGlvbklkID0gY29tbWFuZEV2ZW50LmNvbm5lY3Rpb25JZDtcbiAgICBjb25zdCB7IGhvc3QsIHBvcnQgfSA9IHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhjb21tYW5kRXZlbnQuYWRkcmVzcykudG9Ib3N0UG9ydCgpO1xuICAgIGxvZy5zZXJ2ZXJIb3N0ID0gaG9zdDtcbiAgICBsb2cuc2VydmVyUG9ydCA9IHBvcnQ7XG4gICAgaWYgKGNvbW1hbmRFdmVudD8uc2VydmljZUlkKSB7XG4gICAgICAgIGxvZy5zZXJ2aWNlSWQgPSBjb21tYW5kRXZlbnQuc2VydmljZUlkLnRvSGV4U3RyaW5nKCk7XG4gICAgfVxuICAgIGxvZy5kYXRhYmFzZU5hbWUgPSBjb21tYW5kRXZlbnQuZGF0YWJhc2VOYW1lO1xuICAgIGxvZy5zZXJ2ZXJDb25uZWN0aW9uSWQgPSBjb21tYW5kRXZlbnQuc2VydmVyQ29ubmVjdGlvbklkO1xuICAgIHJldHVybiBsb2c7XG59XG5mdW5jdGlvbiBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgZXZlbnQpIHtcbiAgICBjb25zdCB7IGhvc3QsIHBvcnQgfSA9IHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhldmVudC5hZGRyZXNzKS50b0hvc3RQb3J0KCk7XG4gICAgbG9nLnNlcnZlckhvc3QgPSBob3N0O1xuICAgIGxvZy5zZXJ2ZXJQb3J0ID0gcG9ydDtcbiAgICByZXR1cm4gbG9nO1xufVxuZnVuY3Rpb24gYXR0YWNoU0RBTUZpZWxkcyhsb2csIHNkYW1FdmVudCkge1xuICAgIGxvZy50b3BvbG9neUlkID0gc2RhbUV2ZW50LnRvcG9sb2d5SWQ7XG4gICAgcmV0dXJuIGxvZztcbn1cbmZ1bmN0aW9uIGF0dGFjaFNlcnZlckhlYXJ0YmVhdEZpZWxkcyhsb2csIHNlcnZlckhlYXJ0YmVhdEV2ZW50KSB7XG4gICAgY29uc3QgeyBhd2FpdGVkLCBjb25uZWN0aW9uSWQgfSA9IHNlcnZlckhlYXJ0YmVhdEV2ZW50O1xuICAgIGxvZy5hd2FpdGVkID0gYXdhaXRlZDtcbiAgICBsb2cuZHJpdmVyQ29ubmVjdGlvbklkID0gc2VydmVySGVhcnRiZWF0RXZlbnQuY29ubmVjdGlvbklkO1xuICAgIGNvbnN0IHsgaG9zdCwgcG9ydCB9ID0gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKGNvbm5lY3Rpb25JZCkudG9Ib3N0UG9ydCgpO1xuICAgIGxvZy5zZXJ2ZXJIb3N0ID0gaG9zdDtcbiAgICBsb2cuc2VydmVyUG9ydCA9IHBvcnQ7XG4gICAgcmV0dXJuIGxvZztcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGRlZmF1bHRMb2dUcmFuc2Zvcm0obG9nT2JqZWN0LCBtYXhEb2N1bWVudExlbmd0aCA9IGV4cG9ydHMuREVGQVVMVF9NQVhfRE9DVU1FTlRfTEVOR1RIKSB7XG4gICAgbGV0IGxvZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgc3dpdGNoIChsb2dPYmplY3QubmFtZSkge1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLlNFUlZFUl9TRUxFQ1RJT05fU1RBUlRFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaFNlcnZlclNlbGVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCwgbWF4RG9jdW1lbnRMZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5TRVJWRVJfU0VMRUNUSU9OX0ZBSUxFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaFNlcnZlclNlbGVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCwgbWF4RG9jdW1lbnRMZW5ndGgpO1xuICAgICAgICAgICAgbG9nLmZhaWx1cmUgPSBsb2dPYmplY3QuZmFpbHVyZT8ubWVzc2FnZTtcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuU0VSVkVSX1NFTEVDVElPTl9TVUNDRUVERUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTZXJ2ZXJTZWxlY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QsIG1heERvY3VtZW50TGVuZ3RoKTtcbiAgICAgICAgICAgIGxvZy5zZXJ2ZXJIb3N0ID0gbG9nT2JqZWN0LnNlcnZlckhvc3Q7XG4gICAgICAgICAgICBsb2cuc2VydmVyUG9ydCA9IGxvZ09iamVjdC5zZXJ2ZXJQb3J0O1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5XQUlUSU5HX0ZPUl9TVUlUQUJMRV9TRVJWRVI6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTZXJ2ZXJTZWxlY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QsIG1heERvY3VtZW50TGVuZ3RoKTtcbiAgICAgICAgICAgIGxvZy5yZW1haW5pbmdUaW1lTVMgPSBsb2dPYmplY3QucmVtYWluaW5nVGltZU1TO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT01NQU5EX1NUQVJURUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb21tYW5kRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0NvbW1hbmQgc3RhcnRlZCc7XG4gICAgICAgICAgICBsb2cuY29tbWFuZCA9IHN0cmluZ2lmeVdpdGhNYXhMZW4obG9nT2JqZWN0LmNvbW1hbmQsIG1heERvY3VtZW50TGVuZ3RoLCB7IHJlbGF4ZWQ6IHRydWUgfSk7XG4gICAgICAgICAgICBsb2cuZGF0YWJhc2VOYW1lID0gbG9nT2JqZWN0LmRhdGFiYXNlTmFtZTtcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuQ09NTUFORF9TVUNDRUVERUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb21tYW5kRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0NvbW1hbmQgc3VjY2VlZGVkJztcbiAgICAgICAgICAgIGxvZy5kdXJhdGlvbk1TID0gbG9nT2JqZWN0LmR1cmF0aW9uO1xuICAgICAgICAgICAgbG9nLnJlcGx5ID0gc3RyaW5naWZ5V2l0aE1heExlbihsb2dPYmplY3QucmVwbHksIG1heERvY3VtZW50TGVuZ3RoLCB7IHJlbGF4ZWQ6IHRydWUgfSk7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTU1BTkRfRkFJTEVEOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoQ29tbWFuZEZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdDb21tYW5kIGZhaWxlZCc7XG4gICAgICAgICAgICBsb2cuZHVyYXRpb25NUyA9IGxvZ09iamVjdC5kdXJhdGlvbjtcbiAgICAgICAgICAgIGxvZy5mYWlsdXJlID0gbG9nT2JqZWN0LmZhaWx1cmU/Lm1lc3NhZ2UgPz8gJyhyZWRhY3RlZCknO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ1JFQVRFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBwb29sIGNyZWF0ZWQnO1xuICAgICAgICAgICAgaWYgKGxvZ09iamVjdC5vcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBtYXhJZGxlVGltZU1TLCBtaW5Qb29sU2l6ZSwgbWF4UG9vbFNpemUsIG1heENvbm5lY3RpbmcsIHdhaXRRdWV1ZVRpbWVvdXRNUyB9ID0gbG9nT2JqZWN0Lm9wdGlvbnM7XG4gICAgICAgICAgICAgICAgbG9nID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5sb2csXG4gICAgICAgICAgICAgICAgICAgIG1heElkbGVUaW1lTVMsXG4gICAgICAgICAgICAgICAgICAgIG1pblBvb2xTaXplLFxuICAgICAgICAgICAgICAgICAgICBtYXhQb29sU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4Q29ubmVjdGluZyxcbiAgICAgICAgICAgICAgICAgICAgd2FpdFF1ZXVlVGltZW91dE1TXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuQ09OTkVDVElPTl9QT09MX1JFQURZOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoQ29ubmVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdDb25uZWN0aW9uIHBvb2wgcmVhZHknO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ0xFQVJFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBwb29sIGNsZWFyZWQnO1xuICAgICAgICAgICAgaWYgKGxvZ09iamVjdC5zZXJ2aWNlSWQ/Ll9ic29udHlwZSA9PT0gJ09iamVjdElkJykge1xuICAgICAgICAgICAgICAgIGxvZy5zZXJ2aWNlSWQgPSBsb2dPYmplY3Quc2VydmljZUlkPy50b0hleFN0cmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX1BPT0xfQ0xPU0VEOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoQ29ubmVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdDb25uZWN0aW9uIHBvb2wgY2xvc2VkJztcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuQ09OTkVDVElPTl9DUkVBVEVEOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoQ29ubmVjdGlvbkZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdDb25uZWN0aW9uIGNyZWF0ZWQnO1xuICAgICAgICAgICAgbG9nLmRyaXZlckNvbm5lY3Rpb25JZCA9IGxvZ09iamVjdC5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fUkVBRFk6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gcmVhZHknO1xuICAgICAgICAgICAgbG9nLmRyaXZlckNvbm5lY3Rpb25JZCA9IGxvZ09iamVjdC5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICBsb2cuZHVyYXRpb25NUyA9IGxvZ09iamVjdC5kdXJhdGlvbk1TO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NMT1NFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBjbG9zZWQnO1xuICAgICAgICAgICAgbG9nLmRyaXZlckNvbm5lY3Rpb25JZCA9IGxvZ09iamVjdC5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICBzd2l0Y2ggKGxvZ09iamVjdC5yZWFzb24pIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdGFsZSc6XG4gICAgICAgICAgICAgICAgICAgIGxvZy5yZWFzb24gPSAnQ29ubmVjdGlvbiBiZWNhbWUgc3RhbGUgYmVjYXVzZSB0aGUgcG9vbCB3YXMgY2xlYXJlZCc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2lkbGUnOlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID1cbiAgICAgICAgICAgICAgICAgICAgICAgICdDb25uZWN0aW9uIGhhcyBiZWVuIGF2YWlsYWJsZSBidXQgdW51c2VkIGZvciBsb25nZXIgdGhhbiB0aGUgY29uZmlndXJlZCBtYXggaWRsZSB0aW1lJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID0gJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIHVzaW5nIHRoZSBjb25uZWN0aW9uJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ09iamVjdC5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yID0gbG9nT2JqZWN0LmVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3Bvb2xDbG9zZWQnOlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID0gJ0Nvbm5lY3Rpb24gcG9vbCB3YXMgY2xvc2VkJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9IGBVbmtub3duIGNsb3NlIHJlYXNvbjogJHtsb2dPYmplY3QucmVhc29ufWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX1NUQVJURUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY2hlY2tvdXQgc3RhcnRlZCc7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tfT1VUX0ZBSUxFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBjaGVja291dCBmYWlsZWQnO1xuICAgICAgICAgICAgc3dpdGNoIChsb2dPYmplY3QucmVhc29uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAncG9vbENsb3NlZCc6XG4gICAgICAgICAgICAgICAgICAgIGxvZy5yZWFzb24gPSAnQ29ubmVjdGlvbiBwb29sIHdhcyBjbG9zZWQnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd0aW1lb3V0JzpcbiAgICAgICAgICAgICAgICAgICAgbG9nLnJlYXNvbiA9ICdXYWl0IHF1ZXVlIHRpbWVvdXQgZWxhcHNlZCB3aXRob3V0IGEgY29ubmVjdGlvbiBiZWNvbWluZyBhdmFpbGFibGUnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdjb25uZWN0aW9uRXJyb3InOlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID0gJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBlc3RhYmxpc2ggYSBuZXcgY29ubmVjdGlvbic7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2dPYmplY3QuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5lcnJvciA9IGxvZ09iamVjdC5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBsb2cucmVhc29uID0gYFVua25vd24gY2xvc2UgcmVhc29uOiAke2xvZ09iamVjdC5yZWFzb259YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZy5kdXJhdGlvbk1TID0gbG9nT2JqZWN0LmR1cmF0aW9uTVM7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLkNPTk5FQ1RJT05fQ0hFQ0tFRF9PVVQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY2hlY2tlZCBvdXQnO1xuICAgICAgICAgICAgbG9nLmRyaXZlckNvbm5lY3Rpb25JZCA9IGxvZ09iamVjdC5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICBsb2cuZHVyYXRpb25NUyA9IGxvZ09iamVjdC5kdXJhdGlvbk1TO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5DT05ORUNUSU9OX0NIRUNLRURfSU46XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ0Nvbm5lY3Rpb24gY2hlY2tlZCBpbic7XG4gICAgICAgICAgICBsb2cuZHJpdmVyQ29ubmVjdGlvbklkID0gbG9nT2JqZWN0LmNvbm5lY3Rpb25JZDtcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuU0VSVkVSX09QRU5JTkc6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTREFNRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaENvbm5lY3Rpb25GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nLm1lc3NhZ2UgPSAnU3RhcnRpbmcgc2VydmVyIG1vbml0b3JpbmcnO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5TRVJWRVJfQ0xPU0VEOlxuICAgICAgICAgICAgbG9nID0gYXR0YWNoU0RBTUZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hDb25uZWN0aW9uRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ1N0b3BwZWQgc2VydmVyIG1vbml0b3JpbmcnO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTREFNRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaFNlcnZlckhlYXJ0YmVhdEZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdTZXJ2ZXIgaGVhcnRiZWF0IHN0YXJ0ZWQnO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRDpcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaFNEQU1GaWVsZHMobG9nLCBsb2dPYmplY3QpO1xuICAgICAgICAgICAgbG9nID0gYXR0YWNoU2VydmVySGVhcnRiZWF0RmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ1NlcnZlciBoZWFydGJlYXQgc3VjY2VlZGVkJztcbiAgICAgICAgICAgIGxvZy5kdXJhdGlvbk1TID0gbG9nT2JqZWN0LmR1cmF0aW9uO1xuICAgICAgICAgICAgbG9nLnNlcnZlckNvbm5lY3Rpb25JZCA9IGxvZ09iamVjdC5zZXJ2ZXJDb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICBsb2cucmVwbHkgPSBzdHJpbmdpZnlXaXRoTWF4TGVuKGxvZ09iamVjdC5yZXBseSwgbWF4RG9jdW1lbnRMZW5ndGgsIHsgcmVsYXhlZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIHJldHVybiBsb2c7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzXzEuU0VSVkVSX0hFQVJUQkVBVF9GQUlMRUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTREFNRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZyA9IGF0dGFjaFNlcnZlckhlYXJ0YmVhdEZpZWxkcyhsb2csIGxvZ09iamVjdCk7XG4gICAgICAgICAgICBsb2cubWVzc2FnZSA9ICdTZXJ2ZXIgaGVhcnRiZWF0IGZhaWxlZCc7XG4gICAgICAgICAgICBsb2cuZHVyYXRpb25NUyA9IGxvZ09iamVjdC5kdXJhdGlvbjtcbiAgICAgICAgICAgIGxvZy5mYWlsdXJlID0gbG9nT2JqZWN0LmZhaWx1cmU/Lm1lc3NhZ2U7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLlRPUE9MT0dZX09QRU5JTkc6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTREFNRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ1N0YXJ0aW5nIHRvcG9sb2d5IG1vbml0b3JpbmcnO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgY2FzZSBjb25zdGFudHNfMS5UT1BPTE9HWV9DTE9TRUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTREFNRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ1N0b3BwZWQgdG9wb2xvZ3kgbW9uaXRvcmluZyc7XG4gICAgICAgICAgICByZXR1cm4gbG9nO1xuICAgICAgICBjYXNlIGNvbnN0YW50c18xLlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQ6XG4gICAgICAgICAgICBsb2cgPSBhdHRhY2hTREFNRmllbGRzKGxvZywgbG9nT2JqZWN0KTtcbiAgICAgICAgICAgIGxvZy5tZXNzYWdlID0gJ1RvcG9sb2d5IGRlc2NyaXB0aW9uIGNoYW5nZWQnO1xuICAgICAgICAgICAgbG9nLnByZXZpb3VzRGVzY3JpcHRpb24gPSBsb2cucmVwbHkgPSBzdHJpbmdpZnlXaXRoTWF4TGVuKGxvZ09iamVjdC5wcmV2aW91c0Rlc2NyaXB0aW9uLCBtYXhEb2N1bWVudExlbmd0aCk7XG4gICAgICAgICAgICBsb2cubmV3RGVzY3JpcHRpb24gPSBsb2cucmVwbHkgPSBzdHJpbmdpZnlXaXRoTWF4TGVuKGxvZ09iamVjdC5uZXdEZXNjcmlwdGlvbiwgbWF4RG9jdW1lbnRMZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIGxvZztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGxvZ09iamVjdCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgbG9nW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxvZztcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIE1vbmdvTG9nZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMucGVuZGluZ0xvZyA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgdXNlZCB3aGVuIGxvZ2dpbmcgZXJyb3JzIHRoYXQgZG8gbm90IGhhdmUgYSBwdWJsaWMgZHJpdmVyIEFQSSBmb3JcbiAgICAgICAgICogcmVwb3J0aW5nIGVycm9ycy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmxvZy5iaW5kKHRoaXMsICdlcnJvcicpO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgdG8gbG9nIHNpdHVhdGlvbnMgd2hlcmUgdW5kZXNpcmFibGUgYXBwbGljYXRpb24gYmVoYXZpb3VyIG1pZ2h0XG4gICAgICAgICAqIG9jY3VyLiBGb3IgZXhhbXBsZSwgZmFpbGluZyB0byBlbmQgc2Vzc2lvbnMgb24gYE1vbmdvQ2xpZW50LmNsb3NlYC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2FybiA9IHRoaXMubG9nLmJpbmQodGhpcywgJ3dhcm4nKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIHRvIHJlcG9ydCBoaWdoLWxldmVsIGluZm9ybWF0aW9uIGFib3V0IG5vcm1hbCBkcml2ZXIgYmVoYXZpb3VyLlxuICAgICAgICAgKiBGb3IgZXhhbXBsZSwgdGhlIGNyZWF0aW9uIG9mIGEgYE1vbmdvQ2xpZW50YC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5mbyA9IHRoaXMubG9nLmJpbmQodGhpcywgJ2luZm8nKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIHRvIHJlcG9ydCBpbmZvcm1hdGlvbiB0aGF0IHdvdWxkIGJlIGhlbHBmdWwgd2hlbiBkZWJ1Z2dpbmcgYW5cbiAgICAgICAgICogYXBwbGljYXRpb24uIEZvciBleGFtcGxlLCBhIGNvbW1hbmQgc3RhcnRpbmcsIHN1Y2NlZWRpbmcgb3IgZmFpbGluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVidWcgPSB0aGlzLmxvZy5iaW5kKHRoaXMsICdkZWJ1ZycpO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgdG8gcmVwb3J0IGZpbmUtZ3JhaW5lZCBkZXRhaWxzIHJlbGF0ZWQgdG8gbG9naWMgZmxvdy4gRm9yIGV4YW1wbGUsXG4gICAgICAgICAqIGVudGVyaW5nIGFuZCBleGl0aW5nIGEgZnVuY3Rpb24gYm9keS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHJhY2UgPSB0aGlzLmxvZy5iaW5kKHRoaXMsICd0cmFjZScpO1xuICAgICAgICB0aGlzLmNvbXBvbmVudFNldmVyaXRpZXMgPSBvcHRpb25zLmNvbXBvbmVudFNldmVyaXRpZXM7XG4gICAgICAgIHRoaXMubWF4RG9jdW1lbnRMZW5ndGggPSBvcHRpb25zLm1heERvY3VtZW50TGVuZ3RoO1xuICAgICAgICB0aGlzLmxvZ0Rlc3RpbmF0aW9uID0gb3B0aW9ucy5sb2dEZXN0aW5hdGlvbjtcbiAgICAgICAgdGhpcy5sb2dEZXN0aW5hdGlvbklzU3RkRXJyID0gb3B0aW9ucy5sb2dEZXN0aW5hdGlvbklzU3RkRXJyO1xuICAgICAgICB0aGlzLnNldmVyaXRpZXMgPSB0aGlzLmNyZWF0ZUxvZ2dpbmdTZXZlcml0aWVzKCk7XG4gICAgfVxuICAgIGNyZWF0ZUxvZ2dpbmdTZXZlcml0aWVzKCkge1xuICAgICAgICBjb25zdCBzZXZlcml0aWVzID0gT2JqZWN0KCk7XG4gICAgICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIE9iamVjdC52YWx1ZXMoZXhwb3J0cy5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50KSkge1xuICAgICAgICAgICAgc2V2ZXJpdGllc1tjb21wb25lbnRdID0ge307XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNldmVyaXR5TGV2ZWwgb2YgT2JqZWN0LnZhbHVlcyhleHBvcnRzLlNldmVyaXR5TGV2ZWwpKSB7XG4gICAgICAgICAgICAgICAgc2V2ZXJpdGllc1tjb21wb25lbnRdW3NldmVyaXR5TGV2ZWxdID1cbiAgICAgICAgICAgICAgICAgICAgY29tcGFyZVNldmVyaXR5KHNldmVyaXR5TGV2ZWwsIHRoaXMuY29tcG9uZW50U2V2ZXJpdGllc1tjb21wb25lbnRdKSA8PSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXZlcml0aWVzO1xuICAgIH1cbiAgICB0dXJuT2ZmU2V2ZXJpdGllcygpIHtcbiAgICAgICAgZm9yIChjb25zdCBjb21wb25lbnQgb2YgT2JqZWN0LnZhbHVlcyhleHBvcnRzLk1vbmdvTG9nZ2FibGVDb21wb25lbnQpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudFNldmVyaXRpZXNbY29tcG9uZW50XSA9IGV4cG9ydHMuU2V2ZXJpdHlMZXZlbC5PRkY7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNldmVyaXR5TGV2ZWwgb2YgT2JqZWN0LnZhbHVlcyhleHBvcnRzLlNldmVyaXR5TGV2ZWwpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXZlcml0aWVzW2NvbXBvbmVudF1bc2V2ZXJpdHlMZXZlbF0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBsb2dXcml0ZUZhaWx1cmVIYW5kbGVyKGVycm9yKSB7XG4gICAgICAgIGlmICh0aGlzLmxvZ0Rlc3RpbmF0aW9uSXNTdGRFcnIpIHtcbiAgICAgICAgICAgIHRoaXMudHVybk9mZlNldmVyaXRpZXMoKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJQZW5kaW5nTG9nKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2dEZXN0aW5hdGlvbiA9IGNyZWF0ZVN0ZGlvTG9nZ2VyKHByb2Nlc3Muc3RkZXJyKTtcbiAgICAgICAgdGhpcy5sb2dEZXN0aW5hdGlvbklzU3RkRXJyID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jbGVhclBlbmRpbmdMb2coKTtcbiAgICAgICAgdGhpcy5lcnJvcihleHBvcnRzLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuQ0xJRU5ULCB7XG4gICAgICAgICAgICB0b0xvZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIGlucHV0IGZvciBtb25nb2RiTG9nUGF0aCBpcyBub3cgaW52YWxpZC4gTG9nZ2luZyBpcyBoYWx0ZWQuJyxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50dXJuT2ZmU2V2ZXJpdGllcygpO1xuICAgICAgICB0aGlzLmNsZWFyUGVuZGluZ0xvZygpO1xuICAgIH1cbiAgICBjbGVhclBlbmRpbmdMb2coKSB7XG4gICAgICAgIHRoaXMucGVuZGluZ0xvZyA9IG51bGw7XG4gICAgfVxuICAgIHdpbGxMb2coY29tcG9uZW50LCBzZXZlcml0eSkge1xuICAgICAgICBpZiAoc2V2ZXJpdHkgPT09IGV4cG9ydHMuU2V2ZXJpdHlMZXZlbC5PRkYpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLnNldmVyaXRpZXNbY29tcG9uZW50XVtzZXZlcml0eV07XG4gICAgfVxuICAgIGxvZyhzZXZlcml0eSwgY29tcG9uZW50LCBtZXNzYWdlKSB7XG4gICAgICAgIGlmICghdGhpcy53aWxsTG9nKGNvbXBvbmVudCwgc2V2ZXJpdHkpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgbG9nTWVzc2FnZSA9IHsgdDogbmV3IERhdGUoKSwgYzogY29tcG9uZW50LCBzOiBzZXZlcml0eSB9O1xuICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBsb2dNZXNzYWdlLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgaWYgKGlzTG9nQ29udmVydGlibGUobWVzc2FnZSkpIHtcbiAgICAgICAgICAgICAgICBsb2dNZXNzYWdlID0geyAuLi5sb2dNZXNzYWdlLCAuLi5tZXNzYWdlLnRvTG9nKCkgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvZ01lc3NhZ2UgPSB7IC4uLmxvZ01lc3NhZ2UsIC4uLmRlZmF1bHRMb2dUcmFuc2Zvcm0obWVzc2FnZSwgdGhpcy5tYXhEb2N1bWVudExlbmd0aCkgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaXNQcm9taXNlTGlrZSkodGhpcy5wZW5kaW5nTG9nKSkge1xuICAgICAgICAgICAgdGhpcy5wZW5kaW5nTG9nID0gdGhpcy5wZW5kaW5nTG9nXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5sb2dEZXN0aW5hdGlvbi53cml0ZShsb2dNZXNzYWdlKSlcbiAgICAgICAgICAgICAgICAudGhlbih0aGlzLmNsZWFyUGVuZGluZ0xvZy5iaW5kKHRoaXMpLCB0aGlzLmxvZ1dyaXRlRmFpbHVyZUhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGxvZ1Jlc3VsdCA9IHRoaXMubG9nRGVzdGluYXRpb24ud3JpdGUobG9nTWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaXNQcm9taXNlTGlrZSkobG9nUmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0xvZyA9IGxvZ1Jlc3VsdC50aGVuKHRoaXMuY2xlYXJQZW5kaW5nTG9nLmJpbmQodGhpcyksIHRoaXMubG9nV3JpdGVGYWlsdXJlSGFuZGxlci5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMubG9nV3JpdGVGYWlsdXJlSGFuZGxlcihlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogTWVyZ2VzIG9wdGlvbnMgc2V0IHRocm91Z2ggZW52aXJvbm1lbnQgdmFyaWFibGVzIGFuZCB0aGUgTW9uZ29DbGllbnQsIHByZWZlcnJpbmcgZW52aXJvbm1lbnRcbiAgICAgKiB2YXJpYWJsZXMgd2hlbiBib3RoIGFyZSBzZXQsIGFuZCBzdWJzdGl0dXRpbmcgZGVmYXVsdHMgZm9yIHZhbHVlcyBub3Qgc2V0LiBPcHRpb25zIHNldCBpblxuICAgICAqIGNvbnN0cnVjdG9yIHRha2UgcHJlY2VkZW5jZSBvdmVyIGJvdGggZW52aXJvbm1lbnQgdmFyaWFibGVzIGFuZCBNb25nb0NsaWVudCBvcHRpb25zLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBXaGVuIHBhcnNpbmcgY29tcG9uZW50IHNldmVyaXR5IGxldmVscywgaW52YWxpZCB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgdW5zZXQgYW5kIHJlcGxhY2VkIHdpdGhcbiAgICAgKiB0aGUgZGVmYXVsdCBzZXZlcml0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBlbnZPcHRpb25zIC0gb3B0aW9ucyBzZXQgZm9yIHRoZSBsb2dnZXIgZnJvbSB0aGUgZW52aXJvbm1lbnRcbiAgICAgKiBAcGFyYW0gY2xpZW50T3B0aW9ucyAtIG9wdGlvbnMgc2V0IGZvciB0aGUgbG9nZ2VyIGluIHRoZSBNb25nb0NsaWVudCBvcHRpb25zXG4gICAgICogQHJldHVybnMgYSBNb25nb0xvZ2dlck9wdGlvbnMgb2JqZWN0IHRvIGJlIHVzZWQgd2hlbiBpbnN0YW50aWF0aW5nIGEgbmV3IE1vbmdvTG9nZ2VyXG4gICAgICovXG4gICAgc3RhdGljIHJlc29sdmVPcHRpb25zKGVudk9wdGlvbnMsIGNsaWVudE9wdGlvbnMpIHtcbiAgICAgICAgLy8gY2xpZW50IG9wdGlvbnMgdGFrZSBwcmVjZWRlbmNlIG92ZXIgZW52IG9wdGlvbnNcbiAgICAgICAgY29uc3QgcmVzb2x2ZWRMb2dQYXRoID0gcmVzb2x2ZUxvZ1BhdGgoZW52T3B0aW9ucywgY2xpZW50T3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGNvbWJpbmVkT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIC4uLmVudk9wdGlvbnMsXG4gICAgICAgICAgICAuLi5jbGllbnRPcHRpb25zLFxuICAgICAgICAgICAgbW9uZ29kYkxvZ1BhdGg6IHJlc29sdmVkTG9nUGF0aC5tb25nb2RiTG9nUGF0aCxcbiAgICAgICAgICAgIG1vbmdvZGJMb2dQYXRoSXNTdGRFcnI6IHJlc29sdmVkTG9nUGF0aC5tb25nb2RiTG9nUGF0aElzU3RkRXJyXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGRlZmF1bHRTZXZlcml0eSA9IHJlc29sdmVTZXZlcml0eUNvbmZpZ3VyYXRpb24oY29tYmluZWRPcHRpb25zLm1vbmdvZGJMb2dDb21wb25lbnRTZXZlcml0aWVzPy5kZWZhdWx0LCBjb21iaW5lZE9wdGlvbnMuTU9OR09EQl9MT0dfQUxMLCBleHBvcnRzLlNldmVyaXR5TGV2ZWwuT0ZGKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFNldmVyaXRpZXM6IHtcbiAgICAgICAgICAgICAgICBjb21tYW5kOiByZXNvbHZlU2V2ZXJpdHlDb25maWd1cmF0aW9uKGNvbWJpbmVkT3B0aW9ucy5tb25nb2RiTG9nQ29tcG9uZW50U2V2ZXJpdGllcz8uY29tbWFuZCwgY29tYmluZWRPcHRpb25zLk1PTkdPREJfTE9HX0NPTU1BTkQsIGRlZmF1bHRTZXZlcml0eSksXG4gICAgICAgICAgICAgICAgdG9wb2xvZ3k6IHJlc29sdmVTZXZlcml0eUNvbmZpZ3VyYXRpb24oY29tYmluZWRPcHRpb25zLm1vbmdvZGJMb2dDb21wb25lbnRTZXZlcml0aWVzPy50b3BvbG9neSwgY29tYmluZWRPcHRpb25zLk1PTkdPREJfTE9HX1RPUE9MT0dZLCBkZWZhdWx0U2V2ZXJpdHkpLFxuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvbjogcmVzb2x2ZVNldmVyaXR5Q29uZmlndXJhdGlvbihjb21iaW5lZE9wdGlvbnMubW9uZ29kYkxvZ0NvbXBvbmVudFNldmVyaXRpZXM/LnNlcnZlclNlbGVjdGlvbiwgY29tYmluZWRPcHRpb25zLk1PTkdPREJfTE9HX1NFUlZFUl9TRUxFQ1RJT04sIGRlZmF1bHRTZXZlcml0eSksXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbjogcmVzb2x2ZVNldmVyaXR5Q29uZmlndXJhdGlvbihjb21iaW5lZE9wdGlvbnMubW9uZ29kYkxvZ0NvbXBvbmVudFNldmVyaXRpZXM/LmNvbm5lY3Rpb24sIGNvbWJpbmVkT3B0aW9ucy5NT05HT0RCX0xPR19DT05ORUNUSU9OLCBkZWZhdWx0U2V2ZXJpdHkpLFxuICAgICAgICAgICAgICAgIGNsaWVudDogcmVzb2x2ZVNldmVyaXR5Q29uZmlndXJhdGlvbihjb21iaW5lZE9wdGlvbnMubW9uZ29kYkxvZ0NvbXBvbmVudFNldmVyaXRpZXM/LmNsaWVudCwgY29tYmluZWRPcHRpb25zLk1PTkdPREJfTE9HX0NMSUVOVCwgZGVmYXVsdFNldmVyaXR5KSxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBkZWZhdWx0U2V2ZXJpdHlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXhEb2N1bWVudExlbmd0aDogY29tYmluZWRPcHRpb25zLm1vbmdvZGJMb2dNYXhEb2N1bWVudExlbmd0aCA/P1xuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnBhcnNlVW5zaWduZWRJbnRlZ2VyKShjb21iaW5lZE9wdGlvbnMuTU9OR09EQl9MT0dfTUFYX0RPQ1VNRU5UX0xFTkdUSCkgPz9cbiAgICAgICAgICAgICAgICAxMDAwLFxuICAgICAgICAgICAgbG9nRGVzdGluYXRpb246IGNvbWJpbmVkT3B0aW9ucy5tb25nb2RiTG9nUGF0aCxcbiAgICAgICAgICAgIGxvZ0Rlc3RpbmF0aW9uSXNTdGRFcnI6IGNvbWJpbmVkT3B0aW9ucy5tb25nb2RiTG9nUGF0aElzU3RkRXJyXG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0xvZ2dlciA9IE1vbmdvTG9nZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9uZ29fbG9nZ2VyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CancellationToken = exports.TypedEventEmitter = void 0;\nconst events_1 = __webpack_require__(/*! events */ \"events\");\nconst mongo_logger_1 = __webpack_require__(/*! ./mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/**\n * Typescript type safe event emitter\n * @public\n */\n// eslint-disable-next-line @typescript-eslint/no-unsafe-declaration-merging\nclass TypedEventEmitter extends events_1.EventEmitter {\n    /** @internal */\n    emitAndLog(event, ...args) {\n        this.emit(event, ...args);\n        if (this.component)\n            this.mongoLogger?.debug(this.component, args[0]);\n    }\n    /** @internal */\n    emitAndLogHeartbeat(event, topologyId, serverConnectionId, ...args) {\n        this.emit(event, ...args);\n        if (this.component) {\n            const loggableHeartbeatEvent = {\n                topologyId: topologyId,\n                serverConnectionId: serverConnectionId ?? null,\n                ...args[0]\n            };\n            this.mongoLogger?.debug(this.component, loggableHeartbeatEvent);\n        }\n    }\n    /** @internal */\n    emitAndLogCommand(monitorCommands, event, databaseName, connectionEstablished, ...args) {\n        if (monitorCommands) {\n            this.emit(event, ...args);\n        }\n        if (connectionEstablished) {\n            const loggableCommandEvent = {\n                databaseName: databaseName,\n                ...args[0]\n            };\n            this.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.COMMAND, loggableCommandEvent);\n        }\n    }\n}\nexports.TypedEventEmitter = TypedEventEmitter;\n/** @public */\nclass CancellationToken extends TypedEventEmitter {\n    constructor(...args) {\n        super(...args);\n        this.on('error', utils_1.noop);\n    }\n}\nexports.CancellationToken = CancellationToken;\n//# sourceMappingURL=mongo_types.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL21vbmdvX3R5cGVzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QixHQUFHLHlCQUF5QjtBQUNyRCxpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyx1QkFBdUIsbUJBQU8sQ0FBQywwR0FBZ0I7QUFDL0MsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL21vbmdvX3R5cGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DYW5jZWxsYXRpb25Ub2tlbiA9IGV4cG9ydHMuVHlwZWRFdmVudEVtaXR0ZXIgPSB2b2lkIDA7XG5jb25zdCBldmVudHNfMSA9IHJlcXVpcmUoXCJldmVudHNcIik7XG5jb25zdCBtb25nb19sb2dnZXJfMSA9IHJlcXVpcmUoXCIuL21vbmdvX2xvZ2dlclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbi8qKlxuICogVHlwZXNjcmlwdCB0eXBlIHNhZmUgZXZlbnQgZW1pdHRlclxuICogQHB1YmxpY1xuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1kZWNsYXJhdGlvbi1tZXJnaW5nXG5jbGFzcyBUeXBlZEV2ZW50RW1pdHRlciBleHRlbmRzIGV2ZW50c18xLkV2ZW50RW1pdHRlciB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGVtaXRBbmRMb2coZXZlbnQsIC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5lbWl0KGV2ZW50LCAuLi5hcmdzKTtcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50KVxuICAgICAgICAgICAgdGhpcy5tb25nb0xvZ2dlcj8uZGVidWcodGhpcy5jb21wb25lbnQsIGFyZ3NbMF0pO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZW1pdEFuZExvZ0hlYXJ0YmVhdChldmVudCwgdG9wb2xvZ3lJZCwgc2VydmVyQ29ubmVjdGlvbklkLCAuLi5hcmdzKSB7XG4gICAgICAgIHRoaXMuZW1pdChldmVudCwgLi4uYXJncyk7XG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xuICAgICAgICAgICAgY29uc3QgbG9nZ2FibGVIZWFydGJlYXRFdmVudCA9IHtcbiAgICAgICAgICAgICAgICB0b3BvbG9neUlkOiB0b3BvbG9neUlkLFxuICAgICAgICAgICAgICAgIHNlcnZlckNvbm5lY3Rpb25JZDogc2VydmVyQ29ubmVjdGlvbklkID8/IG51bGwsXG4gICAgICAgICAgICAgICAgLi4uYXJnc1swXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMubW9uZ29Mb2dnZXI/LmRlYnVnKHRoaXMuY29tcG9uZW50LCBsb2dnYWJsZUhlYXJ0YmVhdEV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZW1pdEFuZExvZ0NvbW1hbmQobW9uaXRvckNvbW1hbmRzLCBldmVudCwgZGF0YWJhc2VOYW1lLCBjb25uZWN0aW9uRXN0YWJsaXNoZWQsIC4uLmFyZ3MpIHtcbiAgICAgICAgaWYgKG1vbml0b3JDb21tYW5kcykge1xuICAgICAgICAgICAgdGhpcy5lbWl0KGV2ZW50LCAuLi5hcmdzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29ubmVjdGlvbkVzdGFibGlzaGVkKSB7XG4gICAgICAgICAgICBjb25zdCBsb2dnYWJsZUNvbW1hbmRFdmVudCA9IHtcbiAgICAgICAgICAgICAgICBkYXRhYmFzZU5hbWU6IGRhdGFiYXNlTmFtZSxcbiAgICAgICAgICAgICAgICAuLi5hcmdzWzBdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5tb25nb0xvZ2dlcj8uZGVidWcobW9uZ29fbG9nZ2VyXzEuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudC5DT01NQU5ELCBsb2dnYWJsZUNvbW1hbmRFdmVudCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLlR5cGVkRXZlbnRFbWl0dGVyID0gVHlwZWRFdmVudEVtaXR0ZXI7XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgQ2FuY2VsbGF0aW9uVG9rZW4gZXh0ZW5kcyBUeXBlZEV2ZW50RW1pdHRlciB7XG4gICAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgICAgICBzdXBlciguLi5hcmdzKTtcbiAgICAgICAgdGhpcy5vbignZXJyb3InLCB1dGlsc18xLm5vb3ApO1xuICAgIH1cbn1cbmV4cG9ydHMuQ2FuY2VsbGF0aW9uVG9rZW4gPSBDYW5jZWxsYXRpb25Ub2tlbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vbmdvX3R5cGVzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/aggregate.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/aggregate.js ***!
  \********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AggregateOperation = exports.DB_AGGREGATE_COLLECTION = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\nexports.DB_AGGREGATE_COLLECTION = 1;\nconst MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT = 8;\n/** @internal */\nclass AggregateOperation extends command_1.CommandOperation {\n    constructor(ns, pipeline, options) {\n        super(undefined, { ...options, dbName: ns.db });\n        this.options = { ...options };\n        // Covers when ns.collection is null, undefined or the empty string, use DB_AGGREGATE_COLLECTION\n        this.target = ns.collection || exports.DB_AGGREGATE_COLLECTION;\n        this.pipeline = pipeline;\n        // determine if we have a write stage, override read preference if so\n        this.hasWriteStage = false;\n        if (typeof options?.out === 'string') {\n            this.pipeline = this.pipeline.concat({ $out: options.out });\n            this.hasWriteStage = true;\n        }\n        else if (pipeline.length > 0) {\n            const finalStage = pipeline[pipeline.length - 1];\n            if (finalStage.$out || finalStage.$merge) {\n                this.hasWriteStage = true;\n            }\n        }\n        if (this.hasWriteStage) {\n            this.trySecondaryWrite = true;\n        }\n        else {\n            delete this.options.writeConcern;\n        }\n        if (this.explain && this.writeConcern) {\n            throw new error_1.MongoInvalidArgumentError('Option \"explain\" cannot be used on an aggregate call with writeConcern');\n        }\n        if (options?.cursor != null && typeof options.cursor !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Cursor options must be an object');\n        }\n    }\n    get commandName() {\n        return 'aggregate';\n    }\n    get canRetryRead() {\n        return !this.hasWriteStage;\n    }\n    addToPipeline(stage) {\n        this.pipeline.push(stage);\n    }\n    async execute(server, session, timeoutContext) {\n        const options = this.options;\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const command = { aggregate: this.target, pipeline: this.pipeline };\n        if (this.hasWriteStage && serverWireVersion < MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT) {\n            this.readConcern = undefined;\n        }\n        if (this.hasWriteStage && this.writeConcern) {\n            write_concern_1.WriteConcern.apply(command, this.writeConcern);\n        }\n        if (options.bypassDocumentValidation === true) {\n            command.bypassDocumentValidation = options.bypassDocumentValidation;\n        }\n        if (typeof options.allowDiskUse === 'boolean') {\n            command.allowDiskUse = options.allowDiskUse;\n        }\n        if (options.hint) {\n            command.hint = options.hint;\n        }\n        if (options.let) {\n            command.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        command.cursor = options.cursor || {};\n        if (options.batchSize && !this.hasWriteStage) {\n            command.cursor.batchSize = options.batchSize;\n        }\n        return await super.executeCommand(server, session, command, timeoutContext, this.explain ? responses_1.ExplainedCursorResponse : responses_1.CursorResponse);\n    }\n}\nexports.AggregateOperation = AggregateOperation;\n(0, operation_1.defineAspects)(AggregateOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=aggregate.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvYWdncmVnYXRlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDBCQUEwQixHQUFHLCtCQUErQjtBQUM1RCxvQkFBb0IsbUJBQU8sQ0FBQywySUFBaUM7QUFDN0QsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsd0JBQXdCLG1CQUFPLENBQUMsNkdBQWtCO0FBQ2xELGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsMkJBQTJCO0FBQ3RELHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsbUJBQW1CO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2FnZ3JlZ2F0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWdncmVnYXRlT3BlcmF0aW9uID0gZXhwb3J0cy5EQl9BR0dSRUdBVEVfQ09MTEVDVElPTiA9IHZvaWQgMDtcbmNvbnN0IHJlc3BvbnNlc18xID0gcmVxdWlyZShcIi4uL2NtYXAvd2lyZV9wcm90b2NvbC9yZXNwb25zZXNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi93cml0ZV9jb25jZXJuXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bm5lY2Vzc2FyeS10eXBlLWFzc2VydGlvblxuZXhwb3J0cy5EQl9BR0dSRUdBVEVfQ09MTEVDVElPTiA9IDE7XG5jb25zdCBNSU5fV0lSRV9WRVJTSU9OXyRPVVRfUkVBRF9DT05DRVJOX1NVUFBPUlQgPSA4O1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQWdncmVnYXRlT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG5zLCBwaXBlbGluZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcih1bmRlZmluZWQsIHsgLi4ub3B0aW9ucywgZGJOYW1lOiBucy5kYiB9KTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5vcHRpb25zIH07XG4gICAgICAgIC8vIENvdmVycyB3aGVuIG5zLmNvbGxlY3Rpb24gaXMgbnVsbCwgdW5kZWZpbmVkIG9yIHRoZSBlbXB0eSBzdHJpbmcsIHVzZSBEQl9BR0dSRUdBVEVfQ09MTEVDVElPTlxuICAgICAgICB0aGlzLnRhcmdldCA9IG5zLmNvbGxlY3Rpb24gfHwgZXhwb3J0cy5EQl9BR0dSRUdBVEVfQ09MTEVDVElPTjtcbiAgICAgICAgdGhpcy5waXBlbGluZSA9IHBpcGVsaW5lO1xuICAgICAgICAvLyBkZXRlcm1pbmUgaWYgd2UgaGF2ZSBhIHdyaXRlIHN0YWdlLCBvdmVycmlkZSByZWFkIHByZWZlcmVuY2UgaWYgc29cbiAgICAgICAgdGhpcy5oYXNXcml0ZVN0YWdlID0gZmFsc2U7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucz8ub3V0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5waXBlbGluZSA9IHRoaXMucGlwZWxpbmUuY29uY2F0KHsgJG91dDogb3B0aW9ucy5vdXQgfSk7XG4gICAgICAgICAgICB0aGlzLmhhc1dyaXRlU3RhZ2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBpcGVsaW5lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbmFsU3RhZ2UgPSBwaXBlbGluZVtwaXBlbGluZS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGlmIChmaW5hbFN0YWdlLiRvdXQgfHwgZmluYWxTdGFnZS4kbWVyZ2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhc1dyaXRlU3RhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhhc1dyaXRlU3RhZ2UpIHtcbiAgICAgICAgICAgIHRoaXMudHJ5U2Vjb25kYXJ5V3JpdGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy53cml0ZUNvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZXhwbGFpbiAmJiB0aGlzLndyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignT3B0aW9uIFwiZXhwbGFpblwiIGNhbm5vdCBiZSB1c2VkIG9uIGFuIGFnZ3JlZ2F0ZSBjYWxsIHdpdGggd3JpdGVDb25jZXJuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnM/LmN1cnNvciAhPSBudWxsICYmIHR5cGVvZiBvcHRpb25zLmN1cnNvciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0N1cnNvciBvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Jyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ2FnZ3JlZ2F0ZSc7XG4gICAgfVxuICAgIGdldCBjYW5SZXRyeVJlYWQoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5oYXNXcml0ZVN0YWdlO1xuICAgIH1cbiAgICBhZGRUb1BpcGVsaW5lKHN0YWdlKSB7XG4gICAgICAgIHRoaXMucGlwZWxpbmUucHVzaChzdGFnZSk7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBjb25zdCBzZXJ2ZXJXaXJlVmVyc2lvbiA9ICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShzZXJ2ZXIpO1xuICAgICAgICBjb25zdCBjb21tYW5kID0geyBhZ2dyZWdhdGU6IHRoaXMudGFyZ2V0LCBwaXBlbGluZTogdGhpcy5waXBlbGluZSB9O1xuICAgICAgICBpZiAodGhpcy5oYXNXcml0ZVN0YWdlICYmIHNlcnZlcldpcmVWZXJzaW9uIDwgTUlOX1dJUkVfVkVSU0lPTl8kT1VUX1JFQURfQ09OQ0VSTl9TVVBQT1JUKSB7XG4gICAgICAgICAgICB0aGlzLnJlYWRDb25jZXJuID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhhc1dyaXRlU3RhZ2UgJiYgdGhpcy53cml0ZUNvbmNlcm4pIHtcbiAgICAgICAgICAgIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uYXBwbHkoY29tbWFuZCwgdGhpcy53cml0ZUNvbmNlcm4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29tbWFuZC5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gPSBvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuYWxsb3dEaXNrVXNlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuYWxsb3dEaXNrVXNlID0gb3B0aW9ucy5hbGxvd0Rpc2tVc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuaGludCkge1xuICAgICAgICAgICAgY29tbWFuZC5oaW50ID0gb3B0aW9ucy5oaW50O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmxldCkge1xuICAgICAgICAgICAgY29tbWFuZC5sZXQgPSBvcHRpb25zLmxldDtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKG9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21tYW5kLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29tbWFuZC5jdXJzb3IgPSBvcHRpb25zLmN1cnNvciB8fCB7fTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYmF0Y2hTaXplICYmICF0aGlzLmhhc1dyaXRlU3RhZ2UpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY3Vyc29yLmJhdGNoU2l6ZSA9IG9wdGlvbnMuYmF0Y2hTaXplO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIGNvbW1hbmQsIHRpbWVvdXRDb250ZXh0LCB0aGlzLmV4cGxhaW4gPyByZXNwb25zZXNfMS5FeHBsYWluZWRDdXJzb3JSZXNwb25zZSA6IHJlc3BvbnNlc18xLkN1cnNvclJlc3BvbnNlKTtcbiAgICB9XG59XG5leHBvcnRzLkFnZ3JlZ2F0ZU9wZXJhdGlvbiA9IEFnZ3JlZ2F0ZU9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShBZ2dyZWdhdGVPcGVyYXRpb24sIFtcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkNVUlNPUl9DUkVBVElOR1xuXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZ2dyZWdhdGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/aggregate.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/bulk_write.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/bulk_write.js ***!
  \*********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.BulkWriteOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass BulkWriteOperation extends operation_1.AbstractOperation {\n    constructor(collection, operations, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n        this.operations = operations;\n    }\n    get commandName() {\n        return 'bulkWrite';\n    }\n    async execute(server, session, timeoutContext) {\n        const coll = this.collection;\n        const operations = this.operations;\n        const options = {\n            ...this.options,\n            ...this.bsonOptions,\n            readPreference: this.readPreference,\n            timeoutContext\n        };\n        // Create the bulk operation\n        const bulk = options.ordered === false\n            ? coll.initializeUnorderedBulkOp(options)\n            : coll.initializeOrderedBulkOp(options);\n        // for each op go through and add to the bulk\n        for (let i = 0; i < operations.length; i++) {\n            bulk.raw(operations[i]);\n        }\n        // Execute the bulk\n        return await bulk.execute({ ...options, session });\n    }\n}\nexports.BulkWriteOperation = BulkWriteOperation;\n(0, operation_1.defineAspects)(BulkWriteOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=bulk_write.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvYnVsa193cml0ZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCwwQkFBMEI7QUFDMUIsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxxQkFBcUI7QUFDekQ7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9idWxrX3dyaXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5CdWxrV3JpdGVPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEJ1bGtXcml0ZU9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcGVyYXRpb25zLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLm9wZXJhdGlvbnMgPSBvcGVyYXRpb25zO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnYnVsa1dyaXRlJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSB0aGlzLm9wZXJhdGlvbnM7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAuLi50aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICAuLi50aGlzLmJzb25PcHRpb25zLFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UsXG4gICAgICAgICAgICB0aW1lb3V0Q29udGV4dFxuICAgICAgICB9O1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGJ1bGsgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGJ1bGsgPSBvcHRpb25zLm9yZGVyZWQgPT09IGZhbHNlXG4gICAgICAgICAgICA/IGNvbGwuaW5pdGlhbGl6ZVVub3JkZXJlZEJ1bGtPcChvcHRpb25zKVxuICAgICAgICAgICAgOiBjb2xsLmluaXRpYWxpemVPcmRlcmVkQnVsa09wKG9wdGlvbnMpO1xuICAgICAgICAvLyBmb3IgZWFjaCBvcCBnbyB0aHJvdWdoIGFuZCBhZGQgdG8gdGhlIGJ1bGtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcGVyYXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBidWxrLnJhdyhvcGVyYXRpb25zW2ldKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBFeGVjdXRlIHRoZSBidWxrXG4gICAgICAgIHJldHVybiBhd2FpdCBidWxrLmV4ZWN1dGUoeyAuLi5vcHRpb25zLCBzZXNzaW9uIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuQnVsa1dyaXRlT3BlcmF0aW9uID0gQnVsa1dyaXRlT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEJ1bGtXcml0ZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWJ1bGtfd3JpdGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/bulk_write.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/client_bulk_write.js":
/*!**********************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/client_bulk_write.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ClientBulkWriteOperation = void 0;\nconst beta_1 = __webpack_require__(/*! ../../beta */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/beta.js\");\nconst responses_1 = __webpack_require__(/*! ../../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ../command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/**\n * Executes a single client bulk write operation within a potential batch.\n * @internal\n */\nclass ClientBulkWriteOperation extends command_1.CommandOperation {\n    get commandName() {\n        return 'bulkWrite';\n    }\n    constructor(commandBuilder, options) {\n        super(undefined, options);\n        this.commandBuilder = commandBuilder;\n        this.options = options;\n        this.ns = new utils_1.MongoDBNamespace('admin', '$cmd');\n    }\n    resetBatch() {\n        return this.commandBuilder.resetBatch();\n    }\n    get canRetryWrite() {\n        return this.commandBuilder.isBatchRetryable;\n    }\n    /**\n     * Execute the command. Superclass will handle write concern, etc.\n     * @param server - The server.\n     * @param session - The session.\n     * @returns The response.\n     */\n    async execute(server, session, timeoutContext) {\n        let command;\n        if (server.description.type === beta_1.ServerType.LoadBalancer) {\n            if (session) {\n                let connection;\n                if (!session.pinnedConnection) {\n                    // Checkout a connection to build the command.\n                    connection = await server.pool.checkOut({ timeoutContext });\n                    // Pin the connection to the session so it get used to execute the command and we do not\n                    // perform a double check-in/check-out.\n                    session.pin(connection);\n                }\n                else {\n                    connection = session.pinnedConnection;\n                }\n                command = this.commandBuilder.buildBatch(connection.hello?.maxMessageSizeBytes, connection.hello?.maxWriteBatchSize, connection.hello?.maxBsonObjectSize);\n            }\n            else {\n                throw new beta_1.MongoClientBulkWriteExecutionError('Session provided to the client bulk write operation must be present.');\n            }\n        }\n        else {\n            // At this point we have a server and the auto connect code has already\n            // run in executeOperation, so the server description will be populated.\n            // We can use that to build the command.\n            if (!server.description.maxWriteBatchSize ||\n                !server.description.maxMessageSizeBytes ||\n                !server.description.maxBsonObjectSize) {\n                throw new beta_1.MongoClientBulkWriteExecutionError('In order to execute a client bulk write, both maxWriteBatchSize, maxMessageSizeBytes and maxBsonObjectSize must be provided by the servers hello response.');\n            }\n            command = this.commandBuilder.buildBatch(server.description.maxMessageSizeBytes, server.description.maxWriteBatchSize, server.description.maxBsonObjectSize);\n        }\n        // Check after the batch is built if we cannot retry it and override the option.\n        if (!this.canRetryWrite) {\n            this.options.willRetryWrite = false;\n        }\n        return await super.executeCommand(server, session, command, timeoutContext, responses_1.ClientBulkWriteCursorResponse);\n    }\n}\nexports.ClientBulkWriteOperation = ClientBulkWriteOperation;\n// Skipping the collation as it goes on the individual ops.\n(0, operation_1.defineAspects)(ClientBulkWriteOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.SKIP_COLLATION,\n    operation_1.Aspect.CURSOR_CREATING,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.COMMAND_BATCHING\n]);\n//# sourceMappingURL=client_bulk_write.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY2xpZW50X2J1bGtfd3JpdGUvY2xpZW50X2J1bGtfd3JpdGUuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsZ0NBQWdDO0FBQ2hDLGVBQWUsbUJBQU8sQ0FBQyw4RkFBWTtBQUNuQyxvQkFBb0IsbUJBQU8sQ0FBQyw4SUFBb0M7QUFDaEUsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsa0JBQWtCLG1CQUFPLENBQUMsNEdBQVk7QUFDdEMsb0JBQW9CLG1CQUFPLENBQUMsZ0hBQWM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOERBQThELGdCQUFnQjtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NsaWVudF9idWxrX3dyaXRlL2NsaWVudF9idWxrX3dyaXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DbGllbnRCdWxrV3JpdGVPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBiZXRhXzEgPSByZXF1aXJlKFwiLi4vLi4vYmV0YVwiKTtcbmNvbnN0IHJlc3BvbnNlc18xID0gcmVxdWlyZShcIi4uLy4uL2NtYXAvd2lyZV9wcm90b2NvbC9yZXNwb25zZXNcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4uL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9vcGVyYXRpb25cIik7XG4vKipcbiAqIEV4ZWN1dGVzIGEgc2luZ2xlIGNsaWVudCBidWxrIHdyaXRlIG9wZXJhdGlvbiB3aXRoaW4gYSBwb3RlbnRpYWwgYmF0Y2guXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ2xpZW50QnVsa1dyaXRlT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdidWxrV3JpdGUnO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcihjb21tYW5kQnVpbGRlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcih1bmRlZmluZWQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmNvbW1hbmRCdWlsZGVyID0gY29tbWFuZEJ1aWxkZXI7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMubnMgPSBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKCdhZG1pbicsICckY21kJyk7XG4gICAgfVxuICAgIHJlc2V0QmF0Y2goKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1hbmRCdWlsZGVyLnJlc2V0QmF0Y2goKTtcbiAgICB9XG4gICAgZ2V0IGNhblJldHJ5V3JpdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1hbmRCdWlsZGVyLmlzQmF0Y2hSZXRyeWFibGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgdGhlIGNvbW1hbmQuIFN1cGVyY2xhc3Mgd2lsbCBoYW5kbGUgd3JpdGUgY29uY2VybiwgZXRjLlxuICAgICAqIEBwYXJhbSBzZXJ2ZXIgLSBUaGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSBzZXNzaW9uIC0gVGhlIHNlc3Npb24uXG4gICAgICogQHJldHVybnMgVGhlIHJlc3BvbnNlLlxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBsZXQgY29tbWFuZDtcbiAgICAgICAgaWYgKHNlcnZlci5kZXNjcmlwdGlvbi50eXBlID09PSBiZXRhXzEuU2VydmVyVHlwZS5Mb2FkQmFsYW5jZXIpIHtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgbGV0IGNvbm5lY3Rpb247XG4gICAgICAgICAgICAgICAgaWYgKCFzZXNzaW9uLnBpbm5lZENvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2tvdXQgYSBjb25uZWN0aW9uIHRvIGJ1aWxkIHRoZSBjb21tYW5kLlxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gYXdhaXQgc2VydmVyLnBvb2wuY2hlY2tPdXQoeyB0aW1lb3V0Q29udGV4dCB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUGluIHRoZSBjb25uZWN0aW9uIHRvIHRoZSBzZXNzaW9uIHNvIGl0IGdldCB1c2VkIHRvIGV4ZWN1dGUgdGhlIGNvbW1hbmQgYW5kIHdlIGRvIG5vdFxuICAgICAgICAgICAgICAgICAgICAvLyBwZXJmb3JtIGEgZG91YmxlIGNoZWNrLWluL2NoZWNrLW91dC5cbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5waW4oY29ubmVjdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gc2Vzc2lvbi5waW5uZWRDb25uZWN0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb21tYW5kID0gdGhpcy5jb21tYW5kQnVpbGRlci5idWlsZEJhdGNoKGNvbm5lY3Rpb24uaGVsbG8/Lm1heE1lc3NhZ2VTaXplQnl0ZXMsIGNvbm5lY3Rpb24uaGVsbG8/Lm1heFdyaXRlQmF0Y2hTaXplLCBjb25uZWN0aW9uLmhlbGxvPy5tYXhCc29uT2JqZWN0U2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgYmV0YV8xLk1vbmdvQ2xpZW50QnVsa1dyaXRlRXhlY3V0aW9uRXJyb3IoJ1Nlc3Npb24gcHJvdmlkZWQgdG8gdGhlIGNsaWVudCBidWxrIHdyaXRlIG9wZXJhdGlvbiBtdXN0IGJlIHByZXNlbnQuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHdlIGhhdmUgYSBzZXJ2ZXIgYW5kIHRoZSBhdXRvIGNvbm5lY3QgY29kZSBoYXMgYWxyZWFkeVxuICAgICAgICAgICAgLy8gcnVuIGluIGV4ZWN1dGVPcGVyYXRpb24sIHNvIHRoZSBzZXJ2ZXIgZGVzY3JpcHRpb24gd2lsbCBiZSBwb3B1bGF0ZWQuXG4gICAgICAgICAgICAvLyBXZSBjYW4gdXNlIHRoYXQgdG8gYnVpbGQgdGhlIGNvbW1hbmQuXG4gICAgICAgICAgICBpZiAoIXNlcnZlci5kZXNjcmlwdGlvbi5tYXhXcml0ZUJhdGNoU2l6ZSB8fFxuICAgICAgICAgICAgICAgICFzZXJ2ZXIuZGVzY3JpcHRpb24ubWF4TWVzc2FnZVNpemVCeXRlcyB8fFxuICAgICAgICAgICAgICAgICFzZXJ2ZXIuZGVzY3JpcHRpb24ubWF4QnNvbk9iamVjdFNpemUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgYmV0YV8xLk1vbmdvQ2xpZW50QnVsa1dyaXRlRXhlY3V0aW9uRXJyb3IoJ0luIG9yZGVyIHRvIGV4ZWN1dGUgYSBjbGllbnQgYnVsayB3cml0ZSwgYm90aCBtYXhXcml0ZUJhdGNoU2l6ZSwgbWF4TWVzc2FnZVNpemVCeXRlcyBhbmQgbWF4QnNvbk9iamVjdFNpemUgbXVzdCBiZSBwcm92aWRlZCBieSB0aGUgc2VydmVycyBoZWxsbyByZXNwb25zZS4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbW1hbmQgPSB0aGlzLmNvbW1hbmRCdWlsZGVyLmJ1aWxkQmF0Y2goc2VydmVyLmRlc2NyaXB0aW9uLm1heE1lc3NhZ2VTaXplQnl0ZXMsIHNlcnZlci5kZXNjcmlwdGlvbi5tYXhXcml0ZUJhdGNoU2l6ZSwgc2VydmVyLmRlc2NyaXB0aW9uLm1heEJzb25PYmplY3RTaXplKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBhZnRlciB0aGUgYmF0Y2ggaXMgYnVpbHQgaWYgd2UgY2Fubm90IHJldHJ5IGl0IGFuZCBvdmVycmlkZSB0aGUgb3B0aW9uLlxuICAgICAgICBpZiAoIXRoaXMuY2FuUmV0cnlXcml0ZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLndpbGxSZXRyeVdyaXRlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgdGltZW91dENvbnRleHQsIHJlc3BvbnNlc18xLkNsaWVudEJ1bGtXcml0ZUN1cnNvclJlc3BvbnNlKTtcbiAgICB9XG59XG5leHBvcnRzLkNsaWVudEJ1bGtXcml0ZU9wZXJhdGlvbiA9IENsaWVudEJ1bGtXcml0ZU9wZXJhdGlvbjtcbi8vIFNraXBwaW5nIHRoZSBjb2xsYXRpb24gYXMgaXQgZ29lcyBvbiB0aGUgaW5kaXZpZHVhbCBvcHMuXG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoQ2xpZW50QnVsa1dyaXRlT3BlcmF0aW9uLCBbXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuU0tJUF9DT0xMQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkNVUlNPUl9DUkVBVElORyxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5DT01NQU5EX0JBVENISU5HXG5dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNsaWVudF9idWxrX3dyaXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/client_bulk_write.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/command_builder.js":
/*!********************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/command_builder.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.buildReplaceOneOperation = exports.buildUpdateManyOperation = exports.buildUpdateOneOperation = exports.buildDeleteManyOperation = exports.buildDeleteOneOperation = exports.buildInsertOneOperation = exports.ClientBulkWriteCommandBuilder = void 0;\nexports.buildOperation = buildOperation;\nconst bson_1 = __webpack_require__(/*! ../../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst commands_1 = __webpack_require__(/*! ../../cmap/commands */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/commands.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/**\n * The bytes overhead for the extra fields added post command generation.\n */\nconst MESSAGE_OVERHEAD_BYTES = 1000;\n/** @internal */\nclass ClientBulkWriteCommandBuilder {\n    /**\n     * Create the command builder.\n     * @param models - The client write models.\n     */\n    constructor(models, options, pkFactory) {\n        this.models = models;\n        this.options = options;\n        this.pkFactory = pkFactory ?? utils_1.DEFAULT_PK_FACTORY;\n        this.currentModelIndex = 0;\n        this.previousModelIndex = 0;\n        this.lastOperations = [];\n        this.isBatchRetryable = true;\n    }\n    /**\n     * Gets the errorsOnly value for the command, which is the inverse of the\n     * user provided verboseResults option. Defaults to true.\n     */\n    get errorsOnly() {\n        if ('verboseResults' in this.options) {\n            return !this.options.verboseResults;\n        }\n        return true;\n    }\n    /**\n     * Determines if there is another batch to process.\n     * @returns True if not all batches have been built.\n     */\n    hasNextBatch() {\n        return this.currentModelIndex < this.models.length;\n    }\n    /**\n     * When we need to retry a command we need to set the current\n     * model index back to its previous value.\n     */\n    resetBatch() {\n        this.currentModelIndex = this.previousModelIndex;\n        return true;\n    }\n    /**\n     * Build a single batch of a client bulk write command.\n     * @param maxMessageSizeBytes - The max message size in bytes.\n     * @param maxWriteBatchSize - The max write batch size.\n     * @returns The client bulk write command.\n     */\n    buildBatch(maxMessageSizeBytes, maxWriteBatchSize, maxBsonObjectSize) {\n        // We start by assuming the batch has no multi-updates, so it is retryable\n        // until we find them.\n        this.isBatchRetryable = true;\n        let commandLength = 0;\n        let currentNamespaceIndex = 0;\n        const command = this.baseCommand();\n        const namespaces = new Map();\n        // In the case of retries we need to mark where we started this batch.\n        this.previousModelIndex = this.currentModelIndex;\n        while (this.currentModelIndex < this.models.length) {\n            const model = this.models[this.currentModelIndex];\n            const ns = model.namespace;\n            const nsIndex = namespaces.get(ns);\n            // Multi updates are not retryable.\n            if (model.name === 'deleteMany' || model.name === 'updateMany') {\n                this.isBatchRetryable = false;\n            }\n            if (nsIndex != null) {\n                // Build the operation and serialize it to get the bytes buffer.\n                const operation = buildOperation(model, nsIndex, this.pkFactory);\n                let operationBuffer;\n                try {\n                    operationBuffer = bson_1.BSON.serialize(operation);\n                }\n                catch (cause) {\n                    throw new error_1.MongoInvalidArgumentError(`Could not serialize operation to BSON`, { cause });\n                }\n                validateBufferSize('ops', operationBuffer, maxBsonObjectSize);\n                // Check if the operation buffer can fit in the command. If it can,\n                // then add the operation to the document sequence and increment the\n                // current length as long as the ops don't exceed the maxWriteBatchSize.\n                if (commandLength + operationBuffer.length < maxMessageSizeBytes &&\n                    command.ops.documents.length < maxWriteBatchSize) {\n                    // Pushing to the ops document sequence returns the total byte length of the document sequence.\n                    commandLength = MESSAGE_OVERHEAD_BYTES + command.ops.push(operation, operationBuffer);\n                    // Increment the builder's current model index.\n                    this.currentModelIndex++;\n                }\n                else {\n                    // The operation cannot fit in the current command and will need to\n                    // go in the next batch. Exit the loop.\n                    break;\n                }\n            }\n            else {\n                // The namespace is not already in the nsInfo so we will set it in the map, and\n                // construct our nsInfo and ops documents and buffers.\n                namespaces.set(ns, currentNamespaceIndex);\n                const nsInfo = { ns: ns };\n                const operation = buildOperation(model, currentNamespaceIndex, this.pkFactory);\n                let nsInfoBuffer;\n                let operationBuffer;\n                try {\n                    nsInfoBuffer = bson_1.BSON.serialize(nsInfo);\n                    operationBuffer = bson_1.BSON.serialize(operation);\n                }\n                catch (cause) {\n                    throw new error_1.MongoInvalidArgumentError(`Could not serialize ns info to BSON`, { cause });\n                }\n                validateBufferSize('nsInfo', nsInfoBuffer, maxBsonObjectSize);\n                validateBufferSize('ops', operationBuffer, maxBsonObjectSize);\n                // Check if the operation and nsInfo buffers can fit in the command. If they\n                // can, then add the operation and nsInfo to their respective document\n                // sequences and increment the current length as long as the ops don't exceed\n                // the maxWriteBatchSize.\n                if (commandLength + nsInfoBuffer.length + operationBuffer.length < maxMessageSizeBytes &&\n                    command.ops.documents.length < maxWriteBatchSize) {\n                    // Pushing to the ops document sequence returns the total byte length of the document sequence.\n                    commandLength =\n                        MESSAGE_OVERHEAD_BYTES +\n                            command.nsInfo.push(nsInfo, nsInfoBuffer) +\n                            command.ops.push(operation, operationBuffer);\n                    // We've added a new namespace, increment the namespace index.\n                    currentNamespaceIndex++;\n                    // Increment the builder's current model index.\n                    this.currentModelIndex++;\n                }\n                else {\n                    // The operation cannot fit in the current command and will need to\n                    // go in the next batch. Exit the loop.\n                    break;\n                }\n            }\n        }\n        // Set the last operations and return the command.\n        this.lastOperations = command.ops.documents;\n        return command;\n    }\n    baseCommand() {\n        const command = {\n            bulkWrite: 1,\n            errorsOnly: this.errorsOnly,\n            ordered: this.options.ordered ?? true,\n            ops: new commands_1.DocumentSequence('ops'),\n            nsInfo: new commands_1.DocumentSequence('nsInfo')\n        };\n        // Add bypassDocumentValidation if it was present in the options.\n        if (this.options.bypassDocumentValidation != null) {\n            command.bypassDocumentValidation = this.options.bypassDocumentValidation;\n        }\n        // Add let if it was present in the options.\n        if (this.options.let) {\n            command.let = this.options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (this.options.comment !== undefined) {\n            command.comment = this.options.comment;\n        }\n        return command;\n    }\n}\nexports.ClientBulkWriteCommandBuilder = ClientBulkWriteCommandBuilder;\nfunction validateBufferSize(name, buffer, maxBsonObjectSize) {\n    if (buffer.length > maxBsonObjectSize) {\n        throw new error_1.MongoInvalidArgumentError(`Client bulk write operation ${name} of length ${buffer.length} exceeds the max bson object size of ${maxBsonObjectSize}`);\n    }\n}\n/**\n * Build the insert one operation.\n * @param model - The insert one model.\n * @param index - The namespace index.\n * @returns the operation.\n */\nconst buildInsertOneOperation = (model, index, pkFactory) => {\n    const document = {\n        insert: index,\n        document: model.document\n    };\n    document.document._id = model.document._id ?? pkFactory.createPk();\n    return document;\n};\nexports.buildInsertOneOperation = buildInsertOneOperation;\n/**\n * Build the delete one operation.\n * @param model - The insert many model.\n * @param index - The namespace index.\n * @returns the operation.\n */\nconst buildDeleteOneOperation = (model, index) => {\n    return createDeleteOperation(model, index, false);\n};\nexports.buildDeleteOneOperation = buildDeleteOneOperation;\n/**\n * Build the delete many operation.\n * @param model - The delete many model.\n * @param index - The namespace index.\n * @returns the operation.\n */\nconst buildDeleteManyOperation = (model, index) => {\n    return createDeleteOperation(model, index, true);\n};\nexports.buildDeleteManyOperation = buildDeleteManyOperation;\n/**\n * Creates a delete operation based on the parameters.\n */\nfunction createDeleteOperation(model, index, multi) {\n    const document = {\n        delete: index,\n        multi: multi,\n        filter: model.filter\n    };\n    if (model.hint) {\n        document.hint = model.hint;\n    }\n    if (model.collation) {\n        document.collation = model.collation;\n    }\n    return document;\n}\n/**\n * Build the update one operation.\n * @param model - The update one model.\n * @param index - The namespace index.\n * @returns the operation.\n */\nconst buildUpdateOneOperation = (model, index) => {\n    return createUpdateOperation(model, index, false);\n};\nexports.buildUpdateOneOperation = buildUpdateOneOperation;\n/**\n * Build the update many operation.\n * @param model - The update many model.\n * @param index - The namespace index.\n * @returns the operation.\n */\nconst buildUpdateManyOperation = (model, index) => {\n    return createUpdateOperation(model, index, true);\n};\nexports.buildUpdateManyOperation = buildUpdateManyOperation;\n/**\n * Validate the update document.\n * @param update - The update document.\n */\nfunction validateUpdate(update) {\n    if (!(0, utils_1.hasAtomicOperators)(update)) {\n        throw new error_1.MongoAPIError('Client bulk write update models must only contain atomic modifiers (start with $) and must not be empty.');\n    }\n}\n/**\n * Creates a delete operation based on the parameters.\n */\nfunction createUpdateOperation(model, index, multi) {\n    // Update documents provided in UpdateOne and UpdateMany write models are\n    // required only to contain atomic modifiers (i.e. keys that start with \"$\").\n    // Drivers MUST throw an error if an update document is empty or if the\n    // document's first key does not start with \"$\".\n    validateUpdate(model.update);\n    const document = {\n        update: index,\n        multi: multi,\n        filter: model.filter,\n        updateMods: model.update\n    };\n    if (model.hint) {\n        document.hint = model.hint;\n    }\n    if (model.upsert) {\n        document.upsert = model.upsert;\n    }\n    if (model.arrayFilters) {\n        document.arrayFilters = model.arrayFilters;\n    }\n    if (model.collation) {\n        document.collation = model.collation;\n    }\n    return document;\n}\n/**\n * Build the replace one operation.\n * @param model - The replace one model.\n * @param index - The namespace index.\n * @returns the operation.\n */\nconst buildReplaceOneOperation = (model, index) => {\n    if ((0, utils_1.hasAtomicOperators)(model.replacement)) {\n        throw new error_1.MongoAPIError('Client bulk write replace models must not contain atomic modifiers (start with $) and must not be empty.');\n    }\n    const document = {\n        update: index,\n        multi: false,\n        filter: model.filter,\n        updateMods: model.replacement\n    };\n    if (model.hint) {\n        document.hint = model.hint;\n    }\n    if (model.upsert) {\n        document.upsert = model.upsert;\n    }\n    if (model.collation) {\n        document.collation = model.collation;\n    }\n    return document;\n};\nexports.buildReplaceOneOperation = buildReplaceOneOperation;\n/** @internal */\nfunction buildOperation(model, index, pkFactory) {\n    switch (model.name) {\n        case 'insertOne':\n            return (0, exports.buildInsertOneOperation)(model, index, pkFactory);\n        case 'deleteOne':\n            return (0, exports.buildDeleteOneOperation)(model, index);\n        case 'deleteMany':\n            return (0, exports.buildDeleteManyOperation)(model, index);\n        case 'updateOne':\n            return (0, exports.buildUpdateOneOperation)(model, index);\n        case 'updateMany':\n            return (0, exports.buildUpdateManyOperation)(model, index);\n        case 'replaceOne':\n            return (0, exports.buildReplaceOneOperation)(model, index);\n    }\n}\n//# sourceMappingURL=command_builder.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY2xpZW50X2J1bGtfd3JpdGUvY29tbWFuZF9idWlsZGVyLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGdDQUFnQyxHQUFHLGdDQUFnQyxHQUFHLCtCQUErQixHQUFHLGdDQUFnQyxHQUFHLCtCQUErQixHQUFHLCtCQUErQixHQUFHLHFDQUFxQztBQUNwUCxzQkFBc0I7QUFDdEIsZUFBZSxtQkFBTyxDQUFDLDhGQUFZO0FBQ25DLG1CQUFtQixtQkFBTyxDQUFDLGdIQUFxQjtBQUNoRCxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQyxnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJHQUEyRyxPQUFPO0FBQ2xIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5R0FBeUcsT0FBTztBQUNoSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBLG1GQUFtRixNQUFNLFlBQVksZUFBZSxzQ0FBc0Msa0JBQWtCO0FBQzVLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NsaWVudF9idWxrX3dyaXRlL2NvbW1hbmRfYnVpbGRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYnVpbGRSZXBsYWNlT25lT3BlcmF0aW9uID0gZXhwb3J0cy5idWlsZFVwZGF0ZU1hbnlPcGVyYXRpb24gPSBleHBvcnRzLmJ1aWxkVXBkYXRlT25lT3BlcmF0aW9uID0gZXhwb3J0cy5idWlsZERlbGV0ZU1hbnlPcGVyYXRpb24gPSBleHBvcnRzLmJ1aWxkRGVsZXRlT25lT3BlcmF0aW9uID0gZXhwb3J0cy5idWlsZEluc2VydE9uZU9wZXJhdGlvbiA9IGV4cG9ydHMuQ2xpZW50QnVsa1dyaXRlQ29tbWFuZEJ1aWxkZXIgPSB2b2lkIDA7XG5leHBvcnRzLmJ1aWxkT3BlcmF0aW9uID0gYnVpbGRPcGVyYXRpb247XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vLi4vYnNvblwiKTtcbmNvbnN0IGNvbW1hbmRzXzEgPSByZXF1aXJlKFwiLi4vLi4vY21hcC9jb21tYW5kc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzXCIpO1xuLyoqXG4gKiBUaGUgYnl0ZXMgb3ZlcmhlYWQgZm9yIHRoZSBleHRyYSBmaWVsZHMgYWRkZWQgcG9zdCBjb21tYW5kIGdlbmVyYXRpb24uXG4gKi9cbmNvbnN0IE1FU1NBR0VfT1ZFUkhFQURfQllURVMgPSAxMDAwO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ2xpZW50QnVsa1dyaXRlQ29tbWFuZEJ1aWxkZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgY29tbWFuZCBidWlsZGVyLlxuICAgICAqIEBwYXJhbSBtb2RlbHMgLSBUaGUgY2xpZW50IHdyaXRlIG1vZGVscy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihtb2RlbHMsIG9wdGlvbnMsIHBrRmFjdG9yeSkge1xuICAgICAgICB0aGlzLm1vZGVscyA9IG1vZGVscztcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5wa0ZhY3RvcnkgPSBwa0ZhY3RvcnkgPz8gdXRpbHNfMS5ERUZBVUxUX1BLX0ZBQ1RPUlk7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsSW5kZXggPSAwO1xuICAgICAgICB0aGlzLnByZXZpb3VzTW9kZWxJbmRleCA9IDA7XG4gICAgICAgIHRoaXMubGFzdE9wZXJhdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5pc0JhdGNoUmV0cnlhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgZXJyb3JzT25seSB2YWx1ZSBmb3IgdGhlIGNvbW1hbmQsIHdoaWNoIGlzIHRoZSBpbnZlcnNlIG9mIHRoZVxuICAgICAqIHVzZXIgcHJvdmlkZWQgdmVyYm9zZVJlc3VsdHMgb3B0aW9uLiBEZWZhdWx0cyB0byB0cnVlLlxuICAgICAqL1xuICAgIGdldCBlcnJvcnNPbmx5KCkge1xuICAgICAgICBpZiAoJ3ZlcmJvc2VSZXN1bHRzJyBpbiB0aGlzLm9wdGlvbnMpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5vcHRpb25zLnZlcmJvc2VSZXN1bHRzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZXJlIGlzIGFub3RoZXIgYmF0Y2ggdG8gcHJvY2Vzcy5cbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIG5vdCBhbGwgYmF0Y2hlcyBoYXZlIGJlZW4gYnVpbHQuXG4gICAgICovXG4gICAgaGFzTmV4dEJhdGNoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TW9kZWxJbmRleCA8IHRoaXMubW9kZWxzLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV2hlbiB3ZSBuZWVkIHRvIHJldHJ5IGEgY29tbWFuZCB3ZSBuZWVkIHRvIHNldCB0aGUgY3VycmVudFxuICAgICAqIG1vZGVsIGluZGV4IGJhY2sgdG8gaXRzIHByZXZpb3VzIHZhbHVlLlxuICAgICAqL1xuICAgIHJlc2V0QmF0Y2goKSB7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGVsSW5kZXggPSB0aGlzLnByZXZpb3VzTW9kZWxJbmRleDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJ1aWxkIGEgc2luZ2xlIGJhdGNoIG9mIGEgY2xpZW50IGJ1bGsgd3JpdGUgY29tbWFuZC5cbiAgICAgKiBAcGFyYW0gbWF4TWVzc2FnZVNpemVCeXRlcyAtIFRoZSBtYXggbWVzc2FnZSBzaXplIGluIGJ5dGVzLlxuICAgICAqIEBwYXJhbSBtYXhXcml0ZUJhdGNoU2l6ZSAtIFRoZSBtYXggd3JpdGUgYmF0Y2ggc2l6ZS5cbiAgICAgKiBAcmV0dXJucyBUaGUgY2xpZW50IGJ1bGsgd3JpdGUgY29tbWFuZC5cbiAgICAgKi9cbiAgICBidWlsZEJhdGNoKG1heE1lc3NhZ2VTaXplQnl0ZXMsIG1heFdyaXRlQmF0Y2hTaXplLCBtYXhCc29uT2JqZWN0U2l6ZSkge1xuICAgICAgICAvLyBXZSBzdGFydCBieSBhc3N1bWluZyB0aGUgYmF0Y2ggaGFzIG5vIG11bHRpLXVwZGF0ZXMsIHNvIGl0IGlzIHJldHJ5YWJsZVxuICAgICAgICAvLyB1bnRpbCB3ZSBmaW5kIHRoZW0uXG4gICAgICAgIHRoaXMuaXNCYXRjaFJldHJ5YWJsZSA9IHRydWU7XG4gICAgICAgIGxldCBjb21tYW5kTGVuZ3RoID0gMDtcbiAgICAgICAgbGV0IGN1cnJlbnROYW1lc3BhY2VJbmRleCA9IDA7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB0aGlzLmJhc2VDb21tYW5kKCk7XG4gICAgICAgIGNvbnN0IG5hbWVzcGFjZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIC8vIEluIHRoZSBjYXNlIG9mIHJldHJpZXMgd2UgbmVlZCB0byBtYXJrIHdoZXJlIHdlIHN0YXJ0ZWQgdGhpcyBiYXRjaC5cbiAgICAgICAgdGhpcy5wcmV2aW91c01vZGVsSW5kZXggPSB0aGlzLmN1cnJlbnRNb2RlbEluZGV4O1xuICAgICAgICB3aGlsZSAodGhpcy5jdXJyZW50TW9kZWxJbmRleCA8IHRoaXMubW9kZWxzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLm1vZGVsc1t0aGlzLmN1cnJlbnRNb2RlbEluZGV4XTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gbW9kZWwubmFtZXNwYWNlO1xuICAgICAgICAgICAgY29uc3QgbnNJbmRleCA9IG5hbWVzcGFjZXMuZ2V0KG5zKTtcbiAgICAgICAgICAgIC8vIE11bHRpIHVwZGF0ZXMgYXJlIG5vdCByZXRyeWFibGUuXG4gICAgICAgICAgICBpZiAobW9kZWwubmFtZSA9PT0gJ2RlbGV0ZU1hbnknIHx8IG1vZGVsLm5hbWUgPT09ICd1cGRhdGVNYW55Jykge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNCYXRjaFJldHJ5YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5zSW5kZXggIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIC8vIEJ1aWxkIHRoZSBvcGVyYXRpb24gYW5kIHNlcmlhbGl6ZSBpdCB0byBnZXQgdGhlIGJ5dGVzIGJ1ZmZlci5cbiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBidWlsZE9wZXJhdGlvbihtb2RlbCwgbnNJbmRleCwgdGhpcy5wa0ZhY3RvcnkpO1xuICAgICAgICAgICAgICAgIGxldCBvcGVyYXRpb25CdWZmZXI7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uQnVmZmVyID0gYnNvbl8xLkJTT04uc2VyaWFsaXplKG9wZXJhdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBDb3VsZCBub3Qgc2VyaWFsaXplIG9wZXJhdGlvbiB0byBCU09OYCwgeyBjYXVzZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFsaWRhdGVCdWZmZXJTaXplKCdvcHMnLCBvcGVyYXRpb25CdWZmZXIsIG1heEJzb25PYmplY3RTaXplKTtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgb3BlcmF0aW9uIGJ1ZmZlciBjYW4gZml0IGluIHRoZSBjb21tYW5kLiBJZiBpdCBjYW4sXG4gICAgICAgICAgICAgICAgLy8gdGhlbiBhZGQgdGhlIG9wZXJhdGlvbiB0byB0aGUgZG9jdW1lbnQgc2VxdWVuY2UgYW5kIGluY3JlbWVudCB0aGVcbiAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGxlbmd0aCBhcyBsb25nIGFzIHRoZSBvcHMgZG9uJ3QgZXhjZWVkIHRoZSBtYXhXcml0ZUJhdGNoU2l6ZS5cbiAgICAgICAgICAgICAgICBpZiAoY29tbWFuZExlbmd0aCArIG9wZXJhdGlvbkJ1ZmZlci5sZW5ndGggPCBtYXhNZXNzYWdlU2l6ZUJ5dGVzICYmXG4gICAgICAgICAgICAgICAgICAgIGNvbW1hbmQub3BzLmRvY3VtZW50cy5sZW5ndGggPCBtYXhXcml0ZUJhdGNoU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBQdXNoaW5nIHRvIHRoZSBvcHMgZG9jdW1lbnQgc2VxdWVuY2UgcmV0dXJucyB0aGUgdG90YWwgYnl0ZSBsZW5ndGggb2YgdGhlIGRvY3VtZW50IHNlcXVlbmNlLlxuICAgICAgICAgICAgICAgICAgICBjb21tYW5kTGVuZ3RoID0gTUVTU0FHRV9PVkVSSEVBRF9CWVRFUyArIGNvbW1hbmQub3BzLnB1c2gob3BlcmF0aW9uLCBvcGVyYXRpb25CdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGJ1aWxkZXIncyBjdXJyZW50IG1vZGVsIGluZGV4LlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRNb2RlbEluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgb3BlcmF0aW9uIGNhbm5vdCBmaXQgaW4gdGhlIGN1cnJlbnQgY29tbWFuZCBhbmQgd2lsbCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgICAgIC8vIGdvIGluIHRoZSBuZXh0IGJhdGNoLiBFeGl0IHRoZSBsb29wLlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgbmFtZXNwYWNlIGlzIG5vdCBhbHJlYWR5IGluIHRoZSBuc0luZm8gc28gd2Ugd2lsbCBzZXQgaXQgaW4gdGhlIG1hcCwgYW5kXG4gICAgICAgICAgICAgICAgLy8gY29uc3RydWN0IG91ciBuc0luZm8gYW5kIG9wcyBkb2N1bWVudHMgYW5kIGJ1ZmZlcnMuXG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlcy5zZXQobnMsIGN1cnJlbnROYW1lc3BhY2VJbmRleCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbnNJbmZvID0geyBuczogbnMgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBidWlsZE9wZXJhdGlvbihtb2RlbCwgY3VycmVudE5hbWVzcGFjZUluZGV4LCB0aGlzLnBrRmFjdG9yeSk7XG4gICAgICAgICAgICAgICAgbGV0IG5zSW5mb0J1ZmZlcjtcbiAgICAgICAgICAgICAgICBsZXQgb3BlcmF0aW9uQnVmZmVyO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIG5zSW5mb0J1ZmZlciA9IGJzb25fMS5CU09OLnNlcmlhbGl6ZShuc0luZm8pO1xuICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb25CdWZmZXIgPSBic29uXzEuQlNPTi5zZXJpYWxpemUob3BlcmF0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGNhdXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYENvdWxkIG5vdCBzZXJpYWxpemUgbnMgaW5mbyB0byBCU09OYCwgeyBjYXVzZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFsaWRhdGVCdWZmZXJTaXplKCduc0luZm8nLCBuc0luZm9CdWZmZXIsIG1heEJzb25PYmplY3RTaXplKTtcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZUJ1ZmZlclNpemUoJ29wcycsIG9wZXJhdGlvbkJ1ZmZlciwgbWF4QnNvbk9iamVjdFNpemUpO1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBvcGVyYXRpb24gYW5kIG5zSW5mbyBidWZmZXJzIGNhbiBmaXQgaW4gdGhlIGNvbW1hbmQuIElmIHRoZXlcbiAgICAgICAgICAgICAgICAvLyBjYW4sIHRoZW4gYWRkIHRoZSBvcGVyYXRpb24gYW5kIG5zSW5mbyB0byB0aGVpciByZXNwZWN0aXZlIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgLy8gc2VxdWVuY2VzIGFuZCBpbmNyZW1lbnQgdGhlIGN1cnJlbnQgbGVuZ3RoIGFzIGxvbmcgYXMgdGhlIG9wcyBkb24ndCBleGNlZWRcbiAgICAgICAgICAgICAgICAvLyB0aGUgbWF4V3JpdGVCYXRjaFNpemUuXG4gICAgICAgICAgICAgICAgaWYgKGNvbW1hbmRMZW5ndGggKyBuc0luZm9CdWZmZXIubGVuZ3RoICsgb3BlcmF0aW9uQnVmZmVyLmxlbmd0aCA8IG1heE1lc3NhZ2VTaXplQnl0ZXMgJiZcbiAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5vcHMuZG9jdW1lbnRzLmxlbmd0aCA8IG1heFdyaXRlQmF0Y2hTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFB1c2hpbmcgdG8gdGhlIG9wcyBkb2N1bWVudCBzZXF1ZW5jZSByZXR1cm5zIHRoZSB0b3RhbCBieXRlIGxlbmd0aCBvZiB0aGUgZG9jdW1lbnQgc2VxdWVuY2UuXG4gICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMZW5ndGggPVxuICAgICAgICAgICAgICAgICAgICAgICAgTUVTU0FHRV9PVkVSSEVBRF9CWVRFUyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5uc0luZm8ucHVzaChuc0luZm8sIG5zSW5mb0J1ZmZlcikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQub3BzLnB1c2gob3BlcmF0aW9uLCBvcGVyYXRpb25CdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSd2ZSBhZGRlZCBhIG5ldyBuYW1lc3BhY2UsIGluY3JlbWVudCB0aGUgbmFtZXNwYWNlIGluZGV4LlxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TmFtZXNwYWNlSW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBidWlsZGVyJ3MgY3VycmVudCBtb2RlbCBpbmRleC5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50TW9kZWxJbmRleCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG9wZXJhdGlvbiBjYW5ub3QgZml0IGluIHRoZSBjdXJyZW50IGNvbW1hbmQgYW5kIHdpbGwgbmVlZCB0b1xuICAgICAgICAgICAgICAgICAgICAvLyBnbyBpbiB0aGUgbmV4dCBiYXRjaC4gRXhpdCB0aGUgbG9vcC5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFNldCB0aGUgbGFzdCBvcGVyYXRpb25zIGFuZCByZXR1cm4gdGhlIGNvbW1hbmQuXG4gICAgICAgIHRoaXMubGFzdE9wZXJhdGlvbnMgPSBjb21tYW5kLm9wcy5kb2N1bWVudHM7XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cbiAgICBiYXNlQ29tbWFuZCgpIHtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIGJ1bGtXcml0ZTogMSxcbiAgICAgICAgICAgIGVycm9yc09ubHk6IHRoaXMuZXJyb3JzT25seSxcbiAgICAgICAgICAgIG9yZGVyZWQ6IHRoaXMub3B0aW9ucy5vcmRlcmVkID8/IHRydWUsXG4gICAgICAgICAgICBvcHM6IG5ldyBjb21tYW5kc18xLkRvY3VtZW50U2VxdWVuY2UoJ29wcycpLFxuICAgICAgICAgICAgbnNJbmZvOiBuZXcgY29tbWFuZHNfMS5Eb2N1bWVudFNlcXVlbmNlKCduc0luZm8nKVxuICAgICAgICB9O1xuICAgICAgICAvLyBBZGQgYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uIGlmIGl0IHdhcyBwcmVzZW50IGluIHRoZSBvcHRpb25zLlxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb21tYW5kLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9IHRoaXMub3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWRkIGxldCBpZiBpdCB3YXMgcHJlc2VudCBpbiB0aGUgb3B0aW9ucy5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sZXQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQubGV0ID0gdGhpcy5vcHRpb25zLmxldDtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29tbWVudCA9IHRoaXMub3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cbn1cbmV4cG9ydHMuQ2xpZW50QnVsa1dyaXRlQ29tbWFuZEJ1aWxkZXIgPSBDbGllbnRCdWxrV3JpdGVDb21tYW5kQnVpbGRlcjtcbmZ1bmN0aW9uIHZhbGlkYXRlQnVmZmVyU2l6ZShuYW1lLCBidWZmZXIsIG1heEJzb25PYmplY3RTaXplKSB7XG4gICAgaWYgKGJ1ZmZlci5sZW5ndGggPiBtYXhCc29uT2JqZWN0U2l6ZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBDbGllbnQgYnVsayB3cml0ZSBvcGVyYXRpb24gJHtuYW1lfSBvZiBsZW5ndGggJHtidWZmZXIubGVuZ3RofSBleGNlZWRzIHRoZSBtYXggYnNvbiBvYmplY3Qgc2l6ZSBvZiAke21heEJzb25PYmplY3RTaXplfWApO1xuICAgIH1cbn1cbi8qKlxuICogQnVpbGQgdGhlIGluc2VydCBvbmUgb3BlcmF0aW9uLlxuICogQHBhcmFtIG1vZGVsIC0gVGhlIGluc2VydCBvbmUgbW9kZWwuXG4gKiBAcGFyYW0gaW5kZXggLSBUaGUgbmFtZXNwYWNlIGluZGV4LlxuICogQHJldHVybnMgdGhlIG9wZXJhdGlvbi5cbiAqL1xuY29uc3QgYnVpbGRJbnNlcnRPbmVPcGVyYXRpb24gPSAobW9kZWwsIGluZGV4LCBwa0ZhY3RvcnkpID0+IHtcbiAgICBjb25zdCBkb2N1bWVudCA9IHtcbiAgICAgICAgaW5zZXJ0OiBpbmRleCxcbiAgICAgICAgZG9jdW1lbnQ6IG1vZGVsLmRvY3VtZW50XG4gICAgfTtcbiAgICBkb2N1bWVudC5kb2N1bWVudC5faWQgPSBtb2RlbC5kb2N1bWVudC5faWQgPz8gcGtGYWN0b3J5LmNyZWF0ZVBrKCk7XG4gICAgcmV0dXJuIGRvY3VtZW50O1xufTtcbmV4cG9ydHMuYnVpbGRJbnNlcnRPbmVPcGVyYXRpb24gPSBidWlsZEluc2VydE9uZU9wZXJhdGlvbjtcbi8qKlxuICogQnVpbGQgdGhlIGRlbGV0ZSBvbmUgb3BlcmF0aW9uLlxuICogQHBhcmFtIG1vZGVsIC0gVGhlIGluc2VydCBtYW55IG1vZGVsLlxuICogQHBhcmFtIGluZGV4IC0gVGhlIG5hbWVzcGFjZSBpbmRleC5cbiAqIEByZXR1cm5zIHRoZSBvcGVyYXRpb24uXG4gKi9cbmNvbnN0IGJ1aWxkRGVsZXRlT25lT3BlcmF0aW9uID0gKG1vZGVsLCBpbmRleCkgPT4ge1xuICAgIHJldHVybiBjcmVhdGVEZWxldGVPcGVyYXRpb24obW9kZWwsIGluZGV4LCBmYWxzZSk7XG59O1xuZXhwb3J0cy5idWlsZERlbGV0ZU9uZU9wZXJhdGlvbiA9IGJ1aWxkRGVsZXRlT25lT3BlcmF0aW9uO1xuLyoqXG4gKiBCdWlsZCB0aGUgZGVsZXRlIG1hbnkgb3BlcmF0aW9uLlxuICogQHBhcmFtIG1vZGVsIC0gVGhlIGRlbGV0ZSBtYW55IG1vZGVsLlxuICogQHBhcmFtIGluZGV4IC0gVGhlIG5hbWVzcGFjZSBpbmRleC5cbiAqIEByZXR1cm5zIHRoZSBvcGVyYXRpb24uXG4gKi9cbmNvbnN0IGJ1aWxkRGVsZXRlTWFueU9wZXJhdGlvbiA9IChtb2RlbCwgaW5kZXgpID0+IHtcbiAgICByZXR1cm4gY3JlYXRlRGVsZXRlT3BlcmF0aW9uKG1vZGVsLCBpbmRleCwgdHJ1ZSk7XG59O1xuZXhwb3J0cy5idWlsZERlbGV0ZU1hbnlPcGVyYXRpb24gPSBidWlsZERlbGV0ZU1hbnlPcGVyYXRpb247XG4vKipcbiAqIENyZWF0ZXMgYSBkZWxldGUgb3BlcmF0aW9uIGJhc2VkIG9uIHRoZSBwYXJhbWV0ZXJzLlxuICovXG5mdW5jdGlvbiBjcmVhdGVEZWxldGVPcGVyYXRpb24obW9kZWwsIGluZGV4LCBtdWx0aSkge1xuICAgIGNvbnN0IGRvY3VtZW50ID0ge1xuICAgICAgICBkZWxldGU6IGluZGV4LFxuICAgICAgICBtdWx0aTogbXVsdGksXG4gICAgICAgIGZpbHRlcjogbW9kZWwuZmlsdGVyXG4gICAgfTtcbiAgICBpZiAobW9kZWwuaGludCkge1xuICAgICAgICBkb2N1bWVudC5oaW50ID0gbW9kZWwuaGludDtcbiAgICB9XG4gICAgaWYgKG1vZGVsLmNvbGxhdGlvbikge1xuICAgICAgICBkb2N1bWVudC5jb2xsYXRpb24gPSBtb2RlbC5jb2xsYXRpb247XG4gICAgfVxuICAgIHJldHVybiBkb2N1bWVudDtcbn1cbi8qKlxuICogQnVpbGQgdGhlIHVwZGF0ZSBvbmUgb3BlcmF0aW9uLlxuICogQHBhcmFtIG1vZGVsIC0gVGhlIHVwZGF0ZSBvbmUgbW9kZWwuXG4gKiBAcGFyYW0gaW5kZXggLSBUaGUgbmFtZXNwYWNlIGluZGV4LlxuICogQHJldHVybnMgdGhlIG9wZXJhdGlvbi5cbiAqL1xuY29uc3QgYnVpbGRVcGRhdGVPbmVPcGVyYXRpb24gPSAobW9kZWwsIGluZGV4KSA9PiB7XG4gICAgcmV0dXJuIGNyZWF0ZVVwZGF0ZU9wZXJhdGlvbihtb2RlbCwgaW5kZXgsIGZhbHNlKTtcbn07XG5leHBvcnRzLmJ1aWxkVXBkYXRlT25lT3BlcmF0aW9uID0gYnVpbGRVcGRhdGVPbmVPcGVyYXRpb247XG4vKipcbiAqIEJ1aWxkIHRoZSB1cGRhdGUgbWFueSBvcGVyYXRpb24uXG4gKiBAcGFyYW0gbW9kZWwgLSBUaGUgdXBkYXRlIG1hbnkgbW9kZWwuXG4gKiBAcGFyYW0gaW5kZXggLSBUaGUgbmFtZXNwYWNlIGluZGV4LlxuICogQHJldHVybnMgdGhlIG9wZXJhdGlvbi5cbiAqL1xuY29uc3QgYnVpbGRVcGRhdGVNYW55T3BlcmF0aW9uID0gKG1vZGVsLCBpbmRleCkgPT4ge1xuICAgIHJldHVybiBjcmVhdGVVcGRhdGVPcGVyYXRpb24obW9kZWwsIGluZGV4LCB0cnVlKTtcbn07XG5leHBvcnRzLmJ1aWxkVXBkYXRlTWFueU9wZXJhdGlvbiA9IGJ1aWxkVXBkYXRlTWFueU9wZXJhdGlvbjtcbi8qKlxuICogVmFsaWRhdGUgdGhlIHVwZGF0ZSBkb2N1bWVudC5cbiAqIEBwYXJhbSB1cGRhdGUgLSBUaGUgdXBkYXRlIGRvY3VtZW50LlxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZVVwZGF0ZSh1cGRhdGUpIHtcbiAgICBpZiAoISgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykodXBkYXRlKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdDbGllbnQgYnVsayB3cml0ZSB1cGRhdGUgbW9kZWxzIG11c3Qgb25seSBjb250YWluIGF0b21pYyBtb2RpZmllcnMgKHN0YXJ0IHdpdGggJCkgYW5kIG11c3Qgbm90IGJlIGVtcHR5LicpO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhIGRlbGV0ZSBvcGVyYXRpb24gYmFzZWQgb24gdGhlIHBhcmFtZXRlcnMuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVVwZGF0ZU9wZXJhdGlvbihtb2RlbCwgaW5kZXgsIG11bHRpKSB7XG4gICAgLy8gVXBkYXRlIGRvY3VtZW50cyBwcm92aWRlZCBpbiBVcGRhdGVPbmUgYW5kIFVwZGF0ZU1hbnkgd3JpdGUgbW9kZWxzIGFyZVxuICAgIC8vIHJlcXVpcmVkIG9ubHkgdG8gY29udGFpbiBhdG9taWMgbW9kaWZpZXJzIChpLmUuIGtleXMgdGhhdCBzdGFydCB3aXRoIFwiJFwiKS5cbiAgICAvLyBEcml2ZXJzIE1VU1QgdGhyb3cgYW4gZXJyb3IgaWYgYW4gdXBkYXRlIGRvY3VtZW50IGlzIGVtcHR5IG9yIGlmIHRoZVxuICAgIC8vIGRvY3VtZW50J3MgZmlyc3Qga2V5IGRvZXMgbm90IHN0YXJ0IHdpdGggXCIkXCIuXG4gICAgdmFsaWRhdGVVcGRhdGUobW9kZWwudXBkYXRlKTtcbiAgICBjb25zdCBkb2N1bWVudCA9IHtcbiAgICAgICAgdXBkYXRlOiBpbmRleCxcbiAgICAgICAgbXVsdGk6IG11bHRpLFxuICAgICAgICBmaWx0ZXI6IG1vZGVsLmZpbHRlcixcbiAgICAgICAgdXBkYXRlTW9kczogbW9kZWwudXBkYXRlXG4gICAgfTtcbiAgICBpZiAobW9kZWwuaGludCkge1xuICAgICAgICBkb2N1bWVudC5oaW50ID0gbW9kZWwuaGludDtcbiAgICB9XG4gICAgaWYgKG1vZGVsLnVwc2VydCkge1xuICAgICAgICBkb2N1bWVudC51cHNlcnQgPSBtb2RlbC51cHNlcnQ7XG4gICAgfVxuICAgIGlmIChtb2RlbC5hcnJheUZpbHRlcnMpIHtcbiAgICAgICAgZG9jdW1lbnQuYXJyYXlGaWx0ZXJzID0gbW9kZWwuYXJyYXlGaWx0ZXJzO1xuICAgIH1cbiAgICBpZiAobW9kZWwuY29sbGF0aW9uKSB7XG4gICAgICAgIGRvY3VtZW50LmNvbGxhdGlvbiA9IG1vZGVsLmNvbGxhdGlvbjtcbiAgICB9XG4gICAgcmV0dXJuIGRvY3VtZW50O1xufVxuLyoqXG4gKiBCdWlsZCB0aGUgcmVwbGFjZSBvbmUgb3BlcmF0aW9uLlxuICogQHBhcmFtIG1vZGVsIC0gVGhlIHJlcGxhY2Ugb25lIG1vZGVsLlxuICogQHBhcmFtIGluZGV4IC0gVGhlIG5hbWVzcGFjZSBpbmRleC5cbiAqIEByZXR1cm5zIHRoZSBvcGVyYXRpb24uXG4gKi9cbmNvbnN0IGJ1aWxkUmVwbGFjZU9uZU9wZXJhdGlvbiA9IChtb2RlbCwgaW5kZXgpID0+IHtcbiAgICBpZiAoKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKShtb2RlbC5yZXBsYWNlbWVudCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcignQ2xpZW50IGJ1bGsgd3JpdGUgcmVwbGFjZSBtb2RlbHMgbXVzdCBub3QgY29udGFpbiBhdG9taWMgbW9kaWZpZXJzIChzdGFydCB3aXRoICQpIGFuZCBtdXN0IG5vdCBiZSBlbXB0eS4nKTtcbiAgICB9XG4gICAgY29uc3QgZG9jdW1lbnQgPSB7XG4gICAgICAgIHVwZGF0ZTogaW5kZXgsXG4gICAgICAgIG11bHRpOiBmYWxzZSxcbiAgICAgICAgZmlsdGVyOiBtb2RlbC5maWx0ZXIsXG4gICAgICAgIHVwZGF0ZU1vZHM6IG1vZGVsLnJlcGxhY2VtZW50XG4gICAgfTtcbiAgICBpZiAobW9kZWwuaGludCkge1xuICAgICAgICBkb2N1bWVudC5oaW50ID0gbW9kZWwuaGludDtcbiAgICB9XG4gICAgaWYgKG1vZGVsLnVwc2VydCkge1xuICAgICAgICBkb2N1bWVudC51cHNlcnQgPSBtb2RlbC51cHNlcnQ7XG4gICAgfVxuICAgIGlmIChtb2RlbC5jb2xsYXRpb24pIHtcbiAgICAgICAgZG9jdW1lbnQuY29sbGF0aW9uID0gbW9kZWwuY29sbGF0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gZG9jdW1lbnQ7XG59O1xuZXhwb3J0cy5idWlsZFJlcGxhY2VPbmVPcGVyYXRpb24gPSBidWlsZFJlcGxhY2VPbmVPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBidWlsZE9wZXJhdGlvbihtb2RlbCwgaW5kZXgsIHBrRmFjdG9yeSkge1xuICAgIHN3aXRjaCAobW9kZWwubmFtZSkge1xuICAgICAgICBjYXNlICdpbnNlcnRPbmUnOlxuICAgICAgICAgICAgcmV0dXJuICgwLCBleHBvcnRzLmJ1aWxkSW5zZXJ0T25lT3BlcmF0aW9uKShtb2RlbCwgaW5kZXgsIHBrRmFjdG9yeSk7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZU9uZSc6XG4gICAgICAgICAgICByZXR1cm4gKDAsIGV4cG9ydHMuYnVpbGREZWxldGVPbmVPcGVyYXRpb24pKG1vZGVsLCBpbmRleCk7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZU1hbnknOlxuICAgICAgICAgICAgcmV0dXJuICgwLCBleHBvcnRzLmJ1aWxkRGVsZXRlTWFueU9wZXJhdGlvbikobW9kZWwsIGluZGV4KTtcbiAgICAgICAgY2FzZSAndXBkYXRlT25lJzpcbiAgICAgICAgICAgIHJldHVybiAoMCwgZXhwb3J0cy5idWlsZFVwZGF0ZU9uZU9wZXJhdGlvbikobW9kZWwsIGluZGV4KTtcbiAgICAgICAgY2FzZSAndXBkYXRlTWFueSc6XG4gICAgICAgICAgICByZXR1cm4gKDAsIGV4cG9ydHMuYnVpbGRVcGRhdGVNYW55T3BlcmF0aW9uKShtb2RlbCwgaW5kZXgpO1xuICAgICAgICBjYXNlICdyZXBsYWNlT25lJzpcbiAgICAgICAgICAgIHJldHVybiAoMCwgZXhwb3J0cy5idWlsZFJlcGxhY2VPbmVPcGVyYXRpb24pKG1vZGVsLCBpbmRleCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbWFuZF9idWlsZGVyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/command_builder.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/executor.js":
/*!*************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/executor.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ClientBulkWriteExecutor = void 0;\nconst abstract_cursor_1 = __webpack_require__(/*! ../../cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\nconst client_bulk_write_cursor_1 = __webpack_require__(/*! ../../cursor/client_bulk_write_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/client_bulk_write_cursor.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst timeout_1 = __webpack_require__(/*! ../../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst execute_operation_1 = __webpack_require__(/*! ../execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst client_bulk_write_1 = __webpack_require__(/*! ./client_bulk_write */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/client_bulk_write.js\");\nconst command_builder_1 = __webpack_require__(/*! ./command_builder */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/command_builder.js\");\nconst results_merger_1 = __webpack_require__(/*! ./results_merger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/results_merger.js\");\n/**\n * Responsible for executing a client bulk write.\n * @internal\n */\nclass ClientBulkWriteExecutor {\n    /**\n     * Instantiate the executor.\n     * @param client - The mongo client.\n     * @param operations - The user supplied bulk write models.\n     * @param options - The bulk write options.\n     */\n    constructor(client, operations, options) {\n        if (operations.length === 0) {\n            throw new error_1.MongoClientBulkWriteExecutionError('No client bulk write models were provided.');\n        }\n        this.client = client;\n        this.operations = operations;\n        this.options = {\n            ordered: true,\n            bypassDocumentValidation: false,\n            verboseResults: false,\n            ...options\n        };\n        // If no write concern was provided, we inherit one from the client.\n        if (!this.options.writeConcern) {\n            this.options.writeConcern = write_concern_1.WriteConcern.fromOptions(this.client.s.options);\n        }\n        if (this.options.writeConcern?.w === 0) {\n            if (this.options.verboseResults) {\n                throw new error_1.MongoInvalidArgumentError('Cannot request unacknowledged write concern and verbose results');\n            }\n            if (this.options.ordered) {\n                throw new error_1.MongoInvalidArgumentError('Cannot request unacknowledged write concern and ordered writes');\n            }\n        }\n    }\n    /**\n     * Execute the client bulk write. Will split commands into batches and exhaust the cursors\n     * for each, then merge the results into one.\n     * @returns The result.\n     */\n    async execute() {\n        // The command builder will take the user provided models and potential split the batch\n        // into multiple commands due to size.\n        const pkFactory = this.client.s.options.pkFactory;\n        const commandBuilder = new command_builder_1.ClientBulkWriteCommandBuilder(this.operations, this.options, pkFactory);\n        // Unacknowledged writes need to execute all batches and return { ok: 1}\n        const resolvedOptions = (0, utils_1.resolveTimeoutOptions)(this.client, this.options);\n        const context = timeout_1.TimeoutContext.create(resolvedOptions);\n        if (this.options.writeConcern?.w === 0) {\n            while (commandBuilder.hasNextBatch()) {\n                const operation = new client_bulk_write_1.ClientBulkWriteOperation(commandBuilder, this.options);\n                await (0, execute_operation_1.executeOperation)(this.client, operation, context);\n            }\n            return results_merger_1.ClientBulkWriteResultsMerger.unacknowledged();\n        }\n        else {\n            const resultsMerger = new results_merger_1.ClientBulkWriteResultsMerger(this.options);\n            // For each command will will create and exhaust a cursor for the results.\n            while (commandBuilder.hasNextBatch()) {\n                const cursorContext = new abstract_cursor_1.CursorTimeoutContext(context, Symbol());\n                const options = {\n                    ...this.options,\n                    timeoutContext: cursorContext,\n                    ...(resolvedOptions.timeoutMS != null && { timeoutMode: abstract_cursor_1.CursorTimeoutMode.LIFETIME })\n                };\n                const cursor = new client_bulk_write_cursor_1.ClientBulkWriteCursor(this.client, commandBuilder, options);\n                try {\n                    await resultsMerger.merge(cursor);\n                }\n                catch (error) {\n                    // Write concern errors are recorded in the writeConcernErrors field on MongoClientBulkWriteError.\n                    // When a write concern error is encountered, it should not terminate execution of the bulk write\n                    // for either ordered or unordered bulk writes. However, drivers MUST throw an exception at the end\n                    // of execution if any write concern errors were observed.\n                    if (error instanceof error_1.MongoServerError && !(error instanceof error_1.MongoClientBulkWriteError)) {\n                        // Server side errors need to be wrapped inside a MongoClientBulkWriteError, where the root\n                        // cause is the error property and a partial result is to be included.\n                        const bulkWriteError = new error_1.MongoClientBulkWriteError({\n                            message: 'Mongo client bulk write encountered an error during execution'\n                        });\n                        bulkWriteError.cause = error;\n                        bulkWriteError.partialResult = resultsMerger.bulkWriteResult;\n                        throw bulkWriteError;\n                    }\n                    else {\n                        // Client side errors are just thrown.\n                        throw error;\n                    }\n                }\n            }\n            // If we have write concern errors or unordered write errors at the end we throw.\n            if (resultsMerger.writeConcernErrors.length > 0 || resultsMerger.writeErrors.size > 0) {\n                const error = new error_1.MongoClientBulkWriteError({\n                    message: 'Mongo client bulk write encountered errors during execution.'\n                });\n                error.writeConcernErrors = resultsMerger.writeConcernErrors;\n                error.writeErrors = resultsMerger.writeErrors;\n                error.partialResult = resultsMerger.bulkWriteResult;\n                throw error;\n            }\n            return resultsMerger.bulkWriteResult;\n        }\n    }\n}\nexports.ClientBulkWriteExecutor = ClientBulkWriteExecutor;\n//# sourceMappingURL=executor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY2xpZW50X2J1bGtfd3JpdGUvZXhlY3V0b3IuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsK0JBQStCO0FBQy9CLDBCQUEwQixtQkFBTyxDQUFDLGtJQUE4QjtBQUNoRSxtQ0FBbUMsbUJBQU8sQ0FBQyxvSkFBdUM7QUFDbEYsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsa0JBQWtCLG1CQUFPLENBQUMsb0dBQWU7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsd0JBQXdCLG1CQUFPLENBQUMsZ0hBQXFCO0FBQ3JELDRCQUE0QixtQkFBTyxDQUFDLGdJQUFzQjtBQUMxRCw0QkFBNEIsbUJBQU8sQ0FBQyxpSkFBcUI7QUFDekQsMEJBQTBCLG1CQUFPLENBQUMsNklBQW1CO0FBQ3JELHlCQUF5QixtQkFBTyxDQUFDLDJJQUFrQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBFQUEwRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStELDJEQUEyRDtBQUMxSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NsaWVudF9idWxrX3dyaXRlL2V4ZWN1dG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DbGllbnRCdWxrV3JpdGVFeGVjdXRvciA9IHZvaWQgMDtcbmNvbnN0IGFic3RyYWN0X2N1cnNvcl8xID0gcmVxdWlyZShcIi4uLy4uL2N1cnNvci9hYnN0cmFjdF9jdXJzb3JcIik7XG5jb25zdCBjbGllbnRfYnVsa193cml0ZV9jdXJzb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9jdXJzb3IvY2xpZW50X2J1bGtfd3JpdGVfY3Vyc29yXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IHRpbWVvdXRfMSA9IHJlcXVpcmUoXCIuLi8uLi90aW1lb3V0XCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi8uLi93cml0ZV9jb25jZXJuXCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuLi9leGVjdXRlX29wZXJhdGlvblwiKTtcbmNvbnN0IGNsaWVudF9idWxrX3dyaXRlXzEgPSByZXF1aXJlKFwiLi9jbGllbnRfYnVsa193cml0ZVwiKTtcbmNvbnN0IGNvbW1hbmRfYnVpbGRlcl8xID0gcmVxdWlyZShcIi4vY29tbWFuZF9idWlsZGVyXCIpO1xuY29uc3QgcmVzdWx0c19tZXJnZXJfMSA9IHJlcXVpcmUoXCIuL3Jlc3VsdHNfbWVyZ2VyXCIpO1xuLyoqXG4gKiBSZXNwb25zaWJsZSBmb3IgZXhlY3V0aW5nIGEgY2xpZW50IGJ1bGsgd3JpdGUuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ2xpZW50QnVsa1dyaXRlRXhlY3V0b3Ige1xuICAgIC8qKlxuICAgICAqIEluc3RhbnRpYXRlIHRoZSBleGVjdXRvci5cbiAgICAgKiBAcGFyYW0gY2xpZW50IC0gVGhlIG1vbmdvIGNsaWVudC5cbiAgICAgKiBAcGFyYW0gb3BlcmF0aW9ucyAtIFRoZSB1c2VyIHN1cHBsaWVkIGJ1bGsgd3JpdGUgbW9kZWxzLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gVGhlIGJ1bGsgd3JpdGUgb3B0aW9ucy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIG9wZXJhdGlvbnMsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wZXJhdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NsaWVudEJ1bGtXcml0ZUV4ZWN1dGlvbkVycm9yKCdObyBjbGllbnQgYnVsayB3cml0ZSBtb2RlbHMgd2VyZSBwcm92aWRlZC4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcbiAgICAgICAgdGhpcy5vcGVyYXRpb25zID0gb3BlcmF0aW9ucztcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgICAgICAgb3JkZXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICB2ZXJib3NlUmVzdWx0czogZmFsc2UsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH07XG4gICAgICAgIC8vIElmIG5vIHdyaXRlIGNvbmNlcm4gd2FzIHByb3ZpZGVkLCB3ZSBpbmhlcml0IG9uZSBmcm9tIHRoZSBjbGllbnQuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLndyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLndyaXRlQ29uY2VybiA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnModGhpcy5jbGllbnQucy5vcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLndyaXRlQ29uY2Vybj8udyA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52ZXJib3NlUmVzdWx0cykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0Nhbm5vdCByZXF1ZXN0IHVuYWNrbm93bGVkZ2VkIHdyaXRlIGNvbmNlcm4gYW5kIHZlcmJvc2UgcmVzdWx0cycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5vcmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ2Fubm90IHJlcXVlc3QgdW5hY2tub3dsZWRnZWQgd3JpdGUgY29uY2VybiBhbmQgb3JkZXJlZCB3cml0ZXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIHRoZSBjbGllbnQgYnVsayB3cml0ZS4gV2lsbCBzcGxpdCBjb21tYW5kcyBpbnRvIGJhdGNoZXMgYW5kIGV4aGF1c3QgdGhlIGN1cnNvcnNcbiAgICAgKiBmb3IgZWFjaCwgdGhlbiBtZXJnZSB0aGUgcmVzdWx0cyBpbnRvIG9uZS5cbiAgICAgKiBAcmV0dXJucyBUaGUgcmVzdWx0LlxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGUoKSB7XG4gICAgICAgIC8vIFRoZSBjb21tYW5kIGJ1aWxkZXIgd2lsbCB0YWtlIHRoZSB1c2VyIHByb3ZpZGVkIG1vZGVscyBhbmQgcG90ZW50aWFsIHNwbGl0IHRoZSBiYXRjaFxuICAgICAgICAvLyBpbnRvIG11bHRpcGxlIGNvbW1hbmRzIGR1ZSB0byBzaXplLlxuICAgICAgICBjb25zdCBwa0ZhY3RvcnkgPSB0aGlzLmNsaWVudC5zLm9wdGlvbnMucGtGYWN0b3J5O1xuICAgICAgICBjb25zdCBjb21tYW5kQnVpbGRlciA9IG5ldyBjb21tYW5kX2J1aWxkZXJfMS5DbGllbnRCdWxrV3JpdGVDb21tYW5kQnVpbGRlcih0aGlzLm9wZXJhdGlvbnMsIHRoaXMub3B0aW9ucywgcGtGYWN0b3J5KTtcbiAgICAgICAgLy8gVW5hY2tub3dsZWRnZWQgd3JpdGVzIG5lZWQgdG8gZXhlY3V0ZSBhbGwgYmF0Y2hlcyBhbmQgcmV0dXJuIHsgb2s6IDF9XG4gICAgICAgIGNvbnN0IHJlc29sdmVkT3B0aW9ucyA9ICgwLCB1dGlsc18xLnJlc29sdmVUaW1lb3V0T3B0aW9ucykodGhpcy5jbGllbnQsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aW1lb3V0XzEuVGltZW91dENvbnRleHQuY3JlYXRlKHJlc29sdmVkT3B0aW9ucyk7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMud3JpdGVDb25jZXJuPy53ID09PSAwKSB7XG4gICAgICAgICAgICB3aGlsZSAoY29tbWFuZEJ1aWxkZXIuaGFzTmV4dEJhdGNoKCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgY2xpZW50X2J1bGtfd3JpdGVfMS5DbGllbnRCdWxrV3JpdGVPcGVyYXRpb24oY29tbWFuZEJ1aWxkZXIsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG9wZXJhdGlvbiwgY29udGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0c19tZXJnZXJfMS5DbGllbnRCdWxrV3JpdGVSZXN1bHRzTWVyZ2VyLnVuYWNrbm93bGVkZ2VkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzTWVyZ2VyID0gbmV3IHJlc3VsdHNfbWVyZ2VyXzEuQ2xpZW50QnVsa1dyaXRlUmVzdWx0c01lcmdlcih0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgLy8gRm9yIGVhY2ggY29tbWFuZCB3aWxsIHdpbGwgY3JlYXRlIGFuZCBleGhhdXN0IGEgY3Vyc29yIGZvciB0aGUgcmVzdWx0cy5cbiAgICAgICAgICAgIHdoaWxlIChjb21tYW5kQnVpbGRlci5oYXNOZXh0QmF0Y2goKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvckNvbnRleHQgPSBuZXcgYWJzdHJhY3RfY3Vyc29yXzEuQ3Vyc29yVGltZW91dENvbnRleHQoY29udGV4dCwgU3ltYm9sKCkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dENvbnRleHQ6IGN1cnNvckNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgIC4uLihyZXNvbHZlZE9wdGlvbnMudGltZW91dE1TICE9IG51bGwgJiYgeyB0aW1lb3V0TW9kZTogYWJzdHJhY3RfY3Vyc29yXzEuQ3Vyc29yVGltZW91dE1vZGUuTElGRVRJTUUgfSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvciA9IG5ldyBjbGllbnRfYnVsa193cml0ZV9jdXJzb3JfMS5DbGllbnRCdWxrV3JpdGVDdXJzb3IodGhpcy5jbGllbnQsIGNvbW1hbmRCdWlsZGVyLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXN1bHRzTWVyZ2VyLm1lcmdlKGN1cnNvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSBjb25jZXJuIGVycm9ycyBhcmUgcmVjb3JkZWQgaW4gdGhlIHdyaXRlQ29uY2VybkVycm9ycyBmaWVsZCBvbiBNb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yLlxuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIGEgd3JpdGUgY29uY2VybiBlcnJvciBpcyBlbmNvdW50ZXJlZCwgaXQgc2hvdWxkIG5vdCB0ZXJtaW5hdGUgZXhlY3V0aW9uIG9mIHRoZSBidWxrIHdyaXRlXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciBlaXRoZXIgb3JkZXJlZCBvciB1bm9yZGVyZWQgYnVsayB3cml0ZXMuIEhvd2V2ZXIsIGRyaXZlcnMgTVVTVCB0aHJvdyBhbiBleGNlcHRpb24gYXQgdGhlIGVuZFxuICAgICAgICAgICAgICAgICAgICAvLyBvZiBleGVjdXRpb24gaWYgYW55IHdyaXRlIGNvbmNlcm4gZXJyb3JzIHdlcmUgb2JzZXJ2ZWQuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvciAmJiAhKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2VydmVyIHNpZGUgZXJyb3JzIG5lZWQgdG8gYmUgd3JhcHBlZCBpbnNpZGUgYSBNb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yLCB3aGVyZSB0aGUgcm9vdFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2F1c2UgaXMgdGhlIGVycm9yIHByb3BlcnR5IGFuZCBhIHBhcnRpYWwgcmVzdWx0IGlzIHRvIGJlIGluY2x1ZGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVsa1dyaXRlRXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTW9uZ28gY2xpZW50IGJ1bGsgd3JpdGUgZW5jb3VudGVyZWQgYW4gZXJyb3IgZHVyaW5nIGV4ZWN1dGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVsa1dyaXRlRXJyb3IuY2F1c2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1bGtXcml0ZUVycm9yLnBhcnRpYWxSZXN1bHQgPSByZXN1bHRzTWVyZ2VyLmJ1bGtXcml0ZVJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGJ1bGtXcml0ZUVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xpZW50IHNpZGUgZXJyb3JzIGFyZSBqdXN0IHRocm93bi5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSB3cml0ZSBjb25jZXJuIGVycm9ycyBvciB1bm9yZGVyZWQgd3JpdGUgZXJyb3JzIGF0IHRoZSBlbmQgd2UgdGhyb3cuXG4gICAgICAgICAgICBpZiAocmVzdWx0c01lcmdlci53cml0ZUNvbmNlcm5FcnJvcnMubGVuZ3RoID4gMCB8fCByZXN1bHRzTWVyZ2VyLndyaXRlRXJyb3JzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb0NsaWVudEJ1bGtXcml0ZUVycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ01vbmdvIGNsaWVudCBidWxrIHdyaXRlIGVuY291bnRlcmVkIGVycm9ycyBkdXJpbmcgZXhlY3V0aW9uLidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBlcnJvci53cml0ZUNvbmNlcm5FcnJvcnMgPSByZXN1bHRzTWVyZ2VyLndyaXRlQ29uY2VybkVycm9ycztcbiAgICAgICAgICAgICAgICBlcnJvci53cml0ZUVycm9ycyA9IHJlc3VsdHNNZXJnZXIud3JpdGVFcnJvcnM7XG4gICAgICAgICAgICAgICAgZXJyb3IucGFydGlhbFJlc3VsdCA9IHJlc3VsdHNNZXJnZXIuYnVsa1dyaXRlUmVzdWx0O1xuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHNNZXJnZXIuYnVsa1dyaXRlUmVzdWx0O1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5DbGllbnRCdWxrV3JpdGVFeGVjdXRvciA9IENsaWVudEJ1bGtXcml0ZUV4ZWN1dG9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXhlY3V0b3IuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/executor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/results_merger.js":
/*!*******************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/results_merger.js ***!
  \*******************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ClientBulkWriteResultsMerger = void 0;\nconst __1 = __webpack_require__(/*! ../.. */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/index.js\");\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/**\n * Unacknowledged bulk writes are always the same.\n */\nconst UNACKNOWLEDGED = {\n    acknowledged: false,\n    insertedCount: 0,\n    upsertedCount: 0,\n    matchedCount: 0,\n    modifiedCount: 0,\n    deletedCount: 0,\n    insertResults: undefined,\n    updateResults: undefined,\n    deleteResults: undefined\n};\n/**\n * Merges client bulk write cursor responses together into a single result.\n * @internal\n */\nclass ClientBulkWriteResultsMerger {\n    /**\n     * @returns The standard unacknowledged bulk write result.\n     */\n    static unacknowledged() {\n        return UNACKNOWLEDGED;\n    }\n    /**\n     * Instantiate the merger.\n     * @param options - The options.\n     */\n    constructor(options) {\n        this.options = options;\n        this.currentBatchOffset = 0;\n        this.writeConcernErrors = [];\n        this.writeErrors = new Map();\n        this.result = {\n            acknowledged: true,\n            insertedCount: 0,\n            upsertedCount: 0,\n            matchedCount: 0,\n            modifiedCount: 0,\n            deletedCount: 0,\n            insertResults: undefined,\n            updateResults: undefined,\n            deleteResults: undefined\n        };\n        if (options.verboseResults) {\n            this.result.insertResults = new Map();\n            this.result.updateResults = new Map();\n            this.result.deleteResults = new Map();\n        }\n    }\n    /**\n     * Get the bulk write result object.\n     */\n    get bulkWriteResult() {\n        return {\n            acknowledged: this.result.acknowledged,\n            insertedCount: this.result.insertedCount,\n            upsertedCount: this.result.upsertedCount,\n            matchedCount: this.result.matchedCount,\n            modifiedCount: this.result.modifiedCount,\n            deletedCount: this.result.deletedCount,\n            insertResults: this.result.insertResults,\n            updateResults: this.result.updateResults,\n            deleteResults: this.result.deleteResults\n        };\n    }\n    /**\n     * Merge the results in the cursor to the existing result.\n     * @param currentBatchOffset - The offset index to the original models.\n     * @param response - The cursor response.\n     * @param documents - The documents in the cursor.\n     * @returns The current result.\n     */\n    async merge(cursor) {\n        let writeConcernErrorResult;\n        try {\n            for await (const document of cursor) {\n                // Only add to maps if ok: 1\n                if (document.ok === 1) {\n                    if (this.options.verboseResults) {\n                        this.processDocument(cursor, document);\n                    }\n                }\n                else {\n                    // If an individual write error is encountered during an ordered bulk write, drivers MUST\n                    // record the error in writeErrors and immediately throw the exception. Otherwise, drivers\n                    // MUST continue to iterate the results cursor and execute any further bulkWrite batches.\n                    if (this.options.ordered) {\n                        const error = new error_1.MongoClientBulkWriteError({\n                            message: 'Mongo client ordered bulk write encountered a write error.'\n                        });\n                        error.writeErrors.set(document.idx + this.currentBatchOffset, {\n                            code: document.code,\n                            message: document.errmsg\n                        });\n                        error.partialResult = this.result;\n                        throw error;\n                    }\n                    else {\n                        this.writeErrors.set(document.idx + this.currentBatchOffset, {\n                            code: document.code,\n                            message: document.errmsg\n                        });\n                    }\n                }\n            }\n        }\n        catch (error) {\n            if (error instanceof __1.MongoWriteConcernError) {\n                const result = error.result;\n                writeConcernErrorResult = {\n                    insertedCount: result.nInserted,\n                    upsertedCount: result.nUpserted,\n                    matchedCount: result.nMatched,\n                    modifiedCount: result.nModified,\n                    deletedCount: result.nDeleted,\n                    writeConcernError: result.writeConcernError\n                };\n                if (this.options.verboseResults && result.cursor.firstBatch) {\n                    for (const document of result.cursor.firstBatch) {\n                        if (document.ok === 1) {\n                            this.processDocument(cursor, document);\n                        }\n                    }\n                }\n            }\n            else {\n                throw error;\n            }\n        }\n        finally {\n            // Update the counts from the cursor response.\n            if (cursor.response) {\n                const response = cursor.response;\n                this.incrementCounts(response);\n            }\n            // Increment the batch offset.\n            this.currentBatchOffset += cursor.operations.length;\n        }\n        // If we have write concern errors ensure they are added.\n        if (writeConcernErrorResult) {\n            const writeConcernError = writeConcernErrorResult.writeConcernError;\n            this.incrementCounts(writeConcernErrorResult);\n            this.writeConcernErrors.push({\n                code: writeConcernError.code,\n                message: writeConcernError.errmsg\n            });\n        }\n        return this.result;\n    }\n    /**\n     * Process an individual document in the results.\n     * @param cursor - The cursor.\n     * @param document - The document to process.\n     */\n    processDocument(cursor, document) {\n        // Get the corresponding operation from the command.\n        const operation = cursor.operations[document.idx];\n        // Handle insert results.\n        if ('insert' in operation) {\n            this.result.insertResults?.set(document.idx + this.currentBatchOffset, {\n                insertedId: operation.document._id\n            });\n        }\n        // Handle update results.\n        if ('update' in operation) {\n            const result = {\n                matchedCount: document.n,\n                modifiedCount: document.nModified ?? 0,\n                // Check if the bulk did actually upsert.\n                didUpsert: document.upserted != null\n            };\n            if (document.upserted) {\n                result.upsertedId = document.upserted._id;\n            }\n            this.result.updateResults?.set(document.idx + this.currentBatchOffset, result);\n        }\n        // Handle delete results.\n        if ('delete' in operation) {\n            this.result.deleteResults?.set(document.idx + this.currentBatchOffset, {\n                deletedCount: document.n\n            });\n        }\n    }\n    /**\n     * Increment the result counts.\n     * @param document - The document with the results.\n     */\n    incrementCounts(document) {\n        this.result.insertedCount += document.insertedCount;\n        this.result.upsertedCount += document.upsertedCount;\n        this.result.matchedCount += document.matchedCount;\n        this.result.modifiedCount += document.modifiedCount;\n        this.result.deletedCount += document.deletedCount;\n    }\n}\nexports.ClientBulkWriteResultsMerger = ClientBulkWriteResultsMerger;\n//# sourceMappingURL=results_merger.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY2xpZW50X2J1bGtfd3JpdGUvcmVzdWx0c19tZXJnZXIuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsb0NBQW9DO0FBQ3BDLFlBQVksbUJBQU8sQ0FBQywwRkFBTztBQUMzQixnQkFBZ0IsbUJBQU8sQ0FBQyxnR0FBYTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9jbGllbnRfYnVsa193cml0ZS9yZXN1bHRzX21lcmdlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ2xpZW50QnVsa1dyaXRlUmVzdWx0c01lcmdlciA9IHZvaWQgMDtcbmNvbnN0IF9fMSA9IHJlcXVpcmUoXCIuLi8uLlwiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vLi4vZXJyb3JcIik7XG4vKipcbiAqIFVuYWNrbm93bGVkZ2VkIGJ1bGsgd3JpdGVzIGFyZSBhbHdheXMgdGhlIHNhbWUuXG4gKi9cbmNvbnN0IFVOQUNLTk9XTEVER0VEID0ge1xuICAgIGFja25vd2xlZGdlZDogZmFsc2UsXG4gICAgaW5zZXJ0ZWRDb3VudDogMCxcbiAgICB1cHNlcnRlZENvdW50OiAwLFxuICAgIG1hdGNoZWRDb3VudDogMCxcbiAgICBtb2RpZmllZENvdW50OiAwLFxuICAgIGRlbGV0ZWRDb3VudDogMCxcbiAgICBpbnNlcnRSZXN1bHRzOiB1bmRlZmluZWQsXG4gICAgdXBkYXRlUmVzdWx0czogdW5kZWZpbmVkLFxuICAgIGRlbGV0ZVJlc3VsdHM6IHVuZGVmaW5lZFxufTtcbi8qKlxuICogTWVyZ2VzIGNsaWVudCBidWxrIHdyaXRlIGN1cnNvciByZXNwb25zZXMgdG9nZXRoZXIgaW50byBhIHNpbmdsZSByZXN1bHQuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQ2xpZW50QnVsa1dyaXRlUmVzdWx0c01lcmdlciB7XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVGhlIHN0YW5kYXJkIHVuYWNrbm93bGVkZ2VkIGJ1bGsgd3JpdGUgcmVzdWx0LlxuICAgICAqL1xuICAgIHN0YXRpYyB1bmFja25vd2xlZGdlZCgpIHtcbiAgICAgICAgcmV0dXJuIFVOQUNLTk9XTEVER0VEO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgbWVyZ2VyLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gVGhlIG9wdGlvbnMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmN1cnJlbnRCYXRjaE9mZnNldCA9IDA7XG4gICAgICAgIHRoaXMud3JpdGVDb25jZXJuRXJyb3JzID0gW107XG4gICAgICAgIHRoaXMud3JpdGVFcnJvcnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMucmVzdWx0ID0ge1xuICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0cnVlLFxuICAgICAgICAgICAgaW5zZXJ0ZWRDb3VudDogMCxcbiAgICAgICAgICAgIHVwc2VydGVkQ291bnQ6IDAsXG4gICAgICAgICAgICBtYXRjaGVkQ291bnQ6IDAsXG4gICAgICAgICAgICBtb2RpZmllZENvdW50OiAwLFxuICAgICAgICAgICAgZGVsZXRlZENvdW50OiAwLFxuICAgICAgICAgICAgaW5zZXJ0UmVzdWx0czogdW5kZWZpbmVkLFxuICAgICAgICAgICAgdXBkYXRlUmVzdWx0czogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGVsZXRlUmVzdWx0czogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvcHRpb25zLnZlcmJvc2VSZXN1bHRzKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdC5pbnNlcnRSZXN1bHRzID0gbmV3IE1hcCgpO1xuICAgICAgICAgICAgdGhpcy5yZXN1bHQudXBkYXRlUmVzdWx0cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0LmRlbGV0ZVJlc3VsdHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBidWxrIHdyaXRlIHJlc3VsdCBvYmplY3QuXG4gICAgICovXG4gICAgZ2V0IGJ1bGtXcml0ZVJlc3VsdCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFja25vd2xlZGdlZDogdGhpcy5yZXN1bHQuYWNrbm93bGVkZ2VkLFxuICAgICAgICAgICAgaW5zZXJ0ZWRDb3VudDogdGhpcy5yZXN1bHQuaW5zZXJ0ZWRDb3VudCxcbiAgICAgICAgICAgIHVwc2VydGVkQ291bnQ6IHRoaXMucmVzdWx0LnVwc2VydGVkQ291bnQsXG4gICAgICAgICAgICBtYXRjaGVkQ291bnQ6IHRoaXMucmVzdWx0Lm1hdGNoZWRDb3VudCxcbiAgICAgICAgICAgIG1vZGlmaWVkQ291bnQ6IHRoaXMucmVzdWx0Lm1vZGlmaWVkQ291bnQsXG4gICAgICAgICAgICBkZWxldGVkQ291bnQ6IHRoaXMucmVzdWx0LmRlbGV0ZWRDb3VudCxcbiAgICAgICAgICAgIGluc2VydFJlc3VsdHM6IHRoaXMucmVzdWx0Lmluc2VydFJlc3VsdHMsXG4gICAgICAgICAgICB1cGRhdGVSZXN1bHRzOiB0aGlzLnJlc3VsdC51cGRhdGVSZXN1bHRzLFxuICAgICAgICAgICAgZGVsZXRlUmVzdWx0czogdGhpcy5yZXN1bHQuZGVsZXRlUmVzdWx0c1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNZXJnZSB0aGUgcmVzdWx0cyBpbiB0aGUgY3Vyc29yIHRvIHRoZSBleGlzdGluZyByZXN1bHQuXG4gICAgICogQHBhcmFtIGN1cnJlbnRCYXRjaE9mZnNldCAtIFRoZSBvZmZzZXQgaW5kZXggdG8gdGhlIG9yaWdpbmFsIG1vZGVscy5cbiAgICAgKiBAcGFyYW0gcmVzcG9uc2UgLSBUaGUgY3Vyc29yIHJlc3BvbnNlLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudHMgLSBUaGUgZG9jdW1lbnRzIGluIHRoZSBjdXJzb3IuXG4gICAgICogQHJldHVybnMgVGhlIGN1cnJlbnQgcmVzdWx0LlxuICAgICAqL1xuICAgIGFzeW5jIG1lcmdlKGN1cnNvcikge1xuICAgICAgICBsZXQgd3JpdGVDb25jZXJuRXJyb3JSZXN1bHQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGRvY3VtZW50IG9mIGN1cnNvcikge1xuICAgICAgICAgICAgICAgIC8vIE9ubHkgYWRkIHRvIG1hcHMgaWYgb2s6IDFcbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQub2sgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52ZXJib3NlUmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRG9jdW1lbnQoY3Vyc29yLCBkb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGFuIGluZGl2aWR1YWwgd3JpdGUgZXJyb3IgaXMgZW5jb3VudGVyZWQgZHVyaW5nIGFuIG9yZGVyZWQgYnVsayB3cml0ZSwgZHJpdmVycyBNVVNUXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlY29yZCB0aGUgZXJyb3IgaW4gd3JpdGVFcnJvcnMgYW5kIGltbWVkaWF0ZWx5IHRocm93IHRoZSBleGNlcHRpb24uIE90aGVyd2lzZSwgZHJpdmVyc1xuICAgICAgICAgICAgICAgICAgICAvLyBNVVNUIGNvbnRpbnVlIHRvIGl0ZXJhdGUgdGhlIHJlc3VsdHMgY3Vyc29yIGFuZCBleGVjdXRlIGFueSBmdXJ0aGVyIGJ1bGtXcml0ZSBiYXRjaGVzLlxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm9yZGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IGVycm9yXzEuTW9uZ29DbGllbnRCdWxrV3JpdGVFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ01vbmdvIGNsaWVudCBvcmRlcmVkIGJ1bGsgd3JpdGUgZW5jb3VudGVyZWQgYSB3cml0ZSBlcnJvci4nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLndyaXRlRXJyb3JzLnNldChkb2N1bWVudC5pZHggKyB0aGlzLmN1cnJlbnRCYXRjaE9mZnNldCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGRvY3VtZW50LmNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZG9jdW1lbnQuZXJybXNnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLnBhcnRpYWxSZXN1bHQgPSB0aGlzLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZUVycm9ycy5zZXQoZG9jdW1lbnQuaWR4ICsgdGhpcy5jdXJyZW50QmF0Y2hPZmZzZXQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBkb2N1bWVudC5jb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGRvY3VtZW50LmVycm1zZ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBfXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGVycm9yLnJlc3VsdDtcbiAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm5FcnJvclJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ZWRDb3VudDogcmVzdWx0Lm5JbnNlcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgdXBzZXJ0ZWRDb3VudDogcmVzdWx0Lm5VcHNlcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZENvdW50OiByZXN1bHQubk1hdGNoZWQsXG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQ291bnQ6IHJlc3VsdC5uTW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRDb3VudDogcmVzdWx0Lm5EZWxldGVkLFxuICAgICAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm5FcnJvcjogcmVzdWx0LndyaXRlQ29uY2VybkVycm9yXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZlcmJvc2VSZXN1bHRzICYmIHJlc3VsdC5jdXJzb3IuZmlyc3RCYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRvY3VtZW50IG9mIHJlc3VsdC5jdXJzb3IuZmlyc3RCYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50Lm9rID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRG9jdW1lbnQoY3Vyc29yLCBkb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY291bnRzIGZyb20gdGhlIGN1cnNvciByZXNwb25zZS5cbiAgICAgICAgICAgIGlmIChjdXJzb3IucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGN1cnNvci5yZXNwb25zZTtcbiAgICAgICAgICAgICAgICB0aGlzLmluY3JlbWVudENvdW50cyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGJhdGNoIG9mZnNldC5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudEJhdGNoT2Zmc2V0ICs9IGN1cnNvci5vcGVyYXRpb25zLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSBoYXZlIHdyaXRlIGNvbmNlcm4gZXJyb3JzIGVuc3VyZSB0aGV5IGFyZSBhZGRlZC5cbiAgICAgICAgaWYgKHdyaXRlQ29uY2VybkVycm9yUmVzdWx0KSB7XG4gICAgICAgICAgICBjb25zdCB3cml0ZUNvbmNlcm5FcnJvciA9IHdyaXRlQ29uY2VybkVycm9yUmVzdWx0LndyaXRlQ29uY2VybkVycm9yO1xuICAgICAgICAgICAgdGhpcy5pbmNyZW1lbnRDb3VudHMod3JpdGVDb25jZXJuRXJyb3JSZXN1bHQpO1xuICAgICAgICAgICAgdGhpcy53cml0ZUNvbmNlcm5FcnJvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgY29kZTogd3JpdGVDb25jZXJuRXJyb3IuY29kZSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiB3cml0ZUNvbmNlcm5FcnJvci5lcnJtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHJvY2VzcyBhbiBpbmRpdmlkdWFsIGRvY3VtZW50IGluIHRoZSByZXN1bHRzLlxuICAgICAqIEBwYXJhbSBjdXJzb3IgLSBUaGUgY3Vyc29yLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBwcm9jZXNzLlxuICAgICAqL1xuICAgIHByb2Nlc3NEb2N1bWVudChjdXJzb3IsIGRvY3VtZW50KSB7XG4gICAgICAgIC8vIEdldCB0aGUgY29ycmVzcG9uZGluZyBvcGVyYXRpb24gZnJvbSB0aGUgY29tbWFuZC5cbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gY3Vyc29yLm9wZXJhdGlvbnNbZG9jdW1lbnQuaWR4XTtcbiAgICAgICAgLy8gSGFuZGxlIGluc2VydCByZXN1bHRzLlxuICAgICAgICBpZiAoJ2luc2VydCcgaW4gb3BlcmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdC5pbnNlcnRSZXN1bHRzPy5zZXQoZG9jdW1lbnQuaWR4ICsgdGhpcy5jdXJyZW50QmF0Y2hPZmZzZXQsIHtcbiAgICAgICAgICAgICAgICBpbnNlcnRlZElkOiBvcGVyYXRpb24uZG9jdW1lbnQuX2lkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBIYW5kbGUgdXBkYXRlIHJlc3VsdHMuXG4gICAgICAgIGlmICgndXBkYXRlJyBpbiBvcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBtYXRjaGVkQ291bnQ6IGRvY3VtZW50Lm4sXG4gICAgICAgICAgICAgICAgbW9kaWZpZWRDb3VudDogZG9jdW1lbnQubk1vZGlmaWVkID8/IDAsXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGJ1bGsgZGlkIGFjdHVhbGx5IHVwc2VydC5cbiAgICAgICAgICAgICAgICBkaWRVcHNlcnQ6IGRvY3VtZW50LnVwc2VydGVkICE9IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQudXBzZXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQudXBzZXJ0ZWRJZCA9IGRvY3VtZW50LnVwc2VydGVkLl9pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzdWx0LnVwZGF0ZVJlc3VsdHM/LnNldChkb2N1bWVudC5pZHggKyB0aGlzLmN1cnJlbnRCYXRjaE9mZnNldCwgcmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBIYW5kbGUgZGVsZXRlIHJlc3VsdHMuXG4gICAgICAgIGlmICgnZGVsZXRlJyBpbiBvcGVyYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0LmRlbGV0ZVJlc3VsdHM/LnNldChkb2N1bWVudC5pZHggKyB0aGlzLmN1cnJlbnRCYXRjaE9mZnNldCwge1xuICAgICAgICAgICAgICAgIGRlbGV0ZWRDb3VudDogZG9jdW1lbnQublxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5jcmVtZW50IHRoZSByZXN1bHQgY291bnRzLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB3aXRoIHRoZSByZXN1bHRzLlxuICAgICAqL1xuICAgIGluY3JlbWVudENvdW50cyhkb2N1bWVudCkge1xuICAgICAgICB0aGlzLnJlc3VsdC5pbnNlcnRlZENvdW50ICs9IGRvY3VtZW50Lmluc2VydGVkQ291bnQ7XG4gICAgICAgIHRoaXMucmVzdWx0LnVwc2VydGVkQ291bnQgKz0gZG9jdW1lbnQudXBzZXJ0ZWRDb3VudDtcbiAgICAgICAgdGhpcy5yZXN1bHQubWF0Y2hlZENvdW50ICs9IGRvY3VtZW50Lm1hdGNoZWRDb3VudDtcbiAgICAgICAgdGhpcy5yZXN1bHQubW9kaWZpZWRDb3VudCArPSBkb2N1bWVudC5tb2RpZmllZENvdW50O1xuICAgICAgICB0aGlzLnJlc3VsdC5kZWxldGVkQ291bnQgKz0gZG9jdW1lbnQuZGVsZXRlZENvdW50O1xuICAgIH1cbn1cbmV4cG9ydHMuQ2xpZW50QnVsa1dyaXRlUmVzdWx0c01lcmdlciA9IENsaWVudEJ1bGtXcml0ZVJlc3VsdHNNZXJnZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZXN1bHRzX21lcmdlci5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/client_bulk_write/results_merger.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/collections.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/collections.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CollectionsOperation = void 0;\nconst collection_1 = __webpack_require__(/*! ../collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CollectionsOperation extends operation_1.AbstractOperation {\n    constructor(db, options) {\n        super(options);\n        this.options = options;\n        this.db = db;\n    }\n    get commandName() {\n        return 'listCollections';\n    }\n    async execute(server, session) {\n        // Let's get the collection names\n        const documents = await this.db\n            .listCollections({}, { ...this.options, nameOnly: true, readPreference: this.readPreference, session })\n            .toArray();\n        const collections = [];\n        for (const { name } of documents) {\n            if (!name.includes('$')) {\n                // Filter collections removing any illegal ones\n                collections.push(new collection_1.Collection(this.db, name, this.db.s.options));\n            }\n        }\n        // Return the collection objects\n        return collections;\n    }\n}\nexports.CollectionsOperation = CollectionsOperation;\n//# sourceMappingURL=collections.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY29sbGVjdGlvbnMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNEJBQTRCO0FBQzVCLHFCQUFxQixtQkFBTyxDQUFDLHVHQUFlO0FBQzVDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLElBQUksK0VBQStFO0FBQ2xIO0FBQ0E7QUFDQSxxQkFBcUIsT0FBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvbGxlY3Rpb25zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db2xsZWN0aW9uc09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGNvbGxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuLi9jb2xsZWN0aW9uXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDb2xsZWN0aW9uc09wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnbGlzdENvbGxlY3Rpb25zJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24pIHtcbiAgICAgICAgLy8gTGV0J3MgZ2V0IHRoZSBjb2xsZWN0aW9uIG5hbWVzXG4gICAgICAgIGNvbnN0IGRvY3VtZW50cyA9IGF3YWl0IHRoaXMuZGJcbiAgICAgICAgICAgIC5saXN0Q29sbGVjdGlvbnMoe30sIHsgLi4udGhpcy5vcHRpb25zLCBuYW1lT25seTogdHJ1ZSwgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UsIHNlc3Npb24gfSlcbiAgICAgICAgICAgIC50b0FycmF5KCk7XG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb25zID0gW107XG4gICAgICAgIGZvciAoY29uc3QgeyBuYW1lIH0gb2YgZG9jdW1lbnRzKSB7XG4gICAgICAgICAgICBpZiAoIW5hbWUuaW5jbHVkZXMoJyQnKSkge1xuICAgICAgICAgICAgICAgIC8vIEZpbHRlciBjb2xsZWN0aW9ucyByZW1vdmluZyBhbnkgaWxsZWdhbCBvbmVzXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbnMucHVzaChuZXcgY29sbGVjdGlvbl8xLkNvbGxlY3Rpb24odGhpcy5kYiwgbmFtZSwgdGhpcy5kYi5zLm9wdGlvbnMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBSZXR1cm4gdGhlIGNvbGxlY3Rpb24gb2JqZWN0c1xuICAgICAgICByZXR1cm4gY29sbGVjdGlvbnM7XG4gICAgfVxufVxuZXhwb3J0cy5Db2xsZWN0aW9uc09wZXJhdGlvbiA9IENvbGxlY3Rpb25zT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29sbGVjdGlvbnMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/collections.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CommandOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst explain_1 = __webpack_require__(/*! ../explain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\");\nconst read_concern_1 = __webpack_require__(/*! ../read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst server_selection_1 = __webpack_require__(/*! ../sdam/server_selection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CommandOperation extends operation_1.AbstractOperation {\n    constructor(parent, options) {\n        super(options);\n        this.options = options ?? {};\n        // NOTE: this was explicitly added for the add/remove user operations, it's likely\n        //       something we'd want to reconsider. Perhaps those commands can use `Admin`\n        //       as a parent?\n        const dbNameOverride = options?.dbName || options?.authdb;\n        if (dbNameOverride) {\n            this.ns = new utils_1.MongoDBNamespace(dbNameOverride, '$cmd');\n        }\n        else {\n            this.ns = parent\n                ? parent.s.namespace.withCollection('$cmd')\n                : new utils_1.MongoDBNamespace('admin', '$cmd');\n        }\n        this.readConcern = read_concern_1.ReadConcern.fromOptions(options);\n        this.writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        if (this.hasAspect(operation_1.Aspect.EXPLAINABLE)) {\n            this.explain = explain_1.Explain.fromOptions(options);\n            if (this.explain)\n                (0, explain_1.validateExplainTimeoutOptions)(this.options, this.explain);\n        }\n        else if (options?.explain != null) {\n            throw new error_1.MongoInvalidArgumentError(`Option \"explain\" is not supported on this command`);\n        }\n    }\n    get canRetryWrite() {\n        if (this.hasAspect(operation_1.Aspect.EXPLAINABLE)) {\n            return this.explain == null;\n        }\n        return super.canRetryWrite;\n    }\n    async executeCommand(server, session, cmd, timeoutContext, responseType) {\n        this.server = server;\n        const options = {\n            ...this.options,\n            ...this.bsonOptions,\n            timeoutContext,\n            readPreference: this.readPreference,\n            session\n        };\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const inTransaction = this.session && this.session.inTransaction();\n        if (this.readConcern && (0, utils_1.commandSupportsReadConcern)(cmd) && !inTransaction) {\n            Object.assign(cmd, { readConcern: this.readConcern });\n        }\n        if (this.trySecondaryWrite && serverWireVersion < server_selection_1.MIN_SECONDARY_WRITE_WIRE_VERSION) {\n            options.omitReadPreference = true;\n        }\n        if (this.writeConcern && this.hasAspect(operation_1.Aspect.WRITE_OPERATION) && !inTransaction) {\n            write_concern_1.WriteConcern.apply(cmd, this.writeConcern);\n        }\n        if (options.collation &&\n            typeof options.collation === 'object' &&\n            !this.hasAspect(operation_1.Aspect.SKIP_COLLATION)) {\n            Object.assign(cmd, { collation: options.collation });\n        }\n        if (typeof options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = options.maxTimeMS;\n        }\n        if (this.hasAspect(operation_1.Aspect.EXPLAINABLE) && this.explain) {\n            cmd = (0, explain_1.decorateWithExplain)(cmd, this.explain);\n        }\n        return await server.command(this.ns, cmd, options, responseType);\n    }\n}\nexports.CommandOperation = CommandOperation;\n//# sourceMappingURL=command.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY29tbWFuZC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx3QkFBd0I7QUFDeEIsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsdUJBQXVCLG1CQUFPLENBQUMsMkdBQWlCO0FBQ2hELDJCQUEyQixtQkFBTyxDQUFDLDZIQUEwQjtBQUM3RCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyx3QkFBd0IsbUJBQU8sQ0FBQyw2R0FBa0I7QUFDbEQsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsK0JBQStCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDhCQUE4QjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY29tbWFuZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29tbWFuZE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBleHBsYWluXzEgPSByZXF1aXJlKFwiLi4vZXhwbGFpblwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3JlYWRfY29uY2VyblwiKTtcbmNvbnN0IHNlcnZlcl9zZWxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuLi9zZGFtL3NlcnZlcl9zZWxlY3Rpb25cIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgd3JpdGVfY29uY2Vybl8xID0gcmVxdWlyZShcIi4uL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENvbW1hbmRPcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IocGFyZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICAvLyBOT1RFOiB0aGlzIHdhcyBleHBsaWNpdGx5IGFkZGVkIGZvciB0aGUgYWRkL3JlbW92ZSB1c2VyIG9wZXJhdGlvbnMsIGl0J3MgbGlrZWx5XG4gICAgICAgIC8vICAgICAgIHNvbWV0aGluZyB3ZSdkIHdhbnQgdG8gcmVjb25zaWRlci4gUGVyaGFwcyB0aG9zZSBjb21tYW5kcyBjYW4gdXNlIGBBZG1pbmBcbiAgICAgICAgLy8gICAgICAgYXMgYSBwYXJlbnQ/XG4gICAgICAgIGNvbnN0IGRiTmFtZU92ZXJyaWRlID0gb3B0aW9ucz8uZGJOYW1lIHx8IG9wdGlvbnM/LmF1dGhkYjtcbiAgICAgICAgaWYgKGRiTmFtZU92ZXJyaWRlKSB7XG4gICAgICAgICAgICB0aGlzLm5zID0gbmV3IHV0aWxzXzEuTW9uZ29EQk5hbWVzcGFjZShkYk5hbWVPdmVycmlkZSwgJyRjbWQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubnMgPSBwYXJlbnRcbiAgICAgICAgICAgICAgICA/IHBhcmVudC5zLm5hbWVzcGFjZS53aXRoQ29sbGVjdGlvbignJGNtZCcpXG4gICAgICAgICAgICAgICAgOiBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKCdhZG1pbicsICckY21kJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWFkQ29uY2VybiA9IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLndyaXRlQ29uY2VybiA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIGlmICh0aGlzLmhhc0FzcGVjdChvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUpKSB7XG4gICAgICAgICAgICB0aGlzLmV4cGxhaW4gPSBleHBsYWluXzEuRXhwbGFpbi5mcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxhaW4pXG4gICAgICAgICAgICAgICAgKDAsIGV4cGxhaW5fMS52YWxpZGF0ZUV4cGxhaW5UaW1lb3V0T3B0aW9ucykodGhpcy5vcHRpb25zLCB0aGlzLmV4cGxhaW4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdGlvbnM/LmV4cGxhaW4gIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgT3B0aW9uIFwiZXhwbGFpblwiIGlzIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBjb21tYW5kYCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGNhblJldHJ5V3JpdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmhhc0FzcGVjdChvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leHBsYWluID09IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLmNhblJldHJ5V3JpdGU7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY21kLCB0aW1lb3V0Q29udGV4dCwgcmVzcG9uc2VUeXBlKSB7XG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgLi4udGhpcy5ic29uT3B0aW9ucyxcbiAgICAgICAgICAgIHRpbWVvdXRDb250ZXh0LFxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UsXG4gICAgICAgICAgICBzZXNzaW9uXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNlcnZlcldpcmVWZXJzaW9uID0gKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcik7XG4gICAgICAgIGNvbnN0IGluVHJhbnNhY3Rpb24gPSB0aGlzLnNlc3Npb24gJiYgdGhpcy5zZXNzaW9uLmluVHJhbnNhY3Rpb24oKTtcbiAgICAgICAgaWYgKHRoaXMucmVhZENvbmNlcm4gJiYgKDAsIHV0aWxzXzEuY29tbWFuZFN1cHBvcnRzUmVhZENvbmNlcm4pKGNtZCkgJiYgIWluVHJhbnNhY3Rpb24pIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY21kLCB7IHJlYWRDb25jZXJuOiB0aGlzLnJlYWRDb25jZXJuIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRyeVNlY29uZGFyeVdyaXRlICYmIHNlcnZlcldpcmVWZXJzaW9uIDwgc2VydmVyX3NlbGVjdGlvbl8xLk1JTl9TRUNPTkRBUllfV1JJVEVfV0lSRV9WRVJTSU9OKSB7XG4gICAgICAgICAgICBvcHRpb25zLm9taXRSZWFkUHJlZmVyZW5jZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMud3JpdGVDb25jZXJuICYmIHRoaXMuaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04pICYmICFpblRyYW5zYWN0aW9uKSB7XG4gICAgICAgICAgICB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmFwcGx5KGNtZCwgdGhpcy53cml0ZUNvbmNlcm4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmNvbGxhdGlvbiAmJlxuICAgICAgICAgICAgdHlwZW9mIG9wdGlvbnMuY29sbGF0aW9uID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgIXRoaXMuaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTikpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY21kLCB7IGNvbGxhdGlvbjogb3B0aW9ucy5jb2xsYXRpb24gfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5tYXhUaW1lTVMgPSBvcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFKSAmJiB0aGlzLmV4cGxhaW4pIHtcbiAgICAgICAgICAgIGNtZCA9ICgwLCBleHBsYWluXzEuZGVjb3JhdGVXaXRoRXhwbGFpbikoY21kLCB0aGlzLmV4cGxhaW4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBzZXJ2ZXIuY29tbWFuZCh0aGlzLm5zLCBjbWQsIG9wdGlvbnMsIHJlc3BvbnNlVHlwZSk7XG4gICAgfVxufVxuZXhwb3J0cy5Db21tYW5kT3BlcmF0aW9uID0gQ29tbWFuZE9wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1hbmQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/count.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/count.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CountOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CountOperation extends command_1.CommandOperation {\n    constructor(namespace, filter, options) {\n        super({ s: { namespace: namespace } }, options);\n        this.options = options;\n        this.collectionName = namespace.collection;\n        this.query = filter;\n    }\n    get commandName() {\n        return 'count';\n    }\n    async execute(server, session, timeoutContext) {\n        const options = this.options;\n        const cmd = {\n            count: this.collectionName,\n            query: this.query\n        };\n        if (typeof options.limit === 'number') {\n            cmd.limit = options.limit;\n        }\n        if (typeof options.skip === 'number') {\n            cmd.skip = options.skip;\n        }\n        if (options.hint != null) {\n            cmd.hint = options.hint;\n        }\n        if (typeof options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = options.maxTimeMS;\n        }\n        const result = await super.executeCommand(server, session, cmd, timeoutContext);\n        return result ? result.n : 0;\n    }\n}\nexports.CountOperation = CountOperation;\n(0, operation_1.defineAspects)(CountOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE]);\n//# sourceMappingURL=count.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY291bnQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsc0JBQXNCO0FBQ3RCLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixLQUFLLHdCQUF3QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2NvdW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db3VudE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENvdW50T3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG5hbWVzcGFjZSwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHsgczogeyBuYW1lc3BhY2U6IG5hbWVzcGFjZSB9IH0sIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID0gbmFtZXNwYWNlLmNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMucXVlcnkgPSBmaWx0ZXI7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdjb3VudCc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBjb25zdCBjbWQgPSB7XG4gICAgICAgICAgICBjb3VudDogdGhpcy5jb2xsZWN0aW9uTmFtZSxcbiAgICAgICAgICAgIHF1ZXJ5OiB0aGlzLnF1ZXJ5XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5saW1pdCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5saW1pdCA9IG9wdGlvbnMubGltaXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnNraXAgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjbWQuc2tpcCA9IG9wdGlvbnMuc2tpcDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5oaW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNtZC5oaW50ID0gb3B0aW9ucy5oaW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXhUaW1lTVMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjbWQubWF4VGltZU1TID0gb3B0aW9ucy5tYXhUaW1lTVM7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCBjbWQsIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdC5uIDogMDtcbiAgICB9XG59XG5leHBvcnRzLkNvdW50T3BlcmF0aW9uID0gQ291bnRPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoQ291bnRPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEVdKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvdW50LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/count.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/create_collection.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/create_collection.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CreateCollectionOperation = void 0;\nconst constants_1 = __webpack_require__(/*! ../cmap/wire_protocol/constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst collection_1 = __webpack_require__(/*! ../collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst indexes_1 = __webpack_require__(/*! ./indexes */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\nconst ILLEGAL_COMMAND_FIELDS = new Set([\n    'w',\n    'wtimeout',\n    'timeoutMS',\n    'j',\n    'fsync',\n    'autoIndexId',\n    'pkFactory',\n    'raw',\n    'readPreference',\n    'session',\n    'readConcern',\n    'writeConcern',\n    'raw',\n    'fieldsAsRaw',\n    'useBigInt64',\n    'promoteLongs',\n    'promoteValues',\n    'promoteBuffers',\n    'bsonRegExp',\n    'serializeFunctions',\n    'ignoreUndefined',\n    'enableUtf8Validation'\n]);\n/* @internal */\nconst INVALID_QE_VERSION = 'Driver support of Queryable Encryption is incompatible with server. Upgrade server to use Queryable Encryption.';\n/** @internal */\nclass CreateCollectionOperation extends command_1.CommandOperation {\n    constructor(db, name, options = {}) {\n        super(db, options);\n        this.options = options;\n        this.db = db;\n        this.name = name;\n    }\n    get commandName() {\n        return 'create';\n    }\n    async execute(server, session, timeoutContext) {\n        const db = this.db;\n        const name = this.name;\n        const options = this.options;\n        const encryptedFields = options.encryptedFields ??\n            db.client.s.options.autoEncryption?.encryptedFieldsMap?.[`${db.databaseName}.${name}`];\n        if (encryptedFields) {\n            // Creating a QE collection required min server of 7.0.0\n            // TODO(NODE-5353): Get wire version information from connection.\n            if (!server.loadBalanced &&\n                server.description.maxWireVersion < constants_1.MIN_SUPPORTED_QE_WIRE_VERSION) {\n                throw new error_1.MongoCompatibilityError(`${INVALID_QE_VERSION} The minimum server version required is ${constants_1.MIN_SUPPORTED_QE_SERVER_VERSION}`);\n            }\n            // Create auxilliary collections for queryable encryption support.\n            const escCollection = encryptedFields.escCollection ?? `enxcol_.${name}.esc`;\n            const ecocCollection = encryptedFields.ecocCollection ?? `enxcol_.${name}.ecoc`;\n            for (const collectionName of [escCollection, ecocCollection]) {\n                const createOp = new CreateCollectionOperation(db, collectionName, {\n                    clusteredIndex: {\n                        key: { _id: 1 },\n                        unique: true\n                    }\n                });\n                await createOp.executeWithoutEncryptedFieldsCheck(server, session, timeoutContext);\n            }\n            if (!options.encryptedFields) {\n                this.options = { ...this.options, encryptedFields };\n            }\n        }\n        const coll = await this.executeWithoutEncryptedFieldsCheck(server, session, timeoutContext);\n        if (encryptedFields) {\n            // Create the required index for queryable encryption support.\n            const createIndexOp = indexes_1.CreateIndexesOperation.fromIndexSpecification(db, name, { __safeContent__: 1 }, {});\n            await createIndexOp.execute(server, session, timeoutContext);\n        }\n        return coll;\n    }\n    async executeWithoutEncryptedFieldsCheck(server, session, timeoutContext) {\n        const db = this.db;\n        const name = this.name;\n        const options = this.options;\n        const cmd = { create: name };\n        for (const n in options) {\n            if (options[n] != null &&\n                typeof options[n] !== 'function' &&\n                !ILLEGAL_COMMAND_FIELDS.has(n)) {\n                cmd[n] = options[n];\n            }\n        }\n        // otherwise just execute the command\n        await super.executeCommand(server, session, cmd, timeoutContext);\n        return new collection_1.Collection(db, name, options);\n    }\n}\nexports.CreateCollectionOperation = CreateCollectionOperation;\n(0, operation_1.defineAspects)(CreateCollectionOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=create_collection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY3JlYXRlX2NvbGxlY3Rpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsaUNBQWlDO0FBQ2pDLG9CQUFvQixtQkFBTyxDQUFDLDJJQUFpQztBQUM3RCxxQkFBcUIsbUJBQU8sQ0FBQyx1R0FBZTtBQUM1QyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQywyR0FBVztBQUNyQyxrQkFBa0IsbUJBQU8sQ0FBQywyR0FBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxnQkFBZ0IsR0FBRyxLQUFLO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQsb0JBQW9CLHlDQUF5Qyw0Q0FBNEM7QUFDdEs7QUFDQTtBQUNBLDhFQUE4RSxLQUFLO0FBQ25GLGdGQUFnRixLQUFLO0FBQ3JGO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixRQUFRO0FBQ3ZDO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzR0FBc0csb0JBQW9CLElBQUk7QUFDOUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvY3JlYXRlX2NvbGxlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jbWFwL3dpcmVfcHJvdG9jb2wvY29uc3RhbnRzXCIpO1xuY29uc3QgY29sbGVjdGlvbl8xID0gcmVxdWlyZShcIi4uL2NvbGxlY3Rpb25cIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IGluZGV4ZXNfMSA9IHJlcXVpcmUoXCIuL2luZGV4ZXNcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbmNvbnN0IElMTEVHQUxfQ09NTUFORF9GSUVMRFMgPSBuZXcgU2V0KFtcbiAgICAndycsXG4gICAgJ3d0aW1lb3V0JyxcbiAgICAndGltZW91dE1TJyxcbiAgICAnaicsXG4gICAgJ2ZzeW5jJyxcbiAgICAnYXV0b0luZGV4SWQnLFxuICAgICdwa0ZhY3RvcnknLFxuICAgICdyYXcnLFxuICAgICdyZWFkUHJlZmVyZW5jZScsXG4gICAgJ3Nlc3Npb24nLFxuICAgICdyZWFkQ29uY2VybicsXG4gICAgJ3dyaXRlQ29uY2VybicsXG4gICAgJ3JhdycsXG4gICAgJ2ZpZWxkc0FzUmF3JyxcbiAgICAndXNlQmlnSW50NjQnLFxuICAgICdwcm9tb3RlTG9uZ3MnLFxuICAgICdwcm9tb3RlVmFsdWVzJyxcbiAgICAncHJvbW90ZUJ1ZmZlcnMnLFxuICAgICdic29uUmVnRXhwJyxcbiAgICAnc2VyaWFsaXplRnVuY3Rpb25zJyxcbiAgICAnaWdub3JlVW5kZWZpbmVkJyxcbiAgICAnZW5hYmxlVXRmOFZhbGlkYXRpb24nXG5dKTtcbi8qIEBpbnRlcm5hbCAqL1xuY29uc3QgSU5WQUxJRF9RRV9WRVJTSU9OID0gJ0RyaXZlciBzdXBwb3J0IG9mIFF1ZXJ5YWJsZSBFbmNyeXB0aW9uIGlzIGluY29tcGF0aWJsZSB3aXRoIHNlcnZlci4gVXBncmFkZSBzZXJ2ZXIgdG8gdXNlIFF1ZXJ5YWJsZSBFbmNyeXB0aW9uLic7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBDcmVhdGVDb2xsZWN0aW9uT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBuYW1lLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmRiID0gZGI7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdjcmVhdGUnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgZGIgPSB0aGlzLmRiO1xuICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5uYW1lO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBjb25zdCBlbmNyeXB0ZWRGaWVsZHMgPSBvcHRpb25zLmVuY3J5cHRlZEZpZWxkcyA/P1xuICAgICAgICAgICAgZGIuY2xpZW50LnMub3B0aW9ucy5hdXRvRW5jcnlwdGlvbj8uZW5jcnlwdGVkRmllbGRzTWFwPy5bYCR7ZGIuZGF0YWJhc2VOYW1lfS4ke25hbWV9YF07XG4gICAgICAgIGlmIChlbmNyeXB0ZWRGaWVsZHMpIHtcbiAgICAgICAgICAgIC8vIENyZWF0aW5nIGEgUUUgY29sbGVjdGlvbiByZXF1aXJlZCBtaW4gc2VydmVyIG9mIDcuMC4wXG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtNTM1Myk6IEdldCB3aXJlIHZlcnNpb24gaW5mb3JtYXRpb24gZnJvbSBjb25uZWN0aW9uLlxuICAgICAgICAgICAgaWYgKCFzZXJ2ZXIubG9hZEJhbGFuY2VkICYmXG4gICAgICAgICAgICAgICAgc2VydmVyLmRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9uIDwgY29uc3RhbnRzXzEuTUlOX1NVUFBPUlRFRF9RRV9XSVJFX1ZFUlNJT04pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgJHtJTlZBTElEX1FFX1ZFUlNJT059IFRoZSBtaW5pbXVtIHNlcnZlciB2ZXJzaW9uIHJlcXVpcmVkIGlzICR7Y29uc3RhbnRzXzEuTUlOX1NVUFBPUlRFRF9RRV9TRVJWRVJfVkVSU0lPTn1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENyZWF0ZSBhdXhpbGxpYXJ5IGNvbGxlY3Rpb25zIGZvciBxdWVyeWFibGUgZW5jcnlwdGlvbiBzdXBwb3J0LlxuICAgICAgICAgICAgY29uc3QgZXNjQ29sbGVjdGlvbiA9IGVuY3J5cHRlZEZpZWxkcy5lc2NDb2xsZWN0aW9uID8/IGBlbnhjb2xfLiR7bmFtZX0uZXNjYDtcbiAgICAgICAgICAgIGNvbnN0IGVjb2NDb2xsZWN0aW9uID0gZW5jcnlwdGVkRmllbGRzLmVjb2NDb2xsZWN0aW9uID8/IGBlbnhjb2xfLiR7bmFtZX0uZWNvY2A7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNvbGxlY3Rpb25OYW1lIG9mIFtlc2NDb2xsZWN0aW9uLCBlY29jQ29sbGVjdGlvbl0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjcmVhdGVPcCA9IG5ldyBDcmVhdGVDb2xsZWN0aW9uT3BlcmF0aW9uKGRiLCBjb2xsZWN0aW9uTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICBjbHVzdGVyZWRJbmRleDoge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiB7IF9pZDogMSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhd2FpdCBjcmVhdGVPcC5leGVjdXRlV2l0aG91dEVuY3J5cHRlZEZpZWxkc0NoZWNrKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFvcHRpb25zLmVuY3J5cHRlZEZpZWxkcykge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHsgLi4udGhpcy5vcHRpb25zLCBlbmNyeXB0ZWRGaWVsZHMgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2xsID0gYXdhaXQgdGhpcy5leGVjdXRlV2l0aG91dEVuY3J5cHRlZEZpZWxkc0NoZWNrKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICBpZiAoZW5jcnlwdGVkRmllbGRzKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHJlcXVpcmVkIGluZGV4IGZvciBxdWVyeWFibGUgZW5jcnlwdGlvbiBzdXBwb3J0LlxuICAgICAgICAgICAgY29uc3QgY3JlYXRlSW5kZXhPcCA9IGluZGV4ZXNfMS5DcmVhdGVJbmRleGVzT3BlcmF0aW9uLmZyb21JbmRleFNwZWNpZmljYXRpb24oZGIsIG5hbWUsIHsgX19zYWZlQ29udGVudF9fOiAxIH0sIHt9KTtcbiAgICAgICAgICAgIGF3YWl0IGNyZWF0ZUluZGV4T3AuZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29sbDtcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZVdpdGhvdXRFbmNyeXB0ZWRGaWVsZHNDaGVjayhzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGRiID0gdGhpcy5kYjtcbiAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMubmFtZTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgY29uc3QgY21kID0geyBjcmVhdGU6IG5hbWUgfTtcbiAgICAgICAgZm9yIChjb25zdCBuIGluIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zW25dICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICB0eXBlb2Ygb3B0aW9uc1tuXSAhPT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgICAgICAgICAgICFJTExFR0FMX0NPTU1BTkRfRklFTERTLmhhcyhuKSkge1xuICAgICAgICAgICAgICAgIGNtZFtuXSA9IG9wdGlvbnNbbl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gb3RoZXJ3aXNlIGp1c3QgZXhlY3V0ZSB0aGUgY29tbWFuZFxuICAgICAgICBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIGNtZCwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gbmV3IGNvbGxlY3Rpb25fMS5Db2xsZWN0aW9uKGRiLCBuYW1lLCBvcHRpb25zKTtcbiAgICB9XG59XG5leHBvcnRzLkNyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24gPSBDcmVhdGVDb2xsZWN0aW9uT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKENyZWF0ZUNvbGxlY3Rpb25PcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jcmVhdGVfY29sbGVjdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/create_collection.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/delete.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/delete.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DeleteManyOperation = exports.DeleteOneOperation = exports.DeleteOperation = void 0;\nexports.makeDeleteStatement = makeDeleteStatement;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DeleteOperation extends command_1.CommandOperation {\n    constructor(ns, statements, options) {\n        super(undefined, options);\n        this.options = options;\n        this.ns = ns;\n        this.statements = statements;\n    }\n    get commandName() {\n        return 'delete';\n    }\n    get canRetryWrite() {\n        if (super.canRetryWrite === false) {\n            return false;\n        }\n        return this.statements.every(op => (op.limit != null ? op.limit > 0 : true));\n    }\n    async execute(server, session, timeoutContext) {\n        const options = this.options ?? {};\n        const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n        const command = {\n            delete: this.ns.collection,\n            deletes: this.statements,\n            ordered\n        };\n        if (options.let) {\n            command.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        const unacknowledgedWrite = this.writeConcern && this.writeConcern.w === 0;\n        if (unacknowledgedWrite) {\n            if (this.statements.find((o) => o.hint)) {\n                // TODO(NODE-3541): fix error for hint with unacknowledged writes\n                throw new error_1.MongoCompatibilityError(`hint is not supported with unacknowledged writes`);\n            }\n        }\n        const res = await super.executeCommand(server, session, command, timeoutContext);\n        return res;\n    }\n}\nexports.DeleteOperation = DeleteOperation;\nclass DeleteOneOperation extends DeleteOperation {\n    constructor(collection, filter, options) {\n        super(collection.s.namespace, [makeDeleteStatement(filter, { ...options, limit: 1 })], options);\n    }\n    async execute(server, session, timeoutContext) {\n        const res = await super.execute(server, session, timeoutContext);\n        if (this.explain)\n            return res;\n        if (res.code)\n            throw new error_1.MongoServerError(res);\n        if (res.writeErrors)\n            throw new error_1.MongoServerError(res.writeErrors[0]);\n        return {\n            acknowledged: this.writeConcern?.w !== 0,\n            deletedCount: res.n\n        };\n    }\n}\nexports.DeleteOneOperation = DeleteOneOperation;\nclass DeleteManyOperation extends DeleteOperation {\n    constructor(collection, filter, options) {\n        super(collection.s.namespace, [makeDeleteStatement(filter, options)], options);\n    }\n    async execute(server, session, timeoutContext) {\n        const res = await super.execute(server, session, timeoutContext);\n        if (this.explain)\n            return res;\n        if (res.code)\n            throw new error_1.MongoServerError(res);\n        if (res.writeErrors)\n            throw new error_1.MongoServerError(res.writeErrors[0]);\n        return {\n            acknowledged: this.writeConcern?.w !== 0,\n            deletedCount: res.n\n        };\n    }\n}\nexports.DeleteManyOperation = DeleteManyOperation;\nfunction makeDeleteStatement(filter, options) {\n    const op = {\n        q: filter,\n        limit: typeof options.limit === 'number' ? options.limit : 0\n    };\n    if (options.collation) {\n        op.collation = options.collation;\n    }\n    if (options.hint) {\n        op.hint = options.hint;\n    }\n    return op;\n}\n(0, operation_1.defineAspects)(DeleteOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DeleteOneOperation, [\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n(0, operation_1.defineAspects)(DeleteManyOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n//# sourceMappingURL=delete.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZGVsZXRlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDJCQUEyQixHQUFHLDBCQUEwQixHQUFHLHVCQUF1QjtBQUNsRiwyQkFBMkI7QUFDM0IsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EscUVBQXFFLHNCQUFzQjtBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2RlbGV0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGVsZXRlTWFueU9wZXJhdGlvbiA9IGV4cG9ydHMuRGVsZXRlT25lT3BlcmF0aW9uID0gZXhwb3J0cy5EZWxldGVPcGVyYXRpb24gPSB2b2lkIDA7XG5leHBvcnRzLm1ha2VEZWxldGVTdGF0ZW1lbnQgPSBtYWtlRGVsZXRlU3RhdGVtZW50O1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERlbGV0ZU9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihucywgc3RhdGVtZW50cywgb3B0aW9ucykge1xuICAgICAgICBzdXBlcih1bmRlZmluZWQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLm5zID0gbnM7XG4gICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IHN0YXRlbWVudHM7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdkZWxldGUnO1xuICAgIH1cbiAgICBnZXQgY2FuUmV0cnlXcml0ZSgpIHtcbiAgICAgICAgaWYgKHN1cGVyLmNhblJldHJ5V3JpdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVtZW50cy5ldmVyeShvcCA9PiAob3AubGltaXQgIT0gbnVsbCA/IG9wLmxpbWl0ID4gMCA6IHRydWUpKTtcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMgPz8ge307XG4gICAgICAgIGNvbnN0IG9yZGVyZWQgPSB0eXBlb2Ygb3B0aW9ucy5vcmRlcmVkID09PSAnYm9vbGVhbicgPyBvcHRpb25zLm9yZGVyZWQgOiB0cnVlO1xuICAgICAgICBjb25zdCBjb21tYW5kID0ge1xuICAgICAgICAgICAgZGVsZXRlOiB0aGlzLm5zLmNvbGxlY3Rpb24sXG4gICAgICAgICAgICBkZWxldGVzOiB0aGlzLnN0YXRlbWVudHMsXG4gICAgICAgICAgICBvcmRlcmVkXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvcHRpb25zLmxldCkge1xuICAgICAgICAgICAgY29tbWFuZC5sZXQgPSBvcHRpb25zLmxldDtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKG9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21tYW5kLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdW5hY2tub3dsZWRnZWRXcml0ZSA9IHRoaXMud3JpdGVDb25jZXJuICYmIHRoaXMud3JpdGVDb25jZXJuLncgPT09IDA7XG4gICAgICAgIGlmICh1bmFja25vd2xlZGdlZFdyaXRlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzLmZpbmQoKG8pID0+IG8uaGludCkpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPKE5PREUtMzU0MSk6IGZpeCBlcnJvciBmb3IgaGludCB3aXRoIHVuYWNrbm93bGVkZ2VkIHdyaXRlc1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKGBoaW50IGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCB1bmFja25vd2xlZGdlZCB3cml0ZXNgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIGNvbW1hbmQsIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG59XG5leHBvcnRzLkRlbGV0ZU9wZXJhdGlvbiA9IERlbGV0ZU9wZXJhdGlvbjtcbmNsYXNzIERlbGV0ZU9uZU9wZXJhdGlvbiBleHRlbmRzIERlbGV0ZU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24ucy5uYW1lc3BhY2UsIFttYWtlRGVsZXRlU3RhdGVtZW50KGZpbHRlciwgeyAuLi5vcHRpb25zLCBsaW1pdDogMSB9KV0sIG9wdGlvbnMpO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgc3VwZXIuZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgaWYgKHRoaXMuZXhwbGFpbilcbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIGlmIChyZXMuY29kZSlcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzKTtcbiAgICAgICAgaWYgKHJlcy53cml0ZUVycm9ycylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzLndyaXRlRXJyb3JzWzBdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFja25vd2xlZGdlZDogdGhpcy53cml0ZUNvbmNlcm4/LncgIT09IDAsXG4gICAgICAgICAgICBkZWxldGVkQ291bnQ6IHJlcy5uXG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5EZWxldGVPbmVPcGVyYXRpb24gPSBEZWxldGVPbmVPcGVyYXRpb247XG5jbGFzcyBEZWxldGVNYW55T3BlcmF0aW9uIGV4dGVuZHMgRGVsZXRlT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBmaWx0ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbi5zLm5hbWVzcGFjZSwgW21ha2VEZWxldGVTdGF0ZW1lbnQoZmlsdGVyLCBvcHRpb25zKV0sIG9wdGlvbnMpO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgc3VwZXIuZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgaWYgKHRoaXMuZXhwbGFpbilcbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIGlmIChyZXMuY29kZSlcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzKTtcbiAgICAgICAgaWYgKHJlcy53cml0ZUVycm9ycylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzLndyaXRlRXJyb3JzWzBdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFja25vd2xlZGdlZDogdGhpcy53cml0ZUNvbmNlcm4/LncgIT09IDAsXG4gICAgICAgICAgICBkZWxldGVkQ291bnQ6IHJlcy5uXG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5EZWxldGVNYW55T3BlcmF0aW9uID0gRGVsZXRlTWFueU9wZXJhdGlvbjtcbmZ1bmN0aW9uIG1ha2VEZWxldGVTdGF0ZW1lbnQoZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgY29uc3Qgb3AgPSB7XG4gICAgICAgIHE6IGZpbHRlcixcbiAgICAgICAgbGltaXQ6IHR5cGVvZiBvcHRpb25zLmxpbWl0ID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubGltaXQgOiAwXG4gICAgfTtcbiAgICBpZiAob3B0aW9ucy5jb2xsYXRpb24pIHtcbiAgICAgICAgb3AuY29sbGF0aW9uID0gb3B0aW9ucy5jb2xsYXRpb247XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmhpbnQpIHtcbiAgICAgICAgb3AuaGludCA9IG9wdGlvbnMuaGludDtcbiAgICB9XG4gICAgcmV0dXJuIG9wO1xufVxuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKERlbGV0ZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEZWxldGVPbmVPcGVyYXRpb24sIFtcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTlxuXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRGVsZXRlTWFueU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTlxuXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kZWxldGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/delete.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/distinct.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/distinct.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DistinctOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/**\n * Return a list of distinct values for the given key across a collection.\n * @internal\n */\nclass DistinctOperation extends command_1.CommandOperation {\n    /**\n     * Construct a Distinct operation.\n     *\n     * @param collection - Collection instance.\n     * @param key - Field of the document to find distinct values for.\n     * @param query - The query for filtering the set of documents to which we apply the distinct filter.\n     * @param options - Optional settings. See Collection.prototype.distinct for a list of options.\n     */\n    constructor(collection, key, query, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.collection = collection;\n        this.key = key;\n        this.query = query;\n    }\n    get commandName() {\n        return 'distinct';\n    }\n    async execute(server, session, timeoutContext) {\n        const coll = this.collection;\n        const key = this.key;\n        const query = this.query;\n        const options = this.options;\n        // Distinct command\n        const cmd = {\n            distinct: coll.collectionName,\n            key: key,\n            query: query\n        };\n        // Add maxTimeMS if defined\n        if (typeof options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = options.maxTimeMS;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (typeof options.comment !== 'undefined') {\n            cmd.comment = options.comment;\n        }\n        if (options.hint != null) {\n            cmd.hint = options.hint;\n        }\n        // Do we have a readConcern specified\n        (0, utils_1.decorateWithReadConcern)(cmd, coll, options);\n        // Have we specified collation\n        (0, utils_1.decorateWithCollation)(cmd, coll, options);\n        const result = await super.executeCommand(server, session, cmd, timeoutContext);\n        return this.explain ? result : result.values;\n    }\n}\nexports.DistinctOperation = DistinctOperation;\n(0, operation_1.defineAspects)(DistinctOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE, operation_1.Aspect.EXPLAINABLE]);\n//# sourceMappingURL=distinct.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZGlzdGluY3QuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QseUJBQXlCO0FBQ3pCLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9kaXN0aW5jdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGlzdGluY3RPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqXG4gKiBSZXR1cm4gYSBsaXN0IG9mIGRpc3RpbmN0IHZhbHVlcyBmb3IgdGhlIGdpdmVuIGtleSBhY3Jvc3MgYSBjb2xsZWN0aW9uLlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIERpc3RpbmN0T3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBhIERpc3RpbmN0IG9wZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb2xsZWN0aW9uIC0gQ29sbGVjdGlvbiBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ga2V5IC0gRmllbGQgb2YgdGhlIGRvY3VtZW50IHRvIGZpbmQgZGlzdGluY3QgdmFsdWVzIGZvci5cbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgZm9yIGZpbHRlcmluZyB0aGUgc2V0IG9mIGRvY3VtZW50cyB0byB3aGljaCB3ZSBhcHBseSB0aGUgZGlzdGluY3QgZmlsdGVyLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgc2V0dGluZ3MuIFNlZSBDb2xsZWN0aW9uLnByb3RvdHlwZS5kaXN0aW5jdCBmb3IgYSBsaXN0IG9mIG9wdGlvbnMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwga2V5LCBxdWVyeSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5rZXkgPSBrZXk7XG4gICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTtcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ2Rpc3RpbmN0JztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMua2V5O1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMucXVlcnk7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIC8vIERpc3RpbmN0IGNvbW1hbmRcbiAgICAgICAgY29uc3QgY21kID0ge1xuICAgICAgICAgICAgZGlzdGluY3Q6IGNvbGwuY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxuICAgICAgICB9O1xuICAgICAgICAvLyBBZGQgbWF4VGltZU1TIGlmIGRlZmluZWRcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNtZC5tYXhUaW1lTVMgPSBvcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmNvbW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBjbWQuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5oaW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNtZC5oaW50ID0gb3B0aW9ucy5oaW50O1xuICAgICAgICB9XG4gICAgICAgIC8vIERvIHdlIGhhdmUgYSByZWFkQ29uY2VybiBzcGVjaWZpZWRcbiAgICAgICAgKDAsIHV0aWxzXzEuZGVjb3JhdGVXaXRoUmVhZENvbmNlcm4pKGNtZCwgY29sbCwgb3B0aW9ucyk7XG4gICAgICAgIC8vIEhhdmUgd2Ugc3BlY2lmaWVkIGNvbGxhdGlvblxuICAgICAgICAoMCwgdXRpbHNfMS5kZWNvcmF0ZVdpdGhDb2xsYXRpb24pKGNtZCwgY29sbCwgb3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY21kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIHJldHVybiB0aGlzLmV4cGxhaW4gPyByZXN1bHQgOiByZXN1bHQudmFsdWVzO1xuICAgIH1cbn1cbmV4cG9ydHMuRGlzdGluY3RPcGVyYXRpb24gPSBEaXN0aW5jdE9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEaXN0aW5jdE9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTiwgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSwgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kaXN0aW5jdC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/distinct.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/drop.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/drop.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DropDatabaseOperation = exports.DropCollectionOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DropCollectionOperation extends command_1.CommandOperation {\n    constructor(db, name, options = {}) {\n        super(db, options);\n        this.db = db;\n        this.options = options;\n        this.name = name;\n    }\n    get commandName() {\n        return 'drop';\n    }\n    async execute(server, session, timeoutContext) {\n        const db = this.db;\n        const options = this.options;\n        const name = this.name;\n        const encryptedFieldsMap = db.client.s.options.autoEncryption?.encryptedFieldsMap;\n        let encryptedFields = options.encryptedFields ?? encryptedFieldsMap?.[`${db.databaseName}.${name}`];\n        if (!encryptedFields && encryptedFieldsMap) {\n            // If the MongoClient was configured with an encryptedFieldsMap,\n            // and no encryptedFields config was available in it or explicitly\n            // passed as an argument, the spec tells us to look one up using\n            // listCollections().\n            const listCollectionsResult = await db\n                .listCollections({ name }, { nameOnly: false })\n                .toArray();\n            encryptedFields = listCollectionsResult?.[0]?.options?.encryptedFields;\n        }\n        if (encryptedFields) {\n            const escCollection = encryptedFields.escCollection || `enxcol_.${name}.esc`;\n            const ecocCollection = encryptedFields.ecocCollection || `enxcol_.${name}.ecoc`;\n            for (const collectionName of [escCollection, ecocCollection]) {\n                // Drop auxilliary collections, ignoring potential NamespaceNotFound errors.\n                const dropOp = new DropCollectionOperation(db, collectionName);\n                try {\n                    await dropOp.executeWithoutEncryptedFieldsCheck(server, session, timeoutContext);\n                }\n                catch (err) {\n                    if (!(err instanceof error_1.MongoServerError) ||\n                        err.code !== error_1.MONGODB_ERROR_CODES.NamespaceNotFound) {\n                        throw err;\n                    }\n                }\n            }\n        }\n        return await this.executeWithoutEncryptedFieldsCheck(server, session, timeoutContext);\n    }\n    async executeWithoutEncryptedFieldsCheck(server, session, timeoutContext) {\n        await super.executeCommand(server, session, { drop: this.name }, timeoutContext);\n        return true;\n    }\n}\nexports.DropCollectionOperation = DropCollectionOperation;\n/** @internal */\nclass DropDatabaseOperation extends command_1.CommandOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options;\n    }\n    get commandName() {\n        return 'dropDatabase';\n    }\n    async execute(server, session, timeoutContext) {\n        await super.executeCommand(server, session, { dropDatabase: 1 }, timeoutContext);\n        return true;\n    }\n}\nexports.DropDatabaseOperation = DropDatabaseOperation;\n(0, operation_1.defineAspects)(DropCollectionOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DropDatabaseOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=drop.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZHJvcC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw2QkFBNkIsR0FBRywrQkFBK0I7QUFDL0QsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixnQkFBZ0IsR0FBRyxLQUFLO0FBQ3pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxNQUFNLElBQUksaUJBQWlCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLEtBQUs7QUFDbkYsZ0ZBQWdGLEtBQUs7QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNEQUFzRCxpQkFBaUI7QUFDdkU7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELGlCQUFpQjtBQUN2RTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9kcm9wLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Ecm9wRGF0YWJhc2VPcGVyYXRpb24gPSBleHBvcnRzLkRyb3BDb2xsZWN0aW9uT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BDb2xsZWN0aW9uT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBuYW1lLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmRiID0gZGI7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdkcm9wJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGRiID0gdGhpcy5kYjtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMubmFtZTtcbiAgICAgICAgY29uc3QgZW5jcnlwdGVkRmllbGRzTWFwID0gZGIuY2xpZW50LnMub3B0aW9ucy5hdXRvRW5jcnlwdGlvbj8uZW5jcnlwdGVkRmllbGRzTWFwO1xuICAgICAgICBsZXQgZW5jcnlwdGVkRmllbGRzID0gb3B0aW9ucy5lbmNyeXB0ZWRGaWVsZHMgPz8gZW5jcnlwdGVkRmllbGRzTWFwPy5bYCR7ZGIuZGF0YWJhc2VOYW1lfS4ke25hbWV9YF07XG4gICAgICAgIGlmICghZW5jcnlwdGVkRmllbGRzICYmIGVuY3J5cHRlZEZpZWxkc01hcCkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIE1vbmdvQ2xpZW50IHdhcyBjb25maWd1cmVkIHdpdGggYW4gZW5jcnlwdGVkRmllbGRzTWFwLFxuICAgICAgICAgICAgLy8gYW5kIG5vIGVuY3J5cHRlZEZpZWxkcyBjb25maWcgd2FzIGF2YWlsYWJsZSBpbiBpdCBvciBleHBsaWNpdGx5XG4gICAgICAgICAgICAvLyBwYXNzZWQgYXMgYW4gYXJndW1lbnQsIHRoZSBzcGVjIHRlbGxzIHVzIHRvIGxvb2sgb25lIHVwIHVzaW5nXG4gICAgICAgICAgICAvLyBsaXN0Q29sbGVjdGlvbnMoKS5cbiAgICAgICAgICAgIGNvbnN0IGxpc3RDb2xsZWN0aW9uc1Jlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgICAgLmxpc3RDb2xsZWN0aW9ucyh7IG5hbWUgfSwgeyBuYW1lT25seTogZmFsc2UgfSlcbiAgICAgICAgICAgICAgICAudG9BcnJheSgpO1xuICAgICAgICAgICAgZW5jcnlwdGVkRmllbGRzID0gbGlzdENvbGxlY3Rpb25zUmVzdWx0Py5bMF0/Lm9wdGlvbnM/LmVuY3J5cHRlZEZpZWxkcztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5jcnlwdGVkRmllbGRzKSB7XG4gICAgICAgICAgICBjb25zdCBlc2NDb2xsZWN0aW9uID0gZW5jcnlwdGVkRmllbGRzLmVzY0NvbGxlY3Rpb24gfHwgYGVueGNvbF8uJHtuYW1lfS5lc2NgO1xuICAgICAgICAgICAgY29uc3QgZWNvY0NvbGxlY3Rpb24gPSBlbmNyeXB0ZWRGaWVsZHMuZWNvY0NvbGxlY3Rpb24gfHwgYGVueGNvbF8uJHtuYW1lfS5lY29jYDtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY29sbGVjdGlvbk5hbWUgb2YgW2VzY0NvbGxlY3Rpb24sIGVjb2NDb2xsZWN0aW9uXSkge1xuICAgICAgICAgICAgICAgIC8vIERyb3AgYXV4aWxsaWFyeSBjb2xsZWN0aW9ucywgaWdub3JpbmcgcG90ZW50aWFsIE5hbWVzcGFjZU5vdEZvdW5kIGVycm9ycy5cbiAgICAgICAgICAgICAgICBjb25zdCBkcm9wT3AgPSBuZXcgRHJvcENvbGxlY3Rpb25PcGVyYXRpb24oZGIsIGNvbGxlY3Rpb25OYW1lKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBkcm9wT3AuZXhlY3V0ZVdpdGhvdXRFbmNyeXB0ZWRGaWVsZHNDaGVjayhzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnIuY29kZSAhPT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLk5hbWVzcGFjZU5vdEZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZVdpdGhvdXRFbmNyeXB0ZWRGaWVsZHNDaGVjayhzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZVdpdGhvdXRFbmNyeXB0ZWRGaWVsZHNDaGVjayhzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgeyBkcm9wOiB0aGlzLm5hbWUgfSwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5leHBvcnRzLkRyb3BDb2xsZWN0aW9uT3BlcmF0aW9uID0gRHJvcENvbGxlY3Rpb25PcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBEcm9wRGF0YWJhc2VPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnZHJvcERhdGFiYXNlJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgeyBkcm9wRGF0YWJhc2U6IDEgfSwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5leHBvcnRzLkRyb3BEYXRhYmFzZU9wZXJhdGlvbiA9IERyb3BEYXRhYmFzZU9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEcm9wQ29sbGVjdGlvbk9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEcm9wRGF0YWJhc2VPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kcm9wLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/drop.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/estimated_document_count.js":
/*!***********************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/estimated_document_count.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.EstimatedDocumentCountOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass EstimatedDocumentCountOperation extends command_1.CommandOperation {\n    constructor(collection, options = {}) {\n        super(collection, options);\n        this.options = options;\n        this.collectionName = collection.collectionName;\n    }\n    get commandName() {\n        return 'count';\n    }\n    async execute(server, session, timeoutContext) {\n        const cmd = { count: this.collectionName };\n        if (typeof this.options.maxTimeMS === 'number') {\n            cmd.maxTimeMS = this.options.maxTimeMS;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (this.options.comment !== undefined) {\n            cmd.comment = this.options.comment;\n        }\n        const response = await super.executeCommand(server, session, cmd, timeoutContext);\n        return response?.n || 0;\n    }\n}\nexports.EstimatedDocumentCountOperation = EstimatedDocumentCountOperation;\n(0, operation_1.defineAspects)(EstimatedDocumentCountOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=estimated_document_count.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZXN0aW1hdGVkX2RvY3VtZW50X2NvdW50LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHVDQUF1QztBQUN2QyxrQkFBa0IsbUJBQU8sQ0FBQywyR0FBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYTtBQUN6QztBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZXN0aW1hdGVkX2RvY3VtZW50X2NvdW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Fc3RpbWF0ZWREb2N1bWVudENvdW50T3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRXN0aW1hdGVkRG9jdW1lbnRDb3VudE9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk5hbWUgPSBjb2xsZWN0aW9uLmNvbGxlY3Rpb25OYW1lO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnY291bnQnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY21kID0geyBjb3VudDogdGhpcy5jb2xsZWN0aW9uTmFtZSB9O1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5tYXhUaW1lTVMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjbWQubWF4VGltZU1TID0gdGhpcy5vcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNtZC5jb21tZW50ID0gdGhpcy5vcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIGNtZCwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U/Lm4gfHwgMDtcbiAgICB9XG59XG5leHBvcnRzLkVzdGltYXRlZERvY3VtZW50Q291bnRPcGVyYXRpb24gPSBFc3RpbWF0ZWREb2N1bWVudENvdW50T3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEVzdGltYXRlZERvY3VtZW50Q291bnRPcGVyYXRpb24sIFtcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuQ1VSU09SX0NSRUFUSU5HXG5dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWVzdGltYXRlZF9kb2N1bWVudF9jb3VudC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/estimated_document_count.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.executeOperation = executeOperation;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst server_selection_1 = __webpack_require__(/*! ../sdam/server_selection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\nconst MMAPv1_RETRY_WRITES_ERROR_CODE = error_1.MONGODB_ERROR_CODES.IllegalOperation;\nconst MMAPv1_RETRY_WRITES_ERROR_MESSAGE = 'This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.';\n/**\n * Executes the given operation with provided arguments.\n * @internal\n *\n * @remarks\n * Allows for a single point of entry to provide features such as implicit sessions, which\n * are required by the Driver Sessions specification in the event that a ClientSession is\n * not provided.\n *\n * The expectation is that this function:\n * - Connects the MongoClient if it has not already been connected, see {@link autoConnect}\n * - Creates a session if none is provided and cleans up the session it creates\n * - Tries an operation and retries under certain conditions, see {@link tryOperation}\n *\n * @typeParam T - The operation's type\n * @typeParam TResult - The type of the operation's result, calculated from T\n *\n * @param client - The MongoClient to execute this operation with\n * @param operation - The operation to execute\n */\nasync function executeOperation(client, operation, timeoutContext) {\n    if (!(operation instanceof operation_1.AbstractOperation)) {\n        // TODO(NODE-3483): Extend MongoRuntimeError\n        throw new error_1.MongoRuntimeError('This method requires a valid operation instance');\n    }\n    const topology = client.topology == null\n        ? await (0, utils_1.abortable)(autoConnect(client), operation.options)\n        : client.topology;\n    // The driver sessions spec mandates that we implicitly create sessions for operations\n    // that are not explicitly provided with a session.\n    let session = operation.session;\n    let owner;\n    if (session == null) {\n        owner = Symbol();\n        session = client.startSession({ owner, explicit: false });\n    }\n    else if (session.hasEnded) {\n        throw new error_1.MongoExpiredSessionError('Use of expired sessions is not permitted');\n    }\n    else if (session.snapshotEnabled && !topology.capabilities.supportsSnapshotReads) {\n        throw new error_1.MongoCompatibilityError('Snapshot reads require MongoDB 5.0 or later');\n    }\n    else if (session.client !== client) {\n        throw new error_1.MongoInvalidArgumentError('ClientSession must be from the same MongoClient');\n    }\n    const readPreference = operation.readPreference ?? read_preference_1.ReadPreference.primary;\n    const inTransaction = !!session?.inTransaction();\n    const hasReadAspect = operation.hasAspect(operation_1.Aspect.READ_OPERATION);\n    if (inTransaction &&\n        !readPreference.equals(read_preference_1.ReadPreference.primary) &&\n        (hasReadAspect || operation.commandName === 'runCommand')) {\n        throw new error_1.MongoTransactionError(`Read preference in a transaction must be primary, not: ${readPreference.mode}`);\n    }\n    if (session?.isPinned && session.transaction.isCommitted && !operation.bypassPinningCheck) {\n        session.unpin();\n    }\n    timeoutContext ??= timeout_1.TimeoutContext.create({\n        session,\n        serverSelectionTimeoutMS: client.s.options.serverSelectionTimeoutMS,\n        waitQueueTimeoutMS: client.s.options.waitQueueTimeoutMS,\n        timeoutMS: operation.options.timeoutMS\n    });\n    try {\n        return await tryOperation(operation, {\n            topology,\n            timeoutContext,\n            session,\n            readPreference\n        });\n    }\n    finally {\n        if (session?.owner != null && session.owner === owner) {\n            await session.endSession();\n        }\n    }\n}\n/**\n * Connects a client if it has not yet been connected\n * @internal\n */\nasync function autoConnect(client) {\n    if (client.topology == null) {\n        if (client.s.hasBeenClosed) {\n            throw new error_1.MongoNotConnectedError('Client must be connected before running operations');\n        }\n        client.s.options.__skipPingOnConnect = true;\n        try {\n            await client.connect();\n            if (client.topology == null) {\n                throw new error_1.MongoRuntimeError('client.connect did not create a topology but also did not throw');\n            }\n            return client.topology;\n        }\n        finally {\n            delete client.s.options.__skipPingOnConnect;\n        }\n    }\n    return client.topology;\n}\n/**\n * Executes an operation and retries as appropriate\n * @internal\n *\n * @remarks\n * Implements behaviour described in [Retryable Reads](https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.md) and [Retryable\n * Writes](https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.md) specification\n *\n * This function:\n * - performs initial server selection\n * - attempts to execute an operation\n * - retries the operation if it meets the criteria for a retryable read or a retryable write\n *\n * @typeParam T - The operation's type\n * @typeParam TResult - The type of the operation's result, calculated from T\n *\n * @param operation - The operation to execute\n * */\nasync function tryOperation(operation, { topology, timeoutContext, session, readPreference }) {\n    let selector;\n    if (operation.hasAspect(operation_1.Aspect.MUST_SELECT_SAME_SERVER)) {\n        // GetMore and KillCursor operations must always select the same server, but run through\n        // server selection to potentially force monitor checks if the server is\n        // in an unknown state.\n        selector = (0, server_selection_1.sameServerSelector)(operation.server?.description);\n    }\n    else if (operation.trySecondaryWrite) {\n        // If operation should try to write to secondary use the custom server selector\n        // otherwise provide the read preference.\n        selector = (0, server_selection_1.secondaryWritableServerSelector)(topology.commonWireVersion, readPreference);\n    }\n    else {\n        selector = readPreference;\n    }\n    let server = await topology.selectServer(selector, {\n        session,\n        operationName: operation.commandName,\n        timeoutContext,\n        signal: operation.options.signal\n    });\n    const hasReadAspect = operation.hasAspect(operation_1.Aspect.READ_OPERATION);\n    const hasWriteAspect = operation.hasAspect(operation_1.Aspect.WRITE_OPERATION);\n    const inTransaction = session?.inTransaction() ?? false;\n    const willRetryRead = topology.s.options.retryReads && !inTransaction && operation.canRetryRead;\n    const willRetryWrite = topology.s.options.retryWrites &&\n        !inTransaction &&\n        (0, utils_1.supportsRetryableWrites)(server) &&\n        operation.canRetryWrite;\n    const willRetry = operation.hasAspect(operation_1.Aspect.RETRYABLE) &&\n        session != null &&\n        ((hasReadAspect && willRetryRead) || (hasWriteAspect && willRetryWrite));\n    if (hasWriteAspect && willRetryWrite && session != null) {\n        operation.options.willRetryWrite = true;\n        session.incrementTransactionNumber();\n    }\n    const maxTries = willRetry ? (timeoutContext.csotEnabled() ? Infinity : 2) : 1;\n    let previousOperationError;\n    let previousServer;\n    for (let tries = 0; tries < maxTries; tries++) {\n        if (previousOperationError) {\n            if (hasWriteAspect && previousOperationError.code === MMAPv1_RETRY_WRITES_ERROR_CODE) {\n                throw new error_1.MongoServerError({\n                    message: MMAPv1_RETRY_WRITES_ERROR_MESSAGE,\n                    errmsg: MMAPv1_RETRY_WRITES_ERROR_MESSAGE,\n                    originalError: previousOperationError\n                });\n            }\n            if (operation.hasAspect(operation_1.Aspect.COMMAND_BATCHING) && !operation.canRetryWrite) {\n                throw previousOperationError;\n            }\n            if (hasWriteAspect && !(0, error_1.isRetryableWriteError)(previousOperationError))\n                throw previousOperationError;\n            if (hasReadAspect && !(0, error_1.isRetryableReadError)(previousOperationError))\n                throw previousOperationError;\n            if (previousOperationError instanceof error_1.MongoNetworkError &&\n                operation.hasAspect(operation_1.Aspect.CURSOR_CREATING) &&\n                session != null &&\n                session.isPinned &&\n                !session.inTransaction()) {\n                session.unpin({ force: true, forceClear: true });\n            }\n            server = await topology.selectServer(selector, {\n                session,\n                operationName: operation.commandName,\n                previousServer,\n                signal: operation.options.signal\n            });\n            if (hasWriteAspect && !(0, utils_1.supportsRetryableWrites)(server)) {\n                throw new error_1.MongoUnexpectedServerResponseError('Selected server does not support retryable writes');\n            }\n        }\n        try {\n            // If tries > 0 and we are command batching we need to reset the batch.\n            if (tries > 0 && operation.hasAspect(operation_1.Aspect.COMMAND_BATCHING)) {\n                operation.resetBatch();\n            }\n            return await operation.execute(server, session, timeoutContext);\n        }\n        catch (operationError) {\n            if (!(operationError instanceof error_1.MongoError))\n                throw operationError;\n            if (previousOperationError != null &&\n                operationError.hasErrorLabel(error_1.MongoErrorLabel.NoWritesPerformed)) {\n                throw previousOperationError;\n            }\n            previousServer = server.description;\n            previousOperationError = operationError;\n            // Reset timeouts\n            timeoutContext.clear();\n        }\n    }\n    throw (previousOperationError ??\n        new error_1.MongoRuntimeError('Tried to propagate retryability error, but no error was found.'));\n}\n//# sourceMappingURL=execute_operation.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLDBCQUEwQixtQkFBTyxDQUFDLGlIQUFvQjtBQUN0RCwyQkFBMkIsbUJBQU8sQ0FBQyw2SEFBMEI7QUFDN0Qsa0JBQWtCLG1CQUFPLENBQUMsaUdBQVk7QUFDdEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUVBQXlFO0FBQ3pFO0FBQ0EsbUVBQW1FO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3Qyx3QkFBd0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwR0FBMEcsb0JBQW9CO0FBQzlIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLG1EQUFtRDtBQUM1RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixrQkFBa0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLCtCQUErQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2V4ZWN1dGVfb3BlcmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5leGVjdXRlT3BlcmF0aW9uID0gZXhlY3V0ZU9wZXJhdGlvbjtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCBzZXJ2ZXJfc2VsZWN0aW9uXzEgPSByZXF1aXJlKFwiLi4vc2RhbS9zZXJ2ZXJfc2VsZWN0aW9uXCIpO1xuY29uc3QgdGltZW91dF8xID0gcmVxdWlyZShcIi4uL3RpbWVvdXRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG5jb25zdCBNTUFQdjFfUkVUUllfV1JJVEVTX0VSUk9SX0NPREUgPSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuSWxsZWdhbE9wZXJhdGlvbjtcbmNvbnN0IE1NQVB2MV9SRVRSWV9XUklURVNfRVJST1JfTUVTU0FHRSA9ICdUaGlzIE1vbmdvREIgZGVwbG95bWVudCBkb2VzIG5vdCBzdXBwb3J0IHJldHJ5YWJsZSB3cml0ZXMuIFBsZWFzZSBhZGQgcmV0cnlXcml0ZXM9ZmFsc2UgdG8geW91ciBjb25uZWN0aW9uIHN0cmluZy4nO1xuLyoqXG4gKiBFeGVjdXRlcyB0aGUgZ2l2ZW4gb3BlcmF0aW9uIHdpdGggcHJvdmlkZWQgYXJndW1lbnRzLlxuICogQGludGVybmFsXG4gKlxuICogQHJlbWFya3NcbiAqIEFsbG93cyBmb3IgYSBzaW5nbGUgcG9pbnQgb2YgZW50cnkgdG8gcHJvdmlkZSBmZWF0dXJlcyBzdWNoIGFzIGltcGxpY2l0IHNlc3Npb25zLCB3aGljaFxuICogYXJlIHJlcXVpcmVkIGJ5IHRoZSBEcml2ZXIgU2Vzc2lvbnMgc3BlY2lmaWNhdGlvbiBpbiB0aGUgZXZlbnQgdGhhdCBhIENsaWVudFNlc3Npb24gaXNcbiAqIG5vdCBwcm92aWRlZC5cbiAqXG4gKiBUaGUgZXhwZWN0YXRpb24gaXMgdGhhdCB0aGlzIGZ1bmN0aW9uOlxuICogLSBDb25uZWN0cyB0aGUgTW9uZ29DbGllbnQgaWYgaXQgaGFzIG5vdCBhbHJlYWR5IGJlZW4gY29ubmVjdGVkLCBzZWUge0BsaW5rIGF1dG9Db25uZWN0fVxuICogLSBDcmVhdGVzIGEgc2Vzc2lvbiBpZiBub25lIGlzIHByb3ZpZGVkIGFuZCBjbGVhbnMgdXAgdGhlIHNlc3Npb24gaXQgY3JlYXRlc1xuICogLSBUcmllcyBhbiBvcGVyYXRpb24gYW5kIHJldHJpZXMgdW5kZXIgY2VydGFpbiBjb25kaXRpb25zLCBzZWUge0BsaW5rIHRyeU9wZXJhdGlvbn1cbiAqXG4gKiBAdHlwZVBhcmFtIFQgLSBUaGUgb3BlcmF0aW9uJ3MgdHlwZVxuICogQHR5cGVQYXJhbSBUUmVzdWx0IC0gVGhlIHR5cGUgb2YgdGhlIG9wZXJhdGlvbidzIHJlc3VsdCwgY2FsY3VsYXRlZCBmcm9tIFRcbiAqXG4gKiBAcGFyYW0gY2xpZW50IC0gVGhlIE1vbmdvQ2xpZW50IHRvIGV4ZWN1dGUgdGhpcyBvcGVyYXRpb24gd2l0aFxuICogQHBhcmFtIG9wZXJhdGlvbiAtIFRoZSBvcGVyYXRpb24gdG8gZXhlY3V0ZVxuICovXG5hc3luYyBmdW5jdGlvbiBleGVjdXRlT3BlcmF0aW9uKGNsaWVudCwgb3BlcmF0aW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgIGlmICghKG9wZXJhdGlvbiBpbnN0YW5jZW9mIG9wZXJhdGlvbl8xLkFic3RyYWN0T3BlcmF0aW9uKSkge1xuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IEV4dGVuZCBNb25nb1J1bnRpbWVFcnJvclxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignVGhpcyBtZXRob2QgcmVxdWlyZXMgYSB2YWxpZCBvcGVyYXRpb24gaW5zdGFuY2UnKTtcbiAgICB9XG4gICAgY29uc3QgdG9wb2xvZ3kgPSBjbGllbnQudG9wb2xvZ3kgPT0gbnVsbFxuICAgICAgICA/IGF3YWl0ICgwLCB1dGlsc18xLmFib3J0YWJsZSkoYXV0b0Nvbm5lY3QoY2xpZW50KSwgb3BlcmF0aW9uLm9wdGlvbnMpXG4gICAgICAgIDogY2xpZW50LnRvcG9sb2d5O1xuICAgIC8vIFRoZSBkcml2ZXIgc2Vzc2lvbnMgc3BlYyBtYW5kYXRlcyB0aGF0IHdlIGltcGxpY2l0bHkgY3JlYXRlIHNlc3Npb25zIGZvciBvcGVyYXRpb25zXG4gICAgLy8gdGhhdCBhcmUgbm90IGV4cGxpY2l0bHkgcHJvdmlkZWQgd2l0aCBhIHNlc3Npb24uXG4gICAgbGV0IHNlc3Npb24gPSBvcGVyYXRpb24uc2Vzc2lvbjtcbiAgICBsZXQgb3duZXI7XG4gICAgaWYgKHNlc3Npb24gPT0gbnVsbCkge1xuICAgICAgICBvd25lciA9IFN5bWJvbCgpO1xuICAgICAgICBzZXNzaW9uID0gY2xpZW50LnN0YXJ0U2Vzc2lvbih7IG93bmVyLCBleHBsaWNpdDogZmFsc2UgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlc3Npb24uaGFzRW5kZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29FeHBpcmVkU2Vzc2lvbkVycm9yKCdVc2Ugb2YgZXhwaXJlZCBzZXNzaW9ucyBpcyBub3QgcGVybWl0dGVkJyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlc3Npb24uc25hcHNob3RFbmFibGVkICYmICF0b3BvbG9neS5jYXBhYmlsaXRpZXMuc3VwcG9ydHNTbmFwc2hvdFJlYWRzKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKCdTbmFwc2hvdCByZWFkcyByZXF1aXJlIE1vbmdvREIgNS4wIG9yIGxhdGVyJyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlc3Npb24uY2xpZW50ICE9PSBjbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ2xpZW50U2Vzc2lvbiBtdXN0IGJlIGZyb20gdGhlIHNhbWUgTW9uZ29DbGllbnQnKTtcbiAgICB9XG4gICAgY29uc3QgcmVhZFByZWZlcmVuY2UgPSBvcGVyYXRpb24ucmVhZFByZWZlcmVuY2UgPz8gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeTtcbiAgICBjb25zdCBpblRyYW5zYWN0aW9uID0gISFzZXNzaW9uPy5pblRyYW5zYWN0aW9uKCk7XG4gICAgY29uc3QgaGFzUmVhZEFzcGVjdCA9IG9wZXJhdGlvbi5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LlJFQURfT1BFUkFUSU9OKTtcbiAgICBpZiAoaW5UcmFuc2FjdGlvbiAmJlxuICAgICAgICAhcmVhZFByZWZlcmVuY2UuZXF1YWxzKHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnkpICYmXG4gICAgICAgIChoYXNSZWFkQXNwZWN0IHx8IG9wZXJhdGlvbi5jb21tYW5kTmFtZSA9PT0gJ3J1bkNvbW1hbmQnKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoYFJlYWQgcHJlZmVyZW5jZSBpbiBhIHRyYW5zYWN0aW9uIG11c3QgYmUgcHJpbWFyeSwgbm90OiAke3JlYWRQcmVmZXJlbmNlLm1vZGV9YCk7XG4gICAgfVxuICAgIGlmIChzZXNzaW9uPy5pc1Bpbm5lZCAmJiBzZXNzaW9uLnRyYW5zYWN0aW9uLmlzQ29tbWl0dGVkICYmICFvcGVyYXRpb24uYnlwYXNzUGlubmluZ0NoZWNrKSB7XG4gICAgICAgIHNlc3Npb24udW5waW4oKTtcbiAgICB9XG4gICAgdGltZW91dENvbnRleHQgPz89IHRpbWVvdXRfMS5UaW1lb3V0Q29udGV4dC5jcmVhdGUoe1xuICAgICAgICBzZXNzaW9uLFxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IGNsaWVudC5zLm9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TLFxuICAgICAgICB3YWl0UXVldWVUaW1lb3V0TVM6IGNsaWVudC5zLm9wdGlvbnMud2FpdFF1ZXVlVGltZW91dE1TLFxuICAgICAgICB0aW1lb3V0TVM6IG9wZXJhdGlvbi5vcHRpb25zLnRpbWVvdXRNU1xuICAgIH0pO1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0cnlPcGVyYXRpb24ob3BlcmF0aW9uLCB7XG4gICAgICAgICAgICB0b3BvbG9neSxcbiAgICAgICAgICAgIHRpbWVvdXRDb250ZXh0LFxuICAgICAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgaWYgKHNlc3Npb24/Lm93bmVyICE9IG51bGwgJiYgc2Vzc2lvbi5vd25lciA9PT0gb3duZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IHNlc3Npb24uZW5kU2Vzc2lvbigpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBDb25uZWN0cyBhIGNsaWVudCBpZiBpdCBoYXMgbm90IHlldCBiZWVuIGNvbm5lY3RlZFxuICogQGludGVybmFsXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGF1dG9Db25uZWN0KGNsaWVudCkge1xuICAgIGlmIChjbGllbnQudG9wb2xvZ3kgPT0gbnVsbCkge1xuICAgICAgICBpZiAoY2xpZW50LnMuaGFzQmVlbkNsb3NlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Ob3RDb25uZWN0ZWRFcnJvcignQ2xpZW50IG11c3QgYmUgY29ubmVjdGVkIGJlZm9yZSBydW5uaW5nIG9wZXJhdGlvbnMnKTtcbiAgICAgICAgfVxuICAgICAgICBjbGllbnQucy5vcHRpb25zLl9fc2tpcFBpbmdPbkNvbm5lY3QgPSB0cnVlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTtcbiAgICAgICAgICAgIGlmIChjbGllbnQudG9wb2xvZ3kgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdjbGllbnQuY29ubmVjdCBkaWQgbm90IGNyZWF0ZSBhIHRvcG9sb2d5IGJ1dCBhbHNvIGRpZCBub3QgdGhyb3cnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjbGllbnQudG9wb2xvZ3k7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBkZWxldGUgY2xpZW50LnMub3B0aW9ucy5fX3NraXBQaW5nT25Db25uZWN0O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjbGllbnQudG9wb2xvZ3k7XG59XG4vKipcbiAqIEV4ZWN1dGVzIGFuIG9wZXJhdGlvbiBhbmQgcmV0cmllcyBhcyBhcHByb3ByaWF0ZVxuICogQGludGVybmFsXG4gKlxuICogQHJlbWFya3NcbiAqIEltcGxlbWVudHMgYmVoYXZpb3VyIGRlc2NyaWJlZCBpbiBbUmV0cnlhYmxlIFJlYWRzXShodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2UvcmV0cnlhYmxlLXJlYWRzL3JldHJ5YWJsZS1yZWFkcy5tZCkgYW5kIFtSZXRyeWFibGVcbiAqIFdyaXRlc10oaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9tYXN0ZXIvc291cmNlL3JldHJ5YWJsZS13cml0ZXMvcmV0cnlhYmxlLXdyaXRlcy5tZCkgc3BlY2lmaWNhdGlvblxuICpcbiAqIFRoaXMgZnVuY3Rpb246XG4gKiAtIHBlcmZvcm1zIGluaXRpYWwgc2VydmVyIHNlbGVjdGlvblxuICogLSBhdHRlbXB0cyB0byBleGVjdXRlIGFuIG9wZXJhdGlvblxuICogLSByZXRyaWVzIHRoZSBvcGVyYXRpb24gaWYgaXQgbWVldHMgdGhlIGNyaXRlcmlhIGZvciBhIHJldHJ5YWJsZSByZWFkIG9yIGEgcmV0cnlhYmxlIHdyaXRlXG4gKlxuICogQHR5cGVQYXJhbSBUIC0gVGhlIG9wZXJhdGlvbidzIHR5cGVcbiAqIEB0eXBlUGFyYW0gVFJlc3VsdCAtIFRoZSB0eXBlIG9mIHRoZSBvcGVyYXRpb24ncyByZXN1bHQsIGNhbGN1bGF0ZWQgZnJvbSBUXG4gKlxuICogQHBhcmFtIG9wZXJhdGlvbiAtIFRoZSBvcGVyYXRpb24gdG8gZXhlY3V0ZVxuICogKi9cbmFzeW5jIGZ1bmN0aW9uIHRyeU9wZXJhdGlvbihvcGVyYXRpb24sIHsgdG9wb2xvZ3ksIHRpbWVvdXRDb250ZXh0LCBzZXNzaW9uLCByZWFkUHJlZmVyZW5jZSB9KSB7XG4gICAgbGV0IHNlbGVjdG9yO1xuICAgIGlmIChvcGVyYXRpb24uaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5NVVNUX1NFTEVDVF9TQU1FX1NFUlZFUikpIHtcbiAgICAgICAgLy8gR2V0TW9yZSBhbmQgS2lsbEN1cnNvciBvcGVyYXRpb25zIG11c3QgYWx3YXlzIHNlbGVjdCB0aGUgc2FtZSBzZXJ2ZXIsIGJ1dCBydW4gdGhyb3VnaFxuICAgICAgICAvLyBzZXJ2ZXIgc2VsZWN0aW9uIHRvIHBvdGVudGlhbGx5IGZvcmNlIG1vbml0b3IgY2hlY2tzIGlmIHRoZSBzZXJ2ZXIgaXNcbiAgICAgICAgLy8gaW4gYW4gdW5rbm93biBzdGF0ZS5cbiAgICAgICAgc2VsZWN0b3IgPSAoMCwgc2VydmVyX3NlbGVjdGlvbl8xLnNhbWVTZXJ2ZXJTZWxlY3Rvcikob3BlcmF0aW9uLnNlcnZlcj8uZGVzY3JpcHRpb24pO1xuICAgIH1cbiAgICBlbHNlIGlmIChvcGVyYXRpb24udHJ5U2Vjb25kYXJ5V3JpdGUpIHtcbiAgICAgICAgLy8gSWYgb3BlcmF0aW9uIHNob3VsZCB0cnkgdG8gd3JpdGUgdG8gc2Vjb25kYXJ5IHVzZSB0aGUgY3VzdG9tIHNlcnZlciBzZWxlY3RvclxuICAgICAgICAvLyBvdGhlcndpc2UgcHJvdmlkZSB0aGUgcmVhZCBwcmVmZXJlbmNlLlxuICAgICAgICBzZWxlY3RvciA9ICgwLCBzZXJ2ZXJfc2VsZWN0aW9uXzEuc2Vjb25kYXJ5V3JpdGFibGVTZXJ2ZXJTZWxlY3RvcikodG9wb2xvZ3kuY29tbW9uV2lyZVZlcnNpb24sIHJlYWRQcmVmZXJlbmNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNlbGVjdG9yID0gcmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGxldCBzZXJ2ZXIgPSBhd2FpdCB0b3BvbG9neS5zZWxlY3RTZXJ2ZXIoc2VsZWN0b3IsIHtcbiAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgb3BlcmF0aW9uTmFtZTogb3BlcmF0aW9uLmNvbW1hbmROYW1lLFxuICAgICAgICB0aW1lb3V0Q29udGV4dCxcbiAgICAgICAgc2lnbmFsOiBvcGVyYXRpb24ub3B0aW9ucy5zaWduYWxcbiAgICB9KTtcbiAgICBjb25zdCBoYXNSZWFkQXNwZWN0ID0gb3BlcmF0aW9uLmhhc0FzcGVjdChvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04pO1xuICAgIGNvbnN0IGhhc1dyaXRlQXNwZWN0ID0gb3BlcmF0aW9uLmhhc0FzcGVjdChvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OKTtcbiAgICBjb25zdCBpblRyYW5zYWN0aW9uID0gc2Vzc2lvbj8uaW5UcmFuc2FjdGlvbigpID8/IGZhbHNlO1xuICAgIGNvbnN0IHdpbGxSZXRyeVJlYWQgPSB0b3BvbG9neS5zLm9wdGlvbnMucmV0cnlSZWFkcyAmJiAhaW5UcmFuc2FjdGlvbiAmJiBvcGVyYXRpb24uY2FuUmV0cnlSZWFkO1xuICAgIGNvbnN0IHdpbGxSZXRyeVdyaXRlID0gdG9wb2xvZ3kucy5vcHRpb25zLnJldHJ5V3JpdGVzICYmXG4gICAgICAgICFpblRyYW5zYWN0aW9uICYmXG4gICAgICAgICgwLCB1dGlsc18xLnN1cHBvcnRzUmV0cnlhYmxlV3JpdGVzKShzZXJ2ZXIpICYmXG4gICAgICAgIG9wZXJhdGlvbi5jYW5SZXRyeVdyaXRlO1xuICAgIGNvbnN0IHdpbGxSZXRyeSA9IG9wZXJhdGlvbi5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSkgJiZcbiAgICAgICAgc2Vzc2lvbiAhPSBudWxsICYmXG4gICAgICAgICgoaGFzUmVhZEFzcGVjdCAmJiB3aWxsUmV0cnlSZWFkKSB8fCAoaGFzV3JpdGVBc3BlY3QgJiYgd2lsbFJldHJ5V3JpdGUpKTtcbiAgICBpZiAoaGFzV3JpdGVBc3BlY3QgJiYgd2lsbFJldHJ5V3JpdGUgJiYgc2Vzc2lvbiAhPSBudWxsKSB7XG4gICAgICAgIG9wZXJhdGlvbi5vcHRpb25zLndpbGxSZXRyeVdyaXRlID0gdHJ1ZTtcbiAgICAgICAgc2Vzc2lvbi5pbmNyZW1lbnRUcmFuc2FjdGlvbk51bWJlcigpO1xuICAgIH1cbiAgICBjb25zdCBtYXhUcmllcyA9IHdpbGxSZXRyeSA/ICh0aW1lb3V0Q29udGV4dC5jc290RW5hYmxlZCgpID8gSW5maW5pdHkgOiAyKSA6IDE7XG4gICAgbGV0IHByZXZpb3VzT3BlcmF0aW9uRXJyb3I7XG4gICAgbGV0IHByZXZpb3VzU2VydmVyO1xuICAgIGZvciAobGV0IHRyaWVzID0gMDsgdHJpZXMgPCBtYXhUcmllczsgdHJpZXMrKykge1xuICAgICAgICBpZiAocHJldmlvdXNPcGVyYXRpb25FcnJvcikge1xuICAgICAgICAgICAgaWYgKGhhc1dyaXRlQXNwZWN0ICYmIHByZXZpb3VzT3BlcmF0aW9uRXJyb3IuY29kZSA9PT0gTU1BUHYxX1JFVFJZX1dSSVRFU19FUlJPUl9DT0RFKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IE1NQVB2MV9SRVRSWV9XUklURVNfRVJST1JfTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgZXJybXNnOiBNTUFQdjFfUkVUUllfV1JJVEVTX0VSUk9SX01FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3I6IHByZXZpb3VzT3BlcmF0aW9uRXJyb3JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcGVyYXRpb24uaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5DT01NQU5EX0JBVENISU5HKSAmJiAhb3BlcmF0aW9uLmNhblJldHJ5V3JpdGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBwcmV2aW91c09wZXJhdGlvbkVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc1dyaXRlQXNwZWN0ICYmICEoMCwgZXJyb3JfMS5pc1JldHJ5YWJsZVdyaXRlRXJyb3IpKHByZXZpb3VzT3BlcmF0aW9uRXJyb3IpKVxuICAgICAgICAgICAgICAgIHRocm93IHByZXZpb3VzT3BlcmF0aW9uRXJyb3I7XG4gICAgICAgICAgICBpZiAoaGFzUmVhZEFzcGVjdCAmJiAhKDAsIGVycm9yXzEuaXNSZXRyeWFibGVSZWFkRXJyb3IpKHByZXZpb3VzT3BlcmF0aW9uRXJyb3IpKVxuICAgICAgICAgICAgICAgIHRocm93IHByZXZpb3VzT3BlcmF0aW9uRXJyb3I7XG4gICAgICAgICAgICBpZiAocHJldmlvdXNPcGVyYXRpb25FcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IgJiZcbiAgICAgICAgICAgICAgICBvcGVyYXRpb24uaGFzQXNwZWN0KG9wZXJhdGlvbl8xLkFzcGVjdC5DVVJTT1JfQ1JFQVRJTkcpICYmXG4gICAgICAgICAgICAgICAgc2Vzc2lvbiAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5pc1Bpbm5lZCAmJlxuICAgICAgICAgICAgICAgICFzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgICAgIHNlc3Npb24udW5waW4oeyBmb3JjZTogdHJ1ZSwgZm9yY2VDbGVhcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlcnZlciA9IGF3YWl0IHRvcG9sb2d5LnNlbGVjdFNlcnZlcihzZWxlY3Rvciwge1xuICAgICAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uTmFtZTogb3BlcmF0aW9uLmNvbW1hbmROYW1lLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzU2VydmVyLFxuICAgICAgICAgICAgICAgIHNpZ25hbDogb3BlcmF0aW9uLm9wdGlvbnMuc2lnbmFsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChoYXNXcml0ZUFzcGVjdCAmJiAhKDAsIHV0aWxzXzEuc3VwcG9ydHNSZXRyeWFibGVXcml0ZXMpKHNlcnZlcikpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKCdTZWxlY3RlZCBzZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCByZXRyeWFibGUgd3JpdGVzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIElmIHRyaWVzID4gMCBhbmQgd2UgYXJlIGNvbW1hbmQgYmF0Y2hpbmcgd2UgbmVlZCB0byByZXNldCB0aGUgYmF0Y2guXG4gICAgICAgICAgICBpZiAodHJpZXMgPiAwICYmIG9wZXJhdGlvbi5oYXNBc3BlY3Qob3BlcmF0aW9uXzEuQXNwZWN0LkNPTU1BTkRfQkFUQ0hJTkcpKSB7XG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uLnJlc2V0QmF0Y2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBvcGVyYXRpb24uZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAob3BlcmF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAgIGlmICghKG9wZXJhdGlvbkVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBvcGVyYXRpb25FcnJvcjtcbiAgICAgICAgICAgIGlmIChwcmV2aW91c09wZXJhdGlvbkVycm9yICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25FcnJvci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLk5vV3JpdGVzUGVyZm9ybWVkKSkge1xuICAgICAgICAgICAgICAgIHRocm93IHByZXZpb3VzT3BlcmF0aW9uRXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcmV2aW91c1NlcnZlciA9IHNlcnZlci5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHByZXZpb3VzT3BlcmF0aW9uRXJyb3IgPSBvcGVyYXRpb25FcnJvcjtcbiAgICAgICAgICAgIC8vIFJlc2V0IHRpbWVvdXRzXG4gICAgICAgICAgICB0aW1lb3V0Q29udGV4dC5jbGVhcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRocm93IChwcmV2aW91c09wZXJhdGlvbkVycm9yID8/XG4gICAgICAgIG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdUcmllZCB0byBwcm9wYWdhdGUgcmV0cnlhYmlsaXR5IGVycm9yLCBidXQgbm8gZXJyb3Igd2FzIGZvdW5kLicpKTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV4ZWN1dGVfb3BlcmF0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FindOperation = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst explain_1 = __webpack_require__(/*! ../explain */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/explain.js\");\nconst read_concern_1 = __webpack_require__(/*! ../read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst sort_1 = __webpack_require__(/*! ../sort */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sort.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass FindOperation extends command_1.CommandOperation {\n    constructor(ns, filter = {}, options = {}) {\n        super(undefined, options);\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        this.ns = ns;\n        if (typeof filter !== 'object' || Array.isArray(filter)) {\n            throw new error_1.MongoInvalidArgumentError('Query filter must be a plain object or ObjectId');\n        }\n        // special case passing in an ObjectId as a filter\n        this.filter = filter != null && filter._bsontype === 'ObjectId' ? { _id: filter } : filter;\n    }\n    get commandName() {\n        return 'find';\n    }\n    async execute(server, session, timeoutContext) {\n        this.server = server;\n        const options = this.options;\n        let findCommand = makeFindCommand(this.ns, this.filter, options);\n        if (this.explain) {\n            (0, explain_1.validateExplainTimeoutOptions)(this.options, this.explain);\n            findCommand = (0, explain_1.decorateWithExplain)(findCommand, this.explain);\n        }\n        return await server.command(this.ns, findCommand, {\n            ...this.options,\n            ...this.bsonOptions,\n            documentsReturnedIn: 'firstBatch',\n            session,\n            timeoutContext\n        }, this.explain ? responses_1.ExplainedCursorResponse : responses_1.CursorResponse);\n    }\n}\nexports.FindOperation = FindOperation;\nfunction makeFindCommand(ns, filter, options) {\n    const findCommand = {\n        find: ns.collection,\n        filter\n    };\n    if (options.sort) {\n        findCommand.sort = (0, sort_1.formatSort)(options.sort);\n    }\n    if (options.projection) {\n        let projection = options.projection;\n        if (projection && Array.isArray(projection)) {\n            projection = projection.length\n                ? projection.reduce((result, field) => {\n                    result[field] = 1;\n                    return result;\n                }, {})\n                : { _id: 1 };\n        }\n        findCommand.projection = projection;\n    }\n    if (options.hint) {\n        findCommand.hint = (0, utils_1.normalizeHintField)(options.hint);\n    }\n    if (typeof options.skip === 'number') {\n        findCommand.skip = options.skip;\n    }\n    if (typeof options.limit === 'number') {\n        if (options.limit < 0) {\n            findCommand.limit = -options.limit;\n            findCommand.singleBatch = true;\n        }\n        else {\n            findCommand.limit = options.limit;\n        }\n    }\n    if (typeof options.batchSize === 'number') {\n        if (options.batchSize < 0) {\n            if (options.limit &&\n                options.limit !== 0 &&\n                Math.abs(options.batchSize) < Math.abs(options.limit)) {\n                findCommand.limit = -options.batchSize;\n            }\n            findCommand.singleBatch = true;\n        }\n        else {\n            findCommand.batchSize = options.batchSize;\n        }\n    }\n    if (typeof options.singleBatch === 'boolean') {\n        findCommand.singleBatch = options.singleBatch;\n    }\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if (options.comment !== undefined) {\n        findCommand.comment = options.comment;\n    }\n    if (typeof options.maxTimeMS === 'number') {\n        findCommand.maxTimeMS = options.maxTimeMS;\n    }\n    const readConcern = read_concern_1.ReadConcern.fromOptions(options);\n    if (readConcern) {\n        findCommand.readConcern = readConcern.toJSON();\n    }\n    if (options.max) {\n        findCommand.max = options.max;\n    }\n    if (options.min) {\n        findCommand.min = options.min;\n    }\n    if (typeof options.returnKey === 'boolean') {\n        findCommand.returnKey = options.returnKey;\n    }\n    if (typeof options.showRecordId === 'boolean') {\n        findCommand.showRecordId = options.showRecordId;\n    }\n    if (typeof options.tailable === 'boolean') {\n        findCommand.tailable = options.tailable;\n    }\n    if (typeof options.oplogReplay === 'boolean') {\n        findCommand.oplogReplay = options.oplogReplay;\n    }\n    if (typeof options.timeout === 'boolean') {\n        findCommand.noCursorTimeout = !options.timeout;\n    }\n    else if (typeof options.noCursorTimeout === 'boolean') {\n        findCommand.noCursorTimeout = options.noCursorTimeout;\n    }\n    if (typeof options.awaitData === 'boolean') {\n        findCommand.awaitData = options.awaitData;\n    }\n    if (typeof options.allowPartialResults === 'boolean') {\n        findCommand.allowPartialResults = options.allowPartialResults;\n    }\n    if (options.collation) {\n        findCommand.collation = options.collation;\n    }\n    if (typeof options.allowDiskUse === 'boolean') {\n        findCommand.allowDiskUse = options.allowDiskUse;\n    }\n    if (options.let) {\n        findCommand.let = options.let;\n    }\n    return findCommand;\n}\n(0, operation_1.defineAspects)(FindOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=find.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZmluZC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxxQkFBcUI7QUFDckIsb0JBQW9CLG1CQUFPLENBQUMsMklBQWlDO0FBQzdELGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLGlHQUFZO0FBQ3RDLHVCQUF1QixtQkFBTyxDQUFDLDJHQUFpQjtBQUNoRCxlQUFlLG1CQUFPLENBQUMsMkZBQVM7QUFDaEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBLCtCQUErQixjQUFjO0FBQzdDO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSxjQUFjO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixJQUFJO0FBQ3JCLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZmluZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRmluZE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IHJlc3BvbnNlc18xID0gcmVxdWlyZShcIi4uL2NtYXAvd2lyZV9wcm90b2NvbC9yZXNwb25zZXNcIik7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgZXhwbGFpbl8xID0gcmVxdWlyZShcIi4uL2V4cGxhaW5cIik7XG5jb25zdCByZWFkX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi9yZWFkX2NvbmNlcm5cIik7XG5jb25zdCBzb3J0XzEgPSByZXF1aXJlKFwiLi4vc29ydFwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBGaW5kT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG5zLCBmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHsgLi4ub3B0aW9ucyB9O1xuICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLndyaXRlQ29uY2VybjtcbiAgICAgICAgdGhpcy5ucyA9IG5zO1xuICAgICAgICBpZiAodHlwZW9mIGZpbHRlciAhPT0gJ29iamVjdCcgfHwgQXJyYXkuaXNBcnJheShmaWx0ZXIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdRdWVyeSBmaWx0ZXIgbXVzdCBiZSBhIHBsYWluIG9iamVjdCBvciBPYmplY3RJZCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHNwZWNpYWwgY2FzZSBwYXNzaW5nIGluIGFuIE9iamVjdElkIGFzIGEgZmlsdGVyXG4gICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyICE9IG51bGwgJiYgZmlsdGVyLl9ic29udHlwZSA9PT0gJ09iamVjdElkJyA/IHsgX2lkOiBmaWx0ZXIgfSA6IGZpbHRlcjtcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ2ZpbmQnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIGxldCBmaW5kQ29tbWFuZCA9IG1ha2VGaW5kQ29tbWFuZCh0aGlzLm5zLCB0aGlzLmZpbHRlciwgb3B0aW9ucyk7XG4gICAgICAgIGlmICh0aGlzLmV4cGxhaW4pIHtcbiAgICAgICAgICAgICgwLCBleHBsYWluXzEudmFsaWRhdGVFeHBsYWluVGltZW91dE9wdGlvbnMpKHRoaXMub3B0aW9ucywgdGhpcy5leHBsYWluKTtcbiAgICAgICAgICAgIGZpbmRDb21tYW5kID0gKDAsIGV4cGxhaW5fMS5kZWNvcmF0ZVdpdGhFeHBsYWluKShmaW5kQ29tbWFuZCwgdGhpcy5leHBsYWluKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgc2VydmVyLmNvbW1hbmQodGhpcy5ucywgZmluZENvbW1hbmQsIHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnRoaXMuYnNvbk9wdGlvbnMsXG4gICAgICAgICAgICBkb2N1bWVudHNSZXR1cm5lZEluOiAnZmlyc3RCYXRjaCcsXG4gICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgdGltZW91dENvbnRleHRcbiAgICAgICAgfSwgdGhpcy5leHBsYWluID8gcmVzcG9uc2VzXzEuRXhwbGFpbmVkQ3Vyc29yUmVzcG9uc2UgOiByZXNwb25zZXNfMS5DdXJzb3JSZXNwb25zZSk7XG4gICAgfVxufVxuZXhwb3J0cy5GaW5kT3BlcmF0aW9uID0gRmluZE9wZXJhdGlvbjtcbmZ1bmN0aW9uIG1ha2VGaW5kQ29tbWFuZChucywgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgY29uc3QgZmluZENvbW1hbmQgPSB7XG4gICAgICAgIGZpbmQ6IG5zLmNvbGxlY3Rpb24sXG4gICAgICAgIGZpbHRlclxuICAgIH07XG4gICAgaWYgKG9wdGlvbnMuc29ydCkge1xuICAgICAgICBmaW5kQ29tbWFuZC5zb3J0ID0gKDAsIHNvcnRfMS5mb3JtYXRTb3J0KShvcHRpb25zLnNvcnQpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5wcm9qZWN0aW9uKSB7XG4gICAgICAgIGxldCBwcm9qZWN0aW9uID0gb3B0aW9ucy5wcm9qZWN0aW9uO1xuICAgICAgICBpZiAocHJvamVjdGlvbiAmJiBBcnJheS5pc0FycmF5KHByb2plY3Rpb24pKSB7XG4gICAgICAgICAgICBwcm9qZWN0aW9uID0gcHJvamVjdGlvbi5sZW5ndGhcbiAgICAgICAgICAgICAgICA/IHByb2plY3Rpb24ucmVkdWNlKChyZXN1bHQsIGZpZWxkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtmaWVsZF0gPSAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgIH0sIHt9KVxuICAgICAgICAgICAgICAgIDogeyBfaWQ6IDEgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5kQ29tbWFuZC5wcm9qZWN0aW9uID0gcHJvamVjdGlvbjtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuaGludCkge1xuICAgICAgICBmaW5kQ29tbWFuZC5oaW50ID0gKDAsIHV0aWxzXzEubm9ybWFsaXplSGludEZpZWxkKShvcHRpb25zLmhpbnQpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuc2tpcCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgZmluZENvbW1hbmQuc2tpcCA9IG9wdGlvbnMuc2tpcDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmxpbWl0ID09PSAnbnVtYmVyJykge1xuICAgICAgICBpZiAob3B0aW9ucy5saW1pdCA8IDApIHtcbiAgICAgICAgICAgIGZpbmRDb21tYW5kLmxpbWl0ID0gLW9wdGlvbnMubGltaXQ7XG4gICAgICAgICAgICBmaW5kQ29tbWFuZC5zaW5nbGVCYXRjaCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmaW5kQ29tbWFuZC5saW1pdCA9IG9wdGlvbnMubGltaXQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmJhdGNoU2l6ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuYmF0Y2hTaXplIDwgMCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubGltaXQgJiZcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxpbWl0ICE9PSAwICYmXG4gICAgICAgICAgICAgICAgTWF0aC5hYnMob3B0aW9ucy5iYXRjaFNpemUpIDwgTWF0aC5hYnMob3B0aW9ucy5saW1pdCkpIHtcbiAgICAgICAgICAgICAgICBmaW5kQ29tbWFuZC5saW1pdCA9IC1vcHRpb25zLmJhdGNoU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmRDb21tYW5kLnNpbmdsZUJhdGNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZpbmRDb21tYW5kLmJhdGNoU2l6ZSA9IG9wdGlvbnMuYmF0Y2hTaXplO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5zaW5nbGVCYXRjaCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLnNpbmdsZUJhdGNoID0gb3B0aW9ucy5zaW5nbGVCYXRjaDtcbiAgICB9XG4gICAgLy8gd2UgY2hlY2sgZm9yIHVuZGVmaW5lZCBzcGVjaWZpY2FsbHkgaGVyZSB0byBhbGxvdyBmYWxzeSB2YWx1ZXNcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICBpZiAob3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZmluZENvbW1hbmQuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgZmluZENvbW1hbmQubWF4VGltZU1TID0gb3B0aW9ucy5tYXhUaW1lTVM7XG4gICAgfVxuICAgIGNvbnN0IHJlYWRDb25jZXJuID0gcmVhZF9jb25jZXJuXzEuUmVhZENvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgaWYgKHJlYWRDb25jZXJuKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLnJlYWRDb25jZXJuID0gcmVhZENvbmNlcm4udG9KU09OKCk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLm1heCkge1xuICAgICAgICBmaW5kQ29tbWFuZC5tYXggPSBvcHRpb25zLm1heDtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMubWluKSB7XG4gICAgICAgIGZpbmRDb21tYW5kLm1pbiA9IG9wdGlvbnMubWluO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMucmV0dXJuS2V5ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQucmV0dXJuS2V5ID0gb3B0aW9ucy5yZXR1cm5LZXk7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5zaG93UmVjb3JkSWQgPT09ICdib29sZWFuJykge1xuICAgICAgICBmaW5kQ29tbWFuZC5zaG93UmVjb3JkSWQgPSBvcHRpb25zLnNob3dSZWNvcmRJZDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnRhaWxhYmxlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQudGFpbGFibGUgPSBvcHRpb25zLnRhaWxhYmxlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMub3Bsb2dSZXBsYXkgPT09ICdib29sZWFuJykge1xuICAgICAgICBmaW5kQ29tbWFuZC5vcGxvZ1JlcGxheSA9IG9wdGlvbnMub3Bsb2dSZXBsYXk7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50aW1lb3V0ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQubm9DdXJzb3JUaW1lb3V0ID0gIW9wdGlvbnMudGltZW91dDtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMubm9DdXJzb3JUaW1lb3V0ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgZmluZENvbW1hbmQubm9DdXJzb3JUaW1lb3V0ID0gb3B0aW9ucy5ub0N1cnNvclRpbWVvdXQ7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5hd2FpdERhdGEgPT09ICdib29sZWFuJykge1xuICAgICAgICBmaW5kQ29tbWFuZC5hd2FpdERhdGEgPSBvcHRpb25zLmF3YWl0RGF0YTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmFsbG93UGFydGlhbFJlc3VsdHMgPT09ICdib29sZWFuJykge1xuICAgICAgICBmaW5kQ29tbWFuZC5hbGxvd1BhcnRpYWxSZXN1bHRzID0gb3B0aW9ucy5hbGxvd1BhcnRpYWxSZXN1bHRzO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5jb2xsYXRpb24pIHtcbiAgICAgICAgZmluZENvbW1hbmQuY29sbGF0aW9uID0gb3B0aW9ucy5jb2xsYXRpb247XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5hbGxvd0Rpc2tVc2UgPT09ICdib29sZWFuJykge1xuICAgICAgICBmaW5kQ29tbWFuZC5hbGxvd0Rpc2tVc2UgPSBvcHRpb25zLmFsbG93RGlza1VzZTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMubGV0KSB7XG4gICAgICAgIGZpbmRDb21tYW5kLmxldCA9IG9wdGlvbnMubGV0O1xuICAgIH1cbiAgICByZXR1cm4gZmluZENvbW1hbmQ7XG59XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRmluZE9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5FWFBMQUlOQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuQ1VSU09SX0NSRUFUSU5HXG5dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZpbmQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find_and_modify.js":
/*!**************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find_and_modify.js ***!
  \**************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.FindOneAndUpdateOperation = exports.FindOneAndReplaceOperation = exports.FindOneAndDeleteOperation = exports.FindAndModifyOperation = exports.ReturnDocument = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst sort_1 = __webpack_require__(/*! ../sort */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sort.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @public */\nexports.ReturnDocument = Object.freeze({\n    BEFORE: 'before',\n    AFTER: 'after'\n});\nfunction configureFindAndModifyCmdBaseUpdateOpts(cmdBase, options) {\n    cmdBase.new = options.returnDocument === exports.ReturnDocument.AFTER;\n    cmdBase.upsert = options.upsert === true;\n    if (options.bypassDocumentValidation === true) {\n        cmdBase.bypassDocumentValidation = options.bypassDocumentValidation;\n    }\n    return cmdBase;\n}\n/** @internal */\nclass FindAndModifyOperation extends command_1.CommandOperation {\n    constructor(collection, query, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.cmdBase = {\n            remove: false,\n            new: false,\n            upsert: false\n        };\n        options.includeResultMetadata ??= false;\n        const sort = (0, sort_1.formatSort)(options.sort);\n        if (sort) {\n            this.cmdBase.sort = sort;\n        }\n        if (options.projection) {\n            this.cmdBase.fields = options.projection;\n        }\n        if (options.maxTimeMS) {\n            this.cmdBase.maxTimeMS = options.maxTimeMS;\n        }\n        // Decorate the findAndModify command with the write Concern\n        if (options.writeConcern) {\n            this.cmdBase.writeConcern = options.writeConcern;\n        }\n        if (options.let) {\n            this.cmdBase.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            this.cmdBase.comment = options.comment;\n        }\n        // force primary read preference\n        this.readPreference = read_preference_1.ReadPreference.primary;\n        this.collection = collection;\n        this.query = query;\n    }\n    get commandName() {\n        return 'findAndModify';\n    }\n    async execute(server, session, timeoutContext) {\n        const coll = this.collection;\n        const query = this.query;\n        const options = { ...this.options, ...this.bsonOptions };\n        // Create findAndModify command object\n        const cmd = {\n            findAndModify: coll.collectionName,\n            query: query,\n            ...this.cmdBase\n        };\n        (0, utils_1.decorateWithCollation)(cmd, coll, options);\n        if (options.hint) {\n            // TODO: once this method becomes a CommandOperation we will have the server\n            // in place to check.\n            const unacknowledgedWrite = this.writeConcern?.w === 0;\n            if (unacknowledgedWrite || (0, utils_1.maxWireVersion)(server) < 8) {\n                throw new error_1.MongoCompatibilityError('The current topology does not support a hint on findAndModify commands');\n            }\n            cmd.hint = options.hint;\n        }\n        // Execute the command\n        const result = await super.executeCommand(server, session, cmd, timeoutContext);\n        return options.includeResultMetadata ? result : (result.value ?? null);\n    }\n}\nexports.FindAndModifyOperation = FindAndModifyOperation;\n/** @internal */\nclass FindOneAndDeleteOperation extends FindAndModifyOperation {\n    constructor(collection, filter, options) {\n        // Basic validation\n        if (filter == null || typeof filter !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n        }\n        super(collection, filter, options);\n        this.cmdBase.remove = true;\n    }\n}\nexports.FindOneAndDeleteOperation = FindOneAndDeleteOperation;\n/** @internal */\nclass FindOneAndReplaceOperation extends FindAndModifyOperation {\n    constructor(collection, filter, replacement, options) {\n        if (filter == null || typeof filter !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n        }\n        if (replacement == null || typeof replacement !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"replacement\" must be an object');\n        }\n        if ((0, utils_1.hasAtomicOperators)(replacement)) {\n            throw new error_1.MongoInvalidArgumentError('Replacement document must not contain atomic operators');\n        }\n        super(collection, filter, options);\n        this.cmdBase.update = replacement;\n        configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n    }\n}\nexports.FindOneAndReplaceOperation = FindOneAndReplaceOperation;\n/** @internal */\nclass FindOneAndUpdateOperation extends FindAndModifyOperation {\n    constructor(collection, filter, update, options) {\n        if (filter == null || typeof filter !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n        }\n        if (update == null || typeof update !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('Argument \"update\" must be an object');\n        }\n        if (!(0, utils_1.hasAtomicOperators)(update)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n        super(collection, filter, options);\n        this.cmdBase.update = update;\n        configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n        if (options.arrayFilters) {\n            this.cmdBase.arrayFilters = options.arrayFilters;\n        }\n    }\n}\nexports.FindOneAndUpdateOperation = FindOneAndUpdateOperation;\n(0, operation_1.defineAspects)(FindAndModifyOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE\n]);\n//# sourceMappingURL=find_and_modify.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZmluZF9hbmRfbW9kaWZ5LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlDQUFpQyxHQUFHLGtDQUFrQyxHQUFHLGlDQUFpQyxHQUFHLDhCQUE4QixHQUFHLHNCQUFzQjtBQUNwSyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQywwQkFBMEIsbUJBQU8sQ0FBQyxpSEFBb0I7QUFDdEQsZUFBZSxtQkFBTyxDQUFDLDJGQUFTO0FBQ2hDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZmluZF9hbmRfbW9kaWZ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5GaW5kT25lQW5kVXBkYXRlT3BlcmF0aW9uID0gZXhwb3J0cy5GaW5kT25lQW5kUmVwbGFjZU9wZXJhdGlvbiA9IGV4cG9ydHMuRmluZE9uZUFuZERlbGV0ZU9wZXJhdGlvbiA9IGV4cG9ydHMuRmluZEFuZE1vZGlmeU9wZXJhdGlvbiA9IGV4cG9ydHMuUmV0dXJuRG9jdW1lbnQgPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi4vcmVhZF9wcmVmZXJlbmNlXCIpO1xuY29uc3Qgc29ydF8xID0gcmVxdWlyZShcIi4uL3NvcnRcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuUmV0dXJuRG9jdW1lbnQgPSBPYmplY3QuZnJlZXplKHtcbiAgICBCRUZPUkU6ICdiZWZvcmUnLFxuICAgIEFGVEVSOiAnYWZ0ZXInXG59KTtcbmZ1bmN0aW9uIGNvbmZpZ3VyZUZpbmRBbmRNb2RpZnlDbWRCYXNlVXBkYXRlT3B0cyhjbWRCYXNlLCBvcHRpb25zKSB7XG4gICAgY21kQmFzZS5uZXcgPSBvcHRpb25zLnJldHVybkRvY3VtZW50ID09PSBleHBvcnRzLlJldHVybkRvY3VtZW50LkFGVEVSO1xuICAgIGNtZEJhc2UudXBzZXJ0ID0gb3B0aW9ucy51cHNlcnQgPT09IHRydWU7XG4gICAgaWYgKG9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uID09PSB0cnVlKSB7XG4gICAgICAgIGNtZEJhc2UuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uID0gb3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb247XG4gICAgfVxuICAgIHJldHVybiBjbWRCYXNlO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRmluZEFuZE1vZGlmeU9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBxdWVyeSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5jbWRCYXNlID0ge1xuICAgICAgICAgICAgcmVtb3ZlOiBmYWxzZSxcbiAgICAgICAgICAgIG5ldzogZmFsc2UsXG4gICAgICAgICAgICB1cHNlcnQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIG9wdGlvbnMuaW5jbHVkZVJlc3VsdE1ldGFkYXRhID8/PSBmYWxzZTtcbiAgICAgICAgY29uc3Qgc29ydCA9ICgwLCBzb3J0XzEuZm9ybWF0U29ydCkob3B0aW9ucy5zb3J0KTtcbiAgICAgICAgaWYgKHNvcnQpIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS5zb3J0ID0gc29ydDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5wcm9qZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNtZEJhc2UuZmllbGRzID0gb3B0aW9ucy5wcm9qZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLm1heFRpbWVNUykge1xuICAgICAgICAgICAgdGhpcy5jbWRCYXNlLm1heFRpbWVNUyA9IG9wdGlvbnMubWF4VGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIC8vIERlY29yYXRlIHRoZSBmaW5kQW5kTW9kaWZ5IGNvbW1hbmQgd2l0aCB0aGUgd3JpdGUgQ29uY2VyblxuICAgICAgICBpZiAob3B0aW9ucy53cml0ZUNvbmNlcm4pIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS53cml0ZUNvbmNlcm4gPSBvcHRpb25zLndyaXRlQ29uY2VybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5sZXQpIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS5sZXQgPSBvcHRpb25zLmxldDtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKG9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNtZEJhc2UuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICAvLyBmb3JjZSBwcmltYXJ5IHJlYWQgcHJlZmVyZW5jZVxuICAgICAgICB0aGlzLnJlYWRQcmVmZXJlbmNlID0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5O1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnZmluZEFuZE1vZGlmeSc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBjb2xsID0gdGhpcy5jb2xsZWN0aW9uO1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMucXVlcnk7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IC4uLnRoaXMub3B0aW9ucywgLi4udGhpcy5ic29uT3B0aW9ucyB9O1xuICAgICAgICAvLyBDcmVhdGUgZmluZEFuZE1vZGlmeSBjb21tYW5kIG9iamVjdFxuICAgICAgICBjb25zdCBjbWQgPSB7XG4gICAgICAgICAgICBmaW5kQW5kTW9kaWZ5OiBjb2xsLmNvbGxlY3Rpb25OYW1lLFxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgICAgLi4udGhpcy5jbWRCYXNlXG4gICAgICAgIH07XG4gICAgICAgICgwLCB1dGlsc18xLmRlY29yYXRlV2l0aENvbGxhdGlvbikoY21kLCBjb2xsLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuaGludCkge1xuICAgICAgICAgICAgLy8gVE9ETzogb25jZSB0aGlzIG1ldGhvZCBiZWNvbWVzIGEgQ29tbWFuZE9wZXJhdGlvbiB3ZSB3aWxsIGhhdmUgdGhlIHNlcnZlclxuICAgICAgICAgICAgLy8gaW4gcGxhY2UgdG8gY2hlY2suXG4gICAgICAgICAgICBjb25zdCB1bmFja25vd2xlZGdlZFdyaXRlID0gdGhpcy53cml0ZUNvbmNlcm4/LncgPT09IDA7XG4gICAgICAgICAgICBpZiAodW5hY2tub3dsZWRnZWRXcml0ZSB8fCAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikoc2VydmVyKSA8IDgpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcignVGhlIGN1cnJlbnQgdG9wb2xvZ3kgZG9lcyBub3Qgc3VwcG9ydCBhIGhpbnQgb24gZmluZEFuZE1vZGlmeSBjb21tYW5kcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY21kLmhpbnQgPSBvcHRpb25zLmhpbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRXhlY3V0ZSB0aGUgY29tbWFuZFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIGNtZCwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5pbmNsdWRlUmVzdWx0TWV0YWRhdGEgPyByZXN1bHQgOiAocmVzdWx0LnZhbHVlID8/IG51bGwpO1xuICAgIH1cbn1cbmV4cG9ydHMuRmluZEFuZE1vZGlmeU9wZXJhdGlvbiA9IEZpbmRBbmRNb2RpZnlPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBGaW5kT25lQW5kRGVsZXRlT3BlcmF0aW9uIGV4dGVuZHMgRmluZEFuZE1vZGlmeU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCBvcHRpb25zKSB7XG4gICAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb25cbiAgICAgICAgaWYgKGZpbHRlciA9PSBudWxsIHx8IHR5cGVvZiBmaWx0ZXIgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBcImZpbHRlclwiIG11c3QgYmUgYW4gb2JqZWN0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgZmlsdGVyLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5jbWRCYXNlLnJlbW92ZSA9IHRydWU7XG4gICAgfVxufVxuZXhwb3J0cy5GaW5kT25lQW5kRGVsZXRlT3BlcmF0aW9uID0gRmluZE9uZUFuZERlbGV0ZU9wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIEZpbmRPbmVBbmRSZXBsYWNlT3BlcmF0aW9uIGV4dGVuZHMgRmluZEFuZE1vZGlmeU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCByZXBsYWNlbWVudCwgb3B0aW9ucykge1xuICAgICAgICBpZiAoZmlsdGVyID09IG51bGwgfHwgdHlwZW9mIGZpbHRlciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0FyZ3VtZW50IFwiZmlsdGVyXCIgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVwbGFjZW1lbnQgPT0gbnVsbCB8fCB0eXBlb2YgcmVwbGFjZW1lbnQgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdBcmd1bWVudCBcInJlcGxhY2VtZW50XCIgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKShyZXBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JlcGxhY2VtZW50IGRvY3VtZW50IG11c3Qgbm90IGNvbnRhaW4gYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIGZpbHRlciwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY21kQmFzZS51cGRhdGUgPSByZXBsYWNlbWVudDtcbiAgICAgICAgY29uZmlndXJlRmluZEFuZE1vZGlmeUNtZEJhc2VVcGRhdGVPcHRzKHRoaXMuY21kQmFzZSwgb3B0aW9ucyk7XG4gICAgfVxufVxuZXhwb3J0cy5GaW5kT25lQW5kUmVwbGFjZU9wZXJhdGlvbiA9IEZpbmRPbmVBbmRSZXBsYWNlT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgRmluZE9uZUFuZFVwZGF0ZU9wZXJhdGlvbiBleHRlbmRzIEZpbmRBbmRNb2RpZnlPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGZpbHRlciwgdXBkYXRlLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCB8fCB0eXBlb2YgZmlsdGVyICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJmaWx0ZXJcIiBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1cGRhdGUgPT0gbnVsbCB8fCB0eXBlb2YgdXBkYXRlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJ1cGRhdGVcIiBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKSh1cGRhdGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdVcGRhdGUgZG9jdW1lbnQgcmVxdWlyZXMgYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIGZpbHRlciwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY21kQmFzZS51cGRhdGUgPSB1cGRhdGU7XG4gICAgICAgIGNvbmZpZ3VyZUZpbmRBbmRNb2RpZnlDbWRCYXNlVXBkYXRlT3B0cyh0aGlzLmNtZEJhc2UsIG9wdGlvbnMpO1xuICAgICAgICBpZiAob3B0aW9ucy5hcnJheUZpbHRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuY21kQmFzZS5hcnJheUZpbHRlcnMgPSBvcHRpb25zLmFycmF5RmlsdGVycztcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuRmluZE9uZUFuZFVwZGF0ZU9wZXJhdGlvbiA9IEZpbmRPbmVBbmRVcGRhdGVPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoRmluZEFuZE1vZGlmeU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuRVhQTEFJTkFCTEVcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmluZF9hbmRfbW9kaWZ5LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/find_and_modify.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/get_more.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/get_more.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.GetMoreOperation = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass GetMoreOperation extends operation_1.AbstractOperation {\n    constructor(ns, cursorId, server, options) {\n        super(options);\n        this.options = options;\n        this.ns = ns;\n        this.cursorId = cursorId;\n        this.server = server;\n    }\n    get commandName() {\n        return 'getMore';\n    }\n    /**\n     * Although there is a server already associated with the get more operation, the signature\n     * for execute passes a server so we will just use that one.\n     */\n    async execute(server, _session, timeoutContext) {\n        if (server !== this.server) {\n            throw new error_1.MongoRuntimeError('Getmore must run on the same server operation began on');\n        }\n        if (this.cursorId == null || this.cursorId.isZero()) {\n            throw new error_1.MongoRuntimeError('Unable to iterate cursor with no id');\n        }\n        const collection = this.ns.collection;\n        if (collection == null) {\n            // Cursors should have adopted the namespace returned by MongoDB\n            // which should always defined a collection name (even a pseudo one, ex. db.aggregate())\n            throw new error_1.MongoRuntimeError('A collection name must be determined before getMore');\n        }\n        const getMoreCmd = {\n            getMore: this.cursorId,\n            collection\n        };\n        if (typeof this.options.batchSize === 'number') {\n            getMoreCmd.batchSize = Math.abs(this.options.batchSize);\n        }\n        if (typeof this.options.maxAwaitTimeMS === 'number') {\n            getMoreCmd.maxTimeMS = this.options.maxAwaitTimeMS;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (this.options.comment !== undefined && (0, utils_1.maxWireVersion)(server) >= 9) {\n            getMoreCmd.comment = this.options.comment;\n        }\n        const commandOptions = {\n            returnFieldSelector: null,\n            documentsReturnedIn: 'nextBatch',\n            timeoutContext,\n            ...this.options\n        };\n        return await server.command(this.ns, getMoreCmd, commandOptions, responses_1.CursorResponse);\n    }\n}\nexports.GetMoreOperation = GetMoreOperation;\n(0, operation_1.defineAspects)(GetMoreOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.MUST_SELECT_SAME_SERVER]);\n//# sourceMappingURL=get_more.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvZ2V0X21vcmUuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLG9CQUFvQixtQkFBTyxDQUFDLDJJQUFpQztBQUM3RCxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2dldF9tb3JlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5HZXRNb3JlT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgcmVzcG9uc2VzXzEgPSByZXF1aXJlKFwiLi4vY21hcC93aXJlX3Byb3RvY29sL3Jlc3BvbnNlc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBHZXRNb3JlT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG5zLCBjdXJzb3JJZCwgc2VydmVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLm5zID0gbnM7XG4gICAgICAgIHRoaXMuY3Vyc29ySWQgPSBjdXJzb3JJZDtcbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdnZXRNb3JlJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWx0aG91Z2ggdGhlcmUgaXMgYSBzZXJ2ZXIgYWxyZWFkeSBhc3NvY2lhdGVkIHdpdGggdGhlIGdldCBtb3JlIG9wZXJhdGlvbiwgdGhlIHNpZ25hdHVyZVxuICAgICAqIGZvciBleGVjdXRlIHBhc3NlcyBhIHNlcnZlciBzbyB3ZSB3aWxsIGp1c3QgdXNlIHRoYXQgb25lLlxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBfc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgaWYgKHNlcnZlciAhPT0gdGhpcy5zZXJ2ZXIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdHZXRtb3JlIG11c3QgcnVuIG9uIHRoZSBzYW1lIHNlcnZlciBvcGVyYXRpb24gYmVnYW4gb24nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXJzb3JJZCA9PSBudWxsIHx8IHRoaXMuY3Vyc29ySWQuaXNaZXJvKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdVbmFibGUgdG8gaXRlcmF0ZSBjdXJzb3Igd2l0aCBubyBpZCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSB0aGlzLm5zLmNvbGxlY3Rpb247XG4gICAgICAgIGlmIChjb2xsZWN0aW9uID09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEN1cnNvcnMgc2hvdWxkIGhhdmUgYWRvcHRlZCB0aGUgbmFtZXNwYWNlIHJldHVybmVkIGJ5IE1vbmdvREJcbiAgICAgICAgICAgIC8vIHdoaWNoIHNob3VsZCBhbHdheXMgZGVmaW5lZCBhIGNvbGxlY3Rpb24gbmFtZSAoZXZlbiBhIHBzZXVkbyBvbmUsIGV4LiBkYi5hZ2dyZWdhdGUoKSlcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdBIGNvbGxlY3Rpb24gbmFtZSBtdXN0IGJlIGRldGVybWluZWQgYmVmb3JlIGdldE1vcmUnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBnZXRNb3JlQ21kID0ge1xuICAgICAgICAgICAgZ2V0TW9yZTogdGhpcy5jdXJzb3JJZCxcbiAgICAgICAgICAgIGNvbGxlY3Rpb25cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuYmF0Y2hTaXplID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgZ2V0TW9yZUNtZC5iYXRjaFNpemUgPSBNYXRoLmFicyh0aGlzLm9wdGlvbnMuYmF0Y2hTaXplKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5tYXhBd2FpdFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGdldE1vcmVDbWQubWF4VGltZU1TID0gdGhpcy5vcHRpb25zLm1heEF3YWl0VGltZU1TO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCAmJiAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikoc2VydmVyKSA+PSA5KSB7XG4gICAgICAgICAgICBnZXRNb3JlQ21kLmNvbW1lbnQgPSB0aGlzLm9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb21tYW5kT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHJldHVybkZpZWxkU2VsZWN0b3I6IG51bGwsXG4gICAgICAgICAgICBkb2N1bWVudHNSZXR1cm5lZEluOiAnbmV4dEJhdGNoJyxcbiAgICAgICAgICAgIHRpbWVvdXRDb250ZXh0LFxuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBhd2FpdCBzZXJ2ZXIuY29tbWFuZCh0aGlzLm5zLCBnZXRNb3JlQ21kLCBjb21tYW5kT3B0aW9ucywgcmVzcG9uc2VzXzEuQ3Vyc29yUmVzcG9uc2UpO1xuICAgIH1cbn1cbmV4cG9ydHMuR2V0TW9yZU9wZXJhdGlvbiA9IEdldE1vcmVPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoR2V0TW9yZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTiwgb3BlcmF0aW9uXzEuQXNwZWN0Lk1VU1RfU0VMRUNUX1NBTUVfU0VSVkVSXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1nZXRfbW9yZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/get_more.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListIndexesOperation = exports.DropIndexOperation = exports.CreateIndexesOperation = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\nconst VALID_INDEX_OPTIONS = new Set([\n    'background',\n    'unique',\n    'name',\n    'partialFilterExpression',\n    'sparse',\n    'hidden',\n    'expireAfterSeconds',\n    'storageEngine',\n    'collation',\n    'version',\n    // text indexes\n    'weights',\n    'default_language',\n    'language_override',\n    'textIndexVersion',\n    // 2d-sphere indexes\n    '2dsphereIndexVersion',\n    // 2d indexes\n    'bits',\n    'min',\n    'max',\n    // geoHaystack Indexes\n    'bucketSize',\n    // wildcard indexes\n    'wildcardProjection'\n]);\nfunction isIndexDirection(x) {\n    return (typeof x === 'number' || x === '2d' || x === '2dsphere' || x === 'text' || x === 'geoHaystack');\n}\nfunction isSingleIndexTuple(t) {\n    return Array.isArray(t) && t.length === 2 && isIndexDirection(t[1]);\n}\n/**\n * Converts an `IndexSpecification`, which can be specified in multiple formats, into a\n * valid `key` for the createIndexes command.\n */\nfunction constructIndexDescriptionMap(indexSpec) {\n    const key = new Map();\n    const indexSpecs = !Array.isArray(indexSpec) || isSingleIndexTuple(indexSpec) ? [indexSpec] : indexSpec;\n    // Iterate through array and handle different types\n    for (const spec of indexSpecs) {\n        if (typeof spec === 'string') {\n            key.set(spec, 1);\n        }\n        else if (Array.isArray(spec)) {\n            key.set(spec[0], spec[1] ?? 1);\n        }\n        else if (spec instanceof Map) {\n            for (const [property, value] of spec) {\n                key.set(property, value);\n            }\n        }\n        else if ((0, utils_1.isObject)(spec)) {\n            for (const [property, value] of Object.entries(spec)) {\n                key.set(property, value);\n            }\n        }\n    }\n    return key;\n}\n/**\n * Receives an index description and returns a modified index description which has had invalid options removed\n * from the description and has mapped the `version` option to the `v` option.\n */\nfunction resolveIndexDescription(description) {\n    const validProvidedOptions = Object.entries(description).filter(([optionName]) => VALID_INDEX_OPTIONS.has(optionName));\n    return Object.fromEntries(\n    // we support the `version` option, but the `createIndexes` command expects it to be the `v`\n    validProvidedOptions.map(([name, value]) => (name === 'version' ? ['v', value] : [name, value])));\n}\n/** @internal */\nclass CreateIndexesOperation extends command_1.CommandOperation {\n    constructor(parent, collectionName, indexes, options) {\n        super(parent, options);\n        this.options = options ?? {};\n        this.collectionName = collectionName;\n        this.indexes = indexes.map((userIndex) => {\n            // Ensure the key is a Map to preserve index key ordering\n            const key = userIndex.key instanceof Map ? userIndex.key : new Map(Object.entries(userIndex.key));\n            const name = userIndex.name ?? Array.from(key).flat().join('_');\n            const validIndexOptions = resolveIndexDescription(userIndex);\n            return {\n                ...validIndexOptions,\n                name,\n                key\n            };\n        });\n    }\n    static fromIndexDescriptionArray(parent, collectionName, indexes, options) {\n        return new CreateIndexesOperation(parent, collectionName, indexes, options);\n    }\n    static fromIndexSpecification(parent, collectionName, indexSpec, options = {}) {\n        const key = constructIndexDescriptionMap(indexSpec);\n        const description = { ...options, key };\n        return new CreateIndexesOperation(parent, collectionName, [description], options);\n    }\n    get commandName() {\n        return 'createIndexes';\n    }\n    async execute(server, session, timeoutContext) {\n        const options = this.options;\n        const indexes = this.indexes;\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const cmd = { createIndexes: this.collectionName, indexes };\n        if (options.commitQuorum != null) {\n            if (serverWireVersion < 9) {\n                throw new error_1.MongoCompatibilityError('Option `commitQuorum` for `createIndexes` not supported on servers < 4.4');\n            }\n            cmd.commitQuorum = options.commitQuorum;\n        }\n        // collation is set on each index, it should not be defined at the root\n        this.options.collation = undefined;\n        await super.executeCommand(server, session, cmd, timeoutContext);\n        const indexNames = indexes.map(index => index.name || '');\n        return indexNames;\n    }\n}\nexports.CreateIndexesOperation = CreateIndexesOperation;\n/** @internal */\nclass DropIndexOperation extends command_1.CommandOperation {\n    constructor(collection, indexName, options) {\n        super(collection, options);\n        this.options = options ?? {};\n        this.collection = collection;\n        this.indexName = indexName;\n    }\n    get commandName() {\n        return 'dropIndexes';\n    }\n    async execute(server, session, timeoutContext) {\n        const cmd = { dropIndexes: this.collection.collectionName, index: this.indexName };\n        return await super.executeCommand(server, session, cmd, timeoutContext);\n    }\n}\nexports.DropIndexOperation = DropIndexOperation;\n/** @internal */\nclass ListIndexesOperation extends command_1.CommandOperation {\n    constructor(collection, options) {\n        super(collection, options);\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        this.collectionNamespace = collection.s.namespace;\n    }\n    get commandName() {\n        return 'listIndexes';\n    }\n    async execute(server, session, timeoutContext) {\n        const serverWireVersion = (0, utils_1.maxWireVersion)(server);\n        const cursor = this.options.batchSize ? { batchSize: this.options.batchSize } : {};\n        const command = { listIndexes: this.collectionNamespace.collection, cursor };\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (serverWireVersion >= 9 && this.options.comment !== undefined) {\n            command.comment = this.options.comment;\n        }\n        return await super.executeCommand(server, session, command, timeoutContext, responses_1.CursorResponse);\n    }\n}\nexports.ListIndexesOperation = ListIndexesOperation;\n(0, operation_1.defineAspects)(ListIndexesOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n(0, operation_1.defineAspects)(CreateIndexesOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DropIndexOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=indexes.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvaW5kZXhlcy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw0QkFBNEIsR0FBRywwQkFBMEIsR0FBRyw4QkFBOEI7QUFDMUYsb0JBQW9CLG1CQUFPLENBQUMsMklBQWlDO0FBQzdELGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRjtBQUNqRjtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELG9DQUFvQztBQUN0RiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9pbmRleGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5MaXN0SW5kZXhlc09wZXJhdGlvbiA9IGV4cG9ydHMuRHJvcEluZGV4T3BlcmF0aW9uID0gZXhwb3J0cy5DcmVhdGVJbmRleGVzT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgcmVzcG9uc2VzXzEgPSByZXF1aXJlKFwiLi4vY21hcC93aXJlX3Byb3RvY29sL3Jlc3BvbnNlc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuY29uc3QgVkFMSURfSU5ERVhfT1BUSU9OUyA9IG5ldyBTZXQoW1xuICAgICdiYWNrZ3JvdW5kJyxcbiAgICAndW5pcXVlJyxcbiAgICAnbmFtZScsXG4gICAgJ3BhcnRpYWxGaWx0ZXJFeHByZXNzaW9uJyxcbiAgICAnc3BhcnNlJyxcbiAgICAnaGlkZGVuJyxcbiAgICAnZXhwaXJlQWZ0ZXJTZWNvbmRzJyxcbiAgICAnc3RvcmFnZUVuZ2luZScsXG4gICAgJ2NvbGxhdGlvbicsXG4gICAgJ3ZlcnNpb24nLFxuICAgIC8vIHRleHQgaW5kZXhlc1xuICAgICd3ZWlnaHRzJyxcbiAgICAnZGVmYXVsdF9sYW5ndWFnZScsXG4gICAgJ2xhbmd1YWdlX292ZXJyaWRlJyxcbiAgICAndGV4dEluZGV4VmVyc2lvbicsXG4gICAgLy8gMmQtc3BoZXJlIGluZGV4ZXNcbiAgICAnMmRzcGhlcmVJbmRleFZlcnNpb24nLFxuICAgIC8vIDJkIGluZGV4ZXNcbiAgICAnYml0cycsXG4gICAgJ21pbicsXG4gICAgJ21heCcsXG4gICAgLy8gZ2VvSGF5c3RhY2sgSW5kZXhlc1xuICAgICdidWNrZXRTaXplJyxcbiAgICAvLyB3aWxkY2FyZCBpbmRleGVzXG4gICAgJ3dpbGRjYXJkUHJvamVjdGlvbidcbl0pO1xuZnVuY3Rpb24gaXNJbmRleERpcmVjdGlvbih4KSB7XG4gICAgcmV0dXJuICh0eXBlb2YgeCA9PT0gJ251bWJlcicgfHwgeCA9PT0gJzJkJyB8fCB4ID09PSAnMmRzcGhlcmUnIHx8IHggPT09ICd0ZXh0JyB8fCB4ID09PSAnZ2VvSGF5c3RhY2snKTtcbn1cbmZ1bmN0aW9uIGlzU2luZ2xlSW5kZXhUdXBsZSh0KSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodCkgJiYgdC5sZW5ndGggPT09IDIgJiYgaXNJbmRleERpcmVjdGlvbih0WzFdKTtcbn1cbi8qKlxuICogQ29udmVydHMgYW4gYEluZGV4U3BlY2lmaWNhdGlvbmAsIHdoaWNoIGNhbiBiZSBzcGVjaWZpZWQgaW4gbXVsdGlwbGUgZm9ybWF0cywgaW50byBhXG4gKiB2YWxpZCBga2V5YCBmb3IgdGhlIGNyZWF0ZUluZGV4ZXMgY29tbWFuZC5cbiAqL1xuZnVuY3Rpb24gY29uc3RydWN0SW5kZXhEZXNjcmlwdGlvbk1hcChpbmRleFNwZWMpIHtcbiAgICBjb25zdCBrZXkgPSBuZXcgTWFwKCk7XG4gICAgY29uc3QgaW5kZXhTcGVjcyA9ICFBcnJheS5pc0FycmF5KGluZGV4U3BlYykgfHwgaXNTaW5nbGVJbmRleFR1cGxlKGluZGV4U3BlYykgPyBbaW5kZXhTcGVjXSA6IGluZGV4U3BlYztcbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYXJyYXkgYW5kIGhhbmRsZSBkaWZmZXJlbnQgdHlwZXNcbiAgICBmb3IgKGNvbnN0IHNwZWMgb2YgaW5kZXhTcGVjcykge1xuICAgICAgICBpZiAodHlwZW9mIHNwZWMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBrZXkuc2V0KHNwZWMsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc3BlYykpIHtcbiAgICAgICAgICAgIGtleS5zZXQoc3BlY1swXSwgc3BlY1sxXSA/PyAxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzcGVjIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtwcm9wZXJ0eSwgdmFsdWVdIG9mIHNwZWMpIHtcbiAgICAgICAgICAgICAgICBrZXkuc2V0KHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKDAsIHV0aWxzXzEuaXNPYmplY3QpKHNwZWMpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtwcm9wZXJ0eSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHNwZWMpKSB7XG4gICAgICAgICAgICAgICAga2V5LnNldChwcm9wZXJ0eSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBrZXk7XG59XG4vKipcbiAqIFJlY2VpdmVzIGFuIGluZGV4IGRlc2NyaXB0aW9uIGFuZCByZXR1cm5zIGEgbW9kaWZpZWQgaW5kZXggZGVzY3JpcHRpb24gd2hpY2ggaGFzIGhhZCBpbnZhbGlkIG9wdGlvbnMgcmVtb3ZlZFxuICogZnJvbSB0aGUgZGVzY3JpcHRpb24gYW5kIGhhcyBtYXBwZWQgdGhlIGB2ZXJzaW9uYCBvcHRpb24gdG8gdGhlIGB2YCBvcHRpb24uXG4gKi9cbmZ1bmN0aW9uIHJlc29sdmVJbmRleERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKSB7XG4gICAgY29uc3QgdmFsaWRQcm92aWRlZE9wdGlvbnMgPSBPYmplY3QuZW50cmllcyhkZXNjcmlwdGlvbikuZmlsdGVyKChbb3B0aW9uTmFtZV0pID0+IFZBTElEX0lOREVYX09QVElPTlMuaGFzKG9wdGlvbk5hbWUpKTtcbiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgIC8vIHdlIHN1cHBvcnQgdGhlIGB2ZXJzaW9uYCBvcHRpb24sIGJ1dCB0aGUgYGNyZWF0ZUluZGV4ZXNgIGNvbW1hbmQgZXhwZWN0cyBpdCB0byBiZSB0aGUgYHZgXG4gICAgdmFsaWRQcm92aWRlZE9wdGlvbnMubWFwKChbbmFtZSwgdmFsdWVdKSA9PiAobmFtZSA9PT0gJ3ZlcnNpb24nID8gWyd2JywgdmFsdWVdIDogW25hbWUsIHZhbHVlXSkpKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENyZWF0ZUluZGV4ZXNPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IocGFyZW50LCBjb2xsZWN0aW9uTmFtZSwgaW5kZXhlcywgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihwYXJlbnQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID0gY29sbGVjdGlvbk5hbWU7XG4gICAgICAgIHRoaXMuaW5kZXhlcyA9IGluZGV4ZXMubWFwKCh1c2VySW5kZXgpID0+IHtcbiAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUga2V5IGlzIGEgTWFwIHRvIHByZXNlcnZlIGluZGV4IGtleSBvcmRlcmluZ1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gdXNlckluZGV4LmtleSBpbnN0YW5jZW9mIE1hcCA/IHVzZXJJbmRleC5rZXkgOiBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKHVzZXJJbmRleC5rZXkpKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB1c2VySW5kZXgubmFtZSA/PyBBcnJheS5mcm9tKGtleSkuZmxhdCgpLmpvaW4oJ18nKTtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkSW5kZXhPcHRpb25zID0gcmVzb2x2ZUluZGV4RGVzY3JpcHRpb24odXNlckluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4udmFsaWRJbmRleE9wdGlvbnMsXG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbUluZGV4RGVzY3JpcHRpb25BcnJheShwYXJlbnQsIGNvbGxlY3Rpb25OYW1lLCBpbmRleGVzLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ3JlYXRlSW5kZXhlc09wZXJhdGlvbihwYXJlbnQsIGNvbGxlY3Rpb25OYW1lLCBpbmRleGVzLCBvcHRpb25zKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21JbmRleFNwZWNpZmljYXRpb24ocGFyZW50LCBjb2xsZWN0aW9uTmFtZSwgaW5kZXhTcGVjLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3Qga2V5ID0gY29uc3RydWN0SW5kZXhEZXNjcmlwdGlvbk1hcChpbmRleFNwZWMpO1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHsgLi4ub3B0aW9ucywga2V5IH07XG4gICAgICAgIHJldHVybiBuZXcgQ3JlYXRlSW5kZXhlc09wZXJhdGlvbihwYXJlbnQsIGNvbGxlY3Rpb25OYW1lLCBbZGVzY3JpcHRpb25dLCBvcHRpb25zKTtcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ2NyZWF0ZUluZGV4ZXMnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgY29uc3QgaW5kZXhlcyA9IHRoaXMuaW5kZXhlcztcbiAgICAgICAgY29uc3Qgc2VydmVyV2lyZVZlcnNpb24gPSAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikoc2VydmVyKTtcbiAgICAgICAgY29uc3QgY21kID0geyBjcmVhdGVJbmRleGVzOiB0aGlzLmNvbGxlY3Rpb25OYW1lLCBpbmRleGVzIH07XG4gICAgICAgIGlmIChvcHRpb25zLmNvbW1pdFF1b3J1bSAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAoc2VydmVyV2lyZVZlcnNpb24gPCA5KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoJ09wdGlvbiBgY29tbWl0UXVvcnVtYCBmb3IgYGNyZWF0ZUluZGV4ZXNgIG5vdCBzdXBwb3J0ZWQgb24gc2VydmVycyA8IDQuNCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY21kLmNvbW1pdFF1b3J1bSA9IG9wdGlvbnMuY29tbWl0UXVvcnVtO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbGxhdGlvbiBpcyBzZXQgb24gZWFjaCBpbmRleCwgaXQgc2hvdWxkIG5vdCBiZSBkZWZpbmVkIGF0IHRoZSByb290XG4gICAgICAgIHRoaXMub3B0aW9ucy5jb2xsYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY21kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIGNvbnN0IGluZGV4TmFtZXMgPSBpbmRleGVzLm1hcChpbmRleCA9PiBpbmRleC5uYW1lIHx8ICcnKTtcbiAgICAgICAgcmV0dXJuIGluZGV4TmFtZXM7XG4gICAgfVxufVxuZXhwb3J0cy5DcmVhdGVJbmRleGVzT3BlcmF0aW9uID0gQ3JlYXRlSW5kZXhlc09wZXJhdGlvbjtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BJbmRleE9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBpbmRleE5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMuaW5kZXhOYW1lID0gaW5kZXhOYW1lO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnZHJvcEluZGV4ZXMnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY21kID0geyBkcm9wSW5kZXhlczogdGhpcy5jb2xsZWN0aW9uLmNvbGxlY3Rpb25OYW1lLCBpbmRleDogdGhpcy5pbmRleE5hbWUgfTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY21kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgfVxufVxuZXhwb3J0cy5Ecm9wSW5kZXhPcGVyYXRpb24gPSBEcm9wSW5kZXhPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBMaXN0SW5kZXhlc09wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24sIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLm9wdGlvbnMgfTtcbiAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy53cml0ZUNvbmNlcm47XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk5hbWVzcGFjZSA9IGNvbGxlY3Rpb24ucy5uYW1lc3BhY2U7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdsaXN0SW5kZXhlcyc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBzZXJ2ZXJXaXJlVmVyc2lvbiA9ICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShzZXJ2ZXIpO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLm9wdGlvbnMuYmF0Y2hTaXplID8geyBiYXRjaFNpemU6IHRoaXMub3B0aW9ucy5iYXRjaFNpemUgfSA6IHt9O1xuICAgICAgICBjb25zdCBjb21tYW5kID0geyBsaXN0SW5kZXhlczogdGhpcy5jb2xsZWN0aW9uTmFtZXNwYWNlLmNvbGxlY3Rpb24sIGN1cnNvciB9O1xuICAgICAgICAvLyB3ZSBjaGVjayBmb3IgdW5kZWZpbmVkIHNwZWNpZmljYWxseSBoZXJlIHRvIGFsbG93IGZhbHN5IHZhbHVlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICAgICAgaWYgKHNlcnZlcldpcmVWZXJzaW9uID49IDkgJiYgdGhpcy5vcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tbWFuZC5jb21tZW50ID0gdGhpcy5vcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgdGltZW91dENvbnRleHQsIHJlc3BvbnNlc18xLkN1cnNvclJlc3BvbnNlKTtcbiAgICB9XG59XG5leHBvcnRzLkxpc3RJbmRleGVzT3BlcmF0aW9uID0gTGlzdEluZGV4ZXNPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoTGlzdEluZGV4ZXNPcGVyYXRpb24sIFtcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVBRF9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSxcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuQ1VSU09SX0NSRUFUSU5HXG5dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShDcmVhdGVJbmRleGVzT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKERyb3BJbmRleE9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4ZXMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/indexes.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/insert.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/insert.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.InsertManyOperation = exports.InsertOneOperation = exports.InsertOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst bulk_write_1 = __webpack_require__(/*! ./bulk_write */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/bulk_write.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass InsertOperation extends command_1.CommandOperation {\n    constructor(ns, documents, options) {\n        super(undefined, options);\n        this.options = { ...options, checkKeys: options.checkKeys ?? false };\n        this.ns = ns;\n        this.documents = documents;\n    }\n    get commandName() {\n        return 'insert';\n    }\n    async execute(server, session, timeoutContext) {\n        const options = this.options ?? {};\n        const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n        const command = {\n            insert: this.ns.collection,\n            documents: this.documents,\n            ordered\n        };\n        if (typeof options.bypassDocumentValidation === 'boolean') {\n            command.bypassDocumentValidation = options.bypassDocumentValidation;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        return await super.executeCommand(server, session, command, timeoutContext);\n    }\n}\nexports.InsertOperation = InsertOperation;\nclass InsertOneOperation extends InsertOperation {\n    constructor(collection, doc, options) {\n        super(collection.s.namespace, (0, utils_1.maybeAddIdToDocuments)(collection, [doc], options), options);\n    }\n    async execute(server, session, timeoutContext) {\n        const res = await super.execute(server, session, timeoutContext);\n        if (res.code)\n            throw new error_1.MongoServerError(res);\n        if (res.writeErrors) {\n            // This should be a WriteError but we can't change it now because of error hierarchy\n            throw new error_1.MongoServerError(res.writeErrors[0]);\n        }\n        return {\n            acknowledged: this.writeConcern?.w !== 0,\n            insertedId: this.documents[0]._id\n        };\n    }\n}\nexports.InsertOneOperation = InsertOneOperation;\n/** @internal */\nclass InsertManyOperation extends operation_1.AbstractOperation {\n    constructor(collection, docs, options) {\n        super(options);\n        if (!Array.isArray(docs)) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"docs\" must be an array of documents');\n        }\n        this.options = options;\n        this.collection = collection;\n        this.docs = docs;\n    }\n    get commandName() {\n        return 'insert';\n    }\n    async execute(server, session, timeoutContext) {\n        const coll = this.collection;\n        const options = { ...this.options, ...this.bsonOptions, readPreference: this.readPreference };\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        const bulkWriteOperation = new bulk_write_1.BulkWriteOperation(coll, this.docs.map(document => ({\n            insertOne: { document }\n        })), options);\n        try {\n            const res = await bulkWriteOperation.execute(server, session, timeoutContext);\n            return {\n                acknowledged: writeConcern?.w !== 0,\n                insertedCount: res.insertedCount,\n                insertedIds: res.insertedIds\n            };\n        }\n        catch (err) {\n            if (err && err.message === 'Operation must be an object with an operation key') {\n                throw new error_1.MongoInvalidArgumentError('Collection.insertMany() cannot be called with an array that has null/undefined values');\n            }\n            throw err;\n        }\n    }\n}\nexports.InsertManyOperation = InsertManyOperation;\n(0, operation_1.defineAspects)(InsertOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(InsertOneOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(InsertManyOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=insert.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvaW5zZXJ0LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDJCQUEyQixHQUFHLDBCQUEwQixHQUFHLHVCQUF1QjtBQUNsRixnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyx3QkFBd0IsbUJBQU8sQ0FBQyw2R0FBa0I7QUFDbEQscUJBQXFCLG1CQUFPLENBQUMsaUhBQWM7QUFDM0Msa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9pbnNlcnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkluc2VydE1hbnlPcGVyYXRpb24gPSBleHBvcnRzLkluc2VydE9uZU9wZXJhdGlvbiA9IGV4cG9ydHMuSW5zZXJ0T3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi4vd3JpdGVfY29uY2VyblwiKTtcbmNvbnN0IGJ1bGtfd3JpdGVfMSA9IHJlcXVpcmUoXCIuL2J1bGtfd3JpdGVcIik7XG5jb25zdCBjb21tYW5kXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBJbnNlcnRPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IobnMsIGRvY3VtZW50cywgb3B0aW9ucykge1xuICAgICAgICBzdXBlcih1bmRlZmluZWQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLm9wdGlvbnMsIGNoZWNrS2V5czogb3B0aW9ucy5jaGVja0tleXMgPz8gZmFsc2UgfTtcbiAgICAgICAgdGhpcy5ucyA9IG5zO1xuICAgICAgICB0aGlzLmRvY3VtZW50cyA9IGRvY3VtZW50cztcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ2luc2VydCc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zID8/IHt9O1xuICAgICAgICBjb25zdCBvcmRlcmVkID0gdHlwZW9mIG9wdGlvbnMub3JkZXJlZCA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5vcmRlcmVkIDogdHJ1ZTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIGluc2VydDogdGhpcy5ucy5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgZG9jdW1lbnRzOiB0aGlzLmRvY3VtZW50cyxcbiAgICAgICAgICAgIG9yZGVyZWRcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICBjb21tYW5kLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbiA9IG9wdGlvbnMuYnlwYXNzRG9jdW1lbnRWYWxpZGF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAob3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29tbWVudCA9IG9wdGlvbnMuY29tbWVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCBjb21tYW5kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgfVxufVxuZXhwb3J0cy5JbnNlcnRPcGVyYXRpb24gPSBJbnNlcnRPcGVyYXRpb247XG5jbGFzcyBJbnNlcnRPbmVPcGVyYXRpb24gZXh0ZW5kcyBJbnNlcnRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGRvYywgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLnMubmFtZXNwYWNlLCAoMCwgdXRpbHNfMS5tYXliZUFkZElkVG9Eb2N1bWVudHMpKGNvbGxlY3Rpb24sIFtkb2NdLCBvcHRpb25zKSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBzdXBlci5leGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICBpZiAocmVzLmNvZGUpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcyk7XG4gICAgICAgIGlmIChyZXMud3JpdGVFcnJvcnMpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIGJlIGEgV3JpdGVFcnJvciBidXQgd2UgY2FuJ3QgY2hhbmdlIGl0IG5vdyBiZWNhdXNlIG9mIGVycm9yIGhpZXJhcmNoeVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcihyZXMud3JpdGVFcnJvcnNbMF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhY2tub3dsZWRnZWQ6IHRoaXMud3JpdGVDb25jZXJuPy53ICE9PSAwLFxuICAgICAgICAgICAgaW5zZXJ0ZWRJZDogdGhpcy5kb2N1bWVudHNbMF0uX2lkXG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5JbnNlcnRPbmVPcGVyYXRpb24gPSBJbnNlcnRPbmVPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBJbnNlcnRNYW55T3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGRvY3MsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkb2NzKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJkb2NzXCIgbXVzdCBiZSBhbiBhcnJheSBvZiBkb2N1bWVudHMnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLmRvY3MgPSBkb2NzO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnaW5zZXJ0JztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbGwgPSB0aGlzLmNvbGxlY3Rpb247XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IC4uLnRoaXMub3B0aW9ucywgLi4udGhpcy5ic29uT3B0aW9ucywgcmVhZFByZWZlcmVuY2U6IHRoaXMucmVhZFByZWZlcmVuY2UgfTtcbiAgICAgICAgY29uc3Qgd3JpdGVDb25jZXJuID0gd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgY29uc3QgYnVsa1dyaXRlT3BlcmF0aW9uID0gbmV3IGJ1bGtfd3JpdGVfMS5CdWxrV3JpdGVPcGVyYXRpb24oY29sbCwgdGhpcy5kb2NzLm1hcChkb2N1bWVudCA9PiAoe1xuICAgICAgICAgICAgaW5zZXJ0T25lOiB7IGRvY3VtZW50IH1cbiAgICAgICAgfSkpLCBvcHRpb25zKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGJ1bGtXcml0ZU9wZXJhdGlvbi5leGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBhY2tub3dsZWRnZWQ6IHdyaXRlQ29uY2Vybj8udyAhPT0gMCxcbiAgICAgICAgICAgICAgICBpbnNlcnRlZENvdW50OiByZXMuaW5zZXJ0ZWRDb3VudCxcbiAgICAgICAgICAgICAgICBpbnNlcnRlZElkczogcmVzLmluc2VydGVkSWRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIgJiYgZXJyLm1lc3NhZ2UgPT09ICdPcGVyYXRpb24gbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCBhbiBvcGVyYXRpb24ga2V5Jykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0NvbGxlY3Rpb24uaW5zZXJ0TWFueSgpIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCBhbiBhcnJheSB0aGF0IGhhcyBudWxsL3VuZGVmaW5lZCB2YWx1ZXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuSW5zZXJ0TWFueU9wZXJhdGlvbiA9IEluc2VydE1hbnlPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoSW5zZXJ0T3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRSwgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKEluc2VydE9uZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShJbnNlcnRNYW55T3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5zZXJ0LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/insert.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/is_capped.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/is_capped.js ***!
  \********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.IsCappedOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass IsCappedOperation extends operation_1.AbstractOperation {\n    constructor(collection, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n    }\n    get commandName() {\n        return 'listCollections';\n    }\n    async execute(server, session) {\n        const coll = this.collection;\n        const [collection] = await coll.s.db\n            .listCollections({ name: coll.collectionName }, { ...this.options, nameOnly: false, readPreference: this.readPreference, session })\n            .toArray();\n        if (collection == null || collection.options == null) {\n            throw new error_1.MongoAPIError(`collection ${coll.namespace} not found`);\n        }\n        return !!collection.options?.capped;\n    }\n}\nexports.IsCappedOperation = IsCappedOperation;\n//# sourceMappingURL=is_capped.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvaXNfY2FwcGVkLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QjtBQUN6QixnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiwyQkFBMkIsSUFBSSxnRkFBZ0Y7QUFDOUk7QUFDQTtBQUNBLDBEQUEwRCxnQkFBZ0I7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2lzX2NhcHBlZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSXNDYXBwZWRPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBJc0NhcHBlZE9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnbGlzdENvbGxlY3Rpb25zJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24pIHtcbiAgICAgICAgY29uc3QgY29sbCA9IHRoaXMuY29sbGVjdGlvbjtcbiAgICAgICAgY29uc3QgW2NvbGxlY3Rpb25dID0gYXdhaXQgY29sbC5zLmRiXG4gICAgICAgICAgICAubGlzdENvbGxlY3Rpb25zKHsgbmFtZTogY29sbC5jb2xsZWN0aW9uTmFtZSB9LCB7IC4uLnRoaXMub3B0aW9ucywgbmFtZU9ubHk6IGZhbHNlLCByZWFkUHJlZmVyZW5jZTogdGhpcy5yZWFkUHJlZmVyZW5jZSwgc2Vzc2lvbiB9KVxuICAgICAgICAgICAgLnRvQXJyYXkoKTtcbiAgICAgICAgaWYgKGNvbGxlY3Rpb24gPT0gbnVsbCB8fCBjb2xsZWN0aW9uLm9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29BUElFcnJvcihgY29sbGVjdGlvbiAke2NvbGwubmFtZXNwYWNlfSBub3QgZm91bmRgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gISFjb2xsZWN0aW9uLm9wdGlvbnM/LmNhcHBlZDtcbiAgICB9XG59XG5leHBvcnRzLklzQ2FwcGVkT3BlcmF0aW9uID0gSXNDYXBwZWRPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pc19jYXBwZWQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/is_capped.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/kill_cursors.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/kill_cursors.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.KillCursorsOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\nclass KillCursorsOperation extends operation_1.AbstractOperation {\n    constructor(cursorId, ns, server, options) {\n        super(options);\n        this.ns = ns;\n        this.cursorId = cursorId;\n        this.server = server;\n    }\n    get commandName() {\n        return 'killCursors';\n    }\n    async execute(server, session, timeoutContext) {\n        if (server !== this.server) {\n            throw new error_1.MongoRuntimeError('Killcursor must run on the same server operation began on');\n        }\n        const killCursors = this.ns.collection;\n        if (killCursors == null) {\n            // Cursors should have adopted the namespace returned by MongoDB\n            // which should always defined a collection name (even a pseudo one, ex. db.aggregate())\n            throw new error_1.MongoRuntimeError('A collection name must be determined before killCursors');\n        }\n        const killCursorsCommand = {\n            killCursors,\n            cursors: [this.cursorId]\n        };\n        try {\n            await server.command(this.ns, killCursorsCommand, {\n                session,\n                timeoutContext\n            });\n        }\n        catch (error) {\n            // The driver should never emit errors from killCursors, this is spec-ed behavior\n            (0, utils_1.squashError)(error);\n        }\n    }\n}\nexports.KillCursorsOperation = KillCursorsOperation;\n(0, operation_1.defineAspects)(KillCursorsOperation, [operation_1.Aspect.MUST_SELECT_SAME_SERVER]);\n//# sourceMappingURL=kill_cursors.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMva2lsbF9jdXJzb3JzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDRCQUE0QjtBQUM1QixnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9raWxsX2N1cnNvcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLktpbGxDdXJzb3JzT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbmNsYXNzIEtpbGxDdXJzb3JzT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGN1cnNvcklkLCBucywgc2VydmVyLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm5zID0gbnM7XG4gICAgICAgIHRoaXMuY3Vyc29ySWQgPSBjdXJzb3JJZDtcbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdraWxsQ3Vyc29ycyc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBpZiAoc2VydmVyICE9PSB0aGlzLnNlcnZlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0tpbGxjdXJzb3IgbXVzdCBydW4gb24gdGhlIHNhbWUgc2VydmVyIG9wZXJhdGlvbiBiZWdhbiBvbicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGtpbGxDdXJzb3JzID0gdGhpcy5ucy5jb2xsZWN0aW9uO1xuICAgICAgICBpZiAoa2lsbEN1cnNvcnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gQ3Vyc29ycyBzaG91bGQgaGF2ZSBhZG9wdGVkIHRoZSBuYW1lc3BhY2UgcmV0dXJuZWQgYnkgTW9uZ29EQlxuICAgICAgICAgICAgLy8gd2hpY2ggc2hvdWxkIGFsd2F5cyBkZWZpbmVkIGEgY29sbGVjdGlvbiBuYW1lIChldmVuIGEgcHNldWRvIG9uZSwgZXguIGRiLmFnZ3JlZ2F0ZSgpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0EgY29sbGVjdGlvbiBuYW1lIG11c3QgYmUgZGV0ZXJtaW5lZCBiZWZvcmUga2lsbEN1cnNvcnMnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBraWxsQ3Vyc29yc0NvbW1hbmQgPSB7XG4gICAgICAgICAgICBraWxsQ3Vyc29ycyxcbiAgICAgICAgICAgIGN1cnNvcnM6IFt0aGlzLmN1cnNvcklkXVxuICAgICAgICB9O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgc2VydmVyLmNvbW1hbmQodGhpcy5ucywga2lsbEN1cnNvcnNDb21tYW5kLCB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgICAgICAgICB0aW1lb3V0Q29udGV4dFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBUaGUgZHJpdmVyIHNob3VsZCBuZXZlciBlbWl0IGVycm9ycyBmcm9tIGtpbGxDdXJzb3JzLCB0aGlzIGlzIHNwZWMtZWQgYmVoYXZpb3JcbiAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLktpbGxDdXJzb3JzT3BlcmF0aW9uID0gS2lsbEN1cnNvcnNPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoS2lsbEN1cnNvcnNPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuTVVTVF9TRUxFQ1RfU0FNRV9TRVJWRVJdKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWtpbGxfY3Vyc29ycy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/kill_cursors.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_collections.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_collections.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListCollectionsOperation = void 0;\nconst responses_1 = __webpack_require__(/*! ../cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass ListCollectionsOperation extends command_1.CommandOperation {\n    constructor(db, filter, options) {\n        super(db, options);\n        this.options = { ...options };\n        delete this.options.writeConcern;\n        this.db = db;\n        this.filter = filter;\n        this.nameOnly = !!this.options.nameOnly;\n        this.authorizedCollections = !!this.options.authorizedCollections;\n        if (typeof this.options.batchSize === 'number') {\n            this.batchSize = this.options.batchSize;\n        }\n    }\n    get commandName() {\n        return 'listCollections';\n    }\n    async execute(server, session, timeoutContext) {\n        return await super.executeCommand(server, session, this.generateCommand((0, utils_1.maxWireVersion)(server)), timeoutContext, responses_1.CursorResponse);\n    }\n    /* This is here for the purpose of unit testing the final command that gets sent. */\n    generateCommand(wireVersion) {\n        const command = {\n            listCollections: 1,\n            filter: this.filter,\n            cursor: this.batchSize ? { batchSize: this.batchSize } : {},\n            nameOnly: this.nameOnly,\n            authorizedCollections: this.authorizedCollections\n        };\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (wireVersion >= 9 && this.options.comment !== undefined) {\n            command.comment = this.options.comment;\n        }\n        return command;\n    }\n}\nexports.ListCollectionsOperation = ListCollectionsOperation;\n(0, operation_1.defineAspects)(ListCollectionsOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n//# sourceMappingURL=list_collections.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvbGlzdF9jb2xsZWN0aW9ucy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxnQ0FBZ0M7QUFDaEMsb0JBQW9CLG1CQUFPLENBQUMsMklBQWlDO0FBQzdELGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsNEJBQTRCLElBQUk7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL2xpc3RfY29sbGVjdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpc3RDb2xsZWN0aW9uc09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IHJlc3BvbnNlc18xID0gcmVxdWlyZShcIi4uL2NtYXAvd2lyZV9wcm90b2NvbC9yZXNwb25zZXNcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgTGlzdENvbGxlY3Rpb25zT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBmaWx0ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLm9wdGlvbnMgfTtcbiAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy53cml0ZUNvbmNlcm47XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7XG4gICAgICAgIHRoaXMubmFtZU9ubHkgPSAhIXRoaXMub3B0aW9ucy5uYW1lT25seTtcbiAgICAgICAgdGhpcy5hdXRob3JpemVkQ29sbGVjdGlvbnMgPSAhIXRoaXMub3B0aW9ucy5hdXRob3JpemVkQ29sbGVjdGlvbnM7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLmJhdGNoU2l6ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXMuYmF0Y2hTaXplID0gdGhpcy5vcHRpb25zLmJhdGNoU2l6ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnbGlzdENvbGxlY3Rpb25zJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIHRoaXMuZ2VuZXJhdGVDb21tYW5kKCgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKShzZXJ2ZXIpKSwgdGltZW91dENvbnRleHQsIHJlc3BvbnNlc18xLkN1cnNvclJlc3BvbnNlKTtcbiAgICB9XG4gICAgLyogVGhpcyBpcyBoZXJlIGZvciB0aGUgcHVycG9zZSBvZiB1bml0IHRlc3RpbmcgdGhlIGZpbmFsIGNvbW1hbmQgdGhhdCBnZXRzIHNlbnQuICovXG4gICAgZ2VuZXJhdGVDb21tYW5kKHdpcmVWZXJzaW9uKSB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBsaXN0Q29sbGVjdGlvbnM6IDEsXG4gICAgICAgICAgICBmaWx0ZXI6IHRoaXMuZmlsdGVyLFxuICAgICAgICAgICAgY3Vyc29yOiB0aGlzLmJhdGNoU2l6ZSA/IHsgYmF0Y2hTaXplOiB0aGlzLmJhdGNoU2l6ZSB9IDoge30sXG4gICAgICAgICAgICBuYW1lT25seTogdGhpcy5uYW1lT25seSxcbiAgICAgICAgICAgIGF1dGhvcml6ZWRDb2xsZWN0aW9uczogdGhpcy5hdXRob3JpemVkQ29sbGVjdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgLy8gd2UgY2hlY2sgZm9yIHVuZGVmaW5lZCBzcGVjaWZpY2FsbHkgaGVyZSB0byBhbGxvdyBmYWxzeSB2YWx1ZXNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgICAgIGlmICh3aXJlVmVyc2lvbiA+PSA5ICYmIHRoaXMub3B0aW9ucy5jb21tZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29tbWVudCA9IHRoaXMub3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cbn1cbmV4cG9ydHMuTGlzdENvbGxlY3Rpb25zT3BlcmF0aW9uID0gTGlzdENvbGxlY3Rpb25zT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKExpc3RDb2xsZWN0aW9uc09wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5DVVJTT1JfQ1JFQVRJTkdcbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGlzdF9jb2xsZWN0aW9ucy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_collections.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_databases.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_databases.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ListDatabasesOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass ListDatabasesOperation extends command_1.CommandOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options ?? {};\n        this.ns = new utils_1.MongoDBNamespace('admin', '$cmd');\n    }\n    get commandName() {\n        return 'listDatabases';\n    }\n    async execute(server, session, timeoutContext) {\n        const cmd = { listDatabases: 1 };\n        if (typeof this.options.nameOnly === 'boolean') {\n            cmd.nameOnly = this.options.nameOnly;\n        }\n        if (this.options.filter) {\n            cmd.filter = this.options.filter;\n        }\n        if (typeof this.options.authorizedDatabases === 'boolean') {\n            cmd.authorizedDatabases = this.options.authorizedDatabases;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if ((0, utils_1.maxWireVersion)(server) >= 9 && this.options.comment !== undefined) {\n            cmd.comment = this.options.comment;\n        }\n        return await super.executeCommand(server, session, cmd, timeoutContext);\n    }\n}\nexports.ListDatabasesOperation = ListDatabasesOperation;\n(0, operation_1.defineAspects)(ListDatabasesOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE]);\n//# sourceMappingURL=list_databases.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvbGlzdF9kYXRhYmFzZXMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsOEJBQThCO0FBQzlCLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9saXN0X2RhdGFiYXNlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTGlzdERhdGFiYXNlc09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tYW5kXzEgPSByZXF1aXJlKFwiLi9jb21tYW5kXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBMaXN0RGF0YWJhc2VzT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5ucyA9IG5ldyB1dGlsc18xLk1vbmdvREJOYW1lc3BhY2UoJ2FkbWluJywgJyRjbWQnKTtcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ2xpc3REYXRhYmFzZXMnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY21kID0geyBsaXN0RGF0YWJhc2VzOiAxIH07XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLm5hbWVPbmx5ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGNtZC5uYW1lT25seSA9IHRoaXMub3B0aW9ucy5uYW1lT25seTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZpbHRlcikge1xuICAgICAgICAgICAgY21kLmZpbHRlciA9IHRoaXMub3B0aW9ucy5maWx0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuYXV0aG9yaXplZERhdGFiYXNlcyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICBjbWQuYXV0aG9yaXplZERhdGFiYXNlcyA9IHRoaXMub3B0aW9ucy5hdXRob3JpemVkRGF0YWJhc2VzO1xuICAgICAgICB9XG4gICAgICAgIC8vIHdlIGNoZWNrIGZvciB1bmRlZmluZWQgc3BlY2lmaWNhbGx5IGhlcmUgdG8gYWxsb3cgZmFsc3kgdmFsdWVzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgICBpZiAoKDAsIHV0aWxzXzEubWF4V2lyZVZlcnNpb24pKHNlcnZlcikgPj0gOSAmJiB0aGlzLm9wdGlvbnMuY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjbWQuY29tbWVudCA9IHRoaXMub3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChzZXJ2ZXIsIHNlc3Npb24sIGNtZCwgdGltZW91dENvbnRleHQpO1xuICAgIH1cbn1cbmV4cG9ydHMuTGlzdERhdGFiYXNlc09wZXJhdGlvbiA9IExpc3REYXRhYmFzZXNPcGVyYXRpb247XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoTGlzdERhdGFiYXNlc09wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5SRUFEX09QRVJBVElPTiwgb3BlcmF0aW9uXzEuQXNwZWN0LlJFVFJZQUJMRV0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGlzdF9kYXRhYmFzZXMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/list_databases.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js ***!
  \********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.AbstractOperation = exports.Aspect = void 0;\nexports.defineAspects = defineAspects;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nexports.Aspect = {\n    READ_OPERATION: Symbol('READ_OPERATION'),\n    WRITE_OPERATION: Symbol('WRITE_OPERATION'),\n    RETRYABLE: Symbol('RETRYABLE'),\n    EXPLAINABLE: Symbol('EXPLAINABLE'),\n    SKIP_COLLATION: Symbol('SKIP_COLLATION'),\n    CURSOR_CREATING: Symbol('CURSOR_CREATING'),\n    MUST_SELECT_SAME_SERVER: Symbol('MUST_SELECT_SAME_SERVER'),\n    COMMAND_BATCHING: Symbol('COMMAND_BATCHING')\n};\n/**\n * This class acts as a parent class for any operation and is responsible for setting this.options,\n * as well as setting and getting a session.\n * Additionally, this class implements `hasAspect`, which determines whether an operation has\n * a specific aspect.\n * @internal\n */\nclass AbstractOperation {\n    constructor(options = {}) {\n        this.readPreference = this.hasAspect(exports.Aspect.WRITE_OPERATION)\n            ? read_preference_1.ReadPreference.primary\n            : (read_preference_1.ReadPreference.fromOptions(options) ?? read_preference_1.ReadPreference.primary);\n        // Pull the BSON serialize options from the already-resolved options\n        this.bsonOptions = (0, bson_1.resolveBSONOptions)(options);\n        this._session = options.session != null ? options.session : undefined;\n        this.options = options;\n        this.bypassPinningCheck = !!options.bypassPinningCheck;\n        this.trySecondaryWrite = false;\n    }\n    hasAspect(aspect) {\n        const ctor = this.constructor;\n        if (ctor.aspects == null) {\n            return false;\n        }\n        return ctor.aspects.has(aspect);\n    }\n    // Make sure the session is not writable from outside this class.\n    get session() {\n        return this._session;\n    }\n    clearSession() {\n        this._session = undefined;\n    }\n    resetBatch() {\n        return true;\n    }\n    get canRetryRead() {\n        return this.hasAspect(exports.Aspect.RETRYABLE) && this.hasAspect(exports.Aspect.READ_OPERATION);\n    }\n    get canRetryWrite() {\n        return this.hasAspect(exports.Aspect.RETRYABLE) && this.hasAspect(exports.Aspect.WRITE_OPERATION);\n    }\n}\nexports.AbstractOperation = AbstractOperation;\nfunction defineAspects(operation, aspects) {\n    if (!Array.isArray(aspects) && !(aspects instanceof Set)) {\n        aspects = [aspects];\n    }\n    aspects = new Set(aspects);\n    Object.defineProperty(operation, 'aspects', {\n        value: aspects,\n        writable: false\n    });\n    return aspects;\n}\n//# sourceMappingURL=operation.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvb3BlcmF0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QixHQUFHLGNBQWM7QUFDMUMscUJBQXFCO0FBQ3JCLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQywwQkFBMEIsbUJBQU8sQ0FBQyxpSEFBb0I7QUFDdEQsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL29wZXJhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWJzdHJhY3RPcGVyYXRpb24gPSBleHBvcnRzLkFzcGVjdCA9IHZvaWQgMDtcbmV4cG9ydHMuZGVmaW5lQXNwZWN0cyA9IGRlZmluZUFzcGVjdHM7XG5jb25zdCBic29uXzEgPSByZXF1aXJlKFwiLi4vYnNvblwiKTtcbmNvbnN0IHJlYWRfcHJlZmVyZW5jZV8xID0gcmVxdWlyZShcIi4uL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmV4cG9ydHMuQXNwZWN0ID0ge1xuICAgIFJFQURfT1BFUkFUSU9OOiBTeW1ib2woJ1JFQURfT1BFUkFUSU9OJyksXG4gICAgV1JJVEVfT1BFUkFUSU9OOiBTeW1ib2woJ1dSSVRFX09QRVJBVElPTicpLFxuICAgIFJFVFJZQUJMRTogU3ltYm9sKCdSRVRSWUFCTEUnKSxcbiAgICBFWFBMQUlOQUJMRTogU3ltYm9sKCdFWFBMQUlOQUJMRScpLFxuICAgIFNLSVBfQ09MTEFUSU9OOiBTeW1ib2woJ1NLSVBfQ09MTEFUSU9OJyksXG4gICAgQ1VSU09SX0NSRUFUSU5HOiBTeW1ib2woJ0NVUlNPUl9DUkVBVElORycpLFxuICAgIE1VU1RfU0VMRUNUX1NBTUVfU0VSVkVSOiBTeW1ib2woJ01VU1RfU0VMRUNUX1NBTUVfU0VSVkVSJyksXG4gICAgQ09NTUFORF9CQVRDSElORzogU3ltYm9sKCdDT01NQU5EX0JBVENISU5HJylcbn07XG4vKipcbiAqIFRoaXMgY2xhc3MgYWN0cyBhcyBhIHBhcmVudCBjbGFzcyBmb3IgYW55IG9wZXJhdGlvbiBhbmQgaXMgcmVzcG9uc2libGUgZm9yIHNldHRpbmcgdGhpcy5vcHRpb25zLFxuICogYXMgd2VsbCBhcyBzZXR0aW5nIGFuZCBnZXR0aW5nIGEgc2Vzc2lvbi5cbiAqIEFkZGl0aW9uYWxseSwgdGhpcyBjbGFzcyBpbXBsZW1lbnRzIGBoYXNBc3BlY3RgLCB3aGljaCBkZXRlcm1pbmVzIHdoZXRoZXIgYW4gb3BlcmF0aW9uIGhhc1xuICogYSBzcGVjaWZpYyBhc3BlY3QuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLnJlYWRQcmVmZXJlbmNlID0gdGhpcy5oYXNBc3BlY3QoZXhwb3J0cy5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OKVxuICAgICAgICAgICAgPyByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5XG4gICAgICAgICAgICA6IChyZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tT3B0aW9ucyhvcHRpb25zKSA/PyByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5KTtcbiAgICAgICAgLy8gUHVsbCB0aGUgQlNPTiBzZXJpYWxpemUgb3B0aW9ucyBmcm9tIHRoZSBhbHJlYWR5LXJlc29sdmVkIG9wdGlvbnNcbiAgICAgICAgdGhpcy5ic29uT3B0aW9ucyA9ICgwLCBic29uXzEucmVzb2x2ZUJTT05PcHRpb25zKShvcHRpb25zKTtcbiAgICAgICAgdGhpcy5fc2Vzc2lvbiA9IG9wdGlvbnMuc2Vzc2lvbiAhPSBudWxsID8gb3B0aW9ucy5zZXNzaW9uIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmJ5cGFzc1Bpbm5pbmdDaGVjayA9ICEhb3B0aW9ucy5ieXBhc3NQaW5uaW5nQ2hlY2s7XG4gICAgICAgIHRoaXMudHJ5U2Vjb25kYXJ5V3JpdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFzQXNwZWN0KGFzcGVjdCkge1xuICAgICAgICBjb25zdCBjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgICAgICAgaWYgKGN0b3IuYXNwZWN0cyA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN0b3IuYXNwZWN0cy5oYXMoYXNwZWN0KTtcbiAgICB9XG4gICAgLy8gTWFrZSBzdXJlIHRoZSBzZXNzaW9uIGlzIG5vdCB3cml0YWJsZSBmcm9tIG91dHNpZGUgdGhpcyBjbGFzcy5cbiAgICBnZXQgc2Vzc2lvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Nlc3Npb247XG4gICAgfVxuICAgIGNsZWFyU2Vzc2lvbigpIHtcbiAgICAgICAgdGhpcy5fc2Vzc2lvbiA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmVzZXRCYXRjaCgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGdldCBjYW5SZXRyeVJlYWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0FzcGVjdChleHBvcnRzLkFzcGVjdC5SRVRSWUFCTEUpICYmIHRoaXMuaGFzQXNwZWN0KGV4cG9ydHMuQXNwZWN0LlJFQURfT1BFUkFUSU9OKTtcbiAgICB9XG4gICAgZ2V0IGNhblJldHJ5V3JpdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0FzcGVjdChleHBvcnRzLkFzcGVjdC5SRVRSWUFCTEUpICYmIHRoaXMuaGFzQXNwZWN0KGV4cG9ydHMuQXNwZWN0LldSSVRFX09QRVJBVElPTik7XG4gICAgfVxufVxuZXhwb3J0cy5BYnN0cmFjdE9wZXJhdGlvbiA9IEFic3RyYWN0T3BlcmF0aW9uO1xuZnVuY3Rpb24gZGVmaW5lQXNwZWN0cyhvcGVyYXRpb24sIGFzcGVjdHMpIHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXNwZWN0cykgJiYgIShhc3BlY3RzIGluc3RhbmNlb2YgU2V0KSkge1xuICAgICAgICBhc3BlY3RzID0gW2FzcGVjdHNdO1xuICAgIH1cbiAgICBhc3BlY3RzID0gbmV3IFNldChhc3BlY3RzKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob3BlcmF0aW9uLCAnYXNwZWN0cycsIHtcbiAgICAgICAgdmFsdWU6IGFzcGVjdHMsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgIH0pO1xuICAgIHJldHVybiBhc3BlY3RzO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9b3BlcmF0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/options_operation.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/options_operation.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.OptionsOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass OptionsOperation extends operation_1.AbstractOperation {\n    constructor(collection, options) {\n        super(options);\n        this.options = options;\n        this.collection = collection;\n    }\n    get commandName() {\n        return 'listCollections';\n    }\n    async execute(server, session) {\n        const coll = this.collection;\n        const [collection] = await coll.s.db\n            .listCollections({ name: coll.collectionName }, { ...this.options, nameOnly: false, readPreference: this.readPreference, session })\n            .toArray();\n        if (collection == null || collection.options == null) {\n            throw new error_1.MongoAPIError(`collection ${coll.namespace} not found`);\n        }\n        return collection.options;\n    }\n}\nexports.OptionsOperation = OptionsOperation;\n//# sourceMappingURL=options_operation.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvb3B0aW9uc19vcGVyYXRpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDJCQUEyQixJQUFJLGdGQUFnRjtBQUM5STtBQUNBO0FBQ0EsMERBQTBELGdCQUFnQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvb3B0aW9uc19vcGVyYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk9wdGlvbnNPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBPcHRpb25zT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdsaXN0Q29sbGVjdGlvbnMnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbikge1xuICAgICAgICBjb25zdCBjb2xsID0gdGhpcy5jb2xsZWN0aW9uO1xuICAgICAgICBjb25zdCBbY29sbGVjdGlvbl0gPSBhd2FpdCBjb2xsLnMuZGJcbiAgICAgICAgICAgIC5saXN0Q29sbGVjdGlvbnMoeyBuYW1lOiBjb2xsLmNvbGxlY3Rpb25OYW1lIH0sIHsgLi4udGhpcy5vcHRpb25zLCBuYW1lT25seTogZmFsc2UsIHJlYWRQcmVmZXJlbmNlOiB0aGlzLnJlYWRQcmVmZXJlbmNlLCBzZXNzaW9uIH0pXG4gICAgICAgICAgICAudG9BcnJheSgpO1xuICAgICAgICBpZiAoY29sbGVjdGlvbiA9PSBudWxsIHx8IGNvbGxlY3Rpb24ub3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKGBjb2xsZWN0aW9uICR7Y29sbC5uYW1lc3BhY2V9IG5vdCBmb3VuZGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb2xsZWN0aW9uLm9wdGlvbnM7XG4gICAgfVxufVxuZXhwb3J0cy5PcHRpb25zT3BlcmF0aW9uID0gT3B0aW9uc09wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW9wdGlvbnNfb3BlcmF0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/options_operation.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/profiling_level.js":
/*!**************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/profiling_level.js ***!
  \**************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ProfilingLevelOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\n/** @internal */\nclass ProfilingLevelOperation extends command_1.CommandOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options;\n    }\n    get commandName() {\n        return 'profile';\n    }\n    async execute(server, session, timeoutContext) {\n        const doc = await super.executeCommand(server, session, { profile: -1 }, timeoutContext);\n        if (doc.ok === 1) {\n            const was = doc.was;\n            if (was === 0)\n                return 'off';\n            if (was === 1)\n                return 'slow_only';\n            if (was === 2)\n                return 'all';\n            throw new error_1.MongoUnexpectedServerResponseError(`Illegal profiling level value ${was}`);\n        }\n        else {\n            throw new error_1.MongoUnexpectedServerResponseError('Error with profile command');\n        }\n    }\n}\nexports.ProfilingLevelOperation = ProfilingLevelOperation;\n//# sourceMappingURL=profiling_level.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvcHJvZmlsaW5nX2xldmVsLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELCtCQUErQjtBQUMvQixnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQywyR0FBVztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSxhQUFhO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrR0FBa0csSUFBSTtBQUN0RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3Byb2ZpbGluZ19sZXZlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUHJvZmlsaW5nTGV2ZWxPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ3Byb2ZpbGUnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgZG9jID0gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCB7IHByb2ZpbGU6IC0xIH0sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgaWYgKGRvYy5vayA9PT0gMSkge1xuICAgICAgICAgICAgY29uc3Qgd2FzID0gZG9jLndhcztcbiAgICAgICAgICAgIGlmICh3YXMgPT09IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuICdvZmYnO1xuICAgICAgICAgICAgaWYgKHdhcyA9PT0gMSlcbiAgICAgICAgICAgICAgICByZXR1cm4gJ3Nsb3dfb25seSc7XG4gICAgICAgICAgICBpZiAod2FzID09PSAyKVxuICAgICAgICAgICAgICAgIHJldHVybiAnYWxsJztcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvVW5leHBlY3RlZFNlcnZlclJlc3BvbnNlRXJyb3IoYElsbGVnYWwgcHJvZmlsaW5nIGxldmVsIHZhbHVlICR7d2FzfWApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvcignRXJyb3Igd2l0aCBwcm9maWxlIGNvbW1hbmQnKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuUHJvZmlsaW5nTGV2ZWxPcGVyYXRpb24gPSBQcm9maWxpbmdMZXZlbE9wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXByb2ZpbGluZ19sZXZlbC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/profiling_level.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/remove_user.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/remove_user.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RemoveUserOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass RemoveUserOperation extends command_1.CommandOperation {\n    constructor(db, username, options) {\n        super(db, options);\n        this.options = options;\n        this.username = username;\n    }\n    get commandName() {\n        return 'dropUser';\n    }\n    async execute(server, session, timeoutContext) {\n        await super.executeCommand(server, session, { dropUser: this.username }, timeoutContext);\n        return true;\n    }\n}\nexports.RemoveUserOperation = RemoveUserOperation;\n(0, operation_1.defineAspects)(RemoveUserOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=remove_user.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvcmVtb3ZlX3VzZXIuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMkJBQTJCO0FBQzNCLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QseUJBQXlCO0FBQy9FO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9yZW1vdmVfdXNlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUmVtb3ZlVXNlck9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFJlbW92ZVVzZXJPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGIsIHVzZXJuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGRiLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnZHJvcFVzZXInO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCB7IGRyb3BVc2VyOiB0aGlzLnVzZXJuYW1lIH0sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuZXhwb3J0cy5SZW1vdmVVc2VyT3BlcmF0aW9uID0gUmVtb3ZlVXNlck9wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShSZW1vdmVVc2VyT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVtb3ZlX3VzZXIuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/remove_user.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/rename.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/rename.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RenameOperation = void 0;\nconst collection_1 = __webpack_require__(/*! ../collection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/collection.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass RenameOperation extends command_1.CommandOperation {\n    constructor(collection, newName, options) {\n        super(collection, options);\n        this.collection = collection;\n        this.newName = newName;\n        this.options = options;\n        this.ns = new utils_1.MongoDBNamespace('admin', '$cmd');\n    }\n    get commandName() {\n        return 'renameCollection';\n    }\n    async execute(server, session, timeoutContext) {\n        // Build the command\n        const renameCollection = this.collection.namespace;\n        const toCollection = this.collection.s.namespace.withCollection(this.newName).toString();\n        const dropTarget = typeof this.options.dropTarget === 'boolean' ? this.options.dropTarget : false;\n        const command = {\n            renameCollection: renameCollection,\n            to: toCollection,\n            dropTarget: dropTarget\n        };\n        await super.executeCommand(server, session, command, timeoutContext);\n        return new collection_1.Collection(this.collection.s.db, this.newName, this.collection.s.options);\n    }\n}\nexports.RenameOperation = RenameOperation;\n(0, operation_1.defineAspects)(RenameOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=rename.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvcmVuYW1lLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHVCQUF1QjtBQUN2QixxQkFBcUIsbUJBQU8sQ0FBQyx1R0FBZTtBQUM1QyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxrQkFBa0IsbUJBQU8sQ0FBQywyR0FBVztBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQywrR0FBYTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3JlbmFtZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUmVuYW1lT3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgY29sbGVjdGlvbl8xID0gcmVxdWlyZShcIi4uL2NvbGxlY3Rpb25cIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgUmVuYW1lT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG5ld05hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMubmV3TmFtZSA9IG5ld05hbWU7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMubnMgPSBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKCdhZG1pbicsICckY21kJyk7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdyZW5hbWVDb2xsZWN0aW9uJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIC8vIEJ1aWxkIHRoZSBjb21tYW5kXG4gICAgICAgIGNvbnN0IHJlbmFtZUNvbGxlY3Rpb24gPSB0aGlzLmNvbGxlY3Rpb24ubmFtZXNwYWNlO1xuICAgICAgICBjb25zdCB0b0NvbGxlY3Rpb24gPSB0aGlzLmNvbGxlY3Rpb24ucy5uYW1lc3BhY2Uud2l0aENvbGxlY3Rpb24odGhpcy5uZXdOYW1lKS50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBkcm9wVGFyZ2V0ID0gdHlwZW9mIHRoaXMub3B0aW9ucy5kcm9wVGFyZ2V0ID09PSAnYm9vbGVhbicgPyB0aGlzLm9wdGlvbnMuZHJvcFRhcmdldCA6IGZhbHNlO1xuICAgICAgICBjb25zdCBjb21tYW5kID0ge1xuICAgICAgICAgICAgcmVuYW1lQ29sbGVjdGlvbjogcmVuYW1lQ29sbGVjdGlvbixcbiAgICAgICAgICAgIHRvOiB0b0NvbGxlY3Rpb24sXG4gICAgICAgICAgICBkcm9wVGFyZ2V0OiBkcm9wVGFyZ2V0XG4gICAgICAgIH07XG4gICAgICAgIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgY29tbWFuZCwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gbmV3IGNvbGxlY3Rpb25fMS5Db2xsZWN0aW9uKHRoaXMuY29sbGVjdGlvbi5zLmRiLCB0aGlzLm5ld05hbWUsIHRoaXMuY29sbGVjdGlvbi5zLm9wdGlvbnMpO1xuICAgIH1cbn1cbmV4cG9ydHMuUmVuYW1lT3BlcmF0aW9uID0gUmVuYW1lT3BlcmF0aW9uO1xuKDAsIG9wZXJhdGlvbl8xLmRlZmluZUFzcGVjdHMpKFJlbmFtZU9wZXJhdGlvbiwgW29wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT05dKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlbmFtZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/rename.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RunAdminCommandOperation = exports.RunCommandOperation = void 0;\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass RunCommandOperation extends operation_1.AbstractOperation {\n    constructor(parent, command, options) {\n        super(options);\n        this.command = command;\n        this.options = options;\n        this.ns = parent.s.namespace.withCollection('$cmd');\n    }\n    get commandName() {\n        return 'runCommand';\n    }\n    async execute(server, session, timeoutContext) {\n        this.server = server;\n        const res = await server.command(this.ns, this.command, {\n            ...this.options,\n            readPreference: this.readPreference,\n            session,\n            timeoutContext\n        }, this.options.responseType);\n        return res;\n    }\n}\nexports.RunCommandOperation = RunCommandOperation;\nclass RunAdminCommandOperation extends operation_1.AbstractOperation {\n    constructor(command, options) {\n        super(options);\n        this.command = command;\n        this.options = options;\n        this.ns = new utils_1.MongoDBNamespace('admin', '$cmd');\n    }\n    get commandName() {\n        return 'runCommand';\n    }\n    async execute(server, session, timeoutContext) {\n        this.server = server;\n        const res = await server.command(this.ns, this.command, {\n            ...this.options,\n            readPreference: this.readPreference,\n            session,\n            timeoutContext\n        });\n        return res;\n    }\n}\nexports.RunAdminCommandOperation = RunAdminCommandOperation;\n//# sourceMappingURL=run_command.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvcnVuX2NvbW1hbmQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsZ0NBQWdDLEdBQUcsMkJBQTJCO0FBQzlELGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3J1bl9jb21tYW5kLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5SdW5BZG1pbkNvbW1hbmRPcGVyYXRpb24gPSBleHBvcnRzLlJ1bkNvbW1hbmRPcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3Qgb3BlcmF0aW9uXzEgPSByZXF1aXJlKFwiLi9vcGVyYXRpb25cIik7XG4vKiogQGludGVybmFsICovXG5jbGFzcyBSdW5Db21tYW5kT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgY29tbWFuZCwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKTtcbiAgICAgICAgdGhpcy5jb21tYW5kID0gY29tbWFuZDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5ucyA9IHBhcmVudC5zLm5hbWVzcGFjZS53aXRoQ29sbGVjdGlvbignJGNtZCcpO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAncnVuQ29tbWFuZCc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgc2VydmVyLmNvbW1hbmQodGhpcy5ucywgdGhpcy5jb21tYW5kLCB7XG4gICAgICAgICAgICAuLi50aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogdGhpcy5yZWFkUHJlZmVyZW5jZSxcbiAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICB0aW1lb3V0Q29udGV4dFxuICAgICAgICB9LCB0aGlzLm9wdGlvbnMucmVzcG9uc2VUeXBlKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG59XG5leHBvcnRzLlJ1bkNvbW1hbmRPcGVyYXRpb24gPSBSdW5Db21tYW5kT3BlcmF0aW9uO1xuY2xhc3MgUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbW1hbmQsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY29tbWFuZCA9IGNvbW1hbmQ7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMubnMgPSBuZXcgdXRpbHNfMS5Nb25nb0RCTmFtZXNwYWNlKCdhZG1pbicsICckY21kJyk7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdydW5Db21tYW5kJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBzZXJ2ZXIuY29tbWFuZCh0aGlzLm5zLCB0aGlzLmNvbW1hbmQsIHtcbiAgICAgICAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlOiB0aGlzLnJlYWRQcmVmZXJlbmNlLFxuICAgICAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgICAgIHRpbWVvdXRDb250ZXh0XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cbn1cbmV4cG9ydHMuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uID0gUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cnVuX2NvbW1hbmQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/create.js":
/*!********************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/create.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CreateSearchIndexesOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass CreateSearchIndexesOperation extends operation_1.AbstractOperation {\n    constructor(collection, descriptions) {\n        super();\n        this.collection = collection;\n        this.descriptions = descriptions;\n    }\n    get commandName() {\n        return 'createSearchIndexes';\n    }\n    async execute(server, session, timeoutContext) {\n        const namespace = this.collection.fullNamespace;\n        const command = {\n            createSearchIndexes: namespace.collection,\n            indexes: this.descriptions\n        };\n        const res = await server.command(namespace, command, {\n            session,\n            timeoutContext\n        });\n        const indexesCreated = res?.indexesCreated ?? [];\n        return indexesCreated.map(({ name }) => name);\n    }\n}\nexports.CreateSearchIndexesOperation = CreateSearchIndexesOperation;\n//# sourceMappingURL=create.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvY3JlYXRlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELG9DQUFvQztBQUNwQyxvQkFBb0IsbUJBQU8sQ0FBQyxnSEFBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLHFDQUFxQyxNQUFNO0FBQzNDO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3NlYXJjaF9pbmRleGVzL2NyZWF0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ3JlYXRlU2VhcmNoSW5kZXhlc09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIENyZWF0ZVNlYXJjaEluZGV4ZXNPcGVyYXRpb24gZXh0ZW5kcyBvcGVyYXRpb25fMS5BYnN0cmFjdE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZGVzY3JpcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25zID0gZGVzY3JpcHRpb25zO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnY3JlYXRlU2VhcmNoSW5kZXhlcyc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmNvbGxlY3Rpb24uZnVsbE5hbWVzcGFjZTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHtcbiAgICAgICAgICAgIGNyZWF0ZVNlYXJjaEluZGV4ZXM6IG5hbWVzcGFjZS5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgaW5kZXhlczogdGhpcy5kZXNjcmlwdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgc2VydmVyLmNvbW1hbmQobmFtZXNwYWNlLCBjb21tYW5kLCB7XG4gICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgdGltZW91dENvbnRleHRcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGluZGV4ZXNDcmVhdGVkID0gcmVzPy5pbmRleGVzQ3JlYXRlZCA/PyBbXTtcbiAgICAgICAgcmV0dXJuIGluZGV4ZXNDcmVhdGVkLm1hcCgoeyBuYW1lIH0pID0+IG5hbWUpO1xuICAgIH1cbn1cbmV4cG9ydHMuQ3JlYXRlU2VhcmNoSW5kZXhlc09wZXJhdGlvbiA9IENyZWF0ZVNlYXJjaEluZGV4ZXNPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jcmVhdGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/create.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/drop.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/drop.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DropSearchIndexOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DropSearchIndexOperation extends operation_1.AbstractOperation {\n    constructor(collection, name) {\n        super();\n        this.collection = collection;\n        this.name = name;\n    }\n    get commandName() {\n        return 'dropSearchIndex';\n    }\n    async execute(server, session, timeoutContext) {\n        const namespace = this.collection.fullNamespace;\n        const command = {\n            dropSearchIndex: namespace.collection\n        };\n        if (typeof this.name === 'string') {\n            command.name = this.name;\n        }\n        try {\n            await server.command(namespace, command, { session, timeoutContext });\n        }\n        catch (error) {\n            const isNamespaceNotFoundError = error instanceof error_1.MongoServerError && error.code === error_1.MONGODB_ERROR_CODES.NamespaceNotFound;\n            if (!isNamespaceNotFoundError) {\n                throw error;\n            }\n        }\n    }\n}\nexports.DropSearchIndexOperation = DropSearchIndexOperation;\n//# sourceMappingURL=drop.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvZHJvcC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxnQ0FBZ0M7QUFDaEMsZ0JBQWdCLG1CQUFPLENBQUMsZ0dBQWE7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMsZ0hBQWM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQseUJBQXlCO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQyIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvZHJvcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRHJvcFNlYXJjaEluZGV4T3BlcmF0aW9uID0gdm9pZCAwO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi8uLi9lcnJvclwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERyb3BTZWFyY2hJbmRleE9wZXJhdGlvbiBleHRlbmRzIG9wZXJhdGlvbl8xLkFic3RyYWN0T3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBuYW1lKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdkcm9wU2VhcmNoSW5kZXgnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gdGhpcy5jb2xsZWN0aW9uLmZ1bGxOYW1lc3BhY2U7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBkcm9wU2VhcmNoSW5kZXg6IG5hbWVzcGFjZS5jb2xsZWN0aW9uXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5uYW1lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29tbWFuZC5uYW1lID0gdGhpcy5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuY29tbWFuZChuYW1lc3BhY2UsIGNvbW1hbmQsIHsgc2Vzc2lvbiwgdGltZW91dENvbnRleHQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBpc05hbWVzcGFjZU5vdEZvdW5kRXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvciAmJiBlcnJvci5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTmFtZXNwYWNlTm90Rm91bmQ7XG4gICAgICAgICAgICBpZiAoIWlzTmFtZXNwYWNlTm90Rm91bmRFcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5Ecm9wU2VhcmNoSW5kZXhPcGVyYXRpb24gPSBEcm9wU2VhcmNoSW5kZXhPcGVyYXRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kcm9wLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/drop.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/update.js":
/*!********************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/update.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.UpdateSearchIndexOperation = void 0;\nconst operation_1 = __webpack_require__(/*! ../operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass UpdateSearchIndexOperation extends operation_1.AbstractOperation {\n    constructor(collection, name, definition) {\n        super();\n        this.collection = collection;\n        this.name = name;\n        this.definition = definition;\n    }\n    get commandName() {\n        return 'updateSearchIndex';\n    }\n    async execute(server, session, timeoutContext) {\n        const namespace = this.collection.fullNamespace;\n        const command = {\n            updateSearchIndex: namespace.collection,\n            name: this.name,\n            definition: this.definition\n        };\n        await server.command(namespace, command, { session, timeoutContext });\n        return;\n    }\n}\nexports.UpdateSearchIndexOperation = UpdateSearchIndexOperation;\n//# sourceMappingURL=update.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvdXBkYXRlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGtDQUFrQztBQUNsQyxvQkFBb0IsbUJBQU8sQ0FBQyxnSEFBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQseUJBQXlCO0FBQzVFO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQyIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc2VhcmNoX2luZGV4ZXMvdXBkYXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5VcGRhdGVTZWFyY2hJbmRleE9wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4uL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFVwZGF0ZVNlYXJjaEluZGV4T3BlcmF0aW9uIGV4dGVuZHMgb3BlcmF0aW9uXzEuQWJzdHJhY3RPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIG5hbWUsIGRlZmluaXRpb24pIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5kZWZpbml0aW9uID0gZGVmaW5pdGlvbjtcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ3VwZGF0ZVNlYXJjaEluZGV4JztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IG5hbWVzcGFjZSA9IHRoaXMuY29sbGVjdGlvbi5mdWxsTmFtZXNwYWNlO1xuICAgICAgICBjb25zdCBjb21tYW5kID0ge1xuICAgICAgICAgICAgdXBkYXRlU2VhcmNoSW5kZXg6IG5hbWVzcGFjZS5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgZGVmaW5pdGlvbjogdGhpcy5kZWZpbml0aW9uXG4gICAgICAgIH07XG4gICAgICAgIGF3YWl0IHNlcnZlci5jb21tYW5kKG5hbWVzcGFjZSwgY29tbWFuZCwgeyBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn1cbmV4cG9ydHMuVXBkYXRlU2VhcmNoSW5kZXhPcGVyYXRpb24gPSBVcGRhdGVTZWFyY2hJbmRleE9wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVwZGF0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/search_indexes/update.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/set_profiling_level.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/set_profiling_level.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.SetProfilingLevelOperation = exports.ProfilingLevel = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst levelValues = new Set(['off', 'slow_only', 'all']);\n/** @public */\nexports.ProfilingLevel = Object.freeze({\n    off: 'off',\n    slowOnly: 'slow_only',\n    all: 'all'\n});\n/** @internal */\nclass SetProfilingLevelOperation extends command_1.CommandOperation {\n    constructor(db, level, options) {\n        super(db, options);\n        this.options = options;\n        switch (level) {\n            case exports.ProfilingLevel.off:\n                this.profile = 0;\n                break;\n            case exports.ProfilingLevel.slowOnly:\n                this.profile = 1;\n                break;\n            case exports.ProfilingLevel.all:\n                this.profile = 2;\n                break;\n            default:\n                this.profile = 0;\n                break;\n        }\n        this.level = level;\n    }\n    get commandName() {\n        return 'profile';\n    }\n    async execute(server, session, timeoutContext) {\n        const level = this.level;\n        if (!levelValues.has(level)) {\n            throw new error_1.MongoInvalidArgumentError(`Profiling level must be one of \"${(0, utils_1.enumToString)(exports.ProfilingLevel)}\"`);\n        }\n        // TODO(NODE-3483): Determine error to put here\n        await super.executeCommand(server, session, { profile: this.profile }, timeoutContext);\n        return level;\n    }\n}\nexports.SetProfilingLevelOperation = SetProfilingLevelOperation;\n//# sourceMappingURL=set_profiling_level.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc2V0X3Byb2ZpbGluZ19sZXZlbC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQ0FBa0MsR0FBRyxzQkFBc0I7QUFDM0QsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckM7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkZBQTJGLGtEQUFrRDtBQUM3STtBQUNBO0FBQ0Esc0RBQXNELHVCQUF1QjtBQUM3RTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9vcGVyYXRpb25zL3NldF9wcm9maWxpbmdfbGV2ZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlNldFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uID0gZXhwb3J0cy5Qcm9maWxpbmdMZXZlbCA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IGxldmVsVmFsdWVzID0gbmV3IFNldChbJ29mZicsICdzbG93X29ubHknLCAnYWxsJ10pO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuUHJvZmlsaW5nTGV2ZWwgPSBPYmplY3QuZnJlZXplKHtcbiAgICBvZmY6ICdvZmYnLFxuICAgIHNsb3dPbmx5OiAnc2xvd19vbmx5JyxcbiAgICBhbGw6ICdhbGwnXG59KTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFNldFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCBsZXZlbCwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihkYiwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHN3aXRjaCAobGV2ZWwpIHtcbiAgICAgICAgICAgIGNhc2UgZXhwb3J0cy5Qcm9maWxpbmdMZXZlbC5vZmY6XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9maWxlID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZXhwb3J0cy5Qcm9maWxpbmdMZXZlbC5zbG93T25seTpcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBleHBvcnRzLlByb2ZpbGluZ0xldmVsLmFsbDpcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSAyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSAwO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ3Byb2ZpbGUnO1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgbGV2ZWwgPSB0aGlzLmxldmVsO1xuICAgICAgICBpZiAoIWxldmVsVmFsdWVzLmhhcyhsZXZlbCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYFByb2ZpbGluZyBsZXZlbCBtdXN0IGJlIG9uZSBvZiBcIiR7KDAsIHV0aWxzXzEuZW51bVRvU3RyaW5nKShleHBvcnRzLlByb2ZpbGluZ0xldmVsKX1cImApO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE8oTk9ERS0zNDgzKTogRGV0ZXJtaW5lIGVycm9yIHRvIHB1dCBoZXJlXG4gICAgICAgIGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgeyBwcm9maWxlOiB0aGlzLnByb2ZpbGUgfSwgdGltZW91dENvbnRleHQpO1xuICAgICAgICByZXR1cm4gbGV2ZWw7XG4gICAgfVxufVxuZXhwb3J0cy5TZXRQcm9maWxpbmdMZXZlbE9wZXJhdGlvbiA9IFNldFByb2ZpbGluZ0xldmVsT3BlcmF0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2V0X3Byb2ZpbGluZ19sZXZlbC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/set_profiling_level.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/stats.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/stats.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.DbStatsOperation = void 0;\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/** @internal */\nclass DbStatsOperation extends command_1.CommandOperation {\n    constructor(db, options) {\n        super(db, options);\n        this.options = options;\n    }\n    get commandName() {\n        return 'dbStats';\n    }\n    async execute(server, session, timeoutContext) {\n        const command = { dbStats: true };\n        if (this.options.scale != null) {\n            command.scale = this.options.scale;\n        }\n        return await super.executeCommand(server, session, command, timeoutContext);\n    }\n}\nexports.DbStatsOperation = DbStatsOperation;\n(0, operation_1.defineAspects)(DbStatsOperation, [operation_1.Aspect.READ_OPERATION]);\n//# sourceMappingURL=stats.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvc3RhdHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCO0FBQ3hCLGtCQUFrQixtQkFBTyxDQUFDLDJHQUFXO0FBQ3JDLG9CQUFvQixtQkFBTyxDQUFDLCtHQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy9zdGF0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGJTdGF0c09wZXJhdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGNvbW1hbmRfMSA9IHJlcXVpcmUoXCIuL2NvbW1hbmRcIik7XG5jb25zdCBvcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvblwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIERiU3RhdHNPcGVyYXRpb24gZXh0ZW5kcyBjb21tYW5kXzEuQ29tbWFuZE9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGIsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH1cbiAgICBnZXQgY29tbWFuZE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnZGJTdGF0cyc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBjb21tYW5kID0geyBkYlN0YXRzOiB0cnVlIH07XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2NhbGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29tbWFuZC5zY2FsZSA9IHRoaXMub3B0aW9ucy5zY2FsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCBjb21tYW5kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgfVxufVxuZXhwb3J0cy5EYlN0YXRzT3BlcmF0aW9uID0gRGJTdGF0c09wZXJhdGlvbjtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShEYlN0YXRzT3BlcmF0aW9uLCBbb3BlcmF0aW9uXzEuQXNwZWN0LlJFQURfT1BFUkFUSU9OXSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdGF0cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/stats.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/update.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/update.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ReplaceOneOperation = exports.UpdateManyOperation = exports.UpdateOneOperation = exports.UpdateOperation = void 0;\nexports.makeUpdateStatement = makeUpdateStatement;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\nconst operation_1 = __webpack_require__(/*! ./operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/operation.js\");\n/**\n * @internal\n * UpdateOperation is used in bulk write, while UpdateOneOperation and UpdateManyOperation are only used in the collections API\n */\nclass UpdateOperation extends command_1.CommandOperation {\n    constructor(ns, statements, options) {\n        super(undefined, options);\n        this.options = options;\n        this.ns = ns;\n        this.statements = statements;\n    }\n    get commandName() {\n        return 'update';\n    }\n    get canRetryWrite() {\n        if (super.canRetryWrite === false) {\n            return false;\n        }\n        return this.statements.every(op => op.multi == null || op.multi === false);\n    }\n    async execute(server, session, timeoutContext) {\n        const options = this.options ?? {};\n        const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n        const command = {\n            update: this.ns.collection,\n            updates: this.statements,\n            ordered\n        };\n        if (typeof options.bypassDocumentValidation === 'boolean') {\n            command.bypassDocumentValidation = options.bypassDocumentValidation;\n        }\n        if (options.let) {\n            command.let = options.let;\n        }\n        // we check for undefined specifically here to allow falsy values\n        // eslint-disable-next-line no-restricted-syntax\n        if (options.comment !== undefined) {\n            command.comment = options.comment;\n        }\n        const unacknowledgedWrite = this.writeConcern && this.writeConcern.w === 0;\n        if (unacknowledgedWrite) {\n            if (this.statements.find((o) => o.hint)) {\n                // TODO(NODE-3541): fix error for hint with unacknowledged writes\n                throw new error_1.MongoCompatibilityError(`hint is not supported with unacknowledged writes`);\n            }\n        }\n        const res = await super.executeCommand(server, session, command, timeoutContext);\n        return res;\n    }\n}\nexports.UpdateOperation = UpdateOperation;\n/** @internal */\nclass UpdateOneOperation extends UpdateOperation {\n    constructor(collection, filter, update, options) {\n        super(collection.s.namespace, [makeUpdateStatement(filter, update, { ...options, multi: false })], options);\n        if (!(0, utils_1.hasAtomicOperators)(update)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n    }\n    async execute(server, session, timeoutContext) {\n        const res = await super.execute(server, session, timeoutContext);\n        if (this.explain != null)\n            return res;\n        if (res.code)\n            throw new error_1.MongoServerError(res);\n        if (res.writeErrors)\n            throw new error_1.MongoServerError(res.writeErrors[0]);\n        return {\n            acknowledged: this.writeConcern?.w !== 0,\n            modifiedCount: res.nModified ?? res.n,\n            upsertedId: Array.isArray(res.upserted) && res.upserted.length > 0 ? res.upserted[0]._id : null,\n            upsertedCount: Array.isArray(res.upserted) && res.upserted.length ? res.upserted.length : 0,\n            matchedCount: Array.isArray(res.upserted) && res.upserted.length > 0 ? 0 : res.n\n        };\n    }\n}\nexports.UpdateOneOperation = UpdateOneOperation;\n/** @internal */\nclass UpdateManyOperation extends UpdateOperation {\n    constructor(collection, filter, update, options) {\n        super(collection.s.namespace, [makeUpdateStatement(filter, update, { ...options, multi: true })], options);\n        if (!(0, utils_1.hasAtomicOperators)(update)) {\n            throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n        }\n    }\n    async execute(server, session, timeoutContext) {\n        const res = await super.execute(server, session, timeoutContext);\n        if (this.explain != null)\n            return res;\n        if (res.code)\n            throw new error_1.MongoServerError(res);\n        if (res.writeErrors)\n            throw new error_1.MongoServerError(res.writeErrors[0]);\n        return {\n            acknowledged: this.writeConcern?.w !== 0,\n            modifiedCount: res.nModified ?? res.n,\n            upsertedId: Array.isArray(res.upserted) && res.upserted.length > 0 ? res.upserted[0]._id : null,\n            upsertedCount: Array.isArray(res.upserted) && res.upserted.length ? res.upserted.length : 0,\n            matchedCount: Array.isArray(res.upserted) && res.upserted.length > 0 ? 0 : res.n\n        };\n    }\n}\nexports.UpdateManyOperation = UpdateManyOperation;\n/** @internal */\nclass ReplaceOneOperation extends UpdateOperation {\n    constructor(collection, filter, replacement, options) {\n        super(collection.s.namespace, [makeUpdateStatement(filter, replacement, { ...options, multi: false })], options);\n        if ((0, utils_1.hasAtomicOperators)(replacement)) {\n            throw new error_1.MongoInvalidArgumentError('Replacement document must not contain atomic operators');\n        }\n    }\n    async execute(server, session, timeoutContext) {\n        const res = await super.execute(server, session, timeoutContext);\n        if (this.explain != null)\n            return res;\n        if (res.code)\n            throw new error_1.MongoServerError(res);\n        if (res.writeErrors)\n            throw new error_1.MongoServerError(res.writeErrors[0]);\n        return {\n            acknowledged: this.writeConcern?.w !== 0,\n            modifiedCount: res.nModified ?? res.n,\n            upsertedId: Array.isArray(res.upserted) && res.upserted.length > 0 ? res.upserted[0]._id : null,\n            upsertedCount: Array.isArray(res.upserted) && res.upserted.length ? res.upserted.length : 0,\n            matchedCount: Array.isArray(res.upserted) && res.upserted.length > 0 ? 0 : res.n\n        };\n    }\n}\nexports.ReplaceOneOperation = ReplaceOneOperation;\nfunction makeUpdateStatement(filter, update, options) {\n    if (filter == null || typeof filter !== 'object') {\n        throw new error_1.MongoInvalidArgumentError('Selector must be a valid JavaScript object');\n    }\n    if (update == null || typeof update !== 'object') {\n        throw new error_1.MongoInvalidArgumentError('Document must be a valid JavaScript object');\n    }\n    const op = { q: filter, u: update };\n    if (typeof options.upsert === 'boolean') {\n        op.upsert = options.upsert;\n    }\n    if (options.multi) {\n        op.multi = options.multi;\n    }\n    if (options.hint) {\n        op.hint = options.hint;\n    }\n    if (options.arrayFilters) {\n        op.arrayFilters = options.arrayFilters;\n    }\n    if (options.collation) {\n        op.collation = options.collation;\n    }\n    return op;\n}\n(0, operation_1.defineAspects)(UpdateOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.SKIP_COLLATION]);\n(0, operation_1.defineAspects)(UpdateOneOperation, [\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n(0, operation_1.defineAspects)(UpdateManyOperation, [\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n(0, operation_1.defineAspects)(ReplaceOneOperation, [\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.WRITE_OPERATION,\n    operation_1.Aspect.SKIP_COLLATION\n]);\n//# sourceMappingURL=update.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvdXBkYXRlLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDJCQUEyQixHQUFHLDJCQUEyQixHQUFHLDBCQUEwQixHQUFHLHVCQUF1QjtBQUNoSCwyQkFBMkI7QUFDM0IsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckMsb0JBQW9CLG1CQUFPLENBQUMsK0dBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsMEJBQTBCO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUseUJBQXlCO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQSxrRkFBa0YsMEJBQTBCO0FBQzVHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy91cGRhdGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJlcGxhY2VPbmVPcGVyYXRpb24gPSBleHBvcnRzLlVwZGF0ZU1hbnlPcGVyYXRpb24gPSBleHBvcnRzLlVwZGF0ZU9uZU9wZXJhdGlvbiA9IGV4cG9ydHMuVXBkYXRlT3BlcmF0aW9uID0gdm9pZCAwO1xuZXhwb3J0cy5tYWtlVXBkYXRlU3RhdGVtZW50ID0gbWFrZVVwZGF0ZVN0YXRlbWVudDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbmNvbnN0IG9wZXJhdGlvbl8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9uXCIpO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIFVwZGF0ZU9wZXJhdGlvbiBpcyB1c2VkIGluIGJ1bGsgd3JpdGUsIHdoaWxlIFVwZGF0ZU9uZU9wZXJhdGlvbiBhbmQgVXBkYXRlTWFueU9wZXJhdGlvbiBhcmUgb25seSB1c2VkIGluIHRoZSBjb2xsZWN0aW9ucyBBUElcbiAqL1xuY2xhc3MgVXBkYXRlT3BlcmF0aW9uIGV4dGVuZHMgY29tbWFuZF8xLkNvbW1hbmRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG5zLCBzdGF0ZW1lbnRzLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMubnMgPSBucztcbiAgICAgICAgdGhpcy5zdGF0ZW1lbnRzID0gc3RhdGVtZW50cztcbiAgICB9XG4gICAgZ2V0IGNvbW1hbmROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ3VwZGF0ZSc7XG4gICAgfVxuICAgIGdldCBjYW5SZXRyeVdyaXRlKCkge1xuICAgICAgICBpZiAoc3VwZXIuY2FuUmV0cnlXcml0ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZW1lbnRzLmV2ZXJ5KG9wID0+IG9wLm11bHRpID09IG51bGwgfHwgb3AubXVsdGkgPT09IGZhbHNlKTtcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMgPz8ge307XG4gICAgICAgIGNvbnN0IG9yZGVyZWQgPSB0eXBlb2Ygb3B0aW9ucy5vcmRlcmVkID09PSAnYm9vbGVhbicgPyBvcHRpb25zLm9yZGVyZWQgOiB0cnVlO1xuICAgICAgICBjb25zdCBjb21tYW5kID0ge1xuICAgICAgICAgICAgdXBkYXRlOiB0aGlzLm5zLmNvbGxlY3Rpb24sXG4gICAgICAgICAgICB1cGRhdGVzOiB0aGlzLnN0YXRlbWVudHMsXG4gICAgICAgICAgICBvcmRlcmVkXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgY29tbWFuZC5ieXBhc3NEb2N1bWVudFZhbGlkYXRpb24gPSBvcHRpb25zLmJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5sZXQpIHtcbiAgICAgICAgICAgIGNvbW1hbmQubGV0ID0gb3B0aW9ucy5sZXQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gd2UgY2hlY2sgZm9yIHVuZGVmaW5lZCBzcGVjaWZpY2FsbHkgaGVyZSB0byBhbGxvdyBmYWxzeSB2YWx1ZXNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgICAgIGlmIChvcHRpb25zLmNvbW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tbWFuZC5jb21tZW50ID0gb3B0aW9ucy5jb21tZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVuYWNrbm93bGVkZ2VkV3JpdGUgPSB0aGlzLndyaXRlQ29uY2VybiAmJiB0aGlzLndyaXRlQ29uY2Vybi53ID09PSAwO1xuICAgICAgICBpZiAodW5hY2tub3dsZWRnZWRXcml0ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50cy5maW5kKChvKSA9PiBvLmhpbnQpKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM1NDEpOiBmaXggZXJyb3IgZm9yIGhpbnQgd2l0aCB1bmFja25vd2xlZGdlZCB3cml0ZXNcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgaGludCBpcyBub3Qgc3VwcG9ydGVkIHdpdGggdW5hY2tub3dsZWRnZWQgd3JpdGVzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoc2VydmVyLCBzZXNzaW9uLCBjb21tYW5kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxufVxuZXhwb3J0cy5VcGRhdGVPcGVyYXRpb24gPSBVcGRhdGVPcGVyYXRpb247XG4vKiogQGludGVybmFsICovXG5jbGFzcyBVcGRhdGVPbmVPcGVyYXRpb24gZXh0ZW5kcyBVcGRhdGVPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb24sIGZpbHRlciwgdXBkYXRlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGNvbGxlY3Rpb24ucy5uYW1lc3BhY2UsIFttYWtlVXBkYXRlU3RhdGVtZW50KGZpbHRlciwgdXBkYXRlLCB7IC4uLm9wdGlvbnMsIG11bHRpOiBmYWxzZSB9KV0sIG9wdGlvbnMpO1xuICAgICAgICBpZiAoISgwLCB1dGlsc18xLmhhc0F0b21pY09wZXJhdG9ycykodXBkYXRlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignVXBkYXRlIGRvY3VtZW50IHJlcXVpcmVzIGF0b21pYyBvcGVyYXRvcnMnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgc3VwZXIuZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgaWYgKHRoaXMuZXhwbGFpbiAhPSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgaWYgKHJlcy5jb2RlKVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcihyZXMpO1xuICAgICAgICBpZiAocmVzLndyaXRlRXJyb3JzKVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcihyZXMud3JpdGVFcnJvcnNbMF0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0aGlzLndyaXRlQ29uY2Vybj8udyAhPT0gMCxcbiAgICAgICAgICAgIG1vZGlmaWVkQ291bnQ6IHJlcy5uTW9kaWZpZWQgPz8gcmVzLm4sXG4gICAgICAgICAgICB1cHNlcnRlZElkOiBBcnJheS5pc0FycmF5KHJlcy51cHNlcnRlZCkgJiYgcmVzLnVwc2VydGVkLmxlbmd0aCA+IDAgPyByZXMudXBzZXJ0ZWRbMF0uX2lkIDogbnVsbCxcbiAgICAgICAgICAgIHVwc2VydGVkQ291bnQ6IEFycmF5LmlzQXJyYXkocmVzLnVwc2VydGVkKSAmJiByZXMudXBzZXJ0ZWQubGVuZ3RoID8gcmVzLnVwc2VydGVkLmxlbmd0aCA6IDAsXG4gICAgICAgICAgICBtYXRjaGVkQ291bnQ6IEFycmF5LmlzQXJyYXkocmVzLnVwc2VydGVkKSAmJiByZXMudXBzZXJ0ZWQubGVuZ3RoID4gMCA/IDAgOiByZXMublxuICAgICAgICB9O1xuICAgIH1cbn1cbmV4cG9ydHMuVXBkYXRlT25lT3BlcmF0aW9uID0gVXBkYXRlT25lT3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgVXBkYXRlTWFueU9wZXJhdGlvbiBleHRlbmRzIFVwZGF0ZU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoY29sbGVjdGlvbi5zLm5hbWVzcGFjZSwgW21ha2VVcGRhdGVTdGF0ZW1lbnQoZmlsdGVyLCB1cGRhdGUsIHsgLi4ub3B0aW9ucywgbXVsdGk6IHRydWUgfSldLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKCEoMCwgdXRpbHNfMS5oYXNBdG9taWNPcGVyYXRvcnMpKHVwZGF0ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1VwZGF0ZSBkb2N1bWVudCByZXF1aXJlcyBhdG9taWMgb3BlcmF0b3JzJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShzZXJ2ZXIsIHNlc3Npb24sIHRpbWVvdXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHN1cGVyLmV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIGlmICh0aGlzLmV4cGxhaW4gIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIGlmIChyZXMuY29kZSlcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzKTtcbiAgICAgICAgaWYgKHJlcy53cml0ZUVycm9ycylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyRXJyb3IocmVzLndyaXRlRXJyb3JzWzBdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFja25vd2xlZGdlZDogdGhpcy53cml0ZUNvbmNlcm4/LncgIT09IDAsXG4gICAgICAgICAgICBtb2RpZmllZENvdW50OiByZXMubk1vZGlmaWVkID8/IHJlcy5uLFxuICAgICAgICAgICAgdXBzZXJ0ZWRJZDogQXJyYXkuaXNBcnJheShyZXMudXBzZXJ0ZWQpICYmIHJlcy51cHNlcnRlZC5sZW5ndGggPiAwID8gcmVzLnVwc2VydGVkWzBdLl9pZCA6IG51bGwsXG4gICAgICAgICAgICB1cHNlcnRlZENvdW50OiBBcnJheS5pc0FycmF5KHJlcy51cHNlcnRlZCkgJiYgcmVzLnVwc2VydGVkLmxlbmd0aCA/IHJlcy51cHNlcnRlZC5sZW5ndGggOiAwLFxuICAgICAgICAgICAgbWF0Y2hlZENvdW50OiBBcnJheS5pc0FycmF5KHJlcy51cHNlcnRlZCkgJiYgcmVzLnVwc2VydGVkLmxlbmd0aCA+IDAgPyAwIDogcmVzLm5cbiAgICAgICAgfTtcbiAgICB9XG59XG5leHBvcnRzLlVwZGF0ZU1hbnlPcGVyYXRpb24gPSBVcGRhdGVNYW55T3BlcmF0aW9uO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgUmVwbGFjZU9uZU9wZXJhdGlvbiBleHRlbmRzIFVwZGF0ZU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoY29sbGVjdGlvbiwgZmlsdGVyLCByZXBsYWNlbWVudCwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLnMubmFtZXNwYWNlLCBbbWFrZVVwZGF0ZVN0YXRlbWVudChmaWx0ZXIsIHJlcGxhY2VtZW50LCB7IC4uLm9wdGlvbnMsIG11bHRpOiBmYWxzZSB9KV0sIG9wdGlvbnMpO1xuICAgICAgICBpZiAoKDAsIHV0aWxzXzEuaGFzQXRvbWljT3BlcmF0b3JzKShyZXBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ1JlcGxhY2VtZW50IGRvY3VtZW50IG11c3Qgbm90IGNvbnRhaW4gYXRvbWljIG9wZXJhdG9ycycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBzdXBlci5leGVjdXRlKHNlcnZlciwgc2Vzc2lvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICBpZiAodGhpcy5leHBsYWluICE9IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICBpZiAocmVzLmNvZGUpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcyk7XG4gICAgICAgIGlmIChyZXMud3JpdGVFcnJvcnMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yKHJlcy53cml0ZUVycm9yc1swXSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhY2tub3dsZWRnZWQ6IHRoaXMud3JpdGVDb25jZXJuPy53ICE9PSAwLFxuICAgICAgICAgICAgbW9kaWZpZWRDb3VudDogcmVzLm5Nb2RpZmllZCA/PyByZXMubixcbiAgICAgICAgICAgIHVwc2VydGVkSWQ6IEFycmF5LmlzQXJyYXkocmVzLnVwc2VydGVkKSAmJiByZXMudXBzZXJ0ZWQubGVuZ3RoID4gMCA/IHJlcy51cHNlcnRlZFswXS5faWQgOiBudWxsLFxuICAgICAgICAgICAgdXBzZXJ0ZWRDb3VudDogQXJyYXkuaXNBcnJheShyZXMudXBzZXJ0ZWQpICYmIHJlcy51cHNlcnRlZC5sZW5ndGggPyByZXMudXBzZXJ0ZWQubGVuZ3RoIDogMCxcbiAgICAgICAgICAgIG1hdGNoZWRDb3VudDogQXJyYXkuaXNBcnJheShyZXMudXBzZXJ0ZWQpICYmIHJlcy51cHNlcnRlZC5sZW5ndGggPiAwID8gMCA6IHJlcy5uXG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0cy5SZXBsYWNlT25lT3BlcmF0aW9uID0gUmVwbGFjZU9uZU9wZXJhdGlvbjtcbmZ1bmN0aW9uIG1ha2VVcGRhdGVTdGF0ZW1lbnQoZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpIHtcbiAgICBpZiAoZmlsdGVyID09IG51bGwgfHwgdHlwZW9mIGZpbHRlciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignU2VsZWN0b3IgbXVzdCBiZSBhIHZhbGlkIEphdmFTY3JpcHQgb2JqZWN0Jyk7XG4gICAgfVxuICAgIGlmICh1cGRhdGUgPT0gbnVsbCB8fCB0eXBlb2YgdXBkYXRlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdEb2N1bWVudCBtdXN0IGJlIGEgdmFsaWQgSmF2YVNjcmlwdCBvYmplY3QnKTtcbiAgICB9XG4gICAgY29uc3Qgb3AgPSB7IHE6IGZpbHRlciwgdTogdXBkYXRlIH07XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnVwc2VydCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIG9wLnVwc2VydCA9IG9wdGlvbnMudXBzZXJ0O1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5tdWx0aSkge1xuICAgICAgICBvcC5tdWx0aSA9IG9wdGlvbnMubXVsdGk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmhpbnQpIHtcbiAgICAgICAgb3AuaGludCA9IG9wdGlvbnMuaGludDtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYXJyYXlGaWx0ZXJzKSB7XG4gICAgICAgIG9wLmFycmF5RmlsdGVycyA9IG9wdGlvbnMuYXJyYXlGaWx0ZXJzO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5jb2xsYXRpb24pIHtcbiAgICAgICAgb3AuY29sbGF0aW9uID0gb3B0aW9ucy5jb2xsYXRpb247XG4gICAgfVxuICAgIHJldHVybiBvcDtcbn1cbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShVcGRhdGVPcGVyYXRpb24sIFtvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLCBvcGVyYXRpb25fMS5Bc3BlY3QuV1JJVEVfT1BFUkFUSU9OLCBvcGVyYXRpb25fMS5Bc3BlY3QuU0tJUF9DT0xMQVRJT05dKTtcbigwLCBvcGVyYXRpb25fMS5kZWZpbmVBc3BlY3RzKShVcGRhdGVPbmVPcGVyYXRpb24sIFtcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuUkVUUllBQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTlxuXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoVXBkYXRlTWFueU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5XUklURV9PUEVSQVRJT04sXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LkVYUExBSU5BQkxFLFxuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5TS0lQX0NPTExBVElPTlxuXSk7XG4oMCwgb3BlcmF0aW9uXzEuZGVmaW5lQXNwZWN0cykoUmVwbGFjZU9uZU9wZXJhdGlvbiwgW1xuICAgIG9wZXJhdGlvbl8xLkFzcGVjdC5SRVRSWUFCTEUsXG4gICAgb3BlcmF0aW9uXzEuQXNwZWN0LldSSVRFX09QRVJBVElPTixcbiAgICBvcGVyYXRpb25fMS5Bc3BlY3QuU0tJUF9DT0xMQVRJT05cbl0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXBkYXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/update.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/validate_collection.js":
/*!******************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/validate_collection.js ***!
  \******************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ValidateCollectionOperation = void 0;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst command_1 = __webpack_require__(/*! ./command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/command.js\");\n/** @internal */\nclass ValidateCollectionOperation extends command_1.CommandOperation {\n    constructor(admin, collectionName, options) {\n        // Decorate command with extra options\n        const command = { validate: collectionName };\n        const keys = Object.keys(options);\n        for (let i = 0; i < keys.length; i++) {\n            if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n                command[keys[i]] = options[keys[i]];\n            }\n        }\n        super(admin.s.db, options);\n        this.options = options;\n        this.command = command;\n        this.collectionName = collectionName;\n    }\n    get commandName() {\n        return 'validate';\n    }\n    async execute(server, session, timeoutContext) {\n        const collectionName = this.collectionName;\n        const doc = await super.executeCommand(server, session, this.command, timeoutContext);\n        if (doc.result != null && typeof doc.result !== 'string')\n            throw new error_1.MongoUnexpectedServerResponseError('Error with validation data');\n        if (doc.result != null && doc.result.match(/exception|corrupt/) != null)\n            throw new error_1.MongoUnexpectedServerResponseError(`Invalid collection ${collectionName}`);\n        if (doc.valid != null && !doc.valid)\n            throw new error_1.MongoUnexpectedServerResponseError(`Invalid collection ${collectionName}`);\n        return doc;\n    }\n}\nexports.ValidateCollectionOperation = ValidateCollectionOperation;\n//# sourceMappingURL=validate_collection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL29wZXJhdGlvbnMvdmFsaWRhdGVfY29sbGVjdGlvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxtQ0FBbUM7QUFDbkMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsa0JBQWtCLG1CQUFPLENBQUMsMkdBQVc7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQSx3QkFBd0IsaUJBQWlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVGQUF1RixlQUFlO0FBQ3RHO0FBQ0EsdUZBQXVGLGVBQWU7QUFDdEc7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvb3BlcmF0aW9ucy92YWxpZGF0ZV9jb2xsZWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5WYWxpZGF0ZUNvbGxlY3Rpb25PcGVyYXRpb24gPSB2b2lkIDA7XG5jb25zdCBlcnJvcl8xID0gcmVxdWlyZShcIi4uL2Vycm9yXCIpO1xuY29uc3QgY29tbWFuZF8xID0gcmVxdWlyZShcIi4vY29tbWFuZFwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFZhbGlkYXRlQ29sbGVjdGlvbk9wZXJhdGlvbiBleHRlbmRzIGNvbW1hbmRfMS5Db21tYW5kT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihhZG1pbiwgY29sbGVjdGlvbk5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgLy8gRGVjb3JhdGUgY29tbWFuZCB3aXRoIGV4dHJhIG9wdGlvbnNcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHsgdmFsaWRhdGU6IGNvbGxlY3Rpb25OYW1lIH07XG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9wdGlvbnMsIGtleXNbaV0pICYmIGtleXNbaV0gIT09ICdzZXNzaW9uJykge1xuICAgICAgICAgICAgICAgIGNvbW1hbmRba2V5c1tpXV0gPSBvcHRpb25zW2tleXNbaV1dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHN1cGVyKGFkbWluLnMuZGIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNvbW1hbmQgPSBjb21tYW5kO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID0gY29sbGVjdGlvbk5hbWU7XG4gICAgfVxuICAgIGdldCBjb21tYW5kTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICd2YWxpZGF0ZSc7XG4gICAgfVxuICAgIGFzeW5jIGV4ZWN1dGUoc2VydmVyLCBzZXNzaW9uLCB0aW1lb3V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IHRoaXMuY29sbGVjdGlvbk5hbWU7XG4gICAgICAgIGNvbnN0IGRvYyA9IGF3YWl0IHN1cGVyLmV4ZWN1dGVDb21tYW5kKHNlcnZlciwgc2Vzc2lvbiwgdGhpcy5jb21tYW5kLCB0aW1lb3V0Q29udGV4dCk7XG4gICAgICAgIGlmIChkb2MucmVzdWx0ICE9IG51bGwgJiYgdHlwZW9mIGRvYy5yZXN1bHQgIT09ICdzdHJpbmcnKVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29VbmV4cGVjdGVkU2VydmVyUmVzcG9uc2VFcnJvcignRXJyb3Igd2l0aCB2YWxpZGF0aW9uIGRhdGEnKTtcbiAgICAgICAgaWYgKGRvYy5yZXN1bHQgIT0gbnVsbCAmJiBkb2MucmVzdWx0Lm1hdGNoKC9leGNlcHRpb258Y29ycnVwdC8pICE9IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKGBJbnZhbGlkIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uTmFtZX1gKTtcbiAgICAgICAgaWYgKGRvYy52YWxpZCAhPSBudWxsICYmICFkb2MudmFsaWQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1VuZXhwZWN0ZWRTZXJ2ZXJSZXNwb25zZUVycm9yKGBJbnZhbGlkIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uTmFtZX1gKTtcbiAgICAgICAgcmV0dXJuIGRvYztcbiAgICB9XG59XG5leHBvcnRzLlZhbGlkYXRlQ29sbGVjdGlvbk9wZXJhdGlvbiA9IFZhbGlkYXRlQ29sbGVjdGlvbk9wZXJhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXZhbGlkYXRlX2NvbGxlY3Rpb24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/validate_collection.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ReadConcern = exports.ReadConcernLevel = void 0;\n/** @public */\nexports.ReadConcernLevel = Object.freeze({\n    local: 'local',\n    majority: 'majority',\n    linearizable: 'linearizable',\n    available: 'available',\n    snapshot: 'snapshot'\n});\n/**\n * The MongoDB ReadConcern, which allows for control of the consistency and isolation properties\n * of the data read from replica sets and replica set shards.\n * @public\n *\n * @see https://www.mongodb.com/docs/manual/reference/read-concern/index.html\n */\nclass ReadConcern {\n    /** Constructs a ReadConcern from the read concern level.*/\n    constructor(level) {\n        /**\n         * A spec test exists that allows level to be any string.\n         * \"invalid readConcern with out stage\"\n         * @see ./test/spec/crud/v2/aggregate-out-readConcern.json\n         * @see https://github.com/mongodb/specifications/blob/master/source/read-write-concern/read-write-concern.md#unknown-levels-and-additional-options-for-string-based-readconcerns\n         */\n        this.level = exports.ReadConcernLevel[level] ?? level;\n    }\n    /**\n     * Construct a ReadConcern given an options object.\n     *\n     * @param options - The options object from which to extract the write concern.\n     */\n    static fromOptions(options) {\n        if (options == null) {\n            return;\n        }\n        if (options.readConcern) {\n            const { readConcern } = options;\n            if (readConcern instanceof ReadConcern) {\n                return readConcern;\n            }\n            else if (typeof readConcern === 'string') {\n                return new ReadConcern(readConcern);\n            }\n            else if ('level' in readConcern && readConcern.level) {\n                return new ReadConcern(readConcern.level);\n            }\n        }\n        if (options.level) {\n            return new ReadConcern(options.level);\n        }\n        return;\n    }\n    static get MAJORITY() {\n        return exports.ReadConcernLevel.majority;\n    }\n    static get AVAILABLE() {\n        return exports.ReadConcernLevel.available;\n    }\n    static get LINEARIZABLE() {\n        return exports.ReadConcernLevel.linearizable;\n    }\n    static get SNAPSHOT() {\n        return exports.ReadConcernLevel.snapshot;\n    }\n    toJSON() {\n        return { level: this.level };\n    }\n}\nexports.ReadConcern = ReadConcern;\n//# sourceMappingURL=read_concern.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3JlYWRfY29uY2Vybi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxtQkFBbUIsR0FBRyx3QkFBd0I7QUFDOUM7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9yZWFkX2NvbmNlcm4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJlYWRDb25jZXJuID0gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsID0gdm9pZCAwO1xuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuUmVhZENvbmNlcm5MZXZlbCA9IE9iamVjdC5mcmVlemUoe1xuICAgIGxvY2FsOiAnbG9jYWwnLFxuICAgIG1ham9yaXR5OiAnbWFqb3JpdHknLFxuICAgIGxpbmVhcml6YWJsZTogJ2xpbmVhcml6YWJsZScsXG4gICAgYXZhaWxhYmxlOiAnYXZhaWxhYmxlJyxcbiAgICBzbmFwc2hvdDogJ3NuYXBzaG90J1xufSk7XG4vKipcbiAqIFRoZSBNb25nb0RCIFJlYWRDb25jZXJuLCB3aGljaCBhbGxvd3MgZm9yIGNvbnRyb2wgb2YgdGhlIGNvbnNpc3RlbmN5IGFuZCBpc29sYXRpb24gcHJvcGVydGllc1xuICogb2YgdGhlIGRhdGEgcmVhZCBmcm9tIHJlcGxpY2Egc2V0cyBhbmQgcmVwbGljYSBzZXQgc2hhcmRzLlxuICogQHB1YmxpY1xuICpcbiAqIEBzZWUgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZG9jcy9tYW51YWwvcmVmZXJlbmNlL3JlYWQtY29uY2Vybi9pbmRleC5odG1sXG4gKi9cbmNsYXNzIFJlYWRDb25jZXJuIHtcbiAgICAvKiogQ29uc3RydWN0cyBhIFJlYWRDb25jZXJuIGZyb20gdGhlIHJlYWQgY29uY2VybiBsZXZlbC4qL1xuICAgIGNvbnN0cnVjdG9yKGxldmVsKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHNwZWMgdGVzdCBleGlzdHMgdGhhdCBhbGxvd3MgbGV2ZWwgdG8gYmUgYW55IHN0cmluZy5cbiAgICAgICAgICogXCJpbnZhbGlkIHJlYWRDb25jZXJuIHdpdGggb3V0IHN0YWdlXCJcbiAgICAgICAgICogQHNlZSAuL3Rlc3Qvc3BlYy9jcnVkL3YyL2FnZ3JlZ2F0ZS1vdXQtcmVhZENvbmNlcm4uanNvblxuICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9yZWFkLXdyaXRlLWNvbmNlcm4vcmVhZC13cml0ZS1jb25jZXJuLm1kI3Vua25vd24tbGV2ZWxzLWFuZC1hZGRpdGlvbmFsLW9wdGlvbnMtZm9yLXN0cmluZy1iYXNlZC1yZWFkY29uY2VybnNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGV2ZWwgPSBleHBvcnRzLlJlYWRDb25jZXJuTGV2ZWxbbGV2ZWxdID8/IGxldmVsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3QgYSBSZWFkQ29uY2VybiBnaXZlbiBhbiBvcHRpb25zIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgb2JqZWN0IGZyb20gd2hpY2ggdG8gZXh0cmFjdCB0aGUgd3JpdGUgY29uY2Vybi5cbiAgICAgKi9cbiAgICBzdGF0aWMgZnJvbU9wdGlvbnMob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMucmVhZENvbmNlcm4pIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcmVhZENvbmNlcm4gfSA9IG9wdGlvbnM7XG4gICAgICAgICAgICBpZiAocmVhZENvbmNlcm4gaW5zdGFuY2VvZiBSZWFkQ29uY2Vybikge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWFkQ29uY2VybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiByZWFkQ29uY2VybiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlYWRDb25jZXJuKHJlYWRDb25jZXJuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCdsZXZlbCcgaW4gcmVhZENvbmNlcm4gJiYgcmVhZENvbmNlcm4ubGV2ZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlYWRDb25jZXJuKHJlYWRDb25jZXJuLmxldmVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5sZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWFkQ29uY2VybihvcHRpb25zLmxldmVsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgTUFKT1JJVFkoKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLlJlYWRDb25jZXJuTGV2ZWwubWFqb3JpdHk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgQVZBSUxBQkxFKCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsLmF2YWlsYWJsZTtcbiAgICB9XG4gICAgc3RhdGljIGdldCBMSU5FQVJJWkFCTEUoKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLlJlYWRDb25jZXJuTGV2ZWwubGluZWFyaXphYmxlO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IFNOQVBTSE9UKCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5SZWFkQ29uY2VybkxldmVsLnNuYXBzaG90O1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7IGxldmVsOiB0aGlzLmxldmVsIH07XG4gICAgfVxufVxuZXhwb3J0cy5SZWFkQ29uY2VybiA9IFJlYWRDb25jZXJuO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVhZF9jb25jZXJuLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ReadPreference = exports.ReadPreferenceMode = void 0;\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/** @public */\nexports.ReadPreferenceMode = Object.freeze({\n    primary: 'primary',\n    primaryPreferred: 'primaryPreferred',\n    secondary: 'secondary',\n    secondaryPreferred: 'secondaryPreferred',\n    nearest: 'nearest'\n});\n/**\n * The **ReadPreference** class is a class that represents a MongoDB ReadPreference and is\n * used to construct connections.\n * @public\n *\n * @see https://www.mongodb.com/docs/manual/core/read-preference/\n */\nclass ReadPreference {\n    /**\n     * @param mode - A string describing the read preference mode (primary|primaryPreferred|secondary|secondaryPreferred|nearest)\n     * @param tags - A tag set used to target reads to members with the specified tag(s). tagSet is not available if using read preference mode primary.\n     * @param options - Additional read preference options\n     */\n    constructor(mode, tags, options) {\n        if (!ReadPreference.isValid(mode)) {\n            throw new error_1.MongoInvalidArgumentError(`Invalid read preference mode ${JSON.stringify(mode)}`);\n        }\n        if (options == null && typeof tags === 'object' && !Array.isArray(tags)) {\n            options = tags;\n            tags = undefined;\n        }\n        else if (tags && !Array.isArray(tags)) {\n            throw new error_1.MongoInvalidArgumentError('ReadPreference tags must be an array');\n        }\n        this.mode = mode;\n        this.tags = tags;\n        this.hedge = options?.hedge;\n        this.maxStalenessSeconds = undefined;\n        this.minWireVersion = undefined;\n        options = options ?? {};\n        if (options.maxStalenessSeconds != null) {\n            if (options.maxStalenessSeconds <= 0) {\n                throw new error_1.MongoInvalidArgumentError('maxStalenessSeconds must be a positive integer');\n            }\n            this.maxStalenessSeconds = options.maxStalenessSeconds;\n            // NOTE: The minimum required wire version is 5 for this read preference. If the existing\n            //       topology has a lower value then a MongoError will be thrown during server selection.\n            this.minWireVersion = 5;\n        }\n        if (this.mode === ReadPreference.PRIMARY) {\n            if (this.tags && Array.isArray(this.tags) && this.tags.length > 0) {\n                throw new error_1.MongoInvalidArgumentError('Primary read preference cannot be combined with tags');\n            }\n            if (this.maxStalenessSeconds) {\n                throw new error_1.MongoInvalidArgumentError('Primary read preference cannot be combined with maxStalenessSeconds');\n            }\n            if (this.hedge) {\n                throw new error_1.MongoInvalidArgumentError('Primary read preference cannot be combined with hedge');\n            }\n        }\n    }\n    // Support the deprecated `preference` property introduced in the porcelain layer\n    get preference() {\n        return this.mode;\n    }\n    static fromString(mode) {\n        return new ReadPreference(mode);\n    }\n    /**\n     * Construct a ReadPreference given an options object.\n     *\n     * @param options - The options object from which to extract the read preference.\n     */\n    static fromOptions(options) {\n        if (!options)\n            return;\n        const readPreference = options.readPreference ?? options.session?.transaction.options.readPreference;\n        const readPreferenceTags = options.readPreferenceTags;\n        if (readPreference == null) {\n            return;\n        }\n        if (typeof readPreference === 'string') {\n            return new ReadPreference(readPreference, readPreferenceTags, {\n                maxStalenessSeconds: options.maxStalenessSeconds,\n                hedge: options.hedge\n            });\n        }\n        else if (!(readPreference instanceof ReadPreference) && typeof readPreference === 'object') {\n            const mode = readPreference.mode || readPreference.preference;\n            if (mode && typeof mode === 'string') {\n                return new ReadPreference(mode, readPreference.tags ?? readPreferenceTags, {\n                    maxStalenessSeconds: readPreference.maxStalenessSeconds,\n                    hedge: options.hedge\n                });\n            }\n        }\n        if (readPreferenceTags) {\n            readPreference.tags = readPreferenceTags;\n        }\n        return readPreference;\n    }\n    /**\n     * Replaces options.readPreference with a ReadPreference instance\n     */\n    static translate(options) {\n        if (options.readPreference == null)\n            return options;\n        const r = options.readPreference;\n        if (typeof r === 'string') {\n            options.readPreference = new ReadPreference(r);\n        }\n        else if (r && !(r instanceof ReadPreference) && typeof r === 'object') {\n            const mode = r.mode || r.preference;\n            if (mode && typeof mode === 'string') {\n                options.readPreference = new ReadPreference(mode, r.tags, {\n                    maxStalenessSeconds: r.maxStalenessSeconds\n                });\n            }\n        }\n        else if (!(r instanceof ReadPreference)) {\n            throw new error_1.MongoInvalidArgumentError(`Invalid read preference: ${r}`);\n        }\n        return options;\n    }\n    /**\n     * Validate if a mode is legal\n     *\n     * @param mode - The string representing the read preference mode.\n     */\n    static isValid(mode) {\n        const VALID_MODES = new Set([\n            ReadPreference.PRIMARY,\n            ReadPreference.PRIMARY_PREFERRED,\n            ReadPreference.SECONDARY,\n            ReadPreference.SECONDARY_PREFERRED,\n            ReadPreference.NEAREST,\n            null\n        ]);\n        return VALID_MODES.has(mode);\n    }\n    /**\n     * Validate if a mode is legal\n     *\n     * @param mode - The string representing the read preference mode.\n     */\n    isValid(mode) {\n        return ReadPreference.isValid(typeof mode === 'string' ? mode : this.mode);\n    }\n    /**\n     * Indicates that this readPreference needs the \"SecondaryOk\" bit when sent over the wire\n     * @see https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/#op-query\n     */\n    secondaryOk() {\n        const NEEDS_SECONDARYOK = new Set([\n            ReadPreference.PRIMARY_PREFERRED,\n            ReadPreference.SECONDARY,\n            ReadPreference.SECONDARY_PREFERRED,\n            ReadPreference.NEAREST\n        ]);\n        return NEEDS_SECONDARYOK.has(this.mode);\n    }\n    /**\n     * Check if the two ReadPreferences are equivalent\n     *\n     * @param readPreference - The read preference with which to check equality\n     */\n    equals(readPreference) {\n        return readPreference.mode === this.mode;\n    }\n    /** Return JSON representation */\n    toJSON() {\n        const readPreference = { mode: this.mode };\n        if (Array.isArray(this.tags))\n            readPreference.tags = this.tags;\n        if (this.maxStalenessSeconds)\n            readPreference.maxStalenessSeconds = this.maxStalenessSeconds;\n        if (this.hedge)\n            readPreference.hedge = this.hedge;\n        return readPreference;\n    }\n}\nexports.ReadPreference = ReadPreference;\nReadPreference.PRIMARY = exports.ReadPreferenceMode.primary;\nReadPreference.PRIMARY_PREFERRED = exports.ReadPreferenceMode.primaryPreferred;\nReadPreference.SECONDARY = exports.ReadPreferenceMode.secondary;\nReadPreference.SECONDARY_PREFERRED = exports.ReadPreferenceMode.secondaryPreferred;\nReadPreference.NEAREST = exports.ReadPreferenceMode.nearest;\nReadPreference.primary = new ReadPreference(exports.ReadPreferenceMode.primary);\nReadPreference.primaryPreferred = new ReadPreference(exports.ReadPreferenceMode.primaryPreferred);\nReadPreference.secondary = new ReadPreference(exports.ReadPreferenceMode.secondary);\nReadPreference.secondaryPreferred = new ReadPreference(exports.ReadPreferenceMode.secondaryPreferred);\nReadPreference.nearest = new ReadPreference(exports.ReadPreferenceMode.nearest);\n//# sourceMappingURL=read_preference.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3JlYWRfcHJlZmVyZW5jZS5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxzQkFBc0IsR0FBRywwQkFBMEI7QUFDbkQsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakM7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RkFBd0YscUJBQXFCO0FBQzdHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GLEVBQUU7QUFDdEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3JlYWRfcHJlZmVyZW5jZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUmVhZFByZWZlcmVuY2UgPSBleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZSA9IHZvaWQgMDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbi8qKiBAcHVibGljICovXG5leHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIHByaW1hcnk6ICdwcmltYXJ5JyxcbiAgICBwcmltYXJ5UHJlZmVycmVkOiAncHJpbWFyeVByZWZlcnJlZCcsXG4gICAgc2Vjb25kYXJ5OiAnc2Vjb25kYXJ5JyxcbiAgICBzZWNvbmRhcnlQcmVmZXJyZWQ6ICdzZWNvbmRhcnlQcmVmZXJyZWQnLFxuICAgIG5lYXJlc3Q6ICduZWFyZXN0J1xufSk7XG4vKipcbiAqIFRoZSAqKlJlYWRQcmVmZXJlbmNlKiogY2xhc3MgaXMgYSBjbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBNb25nb0RCIFJlYWRQcmVmZXJlbmNlIGFuZCBpc1xuICogdXNlZCB0byBjb25zdHJ1Y3QgY29ubmVjdGlvbnMuXG4gKiBAcHVibGljXG4gKlxuICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9jb3JlL3JlYWQtcHJlZmVyZW5jZS9cbiAqL1xuY2xhc3MgUmVhZFByZWZlcmVuY2Uge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBtb2RlIC0gQSBzdHJpbmcgZGVzY3JpYmluZyB0aGUgcmVhZCBwcmVmZXJlbmNlIG1vZGUgKHByaW1hcnl8cHJpbWFyeVByZWZlcnJlZHxzZWNvbmRhcnl8c2Vjb25kYXJ5UHJlZmVycmVkfG5lYXJlc3QpXG4gICAgICogQHBhcmFtIHRhZ3MgLSBBIHRhZyBzZXQgdXNlZCB0byB0YXJnZXQgcmVhZHMgdG8gbWVtYmVycyB3aXRoIHRoZSBzcGVjaWZpZWQgdGFnKHMpLiB0YWdTZXQgaXMgbm90IGF2YWlsYWJsZSBpZiB1c2luZyByZWFkIHByZWZlcmVuY2UgbW9kZSBwcmltYXJ5LlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQWRkaXRpb25hbCByZWFkIHByZWZlcmVuY2Ugb3B0aW9uc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1vZGUsIHRhZ3MsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFSZWFkUHJlZmVyZW5jZS5pc1ZhbGlkKG1vZGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBJbnZhbGlkIHJlYWQgcHJlZmVyZW5jZSBtb2RlICR7SlNPTi5zdHJpbmdpZnkobW9kZSl9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCAmJiB0eXBlb2YgdGFncyA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkodGFncykpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB0YWdzO1xuICAgICAgICAgICAgdGFncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0YWdzICYmICFBcnJheS5pc0FycmF5KHRhZ3MpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdSZWFkUHJlZmVyZW5jZSB0YWdzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgICAgICB0aGlzLnRhZ3MgPSB0YWdzO1xuICAgICAgICB0aGlzLmhlZGdlID0gb3B0aW9ucz8uaGVkZ2U7XG4gICAgICAgIHRoaXMubWF4U3RhbGVuZXNzU2Vjb25kcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5taW5XaXJlVmVyc2lvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPz8ge307XG4gICAgICAgIGlmIChvcHRpb25zLm1heFN0YWxlbmVzc1NlY29uZHMgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4U3RhbGVuZXNzU2Vjb25kcyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignbWF4U3RhbGVuZXNzU2Vjb25kcyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tYXhTdGFsZW5lc3NTZWNvbmRzID0gb3B0aW9ucy5tYXhTdGFsZW5lc3NTZWNvbmRzO1xuICAgICAgICAgICAgLy8gTk9URTogVGhlIG1pbmltdW0gcmVxdWlyZWQgd2lyZSB2ZXJzaW9uIGlzIDUgZm9yIHRoaXMgcmVhZCBwcmVmZXJlbmNlLiBJZiB0aGUgZXhpc3RpbmdcbiAgICAgICAgICAgIC8vICAgICAgIHRvcG9sb2d5IGhhcyBhIGxvd2VyIHZhbHVlIHRoZW4gYSBNb25nb0Vycm9yIHdpbGwgYmUgdGhyb3duIGR1cmluZyBzZXJ2ZXIgc2VsZWN0aW9uLlxuICAgICAgICAgICAgdGhpcy5taW5XaXJlVmVyc2lvbiA9IDU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gUmVhZFByZWZlcmVuY2UuUFJJTUFSWSkge1xuICAgICAgICAgICAgaWYgKHRoaXMudGFncyAmJiBBcnJheS5pc0FycmF5KHRoaXMudGFncykgJiYgdGhpcy50YWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdQcmltYXJ5IHJlYWQgcHJlZmVyZW5jZSBjYW5ub3QgYmUgY29tYmluZWQgd2l0aCB0YWdzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tYXhTdGFsZW5lc3NTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUHJpbWFyeSByZWFkIHByZWZlcmVuY2UgY2Fubm90IGJlIGNvbWJpbmVkIHdpdGggbWF4U3RhbGVuZXNzU2Vjb25kcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaGVkZ2UpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdQcmltYXJ5IHJlYWQgcHJlZmVyZW5jZSBjYW5ub3QgYmUgY29tYmluZWQgd2l0aCBoZWRnZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFN1cHBvcnQgdGhlIGRlcHJlY2F0ZWQgYHByZWZlcmVuY2VgIHByb3BlcnR5IGludHJvZHVjZWQgaW4gdGhlIHBvcmNlbGFpbiBsYXllclxuICAgIGdldCBwcmVmZXJlbmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVN0cmluZyhtb2RlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVhZFByZWZlcmVuY2UobW9kZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBhIFJlYWRQcmVmZXJlbmNlIGdpdmVuIGFuIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBvYmplY3QgZnJvbSB3aGljaCB0byBleHRyYWN0IHRoZSByZWFkIHByZWZlcmVuY2UuXG4gICAgICovXG4gICAgc3RhdGljIGZyb21PcHRpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFvcHRpb25zKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCByZWFkUHJlZmVyZW5jZSA9IG9wdGlvbnMucmVhZFByZWZlcmVuY2UgPz8gb3B0aW9ucy5zZXNzaW9uPy50cmFuc2FjdGlvbi5vcHRpb25zLnJlYWRQcmVmZXJlbmNlO1xuICAgICAgICBjb25zdCByZWFkUHJlZmVyZW5jZVRhZ3MgPSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlVGFncztcbiAgICAgICAgaWYgKHJlYWRQcmVmZXJlbmNlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWFkUHJlZmVyZW5jZShyZWFkUHJlZmVyZW5jZSwgcmVhZFByZWZlcmVuY2VUYWdzLCB7XG4gICAgICAgICAgICAgICAgbWF4U3RhbGVuZXNzU2Vjb25kczogb3B0aW9ucy5tYXhTdGFsZW5lc3NTZWNvbmRzLFxuICAgICAgICAgICAgICAgIGhlZGdlOiBvcHRpb25zLmhlZGdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghKHJlYWRQcmVmZXJlbmNlIGluc3RhbmNlb2YgUmVhZFByZWZlcmVuY2UpICYmIHR5cGVvZiByZWFkUHJlZmVyZW5jZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSByZWFkUHJlZmVyZW5jZS5tb2RlIHx8IHJlYWRQcmVmZXJlbmNlLnByZWZlcmVuY2U7XG4gICAgICAgICAgICBpZiAobW9kZSAmJiB0eXBlb2YgbW9kZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlYWRQcmVmZXJlbmNlKG1vZGUsIHJlYWRQcmVmZXJlbmNlLnRhZ3MgPz8gcmVhZFByZWZlcmVuY2VUYWdzLCB7XG4gICAgICAgICAgICAgICAgICAgIG1heFN0YWxlbmVzc1NlY29uZHM6IHJlYWRQcmVmZXJlbmNlLm1heFN0YWxlbmVzc1NlY29uZHMsXG4gICAgICAgICAgICAgICAgICAgIGhlZGdlOiBvcHRpb25zLmhlZGdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlYWRQcmVmZXJlbmNlVGFncykge1xuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UudGFncyA9IHJlYWRQcmVmZXJlbmNlVGFncztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlcGxhY2VzIG9wdGlvbnMucmVhZFByZWZlcmVuY2Ugd2l0aCBhIFJlYWRQcmVmZXJlbmNlIGluc3RhbmNlXG4gICAgICovXG4gICAgc3RhdGljIHRyYW5zbGF0ZShvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnJlYWRQcmVmZXJlbmNlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgICAgY29uc3QgciA9IG9wdGlvbnMucmVhZFByZWZlcmVuY2U7XG4gICAgICAgIGlmICh0eXBlb2YgciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIG9wdGlvbnMucmVhZFByZWZlcmVuY2UgPSBuZXcgUmVhZFByZWZlcmVuY2Uocik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAociAmJiAhKHIgaW5zdGFuY2VvZiBSZWFkUHJlZmVyZW5jZSkgJiYgdHlwZW9mIHIgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBjb25zdCBtb2RlID0gci5tb2RlIHx8IHIucHJlZmVyZW5jZTtcbiAgICAgICAgICAgIGlmIChtb2RlICYmIHR5cGVvZiBtb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucmVhZFByZWZlcmVuY2UgPSBuZXcgUmVhZFByZWZlcmVuY2UobW9kZSwgci50YWdzLCB7XG4gICAgICAgICAgICAgICAgICAgIG1heFN0YWxlbmVzc1NlY29uZHM6IHIubWF4U3RhbGVuZXNzU2Vjb25kc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCEociBpbnN0YW5jZW9mIFJlYWRQcmVmZXJlbmNlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcihgSW52YWxpZCByZWFkIHByZWZlcmVuY2U6ICR7cn1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgaWYgYSBtb2RlIGlzIGxlZ2FsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbW9kZSAtIFRoZSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSByZWFkIHByZWZlcmVuY2UgbW9kZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgaXNWYWxpZChtb2RlKSB7XG4gICAgICAgIGNvbnN0IFZBTElEX01PREVTID0gbmV3IFNldChbXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5QUklNQVJZLFxuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuUFJJTUFSWV9QUkVGRVJSRUQsXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUlksXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVELFxuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuTkVBUkVTVCxcbiAgICAgICAgICAgIG51bGxcbiAgICAgICAgXSk7XG4gICAgICAgIHJldHVybiBWQUxJRF9NT0RFUy5oYXMobW9kZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIGlmIGEgbW9kZSBpcyBsZWdhbFxuICAgICAqXG4gICAgICogQHBhcmFtIG1vZGUgLSBUaGUgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcmVhZCBwcmVmZXJlbmNlIG1vZGUuXG4gICAgICovXG4gICAgaXNWYWxpZChtb2RlKSB7XG4gICAgICAgIHJldHVybiBSZWFkUHJlZmVyZW5jZS5pc1ZhbGlkKHR5cGVvZiBtb2RlID09PSAnc3RyaW5nJyA/IG1vZGUgOiB0aGlzLm1vZGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmRpY2F0ZXMgdGhhdCB0aGlzIHJlYWRQcmVmZXJlbmNlIG5lZWRzIHRoZSBcIlNlY29uZGFyeU9rXCIgYml0IHdoZW4gc2VudCBvdmVyIHRoZSB3aXJlXG4gICAgICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvbW9uZ29kYi13aXJlLXByb3RvY29sLyNvcC1xdWVyeVxuICAgICAqL1xuICAgIHNlY29uZGFyeU9rKCkge1xuICAgICAgICBjb25zdCBORUVEU19TRUNPTkRBUllPSyA9IG5ldyBTZXQoW1xuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuUFJJTUFSWV9QUkVGRVJSRUQsXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUlksXG4gICAgICAgICAgICBSZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVELFxuICAgICAgICAgICAgUmVhZFByZWZlcmVuY2UuTkVBUkVTVFxuICAgICAgICBdKTtcbiAgICAgICAgcmV0dXJuIE5FRURTX1NFQ09OREFSWU9LLmhhcyh0aGlzLm1vZGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgdHdvIFJlYWRQcmVmZXJlbmNlcyBhcmUgZXF1aXZhbGVudFxuICAgICAqXG4gICAgICogQHBhcmFtIHJlYWRQcmVmZXJlbmNlIC0gVGhlIHJlYWQgcHJlZmVyZW5jZSB3aXRoIHdoaWNoIHRvIGNoZWNrIGVxdWFsaXR5XG4gICAgICovXG4gICAgZXF1YWxzKHJlYWRQcmVmZXJlbmNlKSB7XG4gICAgICAgIHJldHVybiByZWFkUHJlZmVyZW5jZS5tb2RlID09PSB0aGlzLm1vZGU7XG4gICAgfVxuICAgIC8qKiBSZXR1cm4gSlNPTiByZXByZXNlbnRhdGlvbiAqL1xuICAgIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QgcmVhZFByZWZlcmVuY2UgPSB7IG1vZGU6IHRoaXMubW9kZSB9O1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnRhZ3MpKVxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UudGFncyA9IHRoaXMudGFncztcbiAgICAgICAgaWYgKHRoaXMubWF4U3RhbGVuZXNzU2Vjb25kcylcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlLm1heFN0YWxlbmVzc1NlY29uZHMgPSB0aGlzLm1heFN0YWxlbmVzc1NlY29uZHM7XG4gICAgICAgIGlmICh0aGlzLmhlZGdlKVxuICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UuaGVkZ2UgPSB0aGlzLmhlZGdlO1xuICAgICAgICByZXR1cm4gcmVhZFByZWZlcmVuY2U7XG4gICAgfVxufVxuZXhwb3J0cy5SZWFkUHJlZmVyZW5jZSA9IFJlYWRQcmVmZXJlbmNlO1xuUmVhZFByZWZlcmVuY2UuUFJJTUFSWSA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnByaW1hcnk7XG5SZWFkUHJlZmVyZW5jZS5QUklNQVJZX1BSRUZFUlJFRCA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnByaW1hcnlQcmVmZXJyZWQ7XG5SZWFkUHJlZmVyZW5jZS5TRUNPTkRBUlkgPSBleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZS5zZWNvbmRhcnk7XG5SZWFkUHJlZmVyZW5jZS5TRUNPTkRBUllfUFJFRkVSUkVEID0gZXhwb3J0cy5SZWFkUHJlZmVyZW5jZU1vZGUuc2Vjb25kYXJ5UHJlZmVycmVkO1xuUmVhZFByZWZlcmVuY2UuTkVBUkVTVCA9IGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLm5lYXJlc3Q7XG5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5ID0gbmV3IFJlYWRQcmVmZXJlbmNlKGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnByaW1hcnkpO1xuUmVhZFByZWZlcmVuY2UucHJpbWFyeVByZWZlcnJlZCA9IG5ldyBSZWFkUHJlZmVyZW5jZShleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZS5wcmltYXJ5UHJlZmVycmVkKTtcblJlYWRQcmVmZXJlbmNlLnNlY29uZGFyeSA9IG5ldyBSZWFkUHJlZmVyZW5jZShleHBvcnRzLlJlYWRQcmVmZXJlbmNlTW9kZS5zZWNvbmRhcnkpO1xuUmVhZFByZWZlcmVuY2Uuc2Vjb25kYXJ5UHJlZmVycmVkID0gbmV3IFJlYWRQcmVmZXJlbmNlKGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLnNlY29uZGFyeVByZWZlcnJlZCk7XG5SZWFkUHJlZmVyZW5jZS5uZWFyZXN0ID0gbmV3IFJlYWRQcmVmZXJlbmNlKGV4cG9ydHMuUmVhZFByZWZlcmVuY2VNb2RlLm5lYXJlc3QpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVhZF9wcmVmZXJlbmNlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.configureResourceManagement = configureResourceManagement;\nexports.configureExplicitResourceManagement = configureExplicitResourceManagement;\n/** @internal */\nfunction configureResourceManagement(target) {\n    Symbol.asyncDispose &&\n        Object.defineProperty(target, Symbol.asyncDispose, {\n            value: async function asyncDispose() {\n                await this.asyncDispose();\n            },\n            enumerable: false,\n            configurable: true,\n            writable: true\n        });\n}\n/**\n * @beta\n * @experimental\n *\n * Attaches `Symbol.asyncDispose` methods to the MongoClient, Cursors, sessions and change streams\n * if Symbol.asyncDispose is defined.\n *\n * It's usually not necessary to call this method - the driver attempts to attach these methods\n * itself when its loaded.  However, sometimes the driver may be loaded before `Symbol.asyncDispose`\n * is defined, in which case it is necessary to call this method directly.  This can happen if the\n * application is polyfilling `Symbol.asyncDispose`.\n *\n * Example:\n *\n * ```typescript\n * import { configureExplicitResourceManagement, MongoClient } from 'mongodb/lib/beta';\n *\n * Symbol.asyncDispose ??= Symbol('dispose');\n * load();\n *\n * await using client = new MongoClient(...);\n * ```\n */\nfunction configureExplicitResourceManagement() {\n    // We must import lazily here, because there's a circular dependency between the resource management\n    // file and each resources' file.  We could move `configureResourceManagement` to a separate\n    // function, but keeping all resource-management related code together seemed preferable and I chose\n    // lazy requiring of resources instead.\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\n    const { MongoClient } = __webpack_require__(/*! ./mongo_client */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_client.js\");\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\n    const { ClientSession } = __webpack_require__(/*! ./sessions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js\");\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\n    const { AbstractCursor } = __webpack_require__(/*! ./cursor/abstract_cursor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cursor/abstract_cursor.js\");\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\n    const { ChangeStream } = __webpack_require__(/*! ./change_stream */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/change_stream.js\");\n    configureResourceManagement(MongoClient.prototype);\n    configureResourceManagement(ClientSession.prototype);\n    configureResourceManagement(AbstractCursor.prototype);\n    configureResourceManagement(ChangeStream.prototype);\n}\n//# sourceMappingURL=resource_management.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3Jlc291cmNlX21hbmFnZW1lbnQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsbUNBQW1DO0FBQ25DLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtREFBbUQ7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGNBQWMsRUFBRSxtQkFBTyxDQUFDLDBHQUFnQjtBQUNwRDtBQUNBLFlBQVksZ0JBQWdCLEVBQUUsbUJBQU8sQ0FBQyxrR0FBWTtBQUNsRDtBQUNBLFlBQVksaUJBQWlCLEVBQUUsbUJBQU8sQ0FBQyw4SEFBMEI7QUFDakU7QUFDQSxZQUFZLGVBQWUsRUFBRSxtQkFBTyxDQUFDLDRHQUFpQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9yZXNvdXJjZV9tYW5hZ2VtZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jb25maWd1cmVSZXNvdXJjZU1hbmFnZW1lbnQgPSBjb25maWd1cmVSZXNvdXJjZU1hbmFnZW1lbnQ7XG5leHBvcnRzLmNvbmZpZ3VyZUV4cGxpY2l0UmVzb3VyY2VNYW5hZ2VtZW50ID0gY29uZmlndXJlRXhwbGljaXRSZXNvdXJjZU1hbmFnZW1lbnQ7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBjb25maWd1cmVSZXNvdXJjZU1hbmFnZW1lbnQodGFyZ2V0KSB7XG4gICAgU3ltYm9sLmFzeW5jRGlzcG9zZSAmJlxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBTeW1ib2wuYXN5bmNEaXNwb3NlLCB7XG4gICAgICAgICAgICB2YWx1ZTogYXN5bmMgZnVuY3Rpb24gYXN5bmNEaXNwb3NlKCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXN5bmNEaXNwb3NlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbn1cbi8qKlxuICogQGJldGFcbiAqIEBleHBlcmltZW50YWxcbiAqXG4gKiBBdHRhY2hlcyBgU3ltYm9sLmFzeW5jRGlzcG9zZWAgbWV0aG9kcyB0byB0aGUgTW9uZ29DbGllbnQsIEN1cnNvcnMsIHNlc3Npb25zIGFuZCBjaGFuZ2Ugc3RyZWFtc1xuICogaWYgU3ltYm9sLmFzeW5jRGlzcG9zZSBpcyBkZWZpbmVkLlxuICpcbiAqIEl0J3MgdXN1YWxseSBub3QgbmVjZXNzYXJ5IHRvIGNhbGwgdGhpcyBtZXRob2QgLSB0aGUgZHJpdmVyIGF0dGVtcHRzIHRvIGF0dGFjaCB0aGVzZSBtZXRob2RzXG4gKiBpdHNlbGYgd2hlbiBpdHMgbG9hZGVkLiAgSG93ZXZlciwgc29tZXRpbWVzIHRoZSBkcml2ZXIgbWF5IGJlIGxvYWRlZCBiZWZvcmUgYFN5bWJvbC5hc3luY0Rpc3Bvc2VgXG4gKiBpcyBkZWZpbmVkLCBpbiB3aGljaCBjYXNlIGl0IGlzIG5lY2Vzc2FyeSB0byBjYWxsIHRoaXMgbWV0aG9kIGRpcmVjdGx5LiAgVGhpcyBjYW4gaGFwcGVuIGlmIHRoZVxuICogYXBwbGljYXRpb24gaXMgcG9seWZpbGxpbmcgYFN5bWJvbC5hc3luY0Rpc3Bvc2VgLlxuICpcbiAqIEV4YW1wbGU6XG4gKlxuICogYGBgdHlwZXNjcmlwdFxuICogaW1wb3J0IHsgY29uZmlndXJlRXhwbGljaXRSZXNvdXJjZU1hbmFnZW1lbnQsIE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYi9saWIvYmV0YSc7XG4gKlxuICogU3ltYm9sLmFzeW5jRGlzcG9zZSA/Pz0gU3ltYm9sKCdkaXNwb3NlJyk7XG4gKiBsb2FkKCk7XG4gKlxuICogYXdhaXQgdXNpbmcgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KC4uLik7XG4gKiBgYGBcbiAqL1xuZnVuY3Rpb24gY29uZmlndXJlRXhwbGljaXRSZXNvdXJjZU1hbmFnZW1lbnQoKSB7XG4gICAgLy8gV2UgbXVzdCBpbXBvcnQgbGF6aWx5IGhlcmUsIGJlY2F1c2UgdGhlcmUncyBhIGNpcmN1bGFyIGRlcGVuZGVuY3kgYmV0d2VlbiB0aGUgcmVzb3VyY2UgbWFuYWdlbWVudFxuICAgIC8vIGZpbGUgYW5kIGVhY2ggcmVzb3VyY2VzJyBmaWxlLiAgV2UgY291bGQgbW92ZSBgY29uZmlndXJlUmVzb3VyY2VNYW5hZ2VtZW50YCB0byBhIHNlcGFyYXRlXG4gICAgLy8gZnVuY3Rpb24sIGJ1dCBrZWVwaW5nIGFsbCByZXNvdXJjZS1tYW5hZ2VtZW50IHJlbGF0ZWQgY29kZSB0b2dldGhlciBzZWVtZWQgcHJlZmVyYWJsZSBhbmQgSSBjaG9zZVxuICAgIC8vIGxhenkgcmVxdWlyaW5nIG9mIHJlc291cmNlcyBpbnN0ZWFkLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgY29uc3QgeyBNb25nb0NsaWVudCB9ID0gcmVxdWlyZSgnLi9tb25nb19jbGllbnQnKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlcXVpcmUtaW1wb3J0c1xuICAgIGNvbnN0IHsgQ2xpZW50U2Vzc2lvbiB9ID0gcmVxdWlyZSgnLi9zZXNzaW9ucycpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgY29uc3QgeyBBYnN0cmFjdEN1cnNvciB9ID0gcmVxdWlyZSgnLi9jdXJzb3IvYWJzdHJhY3RfY3Vyc29yJyk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHNcbiAgICBjb25zdCB7IENoYW5nZVN0cmVhbSB9ID0gcmVxdWlyZSgnLi9jaGFuZ2Vfc3RyZWFtJyk7XG4gICAgY29uZmlndXJlUmVzb3VyY2VNYW5hZ2VtZW50KE1vbmdvQ2xpZW50LnByb3RvdHlwZSk7XG4gICAgY29uZmlndXJlUmVzb3VyY2VNYW5hZ2VtZW50KENsaWVudFNlc3Npb24ucHJvdG90eXBlKTtcbiAgICBjb25maWd1cmVSZXNvdXJjZU1hbmFnZW1lbnQoQWJzdHJhY3RDdXJzb3IucHJvdG90eXBlKTtcbiAgICBjb25maWd1cmVSZXNvdXJjZU1hbmFnZW1lbnQoQ2hhbmdlU3RyZWFtLnByb3RvdHlwZSk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZXNvdXJjZV9tYW5hZ2VtZW50LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerType = exports.TopologyType = exports.STATE_CONNECTED = exports.STATE_CONNECTING = exports.STATE_CLOSED = exports.STATE_CLOSING = void 0;\nexports._advanceClusterTime = _advanceClusterTime;\n// shared state names\nexports.STATE_CLOSING = 'closing';\nexports.STATE_CLOSED = 'closed';\nexports.STATE_CONNECTING = 'connecting';\nexports.STATE_CONNECTED = 'connected';\n/**\n * An enumeration of topology types we know about\n * @public\n */\nexports.TopologyType = Object.freeze({\n    Single: 'Single',\n    ReplicaSetNoPrimary: 'ReplicaSetNoPrimary',\n    ReplicaSetWithPrimary: 'ReplicaSetWithPrimary',\n    Sharded: 'Sharded',\n    Unknown: 'Unknown',\n    LoadBalanced: 'LoadBalanced'\n});\n/**\n * An enumeration of server types we know about\n * @public\n */\nexports.ServerType = Object.freeze({\n    Standalone: 'Standalone',\n    Mongos: 'Mongos',\n    PossiblePrimary: 'PossiblePrimary',\n    RSPrimary: 'RSPrimary',\n    RSSecondary: 'RSSecondary',\n    RSArbiter: 'RSArbiter',\n    RSOther: 'RSOther',\n    RSGhost: 'RSGhost',\n    Unknown: 'Unknown',\n    LoadBalancer: 'LoadBalancer'\n});\n/** Shared function to determine clusterTime for a given topology or session */\nfunction _advanceClusterTime(entity, $clusterTime) {\n    if (entity.clusterTime == null) {\n        entity.clusterTime = $clusterTime;\n    }\n    else {\n        if ($clusterTime.clusterTime.greaterThan(entity.clusterTime.clusterTime)) {\n            entity.clusterTime = $clusterTime;\n        }\n    }\n}\n//# sourceMappingURL=common.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vY29tbW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGtCQUFrQixHQUFHLG9CQUFvQixHQUFHLHVCQUF1QixHQUFHLHdCQUF3QixHQUFHLG9CQUFvQixHQUFHLHFCQUFxQjtBQUM3SSwyQkFBMkI7QUFDM0I7QUFDQSxxQkFBcUI7QUFDckIsb0JBQW9CO0FBQ3BCLHdCQUF3QjtBQUN4Qix1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vY29tbW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXJ2ZXJUeXBlID0gZXhwb3J0cy5Ub3BvbG9neVR5cGUgPSBleHBvcnRzLlNUQVRFX0NPTk5FQ1RFRCA9IGV4cG9ydHMuU1RBVEVfQ09OTkVDVElORyA9IGV4cG9ydHMuU1RBVEVfQ0xPU0VEID0gZXhwb3J0cy5TVEFURV9DTE9TSU5HID0gdm9pZCAwO1xuZXhwb3J0cy5fYWR2YW5jZUNsdXN0ZXJUaW1lID0gX2FkdmFuY2VDbHVzdGVyVGltZTtcbi8vIHNoYXJlZCBzdGF0ZSBuYW1lc1xuZXhwb3J0cy5TVEFURV9DTE9TSU5HID0gJ2Nsb3NpbmcnO1xuZXhwb3J0cy5TVEFURV9DTE9TRUQgPSAnY2xvc2VkJztcbmV4cG9ydHMuU1RBVEVfQ09OTkVDVElORyA9ICdjb25uZWN0aW5nJztcbmV4cG9ydHMuU1RBVEVfQ09OTkVDVEVEID0gJ2Nvbm5lY3RlZCc7XG4vKipcbiAqIEFuIGVudW1lcmF0aW9uIG9mIHRvcG9sb2d5IHR5cGVzIHdlIGtub3cgYWJvdXRcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5Ub3BvbG9neVR5cGUgPSBPYmplY3QuZnJlZXplKHtcbiAgICBTaW5nbGU6ICdTaW5nbGUnLFxuICAgIFJlcGxpY2FTZXROb1ByaW1hcnk6ICdSZXBsaWNhU2V0Tm9QcmltYXJ5JyxcbiAgICBSZXBsaWNhU2V0V2l0aFByaW1hcnk6ICdSZXBsaWNhU2V0V2l0aFByaW1hcnknLFxuICAgIFNoYXJkZWQ6ICdTaGFyZGVkJyxcbiAgICBVbmtub3duOiAnVW5rbm93bicsXG4gICAgTG9hZEJhbGFuY2VkOiAnTG9hZEJhbGFuY2VkJ1xufSk7XG4vKipcbiAqIEFuIGVudW1lcmF0aW9uIG9mIHNlcnZlciB0eXBlcyB3ZSBrbm93IGFib3V0XG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydHMuU2VydmVyVHlwZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIFN0YW5kYWxvbmU6ICdTdGFuZGFsb25lJyxcbiAgICBNb25nb3M6ICdNb25nb3MnLFxuICAgIFBvc3NpYmxlUHJpbWFyeTogJ1Bvc3NpYmxlUHJpbWFyeScsXG4gICAgUlNQcmltYXJ5OiAnUlNQcmltYXJ5JyxcbiAgICBSU1NlY29uZGFyeTogJ1JTU2Vjb25kYXJ5JyxcbiAgICBSU0FyYml0ZXI6ICdSU0FyYml0ZXInLFxuICAgIFJTT3RoZXI6ICdSU090aGVyJyxcbiAgICBSU0dob3N0OiAnUlNHaG9zdCcsXG4gICAgVW5rbm93bjogJ1Vua25vd24nLFxuICAgIExvYWRCYWxhbmNlcjogJ0xvYWRCYWxhbmNlcidcbn0pO1xuLyoqIFNoYXJlZCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgY2x1c3RlclRpbWUgZm9yIGEgZ2l2ZW4gdG9wb2xvZ3kgb3Igc2Vzc2lvbiAqL1xuZnVuY3Rpb24gX2FkdmFuY2VDbHVzdGVyVGltZShlbnRpdHksICRjbHVzdGVyVGltZSkge1xuICAgIGlmIChlbnRpdHkuY2x1c3RlclRpbWUgPT0gbnVsbCkge1xuICAgICAgICBlbnRpdHkuY2x1c3RlclRpbWUgPSAkY2x1c3RlclRpbWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoJGNsdXN0ZXJUaW1lLmNsdXN0ZXJUaW1lLmdyZWF0ZXJUaGFuKGVudGl0eS5jbHVzdGVyVGltZS5jbHVzdGVyVGltZSkpIHtcbiAgICAgICAgICAgIGVudGl0eS5jbHVzdGVyVGltZSA9ICRjbHVzdGVyVGltZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbW1vbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/events.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/events.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerHeartbeatFailedEvent = exports.ServerHeartbeatSucceededEvent = exports.ServerHeartbeatStartedEvent = exports.TopologyClosedEvent = exports.TopologyOpeningEvent = exports.TopologyDescriptionChangedEvent = exports.ServerClosedEvent = exports.ServerOpeningEvent = exports.ServerDescriptionChangedEvent = void 0;\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\n/**\n * Emitted when server description changes, but does NOT include changes to the RTT.\n * @public\n * @category Event\n */\nclass ServerDescriptionChangedEvent {\n    /** @internal */\n    constructor(topologyId, address, previousDescription, newDescription) {\n        this.name = constants_1.SERVER_DESCRIPTION_CHANGED;\n        this.topologyId = topologyId;\n        this.address = address;\n        this.previousDescription = previousDescription;\n        this.newDescription = newDescription;\n    }\n}\nexports.ServerDescriptionChangedEvent = ServerDescriptionChangedEvent;\n/**\n * Emitted when server is initialized.\n * @public\n * @category Event\n */\nclass ServerOpeningEvent {\n    /** @internal */\n    constructor(topologyId, address) {\n        /** @internal */\n        this.name = constants_1.SERVER_OPENING;\n        this.topologyId = topologyId;\n        this.address = address;\n    }\n}\nexports.ServerOpeningEvent = ServerOpeningEvent;\n/**\n * Emitted when server is closed.\n * @public\n * @category Event\n */\nclass ServerClosedEvent {\n    /** @internal */\n    constructor(topologyId, address) {\n        /** @internal */\n        this.name = constants_1.SERVER_CLOSED;\n        this.topologyId = topologyId;\n        this.address = address;\n    }\n}\nexports.ServerClosedEvent = ServerClosedEvent;\n/**\n * Emitted when topology description changes.\n * @public\n * @category Event\n */\nclass TopologyDescriptionChangedEvent {\n    /** @internal */\n    constructor(topologyId, previousDescription, newDescription) {\n        /** @internal */\n        this.name = constants_1.TOPOLOGY_DESCRIPTION_CHANGED;\n        this.topologyId = topologyId;\n        this.previousDescription = previousDescription;\n        this.newDescription = newDescription;\n    }\n}\nexports.TopologyDescriptionChangedEvent = TopologyDescriptionChangedEvent;\n/**\n * Emitted when topology is initialized.\n * @public\n * @category Event\n */\nclass TopologyOpeningEvent {\n    /** @internal */\n    constructor(topologyId) {\n        /** @internal */\n        this.name = constants_1.TOPOLOGY_OPENING;\n        this.topologyId = topologyId;\n    }\n}\nexports.TopologyOpeningEvent = TopologyOpeningEvent;\n/**\n * Emitted when topology is closed.\n * @public\n * @category Event\n */\nclass TopologyClosedEvent {\n    /** @internal */\n    constructor(topologyId) {\n        /** @internal */\n        this.name = constants_1.TOPOLOGY_CLOSED;\n        this.topologyId = topologyId;\n    }\n}\nexports.TopologyClosedEvent = TopologyClosedEvent;\n/**\n * Emitted when the server monitor’s hello command is started - immediately before\n * the hello command is serialized into raw BSON and written to the socket.\n *\n * @public\n * @category Event\n */\nclass ServerHeartbeatStartedEvent {\n    /** @internal */\n    constructor(connectionId, awaited) {\n        /** @internal */\n        this.name = constants_1.SERVER_HEARTBEAT_STARTED;\n        this.connectionId = connectionId;\n        this.awaited = awaited;\n    }\n}\nexports.ServerHeartbeatStartedEvent = ServerHeartbeatStartedEvent;\n/**\n * Emitted when the server monitor’s hello succeeds.\n * @public\n * @category Event\n */\nclass ServerHeartbeatSucceededEvent {\n    /** @internal */\n    constructor(connectionId, duration, reply, awaited) {\n        /** @internal */\n        this.name = constants_1.SERVER_HEARTBEAT_SUCCEEDED;\n        this.connectionId = connectionId;\n        this.duration = duration;\n        this.reply = reply ?? {};\n        this.awaited = awaited;\n    }\n}\nexports.ServerHeartbeatSucceededEvent = ServerHeartbeatSucceededEvent;\n/**\n * Emitted when the server monitor’s hello fails, either with an “ok: 0” or a socket exception.\n * @public\n * @category Event\n */\nclass ServerHeartbeatFailedEvent {\n    /** @internal */\n    constructor(connectionId, duration, failure, awaited) {\n        /** @internal */\n        this.name = constants_1.SERVER_HEARTBEAT_FAILED;\n        this.connectionId = connectionId;\n        this.duration = duration;\n        this.failure = failure;\n        this.awaited = awaited;\n    }\n}\nexports.ServerHeartbeatFailedEvent = ServerHeartbeatFailedEvent;\n//# sourceMappingURL=events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vZXZlbnRzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGtDQUFrQyxHQUFHLHFDQUFxQyxHQUFHLG1DQUFtQyxHQUFHLDJCQUEyQixHQUFHLDRCQUE0QixHQUFHLHVDQUF1QyxHQUFHLHlCQUF5QixHQUFHLDBCQUEwQixHQUFHLHFDQUFxQztBQUN4VCxvQkFBb0IsbUJBQU8sQ0FBQyxxR0FBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQyIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vZXZlbnRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXJ2ZXJIZWFydGJlYXRGYWlsZWRFdmVudCA9IGV4cG9ydHMuU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudCA9IGV4cG9ydHMuVG9wb2xvZ3lDbG9zZWRFdmVudCA9IGV4cG9ydHMuVG9wb2xvZ3lPcGVuaW5nRXZlbnQgPSBleHBvcnRzLlRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlNlcnZlckNsb3NlZEV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJPcGVuaW5nRXZlbnQgPSBleHBvcnRzLlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50ID0gdm9pZCAwO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gc2VydmVyIGRlc2NyaXB0aW9uIGNoYW5nZXMsIGJ1dCBkb2VzIE5PVCBpbmNsdWRlIGNoYW5nZXMgdG8gdGhlIFJUVC5cbiAqIEBwdWJsaWNcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBTZXJ2ZXJEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5SWQsIGFkZHJlc3MsIHByZXZpb3VzRGVzY3JpcHRpb24sIG5ld0Rlc2NyaXB0aW9uKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlNFUlZFUl9ERVNDUklQVElPTl9DSEFOR0VEO1xuICAgICAgICB0aGlzLnRvcG9sb2d5SWQgPSB0b3BvbG9neUlkO1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgICAgICB0aGlzLnByZXZpb3VzRGVzY3JpcHRpb24gPSBwcmV2aW91c0Rlc2NyaXB0aW9uO1xuICAgICAgICB0aGlzLm5ld0Rlc2NyaXB0aW9uID0gbmV3RGVzY3JpcHRpb247XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCA9IFNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gc2VydmVyIGlzIGluaXRpYWxpemVkLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFNlcnZlck9wZW5pbmdFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5SWQsIGFkZHJlc3MpIHtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5TRVJWRVJfT1BFTklORztcbiAgICAgICAgdGhpcy50b3BvbG9neUlkID0gdG9wb2xvZ3lJZDtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlck9wZW5pbmdFdmVudCA9IFNlcnZlck9wZW5pbmdFdmVudDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHNlcnZlciBpcyBjbG9zZWQuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVyQ2xvc2VkRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcih0b3BvbG9neUlkLCBhZGRyZXNzKSB7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuU0VSVkVSX0NMT1NFRDtcbiAgICAgICAgdGhpcy50b3BvbG9neUlkID0gdG9wb2xvZ3lJZDtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlckNsb3NlZEV2ZW50ID0gU2VydmVyQ2xvc2VkRXZlbnQ7XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiB0b3BvbG9neSBkZXNjcmlwdGlvbiBjaGFuZ2VzLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcih0b3BvbG9neUlkLCBwcmV2aW91c0Rlc2NyaXB0aW9uLCBuZXdEZXNjcmlwdGlvbikge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQ7XG4gICAgICAgIHRoaXMudG9wb2xvZ3lJZCA9IHRvcG9sb2d5SWQ7XG4gICAgICAgIHRoaXMucHJldmlvdXNEZXNjcmlwdGlvbiA9IHByZXZpb3VzRGVzY3JpcHRpb247XG4gICAgICAgIHRoaXMubmV3RGVzY3JpcHRpb24gPSBuZXdEZXNjcmlwdGlvbjtcbiAgICB9XG59XG5leHBvcnRzLlRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQgPSBUb3BvbG9neURlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gdG9wb2xvZ3kgaXMgaW5pdGlhbGl6ZWQuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgVG9wb2xvZ3lPcGVuaW5nRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcih0b3BvbG9neUlkKSB7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuVE9QT0xPR1lfT1BFTklORztcbiAgICAgICAgdGhpcy50b3BvbG9neUlkID0gdG9wb2xvZ3lJZDtcbiAgICB9XG59XG5leHBvcnRzLlRvcG9sb2d5T3BlbmluZ0V2ZW50ID0gVG9wb2xvZ3lPcGVuaW5nRXZlbnQ7XG4vKipcbiAqIEVtaXR0ZWQgd2hlbiB0b3BvbG9neSBpcyBjbG9zZWQuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgVG9wb2xvZ3lDbG9zZWRFdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5SWQpIHtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25zdGFudHNfMS5UT1BPTE9HWV9DTE9TRUQ7XG4gICAgICAgIHRoaXMudG9wb2xvZ3lJZCA9IHRvcG9sb2d5SWQ7XG4gICAgfVxufVxuZXhwb3J0cy5Ub3BvbG9neUNsb3NlZEV2ZW50ID0gVG9wb2xvZ3lDbG9zZWRFdmVudDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHRoZSBzZXJ2ZXIgbW9uaXRvcuKAmXMgaGVsbG8gY29tbWFuZCBpcyBzdGFydGVkIC0gaW1tZWRpYXRlbHkgYmVmb3JlXG4gKiB0aGUgaGVsbG8gY29tbWFuZCBpcyBzZXJpYWxpemVkIGludG8gcmF3IEJTT04gYW5kIHdyaXR0ZW4gdG8gdGhlIHNvY2tldC5cbiAqXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVySGVhcnRiZWF0U3RhcnRlZEV2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY29ubmVjdGlvbklkLCBhd2FpdGVkKSB7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuU0VSVkVSX0hFQVJUQkVBVF9TVEFSVEVEO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5hd2FpdGVkID0gYXdhaXRlZDtcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudCA9IFNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudDtcbi8qKlxuICogRW1pdHRlZCB3aGVuIHRoZSBzZXJ2ZXIgbW9uaXRvcuKAmXMgaGVsbG8gc3VjY2VlZHMuXG4gKiBAcHVibGljXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVySGVhcnRiZWF0U3VjY2VlZGVkRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uSWQsIGR1cmF0aW9uLCByZXBseSwgYXdhaXRlZCkge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVEO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgICB0aGlzLnJlcGx5ID0gcmVwbHkgPz8ge307XG4gICAgICAgIHRoaXMuYXdhaXRlZCA9IGF3YWl0ZWQ7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJIZWFydGJlYXRTdWNjZWVkZWRFdmVudCA9IFNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50O1xuLyoqXG4gKiBFbWl0dGVkIHdoZW4gdGhlIHNlcnZlciBtb25pdG9y4oCZcyBoZWxsbyBmYWlscywgZWl0aGVyIHdpdGggYW4g4oCcb2s6IDDigJ0gb3IgYSBzb2NrZXQgZXhjZXB0aW9uLlxuICogQHB1YmxpY1xuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFNlcnZlckhlYXJ0YmVhdEZhaWxlZEV2ZW50IHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY29ubmVjdGlvbklkLCBkdXJhdGlvbiwgZmFpbHVyZSwgYXdhaXRlZCkge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVEO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgICB0aGlzLmZhaWx1cmUgPSBmYWlsdXJlO1xuICAgICAgICB0aGlzLmF3YWl0ZWQgPSBhd2FpdGVkO1xuICAgIH1cbn1cbmV4cG9ydHMuU2VydmVySGVhcnRiZWF0RmFpbGVkRXZlbnQgPSBTZXJ2ZXJIZWFydGJlYXRGYWlsZWRFdmVudDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV2ZW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/events.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/monitor.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/monitor.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RTTSampler = exports.MonitorInterval = exports.RTTPinger = exports.Monitor = exports.ServerMonitoringMode = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst connect_1 = __webpack_require__(/*! ../cmap/connect */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connect.js\");\nconst client_metadata_1 = __webpack_require__(/*! ../cmap/handshake/client_metadata */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/handshake/client_metadata.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ../mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst events_1 = __webpack_require__(/*! ./events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/events.js\");\nconst server_1 = __webpack_require__(/*! ./server */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server.js\");\nconst STATE_IDLE = 'idle';\nconst STATE_MONITORING = 'monitoring';\nconst stateTransition = (0, utils_1.makeStateMachine)({\n    [common_1.STATE_CLOSING]: [common_1.STATE_CLOSING, STATE_IDLE, common_1.STATE_CLOSED],\n    [common_1.STATE_CLOSED]: [common_1.STATE_CLOSED, STATE_MONITORING],\n    [STATE_IDLE]: [STATE_IDLE, STATE_MONITORING, common_1.STATE_CLOSING],\n    [STATE_MONITORING]: [STATE_MONITORING, STATE_IDLE, common_1.STATE_CLOSING]\n});\nconst INVALID_REQUEST_CHECK_STATES = new Set([common_1.STATE_CLOSING, common_1.STATE_CLOSED, STATE_MONITORING]);\nfunction isInCloseState(monitor) {\n    return monitor.s.state === common_1.STATE_CLOSED || monitor.s.state === common_1.STATE_CLOSING;\n}\n/** @public */\nexports.ServerMonitoringMode = Object.freeze({\n    auto: 'auto',\n    poll: 'poll',\n    stream: 'stream'\n});\n/** @internal */\nclass Monitor extends mongo_types_1.TypedEventEmitter {\n    constructor(server, options) {\n        super();\n        /** @internal */\n        this.component = mongo_logger_1.MongoLoggableComponent.TOPOLOGY;\n        this.on('error', utils_1.noop);\n        this.server = server;\n        this.connection = null;\n        this.cancellationToken = new mongo_types_1.CancellationToken();\n        this.cancellationToken.setMaxListeners(Infinity);\n        this.monitorId = undefined;\n        this.s = {\n            state: common_1.STATE_CLOSED\n        };\n        this.address = server.description.address;\n        this.options = Object.freeze({\n            connectTimeoutMS: options.connectTimeoutMS ?? 10000,\n            heartbeatFrequencyMS: options.heartbeatFrequencyMS ?? 10000,\n            minHeartbeatFrequencyMS: options.minHeartbeatFrequencyMS ?? 500,\n            serverMonitoringMode: options.serverMonitoringMode\n        });\n        this.isRunningInFaasEnv = (0, client_metadata_1.getFAASEnv)() != null;\n        this.mongoLogger = this.server.topology.client?.mongoLogger;\n        this.rttSampler = new RTTSampler(10);\n        const cancellationToken = this.cancellationToken;\n        // TODO: refactor this to pull it directly from the pool, requires new ConnectionPool integration\n        const connectOptions = {\n            id: '<monitor>',\n            generation: server.pool.generation,\n            cancellationToken,\n            hostAddress: server.description.hostAddress,\n            ...options,\n            // force BSON serialization options\n            raw: false,\n            useBigInt64: false,\n            promoteLongs: true,\n            promoteValues: true,\n            promoteBuffers: true\n        };\n        // ensure no authentication is used for monitoring\n        delete connectOptions.credentials;\n        if (connectOptions.autoEncrypter) {\n            delete connectOptions.autoEncrypter;\n        }\n        this.connectOptions = Object.freeze(connectOptions);\n    }\n    connect() {\n        if (this.s.state !== common_1.STATE_CLOSED) {\n            return;\n        }\n        // start\n        const heartbeatFrequencyMS = this.options.heartbeatFrequencyMS;\n        const minHeartbeatFrequencyMS = this.options.minHeartbeatFrequencyMS;\n        this.monitorId = new MonitorInterval(monitorServer(this), {\n            heartbeatFrequencyMS: heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: minHeartbeatFrequencyMS,\n            immediate: true\n        });\n    }\n    requestCheck() {\n        if (INVALID_REQUEST_CHECK_STATES.has(this.s.state)) {\n            return;\n        }\n        this.monitorId?.wake();\n    }\n    reset() {\n        const topologyVersion = this.server.description.topologyVersion;\n        if (isInCloseState(this) || topologyVersion == null) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CLOSING);\n        resetMonitorState(this);\n        // restart monitor\n        stateTransition(this, STATE_IDLE);\n        // restart monitoring\n        const heartbeatFrequencyMS = this.options.heartbeatFrequencyMS;\n        const minHeartbeatFrequencyMS = this.options.minHeartbeatFrequencyMS;\n        this.monitorId = new MonitorInterval(monitorServer(this), {\n            heartbeatFrequencyMS: heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: minHeartbeatFrequencyMS\n        });\n    }\n    close() {\n        if (isInCloseState(this)) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CLOSING);\n        resetMonitorState(this);\n        // close monitor\n        this.emit('close');\n        stateTransition(this, common_1.STATE_CLOSED);\n    }\n    get roundTripTime() {\n        return this.rttSampler.average();\n    }\n    get minRoundTripTime() {\n        return this.rttSampler.min();\n    }\n    get latestRtt() {\n        return this.rttSampler.last;\n    }\n    addRttSample(rtt) {\n        this.rttSampler.addSample(rtt);\n    }\n    clearRttSamples() {\n        this.rttSampler.clear();\n    }\n}\nexports.Monitor = Monitor;\nfunction resetMonitorState(monitor) {\n    monitor.monitorId?.stop();\n    monitor.monitorId = undefined;\n    monitor.rttPinger?.close();\n    monitor.rttPinger = undefined;\n    monitor.cancellationToken.emit('cancel');\n    monitor.connection?.destroy();\n    monitor.connection = null;\n    monitor.clearRttSamples();\n}\nfunction useStreamingProtocol(monitor, topologyVersion) {\n    // If we have no topology version we always poll no matter\n    // what the user provided, since the server does not support\n    // the streaming protocol.\n    if (topologyVersion == null)\n        return false;\n    const serverMonitoringMode = monitor.options.serverMonitoringMode;\n    if (serverMonitoringMode === exports.ServerMonitoringMode.poll)\n        return false;\n    if (serverMonitoringMode === exports.ServerMonitoringMode.stream)\n        return true;\n    // If we are in auto mode, we need to figure out if we're in a FaaS\n    // environment or not and choose the appropriate mode.\n    if (monitor.isRunningInFaasEnv)\n        return false;\n    return true;\n}\nfunction checkServer(monitor, callback) {\n    let start;\n    let awaited;\n    const topologyVersion = monitor.server.description.topologyVersion;\n    const isAwaitable = useStreamingProtocol(monitor, topologyVersion);\n    monitor.emitAndLogHeartbeat(server_1.Server.SERVER_HEARTBEAT_STARTED, monitor.server.topology.s.id, undefined, new events_1.ServerHeartbeatStartedEvent(monitor.address, isAwaitable));\n    function onHeartbeatFailed(err) {\n        monitor.connection?.destroy();\n        monitor.connection = null;\n        monitor.emitAndLogHeartbeat(server_1.Server.SERVER_HEARTBEAT_FAILED, monitor.server.topology.s.id, undefined, new events_1.ServerHeartbeatFailedEvent(monitor.address, (0, utils_1.calculateDurationInMs)(start), err, awaited));\n        const error = !(err instanceof error_1.MongoError)\n            ? new error_1.MongoError(error_1.MongoError.buildErrorMessage(err), { cause: err })\n            : err;\n        error.addErrorLabel(error_1.MongoErrorLabel.ResetPool);\n        if (error instanceof error_1.MongoNetworkTimeoutError) {\n            error.addErrorLabel(error_1.MongoErrorLabel.InterruptInUseConnections);\n        }\n        monitor.emit('resetServer', error);\n        callback(err);\n    }\n    function onHeartbeatSucceeded(hello) {\n        if (!('isWritablePrimary' in hello)) {\n            // Provide hello-style response document.\n            hello.isWritablePrimary = hello[constants_1.LEGACY_HELLO_COMMAND];\n        }\n        // NOTE: here we use the latestRtt as this measurement corresponds with the value\n        // obtained for this successful heartbeat, if there is no latestRtt, then we calculate the\n        // duration\n        const duration = isAwaitable && monitor.rttPinger\n            ? (monitor.rttPinger.latestRtt ?? (0, utils_1.calculateDurationInMs)(start))\n            : (0, utils_1.calculateDurationInMs)(start);\n        monitor.addRttSample(duration);\n        monitor.emitAndLogHeartbeat(server_1.Server.SERVER_HEARTBEAT_SUCCEEDED, monitor.server.topology.s.id, hello.connectionId, new events_1.ServerHeartbeatSucceededEvent(monitor.address, duration, hello, isAwaitable));\n        if (isAwaitable) {\n            // If we are using the streaming protocol then we immediately issue another 'started'\n            // event, otherwise the \"check\" is complete and return to the main monitor loop\n            monitor.emitAndLogHeartbeat(server_1.Server.SERVER_HEARTBEAT_STARTED, monitor.server.topology.s.id, undefined, new events_1.ServerHeartbeatStartedEvent(monitor.address, true));\n            // We have not actually sent an outgoing handshake, but when we get the next response we\n            // want the duration to reflect the time since we last heard from the server\n            start = (0, utils_1.now)();\n        }\n        else {\n            monitor.rttPinger?.close();\n            monitor.rttPinger = undefined;\n            callback(undefined, hello);\n        }\n    }\n    const { connection } = monitor;\n    if (connection && !connection.closed) {\n        const { serverApi, helloOk } = connection;\n        const connectTimeoutMS = monitor.options.connectTimeoutMS;\n        const maxAwaitTimeMS = monitor.options.heartbeatFrequencyMS;\n        const cmd = {\n            [serverApi?.version || helloOk ? 'hello' : constants_1.LEGACY_HELLO_COMMAND]: 1,\n            ...(isAwaitable && topologyVersion\n                ? { maxAwaitTimeMS, topologyVersion: makeTopologyVersion(topologyVersion) }\n                : {})\n        };\n        const options = isAwaitable\n            ? {\n                socketTimeoutMS: connectTimeoutMS ? connectTimeoutMS + maxAwaitTimeMS : 0,\n                exhaustAllowed: true\n            }\n            : { socketTimeoutMS: connectTimeoutMS };\n        if (isAwaitable && monitor.rttPinger == null) {\n            monitor.rttPinger = new RTTPinger(monitor);\n        }\n        // Record new start time before sending handshake\n        start = (0, utils_1.now)();\n        if (isAwaitable) {\n            awaited = true;\n            return connection.exhaustCommand((0, utils_1.ns)('admin.$cmd'), cmd, options, (error, hello) => {\n                if (error)\n                    return onHeartbeatFailed(error);\n                return onHeartbeatSucceeded(hello);\n            });\n        }\n        awaited = false;\n        connection\n            .command((0, utils_1.ns)('admin.$cmd'), cmd, options)\n            .then(onHeartbeatSucceeded, onHeartbeatFailed);\n        return;\n    }\n    // connecting does an implicit `hello`\n    (async () => {\n        const socket = await (0, connect_1.makeSocket)(monitor.connectOptions);\n        const connection = (0, connect_1.makeConnection)(monitor.connectOptions, socket);\n        // The start time is after socket creation but before the handshake\n        start = (0, utils_1.now)();\n        try {\n            await (0, connect_1.performInitialHandshake)(connection, monitor.connectOptions);\n            return connection;\n        }\n        catch (error) {\n            connection.destroy();\n            throw error;\n        }\n    })().then(connection => {\n        if (isInCloseState(monitor)) {\n            connection.destroy();\n            return;\n        }\n        const duration = (0, utils_1.calculateDurationInMs)(start);\n        monitor.addRttSample(duration);\n        monitor.connection = connection;\n        monitor.emitAndLogHeartbeat(server_1.Server.SERVER_HEARTBEAT_SUCCEEDED, monitor.server.topology.s.id, connection.hello?.connectionId, new events_1.ServerHeartbeatSucceededEvent(monitor.address, duration, connection.hello, useStreamingProtocol(monitor, connection.hello?.topologyVersion)));\n        callback(undefined, connection.hello);\n    }, error => {\n        monitor.connection = null;\n        awaited = false;\n        onHeartbeatFailed(error);\n    });\n}\nfunction monitorServer(monitor) {\n    return (callback) => {\n        if (monitor.s.state === STATE_MONITORING) {\n            process.nextTick(callback);\n            return;\n        }\n        stateTransition(monitor, STATE_MONITORING);\n        function done() {\n            if (!isInCloseState(monitor)) {\n                stateTransition(monitor, STATE_IDLE);\n            }\n            callback();\n        }\n        checkServer(monitor, (err, hello) => {\n            if (err) {\n                // otherwise an error occurred on initial discovery, also bail\n                if (monitor.server.description.type === common_1.ServerType.Unknown) {\n                    return done();\n                }\n            }\n            // if the check indicates streaming is supported, immediately reschedule monitoring\n            if (useStreamingProtocol(monitor, hello?.topologyVersion)) {\n                (0, timers_1.setTimeout)(() => {\n                    if (!isInCloseState(monitor)) {\n                        monitor.monitorId?.wake();\n                    }\n                }, 0);\n            }\n            done();\n        });\n    };\n}\nfunction makeTopologyVersion(tv) {\n    return {\n        processId: tv.processId,\n        // tests mock counter as just number, but in a real situation counter should always be a Long\n        // TODO(NODE-2674): Preserve int64 sent from MongoDB\n        counter: bson_1.Long.isLong(tv.counter) ? tv.counter : bson_1.Long.fromNumber(tv.counter)\n    };\n}\n/** @internal */\nclass RTTPinger {\n    constructor(monitor) {\n        this.connection = undefined;\n        this.cancellationToken = monitor.cancellationToken;\n        this.closed = false;\n        this.monitor = monitor;\n        this.latestRtt = monitor.latestRtt ?? undefined;\n        const heartbeatFrequencyMS = monitor.options.heartbeatFrequencyMS;\n        this.monitorId = (0, timers_1.setTimeout)(() => this.measureRoundTripTime(), heartbeatFrequencyMS);\n    }\n    get roundTripTime() {\n        return this.monitor.roundTripTime;\n    }\n    get minRoundTripTime() {\n        return this.monitor.minRoundTripTime;\n    }\n    close() {\n        this.closed = true;\n        (0, timers_1.clearTimeout)(this.monitorId);\n        this.connection?.destroy();\n        this.connection = undefined;\n    }\n    measureAndReschedule(start, conn) {\n        if (this.closed) {\n            conn?.destroy();\n            return;\n        }\n        if (this.connection == null) {\n            this.connection = conn;\n        }\n        this.latestRtt = (0, utils_1.calculateDurationInMs)(start);\n        this.monitorId = (0, timers_1.setTimeout)(() => this.measureRoundTripTime(), this.monitor.options.heartbeatFrequencyMS);\n    }\n    measureRoundTripTime() {\n        const start = (0, utils_1.now)();\n        if (this.closed) {\n            return;\n        }\n        const connection = this.connection;\n        if (connection == null) {\n            (0, connect_1.connect)(this.monitor.connectOptions).then(connection => {\n                this.measureAndReschedule(start, connection);\n            }, () => {\n                this.connection = undefined;\n            });\n            return;\n        }\n        const commandName = connection.serverApi?.version || connection.helloOk ? 'hello' : constants_1.LEGACY_HELLO_COMMAND;\n        connection.command((0, utils_1.ns)('admin.$cmd'), { [commandName]: 1 }, undefined).then(() => this.measureAndReschedule(start), () => {\n            this.connection?.destroy();\n            this.connection = undefined;\n            return;\n        });\n    }\n}\nexports.RTTPinger = RTTPinger;\n/**\n * @internal\n */\nclass MonitorInterval {\n    constructor(fn, options = {}) {\n        this.isExpeditedCallToFnScheduled = false;\n        this.stopped = false;\n        this.isExecutionInProgress = false;\n        this.hasExecutedOnce = false;\n        this._executeAndReschedule = () => {\n            if (this.stopped)\n                return;\n            if (this.timerId) {\n                (0, timers_1.clearTimeout)(this.timerId);\n            }\n            this.isExpeditedCallToFnScheduled = false;\n            this.isExecutionInProgress = true;\n            this.fn(() => {\n                this.lastExecutionEnded = (0, utils_1.now)();\n                this.isExecutionInProgress = false;\n                this._reschedule(this.heartbeatFrequencyMS);\n            });\n        };\n        this.fn = fn;\n        this.lastExecutionEnded = -Infinity;\n        this.heartbeatFrequencyMS = options.heartbeatFrequencyMS ?? 1000;\n        this.minHeartbeatFrequencyMS = options.minHeartbeatFrequencyMS ?? 500;\n        if (options.immediate) {\n            this._executeAndReschedule();\n        }\n        else {\n            this._reschedule(undefined);\n        }\n    }\n    wake() {\n        const currentTime = (0, utils_1.now)();\n        const timeSinceLastCall = currentTime - this.lastExecutionEnded;\n        // TODO(NODE-4674): Add error handling and logging to the monitor\n        if (timeSinceLastCall < 0) {\n            return this._executeAndReschedule();\n        }\n        if (this.isExecutionInProgress) {\n            return;\n        }\n        // debounce multiple calls to wake within the `minInterval`\n        if (this.isExpeditedCallToFnScheduled) {\n            return;\n        }\n        // reschedule a call as soon as possible, ensuring the call never happens\n        // faster than the `minInterval`\n        if (timeSinceLastCall < this.minHeartbeatFrequencyMS) {\n            this.isExpeditedCallToFnScheduled = true;\n            this._reschedule(this.minHeartbeatFrequencyMS - timeSinceLastCall);\n            return;\n        }\n        this._executeAndReschedule();\n    }\n    stop() {\n        this.stopped = true;\n        if (this.timerId) {\n            (0, timers_1.clearTimeout)(this.timerId);\n            this.timerId = undefined;\n        }\n        this.lastExecutionEnded = -Infinity;\n        this.isExpeditedCallToFnScheduled = false;\n    }\n    toString() {\n        return JSON.stringify(this);\n    }\n    toJSON() {\n        const currentTime = (0, utils_1.now)();\n        const timeSinceLastCall = currentTime - this.lastExecutionEnded;\n        return {\n            timerId: this.timerId != null ? 'set' : 'cleared',\n            lastCallTime: this.lastExecutionEnded,\n            isExpeditedCheckScheduled: this.isExpeditedCallToFnScheduled,\n            stopped: this.stopped,\n            heartbeatFrequencyMS: this.heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: this.minHeartbeatFrequencyMS,\n            currentTime,\n            timeSinceLastCall\n        };\n    }\n    _reschedule(ms) {\n        if (this.stopped)\n            return;\n        if (this.timerId) {\n            (0, timers_1.clearTimeout)(this.timerId);\n        }\n        this.timerId = (0, timers_1.setTimeout)(this._executeAndReschedule, ms || this.heartbeatFrequencyMS);\n    }\n}\nexports.MonitorInterval = MonitorInterval;\n/** @internal\n * This class implements the RTT sampling logic specified for [CSOT](https://github.com/mongodb/specifications/blob/bbb335e60cd7ea1e0f7cd9a9443cb95fc9d3b64d/source/client-side-operations-timeout/client-side-operations-timeout.md#drivers-use-minimum-rtt-to-short-circuit-operations)\n *\n * This is implemented as a [circular buffer](https://en.wikipedia.org/wiki/Circular_buffer) keeping\n * the most recent `windowSize` samples\n * */\nclass RTTSampler {\n    constructor(windowSize = 10) {\n        this.rttSamples = new Float64Array(windowSize);\n        this.length = 0;\n        this.writeIndex = 0;\n    }\n    /**\n     * Adds an rtt sample to the end of the circular buffer\n     * When `windowSize` samples have been collected, `addSample` overwrites the least recently added\n     * sample\n     */\n    addSample(sample) {\n        this.rttSamples[this.writeIndex++] = sample;\n        if (this.length < this.rttSamples.length) {\n            this.length++;\n        }\n        this.writeIndex %= this.rttSamples.length;\n    }\n    /**\n     * When \\< 2 samples have been collected, returns 0\n     * Otherwise computes the minimum value samples contained in the buffer\n     */\n    min() {\n        if (this.length < 2)\n            return 0;\n        let min = this.rttSamples[0];\n        for (let i = 1; i < this.length; i++) {\n            if (this.rttSamples[i] < min)\n                min = this.rttSamples[i];\n        }\n        return min;\n    }\n    /**\n     * Returns mean of samples contained in the buffer\n     */\n    average() {\n        if (this.length === 0)\n            return 0;\n        let sum = 0;\n        for (let i = 0; i < this.length; i++) {\n            sum += this.rttSamples[i];\n        }\n        return sum / this.length;\n    }\n    /**\n     * Returns most recently inserted element in the buffer\n     * Returns null if the buffer is empty\n     * */\n    get last() {\n        if (this.length === 0)\n            return null;\n        return this.rttSamples[this.writeIndex === 0 ? this.length - 1 : this.writeIndex - 1];\n    }\n    /**\n     * Clear the buffer\n     * NOTE: this does not overwrite the data held in the internal array, just the pointers into\n     * this array\n     */\n    clear() {\n        this.length = 0;\n        this.writeIndex = 0;\n    }\n}\nexports.RTTSampler = RTTSampler;\n//# sourceMappingURL=monitor.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vbW9uaXRvci5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQkFBa0IsR0FBRyx1QkFBdUIsR0FBRyxpQkFBaUIsR0FBRyxlQUFlLEdBQUcsNEJBQTRCO0FBQ2pILGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyxrQkFBa0IsbUJBQU8sQ0FBQywyR0FBaUI7QUFDM0MsMEJBQTBCLG1CQUFPLENBQUMsK0lBQW1DO0FBQ3JFLG9CQUFvQixtQkFBTyxDQUFDLHFHQUFjO0FBQzFDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLHVCQUF1QixtQkFBTyxDQUFDLDJHQUFpQjtBQUNoRCxzQkFBc0IsbUJBQU8sQ0FBQyx5R0FBZ0I7QUFDOUMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMsbUdBQVU7QUFDbkMsaUJBQWlCLG1CQUFPLENBQUMsbUdBQVU7QUFDbkMsaUJBQWlCLG1CQUFPLENBQUMsbUdBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRixZQUFZO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGFBQWE7QUFDekI7QUFDQSxnQkFBZ0IscUJBQXFCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsNERBQTRELGtCQUFrQjtBQUM5RTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGlCQUFpQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsaUJBQWlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zZGFtL21vbml0b3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJUVFNhbXBsZXIgPSBleHBvcnRzLk1vbml0b3JJbnRlcnZhbCA9IGV4cG9ydHMuUlRUUGluZ2VyID0gZXhwb3J0cy5Nb25pdG9yID0gZXhwb3J0cy5TZXJ2ZXJNb25pdG9yaW5nTW9kZSA9IHZvaWQgMDtcbmNvbnN0IHRpbWVyc18xID0gcmVxdWlyZShcInRpbWVyc1wiKTtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuLi9ic29uXCIpO1xuY29uc3QgY29ubmVjdF8xID0gcmVxdWlyZShcIi4uL2NtYXAvY29ubmVjdFwiKTtcbmNvbnN0IGNsaWVudF9tZXRhZGF0YV8xID0gcmVxdWlyZShcIi4uL2NtYXAvaGFuZHNoYWtlL2NsaWVudF9tZXRhZGF0YVwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb19sb2dnZXJfMSA9IHJlcXVpcmUoXCIuLi9tb25nb19sb2dnZXJcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4vY29tbW9uXCIpO1xuY29uc3QgZXZlbnRzXzEgPSByZXF1aXJlKFwiLi9ldmVudHNcIik7XG5jb25zdCBzZXJ2ZXJfMSA9IHJlcXVpcmUoXCIuL3NlcnZlclwiKTtcbmNvbnN0IFNUQVRFX0lETEUgPSAnaWRsZSc7XG5jb25zdCBTVEFURV9NT05JVE9SSU5HID0gJ21vbml0b3JpbmcnO1xuY29uc3Qgc3RhdGVUcmFuc2l0aW9uID0gKDAsIHV0aWxzXzEubWFrZVN0YXRlTWFjaGluZSkoe1xuICAgIFtjb21tb25fMS5TVEFURV9DTE9TSU5HXTogW2NvbW1vbl8xLlNUQVRFX0NMT1NJTkcsIFNUQVRFX0lETEUsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRF0sXG4gICAgW2NvbW1vbl8xLlNUQVRFX0NMT1NFRF06IFtjb21tb25fMS5TVEFURV9DTE9TRUQsIFNUQVRFX01PTklUT1JJTkddLFxuICAgIFtTVEFURV9JRExFXTogW1NUQVRFX0lETEUsIFNUQVRFX01PTklUT1JJTkcsIGNvbW1vbl8xLlNUQVRFX0NMT1NJTkddLFxuICAgIFtTVEFURV9NT05JVE9SSU5HXTogW1NUQVRFX01PTklUT1JJTkcsIFNUQVRFX0lETEUsIGNvbW1vbl8xLlNUQVRFX0NMT1NJTkddXG59KTtcbmNvbnN0IElOVkFMSURfUkVRVUVTVF9DSEVDS19TVEFURVMgPSBuZXcgU2V0KFtjb21tb25fMS5TVEFURV9DTE9TSU5HLCBjb21tb25fMS5TVEFURV9DTE9TRUQsIFNUQVRFX01PTklUT1JJTkddKTtcbmZ1bmN0aW9uIGlzSW5DbG9zZVN0YXRlKG1vbml0b3IpIHtcbiAgICByZXR1cm4gbW9uaXRvci5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TRUQgfHwgbW9uaXRvci5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TSU5HO1xufVxuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydHMuU2VydmVyTW9uaXRvcmluZ01vZGUgPSBPYmplY3QuZnJlZXplKHtcbiAgICBhdXRvOiAnYXV0bycsXG4gICAgcG9sbDogJ3BvbGwnLFxuICAgIHN0cmVhbTogJ3N0cmVhbSdcbn0pO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgTW9uaXRvciBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKHNlcnZlciwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gbW9uZ29fbG9nZ2VyXzEuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudC5UT1BPTE9HWTtcbiAgICAgICAgdGhpcy5vbignZXJyb3InLCB1dGlsc18xLm5vb3ApO1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy5jYW5jZWxsYXRpb25Ub2tlbiA9IG5ldyBtb25nb190eXBlc18xLkNhbmNlbGxhdGlvblRva2VuKCk7XG4gICAgICAgIHRoaXMuY2FuY2VsbGF0aW9uVG9rZW4uc2V0TWF4TGlzdGVuZXJzKEluZmluaXR5KTtcbiAgICAgICAgdGhpcy5tb25pdG9ySWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucyA9IHtcbiAgICAgICAgICAgIHN0YXRlOiBjb21tb25fMS5TVEFURV9DTE9TRURcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hZGRyZXNzID0gc2VydmVyLmRlc2NyaXB0aW9uLmFkZHJlc3M7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5mcmVlemUoe1xuICAgICAgICAgICAgY29ubmVjdFRpbWVvdXRNUzogb3B0aW9ucy5jb25uZWN0VGltZW91dE1TID8/IDEwMDAwLFxuICAgICAgICAgICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IG9wdGlvbnMuaGVhcnRiZWF0RnJlcXVlbmN5TVMgPz8gMTAwMDAsXG4gICAgICAgICAgICBtaW5IZWFydGJlYXRGcmVxdWVuY3lNUzogb3B0aW9ucy5taW5IZWFydGJlYXRGcmVxdWVuY3lNUyA/PyA1MDAsXG4gICAgICAgICAgICBzZXJ2ZXJNb25pdG9yaW5nTW9kZTogb3B0aW9ucy5zZXJ2ZXJNb25pdG9yaW5nTW9kZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc1J1bm5pbmdJbkZhYXNFbnYgPSAoMCwgY2xpZW50X21ldGFkYXRhXzEuZ2V0RkFBU0VudikoKSAhPSBudWxsO1xuICAgICAgICB0aGlzLm1vbmdvTG9nZ2VyID0gdGhpcy5zZXJ2ZXIudG9wb2xvZ3kuY2xpZW50Py5tb25nb0xvZ2dlcjtcbiAgICAgICAgdGhpcy5ydHRTYW1wbGVyID0gbmV3IFJUVFNhbXBsZXIoMTApO1xuICAgICAgICBjb25zdCBjYW5jZWxsYXRpb25Ub2tlbiA9IHRoaXMuY2FuY2VsbGF0aW9uVG9rZW47XG4gICAgICAgIC8vIFRPRE86IHJlZmFjdG9yIHRoaXMgdG8gcHVsbCBpdCBkaXJlY3RseSBmcm9tIHRoZSBwb29sLCByZXF1aXJlcyBuZXcgQ29ubmVjdGlvblBvb2wgaW50ZWdyYXRpb25cbiAgICAgICAgY29uc3QgY29ubmVjdE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBpZDogJzxtb25pdG9yPicsXG4gICAgICAgICAgICBnZW5lcmF0aW9uOiBzZXJ2ZXIucG9vbC5nZW5lcmF0aW9uLFxuICAgICAgICAgICAgY2FuY2VsbGF0aW9uVG9rZW4sXG4gICAgICAgICAgICBob3N0QWRkcmVzczogc2VydmVyLmRlc2NyaXB0aW9uLmhvc3RBZGRyZXNzLFxuICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgIC8vIGZvcmNlIEJTT04gc2VyaWFsaXphdGlvbiBvcHRpb25zXG4gICAgICAgICAgICByYXc6IGZhbHNlLFxuICAgICAgICAgICAgdXNlQmlnSW50NjQ6IGZhbHNlLFxuICAgICAgICAgICAgcHJvbW90ZUxvbmdzOiB0cnVlLFxuICAgICAgICAgICAgcHJvbW90ZVZhbHVlczogdHJ1ZSxcbiAgICAgICAgICAgIHByb21vdGVCdWZmZXJzOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIC8vIGVuc3VyZSBubyBhdXRoZW50aWNhdGlvbiBpcyB1c2VkIGZvciBtb25pdG9yaW5nXG4gICAgICAgIGRlbGV0ZSBjb25uZWN0T3B0aW9ucy5jcmVkZW50aWFscztcbiAgICAgICAgaWYgKGNvbm5lY3RPcHRpb25zLmF1dG9FbmNyeXB0ZXIpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBjb25uZWN0T3B0aW9ucy5hdXRvRW5jcnlwdGVyO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29ubmVjdE9wdGlvbnMgPSBPYmplY3QuZnJlZXplKGNvbm5lY3RPcHRpb25zKTtcbiAgICB9XG4gICAgY29ubmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMucy5zdGF0ZSAhPT0gY29tbW9uXzEuU1RBVEVfQ0xPU0VEKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3RhcnRcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSB0aGlzLm9wdGlvbnMuaGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgIGNvbnN0IG1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gdGhpcy5vcHRpb25zLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TO1xuICAgICAgICB0aGlzLm1vbml0b3JJZCA9IG5ldyBNb25pdG9ySW50ZXJ2YWwobW9uaXRvclNlcnZlcih0aGlzKSwge1xuICAgICAgICAgICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IGhlYXJ0YmVhdEZyZXF1ZW5jeU1TLFxuICAgICAgICAgICAgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVM6IG1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TLFxuICAgICAgICAgICAgaW1tZWRpYXRlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXF1ZXN0Q2hlY2soKSB7XG4gICAgICAgIGlmIChJTlZBTElEX1JFUVVFU1RfQ0hFQ0tfU1RBVEVTLmhhcyh0aGlzLnMuc3RhdGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb25pdG9ySWQ/Lndha2UoKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5VmVyc2lvbiA9IHRoaXMuc2VydmVyLmRlc2NyaXB0aW9uLnRvcG9sb2d5VmVyc2lvbjtcbiAgICAgICAgaWYgKGlzSW5DbG9zZVN0YXRlKHRoaXMpIHx8IHRvcG9sb2d5VmVyc2lvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NMT1NJTkcpO1xuICAgICAgICByZXNldE1vbml0b3JTdGF0ZSh0aGlzKTtcbiAgICAgICAgLy8gcmVzdGFydCBtb25pdG9yXG4gICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBTVEFURV9JRExFKTtcbiAgICAgICAgLy8gcmVzdGFydCBtb25pdG9yaW5nXG4gICAgICAgIGNvbnN0IGhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gdGhpcy5vcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TO1xuICAgICAgICBjb25zdCBtaW5IZWFydGJlYXRGcmVxdWVuY3lNUyA9IHRoaXMub3B0aW9ucy5taW5IZWFydGJlYXRGcmVxdWVuY3lNUztcbiAgICAgICAgdGhpcy5tb25pdG9ySWQgPSBuZXcgTW9uaXRvckludGVydmFsKG1vbml0b3JTZXJ2ZXIodGhpcyksIHtcbiAgICAgICAgICAgIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBoZWFydGJlYXRGcmVxdWVuY3lNUyxcbiAgICAgICAgICAgIG1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBtaW5IZWFydGJlYXRGcmVxdWVuY3lNU1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2xvc2UoKSB7XG4gICAgICAgIGlmIChpc0luQ2xvc2VTdGF0ZSh0aGlzKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DTE9TSU5HKTtcbiAgICAgICAgcmVzZXRNb25pdG9yU3RhdGUodGhpcyk7XG4gICAgICAgIC8vIGNsb3NlIG1vbml0b3JcbiAgICAgICAgdGhpcy5lbWl0KCdjbG9zZScpO1xuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0VEKTtcbiAgICB9XG4gICAgZ2V0IHJvdW5kVHJpcFRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ0dFNhbXBsZXIuYXZlcmFnZSgpO1xuICAgIH1cbiAgICBnZXQgbWluUm91bmRUcmlwVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnR0U2FtcGxlci5taW4oKTtcbiAgICB9XG4gICAgZ2V0IGxhdGVzdFJ0dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnR0U2FtcGxlci5sYXN0O1xuICAgIH1cbiAgICBhZGRSdHRTYW1wbGUocnR0KSB7XG4gICAgICAgIHRoaXMucnR0U2FtcGxlci5hZGRTYW1wbGUocnR0KTtcbiAgICB9XG4gICAgY2xlYXJSdHRTYW1wbGVzKCkge1xuICAgICAgICB0aGlzLnJ0dFNhbXBsZXIuY2xlYXIoKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbml0b3IgPSBNb25pdG9yO1xuZnVuY3Rpb24gcmVzZXRNb25pdG9yU3RhdGUobW9uaXRvcikge1xuICAgIG1vbml0b3IubW9uaXRvcklkPy5zdG9wKCk7XG4gICAgbW9uaXRvci5tb25pdG9ySWQgPSB1bmRlZmluZWQ7XG4gICAgbW9uaXRvci5ydHRQaW5nZXI/LmNsb3NlKCk7XG4gICAgbW9uaXRvci5ydHRQaW5nZXIgPSB1bmRlZmluZWQ7XG4gICAgbW9uaXRvci5jYW5jZWxsYXRpb25Ub2tlbi5lbWl0KCdjYW5jZWwnKTtcbiAgICBtb25pdG9yLmNvbm5lY3Rpb24/LmRlc3Ryb3koKTtcbiAgICBtb25pdG9yLmNvbm5lY3Rpb24gPSBudWxsO1xuICAgIG1vbml0b3IuY2xlYXJSdHRTYW1wbGVzKCk7XG59XG5mdW5jdGlvbiB1c2VTdHJlYW1pbmdQcm90b2NvbChtb25pdG9yLCB0b3BvbG9neVZlcnNpb24pIHtcbiAgICAvLyBJZiB3ZSBoYXZlIG5vIHRvcG9sb2d5IHZlcnNpb24gd2UgYWx3YXlzIHBvbGwgbm8gbWF0dGVyXG4gICAgLy8gd2hhdCB0aGUgdXNlciBwcm92aWRlZCwgc2luY2UgdGhlIHNlcnZlciBkb2VzIG5vdCBzdXBwb3J0XG4gICAgLy8gdGhlIHN0cmVhbWluZyBwcm90b2NvbC5cbiAgICBpZiAodG9wb2xvZ3lWZXJzaW9uID09IG51bGwpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBzZXJ2ZXJNb25pdG9yaW5nTW9kZSA9IG1vbml0b3Iub3B0aW9ucy5zZXJ2ZXJNb25pdG9yaW5nTW9kZTtcbiAgICBpZiAoc2VydmVyTW9uaXRvcmluZ01vZGUgPT09IGV4cG9ydHMuU2VydmVyTW9uaXRvcmluZ01vZGUucG9sbClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChzZXJ2ZXJNb25pdG9yaW5nTW9kZSA9PT0gZXhwb3J0cy5TZXJ2ZXJNb25pdG9yaW5nTW9kZS5zdHJlYW0pXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIC8vIElmIHdlIGFyZSBpbiBhdXRvIG1vZGUsIHdlIG5lZWQgdG8gZmlndXJlIG91dCBpZiB3ZSdyZSBpbiBhIEZhYVNcbiAgICAvLyBlbnZpcm9ubWVudCBvciBub3QgYW5kIGNob29zZSB0aGUgYXBwcm9wcmlhdGUgbW9kZS5cbiAgICBpZiAobW9uaXRvci5pc1J1bm5pbmdJbkZhYXNFbnYpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIGNoZWNrU2VydmVyKG1vbml0b3IsIGNhbGxiYWNrKSB7XG4gICAgbGV0IHN0YXJ0O1xuICAgIGxldCBhd2FpdGVkO1xuICAgIGNvbnN0IHRvcG9sb2d5VmVyc2lvbiA9IG1vbml0b3Iuc2VydmVyLmRlc2NyaXB0aW9uLnRvcG9sb2d5VmVyc2lvbjtcbiAgICBjb25zdCBpc0F3YWl0YWJsZSA9IHVzZVN0cmVhbWluZ1Byb3RvY29sKG1vbml0b3IsIHRvcG9sb2d5VmVyc2lvbik7XG4gICAgbW9uaXRvci5lbWl0QW5kTG9nSGVhcnRiZWF0KHNlcnZlcl8xLlNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQsIG1vbml0b3Iuc2VydmVyLnRvcG9sb2d5LnMuaWQsIHVuZGVmaW5lZCwgbmV3IGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdFN0YXJ0ZWRFdmVudChtb25pdG9yLmFkZHJlc3MsIGlzQXdhaXRhYmxlKSk7XG4gICAgZnVuY3Rpb24gb25IZWFydGJlYXRGYWlsZWQoZXJyKSB7XG4gICAgICAgIG1vbml0b3IuY29ubmVjdGlvbj8uZGVzdHJveSgpO1xuICAgICAgICBtb25pdG9yLmNvbm5lY3Rpb24gPSBudWxsO1xuICAgICAgICBtb25pdG9yLmVtaXRBbmRMb2dIZWFydGJlYXQoc2VydmVyXzEuU2VydmVyLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVELCBtb25pdG9yLnNlcnZlci50b3BvbG9neS5zLmlkLCB1bmRlZmluZWQsIG5ldyBldmVudHNfMS5TZXJ2ZXJIZWFydGJlYXRGYWlsZWRFdmVudChtb25pdG9yLmFkZHJlc3MsICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnQpLCBlcnIsIGF3YWl0ZWQpKTtcbiAgICAgICAgY29uc3QgZXJyb3IgPSAhKGVyciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvcilcbiAgICAgICAgICAgID8gbmV3IGVycm9yXzEuTW9uZ29FcnJvcihlcnJvcl8xLk1vbmdvRXJyb3IuYnVpbGRFcnJvck1lc3NhZ2UoZXJyKSwgeyBjYXVzZTogZXJyIH0pXG4gICAgICAgICAgICA6IGVycjtcbiAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5SZXNldFBvb2wpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcikge1xuICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5JbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBtb25pdG9yLmVtaXQoJ3Jlc2V0U2VydmVyJywgZXJyb3IpO1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvbkhlYXJ0YmVhdFN1Y2NlZWRlZChoZWxsbykge1xuICAgICAgICBpZiAoISgnaXNXcml0YWJsZVByaW1hcnknIGluIGhlbGxvKSkge1xuICAgICAgICAgICAgLy8gUHJvdmlkZSBoZWxsby1zdHlsZSByZXNwb25zZSBkb2N1bWVudC5cbiAgICAgICAgICAgIGhlbGxvLmlzV3JpdGFibGVQcmltYXJ5ID0gaGVsbG9bY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkRdO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5PVEU6IGhlcmUgd2UgdXNlIHRoZSBsYXRlc3RSdHQgYXMgdGhpcyBtZWFzdXJlbWVudCBjb3JyZXNwb25kcyB3aXRoIHRoZSB2YWx1ZVxuICAgICAgICAvLyBvYnRhaW5lZCBmb3IgdGhpcyBzdWNjZXNzZnVsIGhlYXJ0YmVhdCwgaWYgdGhlcmUgaXMgbm8gbGF0ZXN0UnR0LCB0aGVuIHdlIGNhbGN1bGF0ZSB0aGVcbiAgICAgICAgLy8gZHVyYXRpb25cbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBpc0F3YWl0YWJsZSAmJiBtb25pdG9yLnJ0dFBpbmdlclxuICAgICAgICAgICAgPyAobW9uaXRvci5ydHRQaW5nZXIubGF0ZXN0UnR0ID8/ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnQpKVxuICAgICAgICAgICAgOiAoMCwgdXRpbHNfMS5jYWxjdWxhdGVEdXJhdGlvbkluTXMpKHN0YXJ0KTtcbiAgICAgICAgbW9uaXRvci5hZGRSdHRTYW1wbGUoZHVyYXRpb24pO1xuICAgICAgICBtb25pdG9yLmVtaXRBbmRMb2dIZWFydGJlYXQoc2VydmVyXzEuU2VydmVyLlNFUlZFUl9IRUFSVEJFQVRfU1VDQ0VFREVELCBtb25pdG9yLnNlcnZlci50b3BvbG9neS5zLmlkLCBoZWxsby5jb25uZWN0aW9uSWQsIG5ldyBldmVudHNfMS5TZXJ2ZXJIZWFydGJlYXRTdWNjZWVkZWRFdmVudChtb25pdG9yLmFkZHJlc3MsIGR1cmF0aW9uLCBoZWxsbywgaXNBd2FpdGFibGUpKTtcbiAgICAgICAgaWYgKGlzQXdhaXRhYmxlKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSBhcmUgdXNpbmcgdGhlIHN0cmVhbWluZyBwcm90b2NvbCB0aGVuIHdlIGltbWVkaWF0ZWx5IGlzc3VlIGFub3RoZXIgJ3N0YXJ0ZWQnXG4gICAgICAgICAgICAvLyBldmVudCwgb3RoZXJ3aXNlIHRoZSBcImNoZWNrXCIgaXMgY29tcGxldGUgYW5kIHJldHVybiB0byB0aGUgbWFpbiBtb25pdG9yIGxvb3BcbiAgICAgICAgICAgIG1vbml0b3IuZW1pdEFuZExvZ0hlYXJ0YmVhdChzZXJ2ZXJfMS5TZXJ2ZXIuU0VSVkVSX0hFQVJUQkVBVF9TVEFSVEVELCBtb25pdG9yLnNlcnZlci50b3BvbG9neS5zLmlkLCB1bmRlZmluZWQsIG5ldyBldmVudHNfMS5TZXJ2ZXJIZWFydGJlYXRTdGFydGVkRXZlbnQobW9uaXRvci5hZGRyZXNzLCB0cnVlKSk7XG4gICAgICAgICAgICAvLyBXZSBoYXZlIG5vdCBhY3R1YWxseSBzZW50IGFuIG91dGdvaW5nIGhhbmRzaGFrZSwgYnV0IHdoZW4gd2UgZ2V0IHRoZSBuZXh0IHJlc3BvbnNlIHdlXG4gICAgICAgICAgICAvLyB3YW50IHRoZSBkdXJhdGlvbiB0byByZWZsZWN0IHRoZSB0aW1lIHNpbmNlIHdlIGxhc3QgaGVhcmQgZnJvbSB0aGUgc2VydmVyXG4gICAgICAgICAgICBzdGFydCA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vbml0b3IucnR0UGluZ2VyPy5jbG9zZSgpO1xuICAgICAgICAgICAgbW9uaXRvci5ydHRQaW5nZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIGhlbGxvKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB7IGNvbm5lY3Rpb24gfSA9IG1vbml0b3I7XG4gICAgaWYgKGNvbm5lY3Rpb24gJiYgIWNvbm5lY3Rpb24uY2xvc2VkKSB7XG4gICAgICAgIGNvbnN0IHsgc2VydmVyQXBpLCBoZWxsb09rIH0gPSBjb25uZWN0aW9uO1xuICAgICAgICBjb25zdCBjb25uZWN0VGltZW91dE1TID0gbW9uaXRvci5vcHRpb25zLmNvbm5lY3RUaW1lb3V0TVM7XG4gICAgICAgIGNvbnN0IG1heEF3YWl0VGltZU1TID0gbW9uaXRvci5vcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TO1xuICAgICAgICBjb25zdCBjbWQgPSB7XG4gICAgICAgICAgICBbc2VydmVyQXBpPy52ZXJzaW9uIHx8IGhlbGxvT2sgPyAnaGVsbG8nIDogY29uc3RhbnRzXzEuTEVHQUNZX0hFTExPX0NPTU1BTkRdOiAxLFxuICAgICAgICAgICAgLi4uKGlzQXdhaXRhYmxlICYmIHRvcG9sb2d5VmVyc2lvblxuICAgICAgICAgICAgICAgID8geyBtYXhBd2FpdFRpbWVNUywgdG9wb2xvZ3lWZXJzaW9uOiBtYWtlVG9wb2xvZ3lWZXJzaW9uKHRvcG9sb2d5VmVyc2lvbikgfVxuICAgICAgICAgICAgICAgIDoge30pXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBpc0F3YWl0YWJsZVxuICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgc29ja2V0VGltZW91dE1TOiBjb25uZWN0VGltZW91dE1TID8gY29ubmVjdFRpbWVvdXRNUyArIG1heEF3YWl0VGltZU1TIDogMCxcbiAgICAgICAgICAgICAgICBleGhhdXN0QWxsb3dlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB7IHNvY2tldFRpbWVvdXRNUzogY29ubmVjdFRpbWVvdXRNUyB9O1xuICAgICAgICBpZiAoaXNBd2FpdGFibGUgJiYgbW9uaXRvci5ydHRQaW5nZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgbW9uaXRvci5ydHRQaW5nZXIgPSBuZXcgUlRUUGluZ2VyKG1vbml0b3IpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlY29yZCBuZXcgc3RhcnQgdGltZSBiZWZvcmUgc2VuZGluZyBoYW5kc2hha2VcbiAgICAgICAgc3RhcnQgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIGlmIChpc0F3YWl0YWJsZSkge1xuICAgICAgICAgICAgYXdhaXRlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gY29ubmVjdGlvbi5leGhhdXN0Q29tbWFuZCgoMCwgdXRpbHNfMS5ucykoJ2FkbWluLiRjbWQnKSwgY21kLCBvcHRpb25zLCAoZXJyb3IsIGhlbGxvKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb25IZWFydGJlYXRGYWlsZWQoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvbkhlYXJ0YmVhdFN1Y2NlZWRlZChoZWxsbyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdGVkID0gZmFsc2U7XG4gICAgICAgIGNvbm5lY3Rpb25cbiAgICAgICAgICAgIC5jb21tYW5kKCgwLCB1dGlsc18xLm5zKSgnYWRtaW4uJGNtZCcpLCBjbWQsIG9wdGlvbnMpXG4gICAgICAgICAgICAudGhlbihvbkhlYXJ0YmVhdFN1Y2NlZWRlZCwgb25IZWFydGJlYXRGYWlsZWQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIGNvbm5lY3RpbmcgZG9lcyBhbiBpbXBsaWNpdCBgaGVsbG9gXG4gICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgc29ja2V0ID0gYXdhaXQgKDAsIGNvbm5lY3RfMS5tYWtlU29ja2V0KShtb25pdG9yLmNvbm5lY3RPcHRpb25zKTtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9ICgwLCBjb25uZWN0XzEubWFrZUNvbm5lY3Rpb24pKG1vbml0b3IuY29ubmVjdE9wdGlvbnMsIHNvY2tldCk7XG4gICAgICAgIC8vIFRoZSBzdGFydCB0aW1lIGlzIGFmdGVyIHNvY2tldCBjcmVhdGlvbiBidXQgYmVmb3JlIHRoZSBoYW5kc2hha2VcbiAgICAgICAgc3RhcnQgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCAoMCwgY29ubmVjdF8xLnBlcmZvcm1Jbml0aWFsSGFuZHNoYWtlKShjb25uZWN0aW9uLCBtb25pdG9yLmNvbm5lY3RPcHRpb25zKTtcbiAgICAgICAgICAgIHJldHVybiBjb25uZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29ubmVjdGlvbi5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH0pKCkudGhlbihjb25uZWN0aW9uID0+IHtcbiAgICAgICAgaWYgKGlzSW5DbG9zZVN0YXRlKG1vbml0b3IpKSB7XG4gICAgICAgICAgICBjb25uZWN0aW9uLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkdXJhdGlvbiA9ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnQpO1xuICAgICAgICBtb25pdG9yLmFkZFJ0dFNhbXBsZShkdXJhdGlvbik7XG4gICAgICAgIG1vbml0b3IuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4gICAgICAgIG1vbml0b3IuZW1pdEFuZExvZ0hlYXJ0YmVhdChzZXJ2ZXJfMS5TZXJ2ZXIuU0VSVkVSX0hFQVJUQkVBVF9TVUNDRUVERUQsIG1vbml0b3Iuc2VydmVyLnRvcG9sb2d5LnMuaWQsIGNvbm5lY3Rpb24uaGVsbG8/LmNvbm5lY3Rpb25JZCwgbmV3IGV2ZW50c18xLlNlcnZlckhlYXJ0YmVhdFN1Y2NlZWRlZEV2ZW50KG1vbml0b3IuYWRkcmVzcywgZHVyYXRpb24sIGNvbm5lY3Rpb24uaGVsbG8sIHVzZVN0cmVhbWluZ1Byb3RvY29sKG1vbml0b3IsIGNvbm5lY3Rpb24uaGVsbG8/LnRvcG9sb2d5VmVyc2lvbikpKTtcbiAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCBjb25uZWN0aW9uLmhlbGxvKTtcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgIG1vbml0b3IuY29ubmVjdGlvbiA9IG51bGw7XG4gICAgICAgIGF3YWl0ZWQgPSBmYWxzZTtcbiAgICAgICAgb25IZWFydGJlYXRGYWlsZWQoZXJyb3IpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gbW9uaXRvclNlcnZlcihtb25pdG9yKSB7XG4gICAgcmV0dXJuIChjYWxsYmFjaykgPT4ge1xuICAgICAgICBpZiAobW9uaXRvci5zLnN0YXRlID09PSBTVEFURV9NT05JVE9SSU5HKSB7XG4gICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGNhbGxiYWNrKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZVRyYW5zaXRpb24obW9uaXRvciwgU1RBVEVfTU9OSVRPUklORyk7XG4gICAgICAgIGZ1bmN0aW9uIGRvbmUoKSB7XG4gICAgICAgICAgICBpZiAoIWlzSW5DbG9zZVN0YXRlKG1vbml0b3IpKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVUcmFuc2l0aW9uKG1vbml0b3IsIFNUQVRFX0lETEUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgICBjaGVja1NlcnZlcihtb25pdG9yLCAoZXJyLCBoZWxsbykgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBhbiBlcnJvciBvY2N1cnJlZCBvbiBpbml0aWFsIGRpc2NvdmVyeSwgYWxzbyBiYWlsXG4gICAgICAgICAgICAgICAgaWYgKG1vbml0b3Iuc2VydmVyLmRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIHRoZSBjaGVjayBpbmRpY2F0ZXMgc3RyZWFtaW5nIGlzIHN1cHBvcnRlZCwgaW1tZWRpYXRlbHkgcmVzY2hlZHVsZSBtb25pdG9yaW5nXG4gICAgICAgICAgICBpZiAodXNlU3RyZWFtaW5nUHJvdG9jb2wobW9uaXRvciwgaGVsbG8/LnRvcG9sb2d5VmVyc2lvbikpIHtcbiAgICAgICAgICAgICAgICAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzSW5DbG9zZVN0YXRlKG1vbml0b3IpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yLm1vbml0b3JJZD8ud2FrZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5mdW5jdGlvbiBtYWtlVG9wb2xvZ3lWZXJzaW9uKHR2KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvY2Vzc0lkOiB0di5wcm9jZXNzSWQsXG4gICAgICAgIC8vIHRlc3RzIG1vY2sgY291bnRlciBhcyBqdXN0IG51bWJlciwgYnV0IGluIGEgcmVhbCBzaXR1YXRpb24gY291bnRlciBzaG91bGQgYWx3YXlzIGJlIGEgTG9uZ1xuICAgICAgICAvLyBUT0RPKE5PREUtMjY3NCk6IFByZXNlcnZlIGludDY0IHNlbnQgZnJvbSBNb25nb0RCXG4gICAgICAgIGNvdW50ZXI6IGJzb25fMS5Mb25nLmlzTG9uZyh0di5jb3VudGVyKSA/IHR2LmNvdW50ZXIgOiBic29uXzEuTG9uZy5mcm9tTnVtYmVyKHR2LmNvdW50ZXIpXG4gICAgfTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFJUVFBpbmdlciB7XG4gICAgY29uc3RydWN0b3IobW9uaXRvcikge1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY2FuY2VsbGF0aW9uVG9rZW4gPSBtb25pdG9yLmNhbmNlbGxhdGlvblRva2VuO1xuICAgICAgICB0aGlzLmNsb3NlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1vbml0b3IgPSBtb25pdG9yO1xuICAgICAgICB0aGlzLmxhdGVzdFJ0dCA9IG1vbml0b3IubGF0ZXN0UnR0ID8/IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSBtb25pdG9yLm9wdGlvbnMuaGVhcnRiZWF0RnJlcXVlbmN5TVM7XG4gICAgICAgIHRoaXMubW9uaXRvcklkID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKCgpID0+IHRoaXMubWVhc3VyZVJvdW5kVHJpcFRpbWUoKSwgaGVhcnRiZWF0RnJlcXVlbmN5TVMpO1xuICAgIH1cbiAgICBnZXQgcm91bmRUcmlwVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9uaXRvci5yb3VuZFRyaXBUaW1lO1xuICAgIH1cbiAgICBnZXQgbWluUm91bmRUcmlwVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9uaXRvci5taW5Sb3VuZFRyaXBUaW1lO1xuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5jbG9zZWQgPSB0cnVlO1xuICAgICAgICAoMCwgdGltZXJzXzEuY2xlYXJUaW1lb3V0KSh0aGlzLm1vbml0b3JJZCk7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbj8uZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIG1lYXN1cmVBbmRSZXNjaGVkdWxlKHN0YXJ0LCBjb25uKSB7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICAgICAgY29ubj8uZGVzdHJveSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gY29ubjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhdGVzdFJ0dCA9ICgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5Ncykoc3RhcnQpO1xuICAgICAgICB0aGlzLm1vbml0b3JJZCA9ICgwLCB0aW1lcnNfMS5zZXRUaW1lb3V0KSgoKSA9PiB0aGlzLm1lYXN1cmVSb3VuZFRyaXBUaW1lKCksIHRoaXMubW9uaXRvci5vcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TKTtcbiAgICB9XG4gICAgbWVhc3VyZVJvdW5kVHJpcFRpbWUoKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICBpZiAodGhpcy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5jb25uZWN0aW9uO1xuICAgICAgICBpZiAoY29ubmVjdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICAoMCwgY29ubmVjdF8xLmNvbm5lY3QpKHRoaXMubW9uaXRvci5jb25uZWN0T3B0aW9ucykudGhlbihjb25uZWN0aW9uID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lYXN1cmVBbmRSZXNjaGVkdWxlKHN0YXJ0LCBjb25uZWN0aW9uKTtcbiAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGNvbm5lY3Rpb24uc2VydmVyQXBpPy52ZXJzaW9uIHx8IGNvbm5lY3Rpb24uaGVsbG9PayA/ICdoZWxsbycgOiBjb25zdGFudHNfMS5MRUdBQ1lfSEVMTE9fQ09NTUFORDtcbiAgICAgICAgY29ubmVjdGlvbi5jb21tYW5kKCgwLCB1dGlsc18xLm5zKSgnYWRtaW4uJGNtZCcpLCB7IFtjb21tYW5kTmFtZV06IDEgfSwgdW5kZWZpbmVkKS50aGVuKCgpID0+IHRoaXMubWVhc3VyZUFuZFJlc2NoZWR1bGUoc3RhcnQpLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24/LmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5SVFRQaW5nZXIgPSBSVFRQaW5nZXI7XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBNb25pdG9ySW50ZXJ2YWwge1xuICAgIGNvbnN0cnVjdG9yKGZuLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5pc0V4cGVkaXRlZENhbGxUb0ZuU2NoZWR1bGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RvcHBlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRXhlY3V0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhhc0V4ZWN1dGVkT25jZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9leGVjdXRlQW5kUmVzY2hlZHVsZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3BwZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZXJJZCkge1xuICAgICAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMudGltZXJJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmlzRXhwZWRpdGVkQ2FsbFRvRm5TY2hlZHVsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNFeGVjdXRpb25JblByb2dyZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZm4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdEV4ZWN1dGlvbkVuZGVkID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFeGVjdXRpb25JblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzY2hlZHVsZSh0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZuID0gZm47XG4gICAgICAgIHRoaXMubGFzdEV4ZWN1dGlvbkVuZGVkID0gLUluZmluaXR5O1xuICAgICAgICB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gb3B0aW9ucy5oZWFydGJlYXRGcmVxdWVuY3lNUyA/PyAxMDAwO1xuICAgICAgICB0aGlzLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TID0gb3B0aW9ucy5taW5IZWFydGJlYXRGcmVxdWVuY3lNUyA/PyA1MDA7XG4gICAgICAgIGlmIChvcHRpb25zLmltbWVkaWF0ZSkge1xuICAgICAgICAgICAgdGhpcy5fZXhlY3V0ZUFuZFJlc2NoZWR1bGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2NoZWR1bGUodW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB3YWtlKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50VGltZSA9ICgwLCB1dGlsc18xLm5vdykoKTtcbiAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENhbGwgPSBjdXJyZW50VGltZSAtIHRoaXMubGFzdEV4ZWN1dGlvbkVuZGVkO1xuICAgICAgICAvLyBUT0RPKE5PREUtNDY3NCk6IEFkZCBlcnJvciBoYW5kbGluZyBhbmQgbG9nZ2luZyB0byB0aGUgbW9uaXRvclxuICAgICAgICBpZiAodGltZVNpbmNlTGFzdENhbGwgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhlY3V0ZUFuZFJlc2NoZWR1bGUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc0V4ZWN1dGlvbkluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBkZWJvdW5jZSBtdWx0aXBsZSBjYWxscyB0byB3YWtlIHdpdGhpbiB0aGUgYG1pbkludGVydmFsYFxuICAgICAgICBpZiAodGhpcy5pc0V4cGVkaXRlZENhbGxUb0ZuU2NoZWR1bGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVzY2hlZHVsZSBhIGNhbGwgYXMgc29vbiBhcyBwb3NzaWJsZSwgZW5zdXJpbmcgdGhlIGNhbGwgbmV2ZXIgaGFwcGVuc1xuICAgICAgICAvLyBmYXN0ZXIgdGhhbiB0aGUgYG1pbkludGVydmFsYFxuICAgICAgICBpZiAodGltZVNpbmNlTGFzdENhbGwgPCB0aGlzLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TKSB7XG4gICAgICAgICAgICB0aGlzLmlzRXhwZWRpdGVkQ2FsbFRvRm5TY2hlZHVsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fcmVzY2hlZHVsZSh0aGlzLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TIC0gdGltZVNpbmNlTGFzdENhbGwpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2V4ZWN1dGVBbmRSZXNjaGVkdWxlKCk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuc3RvcHBlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMudGltZXJJZCk7XG4gICAgICAgICAgICB0aGlzLnRpbWVySWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0RXhlY3V0aW9uRW5kZWQgPSAtSW5maW5pdHk7XG4gICAgICAgIHRoaXMuaXNFeHBlZGl0ZWRDYWxsVG9GblNjaGVkdWxlZCA9IGZhbHNlO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMpO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbCA9IGN1cnJlbnRUaW1lIC0gdGhpcy5sYXN0RXhlY3V0aW9uRW5kZWQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aW1lcklkOiB0aGlzLnRpbWVySWQgIT0gbnVsbCA/ICdzZXQnIDogJ2NsZWFyZWQnLFxuICAgICAgICAgICAgbGFzdENhbGxUaW1lOiB0aGlzLmxhc3RFeGVjdXRpb25FbmRlZCxcbiAgICAgICAgICAgIGlzRXhwZWRpdGVkQ2hlY2tTY2hlZHVsZWQ6IHRoaXMuaXNFeHBlZGl0ZWRDYWxsVG9GblNjaGVkdWxlZCxcbiAgICAgICAgICAgIHN0b3BwZWQ6IHRoaXMuc3RvcHBlZCxcbiAgICAgICAgICAgIGhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TLFxuICAgICAgICAgICAgbWluSGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMubWluSGVhcnRiZWF0RnJlcXVlbmN5TVMsXG4gICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsXG4gICAgICAgIH07XG4gICAgfVxuICAgIF9yZXNjaGVkdWxlKG1zKSB7XG4gICAgICAgIGlmICh0aGlzLnN0b3BwZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMudGltZXJJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lcklkID0gKDAsIHRpbWVyc18xLnNldFRpbWVvdXQpKHRoaXMuX2V4ZWN1dGVBbmRSZXNjaGVkdWxlLCBtcyB8fCB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbml0b3JJbnRlcnZhbCA9IE1vbml0b3JJbnRlcnZhbDtcbi8qKiBAaW50ZXJuYWxcbiAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyB0aGUgUlRUIHNhbXBsaW5nIGxvZ2ljIHNwZWNpZmllZCBmb3IgW0NTT1RdKGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvYmJiMzM1ZTYwY2Q3ZWExZTBmN2NkOWE5NDQzY2I5NWZjOWQzYjY0ZC9zb3VyY2UvY2xpZW50LXNpZGUtb3BlcmF0aW9ucy10aW1lb3V0L2NsaWVudC1zaWRlLW9wZXJhdGlvbnMtdGltZW91dC5tZCNkcml2ZXJzLXVzZS1taW5pbXVtLXJ0dC10by1zaG9ydC1jaXJjdWl0LW9wZXJhdGlvbnMpXG4gKlxuICogVGhpcyBpcyBpbXBsZW1lbnRlZCBhcyBhIFtjaXJjdWxhciBidWZmZXJdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NpcmN1bGFyX2J1ZmZlcikga2VlcGluZ1xuICogdGhlIG1vc3QgcmVjZW50IGB3aW5kb3dTaXplYCBzYW1wbGVzXG4gKiAqL1xuY2xhc3MgUlRUU2FtcGxlciB7XG4gICAgY29uc3RydWN0b3Iod2luZG93U2l6ZSA9IDEwKSB7XG4gICAgICAgIHRoaXMucnR0U2FtcGxlcyA9IG5ldyBGbG9hdDY0QXJyYXkod2luZG93U2l6ZSk7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy53cml0ZUluZGV4ID0gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhbiBydHQgc2FtcGxlIHRvIHRoZSBlbmQgb2YgdGhlIGNpcmN1bGFyIGJ1ZmZlclxuICAgICAqIFdoZW4gYHdpbmRvd1NpemVgIHNhbXBsZXMgaGF2ZSBiZWVuIGNvbGxlY3RlZCwgYGFkZFNhbXBsZWAgb3ZlcndyaXRlcyB0aGUgbGVhc3QgcmVjZW50bHkgYWRkZWRcbiAgICAgKiBzYW1wbGVcbiAgICAgKi9cbiAgICBhZGRTYW1wbGUoc2FtcGxlKSB7XG4gICAgICAgIHRoaXMucnR0U2FtcGxlc1t0aGlzLndyaXRlSW5kZXgrK10gPSBzYW1wbGU7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA8IHRoaXMucnR0U2FtcGxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoKys7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53cml0ZUluZGV4ICU9IHRoaXMucnR0U2FtcGxlcy5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdoZW4gXFw8IDIgc2FtcGxlcyBoYXZlIGJlZW4gY29sbGVjdGVkLCByZXR1cm5zIDBcbiAgICAgKiBPdGhlcndpc2UgY29tcHV0ZXMgdGhlIG1pbmltdW0gdmFsdWUgc2FtcGxlcyBjb250YWluZWQgaW4gdGhlIGJ1ZmZlclxuICAgICAqL1xuICAgIG1pbigpIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoIDwgMilcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBsZXQgbWluID0gdGhpcy5ydHRTYW1wbGVzWzBdO1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJ0dFNhbXBsZXNbaV0gPCBtaW4pXG4gICAgICAgICAgICAgICAgbWluID0gdGhpcy5ydHRTYW1wbGVzW2ldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtaW47XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgbWVhbiBvZiBzYW1wbGVzIGNvbnRhaW5lZCBpbiB0aGUgYnVmZmVyXG4gICAgICovXG4gICAgYXZlcmFnZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHN1bSArPSB0aGlzLnJ0dFNhbXBsZXNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1bSAvIHRoaXMubGVuZ3RoO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIG1vc3QgcmVjZW50bHkgaW5zZXJ0ZWQgZWxlbWVudCBpbiB0aGUgYnVmZmVyXG4gICAgICogUmV0dXJucyBudWxsIGlmIHRoZSBidWZmZXIgaXMgZW1wdHlcbiAgICAgKiAqL1xuICAgIGdldCBsYXN0KCkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIHRoaXMucnR0U2FtcGxlc1t0aGlzLndyaXRlSW5kZXggPT09IDAgPyB0aGlzLmxlbmd0aCAtIDEgOiB0aGlzLndyaXRlSW5kZXggLSAxXTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIGJ1ZmZlclxuICAgICAqIE5PVEU6IHRoaXMgZG9lcyBub3Qgb3ZlcndyaXRlIHRoZSBkYXRhIGhlbGQgaW4gdGhlIGludGVybmFsIGFycmF5LCBqdXN0IHRoZSBwb2ludGVycyBpbnRvXG4gICAgICogdGhpcyBhcnJheVxuICAgICAqL1xuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgICAgIHRoaXMud3JpdGVJbmRleCA9IDA7XG4gICAgfVxufVxuZXhwb3J0cy5SVFRTYW1wbGVyID0gUlRUU2FtcGxlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vbml0b3IuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/monitor.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Server = void 0;\nconst connection_1 = __webpack_require__(/*! ../cmap/connection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection.js\");\nconst connection_pool_1 = __webpack_require__(/*! ../cmap/connection_pool */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/connection_pool.js\");\nconst errors_1 = __webpack_require__(/*! ../cmap/errors */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/errors.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst transactions_1 = __webpack_require__(/*! ../transactions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/transactions.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ../write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst monitor_1 = __webpack_require__(/*! ./monitor */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/monitor.js\");\nconst server_description_1 = __webpack_require__(/*! ./server_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js\");\nconst stateTransition = (0, utils_1.makeStateMachine)({\n    [common_1.STATE_CLOSED]: [common_1.STATE_CLOSED, common_1.STATE_CONNECTING],\n    [common_1.STATE_CONNECTING]: [common_1.STATE_CONNECTING, common_1.STATE_CLOSING, common_1.STATE_CONNECTED, common_1.STATE_CLOSED],\n    [common_1.STATE_CONNECTED]: [common_1.STATE_CONNECTED, common_1.STATE_CLOSING, common_1.STATE_CLOSED],\n    [common_1.STATE_CLOSING]: [common_1.STATE_CLOSING, common_1.STATE_CLOSED]\n});\n/** @internal */\nclass Server extends mongo_types_1.TypedEventEmitter {\n    /**\n     * Create a server\n     */\n    constructor(topology, description, options) {\n        super();\n        this.on('error', utils_1.noop);\n        this.serverApi = options.serverApi;\n        const poolOptions = { hostAddress: description.hostAddress, ...options };\n        this.topology = topology;\n        this.pool = new connection_pool_1.ConnectionPool(this, poolOptions);\n        this.s = {\n            description,\n            options,\n            state: common_1.STATE_CLOSED,\n            operationCount: 0\n        };\n        for (const event of [...constants_1.CMAP_EVENTS, ...constants_1.APM_EVENTS]) {\n            this.pool.on(event, (e) => this.emit(event, e));\n        }\n        this.pool.on(connection_1.Connection.CLUSTER_TIME_RECEIVED, (clusterTime) => {\n            this.clusterTime = clusterTime;\n        });\n        if (this.loadBalanced) {\n            this.monitor = null;\n            // monitoring is disabled in load balancing mode\n            return;\n        }\n        // create the monitor\n        this.monitor = new monitor_1.Monitor(this, this.s.options);\n        for (const event of constants_1.HEARTBEAT_EVENTS) {\n            this.monitor.on(event, (e) => this.emit(event, e));\n        }\n        this.monitor.on('resetServer', (error) => markServerUnknown(this, error));\n        this.monitor.on(Server.SERVER_HEARTBEAT_SUCCEEDED, (event) => {\n            this.emit(Server.DESCRIPTION_RECEIVED, new server_description_1.ServerDescription(this.description.hostAddress, event.reply, {\n                roundTripTime: this.monitor?.roundTripTime,\n                minRoundTripTime: this.monitor?.minRoundTripTime\n            }));\n            if (this.s.state === common_1.STATE_CONNECTING) {\n                stateTransition(this, common_1.STATE_CONNECTED);\n                this.emit(Server.CONNECT, this);\n            }\n        });\n    }\n    get clusterTime() {\n        return this.topology.clusterTime;\n    }\n    set clusterTime(clusterTime) {\n        this.topology.clusterTime = clusterTime;\n    }\n    get description() {\n        return this.s.description;\n    }\n    get name() {\n        return this.s.description.address;\n    }\n    get autoEncrypter() {\n        if (this.s.options && this.s.options.autoEncrypter) {\n            return this.s.options.autoEncrypter;\n        }\n        return;\n    }\n    get loadBalanced() {\n        return this.topology.description.type === common_1.TopologyType.LoadBalanced;\n    }\n    /**\n     * Initiate server connect\n     */\n    connect() {\n        if (this.s.state !== common_1.STATE_CLOSED) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CONNECTING);\n        // If in load balancer mode we automatically set the server to\n        // a load balancer. It never transitions out of this state and\n        // has no monitor.\n        if (!this.loadBalanced) {\n            this.monitor?.connect();\n        }\n        else {\n            stateTransition(this, common_1.STATE_CONNECTED);\n            this.emit(Server.CONNECT, this);\n        }\n    }\n    /** Destroy the server connection */\n    destroy() {\n        if (this.s.state === common_1.STATE_CLOSED) {\n            return;\n        }\n        stateTransition(this, common_1.STATE_CLOSING);\n        if (!this.loadBalanced) {\n            this.monitor?.close();\n        }\n        this.pool.close();\n        stateTransition(this, common_1.STATE_CLOSED);\n        this.emit('closed');\n    }\n    /**\n     * Immediately schedule monitoring of this server. If there already an attempt being made\n     * this will be a no-op.\n     */\n    requestCheck() {\n        if (!this.loadBalanced) {\n            this.monitor?.requestCheck();\n        }\n    }\n    async command(ns, cmd, { ...options }, responseType) {\n        if (ns.db == null || typeof ns === 'string') {\n            throw new error_1.MongoInvalidArgumentError('Namespace must not be a string');\n        }\n        if (this.s.state === common_1.STATE_CLOSING || this.s.state === common_1.STATE_CLOSED) {\n            throw new error_1.MongoServerClosedError();\n        }\n        options.directConnection = this.topology.s.options.directConnection;\n        // There are cases where we need to flag the read preference not to get sent in\n        // the command, such as pre-5.0 servers attempting to perform an aggregate write\n        // with a non-primary read preference. In this case the effective read preference\n        // (primary) is not the same as the provided and must be removed completely.\n        if (options.omitReadPreference) {\n            delete options.readPreference;\n        }\n        if (this.description.iscryptd) {\n            options.omitMaxTimeMS = true;\n        }\n        const session = options.session;\n        let conn = session?.pinnedConnection;\n        this.incrementOperationCount();\n        if (conn == null) {\n            try {\n                conn = await this.pool.checkOut(options);\n                if (this.loadBalanced && isPinnableCommand(cmd, session)) {\n                    session?.pin(conn);\n                }\n            }\n            catch (checkoutError) {\n                this.decrementOperationCount();\n                if (!(checkoutError instanceof errors_1.PoolClearedError))\n                    this.handleError(checkoutError);\n                throw checkoutError;\n            }\n        }\n        let reauthPromise = null;\n        try {\n            try {\n                const res = await conn.command(ns, cmd, options, responseType);\n                (0, write_concern_1.throwIfWriteConcernError)(res);\n                return res;\n            }\n            catch (commandError) {\n                throw this.decorateCommandError(conn, cmd, options, commandError);\n            }\n        }\n        catch (operationError) {\n            if (operationError instanceof error_1.MongoError &&\n                operationError.code === error_1.MONGODB_ERROR_CODES.Reauthenticate) {\n                reauthPromise = this.pool.reauthenticate(conn);\n                reauthPromise.then(undefined, error => {\n                    reauthPromise = null;\n                    (0, utils_1.squashError)(error);\n                });\n                await (0, utils_1.abortable)(reauthPromise, options);\n                reauthPromise = null; // only reachable if reauth succeeds\n                try {\n                    const res = await conn.command(ns, cmd, options, responseType);\n                    (0, write_concern_1.throwIfWriteConcernError)(res);\n                    return res;\n                }\n                catch (commandError) {\n                    throw this.decorateCommandError(conn, cmd, options, commandError);\n                }\n            }\n            else {\n                throw operationError;\n            }\n        }\n        finally {\n            this.decrementOperationCount();\n            if (session?.pinnedConnection !== conn) {\n                if (reauthPromise != null) {\n                    // The reauth promise only exists if it hasn't thrown.\n                    const checkBackIn = () => {\n                        this.pool.checkIn(conn);\n                    };\n                    void reauthPromise.then(checkBackIn, checkBackIn);\n                }\n                else {\n                    this.pool.checkIn(conn);\n                }\n            }\n        }\n    }\n    /**\n     * Handle SDAM error\n     * @internal\n     */\n    handleError(error, connection) {\n        if (!(error instanceof error_1.MongoError)) {\n            return;\n        }\n        const isStaleError = error.connectionGeneration && error.connectionGeneration < this.pool.generation;\n        if (isStaleError) {\n            return;\n        }\n        const isNetworkNonTimeoutError = error instanceof error_1.MongoNetworkError && !(error instanceof error_1.MongoNetworkTimeoutError);\n        const isNetworkTimeoutBeforeHandshakeError = error instanceof error_1.MongoNetworkError && error.beforeHandshake;\n        const isAuthHandshakeError = error.hasErrorLabel(error_1.MongoErrorLabel.HandshakeError);\n        if (isNetworkNonTimeoutError || isNetworkTimeoutBeforeHandshakeError || isAuthHandshakeError) {\n            // In load balanced mode we never mark the server as unknown and always\n            // clear for the specific service id.\n            if (!this.loadBalanced) {\n                error.addErrorLabel(error_1.MongoErrorLabel.ResetPool);\n                markServerUnknown(this, error);\n            }\n            else if (connection) {\n                this.pool.clear({ serviceId: connection.serviceId });\n            }\n        }\n        else {\n            if ((0, error_1.isSDAMUnrecoverableError)(error)) {\n                if (shouldHandleStateChangeError(this, error)) {\n                    const shouldClearPool = (0, utils_1.maxWireVersion)(this) <= 7 || (0, error_1.isNodeShuttingDownError)(error);\n                    if (this.loadBalanced && connection && shouldClearPool) {\n                        this.pool.clear({ serviceId: connection.serviceId });\n                    }\n                    if (!this.loadBalanced) {\n                        if (shouldClearPool) {\n                            error.addErrorLabel(error_1.MongoErrorLabel.ResetPool);\n                        }\n                        markServerUnknown(this, error);\n                        process.nextTick(() => this.requestCheck());\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Ensure that error is properly decorated and internal state is updated before throwing\n     * @internal\n     */\n    decorateCommandError(connection, cmd, options, error) {\n        if (typeof error !== 'object' || error == null || !('name' in error)) {\n            throw new error_1.MongoRuntimeError('An unexpected error type: ' + typeof error);\n        }\n        if (error.name === 'AbortError' && 'cause' in error && error.cause instanceof error_1.MongoError) {\n            error = error.cause;\n        }\n        if (!(error instanceof error_1.MongoError)) {\n            // Node.js or some other error we have not special handling for\n            return error;\n        }\n        if (connectionIsStale(this.pool, connection)) {\n            return error;\n        }\n        const session = options?.session;\n        if (error instanceof error_1.MongoNetworkError) {\n            if (session && !session.hasEnded && session.serverSession) {\n                session.serverSession.isDirty = true;\n            }\n            // inActiveTransaction check handles commit and abort.\n            if (inActiveTransaction(session, cmd) &&\n                !error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n                error.addErrorLabel(error_1.MongoErrorLabel.TransientTransactionError);\n            }\n            if ((isRetryableWritesEnabled(this.topology) || (0, transactions_1.isTransactionCommand)(cmd)) &&\n                (0, utils_1.supportsRetryableWrites)(this) &&\n                !inActiveTransaction(session, cmd)) {\n                error.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n            }\n        }\n        else {\n            if ((isRetryableWritesEnabled(this.topology) || (0, transactions_1.isTransactionCommand)(cmd)) &&\n                (0, error_1.needsRetryableWriteLabel)(error, (0, utils_1.maxWireVersion)(this), this.description.type) &&\n                !inActiveTransaction(session, cmd)) {\n                error.addErrorLabel(error_1.MongoErrorLabel.RetryableWriteError);\n            }\n        }\n        if (session &&\n            session.isPinned &&\n            error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n            session.unpin({ force: true });\n        }\n        this.handleError(error, connection);\n        return error;\n    }\n    /**\n     * Decrement the operation count, returning the new count.\n     */\n    decrementOperationCount() {\n        return (this.s.operationCount -= 1);\n    }\n    /**\n     * Increment the operation count, returning the new count.\n     */\n    incrementOperationCount() {\n        return (this.s.operationCount += 1);\n    }\n}\nexports.Server = Server;\n/** @event */\nServer.SERVER_HEARTBEAT_STARTED = constants_1.SERVER_HEARTBEAT_STARTED;\n/** @event */\nServer.SERVER_HEARTBEAT_SUCCEEDED = constants_1.SERVER_HEARTBEAT_SUCCEEDED;\n/** @event */\nServer.SERVER_HEARTBEAT_FAILED = constants_1.SERVER_HEARTBEAT_FAILED;\n/** @event */\nServer.CONNECT = constants_1.CONNECT;\n/** @event */\nServer.DESCRIPTION_RECEIVED = constants_1.DESCRIPTION_RECEIVED;\n/** @event */\nServer.CLOSED = constants_1.CLOSED;\n/** @event */\nServer.ENDED = constants_1.ENDED;\nfunction markServerUnknown(server, error) {\n    // Load balancer servers can never be marked unknown.\n    if (server.loadBalanced) {\n        return;\n    }\n    if (error instanceof error_1.MongoNetworkError && !(error instanceof error_1.MongoNetworkTimeoutError)) {\n        server.monitor?.reset();\n    }\n    server.emit(Server.DESCRIPTION_RECEIVED, new server_description_1.ServerDescription(server.description.hostAddress, undefined, { error }));\n}\nfunction isPinnableCommand(cmd, session) {\n    if (session) {\n        return (session.inTransaction() ||\n            (session.transaction.isCommitted && 'commitTransaction' in cmd) ||\n            'aggregate' in cmd ||\n            'find' in cmd ||\n            'getMore' in cmd ||\n            'listCollections' in cmd ||\n            'listIndexes' in cmd ||\n            'bulkWrite' in cmd);\n    }\n    return false;\n}\nfunction connectionIsStale(pool, connection) {\n    if (connection.serviceId) {\n        return (connection.generation !== pool.serviceGenerations.get(connection.serviceId.toHexString()));\n    }\n    return connection.generation !== pool.generation;\n}\nfunction shouldHandleStateChangeError(server, err) {\n    const etv = err.topologyVersion;\n    const stv = server.description.topologyVersion;\n    return (0, server_description_1.compareTopologyVersion)(stv, etv) < 0;\n}\nfunction inActiveTransaction(session, cmd) {\n    return session && session.inTransaction() && !(0, transactions_1.isTransactionCommand)(cmd);\n}\n/** this checks the retryWrites option passed down from the client options, it\n * does not check if the server supports retryable writes */\nfunction isRetryableWritesEnabled(topology) {\n    return topology.s.options.retryWrites !== false;\n}\n//# sourceMappingURL=server.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGNBQWM7QUFDZCxxQkFBcUIsbUJBQU8sQ0FBQyxpSEFBb0I7QUFDakQsMEJBQTBCLG1CQUFPLENBQUMsMkhBQXlCO0FBQzNELGlCQUFpQixtQkFBTyxDQUFDLHlHQUFnQjtBQUN6QyxvQkFBb0IsbUJBQU8sQ0FBQyxxR0FBYztBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxzQkFBc0IsbUJBQU8sQ0FBQyx5R0FBZ0I7QUFDOUMsdUJBQXVCLG1CQUFPLENBQUMsMkdBQWlCO0FBQ2hELGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLHdCQUF3QixtQkFBTyxDQUFDLDZHQUFrQjtBQUNsRCxpQkFBaUIsbUJBQU8sQ0FBQyxtR0FBVTtBQUNuQyxrQkFBa0IsbUJBQU8sQ0FBQyxxR0FBVztBQUNyQyw2QkFBNkIsbUJBQU8sQ0FBQywySEFBc0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixZQUFZO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGlDQUFpQztBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxpQ0FBaUM7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixhQUFhO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxSUFBcUksT0FBTztBQUM1STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXJ2ZXIgPSB2b2lkIDA7XG5jb25zdCBjb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi4vY21hcC9jb25uZWN0aW9uXCIpO1xuY29uc3QgY29ubmVjdGlvbl9wb29sXzEgPSByZXF1aXJlKFwiLi4vY21hcC9jb25uZWN0aW9uX3Bvb2xcIik7XG5jb25zdCBlcnJvcnNfMSA9IHJlcXVpcmUoXCIuLi9jbWFwL2Vycm9yc1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCBtb25nb190eXBlc18xID0gcmVxdWlyZShcIi4uL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgdHJhbnNhY3Rpb25zXzEgPSByZXF1aXJlKFwiLi4vdHJhbnNhY3Rpb25zXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuLi93cml0ZV9jb25jZXJuXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG5jb25zdCBtb25pdG9yXzEgPSByZXF1aXJlKFwiLi9tb25pdG9yXCIpO1xuY29uc3Qgc2VydmVyX2Rlc2NyaXB0aW9uXzEgPSByZXF1aXJlKFwiLi9zZXJ2ZXJfZGVzY3JpcHRpb25cIik7XG5jb25zdCBzdGF0ZVRyYW5zaXRpb24gPSAoMCwgdXRpbHNfMS5tYWtlU3RhdGVNYWNoaW5lKSh7XG4gICAgW2NvbW1vbl8xLlNUQVRFX0NMT1NFRF06IFtjb21tb25fMS5TVEFURV9DTE9TRUQsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RJTkddLFxuICAgIFtjb21tb25fMS5TVEFURV9DT05ORUNUSU5HXTogW2NvbW1vbl8xLlNUQVRFX0NPTk5FQ1RJTkcsIGNvbW1vbl8xLlNUQVRFX0NMT1NJTkcsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCwgY29tbW9uXzEuU1RBVEVfQ0xPU0VEXSxcbiAgICBbY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVEXTogW2NvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCwgY29tbW9uXzEuU1RBVEVfQ0xPU0lORywgY29tbW9uXzEuU1RBVEVfQ0xPU0VEXSxcbiAgICBbY29tbW9uXzEuU1RBVEVfQ0xPU0lOR106IFtjb21tb25fMS5TVEFURV9DTE9TSU5HLCBjb21tb25fMS5TVEFURV9DTE9TRURdXG59KTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFNlcnZlciBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHNlcnZlclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5LCBkZXNjcmlwdGlvbiwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLm9uKCdlcnJvcicsIHV0aWxzXzEubm9vcCk7XG4gICAgICAgIHRoaXMuc2VydmVyQXBpID0gb3B0aW9ucy5zZXJ2ZXJBcGk7XG4gICAgICAgIGNvbnN0IHBvb2xPcHRpb25zID0geyBob3N0QWRkcmVzczogZGVzY3JpcHRpb24uaG9zdEFkZHJlc3MsIC4uLm9wdGlvbnMgfTtcbiAgICAgICAgdGhpcy50b3BvbG9neSA9IHRvcG9sb2d5O1xuICAgICAgICB0aGlzLnBvb2wgPSBuZXcgY29ubmVjdGlvbl9wb29sXzEuQ29ubmVjdGlvblBvb2wodGhpcywgcG9vbE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnMgPSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICBzdGF0ZTogY29tbW9uXzEuU1RBVEVfQ0xPU0VELFxuICAgICAgICAgICAgb3BlcmF0aW9uQ291bnQ6IDBcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiBbLi4uY29uc3RhbnRzXzEuQ01BUF9FVkVOVFMsIC4uLmNvbnN0YW50c18xLkFQTV9FVkVOVFNdKSB7XG4gICAgICAgICAgICB0aGlzLnBvb2wub24oZXZlbnQsIChlKSA9PiB0aGlzLmVtaXQoZXZlbnQsIGUpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvb2wub24oY29ubmVjdGlvbl8xLkNvbm5lY3Rpb24uQ0xVU1RFUl9USU1FX1JFQ0VJVkVELCAoY2x1c3RlclRpbWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2x1c3RlclRpbWUgPSBjbHVzdGVyVGltZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgdGhpcy5tb25pdG9yID0gbnVsbDtcbiAgICAgICAgICAgIC8vIG1vbml0b3JpbmcgaXMgZGlzYWJsZWQgaW4gbG9hZCBiYWxhbmNpbmcgbW9kZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNyZWF0ZSB0aGUgbW9uaXRvclxuICAgICAgICB0aGlzLm1vbml0b3IgPSBuZXcgbW9uaXRvcl8xLk1vbml0b3IodGhpcywgdGhpcy5zLm9wdGlvbnMpO1xuICAgICAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGNvbnN0YW50c18xLkhFQVJUQkVBVF9FVkVOVFMpIHtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvci5vbihldmVudCwgKGUpID0+IHRoaXMuZW1pdChldmVudCwgZSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9uaXRvci5vbigncmVzZXRTZXJ2ZXInLCAoZXJyb3IpID0+IG1hcmtTZXJ2ZXJVbmtub3duKHRoaXMsIGVycm9yKSk7XG4gICAgICAgIHRoaXMubW9uaXRvci5vbihTZXJ2ZXIuU0VSVkVSX0hFQVJUQkVBVF9TVUNDRUVERUQsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5lbWl0KFNlcnZlci5ERVNDUklQVElPTl9SRUNFSVZFRCwgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKHRoaXMuZGVzY3JpcHRpb24uaG9zdEFkZHJlc3MsIGV2ZW50LnJlcGx5LCB7XG4gICAgICAgICAgICAgICAgcm91bmRUcmlwVGltZTogdGhpcy5tb25pdG9yPy5yb3VuZFRyaXBUaW1lLFxuICAgICAgICAgICAgICAgIG1pblJvdW5kVHJpcFRpbWU6IHRoaXMubW9uaXRvcj8ubWluUm91bmRUcmlwVGltZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ09OTkVDVElORykge1xuICAgICAgICAgICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DT05ORUNURUQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdChTZXJ2ZXIuQ09OTkVDVCwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgY2x1c3RlclRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvcG9sb2d5LmNsdXN0ZXJUaW1lO1xuICAgIH1cbiAgICBzZXQgY2x1c3RlclRpbWUoY2x1c3RlclRpbWUpIHtcbiAgICAgICAgdGhpcy50b3BvbG9neS5jbHVzdGVyVGltZSA9IGNsdXN0ZXJUaW1lO1xuICAgIH1cbiAgICBnZXQgZGVzY3JpcHRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnMuZGVzY3JpcHRpb247XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmRlc2NyaXB0aW9uLmFkZHJlc3M7XG4gICAgfVxuICAgIGdldCBhdXRvRW5jcnlwdGVyKCkge1xuICAgICAgICBpZiAodGhpcy5zLm9wdGlvbnMgJiYgdGhpcy5zLm9wdGlvbnMuYXV0b0VuY3J5cHRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLmF1dG9FbmNyeXB0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBnZXQgbG9hZEJhbGFuY2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b3BvbG9neS5kZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuTG9hZEJhbGFuY2VkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbml0aWF0ZSBzZXJ2ZXIgY29ubmVjdFxuICAgICAqL1xuICAgIGNvbm5lY3QoKSB7XG4gICAgICAgIGlmICh0aGlzLnMuc3RhdGUgIT09IGNvbW1vbl8xLlNUQVRFX0NMT1NFRCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DT05ORUNUSU5HKTtcbiAgICAgICAgLy8gSWYgaW4gbG9hZCBiYWxhbmNlciBtb2RlIHdlIGF1dG9tYXRpY2FsbHkgc2V0IHRoZSBzZXJ2ZXIgdG9cbiAgICAgICAgLy8gYSBsb2FkIGJhbGFuY2VyLiBJdCBuZXZlciB0cmFuc2l0aW9ucyBvdXQgb2YgdGhpcyBzdGF0ZSBhbmRcbiAgICAgICAgLy8gaGFzIG5vIG1vbml0b3IuXG4gICAgICAgIGlmICghdGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvcj8uY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoU2VydmVyLkNPTk5FQ1QsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBEZXN0cm95IHRoZSBzZXJ2ZXIgY29ubmVjdGlvbiAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGlmICh0aGlzLnMuc3RhdGUgPT09IGNvbW1vbl8xLlNUQVRFX0NMT1NFRCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DTE9TSU5HKTtcbiAgICAgICAgaWYgKCF0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgdGhpcy5tb25pdG9yPy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucG9vbC5jbG9zZSgpO1xuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0VEKTtcbiAgICAgICAgdGhpcy5lbWl0KCdjbG9zZWQnKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW1tZWRpYXRlbHkgc2NoZWR1bGUgbW9uaXRvcmluZyBvZiB0aGlzIHNlcnZlci4gSWYgdGhlcmUgYWxyZWFkeSBhbiBhdHRlbXB0IGJlaW5nIG1hZGVcbiAgICAgKiB0aGlzIHdpbGwgYmUgYSBuby1vcC5cbiAgICAgKi9cbiAgICByZXF1ZXN0Q2hlY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvcj8ucmVxdWVzdENoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgY29tbWFuZChucywgY21kLCB7IC4uLm9wdGlvbnMgfSwgcmVzcG9uc2VUeXBlKSB7XG4gICAgICAgIGlmIChucy5kYiA9PSBudWxsIHx8IHR5cGVvZiBucyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ05hbWVzcGFjZSBtdXN0IG5vdCBiZSBhIHN0cmluZycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnMuc3RhdGUgPT09IGNvbW1vbl8xLlNUQVRFX0NMT1NJTkcgfHwgdGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TRUQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvU2VydmVyQ2xvc2VkRXJyb3IoKTtcbiAgICAgICAgfVxuICAgICAgICBvcHRpb25zLmRpcmVjdENvbm5lY3Rpb24gPSB0aGlzLnRvcG9sb2d5LnMub3B0aW9ucy5kaXJlY3RDb25uZWN0aW9uO1xuICAgICAgICAvLyBUaGVyZSBhcmUgY2FzZXMgd2hlcmUgd2UgbmVlZCB0byBmbGFnIHRoZSByZWFkIHByZWZlcmVuY2Ugbm90IHRvIGdldCBzZW50IGluXG4gICAgICAgIC8vIHRoZSBjb21tYW5kLCBzdWNoIGFzIHByZS01LjAgc2VydmVycyBhdHRlbXB0aW5nIHRvIHBlcmZvcm0gYW4gYWdncmVnYXRlIHdyaXRlXG4gICAgICAgIC8vIHdpdGggYSBub24tcHJpbWFyeSByZWFkIHByZWZlcmVuY2UuIEluIHRoaXMgY2FzZSB0aGUgZWZmZWN0aXZlIHJlYWQgcHJlZmVyZW5jZVxuICAgICAgICAvLyAocHJpbWFyeSkgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBwcm92aWRlZCBhbmQgbXVzdCBiZSByZW1vdmVkIGNvbXBsZXRlbHkuXG4gICAgICAgIGlmIChvcHRpb25zLm9taXRSZWFkUHJlZmVyZW5jZSkge1xuICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMucmVhZFByZWZlcmVuY2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZGVzY3JpcHRpb24uaXNjcnlwdGQpIHtcbiAgICAgICAgICAgIG9wdGlvbnMub21pdE1heFRpbWVNUyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG9wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgbGV0IGNvbm4gPSBzZXNzaW9uPy5waW5uZWRDb25uZWN0aW9uO1xuICAgICAgICB0aGlzLmluY3JlbWVudE9wZXJhdGlvbkNvdW50KCk7XG4gICAgICAgIGlmIChjb25uID09IG51bGwpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29ubiA9IGF3YWl0IHRoaXMucG9vbC5jaGVja091dChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb2FkQmFsYW5jZWQgJiYgaXNQaW5uYWJsZUNvbW1hbmQoY21kLCBzZXNzaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uPy5waW4oY29ubik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGNoZWNrb3V0RXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlY3JlbWVudE9wZXJhdGlvbkNvdW50KCk7XG4gICAgICAgICAgICAgICAgaWYgKCEoY2hlY2tvdXRFcnJvciBpbnN0YW5jZW9mIGVycm9yc18xLlBvb2xDbGVhcmVkRXJyb3IpKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGNoZWNrb3V0RXJyb3IpO1xuICAgICAgICAgICAgICAgIHRocm93IGNoZWNrb3V0RXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJlYXV0aFByb21pc2UgPSBudWxsO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjb25uLmNvbW1hbmQobnMsIGNtZCwgb3B0aW9ucywgcmVzcG9uc2VUeXBlKTtcbiAgICAgICAgICAgICAgICAoMCwgd3JpdGVfY29uY2Vybl8xLnRocm93SWZXcml0ZUNvbmNlcm5FcnJvcikocmVzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGNvbW1hbmRFcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IHRoaXMuZGVjb3JhdGVDb21tYW5kRXJyb3IoY29ubiwgY21kLCBvcHRpb25zLCBjb21tYW5kRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChvcGVyYXRpb25FcnJvcikge1xuICAgICAgICAgICAgaWYgKG9wZXJhdGlvbkVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmXG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uRXJyb3IuY29kZSA9PT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLlJlYXV0aGVudGljYXRlKSB7XG4gICAgICAgICAgICAgICAgcmVhdXRoUHJvbWlzZSA9IHRoaXMucG9vbC5yZWF1dGhlbnRpY2F0ZShjb25uKTtcbiAgICAgICAgICAgICAgICByZWF1dGhQcm9taXNlLnRoZW4odW5kZWZpbmVkLCBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlYXV0aFByb21pc2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5zcXVhc2hFcnJvcikoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGF3YWl0ICgwLCB1dGlsc18xLmFib3J0YWJsZSkocmVhdXRoUHJvbWlzZSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgcmVhdXRoUHJvbWlzZSA9IG51bGw7IC8vIG9ubHkgcmVhY2hhYmxlIGlmIHJlYXV0aCBzdWNjZWVkc1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNvbm4uY29tbWFuZChucywgY21kLCBvcHRpb25zLCByZXNwb25zZVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAoMCwgd3JpdGVfY29uY2Vybl8xLnRocm93SWZXcml0ZUNvbmNlcm5FcnJvcikocmVzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGNvbW1hbmRFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLmRlY29yYXRlQ29tbWFuZEVycm9yKGNvbm4sIGNtZCwgb3B0aW9ucywgY29tbWFuZEVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBvcGVyYXRpb25FcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuZGVjcmVtZW50T3BlcmF0aW9uQ291bnQoKTtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uPy5waW5uZWRDb25uZWN0aW9uICE9PSBjb25uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlYXV0aFByb21pc2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcmVhdXRoIHByb21pc2Ugb25seSBleGlzdHMgaWYgaXQgaGFzbid0IHRocm93bi5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hlY2tCYWNrSW4gPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvb2wuY2hlY2tJbihjb25uKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdm9pZCByZWF1dGhQcm9taXNlLnRoZW4oY2hlY2tCYWNrSW4sIGNoZWNrQmFja0luKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9vbC5jaGVja0luKGNvbm4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgU0RBTSBlcnJvclxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGhhbmRsZUVycm9yKGVycm9yLCBjb25uZWN0aW9uKSB7XG4gICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzU3RhbGVFcnJvciA9IGVycm9yLmNvbm5lY3Rpb25HZW5lcmF0aW9uICYmIGVycm9yLmNvbm5lY3Rpb25HZW5lcmF0aW9uIDwgdGhpcy5wb29sLmdlbmVyYXRpb247XG4gICAgICAgIGlmIChpc1N0YWxlRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpc05ldHdvcmtOb25UaW1lb3V0RXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IgJiYgIShlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yKTtcbiAgICAgICAgY29uc3QgaXNOZXR3b3JrVGltZW91dEJlZm9yZUhhbmRzaGFrZUVycm9yID0gZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvTmV0d29ya0Vycm9yICYmIGVycm9yLmJlZm9yZUhhbmRzaGFrZTtcbiAgICAgICAgY29uc3QgaXNBdXRoSGFuZHNoYWtlRXJyb3IgPSBlcnJvci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLkhhbmRzaGFrZUVycm9yKTtcbiAgICAgICAgaWYgKGlzTmV0d29ya05vblRpbWVvdXRFcnJvciB8fCBpc05ldHdvcmtUaW1lb3V0QmVmb3JlSGFuZHNoYWtlRXJyb3IgfHwgaXNBdXRoSGFuZHNoYWtlRXJyb3IpIHtcbiAgICAgICAgICAgIC8vIEluIGxvYWQgYmFsYW5jZWQgbW9kZSB3ZSBuZXZlciBtYXJrIHRoZSBzZXJ2ZXIgYXMgdW5rbm93biBhbmQgYWx3YXlzXG4gICAgICAgICAgICAvLyBjbGVhciBmb3IgdGhlIHNwZWNpZmljIHNlcnZpY2UgaWQuXG4gICAgICAgICAgICBpZiAoIXRoaXMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5SZXNldFBvb2wpO1xuICAgICAgICAgICAgICAgIG1hcmtTZXJ2ZXJVbmtub3duKHRoaXMsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvb2wuY2xlYXIoeyBzZXJ2aWNlSWQ6IGNvbm5lY3Rpb24uc2VydmljZUlkIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCgwLCBlcnJvcl8xLmlzU0RBTVVucmVjb3ZlcmFibGVFcnJvcikoZXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlRXJyb3IodGhpcywgZXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNob3VsZENsZWFyUG9vbCA9ICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKSh0aGlzKSA8PSA3IHx8ICgwLCBlcnJvcl8xLmlzTm9kZVNodXR0aW5nRG93bkVycm9yKShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCAmJiBjb25uZWN0aW9uICYmIHNob3VsZENsZWFyUG9vbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb29sLmNsZWFyKHsgc2VydmljZUlkOiBjb25uZWN0aW9uLnNlcnZpY2VJZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkQ2xlYXJQb29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5SZXNldFBvb2wpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbWFya1NlcnZlclVua25vd24odGhpcywgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB0aGlzLnJlcXVlc3RDaGVjaygpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnN1cmUgdGhhdCBlcnJvciBpcyBwcm9wZXJseSBkZWNvcmF0ZWQgYW5kIGludGVybmFsIHN0YXRlIGlzIHVwZGF0ZWQgYmVmb3JlIHRocm93aW5nXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgZGVjb3JhdGVDb21tYW5kRXJyb3IoY29ubmVjdGlvbiwgY21kLCBvcHRpb25zLCBlcnJvcikge1xuICAgICAgICBpZiAodHlwZW9mIGVycm9yICE9PSAnb2JqZWN0JyB8fCBlcnJvciA9PSBudWxsIHx8ICEoJ25hbWUnIGluIGVycm9yKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ0FuIHVuZXhwZWN0ZWQgZXJyb3IgdHlwZTogJyArIHR5cGVvZiBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJyAmJiAnY2F1c2UnIGluIGVycm9yICYmIGVycm9yLmNhdXNlIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yKSB7XG4gICAgICAgICAgICBlcnJvciA9IGVycm9yLmNhdXNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yKSkge1xuICAgICAgICAgICAgLy8gTm9kZS5qcyBvciBzb21lIG90aGVyIGVycm9yIHdlIGhhdmUgbm90IHNwZWNpYWwgaGFuZGxpbmcgZm9yXG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbm5lY3Rpb25Jc1N0YWxlKHRoaXMucG9vbCwgY29ubmVjdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZXNzaW9uID0gb3B0aW9ucz8uc2Vzc2lvbjtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb05ldHdvcmtFcnJvcikge1xuICAgICAgICAgICAgaWYgKHNlc3Npb24gJiYgIXNlc3Npb24uaGFzRW5kZWQgJiYgc2Vzc2lvbi5zZXJ2ZXJTZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5zZXJ2ZXJTZXNzaW9uLmlzRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaW5BY3RpdmVUcmFuc2FjdGlvbiBjaGVjayBoYW5kbGVzIGNvbW1pdCBhbmQgYWJvcnQuXG4gICAgICAgICAgICBpZiAoaW5BY3RpdmVUcmFuc2FjdGlvbihzZXNzaW9uLCBjbWQpICYmXG4gICAgICAgICAgICAgICAgIWVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcikpIHtcbiAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlRyYW5zaWVudFRyYW5zYWN0aW9uRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChpc1JldHJ5YWJsZVdyaXRlc0VuYWJsZWQodGhpcy50b3BvbG9neSkgfHwgKDAsIHRyYW5zYWN0aW9uc18xLmlzVHJhbnNhY3Rpb25Db21tYW5kKShjbWQpKSAmJlxuICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLnN1cHBvcnRzUmV0cnlhYmxlV3JpdGVzKSh0aGlzKSAmJlxuICAgICAgICAgICAgICAgICFpbkFjdGl2ZVRyYW5zYWN0aW9uKHNlc3Npb24sIGNtZCkpIHtcbiAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJldHJ5YWJsZVdyaXRlRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKChpc1JldHJ5YWJsZVdyaXRlc0VuYWJsZWQodGhpcy50b3BvbG9neSkgfHwgKDAsIHRyYW5zYWN0aW9uc18xLmlzVHJhbnNhY3Rpb25Db21tYW5kKShjbWQpKSAmJlxuICAgICAgICAgICAgICAgICgwLCBlcnJvcl8xLm5lZWRzUmV0cnlhYmxlV3JpdGVMYWJlbCkoZXJyb3IsICgwLCB1dGlsc18xLm1heFdpcmVWZXJzaW9uKSh0aGlzKSwgdGhpcy5kZXNjcmlwdGlvbi50eXBlKSAmJlxuICAgICAgICAgICAgICAgICFpbkFjdGl2ZVRyYW5zYWN0aW9uKHNlc3Npb24sIGNtZCkpIHtcbiAgICAgICAgICAgICAgICBlcnJvci5hZGRFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlJldHJ5YWJsZVdyaXRlRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzZXNzaW9uICYmXG4gICAgICAgICAgICBzZXNzaW9uLmlzUGlubmVkICYmXG4gICAgICAgICAgICBlcnJvci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlRyYW5zaWVudFRyYW5zYWN0aW9uRXJyb3IpKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnVucGluKHsgZm9yY2U6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvciwgY29ubmVjdGlvbik7XG4gICAgICAgIHJldHVybiBlcnJvcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVjcmVtZW50IHRoZSBvcGVyYXRpb24gY291bnQsIHJldHVybmluZyB0aGUgbmV3IGNvdW50LlxuICAgICAqL1xuICAgIGRlY3JlbWVudE9wZXJhdGlvbkNvdW50KCkge1xuICAgICAgICByZXR1cm4gKHRoaXMucy5vcGVyYXRpb25Db3VudCAtPSAxKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5jcmVtZW50IHRoZSBvcGVyYXRpb24gY291bnQsIHJldHVybmluZyB0aGUgbmV3IGNvdW50LlxuICAgICAqL1xuICAgIGluY3JlbWVudE9wZXJhdGlvbkNvdW50KCkge1xuICAgICAgICByZXR1cm4gKHRoaXMucy5vcGVyYXRpb25Db3VudCArPSAxKTtcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlciA9IFNlcnZlcjtcbi8qKiBAZXZlbnQgKi9cblNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQgPSBjb25zdGFudHNfMS5TRVJWRVJfSEVBUlRCRUFUX1NUQVJURUQ7XG4vKiogQGV2ZW50ICovXG5TZXJ2ZXIuU0VSVkVSX0hFQVJUQkVBVF9TVUNDRUVERUQgPSBjb25zdGFudHNfMS5TRVJWRVJfSEVBUlRCRUFUX1NVQ0NFRURFRDtcbi8qKiBAZXZlbnQgKi9cblNlcnZlci5TRVJWRVJfSEVBUlRCRUFUX0ZBSUxFRCA9IGNvbnN0YW50c18xLlNFUlZFUl9IRUFSVEJFQVRfRkFJTEVEO1xuLyoqIEBldmVudCAqL1xuU2VydmVyLkNPTk5FQ1QgPSBjb25zdGFudHNfMS5DT05ORUNUO1xuLyoqIEBldmVudCAqL1xuU2VydmVyLkRFU0NSSVBUSU9OX1JFQ0VJVkVEID0gY29uc3RhbnRzXzEuREVTQ1JJUFRJT05fUkVDRUlWRUQ7XG4vKiogQGV2ZW50ICovXG5TZXJ2ZXIuQ0xPU0VEID0gY29uc3RhbnRzXzEuQ0xPU0VEO1xuLyoqIEBldmVudCAqL1xuU2VydmVyLkVOREVEID0gY29uc3RhbnRzXzEuRU5ERUQ7XG5mdW5jdGlvbiBtYXJrU2VydmVyVW5rbm93bihzZXJ2ZXIsIGVycm9yKSB7XG4gICAgLy8gTG9hZCBiYWxhbmNlciBzZXJ2ZXJzIGNhbiBuZXZlciBiZSBtYXJrZWQgdW5rbm93bi5cbiAgICBpZiAoc2VydmVyLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrRXJyb3IgJiYgIShlcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yKSkge1xuICAgICAgICBzZXJ2ZXIubW9uaXRvcj8ucmVzZXQoKTtcbiAgICB9XG4gICAgc2VydmVyLmVtaXQoU2VydmVyLkRFU0NSSVBUSU9OX1JFQ0VJVkVELCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oc2VydmVyLmRlc2NyaXB0aW9uLmhvc3RBZGRyZXNzLCB1bmRlZmluZWQsIHsgZXJyb3IgfSkpO1xufVxuZnVuY3Rpb24gaXNQaW5uYWJsZUNvbW1hbmQoY21kLCBzZXNzaW9uKSB7XG4gICAgaWYgKHNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSB8fFxuICAgICAgICAgICAgKHNlc3Npb24udHJhbnNhY3Rpb24uaXNDb21taXR0ZWQgJiYgJ2NvbW1pdFRyYW5zYWN0aW9uJyBpbiBjbWQpIHx8XG4gICAgICAgICAgICAnYWdncmVnYXRlJyBpbiBjbWQgfHxcbiAgICAgICAgICAgICdmaW5kJyBpbiBjbWQgfHxcbiAgICAgICAgICAgICdnZXRNb3JlJyBpbiBjbWQgfHxcbiAgICAgICAgICAgICdsaXN0Q29sbGVjdGlvbnMnIGluIGNtZCB8fFxuICAgICAgICAgICAgJ2xpc3RJbmRleGVzJyBpbiBjbWQgfHxcbiAgICAgICAgICAgICdidWxrV3JpdGUnIGluIGNtZCk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGNvbm5lY3Rpb25Jc1N0YWxlKHBvb2wsIGNvbm5lY3Rpb24pIHtcbiAgICBpZiAoY29ubmVjdGlvbi5zZXJ2aWNlSWQpIHtcbiAgICAgICAgcmV0dXJuIChjb25uZWN0aW9uLmdlbmVyYXRpb24gIT09IHBvb2wuc2VydmljZUdlbmVyYXRpb25zLmdldChjb25uZWN0aW9uLnNlcnZpY2VJZC50b0hleFN0cmluZygpKSk7XG4gICAgfVxuICAgIHJldHVybiBjb25uZWN0aW9uLmdlbmVyYXRpb24gIT09IHBvb2wuZ2VuZXJhdGlvbjtcbn1cbmZ1bmN0aW9uIHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlRXJyb3Ioc2VydmVyLCBlcnIpIHtcbiAgICBjb25zdCBldHYgPSBlcnIudG9wb2xvZ3lWZXJzaW9uO1xuICAgIGNvbnN0IHN0diA9IHNlcnZlci5kZXNjcmlwdGlvbi50b3BvbG9neVZlcnNpb247XG4gICAgcmV0dXJuICgwLCBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5jb21wYXJlVG9wb2xvZ3lWZXJzaW9uKShzdHYsIGV0dikgPCAwO1xufVxuZnVuY3Rpb24gaW5BY3RpdmVUcmFuc2FjdGlvbihzZXNzaW9uLCBjbWQpIHtcbiAgICByZXR1cm4gc2Vzc2lvbiAmJiBzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSAmJiAhKDAsIHRyYW5zYWN0aW9uc18xLmlzVHJhbnNhY3Rpb25Db21tYW5kKShjbWQpO1xufVxuLyoqIHRoaXMgY2hlY2tzIHRoZSByZXRyeVdyaXRlcyBvcHRpb24gcGFzc2VkIGRvd24gZnJvbSB0aGUgY2xpZW50IG9wdGlvbnMsIGl0XG4gKiBkb2VzIG5vdCBjaGVjayBpZiB0aGUgc2VydmVyIHN1cHBvcnRzIHJldHJ5YWJsZSB3cml0ZXMgKi9cbmZ1bmN0aW9uIGlzUmV0cnlhYmxlV3JpdGVzRW5hYmxlZCh0b3BvbG9neSkge1xuICAgIHJldHVybiB0b3BvbG9neS5zLm9wdGlvbnMucmV0cnlXcml0ZXMgIT09IGZhbHNlO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2VydmVyLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerDescription = void 0;\nexports.parseServerType = parseServerType;\nexports.compareTopologyVersion = compareTopologyVersion;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst WRITABLE_SERVER_TYPES = new Set([\n    common_1.ServerType.RSPrimary,\n    common_1.ServerType.Standalone,\n    common_1.ServerType.Mongos,\n    common_1.ServerType.LoadBalancer\n]);\nconst DATA_BEARING_SERVER_TYPES = new Set([\n    common_1.ServerType.RSPrimary,\n    common_1.ServerType.RSSecondary,\n    common_1.ServerType.Mongos,\n    common_1.ServerType.Standalone,\n    common_1.ServerType.LoadBalancer\n]);\n/**\n * The client's view of a single server, based on the most recent hello outcome.\n *\n * Internal type, not meant to be directly instantiated\n * @public\n */\nclass ServerDescription {\n    /**\n     * Create a ServerDescription\n     * @internal\n     *\n     * @param address - The address of the server\n     * @param hello - An optional hello response for this server\n     */\n    constructor(address, hello, options = {}) {\n        if (address == null || address === '') {\n            throw new error_1.MongoRuntimeError('ServerDescription must be provided with a non-empty address');\n        }\n        this.address =\n            typeof address === 'string'\n                ? utils_1.HostAddress.fromString(address).toString() // Use HostAddress to normalize\n                : address.toString();\n        this.type = parseServerType(hello, options);\n        this.hosts = hello?.hosts?.map((host) => host.toLowerCase()) ?? [];\n        this.passives = hello?.passives?.map((host) => host.toLowerCase()) ?? [];\n        this.arbiters = hello?.arbiters?.map((host) => host.toLowerCase()) ?? [];\n        this.tags = hello?.tags ?? {};\n        this.minWireVersion = hello?.minWireVersion ?? 0;\n        this.maxWireVersion = hello?.maxWireVersion ?? 0;\n        this.roundTripTime = options?.roundTripTime ?? -1;\n        this.minRoundTripTime = options?.minRoundTripTime ?? 0;\n        this.lastUpdateTime = (0, utils_1.now)();\n        this.lastWriteDate = hello?.lastWrite?.lastWriteDate ?? 0;\n        // NOTE: This actually builds the stack string instead of holding onto the getter and all its\n        // associated references. This is done to prevent a memory leak.\n        this.error = options.error ?? null;\n        this.error?.stack;\n        // TODO(NODE-2674): Preserve int64 sent from MongoDB\n        this.topologyVersion = this.error?.topologyVersion ?? hello?.topologyVersion ?? null;\n        this.setName = hello?.setName ?? null;\n        this.setVersion = hello?.setVersion ?? null;\n        this.electionId = hello?.electionId ?? null;\n        this.logicalSessionTimeoutMinutes = hello?.logicalSessionTimeoutMinutes ?? null;\n        this.maxMessageSizeBytes = hello?.maxMessageSizeBytes ?? null;\n        this.maxWriteBatchSize = hello?.maxWriteBatchSize ?? null;\n        this.maxBsonObjectSize = hello?.maxBsonObjectSize ?? null;\n        this.primary = hello?.primary ?? null;\n        this.me = hello?.me?.toLowerCase() ?? null;\n        this.$clusterTime = hello?.$clusterTime ?? null;\n        this.iscryptd = Boolean(hello?.iscryptd);\n    }\n    get hostAddress() {\n        return utils_1.HostAddress.fromString(this.address);\n    }\n    get allHosts() {\n        return this.hosts.concat(this.arbiters).concat(this.passives);\n    }\n    /** Is this server available for reads*/\n    get isReadable() {\n        return this.type === common_1.ServerType.RSSecondary || this.isWritable;\n    }\n    /** Is this server data bearing */\n    get isDataBearing() {\n        return DATA_BEARING_SERVER_TYPES.has(this.type);\n    }\n    /** Is this server available for writes */\n    get isWritable() {\n        return WRITABLE_SERVER_TYPES.has(this.type);\n    }\n    get host() {\n        const chopLength = `:${this.port}`.length;\n        return this.address.slice(0, -chopLength);\n    }\n    get port() {\n        const port = this.address.split(':').pop();\n        return port ? Number.parseInt(port, 10) : 27017;\n    }\n    /**\n     * Determines if another `ServerDescription` is equal to this one per the rules defined in the SDAM specification.\n     * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.md\n     */\n    equals(other) {\n        // Despite using the comparator that would determine a nullish topologyVersion as greater than\n        // for equality we should only always perform direct equality comparison\n        const topologyVersionsEqual = this.topologyVersion === other?.topologyVersion ||\n            compareTopologyVersion(this.topologyVersion, other?.topologyVersion) === 0;\n        const electionIdsEqual = this.electionId != null && other?.electionId != null\n            ? (0, utils_1.compareObjectId)(this.electionId, other.electionId) === 0\n            : this.electionId === other?.electionId;\n        return (other != null &&\n            other.iscryptd === this.iscryptd &&\n            (0, utils_1.errorStrictEqual)(this.error, other.error) &&\n            this.type === other.type &&\n            this.minWireVersion === other.minWireVersion &&\n            (0, utils_1.arrayStrictEqual)(this.hosts, other.hosts) &&\n            tagsStrictEqual(this.tags, other.tags) &&\n            this.setName === other.setName &&\n            this.setVersion === other.setVersion &&\n            electionIdsEqual &&\n            this.primary === other.primary &&\n            this.logicalSessionTimeoutMinutes === other.logicalSessionTimeoutMinutes &&\n            topologyVersionsEqual);\n    }\n}\nexports.ServerDescription = ServerDescription;\n// Parses a `hello` message and determines the server type\nfunction parseServerType(hello, options) {\n    if (options?.loadBalanced) {\n        return common_1.ServerType.LoadBalancer;\n    }\n    if (!hello || !hello.ok) {\n        return common_1.ServerType.Unknown;\n    }\n    if (hello.isreplicaset) {\n        return common_1.ServerType.RSGhost;\n    }\n    if (hello.msg && hello.msg === 'isdbgrid') {\n        return common_1.ServerType.Mongos;\n    }\n    if (hello.setName) {\n        if (hello.hidden) {\n            return common_1.ServerType.RSOther;\n        }\n        else if (hello.isWritablePrimary) {\n            return common_1.ServerType.RSPrimary;\n        }\n        else if (hello.secondary) {\n            return common_1.ServerType.RSSecondary;\n        }\n        else if (hello.arbiterOnly) {\n            return common_1.ServerType.RSArbiter;\n        }\n        else {\n            return common_1.ServerType.RSOther;\n        }\n    }\n    return common_1.ServerType.Standalone;\n}\nfunction tagsStrictEqual(tags, tags2) {\n    const tagsKeys = Object.keys(tags);\n    const tags2Keys = Object.keys(tags2);\n    return (tagsKeys.length === tags2Keys.length &&\n        tagsKeys.every((key) => tags2[key] === tags[key]));\n}\n/**\n * Compares two topology versions.\n *\n * 1. If the response topologyVersion is unset or the ServerDescription's\n *    topologyVersion is null, the client MUST assume the response is more recent.\n * 1. If the response's topologyVersion.processId is not equal to the\n *    ServerDescription's, the client MUST assume the response is more recent.\n * 1. If the response's topologyVersion.processId is equal to the\n *    ServerDescription's, the client MUST use the counter field to determine\n *    which topologyVersion is more recent.\n *\n * ```ts\n * currentTv <   newTv === -1\n * currentTv === newTv === 0\n * currentTv >   newTv === 1\n * ```\n */\nfunction compareTopologyVersion(currentTv, newTv) {\n    if (currentTv == null || newTv == null) {\n        return -1;\n    }\n    if (!currentTv.processId.equals(newTv.processId)) {\n        return -1;\n    }\n    // TODO(NODE-2674): Preserve int64 sent from MongoDB\n    const currentCounter = typeof currentTv.counter === 'bigint'\n        ? bson_1.Long.fromBigInt(currentTv.counter)\n        : bson_1.Long.isLong(currentTv.counter)\n            ? currentTv.counter\n            : bson_1.Long.fromNumber(currentTv.counter);\n    const newCounter = typeof newTv.counter === 'bigint'\n        ? bson_1.Long.fromBigInt(newTv.counter)\n        : bson_1.Long.isLong(newTv.counter)\n            ? newTv.counter\n            : bson_1.Long.fromNumber(newTv.counter);\n    return currentCounter.compare(newCounter);\n}\n//# sourceMappingURL=server_description.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyX2Rlc2NyaXB0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QjtBQUN6Qix1QkFBdUI7QUFDdkIsOEJBQThCO0FBQzlCLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxpQkFBaUIsbUJBQU8sQ0FBQyxtR0FBVTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsVUFBVTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyX2Rlc2NyaXB0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZXJ2ZXJEZXNjcmlwdGlvbiA9IHZvaWQgMDtcbmV4cG9ydHMucGFyc2VTZXJ2ZXJUeXBlID0gcGFyc2VTZXJ2ZXJUeXBlO1xuZXhwb3J0cy5jb21wYXJlVG9wb2xvZ3lWZXJzaW9uID0gY29tcGFyZVRvcG9sb2d5VmVyc2lvbjtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuLi9ic29uXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2NvbW1vblwiKTtcbmNvbnN0IFdSSVRBQkxFX1NFUlZFUl9UWVBFUyA9IG5ldyBTZXQoW1xuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5LFxuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZSxcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLk1vbmdvcyxcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLkxvYWRCYWxhbmNlclxuXSk7XG5jb25zdCBEQVRBX0JFQVJJTkdfU0VSVkVSX1RZUEVTID0gbmV3IFNldChbXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnksXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU1NlY29uZGFyeSxcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLk1vbmdvcyxcbiAgICBjb21tb25fMS5TZXJ2ZXJUeXBlLlN0YW5kYWxvbmUsXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5Mb2FkQmFsYW5jZXJcbl0pO1xuLyoqXG4gKiBUaGUgY2xpZW50J3MgdmlldyBvZiBhIHNpbmdsZSBzZXJ2ZXIsIGJhc2VkIG9uIHRoZSBtb3N0IHJlY2VudCBoZWxsbyBvdXRjb21lLlxuICpcbiAqIEludGVybmFsIHR5cGUsIG5vdCBtZWFudCB0byBiZSBkaXJlY3RseSBpbnN0YW50aWF0ZWRcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgU2VydmVyRGVzY3JpcHRpb24ge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIFNlcnZlckRlc2NyaXB0aW9uXG4gICAgICogQGludGVybmFsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWRkcmVzcyAtIFRoZSBhZGRyZXNzIG9mIHRoZSBzZXJ2ZXJcbiAgICAgKiBAcGFyYW0gaGVsbG8gLSBBbiBvcHRpb25hbCBoZWxsbyByZXNwb25zZSBmb3IgdGhpcyBzZXJ2ZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhZGRyZXNzLCBoZWxsbywgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGlmIChhZGRyZXNzID09IG51bGwgfHwgYWRkcmVzcyA9PT0gJycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdTZXJ2ZXJEZXNjcmlwdGlvbiBtdXN0IGJlIHByb3ZpZGVkIHdpdGggYSBub24tZW1wdHkgYWRkcmVzcycpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWRkcmVzcyA9XG4gICAgICAgICAgICB0eXBlb2YgYWRkcmVzcyA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICA/IHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhhZGRyZXNzKS50b1N0cmluZygpIC8vIFVzZSBIb3N0QWRkcmVzcyB0byBub3JtYWxpemVcbiAgICAgICAgICAgICAgICA6IGFkZHJlc3MudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy50eXBlID0gcGFyc2VTZXJ2ZXJUeXBlKGhlbGxvLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5ob3N0cyA9IGhlbGxvPy5ob3N0cz8ubWFwKChob3N0KSA9PiBob3N0LnRvTG93ZXJDYXNlKCkpID8/IFtdO1xuICAgICAgICB0aGlzLnBhc3NpdmVzID0gaGVsbG8/LnBhc3NpdmVzPy5tYXAoKGhvc3QpID0+IGhvc3QudG9Mb3dlckNhc2UoKSkgPz8gW107XG4gICAgICAgIHRoaXMuYXJiaXRlcnMgPSBoZWxsbz8uYXJiaXRlcnM/Lm1hcCgoaG9zdCkgPT4gaG9zdC50b0xvd2VyQ2FzZSgpKSA/PyBbXTtcbiAgICAgICAgdGhpcy50YWdzID0gaGVsbG8/LnRhZ3MgPz8ge307XG4gICAgICAgIHRoaXMubWluV2lyZVZlcnNpb24gPSBoZWxsbz8ubWluV2lyZVZlcnNpb24gPz8gMDtcbiAgICAgICAgdGhpcy5tYXhXaXJlVmVyc2lvbiA9IGhlbGxvPy5tYXhXaXJlVmVyc2lvbiA/PyAwO1xuICAgICAgICB0aGlzLnJvdW5kVHJpcFRpbWUgPSBvcHRpb25zPy5yb3VuZFRyaXBUaW1lID8/IC0xO1xuICAgICAgICB0aGlzLm1pblJvdW5kVHJpcFRpbWUgPSBvcHRpb25zPy5taW5Sb3VuZFRyaXBUaW1lID8/IDA7XG4gICAgICAgIHRoaXMubGFzdFVwZGF0ZVRpbWUgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIHRoaXMubGFzdFdyaXRlRGF0ZSA9IGhlbGxvPy5sYXN0V3JpdGU/Lmxhc3RXcml0ZURhdGUgPz8gMDtcbiAgICAgICAgLy8gTk9URTogVGhpcyBhY3R1YWxseSBidWlsZHMgdGhlIHN0YWNrIHN0cmluZyBpbnN0ZWFkIG9mIGhvbGRpbmcgb250byB0aGUgZ2V0dGVyIGFuZCBhbGwgaXRzXG4gICAgICAgIC8vIGFzc29jaWF0ZWQgcmVmZXJlbmNlcy4gVGhpcyBpcyBkb25lIHRvIHByZXZlbnQgYSBtZW1vcnkgbGVhay5cbiAgICAgICAgdGhpcy5lcnJvciA9IG9wdGlvbnMuZXJyb3IgPz8gbnVsbDtcbiAgICAgICAgdGhpcy5lcnJvcj8uc3RhY2s7XG4gICAgICAgIC8vIFRPRE8oTk9ERS0yNjc0KTogUHJlc2VydmUgaW50NjQgc2VudCBmcm9tIE1vbmdvREJcbiAgICAgICAgdGhpcy50b3BvbG9neVZlcnNpb24gPSB0aGlzLmVycm9yPy50b3BvbG9neVZlcnNpb24gPz8gaGVsbG8/LnRvcG9sb2d5VmVyc2lvbiA/PyBudWxsO1xuICAgICAgICB0aGlzLnNldE5hbWUgPSBoZWxsbz8uc2V0TmFtZSA/PyBudWxsO1xuICAgICAgICB0aGlzLnNldFZlcnNpb24gPSBoZWxsbz8uc2V0VmVyc2lvbiA/PyBudWxsO1xuICAgICAgICB0aGlzLmVsZWN0aW9uSWQgPSBoZWxsbz8uZWxlY3Rpb25JZCA/PyBudWxsO1xuICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBoZWxsbz8ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyA/PyBudWxsO1xuICAgICAgICB0aGlzLm1heE1lc3NhZ2VTaXplQnl0ZXMgPSBoZWxsbz8ubWF4TWVzc2FnZVNpemVCeXRlcyA/PyBudWxsO1xuICAgICAgICB0aGlzLm1heFdyaXRlQmF0Y2hTaXplID0gaGVsbG8/Lm1heFdyaXRlQmF0Y2hTaXplID8/IG51bGw7XG4gICAgICAgIHRoaXMubWF4QnNvbk9iamVjdFNpemUgPSBoZWxsbz8ubWF4QnNvbk9iamVjdFNpemUgPz8gbnVsbDtcbiAgICAgICAgdGhpcy5wcmltYXJ5ID0gaGVsbG8/LnByaW1hcnkgPz8gbnVsbDtcbiAgICAgICAgdGhpcy5tZSA9IGhlbGxvPy5tZT8udG9Mb3dlckNhc2UoKSA/PyBudWxsO1xuICAgICAgICB0aGlzLiRjbHVzdGVyVGltZSA9IGhlbGxvPy4kY2x1c3RlclRpbWUgPz8gbnVsbDtcbiAgICAgICAgdGhpcy5pc2NyeXB0ZCA9IEJvb2xlYW4oaGVsbG8/LmlzY3J5cHRkKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKHRoaXMuYWRkcmVzcyk7XG4gICAgfVxuICAgIGdldCBhbGxIb3N0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaG9zdHMuY29uY2F0KHRoaXMuYXJiaXRlcnMpLmNvbmNhdCh0aGlzLnBhc3NpdmVzKTtcbiAgICB9XG4gICAgLyoqIElzIHRoaXMgc2VydmVyIGF2YWlsYWJsZSBmb3IgcmVhZHMqL1xuICAgIGdldCBpc1JlYWRhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTU2Vjb25kYXJ5IHx8IHRoaXMuaXNXcml0YWJsZTtcbiAgICB9XG4gICAgLyoqIElzIHRoaXMgc2VydmVyIGRhdGEgYmVhcmluZyAqL1xuICAgIGdldCBpc0RhdGFCZWFyaW5nKCkge1xuICAgICAgICByZXR1cm4gREFUQV9CRUFSSU5HX1NFUlZFUl9UWVBFUy5oYXModGhpcy50eXBlKTtcbiAgICB9XG4gICAgLyoqIElzIHRoaXMgc2VydmVyIGF2YWlsYWJsZSBmb3Igd3JpdGVzICovXG4gICAgZ2V0IGlzV3JpdGFibGUoKSB7XG4gICAgICAgIHJldHVybiBXUklUQUJMRV9TRVJWRVJfVFlQRVMuaGFzKHRoaXMudHlwZSk7XG4gICAgfVxuICAgIGdldCBob3N0KCkge1xuICAgICAgICBjb25zdCBjaG9wTGVuZ3RoID0gYDoke3RoaXMucG9ydH1gLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkcmVzcy5zbGljZSgwLCAtY2hvcExlbmd0aCk7XG4gICAgfVxuICAgIGdldCBwb3J0KCkge1xuICAgICAgICBjb25zdCBwb3J0ID0gdGhpcy5hZGRyZXNzLnNwbGl0KCc6JykucG9wKCk7XG4gICAgICAgIHJldHVybiBwb3J0ID8gTnVtYmVyLnBhcnNlSW50KHBvcnQsIDEwKSA6IDI3MDE3O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIGFub3RoZXIgYFNlcnZlckRlc2NyaXB0aW9uYCBpcyBlcXVhbCB0byB0aGlzIG9uZSBwZXIgdGhlIHJ1bGVzIGRlZmluZWQgaW4gdGhlIFNEQU0gc3BlY2lmaWNhdGlvbi5cbiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9zZXJ2ZXItZGlzY292ZXJ5LWFuZC1tb25pdG9yaW5nL3NlcnZlci1kaXNjb3ZlcnktYW5kLW1vbml0b3JpbmcubWRcbiAgICAgKi9cbiAgICBlcXVhbHMob3RoZXIpIHtcbiAgICAgICAgLy8gRGVzcGl0ZSB1c2luZyB0aGUgY29tcGFyYXRvciB0aGF0IHdvdWxkIGRldGVybWluZSBhIG51bGxpc2ggdG9wb2xvZ3lWZXJzaW9uIGFzIGdyZWF0ZXIgdGhhblxuICAgICAgICAvLyBmb3IgZXF1YWxpdHkgd2Ugc2hvdWxkIG9ubHkgYWx3YXlzIHBlcmZvcm0gZGlyZWN0IGVxdWFsaXR5IGNvbXBhcmlzb25cbiAgICAgICAgY29uc3QgdG9wb2xvZ3lWZXJzaW9uc0VxdWFsID0gdGhpcy50b3BvbG9neVZlcnNpb24gPT09IG90aGVyPy50b3BvbG9neVZlcnNpb24gfHxcbiAgICAgICAgICAgIGNvbXBhcmVUb3BvbG9neVZlcnNpb24odGhpcy50b3BvbG9neVZlcnNpb24sIG90aGVyPy50b3BvbG9neVZlcnNpb24pID09PSAwO1xuICAgICAgICBjb25zdCBlbGVjdGlvbklkc0VxdWFsID0gdGhpcy5lbGVjdGlvbklkICE9IG51bGwgJiYgb3RoZXI/LmVsZWN0aW9uSWQgIT0gbnVsbFxuICAgICAgICAgICAgPyAoMCwgdXRpbHNfMS5jb21wYXJlT2JqZWN0SWQpKHRoaXMuZWxlY3Rpb25JZCwgb3RoZXIuZWxlY3Rpb25JZCkgPT09IDBcbiAgICAgICAgICAgIDogdGhpcy5lbGVjdGlvbklkID09PSBvdGhlcj8uZWxlY3Rpb25JZDtcbiAgICAgICAgcmV0dXJuIChvdGhlciAhPSBudWxsICYmXG4gICAgICAgICAgICBvdGhlci5pc2NyeXB0ZCA9PT0gdGhpcy5pc2NyeXB0ZCAmJlxuICAgICAgICAgICAgKDAsIHV0aWxzXzEuZXJyb3JTdHJpY3RFcXVhbCkodGhpcy5lcnJvciwgb3RoZXIuZXJyb3IpICYmXG4gICAgICAgICAgICB0aGlzLnR5cGUgPT09IG90aGVyLnR5cGUgJiZcbiAgICAgICAgICAgIHRoaXMubWluV2lyZVZlcnNpb24gPT09IG90aGVyLm1pbldpcmVWZXJzaW9uICYmXG4gICAgICAgICAgICAoMCwgdXRpbHNfMS5hcnJheVN0cmljdEVxdWFsKSh0aGlzLmhvc3RzLCBvdGhlci5ob3N0cykgJiZcbiAgICAgICAgICAgIHRhZ3NTdHJpY3RFcXVhbCh0aGlzLnRhZ3MsIG90aGVyLnRhZ3MpICYmXG4gICAgICAgICAgICB0aGlzLnNldE5hbWUgPT09IG90aGVyLnNldE5hbWUgJiZcbiAgICAgICAgICAgIHRoaXMuc2V0VmVyc2lvbiA9PT0gb3RoZXIuc2V0VmVyc2lvbiAmJlxuICAgICAgICAgICAgZWxlY3Rpb25JZHNFcXVhbCAmJlxuICAgICAgICAgICAgdGhpcy5wcmltYXJ5ID09PSBvdGhlci5wcmltYXJ5ICYmXG4gICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPT09IG90aGVyLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgJiZcbiAgICAgICAgICAgIHRvcG9sb2d5VmVyc2lvbnNFcXVhbCk7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJEZXNjcmlwdGlvbiA9IFNlcnZlckRlc2NyaXB0aW9uO1xuLy8gUGFyc2VzIGEgYGhlbGxvYCBtZXNzYWdlIGFuZCBkZXRlcm1pbmVzIHRoZSBzZXJ2ZXIgdHlwZVxuZnVuY3Rpb24gcGFyc2VTZXJ2ZXJUeXBlKGhlbGxvLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnM/LmxvYWRCYWxhbmNlZCkge1xuICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5Mb2FkQmFsYW5jZXI7XG4gICAgfVxuICAgIGlmICghaGVsbG8gfHwgIWhlbGxvLm9rKSB7XG4gICAgICAgIHJldHVybiBjb21tb25fMS5TZXJ2ZXJUeXBlLlVua25vd247XG4gICAgfVxuICAgIGlmIChoZWxsby5pc3JlcGxpY2FzZXQpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNHaG9zdDtcbiAgICB9XG4gICAgaWYgKGhlbGxvLm1zZyAmJiBoZWxsby5tc2cgPT09ICdpc2RiZ3JpZCcpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zO1xuICAgIH1cbiAgICBpZiAoaGVsbG8uc2V0TmFtZSkge1xuICAgICAgICBpZiAoaGVsbG8uaGlkZGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5SU090aGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGhlbGxvLmlzV3JpdGFibGVQcmltYXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaGVsbG8uc2Vjb25kYXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5SU1NlY29uZGFyeTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoZWxsby5hcmJpdGVyT25seSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNBcmJpdGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNPdGhlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29tbW9uXzEuU2VydmVyVHlwZS5TdGFuZGFsb25lO1xufVxuZnVuY3Rpb24gdGFnc1N0cmljdEVxdWFsKHRhZ3MsIHRhZ3MyKSB7XG4gICAgY29uc3QgdGFnc0tleXMgPSBPYmplY3Qua2V5cyh0YWdzKTtcbiAgICBjb25zdCB0YWdzMktleXMgPSBPYmplY3Qua2V5cyh0YWdzMik7XG4gICAgcmV0dXJuICh0YWdzS2V5cy5sZW5ndGggPT09IHRhZ3MyS2V5cy5sZW5ndGggJiZcbiAgICAgICAgdGFnc0tleXMuZXZlcnkoKGtleSkgPT4gdGFnczJba2V5XSA9PT0gdGFnc1trZXldKSk7XG59XG4vKipcbiAqIENvbXBhcmVzIHR3byB0b3BvbG9neSB2ZXJzaW9ucy5cbiAqXG4gKiAxLiBJZiB0aGUgcmVzcG9uc2UgdG9wb2xvZ3lWZXJzaW9uIGlzIHVuc2V0IG9yIHRoZSBTZXJ2ZXJEZXNjcmlwdGlvbidzXG4gKiAgICB0b3BvbG9neVZlcnNpb24gaXMgbnVsbCwgdGhlIGNsaWVudCBNVVNUIGFzc3VtZSB0aGUgcmVzcG9uc2UgaXMgbW9yZSByZWNlbnQuXG4gKiAxLiBJZiB0aGUgcmVzcG9uc2UncyB0b3BvbG9neVZlcnNpb24ucHJvY2Vzc0lkIGlzIG5vdCBlcXVhbCB0byB0aGVcbiAqICAgIFNlcnZlckRlc2NyaXB0aW9uJ3MsIHRoZSBjbGllbnQgTVVTVCBhc3N1bWUgdGhlIHJlc3BvbnNlIGlzIG1vcmUgcmVjZW50LlxuICogMS4gSWYgdGhlIHJlc3BvbnNlJ3MgdG9wb2xvZ3lWZXJzaW9uLnByb2Nlc3NJZCBpcyBlcXVhbCB0byB0aGVcbiAqICAgIFNlcnZlckRlc2NyaXB0aW9uJ3MsIHRoZSBjbGllbnQgTVVTVCB1c2UgdGhlIGNvdW50ZXIgZmllbGQgdG8gZGV0ZXJtaW5lXG4gKiAgICB3aGljaCB0b3BvbG9neVZlcnNpb24gaXMgbW9yZSByZWNlbnQuXG4gKlxuICogYGBgdHNcbiAqIGN1cnJlbnRUdiA8ICAgbmV3VHYgPT09IC0xXG4gKiBjdXJyZW50VHYgPT09IG5ld1R2ID09PSAwXG4gKiBjdXJyZW50VHYgPiAgIG5ld1R2ID09PSAxXG4gKiBgYGBcbiAqL1xuZnVuY3Rpb24gY29tcGFyZVRvcG9sb2d5VmVyc2lvbihjdXJyZW50VHYsIG5ld1R2KSB7XG4gICAgaWYgKGN1cnJlbnRUdiA9PSBudWxsIHx8IG5ld1R2ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoIWN1cnJlbnRUdi5wcm9jZXNzSWQuZXF1YWxzKG5ld1R2LnByb2Nlc3NJZCkpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICAvLyBUT0RPKE5PREUtMjY3NCk6IFByZXNlcnZlIGludDY0IHNlbnQgZnJvbSBNb25nb0RCXG4gICAgY29uc3QgY3VycmVudENvdW50ZXIgPSB0eXBlb2YgY3VycmVudFR2LmNvdW50ZXIgPT09ICdiaWdpbnQnXG4gICAgICAgID8gYnNvbl8xLkxvbmcuZnJvbUJpZ0ludChjdXJyZW50VHYuY291bnRlcilcbiAgICAgICAgOiBic29uXzEuTG9uZy5pc0xvbmcoY3VycmVudFR2LmNvdW50ZXIpXG4gICAgICAgICAgICA/IGN1cnJlbnRUdi5jb3VudGVyXG4gICAgICAgICAgICA6IGJzb25fMS5Mb25nLmZyb21OdW1iZXIoY3VycmVudFR2LmNvdW50ZXIpO1xuICAgIGNvbnN0IG5ld0NvdW50ZXIgPSB0eXBlb2YgbmV3VHYuY291bnRlciA9PT0gJ2JpZ2ludCdcbiAgICAgICAgPyBic29uXzEuTG9uZy5mcm9tQmlnSW50KG5ld1R2LmNvdW50ZXIpXG4gICAgICAgIDogYnNvbl8xLkxvbmcuaXNMb25nKG5ld1R2LmNvdW50ZXIpXG4gICAgICAgICAgICA/IG5ld1R2LmNvdW50ZXJcbiAgICAgICAgICAgIDogYnNvbl8xLkxvbmcuZnJvbU51bWJlcihuZXdUdi5jb3VudGVyKTtcbiAgICByZXR1cm4gY3VycmVudENvdW50ZXIuY29tcGFyZShuZXdDb3VudGVyKTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlcnZlcl9kZXNjcmlwdGlvbi5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js ***!
  \*********************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.MIN_SECONDARY_WRITE_WIRE_VERSION = void 0;\nexports.writableServerSelector = writableServerSelector;\nexports.sameServerSelector = sameServerSelector;\nexports.secondaryWritableServerSelector = secondaryWritableServerSelector;\nexports.readPreferenceServerSelector = readPreferenceServerSelector;\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\n// max staleness constants\nconst IDLE_WRITE_PERIOD = 10000;\nconst SMALLEST_MAX_STALENESS_SECONDS = 90;\n//  Minimum version to try writes on secondaries.\nexports.MIN_SECONDARY_WRITE_WIRE_VERSION = 13;\n/**\n * Returns a server selector that selects for writable servers\n */\nfunction writableServerSelector() {\n    return function writableServer(topologyDescription, servers) {\n        return latencyWindowReducer(topologyDescription, servers.filter((s) => s.isWritable));\n    };\n}\n/**\n * The purpose of this selector is to select the same server, only\n * if it is in a state that it can have commands sent to it.\n */\nfunction sameServerSelector(description) {\n    return function sameServerSelector(topologyDescription, servers) {\n        if (!description)\n            return [];\n        // Filter the servers to match the provided description only if\n        // the type is not unknown.\n        return servers.filter(sd => {\n            return sd.address === description.address && sd.type !== common_1.ServerType.Unknown;\n        });\n    };\n}\n/**\n * Returns a server selector that uses a read preference to select a\n * server potentially for a write on a secondary.\n */\nfunction secondaryWritableServerSelector(wireVersion, readPreference) {\n    // If server version < 5.0, read preference always primary.\n    // If server version >= 5.0...\n    // - If read preference is supplied, use that.\n    // - If no read preference is supplied, use primary.\n    if (!readPreference ||\n        !wireVersion ||\n        (wireVersion && wireVersion < exports.MIN_SECONDARY_WRITE_WIRE_VERSION)) {\n        return readPreferenceServerSelector(read_preference_1.ReadPreference.primary);\n    }\n    return readPreferenceServerSelector(readPreference);\n}\n/**\n * Reduces the passed in array of servers by the rules of the \"Max Staleness\" specification\n * found here:\n *\n * @see https://github.com/mongodb/specifications/blob/master/source/max-staleness/max-staleness.md\n *\n * @param readPreference - The read preference providing max staleness guidance\n * @param topologyDescription - The topology description\n * @param servers - The list of server descriptions to be reduced\n * @returns The list of servers that satisfy the requirements of max staleness\n */\nfunction maxStalenessReducer(readPreference, topologyDescription, servers) {\n    if (readPreference.maxStalenessSeconds == null || readPreference.maxStalenessSeconds < 0) {\n        return servers;\n    }\n    const maxStaleness = readPreference.maxStalenessSeconds;\n    const maxStalenessVariance = (topologyDescription.heartbeatFrequencyMS + IDLE_WRITE_PERIOD) / 1000;\n    if (maxStaleness < maxStalenessVariance) {\n        throw new error_1.MongoInvalidArgumentError(`Option \"maxStalenessSeconds\" must be at least ${maxStalenessVariance} seconds`);\n    }\n    if (maxStaleness < SMALLEST_MAX_STALENESS_SECONDS) {\n        throw new error_1.MongoInvalidArgumentError(`Option \"maxStalenessSeconds\" must be at least ${SMALLEST_MAX_STALENESS_SECONDS} seconds`);\n    }\n    if (topologyDescription.type === common_1.TopologyType.ReplicaSetWithPrimary) {\n        const primary = Array.from(topologyDescription.servers.values()).filter(primaryFilter)[0];\n        return servers.reduce((result, server) => {\n            const stalenessMS = server.lastUpdateTime -\n                server.lastWriteDate -\n                (primary.lastUpdateTime - primary.lastWriteDate) +\n                topologyDescription.heartbeatFrequencyMS;\n            const staleness = stalenessMS / 1000;\n            const maxStalenessSeconds = readPreference.maxStalenessSeconds ?? 0;\n            if (staleness <= maxStalenessSeconds) {\n                result.push(server);\n            }\n            return result;\n        }, []);\n    }\n    if (topologyDescription.type === common_1.TopologyType.ReplicaSetNoPrimary) {\n        if (servers.length === 0) {\n            return servers;\n        }\n        const sMax = servers.reduce((max, s) => s.lastWriteDate > max.lastWriteDate ? s : max);\n        return servers.reduce((result, server) => {\n            const stalenessMS = sMax.lastWriteDate - server.lastWriteDate + topologyDescription.heartbeatFrequencyMS;\n            const staleness = stalenessMS / 1000;\n            const maxStalenessSeconds = readPreference.maxStalenessSeconds ?? 0;\n            if (staleness <= maxStalenessSeconds) {\n                result.push(server);\n            }\n            return result;\n        }, []);\n    }\n    return servers;\n}\n/**\n * Determines whether a server's tags match a given set of tags\n *\n * @param tagSet - The requested tag set to match\n * @param serverTags - The server's tags\n */\nfunction tagSetMatch(tagSet, serverTags) {\n    const keys = Object.keys(tagSet);\n    const serverTagKeys = Object.keys(serverTags);\n    for (let i = 0; i < keys.length; ++i) {\n        const key = keys[i];\n        if (serverTagKeys.indexOf(key) === -1 || serverTags[key] !== tagSet[key]) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Reduces a set of server descriptions based on tags requested by the read preference\n *\n * @param readPreference - The read preference providing the requested tags\n * @param servers - The list of server descriptions to reduce\n * @returns The list of servers matching the requested tags\n */\nfunction tagSetReducer(readPreference, servers) {\n    if (readPreference.tags == null ||\n        (Array.isArray(readPreference.tags) && readPreference.tags.length === 0)) {\n        return servers;\n    }\n    for (let i = 0; i < readPreference.tags.length; ++i) {\n        const tagSet = readPreference.tags[i];\n        const serversMatchingTagset = servers.reduce((matched, server) => {\n            if (tagSetMatch(tagSet, server.tags))\n                matched.push(server);\n            return matched;\n        }, []);\n        if (serversMatchingTagset.length) {\n            return serversMatchingTagset;\n        }\n    }\n    return [];\n}\n/**\n * Reduces a list of servers to ensure they fall within an acceptable latency window. This is\n * further specified in the \"Server Selection\" specification, found here:\n *\n * @see https://github.com/mongodb/specifications/blob/master/source/server-selection/server-selection.md\n *\n * @param topologyDescription - The topology description\n * @param servers - The list of servers to reduce\n * @returns The servers which fall within an acceptable latency window\n */\nfunction latencyWindowReducer(topologyDescription, servers) {\n    const low = servers.reduce((min, server) => Math.min(server.roundTripTime, min), Infinity);\n    const high = low + topologyDescription.localThresholdMS;\n    return servers.reduce((result, server) => {\n        if (server.roundTripTime <= high && server.roundTripTime >= low)\n            result.push(server);\n        return result;\n    }, []);\n}\n// filters\nfunction primaryFilter(server) {\n    return server.type === common_1.ServerType.RSPrimary;\n}\nfunction secondaryFilter(server) {\n    return server.type === common_1.ServerType.RSSecondary;\n}\nfunction nearestFilter(server) {\n    return server.type === common_1.ServerType.RSSecondary || server.type === common_1.ServerType.RSPrimary;\n}\nfunction knownFilter(server) {\n    return server.type !== common_1.ServerType.Unknown;\n}\nfunction loadBalancerFilter(server) {\n    return server.type === common_1.ServerType.LoadBalancer;\n}\n/**\n * Returns a function which selects servers based on a provided read preference\n *\n * @param readPreference - The read preference to select with\n */\nfunction readPreferenceServerSelector(readPreference) {\n    if (!readPreference.isValid()) {\n        throw new error_1.MongoInvalidArgumentError('Invalid read preference specified');\n    }\n    return function readPreferenceServers(topologyDescription, servers, deprioritized = []) {\n        const commonWireVersion = topologyDescription.commonWireVersion;\n        if (commonWireVersion &&\n            readPreference.minWireVersion &&\n            readPreference.minWireVersion > commonWireVersion) {\n            throw new error_1.MongoCompatibilityError(`Minimum wire version '${readPreference.minWireVersion}' required, but found '${commonWireVersion}'`);\n        }\n        if (topologyDescription.type === common_1.TopologyType.LoadBalanced) {\n            return servers.filter(loadBalancerFilter);\n        }\n        if (topologyDescription.type === common_1.TopologyType.Unknown) {\n            return [];\n        }\n        if (topologyDescription.type === common_1.TopologyType.Single) {\n            return latencyWindowReducer(topologyDescription, servers.filter(knownFilter));\n        }\n        if (topologyDescription.type === common_1.TopologyType.Sharded) {\n            const filtered = servers.filter(server => {\n                return !deprioritized.includes(server);\n            });\n            const selectable = filtered.length > 0 ? filtered : deprioritized;\n            return latencyWindowReducer(topologyDescription, selectable.filter(knownFilter));\n        }\n        const mode = readPreference.mode;\n        if (mode === read_preference_1.ReadPreference.PRIMARY) {\n            return servers.filter(primaryFilter);\n        }\n        if (mode === read_preference_1.ReadPreference.PRIMARY_PREFERRED) {\n            const result = servers.filter(primaryFilter);\n            if (result.length) {\n                return result;\n            }\n        }\n        const filter = mode === read_preference_1.ReadPreference.NEAREST ? nearestFilter : secondaryFilter;\n        const selectedServers = latencyWindowReducer(topologyDescription, tagSetReducer(readPreference, maxStalenessReducer(readPreference, topologyDescription, servers.filter(filter))));\n        if (mode === read_preference_1.ReadPreference.SECONDARY_PREFERRED && selectedServers.length === 0) {\n            return servers.filter(primaryFilter);\n        }\n        return selectedServers;\n    };\n}\n//# sourceMappingURL=server_selection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyX3NlbGVjdGlvbi5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx3Q0FBd0M7QUFDeEMsOEJBQThCO0FBQzlCLDBCQUEwQjtBQUMxQix1Q0FBdUM7QUFDdkMsb0NBQW9DO0FBQ3BDLGdCQUFnQixtQkFBTyxDQUFDLDZGQUFVO0FBQ2xDLDBCQUEwQixtQkFBTyxDQUFDLGlIQUFvQjtBQUN0RCxpQkFBaUIsbUJBQU8sQ0FBQyxtR0FBVTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFHQUFxRyxzQkFBc0I7QUFDM0g7QUFDQTtBQUNBLHFHQUFxRyxnQ0FBZ0M7QUFDckk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0NBQWdDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSw4QkFBOEIseUJBQXlCLGtCQUFrQjtBQUN4SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyX3NlbGVjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTUlOX1NFQ09OREFSWV9XUklURV9XSVJFX1ZFUlNJT04gPSB2b2lkIDA7XG5leHBvcnRzLndyaXRhYmxlU2VydmVyU2VsZWN0b3IgPSB3cml0YWJsZVNlcnZlclNlbGVjdG9yO1xuZXhwb3J0cy5zYW1lU2VydmVyU2VsZWN0b3IgPSBzYW1lU2VydmVyU2VsZWN0b3I7XG5leHBvcnRzLnNlY29uZGFyeVdyaXRhYmxlU2VydmVyU2VsZWN0b3IgPSBzZWNvbmRhcnlXcml0YWJsZVNlcnZlclNlbGVjdG9yO1xuZXhwb3J0cy5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yID0gcmVhZFByZWZlcmVuY2VTZXJ2ZXJTZWxlY3RvcjtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2NvbW1vblwiKTtcbi8vIG1heCBzdGFsZW5lc3MgY29uc3RhbnRzXG5jb25zdCBJRExFX1dSSVRFX1BFUklPRCA9IDEwMDAwO1xuY29uc3QgU01BTExFU1RfTUFYX1NUQUxFTkVTU19TRUNPTkRTID0gOTA7XG4vLyAgTWluaW11bSB2ZXJzaW9uIHRvIHRyeSB3cml0ZXMgb24gc2Vjb25kYXJpZXMuXG5leHBvcnRzLk1JTl9TRUNPTkRBUllfV1JJVEVfV0lSRV9WRVJTSU9OID0gMTM7XG4vKipcbiAqIFJldHVybnMgYSBzZXJ2ZXIgc2VsZWN0b3IgdGhhdCBzZWxlY3RzIGZvciB3cml0YWJsZSBzZXJ2ZXJzXG4gKi9cbmZ1bmN0aW9uIHdyaXRhYmxlU2VydmVyU2VsZWN0b3IoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHdyaXRhYmxlU2VydmVyKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMpIHtcbiAgICAgICAgcmV0dXJuIGxhdGVuY3lXaW5kb3dSZWR1Y2VyKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMuZmlsdGVyKChzKSA9PiBzLmlzV3JpdGFibGUpKTtcbiAgICB9O1xufVxuLyoqXG4gKiBUaGUgcHVycG9zZSBvZiB0aGlzIHNlbGVjdG9yIGlzIHRvIHNlbGVjdCB0aGUgc2FtZSBzZXJ2ZXIsIG9ubHlcbiAqIGlmIGl0IGlzIGluIGEgc3RhdGUgdGhhdCBpdCBjYW4gaGF2ZSBjb21tYW5kcyBzZW50IHRvIGl0LlxuICovXG5mdW5jdGlvbiBzYW1lU2VydmVyU2VsZWN0b3IoZGVzY3JpcHRpb24pIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gc2FtZVNlcnZlclNlbGVjdG9yKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMpIHtcbiAgICAgICAgaWYgKCFkZXNjcmlwdGlvbilcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgLy8gRmlsdGVyIHRoZSBzZXJ2ZXJzIHRvIG1hdGNoIHRoZSBwcm92aWRlZCBkZXNjcmlwdGlvbiBvbmx5IGlmXG4gICAgICAgIC8vIHRoZSB0eXBlIGlzIG5vdCB1bmtub3duLlxuICAgICAgICByZXR1cm4gc2VydmVycy5maWx0ZXIoc2QgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHNkLmFkZHJlc3MgPT09IGRlc2NyaXB0aW9uLmFkZHJlc3MgJiYgc2QudHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duO1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgc2VydmVyIHNlbGVjdG9yIHRoYXQgdXNlcyBhIHJlYWQgcHJlZmVyZW5jZSB0byBzZWxlY3QgYVxuICogc2VydmVyIHBvdGVudGlhbGx5IGZvciBhIHdyaXRlIG9uIGEgc2Vjb25kYXJ5LlxuICovXG5mdW5jdGlvbiBzZWNvbmRhcnlXcml0YWJsZVNlcnZlclNlbGVjdG9yKHdpcmVWZXJzaW9uLCByZWFkUHJlZmVyZW5jZSkge1xuICAgIC8vIElmIHNlcnZlciB2ZXJzaW9uIDwgNS4wLCByZWFkIHByZWZlcmVuY2UgYWx3YXlzIHByaW1hcnkuXG4gICAgLy8gSWYgc2VydmVyIHZlcnNpb24gPj0gNS4wLi4uXG4gICAgLy8gLSBJZiByZWFkIHByZWZlcmVuY2UgaXMgc3VwcGxpZWQsIHVzZSB0aGF0LlxuICAgIC8vIC0gSWYgbm8gcmVhZCBwcmVmZXJlbmNlIGlzIHN1cHBsaWVkLCB1c2UgcHJpbWFyeS5cbiAgICBpZiAoIXJlYWRQcmVmZXJlbmNlIHx8XG4gICAgICAgICF3aXJlVmVyc2lvbiB8fFxuICAgICAgICAod2lyZVZlcnNpb24gJiYgd2lyZVZlcnNpb24gPCBleHBvcnRzLk1JTl9TRUNPTkRBUllfV1JJVEVfV0lSRV9WRVJTSU9OKSkge1xuICAgICAgICByZXR1cm4gcmVhZFByZWZlcmVuY2VTZXJ2ZXJTZWxlY3RvcihyZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5wcmltYXJ5KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlYWRQcmVmZXJlbmNlU2VydmVyU2VsZWN0b3IocmVhZFByZWZlcmVuY2UpO1xufVxuLyoqXG4gKiBSZWR1Y2VzIHRoZSBwYXNzZWQgaW4gYXJyYXkgb2Ygc2VydmVycyBieSB0aGUgcnVsZXMgb2YgdGhlIFwiTWF4IFN0YWxlbmVzc1wiIHNwZWNpZmljYXRpb25cbiAqIGZvdW5kIGhlcmU6XG4gKlxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vbW9uZ29kYi9zcGVjaWZpY2F0aW9ucy9ibG9iL21hc3Rlci9zb3VyY2UvbWF4LXN0YWxlbmVzcy9tYXgtc3RhbGVuZXNzLm1kXG4gKlxuICogQHBhcmFtIHJlYWRQcmVmZXJlbmNlIC0gVGhlIHJlYWQgcHJlZmVyZW5jZSBwcm92aWRpbmcgbWF4IHN0YWxlbmVzcyBndWlkYW5jZVxuICogQHBhcmFtIHRvcG9sb2d5RGVzY3JpcHRpb24gLSBUaGUgdG9wb2xvZ3kgZGVzY3JpcHRpb25cbiAqIEBwYXJhbSBzZXJ2ZXJzIC0gVGhlIGxpc3Qgb2Ygc2VydmVyIGRlc2NyaXB0aW9ucyB0byBiZSByZWR1Y2VkXG4gKiBAcmV0dXJucyBUaGUgbGlzdCBvZiBzZXJ2ZXJzIHRoYXQgc2F0aXNmeSB0aGUgcmVxdWlyZW1lbnRzIG9mIG1heCBzdGFsZW5lc3NcbiAqL1xuZnVuY3Rpb24gbWF4U3RhbGVuZXNzUmVkdWNlcihyZWFkUHJlZmVyZW5jZSwgdG9wb2xvZ3lEZXNjcmlwdGlvbiwgc2VydmVycykge1xuICAgIGlmIChyZWFkUHJlZmVyZW5jZS5tYXhTdGFsZW5lc3NTZWNvbmRzID09IG51bGwgfHwgcmVhZFByZWZlcmVuY2UubWF4U3RhbGVuZXNzU2Vjb25kcyA8IDApIHtcbiAgICAgICAgcmV0dXJuIHNlcnZlcnM7XG4gICAgfVxuICAgIGNvbnN0IG1heFN0YWxlbmVzcyA9IHJlYWRQcmVmZXJlbmNlLm1heFN0YWxlbmVzc1NlY29uZHM7XG4gICAgY29uc3QgbWF4U3RhbGVuZXNzVmFyaWFuY2UgPSAodG9wb2xvZ3lEZXNjcmlwdGlvbi5oZWFydGJlYXRGcmVxdWVuY3lNUyArIElETEVfV1JJVEVfUEVSSU9EKSAvIDEwMDA7XG4gICAgaWYgKG1heFN0YWxlbmVzcyA8IG1heFN0YWxlbmVzc1ZhcmlhbmNlKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYE9wdGlvbiBcIm1heFN0YWxlbmVzc1NlY29uZHNcIiBtdXN0IGJlIGF0IGxlYXN0ICR7bWF4U3RhbGVuZXNzVmFyaWFuY2V9IHNlY29uZHNgKTtcbiAgICB9XG4gICAgaWYgKG1heFN0YWxlbmVzcyA8IFNNQUxMRVNUX01BWF9TVEFMRU5FU1NfU0VDT05EUykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBPcHRpb24gXCJtYXhTdGFsZW5lc3NTZWNvbmRzXCIgbXVzdCBiZSBhdCBsZWFzdCAke1NNQUxMRVNUX01BWF9TVEFMRU5FU1NfU0VDT05EU30gc2Vjb25kc2ApO1xuICAgIH1cbiAgICBpZiAodG9wb2xvZ3lEZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldFdpdGhQcmltYXJ5KSB7XG4gICAgICAgIGNvbnN0IHByaW1hcnkgPSBBcnJheS5mcm9tKHRvcG9sb2d5RGVzY3JpcHRpb24uc2VydmVycy52YWx1ZXMoKSkuZmlsdGVyKHByaW1hcnlGaWx0ZXIpWzBdO1xuICAgICAgICByZXR1cm4gc2VydmVycy5yZWR1Y2UoKHJlc3VsdCwgc2VydmVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGFsZW5lc3NNUyA9IHNlcnZlci5sYXN0VXBkYXRlVGltZSAtXG4gICAgICAgICAgICAgICAgc2VydmVyLmxhc3RXcml0ZURhdGUgLVxuICAgICAgICAgICAgICAgIChwcmltYXJ5Lmxhc3RVcGRhdGVUaW1lIC0gcHJpbWFyeS5sYXN0V3JpdGVEYXRlKSArXG4gICAgICAgICAgICAgICAgdG9wb2xvZ3lEZXNjcmlwdGlvbi5oZWFydGJlYXRGcmVxdWVuY3lNUztcbiAgICAgICAgICAgIGNvbnN0IHN0YWxlbmVzcyA9IHN0YWxlbmVzc01TIC8gMTAwMDtcbiAgICAgICAgICAgIGNvbnN0IG1heFN0YWxlbmVzc1NlY29uZHMgPSByZWFkUHJlZmVyZW5jZS5tYXhTdGFsZW5lc3NTZWNvbmRzID8/IDA7XG4gICAgICAgICAgICBpZiAoc3RhbGVuZXNzIDw9IG1heFN0YWxlbmVzc1NlY29uZHMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzZXJ2ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSwgW10pO1xuICAgIH1cbiAgICBpZiAodG9wb2xvZ3lEZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldE5vUHJpbWFyeSkge1xuICAgICAgICBpZiAoc2VydmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJzO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNNYXggPSBzZXJ2ZXJzLnJlZHVjZSgobWF4LCBzKSA9PiBzLmxhc3RXcml0ZURhdGUgPiBtYXgubGFzdFdyaXRlRGF0ZSA/IHMgOiBtYXgpO1xuICAgICAgICByZXR1cm4gc2VydmVycy5yZWR1Y2UoKHJlc3VsdCwgc2VydmVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGFsZW5lc3NNUyA9IHNNYXgubGFzdFdyaXRlRGF0ZSAtIHNlcnZlci5sYXN0V3JpdGVEYXRlICsgdG9wb2xvZ3lEZXNjcmlwdGlvbi5oZWFydGJlYXRGcmVxdWVuY3lNUztcbiAgICAgICAgICAgIGNvbnN0IHN0YWxlbmVzcyA9IHN0YWxlbmVzc01TIC8gMTAwMDtcbiAgICAgICAgICAgIGNvbnN0IG1heFN0YWxlbmVzc1NlY29uZHMgPSByZWFkUHJlZmVyZW5jZS5tYXhTdGFsZW5lc3NTZWNvbmRzID8/IDA7XG4gICAgICAgICAgICBpZiAoc3RhbGVuZXNzIDw9IG1heFN0YWxlbmVzc1NlY29uZHMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzZXJ2ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSwgW10pO1xuICAgIH1cbiAgICByZXR1cm4gc2VydmVycztcbn1cbi8qKlxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIGEgc2VydmVyJ3MgdGFncyBtYXRjaCBhIGdpdmVuIHNldCBvZiB0YWdzXG4gKlxuICogQHBhcmFtIHRhZ1NldCAtIFRoZSByZXF1ZXN0ZWQgdGFnIHNldCB0byBtYXRjaFxuICogQHBhcmFtIHNlcnZlclRhZ3MgLSBUaGUgc2VydmVyJ3MgdGFnc1xuICovXG5mdW5jdGlvbiB0YWdTZXRNYXRjaCh0YWdTZXQsIHNlcnZlclRhZ3MpIHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGFnU2V0KTtcbiAgICBjb25zdCBzZXJ2ZXJUYWdLZXlzID0gT2JqZWN0LmtleXMoc2VydmVyVGFncyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICAgIGlmIChzZXJ2ZXJUYWdLZXlzLmluZGV4T2Yoa2V5KSA9PT0gLTEgfHwgc2VydmVyVGFnc1trZXldICE9PSB0YWdTZXRba2V5XSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBSZWR1Y2VzIGEgc2V0IG9mIHNlcnZlciBkZXNjcmlwdGlvbnMgYmFzZWQgb24gdGFncyByZXF1ZXN0ZWQgYnkgdGhlIHJlYWQgcHJlZmVyZW5jZVxuICpcbiAqIEBwYXJhbSByZWFkUHJlZmVyZW5jZSAtIFRoZSByZWFkIHByZWZlcmVuY2UgcHJvdmlkaW5nIHRoZSByZXF1ZXN0ZWQgdGFnc1xuICogQHBhcmFtIHNlcnZlcnMgLSBUaGUgbGlzdCBvZiBzZXJ2ZXIgZGVzY3JpcHRpb25zIHRvIHJlZHVjZVxuICogQHJldHVybnMgVGhlIGxpc3Qgb2Ygc2VydmVycyBtYXRjaGluZyB0aGUgcmVxdWVzdGVkIHRhZ3NcbiAqL1xuZnVuY3Rpb24gdGFnU2V0UmVkdWNlcihyZWFkUHJlZmVyZW5jZSwgc2VydmVycykge1xuICAgIGlmIChyZWFkUHJlZmVyZW5jZS50YWdzID09IG51bGwgfHxcbiAgICAgICAgKEFycmF5LmlzQXJyYXkocmVhZFByZWZlcmVuY2UudGFncykgJiYgcmVhZFByZWZlcmVuY2UudGFncy5sZW5ndGggPT09IDApKSB7XG4gICAgICAgIHJldHVybiBzZXJ2ZXJzO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlYWRQcmVmZXJlbmNlLnRhZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgY29uc3QgdGFnU2V0ID0gcmVhZFByZWZlcmVuY2UudGFnc1tpXTtcbiAgICAgICAgY29uc3Qgc2VydmVyc01hdGNoaW5nVGFnc2V0ID0gc2VydmVycy5yZWR1Y2UoKG1hdGNoZWQsIHNlcnZlcikgPT4ge1xuICAgICAgICAgICAgaWYgKHRhZ1NldE1hdGNoKHRhZ1NldCwgc2VydmVyLnRhZ3MpKVxuICAgICAgICAgICAgICAgIG1hdGNoZWQucHVzaChzZXJ2ZXIpO1xuICAgICAgICAgICAgcmV0dXJuIG1hdGNoZWQ7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgaWYgKHNlcnZlcnNNYXRjaGluZ1RhZ3NldC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJzTWF0Y2hpbmdUYWdzZXQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtdO1xufVxuLyoqXG4gKiBSZWR1Y2VzIGEgbGlzdCBvZiBzZXJ2ZXJzIHRvIGVuc3VyZSB0aGV5IGZhbGwgd2l0aGluIGFuIGFjY2VwdGFibGUgbGF0ZW5jeSB3aW5kb3cuIFRoaXMgaXNcbiAqIGZ1cnRoZXIgc3BlY2lmaWVkIGluIHRoZSBcIlNlcnZlciBTZWxlY3Rpb25cIiBzcGVjaWZpY2F0aW9uLCBmb3VuZCBoZXJlOlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21vbmdvZGIvc3BlY2lmaWNhdGlvbnMvYmxvYi9tYXN0ZXIvc291cmNlL3NlcnZlci1zZWxlY3Rpb24vc2VydmVyLXNlbGVjdGlvbi5tZFxuICpcbiAqIEBwYXJhbSB0b3BvbG9neURlc2NyaXB0aW9uIC0gVGhlIHRvcG9sb2d5IGRlc2NyaXB0aW9uXG4gKiBAcGFyYW0gc2VydmVycyAtIFRoZSBsaXN0IG9mIHNlcnZlcnMgdG8gcmVkdWNlXG4gKiBAcmV0dXJucyBUaGUgc2VydmVycyB3aGljaCBmYWxsIHdpdGhpbiBhbiBhY2NlcHRhYmxlIGxhdGVuY3kgd2luZG93XG4gKi9cbmZ1bmN0aW9uIGxhdGVuY3lXaW5kb3dSZWR1Y2VyKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlcnZlcnMpIHtcbiAgICBjb25zdCBsb3cgPSBzZXJ2ZXJzLnJlZHVjZSgobWluLCBzZXJ2ZXIpID0+IE1hdGgubWluKHNlcnZlci5yb3VuZFRyaXBUaW1lLCBtaW4pLCBJbmZpbml0eSk7XG4gICAgY29uc3QgaGlnaCA9IGxvdyArIHRvcG9sb2d5RGVzY3JpcHRpb24ubG9jYWxUaHJlc2hvbGRNUztcbiAgICByZXR1cm4gc2VydmVycy5yZWR1Y2UoKHJlc3VsdCwgc2VydmVyKSA9PiB7XG4gICAgICAgIGlmIChzZXJ2ZXIucm91bmRUcmlwVGltZSA8PSBoaWdoICYmIHNlcnZlci5yb3VuZFRyaXBUaW1lID49IGxvdylcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNlcnZlcik7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSwgW10pO1xufVxuLy8gZmlsdGVyc1xuZnVuY3Rpb24gcHJpbWFyeUZpbHRlcihzZXJ2ZXIpIHtcbiAgICByZXR1cm4gc2VydmVyLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5O1xufVxuZnVuY3Rpb24gc2Vjb25kYXJ5RmlsdGVyKHNlcnZlcikge1xuICAgIHJldHVybiBzZXJ2ZXIudHlwZSA9PT0gY29tbW9uXzEuU2VydmVyVHlwZS5SU1NlY29uZGFyeTtcbn1cbmZ1bmN0aW9uIG5lYXJlc3RGaWx0ZXIoc2VydmVyKSB7XG4gICAgcmV0dXJuIHNlcnZlci50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTU2Vjb25kYXJ5IHx8IHNlcnZlci50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTUHJpbWFyeTtcbn1cbmZ1bmN0aW9uIGtub3duRmlsdGVyKHNlcnZlcikge1xuICAgIHJldHVybiBzZXJ2ZXIudHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duO1xufVxuZnVuY3Rpb24gbG9hZEJhbGFuY2VyRmlsdGVyKHNlcnZlcikge1xuICAgIHJldHVybiBzZXJ2ZXIudHlwZSA9PT0gY29tbW9uXzEuU2VydmVyVHlwZS5Mb2FkQmFsYW5jZXI7XG59XG4vKipcbiAqIFJldHVybnMgYSBmdW5jdGlvbiB3aGljaCBzZWxlY3RzIHNlcnZlcnMgYmFzZWQgb24gYSBwcm92aWRlZCByZWFkIHByZWZlcmVuY2VcbiAqXG4gKiBAcGFyYW0gcmVhZFByZWZlcmVuY2UgLSBUaGUgcmVhZCBwcmVmZXJlbmNlIHRvIHNlbGVjdCB3aXRoXG4gKi9cbmZ1bmN0aW9uIHJlYWRQcmVmZXJlbmNlU2VydmVyU2VsZWN0b3IocmVhZFByZWZlcmVuY2UpIHtcbiAgICBpZiAoIXJlYWRQcmVmZXJlbmNlLmlzVmFsaWQoKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdJbnZhbGlkIHJlYWQgcHJlZmVyZW5jZSBzcGVjaWZpZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHJlYWRQcmVmZXJlbmNlU2VydmVycyh0b3BvbG9neURlc2NyaXB0aW9uLCBzZXJ2ZXJzLCBkZXByaW9yaXRpemVkID0gW10pIHtcbiAgICAgICAgY29uc3QgY29tbW9uV2lyZVZlcnNpb24gPSB0b3BvbG9neURlc2NyaXB0aW9uLmNvbW1vbldpcmVWZXJzaW9uO1xuICAgICAgICBpZiAoY29tbW9uV2lyZVZlcnNpb24gJiZcbiAgICAgICAgICAgIHJlYWRQcmVmZXJlbmNlLm1pbldpcmVWZXJzaW9uICYmXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZS5taW5XaXJlVmVyc2lvbiA+IGNvbW1vbldpcmVWZXJzaW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgTWluaW11bSB3aXJlIHZlcnNpb24gJyR7cmVhZFByZWZlcmVuY2UubWluV2lyZVZlcnNpb259JyByZXF1aXJlZCwgYnV0IGZvdW5kICcke2NvbW1vbldpcmVWZXJzaW9ufSdgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lEZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuTG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VydmVycy5maWx0ZXIobG9hZEJhbGFuY2VyRmlsdGVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lEZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0b3BvbG9neURlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGUpIHtcbiAgICAgICAgICAgIHJldHVybiBsYXRlbmN5V2luZG93UmVkdWNlcih0b3BvbG9neURlc2NyaXB0aW9uLCBzZXJ2ZXJzLmZpbHRlcihrbm93bkZpbHRlcikpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0b3BvbG9neURlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaGFyZGVkKSB7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZCA9IHNlcnZlcnMuZmlsdGVyKHNlcnZlciA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFkZXByaW9yaXRpemVkLmluY2x1ZGVzKHNlcnZlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGFibGUgPSBmaWx0ZXJlZC5sZW5ndGggPiAwID8gZmlsdGVyZWQgOiBkZXByaW9yaXRpemVkO1xuICAgICAgICAgICAgcmV0dXJuIGxhdGVuY3lXaW5kb3dSZWR1Y2VyKHRvcG9sb2d5RGVzY3JpcHRpb24sIHNlbGVjdGFibGUuZmlsdGVyKGtub3duRmlsdGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZSA9IHJlYWRQcmVmZXJlbmNlLm1vZGU7XG4gICAgICAgIGlmIChtb2RlID09PSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5QUklNQVJZKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VydmVycy5maWx0ZXIocHJpbWFyeUZpbHRlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vZGUgPT09IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLlBSSU1BUllfUFJFRkVSUkVEKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBzZXJ2ZXJzLmZpbHRlcihwcmltYXJ5RmlsdGVyKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWx0ZXIgPSBtb2RlID09PSByZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5ORUFSRVNUID8gbmVhcmVzdEZpbHRlciA6IHNlY29uZGFyeUZpbHRlcjtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRTZXJ2ZXJzID0gbGF0ZW5jeVdpbmRvd1JlZHVjZXIodG9wb2xvZ3lEZXNjcmlwdGlvbiwgdGFnU2V0UmVkdWNlcihyZWFkUHJlZmVyZW5jZSwgbWF4U3RhbGVuZXNzUmVkdWNlcihyZWFkUHJlZmVyZW5jZSwgdG9wb2xvZ3lEZXNjcmlwdGlvbiwgc2VydmVycy5maWx0ZXIoZmlsdGVyKSkpKTtcbiAgICAgICAgaWYgKG1vZGUgPT09IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLlNFQ09OREFSWV9QUkVGRVJSRUQgJiYgc2VsZWN0ZWRTZXJ2ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlcnZlcnMuZmlsdGVyKHByaW1hcnlGaWx0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxlY3RlZFNlcnZlcnM7XG4gICAgfTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlcnZlcl9zZWxlY3Rpb24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection_events.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection_events.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.WaitingForSuitableServerEvent = exports.ServerSelectionSucceededEvent = exports.ServerSelectionFailedEvent = exports.ServerSelectionStartedEvent = exports.ServerSelectionEvent = void 0;\nconst utils_1 = __webpack_require__(/*! .././utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\n/**\n * The base export class for all logs published from server selection\n * @internal\n * @category Log Type\n */\nclass ServerSelectionEvent {\n    /** @internal */\n    constructor(selector, topologyDescription, operation) {\n        this.selector = selector;\n        this.operation = operation;\n        this.topologyDescription = topologyDescription;\n    }\n}\nexports.ServerSelectionEvent = ServerSelectionEvent;\n/**\n * An event published when server selection starts\n * @internal\n * @category Event\n */\nclass ServerSelectionStartedEvent extends ServerSelectionEvent {\n    /** @internal */\n    constructor(selector, topologyDescription, operation) {\n        super(selector, topologyDescription, operation);\n        /** @internal */\n        this.name = constants_1.SERVER_SELECTION_STARTED;\n        this.message = 'Server selection started';\n    }\n}\nexports.ServerSelectionStartedEvent = ServerSelectionStartedEvent;\n/**\n * An event published when a server selection fails\n * @internal\n * @category Event\n */\nclass ServerSelectionFailedEvent extends ServerSelectionEvent {\n    /** @internal */\n    constructor(selector, topologyDescription, error, operation) {\n        super(selector, topologyDescription, operation);\n        /** @internal */\n        this.name = constants_1.SERVER_SELECTION_FAILED;\n        this.message = 'Server selection failed';\n        this.failure = error;\n    }\n}\nexports.ServerSelectionFailedEvent = ServerSelectionFailedEvent;\n/**\n * An event published when server selection succeeds\n * @internal\n * @category Event\n */\nclass ServerSelectionSucceededEvent extends ServerSelectionEvent {\n    /** @internal */\n    constructor(selector, topologyDescription, address, operation) {\n        super(selector, topologyDescription, operation);\n        /** @internal */\n        this.name = constants_1.SERVER_SELECTION_SUCCEEDED;\n        this.message = 'Server selection succeeded';\n        const { host, port } = utils_1.HostAddress.fromString(address).toHostPort();\n        this.serverHost = host;\n        this.serverPort = port;\n    }\n}\nexports.ServerSelectionSucceededEvent = ServerSelectionSucceededEvent;\n/**\n * An event published when server selection is waiting for a suitable server to become available\n * @internal\n * @category Event\n */\nclass WaitingForSuitableServerEvent extends ServerSelectionEvent {\n    /** @internal */\n    constructor(selector, topologyDescription, remainingTimeMS, operation) {\n        super(selector, topologyDescription, operation);\n        /** @internal */\n        this.name = constants_1.WAITING_FOR_SUITABLE_SERVER;\n        this.message = 'Waiting for suitable server to become available';\n        this.remainingTimeMS = remainingTimeMS;\n    }\n}\nexports.WaitingForSuitableServerEvent = WaitingForSuitableServerEvent;\n//# sourceMappingURL=server_selection_events.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyX3NlbGVjdGlvbl9ldmVudHMuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QscUNBQXFDLEdBQUcscUNBQXFDLEdBQUcsa0NBQWtDLEdBQUcsbUNBQW1DLEdBQUcsNEJBQTRCO0FBQ3ZMLGdCQUFnQixtQkFBTyxDQUFDLCtGQUFZO0FBQ3BDLG9CQUFvQixtQkFBTyxDQUFDLHFHQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixhQUFhO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQyIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc2VydmVyX3NlbGVjdGlvbl9ldmVudHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldhaXRpbmdGb3JTdWl0YWJsZVNlcnZlckV2ZW50ID0gZXhwb3J0cy5TZXJ2ZXJTZWxlY3Rpb25TdWNjZWVkZWRFdmVudCA9IGV4cG9ydHMuU2VydmVyU2VsZWN0aW9uRmFpbGVkRXZlbnQgPSBleHBvcnRzLlNlcnZlclNlbGVjdGlvblN0YXJ0ZWRFdmVudCA9IGV4cG9ydHMuU2VydmVyU2VsZWN0aW9uRXZlbnQgPSB2b2lkIDA7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uLy4vdXRpbHNcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XG4vKipcbiAqIFRoZSBiYXNlIGV4cG9ydCBjbGFzcyBmb3IgYWxsIGxvZ3MgcHVibGlzaGVkIGZyb20gc2VydmVyIHNlbGVjdGlvblxuICogQGludGVybmFsXG4gKiBAY2F0ZWdvcnkgTG9nIFR5cGVcbiAqL1xuY2xhc3MgU2VydmVyU2VsZWN0aW9uRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihzZWxlY3RvciwgdG9wb2xvZ3lEZXNjcmlwdGlvbiwgb3BlcmF0aW9uKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICAgICAgdGhpcy5vcGVyYXRpb24gPSBvcGVyYXRpb247XG4gICAgICAgIHRoaXMudG9wb2xvZ3lEZXNjcmlwdGlvbiA9IHRvcG9sb2d5RGVzY3JpcHRpb247XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJTZWxlY3Rpb25FdmVudCA9IFNlcnZlclNlbGVjdGlvbkV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBzZXJ2ZXIgc2VsZWN0aW9uIHN0YXJ0c1xuICogQGludGVybmFsXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVyU2VsZWN0aW9uU3RhcnRlZEV2ZW50IGV4dGVuZHMgU2VydmVyU2VsZWN0aW9uRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihzZWxlY3RvciwgdG9wb2xvZ3lEZXNjcmlwdGlvbiwgb3BlcmF0aW9uKSB7XG4gICAgICAgIHN1cGVyKHNlbGVjdG9yLCB0b3BvbG9neURlc2NyaXB0aW9uLCBvcGVyYXRpb24pO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlNFUlZFUl9TRUxFQ1RJT05fU1RBUlRFRDtcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gJ1NlcnZlciBzZWxlY3Rpb24gc3RhcnRlZCc7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJTZWxlY3Rpb25TdGFydGVkRXZlbnQgPSBTZXJ2ZXJTZWxlY3Rpb25TdGFydGVkRXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IHB1Ymxpc2hlZCB3aGVuIGEgc2VydmVyIHNlbGVjdGlvbiBmYWlsc1xuICogQGludGVybmFsXG4gKiBAY2F0ZWdvcnkgRXZlbnRcbiAqL1xuY2xhc3MgU2VydmVyU2VsZWN0aW9uRmFpbGVkRXZlbnQgZXh0ZW5kcyBTZXJ2ZXJTZWxlY3Rpb25FdmVudCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHNlbGVjdG9yLCB0b3BvbG9neURlc2NyaXB0aW9uLCBlcnJvciwgb3BlcmF0aW9uKSB7XG4gICAgICAgIHN1cGVyKHNlbGVjdG9yLCB0b3BvbG9neURlc2NyaXB0aW9uLCBvcGVyYXRpb24pO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlNFUlZFUl9TRUxFQ1RJT05fRkFJTEVEO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSAnU2VydmVyIHNlbGVjdGlvbiBmYWlsZWQnO1xuICAgICAgICB0aGlzLmZhaWx1cmUgPSBlcnJvcjtcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlclNlbGVjdGlvbkZhaWxlZEV2ZW50ID0gU2VydmVyU2VsZWN0aW9uRmFpbGVkRXZlbnQ7XG4vKipcbiAqIEFuIGV2ZW50IHB1Ymxpc2hlZCB3aGVuIHNlcnZlciBzZWxlY3Rpb24gc3VjY2VlZHNcbiAqIEBpbnRlcm5hbFxuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFNlcnZlclNlbGVjdGlvblN1Y2NlZWRlZEV2ZW50IGV4dGVuZHMgU2VydmVyU2VsZWN0aW9uRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihzZWxlY3RvciwgdG9wb2xvZ3lEZXNjcmlwdGlvbiwgYWRkcmVzcywgb3BlcmF0aW9uKSB7XG4gICAgICAgIHN1cGVyKHNlbGVjdG9yLCB0b3BvbG9neURlc2NyaXB0aW9uLCBvcGVyYXRpb24pO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbnN0YW50c18xLlNFUlZFUl9TRUxFQ1RJT05fU1VDQ0VFREVEO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSAnU2VydmVyIHNlbGVjdGlvbiBzdWNjZWVkZWQnO1xuICAgICAgICBjb25zdCB7IGhvc3QsIHBvcnQgfSA9IHV0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhhZGRyZXNzKS50b0hvc3RQb3J0KCk7XG4gICAgICAgIHRoaXMuc2VydmVySG9zdCA9IGhvc3Q7XG4gICAgICAgIHRoaXMuc2VydmVyUG9ydCA9IHBvcnQ7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJTZWxlY3Rpb25TdWNjZWVkZWRFdmVudCA9IFNlcnZlclNlbGVjdGlvblN1Y2NlZWRlZEV2ZW50O1xuLyoqXG4gKiBBbiBldmVudCBwdWJsaXNoZWQgd2hlbiBzZXJ2ZXIgc2VsZWN0aW9uIGlzIHdhaXRpbmcgZm9yIGEgc3VpdGFibGUgc2VydmVyIHRvIGJlY29tZSBhdmFpbGFibGVcbiAqIEBpbnRlcm5hbFxuICogQGNhdGVnb3J5IEV2ZW50XG4gKi9cbmNsYXNzIFdhaXRpbmdGb3JTdWl0YWJsZVNlcnZlckV2ZW50IGV4dGVuZHMgU2VydmVyU2VsZWN0aW9uRXZlbnQge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihzZWxlY3RvciwgdG9wb2xvZ3lEZXNjcmlwdGlvbiwgcmVtYWluaW5nVGltZU1TLCBvcGVyYXRpb24pIHtcbiAgICAgICAgc3VwZXIoc2VsZWN0b3IsIHRvcG9sb2d5RGVzY3JpcHRpb24sIG9wZXJhdGlvbik7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gY29uc3RhbnRzXzEuV0FJVElOR19GT1JfU1VJVEFCTEVfU0VSVkVSO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSAnV2FpdGluZyBmb3Igc3VpdGFibGUgc2VydmVyIHRvIGJlY29tZSBhdmFpbGFibGUnO1xuICAgICAgICB0aGlzLnJlbWFpbmluZ1RpbWVNUyA9IHJlbWFpbmluZ1RpbWVNUztcbiAgICB9XG59XG5leHBvcnRzLldhaXRpbmdGb3JTdWl0YWJsZVNlcnZlckV2ZW50ID0gV2FpdGluZ0ZvclN1aXRhYmxlU2VydmVyRXZlbnQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXJ2ZXJfc2VsZWN0aW9uX2V2ZW50cy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection_events.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/srv_polling.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/srv_polling.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.SrvPoller = exports.SrvPollingEvent = void 0;\nconst dns = __webpack_require__(/*! dns */ \"dns\");\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/**\n * @internal\n * @category Event\n */\nclass SrvPollingEvent {\n    constructor(srvRecords) {\n        this.srvRecords = srvRecords;\n    }\n    hostnames() {\n        return new Set(this.srvRecords.map(r => utils_1.HostAddress.fromSrvRecord(r).toString()));\n    }\n}\nexports.SrvPollingEvent = SrvPollingEvent;\n/** @internal */\nclass SrvPoller extends mongo_types_1.TypedEventEmitter {\n    constructor(options) {\n        super();\n        this.on('error', utils_1.noop);\n        if (!options || !options.srvHost) {\n            throw new error_1.MongoRuntimeError('Options for SrvPoller must exist and include srvHost');\n        }\n        this.srvHost = options.srvHost;\n        this.srvMaxHosts = options.srvMaxHosts ?? 0;\n        this.srvServiceName = options.srvServiceName ?? 'mongodb';\n        this.rescanSrvIntervalMS = 60000;\n        this.heartbeatFrequencyMS = options.heartbeatFrequencyMS ?? 10000;\n        this.haMode = false;\n        this.generation = 0;\n        this._timeout = undefined;\n    }\n    get srvAddress() {\n        return `_${this.srvServiceName}._tcp.${this.srvHost}`;\n    }\n    get intervalMS() {\n        return this.haMode ? this.heartbeatFrequencyMS : this.rescanSrvIntervalMS;\n    }\n    start() {\n        if (!this._timeout) {\n            this.schedule();\n        }\n    }\n    stop() {\n        if (this._timeout) {\n            (0, timers_1.clearTimeout)(this._timeout);\n            this.generation += 1;\n            this._timeout = undefined;\n        }\n    }\n    // TODO(NODE-4994): implement new logging logic for SrvPoller failures\n    schedule() {\n        if (this._timeout) {\n            (0, timers_1.clearTimeout)(this._timeout);\n        }\n        this._timeout = (0, timers_1.setTimeout)(() => {\n            this._poll().then(undefined, utils_1.squashError);\n        }, this.intervalMS);\n    }\n    success(srvRecords) {\n        this.haMode = false;\n        this.schedule();\n        this.emit(SrvPoller.SRV_RECORD_DISCOVERY, new SrvPollingEvent(srvRecords));\n    }\n    failure() {\n        this.haMode = true;\n        this.schedule();\n    }\n    async _poll() {\n        const generation = this.generation;\n        let srvRecords;\n        try {\n            srvRecords = await dns.promises.resolveSrv(this.srvAddress);\n        }\n        catch {\n            this.failure();\n            return;\n        }\n        if (generation !== this.generation) {\n            return;\n        }\n        const finalAddresses = [];\n        for (const record of srvRecords) {\n            try {\n                (0, utils_1.checkParentDomainMatch)(record.name, this.srvHost);\n                finalAddresses.push(record);\n            }\n            catch (error) {\n                (0, utils_1.squashError)(error);\n            }\n        }\n        if (!finalAddresses.length) {\n            this.failure();\n            return;\n        }\n        this.success(finalAddresses);\n    }\n}\nexports.SrvPoller = SrvPoller;\n/** @event */\nSrvPoller.SRV_RECORD_DISCOVERY = 'srvRecordDiscovery';\n//# sourceMappingURL=srv_polling.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vc3J2X3BvbGxpbmcuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsaUJBQWlCLEdBQUcsdUJBQXVCO0FBQzNDLFlBQVksbUJBQU8sQ0FBQyxnQkFBSztBQUN6QixpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxzQkFBc0IsbUJBQU8sQ0FBQyx5R0FBZ0I7QUFDOUMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixvQkFBb0IsUUFBUSxhQUFhO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvc2RhbS9zcnZfcG9sbGluZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU3J2UG9sbGVyID0gZXhwb3J0cy5TcnZQb2xsaW5nRXZlbnQgPSB2b2lkIDA7XG5jb25zdCBkbnMgPSByZXF1aXJlKFwiZG5zXCIpO1xuY29uc3QgdGltZXJzXzEgPSByZXF1aXJlKFwidGltZXJzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIEBjYXRlZ29yeSBFdmVudFxuICovXG5jbGFzcyBTcnZQb2xsaW5nRXZlbnQge1xuICAgIGNvbnN0cnVjdG9yKHNydlJlY29yZHMpIHtcbiAgICAgICAgdGhpcy5zcnZSZWNvcmRzID0gc3J2UmVjb3JkcztcbiAgICB9XG4gICAgaG9zdG5hbWVzKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNldCh0aGlzLnNydlJlY29yZHMubWFwKHIgPT4gdXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3J2UmVjb3JkKHIpLnRvU3RyaW5nKCkpKTtcbiAgICB9XG59XG5leHBvcnRzLlNydlBvbGxpbmdFdmVudCA9IFNydlBvbGxpbmdFdmVudDtcbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFNydlBvbGxlciBleHRlbmRzIG1vbmdvX3R5cGVzXzEuVHlwZWRFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5vbignZXJyb3InLCB1dGlsc18xLm5vb3ApO1xuICAgICAgICBpZiAoIW9wdGlvbnMgfHwgIW9wdGlvbnMuc3J2SG9zdCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ09wdGlvbnMgZm9yIFNydlBvbGxlciBtdXN0IGV4aXN0IGFuZCBpbmNsdWRlIHNydkhvc3QnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNydkhvc3QgPSBvcHRpb25zLnNydkhvc3Q7XG4gICAgICAgIHRoaXMuc3J2TWF4SG9zdHMgPSBvcHRpb25zLnNydk1heEhvc3RzID8/IDA7XG4gICAgICAgIHRoaXMuc3J2U2VydmljZU5hbWUgPSBvcHRpb25zLnNydlNlcnZpY2VOYW1lID8/ICdtb25nb2RiJztcbiAgICAgICAgdGhpcy5yZXNjYW5TcnZJbnRlcnZhbE1TID0gNjAwMDA7XG4gICAgICAgIHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSBvcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID8/IDEwMDAwO1xuICAgICAgICB0aGlzLmhhTW9kZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdlbmVyYXRpb24gPSAwO1xuICAgICAgICB0aGlzLl90aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBnZXQgc3J2QWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIGBfJHt0aGlzLnNydlNlcnZpY2VOYW1lfS5fdGNwLiR7dGhpcy5zcnZIb3N0fWA7XG4gICAgfVxuICAgIGdldCBpbnRlcnZhbE1TKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYU1vZGUgPyB0aGlzLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TIDogdGhpcy5yZXNjYW5TcnZJbnRlcnZhbE1TO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90aW1lb3V0KSB7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RvcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RpbWVvdXQpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMuX3RpbWVvdXQpO1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0aW9uICs9IDE7XG4gICAgICAgICAgICB0aGlzLl90aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFRPRE8oTk9ERS00OTk0KTogaW1wbGVtZW50IG5ldyBsb2dnaW5nIGxvZ2ljIGZvciBTcnZQb2xsZXIgZmFpbHVyZXNcbiAgICBzY2hlZHVsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RpbWVvdXQpIHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRoaXMuX3RpbWVvdXQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3RpbWVvdXQgPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fcG9sbCgpLnRoZW4odW5kZWZpbmVkLCB1dGlsc18xLnNxdWFzaEVycm9yKTtcbiAgICAgICAgfSwgdGhpcy5pbnRlcnZhbE1TKTtcbiAgICB9XG4gICAgc3VjY2VzcyhzcnZSZWNvcmRzKSB7XG4gICAgICAgIHRoaXMuaGFNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2NoZWR1bGUoKTtcbiAgICAgICAgdGhpcy5lbWl0KFNydlBvbGxlci5TUlZfUkVDT1JEX0RJU0NPVkVSWSwgbmV3IFNydlBvbGxpbmdFdmVudChzcnZSZWNvcmRzKSk7XG4gICAgfVxuICAgIGZhaWx1cmUoKSB7XG4gICAgICAgIHRoaXMuaGFNb2RlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZSgpO1xuICAgIH1cbiAgICBhc3luYyBfcG9sbCgpIHtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbiA9IHRoaXMuZ2VuZXJhdGlvbjtcbiAgICAgICAgbGV0IHNydlJlY29yZHM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzcnZSZWNvcmRzID0gYXdhaXQgZG5zLnByb21pc2VzLnJlc29sdmVTcnYodGhpcy5zcnZBZGRyZXNzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICB0aGlzLmZhaWx1cmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2VuZXJhdGlvbiAhPT0gdGhpcy5nZW5lcmF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmluYWxBZGRyZXNzZXMgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCByZWNvcmQgb2Ygc3J2UmVjb3Jkcykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5jaGVja1BhcmVudERvbWFpbk1hdGNoKShyZWNvcmQubmFtZSwgdGhpcy5zcnZIb3N0KTtcbiAgICAgICAgICAgICAgICBmaW5hbEFkZHJlc3Nlcy5wdXNoKHJlY29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAoMCwgdXRpbHNfMS5zcXVhc2hFcnJvcikoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghZmluYWxBZGRyZXNzZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmZhaWx1cmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1Y2Nlc3MoZmluYWxBZGRyZXNzZXMpO1xuICAgIH1cbn1cbmV4cG9ydHMuU3J2UG9sbGVyID0gU3J2UG9sbGVyO1xuLyoqIEBldmVudCAqL1xuU3J2UG9sbGVyLlNSVl9SRUNPUkRfRElTQ09WRVJZID0gJ3NydlJlY29yZERpc2NvdmVyeSc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zcnZfcG9sbGluZy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/srv_polling.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerCapabilities = exports.Topology = void 0;\nconst connection_string_1 = __webpack_require__(/*! ../connection_string */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/connection_string.js\");\nconst constants_1 = __webpack_require__(/*! ../constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_logger_1 = __webpack_require__(/*! ../mongo_logger */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_logger.js\");\nconst mongo_types_1 = __webpack_require__(/*! ../mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst read_preference_1 = __webpack_require__(/*! ../read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst timeout_1 = __webpack_require__(/*! ../timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst events_1 = __webpack_require__(/*! ./events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/events.js\");\nconst server_1 = __webpack_require__(/*! ./server */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server.js\");\nconst server_description_1 = __webpack_require__(/*! ./server_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js\");\nconst server_selection_1 = __webpack_require__(/*! ./server_selection */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection.js\");\nconst server_selection_events_1 = __webpack_require__(/*! ./server_selection_events */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_selection_events.js\");\nconst srv_polling_1 = __webpack_require__(/*! ./srv_polling */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/srv_polling.js\");\nconst topology_description_1 = __webpack_require__(/*! ./topology_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology_description.js\");\n// Global state\nlet globalTopologyCounter = 0;\nconst stateTransition = (0, utils_1.makeStateMachine)({\n    [common_1.STATE_CLOSED]: [common_1.STATE_CLOSED, common_1.STATE_CONNECTING],\n    [common_1.STATE_CONNECTING]: [common_1.STATE_CONNECTING, common_1.STATE_CLOSING, common_1.STATE_CONNECTED, common_1.STATE_CLOSED],\n    [common_1.STATE_CONNECTED]: [common_1.STATE_CONNECTED, common_1.STATE_CLOSING, common_1.STATE_CLOSED],\n    [common_1.STATE_CLOSING]: [common_1.STATE_CLOSING, common_1.STATE_CLOSED]\n});\n/**\n * A container of server instances representing a connection to a MongoDB topology.\n * @internal\n */\nclass Topology extends mongo_types_1.TypedEventEmitter {\n    /**\n     * @param seedlist - a list of HostAddress instances to connect to\n     */\n    constructor(client, seeds, options) {\n        super();\n        this.on('error', utils_1.noop);\n        this.client = client;\n        // Options should only be undefined in tests, MongoClient will always have defined options\n        options = options ?? {\n            hosts: [utils_1.HostAddress.fromString('localhost:27017')],\n            ...Object.fromEntries(connection_string_1.DEFAULT_OPTIONS.entries())\n        };\n        if (typeof seeds === 'string') {\n            seeds = [utils_1.HostAddress.fromString(seeds)];\n        }\n        else if (!Array.isArray(seeds)) {\n            seeds = [seeds];\n        }\n        const seedlist = [];\n        for (const seed of seeds) {\n            if (typeof seed === 'string') {\n                seedlist.push(utils_1.HostAddress.fromString(seed));\n            }\n            else if (seed instanceof utils_1.HostAddress) {\n                seedlist.push(seed);\n            }\n            else {\n                // FIXME(NODE-3483): May need to be a MongoParseError\n                throw new error_1.MongoRuntimeError(`Topology cannot be constructed from ${JSON.stringify(seed)}`);\n            }\n        }\n        const topologyType = topologyTypeFromOptions(options);\n        const topologyId = globalTopologyCounter++;\n        const selectedHosts = options.srvMaxHosts == null ||\n            options.srvMaxHosts === 0 ||\n            options.srvMaxHosts >= seedlist.length\n            ? seedlist\n            : (0, utils_1.shuffle)(seedlist, options.srvMaxHosts);\n        const serverDescriptions = new Map();\n        for (const hostAddress of selectedHosts) {\n            serverDescriptions.set(hostAddress.toString(), new server_description_1.ServerDescription(hostAddress));\n        }\n        this.waitQueue = new utils_1.List();\n        this.s = {\n            // the id of this topology\n            id: topologyId,\n            // passed in options\n            options,\n            // initial seedlist of servers to connect to\n            seedlist,\n            // initial state\n            state: common_1.STATE_CLOSED,\n            // the topology description\n            description: new topology_description_1.TopologyDescription(topologyType, serverDescriptions, options.replicaSet, undefined, undefined, undefined, options),\n            serverSelectionTimeoutMS: options.serverSelectionTimeoutMS,\n            heartbeatFrequencyMS: options.heartbeatFrequencyMS,\n            minHeartbeatFrequencyMS: options.minHeartbeatFrequencyMS,\n            // a map of server instances to normalized addresses\n            servers: new Map(),\n            credentials: options?.credentials,\n            clusterTime: undefined,\n            detectShardedTopology: ev => this.detectShardedTopology(ev),\n            detectSrvRecords: ev => this.detectSrvRecords(ev)\n        };\n        this.mongoLogger = client.mongoLogger;\n        this.component = 'topology';\n        if (options.srvHost && !options.loadBalanced) {\n            this.s.srvPoller =\n                options.srvPoller ??\n                    new srv_polling_1.SrvPoller({\n                        heartbeatFrequencyMS: this.s.heartbeatFrequencyMS,\n                        srvHost: options.srvHost,\n                        srvMaxHosts: options.srvMaxHosts,\n                        srvServiceName: options.srvServiceName\n                    });\n            this.on(Topology.TOPOLOGY_DESCRIPTION_CHANGED, this.s.detectShardedTopology);\n        }\n        this.connectionLock = undefined;\n    }\n    detectShardedTopology(event) {\n        const previousType = event.previousDescription.type;\n        const newType = event.newDescription.type;\n        const transitionToSharded = previousType !== common_1.TopologyType.Sharded && newType === common_1.TopologyType.Sharded;\n        const srvListeners = this.s.srvPoller?.listeners(srv_polling_1.SrvPoller.SRV_RECORD_DISCOVERY);\n        const listeningToSrvPolling = !!srvListeners?.includes(this.s.detectSrvRecords);\n        if (transitionToSharded && !listeningToSrvPolling) {\n            this.s.srvPoller?.on(srv_polling_1.SrvPoller.SRV_RECORD_DISCOVERY, this.s.detectSrvRecords);\n            this.s.srvPoller?.start();\n        }\n    }\n    detectSrvRecords(ev) {\n        const previousTopologyDescription = this.s.description;\n        this.s.description = this.s.description.updateFromSrvPollingEvent(ev, this.s.options.srvMaxHosts);\n        if (this.s.description === previousTopologyDescription) {\n            // Nothing changed, so return\n            return;\n        }\n        updateServers(this);\n        this.emitAndLog(Topology.TOPOLOGY_DESCRIPTION_CHANGED, new events_1.TopologyDescriptionChangedEvent(this.s.id, previousTopologyDescription, this.s.description));\n    }\n    /**\n     * @returns A `TopologyDescription` for this topology\n     */\n    get description() {\n        return this.s.description;\n    }\n    get loadBalanced() {\n        return this.s.options.loadBalanced;\n    }\n    get serverApi() {\n        return this.s.options.serverApi;\n    }\n    get capabilities() {\n        return new ServerCapabilities(this.lastHello());\n    }\n    /** Initiate server connect */\n    async connect(options) {\n        this.connectionLock ??= this._connect(options);\n        try {\n            await this.connectionLock;\n            return this;\n        }\n        finally {\n            this.connectionLock = undefined;\n        }\n    }\n    async _connect(options) {\n        options = options ?? {};\n        if (this.s.state === common_1.STATE_CONNECTED) {\n            return this;\n        }\n        stateTransition(this, common_1.STATE_CONNECTING);\n        // emit SDAM monitoring events\n        this.emitAndLog(Topology.TOPOLOGY_OPENING, new events_1.TopologyOpeningEvent(this.s.id));\n        // emit an event for the topology change\n        this.emitAndLog(Topology.TOPOLOGY_DESCRIPTION_CHANGED, new events_1.TopologyDescriptionChangedEvent(this.s.id, new topology_description_1.TopologyDescription(common_1.TopologyType.Unknown), // initial is always Unknown\n        this.s.description));\n        // connect all known servers, then attempt server selection to connect\n        const serverDescriptions = Array.from(this.s.description.servers.values());\n        this.s.servers = new Map(serverDescriptions.map(serverDescription => [\n            serverDescription.address,\n            createAndConnectServer(this, serverDescription)\n        ]));\n        // In load balancer mode we need to fake a server description getting\n        // emitted from the monitor, since the monitor doesn't exist.\n        if (this.s.options.loadBalanced) {\n            for (const description of serverDescriptions) {\n                const newDescription = new server_description_1.ServerDescription(description.hostAddress, undefined, {\n                    loadBalanced: this.s.options.loadBalanced\n                });\n                this.serverUpdateHandler(newDescription);\n            }\n        }\n        const serverSelectionTimeoutMS = this.client.s.options.serverSelectionTimeoutMS;\n        const readPreference = options.readPreference ?? read_preference_1.ReadPreference.primary;\n        const timeoutContext = timeout_1.TimeoutContext.create({\n            // TODO(NODE-6448): auto-connect ignores timeoutMS; potential future feature\n            timeoutMS: undefined,\n            serverSelectionTimeoutMS,\n            waitQueueTimeoutMS: this.client.s.options.waitQueueTimeoutMS\n        });\n        const selectServerOptions = {\n            operationName: 'ping',\n            ...options,\n            timeoutContext\n        };\n        try {\n            const server = await this.selectServer((0, server_selection_1.readPreferenceServerSelector)(readPreference), selectServerOptions);\n            const skipPingOnConnect = this.s.options.__skipPingOnConnect === true;\n            if (!skipPingOnConnect && this.s.credentials) {\n                await server.command((0, utils_1.ns)('admin.$cmd'), { ping: 1 }, { timeoutContext });\n                stateTransition(this, common_1.STATE_CONNECTED);\n                this.emit(Topology.OPEN, this);\n                this.emit(Topology.CONNECT, this);\n                return this;\n            }\n            stateTransition(this, common_1.STATE_CONNECTED);\n            this.emit(Topology.OPEN, this);\n            this.emit(Topology.CONNECT, this);\n            return this;\n        }\n        catch (error) {\n            this.close();\n            throw error;\n        }\n    }\n    /** Close this topology */\n    close() {\n        if (this.s.state === common_1.STATE_CLOSED || this.s.state === common_1.STATE_CLOSING) {\n            return;\n        }\n        for (const server of this.s.servers.values()) {\n            destroyServer(server, this);\n        }\n        this.s.servers.clear();\n        stateTransition(this, common_1.STATE_CLOSING);\n        drainWaitQueue(this.waitQueue, new error_1.MongoTopologyClosedError());\n        if (this.s.srvPoller) {\n            this.s.srvPoller.stop();\n            this.s.srvPoller.removeListener(srv_polling_1.SrvPoller.SRV_RECORD_DISCOVERY, this.s.detectSrvRecords);\n        }\n        this.removeListener(Topology.TOPOLOGY_DESCRIPTION_CHANGED, this.s.detectShardedTopology);\n        stateTransition(this, common_1.STATE_CLOSED);\n        // emit an event for close\n        this.emitAndLog(Topology.TOPOLOGY_CLOSED, new events_1.TopologyClosedEvent(this.s.id));\n    }\n    /**\n     * Selects a server according to the selection predicate provided\n     *\n     * @param selector - An optional selector to select servers by, defaults to a random selection within a latency window\n     * @param options - Optional settings related to server selection\n     * @param callback - The callback used to indicate success or failure\n     * @returns An instance of a `Server` meeting the criteria of the predicate provided\n     */\n    async selectServer(selector, options) {\n        let serverSelector;\n        if (typeof selector !== 'function') {\n            if (typeof selector === 'string') {\n                serverSelector = (0, server_selection_1.readPreferenceServerSelector)(read_preference_1.ReadPreference.fromString(selector));\n            }\n            else {\n                let readPreference;\n                if (selector instanceof read_preference_1.ReadPreference) {\n                    readPreference = selector;\n                }\n                else {\n                    read_preference_1.ReadPreference.translate(options);\n                    readPreference = options.readPreference || read_preference_1.ReadPreference.primary;\n                }\n                serverSelector = (0, server_selection_1.readPreferenceServerSelector)(readPreference);\n            }\n        }\n        else {\n            serverSelector = selector;\n        }\n        options = { serverSelectionTimeoutMS: this.s.serverSelectionTimeoutMS, ...options };\n        if (this.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n            this.client.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionStartedEvent(selector, this.description, options.operationName));\n        }\n        let timeout;\n        if (options.timeoutContext)\n            timeout = options.timeoutContext.serverSelectionTimeout;\n        else {\n            timeout = timeout_1.Timeout.expires(options.serverSelectionTimeoutMS ?? 0);\n        }\n        const isSharded = this.description.type === common_1.TopologyType.Sharded;\n        const session = options.session;\n        const transaction = session && session.transaction;\n        if (isSharded && transaction && transaction.server) {\n            if (this.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n                this.client.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionSucceededEvent(selector, this.description, transaction.server.pool.address, options.operationName));\n            }\n            if (options.timeoutContext?.clearServerSelectionTimeout)\n                timeout?.clear();\n            return transaction.server;\n        }\n        const { promise: serverPromise, resolve, reject } = (0, utils_1.promiseWithResolvers)();\n        const waitQueueMember = {\n            serverSelector,\n            topologyDescription: this.description,\n            mongoLogger: this.client.mongoLogger,\n            transaction,\n            resolve,\n            reject,\n            cancelled: false,\n            startTime: (0, utils_1.now)(),\n            operationName: options.operationName,\n            waitingLogged: false,\n            previousServer: options.previousServer\n        };\n        const abortListener = (0, utils_1.addAbortListener)(options.signal, function () {\n            waitQueueMember.cancelled = true;\n            reject(this.reason);\n        });\n        this.waitQueue.push(waitQueueMember);\n        processWaitQueue(this);\n        try {\n            timeout?.throwIfExpired();\n            const server = await (timeout ? Promise.race([serverPromise, timeout]) : serverPromise);\n            if (options.timeoutContext?.csotEnabled() && server.description.minRoundTripTime !== 0) {\n                options.timeoutContext.minRoundTripTime = server.description.minRoundTripTime;\n            }\n            return server;\n        }\n        catch (error) {\n            if (timeout_1.TimeoutError.is(error)) {\n                // Timeout\n                waitQueueMember.cancelled = true;\n                const timeoutError = new error_1.MongoServerSelectionError(`Server selection timed out after ${timeout?.duration} ms`, this.description);\n                if (this.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n                    this.client.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionFailedEvent(selector, this.description, timeoutError, options.operationName));\n                }\n                if (options.timeoutContext?.csotEnabled()) {\n                    throw new error_1.MongoOperationTimeoutError('Timed out during server selection', {\n                        cause: timeoutError\n                    });\n                }\n                throw timeoutError;\n            }\n            // Other server selection error\n            throw error;\n        }\n        finally {\n            abortListener?.[utils_1.kDispose]();\n            if (options.timeoutContext?.clearServerSelectionTimeout)\n                timeout?.clear();\n        }\n    }\n    /**\n     * Update the internal TopologyDescription with a ServerDescription\n     *\n     * @param serverDescription - The server to update in the internal list of server descriptions\n     */\n    serverUpdateHandler(serverDescription) {\n        if (!this.s.description.hasServer(serverDescription.address)) {\n            return;\n        }\n        // ignore this server update if its from an outdated topologyVersion\n        if (isStaleServerDescription(this.s.description, serverDescription)) {\n            return;\n        }\n        // these will be used for monitoring events later\n        const previousTopologyDescription = this.s.description;\n        const previousServerDescription = this.s.description.servers.get(serverDescription.address);\n        if (!previousServerDescription) {\n            return;\n        }\n        // Driver Sessions Spec: \"Whenever a driver receives a cluster time from\n        // a server it MUST compare it to the current highest seen cluster time\n        // for the deployment. If the new cluster time is higher than the\n        // highest seen cluster time it MUST become the new highest seen cluster\n        // time. Two cluster times are compared using only the BsonTimestamp\n        // value of the clusterTime embedded field.\"\n        const clusterTime = serverDescription.$clusterTime;\n        if (clusterTime) {\n            (0, common_1._advanceClusterTime)(this, clusterTime);\n        }\n        // If we already know all the information contained in this updated description, then\n        // we don't need to emit SDAM events, but still need to update the description, in order\n        // to keep client-tracked attributes like last update time and round trip time up to date\n        const equalDescriptions = previousServerDescription && previousServerDescription.equals(serverDescription);\n        // first update the TopologyDescription\n        this.s.description = this.s.description.update(serverDescription);\n        if (this.s.description.compatibilityError) {\n            this.emit(Topology.ERROR, new error_1.MongoCompatibilityError(this.s.description.compatibilityError));\n            return;\n        }\n        // emit monitoring events for this change\n        if (!equalDescriptions) {\n            const newDescription = this.s.description.servers.get(serverDescription.address);\n            if (newDescription) {\n                this.emit(Topology.SERVER_DESCRIPTION_CHANGED, new events_1.ServerDescriptionChangedEvent(this.s.id, serverDescription.address, previousServerDescription, newDescription));\n            }\n        }\n        // update server list from updated descriptions\n        updateServers(this, serverDescription);\n        // attempt to resolve any outstanding server selection attempts\n        if (this.waitQueue.length > 0) {\n            processWaitQueue(this);\n        }\n        if (!equalDescriptions) {\n            this.emitAndLog(Topology.TOPOLOGY_DESCRIPTION_CHANGED, new events_1.TopologyDescriptionChangedEvent(this.s.id, previousTopologyDescription, this.s.description));\n        }\n    }\n    auth(credentials, callback) {\n        if (typeof credentials === 'function')\n            (callback = credentials), (credentials = undefined);\n        if (typeof callback === 'function')\n            callback(undefined, true);\n    }\n    get clientMetadata() {\n        return this.s.options.metadata;\n    }\n    isConnected() {\n        return this.s.state === common_1.STATE_CONNECTED;\n    }\n    isDestroyed() {\n        return this.s.state === common_1.STATE_CLOSED;\n    }\n    // NOTE: There are many places in code where we explicitly check the last hello\n    //       to do feature support detection. This should be done any other way, but for\n    //       now we will just return the first hello seen, which should suffice.\n    lastHello() {\n        const serverDescriptions = Array.from(this.description.servers.values());\n        if (serverDescriptions.length === 0)\n            return {};\n        const sd = serverDescriptions.filter((sd) => sd.type !== common_1.ServerType.Unknown)[0];\n        const result = sd || { maxWireVersion: this.description.commonWireVersion };\n        return result;\n    }\n    get commonWireVersion() {\n        return this.description.commonWireVersion;\n    }\n    get logicalSessionTimeoutMinutes() {\n        return this.description.logicalSessionTimeoutMinutes;\n    }\n    get clusterTime() {\n        return this.s.clusterTime;\n    }\n    set clusterTime(clusterTime) {\n        this.s.clusterTime = clusterTime;\n    }\n}\nexports.Topology = Topology;\n/** @event */\nTopology.SERVER_OPENING = constants_1.SERVER_OPENING;\n/** @event */\nTopology.SERVER_CLOSED = constants_1.SERVER_CLOSED;\n/** @event */\nTopology.SERVER_DESCRIPTION_CHANGED = constants_1.SERVER_DESCRIPTION_CHANGED;\n/** @event */\nTopology.TOPOLOGY_OPENING = constants_1.TOPOLOGY_OPENING;\n/** @event */\nTopology.TOPOLOGY_CLOSED = constants_1.TOPOLOGY_CLOSED;\n/** @event */\nTopology.TOPOLOGY_DESCRIPTION_CHANGED = constants_1.TOPOLOGY_DESCRIPTION_CHANGED;\n/** @event */\nTopology.ERROR = constants_1.ERROR;\n/** @event */\nTopology.OPEN = constants_1.OPEN;\n/** @event */\nTopology.CONNECT = constants_1.CONNECT;\n/** @event */\nTopology.CLOSE = constants_1.CLOSE;\n/** @event */\nTopology.TIMEOUT = constants_1.TIMEOUT;\n/** Destroys a server, and removes all event listeners from the instance */\nfunction destroyServer(server, topology) {\n    for (const event of constants_1.LOCAL_SERVER_EVENTS) {\n        server.removeAllListeners(event);\n    }\n    server.destroy();\n    topology.emitAndLog(Topology.SERVER_CLOSED, new events_1.ServerClosedEvent(topology.s.id, server.description.address));\n    for (const event of constants_1.SERVER_RELAY_EVENTS) {\n        server.removeAllListeners(event);\n    }\n}\n/** Predicts the TopologyType from options */\nfunction topologyTypeFromOptions(options) {\n    if (options?.directConnection) {\n        return common_1.TopologyType.Single;\n    }\n    if (options?.replicaSet) {\n        return common_1.TopologyType.ReplicaSetNoPrimary;\n    }\n    if (options?.loadBalanced) {\n        return common_1.TopologyType.LoadBalanced;\n    }\n    return common_1.TopologyType.Unknown;\n}\n/**\n * Creates new server instances and attempts to connect them\n *\n * @param topology - The topology that this server belongs to\n * @param serverDescription - The description for the server to initialize and connect to\n */\nfunction createAndConnectServer(topology, serverDescription) {\n    topology.emitAndLog(Topology.SERVER_OPENING, new events_1.ServerOpeningEvent(topology.s.id, serverDescription.address));\n    const server = new server_1.Server(topology, serverDescription, topology.s.options);\n    for (const event of constants_1.SERVER_RELAY_EVENTS) {\n        server.on(event, (e) => topology.emit(event, e));\n    }\n    server.on(server_1.Server.DESCRIPTION_RECEIVED, description => topology.serverUpdateHandler(description));\n    server.connect();\n    return server;\n}\n/**\n * @param topology - Topology to update.\n * @param incomingServerDescription - New server description.\n */\nfunction updateServers(topology, incomingServerDescription) {\n    // update the internal server's description\n    if (incomingServerDescription && topology.s.servers.has(incomingServerDescription.address)) {\n        const server = topology.s.servers.get(incomingServerDescription.address);\n        if (server) {\n            server.s.description = incomingServerDescription;\n            if (incomingServerDescription.error instanceof error_1.MongoError &&\n                incomingServerDescription.error.hasErrorLabel(error_1.MongoErrorLabel.ResetPool)) {\n                const interruptInUseConnections = incomingServerDescription.error.hasErrorLabel(error_1.MongoErrorLabel.InterruptInUseConnections);\n                server.pool.clear({ interruptInUseConnections });\n            }\n            else if (incomingServerDescription.error == null) {\n                const newTopologyType = topology.s.description.type;\n                const shouldMarkPoolReady = incomingServerDescription.isDataBearing ||\n                    (incomingServerDescription.type !== common_1.ServerType.Unknown &&\n                        newTopologyType === common_1.TopologyType.Single);\n                if (shouldMarkPoolReady) {\n                    server.pool.ready();\n                }\n            }\n        }\n    }\n    // add new servers for all descriptions we currently don't know about locally\n    for (const serverDescription of topology.description.servers.values()) {\n        if (!topology.s.servers.has(serverDescription.address)) {\n            const server = createAndConnectServer(topology, serverDescription);\n            topology.s.servers.set(serverDescription.address, server);\n        }\n    }\n    // for all servers no longer known, remove their descriptions and destroy their instances\n    for (const entry of topology.s.servers) {\n        const serverAddress = entry[0];\n        if (topology.description.hasServer(serverAddress)) {\n            continue;\n        }\n        if (!topology.s.servers.has(serverAddress)) {\n            continue;\n        }\n        const server = topology.s.servers.get(serverAddress);\n        topology.s.servers.delete(serverAddress);\n        // prepare server for garbage collection\n        if (server) {\n            destroyServer(server, topology);\n        }\n    }\n}\nfunction drainWaitQueue(queue, drainError) {\n    while (queue.length) {\n        const waitQueueMember = queue.shift();\n        if (!waitQueueMember) {\n            continue;\n        }\n        if (!waitQueueMember.cancelled) {\n            if (waitQueueMember.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n                waitQueueMember.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionFailedEvent(waitQueueMember.serverSelector, waitQueueMember.topologyDescription, drainError, waitQueueMember.operationName));\n            }\n            waitQueueMember.reject(drainError);\n        }\n    }\n}\nfunction processWaitQueue(topology) {\n    if (topology.s.state === common_1.STATE_CLOSED) {\n        drainWaitQueue(topology.waitQueue, new error_1.MongoTopologyClosedError());\n        return;\n    }\n    const isSharded = topology.description.type === common_1.TopologyType.Sharded;\n    const serverDescriptions = Array.from(topology.description.servers.values());\n    const membersToProcess = topology.waitQueue.length;\n    for (let i = 0; i < membersToProcess; ++i) {\n        const waitQueueMember = topology.waitQueue.shift();\n        if (!waitQueueMember) {\n            continue;\n        }\n        if (waitQueueMember.cancelled) {\n            continue;\n        }\n        let selectedDescriptions;\n        try {\n            const serverSelector = waitQueueMember.serverSelector;\n            const previousServer = waitQueueMember.previousServer;\n            selectedDescriptions = serverSelector\n                ? serverSelector(topology.description, serverDescriptions, previousServer ? [previousServer] : [])\n                : serverDescriptions;\n        }\n        catch (selectorError) {\n            if (topology.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n                topology.client.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionFailedEvent(waitQueueMember.serverSelector, topology.description, selectorError, waitQueueMember.operationName));\n            }\n            waitQueueMember.reject(selectorError);\n            continue;\n        }\n        let selectedServer;\n        if (selectedDescriptions.length === 0) {\n            if (!waitQueueMember.waitingLogged) {\n                if (topology.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.INFORMATIONAL)) {\n                    topology.client.mongoLogger?.info(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.WaitingForSuitableServerEvent(waitQueueMember.serverSelector, topology.description, topology.s.serverSelectionTimeoutMS !== 0\n                        ? topology.s.serverSelectionTimeoutMS - ((0, utils_1.now)() - waitQueueMember.startTime)\n                        : -1, waitQueueMember.operationName));\n                }\n                waitQueueMember.waitingLogged = true;\n            }\n            topology.waitQueue.push(waitQueueMember);\n            continue;\n        }\n        else if (selectedDescriptions.length === 1) {\n            selectedServer = topology.s.servers.get(selectedDescriptions[0].address);\n        }\n        else {\n            const descriptions = (0, utils_1.shuffle)(selectedDescriptions, 2);\n            const server1 = topology.s.servers.get(descriptions[0].address);\n            const server2 = topology.s.servers.get(descriptions[1].address);\n            selectedServer =\n                server1 && server2 && server1.s.operationCount < server2.s.operationCount\n                    ? server1\n                    : server2;\n        }\n        if (!selectedServer) {\n            const serverSelectionError = new error_1.MongoServerSelectionError('server selection returned a server description but the server was not found in the topology', topology.description);\n            if (topology.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n                topology.client.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionFailedEvent(waitQueueMember.serverSelector, topology.description, serverSelectionError, waitQueueMember.operationName));\n            }\n            waitQueueMember.reject(serverSelectionError);\n            return;\n        }\n        const transaction = waitQueueMember.transaction;\n        if (isSharded && transaction && transaction.isActive && selectedServer) {\n            transaction.pinServer(selectedServer);\n        }\n        if (topology.client.mongoLogger?.willLog(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, mongo_logger_1.SeverityLevel.DEBUG)) {\n            topology.client.mongoLogger?.debug(mongo_logger_1.MongoLoggableComponent.SERVER_SELECTION, new server_selection_events_1.ServerSelectionSucceededEvent(waitQueueMember.serverSelector, waitQueueMember.topologyDescription, selectedServer.pool.address, waitQueueMember.operationName));\n        }\n        waitQueueMember.resolve(selectedServer);\n    }\n    if (topology.waitQueue.length > 0) {\n        // ensure all server monitors attempt monitoring soon\n        for (const [, server] of topology.s.servers) {\n            process.nextTick(function scheduleServerCheck() {\n                return server.requestCheck();\n            });\n        }\n    }\n}\nfunction isStaleServerDescription(topologyDescription, incomingServerDescription) {\n    const currentServerDescription = topologyDescription.servers.get(incomingServerDescription.address);\n    const currentTopologyVersion = currentServerDescription?.topologyVersion;\n    return ((0, server_description_1.compareTopologyVersion)(currentTopologyVersion, incomingServerDescription.topologyVersion) > 0);\n}\n/** @public */\nclass ServerCapabilities {\n    constructor(hello) {\n        this.minWireVersion = hello.minWireVersion || 0;\n        this.maxWireVersion = hello.maxWireVersion || 0;\n    }\n    get hasAggregationCursor() {\n        return this.maxWireVersion >= 1;\n    }\n    get hasWriteCommands() {\n        return this.maxWireVersion >= 2;\n    }\n    get hasTextSearch() {\n        return this.minWireVersion >= 0;\n    }\n    get hasAuthCommands() {\n        return this.maxWireVersion >= 1;\n    }\n    get hasListCollectionsCommand() {\n        return this.maxWireVersion >= 3;\n    }\n    get hasListIndexesCommand() {\n        return this.maxWireVersion >= 3;\n    }\n    get supportsSnapshotReads() {\n        return this.maxWireVersion >= 13;\n    }\n    get commandsTakeWriteConcern() {\n        return this.maxWireVersion >= 5;\n    }\n    get commandsTakeCollation() {\n        return this.maxWireVersion >= 5;\n    }\n}\nexports.ServerCapabilities = ServerCapabilities;\n//# sourceMappingURL=topology.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vdG9wb2xvZ3kuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMEJBQTBCLEdBQUcsZ0JBQWdCO0FBQzdDLDRCQUE0QixtQkFBTyxDQUFDLHFIQUFzQjtBQUMxRCxvQkFBb0IsbUJBQU8sQ0FBQyxxR0FBYztBQUMxQyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyx1QkFBdUIsbUJBQU8sQ0FBQywyR0FBaUI7QUFDaEQsc0JBQXNCLG1CQUFPLENBQUMseUdBQWdCO0FBQzlDLDBCQUEwQixtQkFBTyxDQUFDLGlIQUFvQjtBQUN0RCxrQkFBa0IsbUJBQU8sQ0FBQyxpR0FBWTtBQUN0QyxnQkFBZ0IsbUJBQU8sQ0FBQyw2RkFBVTtBQUNsQyxpQkFBaUIsbUJBQU8sQ0FBQyxtR0FBVTtBQUNuQyxpQkFBaUIsbUJBQU8sQ0FBQyxtR0FBVTtBQUNuQyxpQkFBaUIsbUJBQU8sQ0FBQyxtR0FBVTtBQUNuQyw2QkFBNkIsbUJBQU8sQ0FBQywySEFBc0I7QUFDM0QsMkJBQTJCLG1CQUFPLENBQUMsdUhBQW9CO0FBQ3ZELGtDQUFrQyxtQkFBTyxDQUFDLHFJQUEyQjtBQUNyRSxzQkFBc0IsbUJBQU8sQ0FBQyw2R0FBZTtBQUM3QywrQkFBK0IsbUJBQU8sQ0FBQywrSEFBd0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkZBQTJGLHFCQUFxQjtBQUNoSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0U7QUFDaEU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxTQUFTLElBQUksZ0JBQWdCO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMENBQTBDO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrR0FBK0csbUJBQW1CO0FBQ2xJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDJCQUEyQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixzQkFBc0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQiIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vdG9wb2xvZ3kuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlNlcnZlckNhcGFiaWxpdGllcyA9IGV4cG9ydHMuVG9wb2xvZ3kgPSB2b2lkIDA7XG5jb25zdCBjb25uZWN0aW9uX3N0cmluZ18xID0gcmVxdWlyZShcIi4uL2Nvbm5lY3Rpb25fc3RyaW5nXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuLi9lcnJvclwiKTtcbmNvbnN0IG1vbmdvX2xvZ2dlcl8xID0gcmVxdWlyZShcIi4uL21vbmdvX2xvZ2dlclwiKTtcbmNvbnN0IG1vbmdvX3R5cGVzXzEgPSByZXF1aXJlKFwiLi4vbW9uZ29fdHlwZXNcIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB0aW1lb3V0XzEgPSByZXF1aXJlKFwiLi4vdGltZW91dFwiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuL2NvbW1vblwiKTtcbmNvbnN0IGV2ZW50c18xID0gcmVxdWlyZShcIi4vZXZlbnRzXCIpO1xuY29uc3Qgc2VydmVyXzEgPSByZXF1aXJlKFwiLi9zZXJ2ZXJcIik7XG5jb25zdCBzZXJ2ZXJfZGVzY3JpcHRpb25fMSA9IHJlcXVpcmUoXCIuL3NlcnZlcl9kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHNlcnZlcl9zZWxlY3Rpb25fMSA9IHJlcXVpcmUoXCIuL3NlcnZlcl9zZWxlY3Rpb25cIik7XG5jb25zdCBzZXJ2ZXJfc2VsZWN0aW9uX2V2ZW50c18xID0gcmVxdWlyZShcIi4vc2VydmVyX3NlbGVjdGlvbl9ldmVudHNcIik7XG5jb25zdCBzcnZfcG9sbGluZ18xID0gcmVxdWlyZShcIi4vc3J2X3BvbGxpbmdcIik7XG5jb25zdCB0b3BvbG9neV9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4vdG9wb2xvZ3lfZGVzY3JpcHRpb25cIik7XG4vLyBHbG9iYWwgc3RhdGVcbmxldCBnbG9iYWxUb3BvbG9neUNvdW50ZXIgPSAwO1xuY29uc3Qgc3RhdGVUcmFuc2l0aW9uID0gKDAsIHV0aWxzXzEubWFrZVN0YXRlTWFjaGluZSkoe1xuICAgIFtjb21tb25fMS5TVEFURV9DTE9TRURdOiBbY29tbW9uXzEuU1RBVEVfQ0xPU0VELCBjb21tb25fMS5TVEFURV9DT05ORUNUSU5HXSxcbiAgICBbY29tbW9uXzEuU1RBVEVfQ09OTkVDVElOR106IFtjb21tb25fMS5TVEFURV9DT05ORUNUSU5HLCBjb21tb25fMS5TVEFURV9DTE9TSU5HLCBjb21tb25fMS5TVEFURV9DT05ORUNURUQsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRF0sXG4gICAgW2NvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRF06IFtjb21tb25fMS5TVEFURV9DT05ORUNURUQsIGNvbW1vbl8xLlNUQVRFX0NMT1NJTkcsIGNvbW1vbl8xLlNUQVRFX0NMT1NFRF0sXG4gICAgW2NvbW1vbl8xLlNUQVRFX0NMT1NJTkddOiBbY29tbW9uXzEuU1RBVEVfQ0xPU0lORywgY29tbW9uXzEuU1RBVEVfQ0xPU0VEXVxufSk7XG4vKipcbiAqIEEgY29udGFpbmVyIG9mIHNlcnZlciBpbnN0YW5jZXMgcmVwcmVzZW50aW5nIGEgY29ubmVjdGlvbiB0byBhIE1vbmdvREIgdG9wb2xvZ3kuXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgVG9wb2xvZ3kgZXh0ZW5kcyBtb25nb190eXBlc18xLlR5cGVkRXZlbnRFbWl0dGVyIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gc2VlZGxpc3QgLSBhIGxpc3Qgb2YgSG9zdEFkZHJlc3MgaW5zdGFuY2VzIHRvIGNvbm5lY3QgdG9cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIHNlZWRzLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMub24oJ2Vycm9yJywgdXRpbHNfMS5ub29wKTtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIC8vIE9wdGlvbnMgc2hvdWxkIG9ubHkgYmUgdW5kZWZpbmVkIGluIHRlc3RzLCBNb25nb0NsaWVudCB3aWxsIGFsd2F5cyBoYXZlIGRlZmluZWQgb3B0aW9uc1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7XG4gICAgICAgICAgICBob3N0czogW3V0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZygnbG9jYWxob3N0OjI3MDE3JyldLFxuICAgICAgICAgICAgLi4uT2JqZWN0LmZyb21FbnRyaWVzKGNvbm5lY3Rpb25fc3RyaW5nXzEuREVGQVVMVF9PUFRJT05TLmVudHJpZXMoKSlcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGVvZiBzZWVkcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHNlZWRzID0gW3V0aWxzXzEuSG9zdEFkZHJlc3MuZnJvbVN0cmluZyhzZWVkcyldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KHNlZWRzKSkge1xuICAgICAgICAgICAgc2VlZHMgPSBbc2VlZHNdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlZWRsaXN0ID0gW107XG4gICAgICAgIGZvciAoY29uc3Qgc2VlZCBvZiBzZWVkcykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWVkID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHNlZWRsaXN0LnB1c2godXRpbHNfMS5Ib3N0QWRkcmVzcy5mcm9tU3RyaW5nKHNlZWQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNlZWQgaW5zdGFuY2VvZiB1dGlsc18xLkhvc3RBZGRyZXNzKSB7XG4gICAgICAgICAgICAgICAgc2VlZGxpc3QucHVzaChzZWVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZJWE1FKE5PREUtMzQ4Myk6IE1heSBuZWVkIHRvIGJlIGEgTW9uZ29QYXJzZUVycm9yXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYFRvcG9sb2d5IGNhbm5vdCBiZSBjb25zdHJ1Y3RlZCBmcm9tICR7SlNPTi5zdHJpbmdpZnkoc2VlZCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdG9wb2xvZ3lUeXBlID0gdG9wb2xvZ3lUeXBlRnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5SWQgPSBnbG9iYWxUb3BvbG9neUNvdW50ZXIrKztcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRIb3N0cyA9IG9wdGlvbnMuc3J2TWF4SG9zdHMgPT0gbnVsbCB8fFxuICAgICAgICAgICAgb3B0aW9ucy5zcnZNYXhIb3N0cyA9PT0gMCB8fFxuICAgICAgICAgICAgb3B0aW9ucy5zcnZNYXhIb3N0cyA+PSBzZWVkbGlzdC5sZW5ndGhcbiAgICAgICAgICAgID8gc2VlZGxpc3RcbiAgICAgICAgICAgIDogKDAsIHV0aWxzXzEuc2h1ZmZsZSkoc2VlZGxpc3QsIG9wdGlvbnMuc3J2TWF4SG9zdHMpO1xuICAgICAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGZvciAoY29uc3QgaG9zdEFkZHJlc3Mgb2Ygc2VsZWN0ZWRIb3N0cykge1xuICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLnNldChob3N0QWRkcmVzcy50b1N0cmluZygpLCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oaG9zdEFkZHJlc3MpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndhaXRRdWV1ZSA9IG5ldyB1dGlsc18xLkxpc3QoKTtcbiAgICAgICAgdGhpcy5zID0ge1xuICAgICAgICAgICAgLy8gdGhlIGlkIG9mIHRoaXMgdG9wb2xvZ3lcbiAgICAgICAgICAgIGlkOiB0b3BvbG9neUlkLFxuICAgICAgICAgICAgLy8gcGFzc2VkIGluIG9wdGlvbnNcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICAvLyBpbml0aWFsIHNlZWRsaXN0IG9mIHNlcnZlcnMgdG8gY29ubmVjdCB0b1xuICAgICAgICAgICAgc2VlZGxpc3QsXG4gICAgICAgICAgICAvLyBpbml0aWFsIHN0YXRlXG4gICAgICAgICAgICBzdGF0ZTogY29tbW9uXzEuU1RBVEVfQ0xPU0VELFxuICAgICAgICAgICAgLy8gdGhlIHRvcG9sb2d5IGRlc2NyaXB0aW9uXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogbmV3IHRvcG9sb2d5X2Rlc2NyaXB0aW9uXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbih0b3BvbG9neVR5cGUsIHNlcnZlckRlc2NyaXB0aW9ucywgb3B0aW9ucy5yZXBsaWNhU2V0LCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBvcHRpb25zKSxcbiAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogb3B0aW9ucy5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMsXG4gICAgICAgICAgICBoZWFydGJlYXRGcmVxdWVuY3lNUzogb3B0aW9ucy5oZWFydGJlYXRGcmVxdWVuY3lNUyxcbiAgICAgICAgICAgIG1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TOiBvcHRpb25zLm1pbkhlYXJ0YmVhdEZyZXF1ZW5jeU1TLFxuICAgICAgICAgICAgLy8gYSBtYXAgb2Ygc2VydmVyIGluc3RhbmNlcyB0byBub3JtYWxpemVkIGFkZHJlc3Nlc1xuICAgICAgICAgICAgc2VydmVyczogbmV3IE1hcCgpLFxuICAgICAgICAgICAgY3JlZGVudGlhbHM6IG9wdGlvbnM/LmNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgY2x1c3RlclRpbWU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRldGVjdFNoYXJkZWRUb3BvbG9neTogZXYgPT4gdGhpcy5kZXRlY3RTaGFyZGVkVG9wb2xvZ3koZXYpLFxuICAgICAgICAgICAgZGV0ZWN0U3J2UmVjb3JkczogZXYgPT4gdGhpcy5kZXRlY3RTcnZSZWNvcmRzKGV2KVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1vbmdvTG9nZ2VyID0gY2xpZW50Lm1vbmdvTG9nZ2VyO1xuICAgICAgICB0aGlzLmNvbXBvbmVudCA9ICd0b3BvbG9neSc7XG4gICAgICAgIGlmIChvcHRpb25zLnNydkhvc3QgJiYgIW9wdGlvbnMubG9hZEJhbGFuY2VkKSB7XG4gICAgICAgICAgICB0aGlzLnMuc3J2UG9sbGVyID1cbiAgICAgICAgICAgICAgICBvcHRpb25zLnNydlBvbGxlciA/P1xuICAgICAgICAgICAgICAgICAgICBuZXcgc3J2X3BvbGxpbmdfMS5TcnZQb2xsZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMucy5oZWFydGJlYXRGcmVxdWVuY3lNUyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNydkhvc3Q6IG9wdGlvbnMuc3J2SG9zdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNydk1heEhvc3RzOiBvcHRpb25zLnNydk1heEhvc3RzLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3J2U2VydmljZU5hbWU6IG9wdGlvbnMuc3J2U2VydmljZU5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9uKFRvcG9sb2d5LlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQsIHRoaXMucy5kZXRlY3RTaGFyZGVkVG9wb2xvZ3kpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbkxvY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGRldGVjdFNoYXJkZWRUb3BvbG9neShldmVudCkge1xuICAgICAgICBjb25zdCBwcmV2aW91c1R5cGUgPSBldmVudC5wcmV2aW91c0Rlc2NyaXB0aW9uLnR5cGU7XG4gICAgICAgIGNvbnN0IG5ld1R5cGUgPSBldmVudC5uZXdEZXNjcmlwdGlvbi50eXBlO1xuICAgICAgICBjb25zdCB0cmFuc2l0aW9uVG9TaGFyZGVkID0gcHJldmlvdXNUeXBlICE9PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZCAmJiBuZXdUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZDtcbiAgICAgICAgY29uc3Qgc3J2TGlzdGVuZXJzID0gdGhpcy5zLnNydlBvbGxlcj8ubGlzdGVuZXJzKHNydl9wb2xsaW5nXzEuU3J2UG9sbGVyLlNSVl9SRUNPUkRfRElTQ09WRVJZKTtcbiAgICAgICAgY29uc3QgbGlzdGVuaW5nVG9TcnZQb2xsaW5nID0gISFzcnZMaXN0ZW5lcnM/LmluY2x1ZGVzKHRoaXMucy5kZXRlY3RTcnZSZWNvcmRzKTtcbiAgICAgICAgaWYgKHRyYW5zaXRpb25Ub1NoYXJkZWQgJiYgIWxpc3RlbmluZ1RvU3J2UG9sbGluZykge1xuICAgICAgICAgICAgdGhpcy5zLnNydlBvbGxlcj8ub24oc3J2X3BvbGxpbmdfMS5TcnZQb2xsZXIuU1JWX1JFQ09SRF9ESVNDT1ZFUlksIHRoaXMucy5kZXRlY3RTcnZSZWNvcmRzKTtcbiAgICAgICAgICAgIHRoaXMucy5zcnZQb2xsZXI/LnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGV0ZWN0U3J2UmVjb3Jkcyhldikge1xuICAgICAgICBjb25zdCBwcmV2aW91c1RvcG9sb2d5RGVzY3JpcHRpb24gPSB0aGlzLnMuZGVzY3JpcHRpb247XG4gICAgICAgIHRoaXMucy5kZXNjcmlwdGlvbiA9IHRoaXMucy5kZXNjcmlwdGlvbi51cGRhdGVGcm9tU3J2UG9sbGluZ0V2ZW50KGV2LCB0aGlzLnMub3B0aW9ucy5zcnZNYXhIb3N0cyk7XG4gICAgICAgIGlmICh0aGlzLnMuZGVzY3JpcHRpb24gPT09IHByZXZpb3VzVG9wb2xvZ3lEZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgLy8gTm90aGluZyBjaGFuZ2VkLCBzbyByZXR1cm5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVTZXJ2ZXJzKHRoaXMpO1xuICAgICAgICB0aGlzLmVtaXRBbmRMb2coVG9wb2xvZ3kuVE9QT0xPR1lfREVTQ1JJUFRJT05fQ0hBTkdFRCwgbmV3IGV2ZW50c18xLlRvcG9sb2d5RGVzY3JpcHRpb25DaGFuZ2VkRXZlbnQodGhpcy5zLmlkLCBwcmV2aW91c1RvcG9sb2d5RGVzY3JpcHRpb24sIHRoaXMucy5kZXNjcmlwdGlvbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBBIGBUb3BvbG9neURlc2NyaXB0aW9uYCBmb3IgdGhpcyB0b3BvbG9neVxuICAgICAqL1xuICAgIGdldCBkZXNjcmlwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5kZXNjcmlwdGlvbjtcbiAgICB9XG4gICAgZ2V0IGxvYWRCYWxhbmNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLmxvYWRCYWxhbmNlZDtcbiAgICB9XG4gICAgZ2V0IHNlcnZlckFwaSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLnNlcnZlckFwaTtcbiAgICB9XG4gICAgZ2V0IGNhcGFiaWxpdGllcygpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTZXJ2ZXJDYXBhYmlsaXRpZXModGhpcy5sYXN0SGVsbG8oKSk7XG4gICAgfVxuICAgIC8qKiBJbml0aWF0ZSBzZXJ2ZXIgY29ubmVjdCAqL1xuICAgIGFzeW5jIGNvbm5lY3Qob3B0aW9ucykge1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25Mb2NrID8/PSB0aGlzLl9jb25uZWN0KG9wdGlvbnMpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jb25uZWN0aW9uTG9jaztcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uTG9jayA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBfY29ubmVjdChvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICBpZiAodGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DT05ORUNURUQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DT05ORUNUSU5HKTtcbiAgICAgICAgLy8gZW1pdCBTREFNIG1vbml0b3JpbmcgZXZlbnRzXG4gICAgICAgIHRoaXMuZW1pdEFuZExvZyhUb3BvbG9neS5UT1BPTE9HWV9PUEVOSU5HLCBuZXcgZXZlbnRzXzEuVG9wb2xvZ3lPcGVuaW5nRXZlbnQodGhpcy5zLmlkKSk7XG4gICAgICAgIC8vIGVtaXQgYW4gZXZlbnQgZm9yIHRoZSB0b3BvbG9neSBjaGFuZ2VcbiAgICAgICAgdGhpcy5lbWl0QW5kTG9nKFRvcG9sb2d5LlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQsIG5ldyBldmVudHNfMS5Ub3BvbG9neURlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50KHRoaXMucy5pZCwgbmV3IHRvcG9sb2d5X2Rlc2NyaXB0aW9uXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbihjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93biksIC8vIGluaXRpYWwgaXMgYWx3YXlzIFVua25vd25cbiAgICAgICAgdGhpcy5zLmRlc2NyaXB0aW9uKSk7XG4gICAgICAgIC8vIGNvbm5lY3QgYWxsIGtub3duIHNlcnZlcnMsIHRoZW4gYXR0ZW1wdCBzZXJ2ZXIgc2VsZWN0aW9uIHRvIGNvbm5lY3RcbiAgICAgICAgY29uc3Qgc2VydmVyRGVzY3JpcHRpb25zID0gQXJyYXkuZnJvbSh0aGlzLnMuZGVzY3JpcHRpb24uc2VydmVycy52YWx1ZXMoKSk7XG4gICAgICAgIHRoaXMucy5zZXJ2ZXJzID0gbmV3IE1hcChzZXJ2ZXJEZXNjcmlwdGlvbnMubWFwKHNlcnZlckRlc2NyaXB0aW9uID0+IFtcbiAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MsXG4gICAgICAgICAgICBjcmVhdGVBbmRDb25uZWN0U2VydmVyKHRoaXMsIHNlcnZlckRlc2NyaXB0aW9uKVxuICAgICAgICBdKSk7XG4gICAgICAgIC8vIEluIGxvYWQgYmFsYW5jZXIgbW9kZSB3ZSBuZWVkIHRvIGZha2UgYSBzZXJ2ZXIgZGVzY3JpcHRpb24gZ2V0dGluZ1xuICAgICAgICAvLyBlbWl0dGVkIGZyb20gdGhlIG1vbml0b3IsIHNpbmNlIHRoZSBtb25pdG9yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICAgIGlmICh0aGlzLnMub3B0aW9ucy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZGVzY3JpcHRpb24gb2Ygc2VydmVyRGVzY3JpcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RGVzY3JpcHRpb24gPSBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oZGVzY3JpcHRpb24uaG9zdEFkZHJlc3MsIHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgICAgICAgICBsb2FkQmFsYW5jZWQ6IHRoaXMucy5vcHRpb25zLmxvYWRCYWxhbmNlZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmVyVXBkYXRlSGFuZGxlcihuZXdEZXNjcmlwdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TID0gdGhpcy5jbGllbnQucy5vcHRpb25zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUztcbiAgICAgICAgY29uc3QgcmVhZFByZWZlcmVuY2UgPSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlID8/IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnk7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRDb250ZXh0ID0gdGltZW91dF8xLlRpbWVvdXRDb250ZXh0LmNyZWF0ZSh7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtNjQ0OCk6IGF1dG8tY29ubmVjdCBpZ25vcmVzIHRpbWVvdXRNUzsgcG90ZW50aWFsIGZ1dHVyZSBmZWF0dXJlXG4gICAgICAgICAgICB0aW1lb3V0TVM6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyxcbiAgICAgICAgICAgIHdhaXRRdWV1ZVRpbWVvdXRNUzogdGhpcy5jbGllbnQucy5vcHRpb25zLndhaXRRdWV1ZVRpbWVvdXRNU1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc2VsZWN0U2VydmVyT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG9wZXJhdGlvbk5hbWU6ICdwaW5nJyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICB0aW1lb3V0Q29udGV4dFxuICAgICAgICB9O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5zZWxlY3RTZXJ2ZXIoKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yKShyZWFkUHJlZmVyZW5jZSksIHNlbGVjdFNlcnZlck9wdGlvbnMpO1xuICAgICAgICAgICAgY29uc3Qgc2tpcFBpbmdPbkNvbm5lY3QgPSB0aGlzLnMub3B0aW9ucy5fX3NraXBQaW5nT25Db25uZWN0ID09PSB0cnVlO1xuICAgICAgICAgICAgaWYgKCFza2lwUGluZ09uQ29ubmVjdCAmJiB0aGlzLnMuY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzZXJ2ZXIuY29tbWFuZCgoMCwgdXRpbHNfMS5ucykoJ2FkbWluLiRjbWQnKSwgeyBwaW5nOiAxIH0sIHsgdGltZW91dENvbnRleHQgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVUcmFuc2l0aW9uKHRoaXMsIGNvbW1vbl8xLlNUQVRFX0NPTk5FQ1RFRCk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KFRvcG9sb2d5Lk9QRU4sIHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdChUb3BvbG9neS5DT05ORUNULCB0aGlzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YXRlVHJhbnNpdGlvbih0aGlzLCBjb21tb25fMS5TVEFURV9DT05ORUNURUQpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KFRvcG9sb2d5Lk9QRU4sIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KFRvcG9sb2d5LkNPTk5FQ1QsIHRoaXMpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQ2xvc2UgdGhpcyB0b3BvbG9neSAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TRUQgfHwgdGhpcy5zLnN0YXRlID09PSBjb21tb25fMS5TVEFURV9DTE9TSU5HKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBzZXJ2ZXIgb2YgdGhpcy5zLnNlcnZlcnMudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIGRlc3Ryb3lTZXJ2ZXIoc2VydmVyLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnMuc2VydmVycy5jbGVhcigpO1xuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0lORyk7XG4gICAgICAgIGRyYWluV2FpdFF1ZXVlKHRoaXMud2FpdFF1ZXVlLCBuZXcgZXJyb3JfMS5Nb25nb1RvcG9sb2d5Q2xvc2VkRXJyb3IoKSk7XG4gICAgICAgIGlmICh0aGlzLnMuc3J2UG9sbGVyKSB7XG4gICAgICAgICAgICB0aGlzLnMuc3J2UG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMucy5zcnZQb2xsZXIucmVtb3ZlTGlzdGVuZXIoc3J2X3BvbGxpbmdfMS5TcnZQb2xsZXIuU1JWX1JFQ09SRF9ESVNDT1ZFUlksIHRoaXMucy5kZXRlY3RTcnZSZWNvcmRzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKFRvcG9sb2d5LlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQsIHRoaXMucy5kZXRlY3RTaGFyZGVkVG9wb2xvZ3kpO1xuICAgICAgICBzdGF0ZVRyYW5zaXRpb24odGhpcywgY29tbW9uXzEuU1RBVEVfQ0xPU0VEKTtcbiAgICAgICAgLy8gZW1pdCBhbiBldmVudCBmb3IgY2xvc2VcbiAgICAgICAgdGhpcy5lbWl0QW5kTG9nKFRvcG9sb2d5LlRPUE9MT0dZX0NMT1NFRCwgbmV3IGV2ZW50c18xLlRvcG9sb2d5Q2xvc2VkRXZlbnQodGhpcy5zLmlkKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNlbGVjdHMgYSBzZXJ2ZXIgYWNjb3JkaW5nIHRvIHRoZSBzZWxlY3Rpb24gcHJlZGljYXRlIHByb3ZpZGVkXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2VsZWN0b3IgLSBBbiBvcHRpb25hbCBzZWxlY3RvciB0byBzZWxlY3Qgc2VydmVycyBieSwgZGVmYXVsdHMgdG8gYSByYW5kb20gc2VsZWN0aW9uIHdpdGhpbiBhIGxhdGVuY3kgd2luZG93XG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyByZWxhdGVkIHRvIHNlcnZlciBzZWxlY3Rpb25cbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgLSBUaGUgY2FsbGJhY2sgdXNlZCB0byBpbmRpY2F0ZSBzdWNjZXNzIG9yIGZhaWx1cmVcbiAgICAgKiBAcmV0dXJucyBBbiBpbnN0YW5jZSBvZiBhIGBTZXJ2ZXJgIG1lZXRpbmcgdGhlIGNyaXRlcmlhIG9mIHRoZSBwcmVkaWNhdGUgcHJvdmlkZWRcbiAgICAgKi9cbiAgICBhc3luYyBzZWxlY3RTZXJ2ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIHtcbiAgICAgICAgbGV0IHNlcnZlclNlbGVjdG9yO1xuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdG9yID0gKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yKShyZWFkX3ByZWZlcmVuY2VfMS5SZWFkUHJlZmVyZW5jZS5mcm9tU3RyaW5nKHNlbGVjdG9yKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVhZFByZWZlcmVuY2U7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yIGluc3RhbmNlb2YgcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UgPSBzZWxlY3RvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnRyYW5zbGF0ZShvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgcmVhZFByZWZlcmVuY2UgPSBvcHRpb25zLnJlYWRQcmVmZXJlbmNlIHx8IHJlYWRfcHJlZmVyZW5jZV8xLlJlYWRQcmVmZXJlbmNlLnByaW1hcnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdG9yID0gKDAsIHNlcnZlcl9zZWxlY3Rpb25fMS5yZWFkUHJlZmVyZW5jZVNlcnZlclNlbGVjdG9yKShyZWFkUHJlZmVyZW5jZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXJ2ZXJTZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMgPSB7IHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogdGhpcy5zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUywgLi4ub3B0aW9ucyB9O1xuICAgICAgICBpZiAodGhpcy5jbGllbnQubW9uZ29Mb2dnZXI/LndpbGxMb2cobW9uZ29fbG9nZ2VyXzEuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudC5TRVJWRVJfU0VMRUNUSU9OLCBtb25nb19sb2dnZXJfMS5TZXZlcml0eUxldmVsLkRFQlVHKSkge1xuICAgICAgICAgICAgdGhpcy5jbGllbnQubW9uZ29Mb2dnZXI/LmRlYnVnKG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuU0VSVkVSX1NFTEVDVElPTiwgbmV3IHNlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXzEuU2VydmVyU2VsZWN0aW9uU3RhcnRlZEV2ZW50KHNlbGVjdG9yLCB0aGlzLmRlc2NyaXB0aW9uLCBvcHRpb25zLm9wZXJhdGlvbk5hbWUpKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGltZW91dDtcbiAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dENvbnRleHQpXG4gICAgICAgICAgICB0aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0Q29udGV4dC5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0O1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRpbWVvdXQgPSB0aW1lb3V0XzEuVGltZW91dC5leHBpcmVzKG9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TID8/IDApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzU2hhcmRlZCA9IHRoaXMuZGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNoYXJkZWQ7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBvcHRpb25zLnNlc3Npb247XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gc2Vzc2lvbiAmJiBzZXNzaW9uLnRyYW5zYWN0aW9uO1xuICAgICAgICBpZiAoaXNTaGFyZGVkICYmIHRyYW5zYWN0aW9uICYmIHRyYW5zYWN0aW9uLnNlcnZlcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2xpZW50Lm1vbmdvTG9nZ2VyPy53aWxsTG9nKG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuU0VSVkVSX1NFTEVDVElPTiwgbW9uZ29fbG9nZ2VyXzEuU2V2ZXJpdHlMZXZlbC5ERUJVRykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudC5tb25nb0xvZ2dlcj8uZGVidWcobW9uZ29fbG9nZ2VyXzEuTW9uZ29Mb2dnYWJsZUNvbXBvbmVudC5TRVJWRVJfU0VMRUNUSU9OLCBuZXcgc2VydmVyX3NlbGVjdGlvbl9ldmVudHNfMS5TZXJ2ZXJTZWxlY3Rpb25TdWNjZWVkZWRFdmVudChzZWxlY3RvciwgdGhpcy5kZXNjcmlwdGlvbiwgdHJhbnNhY3Rpb24uc2VydmVyLnBvb2wuYWRkcmVzcywgb3B0aW9ucy5vcGVyYXRpb25OYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0Q29udGV4dD8uY2xlYXJTZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0KVxuICAgICAgICAgICAgICAgIHRpbWVvdXQ/LmNsZWFyKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb24uc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgcHJvbWlzZTogc2VydmVyUHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0IH0gPSAoMCwgdXRpbHNfMS5wcm9taXNlV2l0aFJlc29sdmVycykoKTtcbiAgICAgICAgY29uc3Qgd2FpdFF1ZXVlTWVtYmVyID0ge1xuICAgICAgICAgICAgc2VydmVyU2VsZWN0b3IsXG4gICAgICAgICAgICB0b3BvbG9neURlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgbW9uZ29Mb2dnZXI6IHRoaXMuY2xpZW50Lm1vbmdvTG9nZ2VyLFxuICAgICAgICAgICAgdHJhbnNhY3Rpb24sXG4gICAgICAgICAgICByZXNvbHZlLFxuICAgICAgICAgICAgcmVqZWN0LFxuICAgICAgICAgICAgY2FuY2VsbGVkOiBmYWxzZSxcbiAgICAgICAgICAgIHN0YXJ0VGltZTogKDAsIHV0aWxzXzEubm93KSgpLFxuICAgICAgICAgICAgb3BlcmF0aW9uTmFtZTogb3B0aW9ucy5vcGVyYXRpb25OYW1lLFxuICAgICAgICAgICAgd2FpdGluZ0xvZ2dlZDogZmFsc2UsXG4gICAgICAgICAgICBwcmV2aW91c1NlcnZlcjogb3B0aW9ucy5wcmV2aW91c1NlcnZlclxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhYm9ydExpc3RlbmVyID0gKDAsIHV0aWxzXzEuYWRkQWJvcnRMaXN0ZW5lcikob3B0aW9ucy5zaWduYWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5jYW5jZWxsZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmVqZWN0KHRoaXMucmVhc29uKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud2FpdFF1ZXVlLnB1c2god2FpdFF1ZXVlTWVtYmVyKTtcbiAgICAgICAgcHJvY2Vzc1dhaXRRdWV1ZSh0aGlzKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRpbWVvdXQ/LnRocm93SWZFeHBpcmVkKCk7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCAodGltZW91dCA/IFByb21pc2UucmFjZShbc2VydmVyUHJvbWlzZSwgdGltZW91dF0pIDogc2VydmVyUHJvbWlzZSk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKSAmJiBzZXJ2ZXIuZGVzY3JpcHRpb24ubWluUm91bmRUcmlwVGltZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMudGltZW91dENvbnRleHQubWluUm91bmRUcmlwVGltZSA9IHNlcnZlci5kZXNjcmlwdGlvbi5taW5Sb3VuZFRyaXBUaW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICh0aW1lb3V0XzEuVGltZW91dEVycm9yLmlzKGVycm9yKSkge1xuICAgICAgICAgICAgICAgIC8vIFRpbWVvdXRcbiAgICAgICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIuY2FuY2VsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lb3V0RXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlclNlbGVjdGlvbkVycm9yKGBTZXJ2ZXIgc2VsZWN0aW9uIHRpbWVkIG91dCBhZnRlciAke3RpbWVvdXQ/LmR1cmF0aW9ufSBtc2AsIHRoaXMuZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsaWVudC5tb25nb0xvZ2dlcj8ud2lsbExvZyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG1vbmdvX2xvZ2dlcl8xLlNldmVyaXR5TGV2ZWwuREVCVUcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50Lm1vbmdvTG9nZ2VyPy5kZWJ1Zyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG5ldyBzZXJ2ZXJfc2VsZWN0aW9uX2V2ZW50c18xLlNlcnZlclNlbGVjdGlvbkZhaWxlZEV2ZW50KHNlbGVjdG9yLCB0aGlzLmRlc2NyaXB0aW9uLCB0aW1lb3V0RXJyb3IsIG9wdGlvbnMub3BlcmF0aW9uTmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcignVGltZWQgb3V0IGR1cmluZyBzZXJ2ZXIgc2VsZWN0aW9uJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IHRpbWVvdXRFcnJvclxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhyb3cgdGltZW91dEVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gT3RoZXIgc2VydmVyIHNlbGVjdGlvbiBlcnJvclxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBhYm9ydExpc3RlbmVyPy5bdXRpbHNfMS5rRGlzcG9zZV0oKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXRDb250ZXh0Py5jbGVhclNlcnZlclNlbGVjdGlvblRpbWVvdXQpXG4gICAgICAgICAgICAgICAgdGltZW91dD8uY2xlYXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGludGVybmFsIFRvcG9sb2d5RGVzY3JpcHRpb24gd2l0aCBhIFNlcnZlckRlc2NyaXB0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2VydmVyRGVzY3JpcHRpb24gLSBUaGUgc2VydmVyIHRvIHVwZGF0ZSBpbiB0aGUgaW50ZXJuYWwgbGlzdCBvZiBzZXJ2ZXIgZGVzY3JpcHRpb25zXG4gICAgICovXG4gICAgc2VydmVyVXBkYXRlSGFuZGxlcihzZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgICAgICBpZiAoIXRoaXMucy5kZXNjcmlwdGlvbi5oYXNTZXJ2ZXIoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZ25vcmUgdGhpcyBzZXJ2ZXIgdXBkYXRlIGlmIGl0cyBmcm9tIGFuIG91dGRhdGVkIHRvcG9sb2d5VmVyc2lvblxuICAgICAgICBpZiAoaXNTdGFsZVNlcnZlckRlc2NyaXB0aW9uKHRoaXMucy5kZXNjcmlwdGlvbiwgc2VydmVyRGVzY3JpcHRpb24pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhlc2Ugd2lsbCBiZSB1c2VkIGZvciBtb25pdG9yaW5nIGV2ZW50cyBsYXRlclxuICAgICAgICBjb25zdCBwcmV2aW91c1RvcG9sb2d5RGVzY3JpcHRpb24gPSB0aGlzLnMuZGVzY3JpcHRpb247XG4gICAgICAgIGNvbnN0IHByZXZpb3VzU2VydmVyRGVzY3JpcHRpb24gPSB0aGlzLnMuZGVzY3JpcHRpb24uc2VydmVycy5nZXQoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyk7XG4gICAgICAgIGlmICghcHJldmlvdXNTZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIERyaXZlciBTZXNzaW9ucyBTcGVjOiBcIldoZW5ldmVyIGEgZHJpdmVyIHJlY2VpdmVzIGEgY2x1c3RlciB0aW1lIGZyb21cbiAgICAgICAgLy8gYSBzZXJ2ZXIgaXQgTVVTVCBjb21wYXJlIGl0IHRvIHRoZSBjdXJyZW50IGhpZ2hlc3Qgc2VlbiBjbHVzdGVyIHRpbWVcbiAgICAgICAgLy8gZm9yIHRoZSBkZXBsb3ltZW50LiBJZiB0aGUgbmV3IGNsdXN0ZXIgdGltZSBpcyBoaWdoZXIgdGhhbiB0aGVcbiAgICAgICAgLy8gaGlnaGVzdCBzZWVuIGNsdXN0ZXIgdGltZSBpdCBNVVNUIGJlY29tZSB0aGUgbmV3IGhpZ2hlc3Qgc2VlbiBjbHVzdGVyXG4gICAgICAgIC8vIHRpbWUuIFR3byBjbHVzdGVyIHRpbWVzIGFyZSBjb21wYXJlZCB1c2luZyBvbmx5IHRoZSBCc29uVGltZXN0YW1wXG4gICAgICAgIC8vIHZhbHVlIG9mIHRoZSBjbHVzdGVyVGltZSBlbWJlZGRlZCBmaWVsZC5cIlxuICAgICAgICBjb25zdCBjbHVzdGVyVGltZSA9IHNlcnZlckRlc2NyaXB0aW9uLiRjbHVzdGVyVGltZTtcbiAgICAgICAgaWYgKGNsdXN0ZXJUaW1lKSB7XG4gICAgICAgICAgICAoMCwgY29tbW9uXzEuX2FkdmFuY2VDbHVzdGVyVGltZSkodGhpcywgY2x1c3RlclRpbWUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGFscmVhZHkga25vdyBhbGwgdGhlIGluZm9ybWF0aW9uIGNvbnRhaW5lZCBpbiB0aGlzIHVwZGF0ZWQgZGVzY3JpcHRpb24sIHRoZW5cbiAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0byBlbWl0IFNEQU0gZXZlbnRzLCBidXQgc3RpbGwgbmVlZCB0byB1cGRhdGUgdGhlIGRlc2NyaXB0aW9uLCBpbiBvcmRlclxuICAgICAgICAvLyB0byBrZWVwIGNsaWVudC10cmFja2VkIGF0dHJpYnV0ZXMgbGlrZSBsYXN0IHVwZGF0ZSB0aW1lIGFuZCByb3VuZCB0cmlwIHRpbWUgdXAgdG8gZGF0ZVxuICAgICAgICBjb25zdCBlcXVhbERlc2NyaXB0aW9ucyA9IHByZXZpb3VzU2VydmVyRGVzY3JpcHRpb24gJiYgcHJldmlvdXNTZXJ2ZXJEZXNjcmlwdGlvbi5lcXVhbHMoc2VydmVyRGVzY3JpcHRpb24pO1xuICAgICAgICAvLyBmaXJzdCB1cGRhdGUgdGhlIFRvcG9sb2d5RGVzY3JpcHRpb25cbiAgICAgICAgdGhpcy5zLmRlc2NyaXB0aW9uID0gdGhpcy5zLmRlc2NyaXB0aW9uLnVwZGF0ZShzZXJ2ZXJEZXNjcmlwdGlvbik7XG4gICAgICAgIGlmICh0aGlzLnMuZGVzY3JpcHRpb24uY29tcGF0aWJpbGl0eUVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoVG9wb2xvZ3kuRVJST1IsIG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKHRoaXMucy5kZXNjcmlwdGlvbi5jb21wYXRpYmlsaXR5RXJyb3IpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBlbWl0IG1vbml0b3JpbmcgZXZlbnRzIGZvciB0aGlzIGNoYW5nZVxuICAgICAgICBpZiAoIWVxdWFsRGVzY3JpcHRpb25zKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdEZXNjcmlwdGlvbiA9IHRoaXMucy5kZXNjcmlwdGlvbi5zZXJ2ZXJzLmdldChzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICAgICAgICAgIGlmIChuZXdEZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdChUb3BvbG9neS5TRVJWRVJfREVTQ1JJUFRJT05fQ0hBTkdFRCwgbmV3IGV2ZW50c18xLlNlcnZlckRlc2NyaXB0aW9uQ2hhbmdlZEV2ZW50KHRoaXMucy5pZCwgc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcywgcHJldmlvdXNTZXJ2ZXJEZXNjcmlwdGlvbiwgbmV3RGVzY3JpcHRpb24pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgc2VydmVyIGxpc3QgZnJvbSB1cGRhdGVkIGRlc2NyaXB0aW9uc1xuICAgICAgICB1cGRhdGVTZXJ2ZXJzKHRoaXMsIHNlcnZlckRlc2NyaXB0aW9uKTtcbiAgICAgICAgLy8gYXR0ZW1wdCB0byByZXNvbHZlIGFueSBvdXRzdGFuZGluZyBzZXJ2ZXIgc2VsZWN0aW9uIGF0dGVtcHRzXG4gICAgICAgIGlmICh0aGlzLndhaXRRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBwcm9jZXNzV2FpdFF1ZXVlKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZXF1YWxEZXNjcmlwdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdEFuZExvZyhUb3BvbG9neS5UT1BPTE9HWV9ERVNDUklQVElPTl9DSEFOR0VELCBuZXcgZXZlbnRzXzEuVG9wb2xvZ3lEZXNjcmlwdGlvbkNoYW5nZWRFdmVudCh0aGlzLnMuaWQsIHByZXZpb3VzVG9wb2xvZ3lEZXNjcmlwdGlvbiwgdGhpcy5zLmRlc2NyaXB0aW9uKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXV0aChjcmVkZW50aWFscywgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjcmVkZW50aWFscyA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgIChjYWxsYmFjayA9IGNyZWRlbnRpYWxzKSwgKGNyZWRlbnRpYWxzID0gdW5kZWZpbmVkKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgfVxuICAgIGdldCBjbGllbnRNZXRhZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5vcHRpb25zLm1ldGFkYXRhO1xuICAgIH1cbiAgICBpc0Nvbm5lY3RlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ09OTkVDVEVEO1xuICAgIH1cbiAgICBpc0Rlc3Ryb3llZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucy5zdGF0ZSA9PT0gY29tbW9uXzEuU1RBVEVfQ0xPU0VEO1xuICAgIH1cbiAgICAvLyBOT1RFOiBUaGVyZSBhcmUgbWFueSBwbGFjZXMgaW4gY29kZSB3aGVyZSB3ZSBleHBsaWNpdGx5IGNoZWNrIHRoZSBsYXN0IGhlbGxvXG4gICAgLy8gICAgICAgdG8gZG8gZmVhdHVyZSBzdXBwb3J0IGRldGVjdGlvbi4gVGhpcyBzaG91bGQgYmUgZG9uZSBhbnkgb3RoZXIgd2F5LCBidXQgZm9yXG4gICAgLy8gICAgICAgbm93IHdlIHdpbGwganVzdCByZXR1cm4gdGhlIGZpcnN0IGhlbGxvIHNlZW4sIHdoaWNoIHNob3VsZCBzdWZmaWNlLlxuICAgIGxhc3RIZWxsbygpIHtcbiAgICAgICAgY29uc3Qgc2VydmVyRGVzY3JpcHRpb25zID0gQXJyYXkuZnJvbSh0aGlzLmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb25zLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgY29uc3Qgc2QgPSBzZXJ2ZXJEZXNjcmlwdGlvbnMuZmlsdGVyKChzZCkgPT4gc2QudHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duKVswXTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2QgfHwgeyBtYXhXaXJlVmVyc2lvbjogdGhpcy5kZXNjcmlwdGlvbi5jb21tb25XaXJlVmVyc2lvbiB9O1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBnZXQgY29tbW9uV2lyZVZlcnNpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlc2NyaXB0aW9uLmNvbW1vbldpcmVWZXJzaW9uO1xuICAgIH1cbiAgICBnZXQgbG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcztcbiAgICB9XG4gICAgZ2V0IGNsdXN0ZXJUaW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zLmNsdXN0ZXJUaW1lO1xuICAgIH1cbiAgICBzZXQgY2x1c3RlclRpbWUoY2x1c3RlclRpbWUpIHtcbiAgICAgICAgdGhpcy5zLmNsdXN0ZXJUaW1lID0gY2x1c3RlclRpbWU7XG4gICAgfVxufVxuZXhwb3J0cy5Ub3BvbG9neSA9IFRvcG9sb2d5O1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuU0VSVkVSX09QRU5JTkcgPSBjb25zdGFudHNfMS5TRVJWRVJfT1BFTklORztcbi8qKiBAZXZlbnQgKi9cblRvcG9sb2d5LlNFUlZFUl9DTE9TRUQgPSBjb25zdGFudHNfMS5TRVJWRVJfQ0xPU0VEO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuU0VSVkVSX0RFU0NSSVBUSU9OX0NIQU5HRUQgPSBjb25zdGFudHNfMS5TRVJWRVJfREVTQ1JJUFRJT05fQ0hBTkdFRDtcbi8qKiBAZXZlbnQgKi9cblRvcG9sb2d5LlRPUE9MT0dZX09QRU5JTkcgPSBjb25zdGFudHNfMS5UT1BPTE9HWV9PUEVOSU5HO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuVE9QT0xPR1lfQ0xPU0VEID0gY29uc3RhbnRzXzEuVE9QT0xPR1lfQ0xPU0VEO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuVE9QT0xPR1lfREVTQ1JJUFRJT05fQ0hBTkdFRCA9IGNvbnN0YW50c18xLlRPUE9MT0dZX0RFU0NSSVBUSU9OX0NIQU5HRUQ7XG4vKiogQGV2ZW50ICovXG5Ub3BvbG9neS5FUlJPUiA9IGNvbnN0YW50c18xLkVSUk9SO1xuLyoqIEBldmVudCAqL1xuVG9wb2xvZ3kuT1BFTiA9IGNvbnN0YW50c18xLk9QRU47XG4vKiogQGV2ZW50ICovXG5Ub3BvbG9neS5DT05ORUNUID0gY29uc3RhbnRzXzEuQ09OTkVDVDtcbi8qKiBAZXZlbnQgKi9cblRvcG9sb2d5LkNMT1NFID0gY29uc3RhbnRzXzEuQ0xPU0U7XG4vKiogQGV2ZW50ICovXG5Ub3BvbG9neS5USU1FT1VUID0gY29uc3RhbnRzXzEuVElNRU9VVDtcbi8qKiBEZXN0cm95cyBhIHNlcnZlciwgYW5kIHJlbW92ZXMgYWxsIGV2ZW50IGxpc3RlbmVycyBmcm9tIHRoZSBpbnN0YW5jZSAqL1xuZnVuY3Rpb24gZGVzdHJveVNlcnZlcihzZXJ2ZXIsIHRvcG9sb2d5KSB7XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBjb25zdGFudHNfMS5MT0NBTF9TRVJWRVJfRVZFTlRTKSB7XG4gICAgICAgIHNlcnZlci5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpO1xuICAgIH1cbiAgICBzZXJ2ZXIuZGVzdHJveSgpO1xuICAgIHRvcG9sb2d5LmVtaXRBbmRMb2coVG9wb2xvZ3kuU0VSVkVSX0NMT1NFRCwgbmV3IGV2ZW50c18xLlNlcnZlckNsb3NlZEV2ZW50KHRvcG9sb2d5LnMuaWQsIHNlcnZlci5kZXNjcmlwdGlvbi5hZGRyZXNzKSk7XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBjb25zdGFudHNfMS5TRVJWRVJfUkVMQVlfRVZFTlRTKSB7XG4gICAgICAgIHNlcnZlci5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpO1xuICAgIH1cbn1cbi8qKiBQcmVkaWN0cyB0aGUgVG9wb2xvZ3lUeXBlIGZyb20gb3B0aW9ucyAqL1xuZnVuY3Rpb24gdG9wb2xvZ3lUeXBlRnJvbU9wdGlvbnMob3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zPy5kaXJlY3RDb25uZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2luZ2xlO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucz8ucmVwbGljYVNldCkge1xuICAgICAgICByZXR1cm4gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlJlcGxpY2FTZXROb1ByaW1hcnk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zPy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5Mb2FkQmFsYW5jZWQ7XG4gICAgfVxuICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93bjtcbn1cbi8qKlxuICogQ3JlYXRlcyBuZXcgc2VydmVyIGluc3RhbmNlcyBhbmQgYXR0ZW1wdHMgdG8gY29ubmVjdCB0aGVtXG4gKlxuICogQHBhcmFtIHRvcG9sb2d5IC0gVGhlIHRvcG9sb2d5IHRoYXQgdGhpcyBzZXJ2ZXIgYmVsb25ncyB0b1xuICogQHBhcmFtIHNlcnZlckRlc2NyaXB0aW9uIC0gVGhlIGRlc2NyaXB0aW9uIGZvciB0aGUgc2VydmVyIHRvIGluaXRpYWxpemUgYW5kIGNvbm5lY3QgdG9cbiAqL1xuZnVuY3Rpb24gY3JlYXRlQW5kQ29ubmVjdFNlcnZlcih0b3BvbG9neSwgc2VydmVyRGVzY3JpcHRpb24pIHtcbiAgICB0b3BvbG9neS5lbWl0QW5kTG9nKFRvcG9sb2d5LlNFUlZFUl9PUEVOSU5HLCBuZXcgZXZlbnRzXzEuU2VydmVyT3BlbmluZ0V2ZW50KHRvcG9sb2d5LnMuaWQsIHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpKTtcbiAgICBjb25zdCBzZXJ2ZXIgPSBuZXcgc2VydmVyXzEuU2VydmVyKHRvcG9sb2d5LCBzZXJ2ZXJEZXNjcmlwdGlvbiwgdG9wb2xvZ3kucy5vcHRpb25zKTtcbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGNvbnN0YW50c18xLlNFUlZFUl9SRUxBWV9FVkVOVFMpIHtcbiAgICAgICAgc2VydmVyLm9uKGV2ZW50LCAoZSkgPT4gdG9wb2xvZ3kuZW1pdChldmVudCwgZSkpO1xuICAgIH1cbiAgICBzZXJ2ZXIub24oc2VydmVyXzEuU2VydmVyLkRFU0NSSVBUSU9OX1JFQ0VJVkVELCBkZXNjcmlwdGlvbiA9PiB0b3BvbG9neS5zZXJ2ZXJVcGRhdGVIYW5kbGVyKGRlc2NyaXB0aW9uKSk7XG4gICAgc2VydmVyLmNvbm5lY3QoKTtcbiAgICByZXR1cm4gc2VydmVyO1xufVxuLyoqXG4gKiBAcGFyYW0gdG9wb2xvZ3kgLSBUb3BvbG9neSB0byB1cGRhdGUuXG4gKiBAcGFyYW0gaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbiAtIE5ldyBzZXJ2ZXIgZGVzY3JpcHRpb24uXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZVNlcnZlcnModG9wb2xvZ3ksIGluY29taW5nU2VydmVyRGVzY3JpcHRpb24pIHtcbiAgICAvLyB1cGRhdGUgdGhlIGludGVybmFsIHNlcnZlcidzIGRlc2NyaXB0aW9uXG4gICAgaWYgKGluY29taW5nU2VydmVyRGVzY3JpcHRpb24gJiYgdG9wb2xvZ3kucy5zZXJ2ZXJzLmhhcyhpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpKSB7XG4gICAgICAgIGNvbnN0IHNlcnZlciA9IHRvcG9sb2d5LnMuc2VydmVycy5nZXQoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICAgICAgaWYgKHNlcnZlcikge1xuICAgICAgICAgICAgc2VydmVyLnMuZGVzY3JpcHRpb24gPSBpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgaWYgKGluY29taW5nU2VydmVyRGVzY3JpcHRpb24uZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IgJiZcbiAgICAgICAgICAgICAgICBpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uLmVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuUmVzZXRQb29sKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGludGVycnVwdEluVXNlQ29ubmVjdGlvbnMgPSBpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uLmVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuSW50ZXJydXB0SW5Vc2VDb25uZWN0aW9ucyk7XG4gICAgICAgICAgICAgICAgc2VydmVyLnBvb2wuY2xlYXIoeyBpbnRlcnJ1cHRJblVzZUNvbm5lY3Rpb25zIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi5lcnJvciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VG9wb2xvZ3lUeXBlID0gdG9wb2xvZ3kucy5kZXNjcmlwdGlvbi50eXBlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNob3VsZE1hcmtQb29sUmVhZHkgPSBpbmNvbWluZ1NlcnZlckRlc2NyaXB0aW9uLmlzRGF0YUJlYXJpbmcgfHxcbiAgICAgICAgICAgICAgICAgICAgKGluY29taW5nU2VydmVyRGVzY3JpcHRpb24udHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdUb3BvbG9neVR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGUpO1xuICAgICAgICAgICAgICAgIGlmIChzaG91bGRNYXJrUG9vbFJlYWR5KSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlci5wb29sLnJlYWR5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGFkZCBuZXcgc2VydmVycyBmb3IgYWxsIGRlc2NyaXB0aW9ucyB3ZSBjdXJyZW50bHkgZG9uJ3Qga25vdyBhYm91dCBsb2NhbGx5XG4gICAgZm9yIChjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbiBvZiB0b3BvbG9neS5kZXNjcmlwdGlvbi5zZXJ2ZXJzLnZhbHVlcygpKSB7XG4gICAgICAgIGlmICghdG9wb2xvZ3kucy5zZXJ2ZXJzLmhhcyhzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKSkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyID0gY3JlYXRlQW5kQ29ubmVjdFNlcnZlcih0b3BvbG9neSwgc2VydmVyRGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgdG9wb2xvZ3kucy5zZXJ2ZXJzLnNldChzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzLCBzZXJ2ZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGZvciBhbGwgc2VydmVycyBubyBsb25nZXIga25vd24sIHJlbW92ZSB0aGVpciBkZXNjcmlwdGlvbnMgYW5kIGRlc3Ryb3kgdGhlaXIgaW5zdGFuY2VzXG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0b3BvbG9neS5zLnNlcnZlcnMpIHtcbiAgICAgICAgY29uc3Qgc2VydmVyQWRkcmVzcyA9IGVudHJ5WzBdO1xuICAgICAgICBpZiAodG9wb2xvZ3kuZGVzY3JpcHRpb24uaGFzU2VydmVyKHNlcnZlckFkZHJlc3MpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRvcG9sb2d5LnMuc2VydmVycy5oYXMoc2VydmVyQWRkcmVzcykpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlcnZlciA9IHRvcG9sb2d5LnMuc2VydmVycy5nZXQoc2VydmVyQWRkcmVzcyk7XG4gICAgICAgIHRvcG9sb2d5LnMuc2VydmVycy5kZWxldGUoc2VydmVyQWRkcmVzcyk7XG4gICAgICAgIC8vIHByZXBhcmUgc2VydmVyIGZvciBnYXJiYWdlIGNvbGxlY3Rpb25cbiAgICAgICAgaWYgKHNlcnZlcikge1xuICAgICAgICAgICAgZGVzdHJveVNlcnZlcihzZXJ2ZXIsIHRvcG9sb2d5KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGRyYWluV2FpdFF1ZXVlKHF1ZXVlLCBkcmFpbkVycm9yKSB7XG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBjb25zdCB3YWl0UXVldWVNZW1iZXIgPSBxdWV1ZS5zaGlmdCgpO1xuICAgICAgICBpZiAoIXdhaXRRdWV1ZU1lbWJlcikge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF3YWl0UXVldWVNZW1iZXIuY2FuY2VsbGVkKSB7XG4gICAgICAgICAgICBpZiAod2FpdFF1ZXVlTWVtYmVyLm1vbmdvTG9nZ2VyPy53aWxsTG9nKG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuU0VSVkVSX1NFTEVDVElPTiwgbW9uZ29fbG9nZ2VyXzEuU2V2ZXJpdHlMZXZlbC5ERUJVRykpIHtcbiAgICAgICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIubW9uZ29Mb2dnZXI/LmRlYnVnKG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuU0VSVkVSX1NFTEVDVElPTiwgbmV3IHNlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXzEuU2VydmVyU2VsZWN0aW9uRmFpbGVkRXZlbnQod2FpdFF1ZXVlTWVtYmVyLnNlcnZlclNlbGVjdG9yLCB3YWl0UXVldWVNZW1iZXIudG9wb2xvZ3lEZXNjcmlwdGlvbiwgZHJhaW5FcnJvciwgd2FpdFF1ZXVlTWVtYmVyLm9wZXJhdGlvbk5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci5yZWplY3QoZHJhaW5FcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBwcm9jZXNzV2FpdFF1ZXVlKHRvcG9sb2d5KSB7XG4gICAgaWYgKHRvcG9sb2d5LnMuc3RhdGUgPT09IGNvbW1vbl8xLlNUQVRFX0NMT1NFRCkge1xuICAgICAgICBkcmFpbldhaXRRdWV1ZSh0b3BvbG9neS53YWl0UXVldWUsIG5ldyBlcnJvcl8xLk1vbmdvVG9wb2xvZ3lDbG9zZWRFcnJvcigpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpc1NoYXJkZWQgPSB0b3BvbG9neS5kZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2hhcmRlZDtcbiAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBBcnJheS5mcm9tKHRvcG9sb2d5LmRlc2NyaXB0aW9uLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgIGNvbnN0IG1lbWJlcnNUb1Byb2Nlc3MgPSB0b3BvbG9neS53YWl0UXVldWUubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWVtYmVyc1RvUHJvY2VzczsgKytpKSB7XG4gICAgICAgIGNvbnN0IHdhaXRRdWV1ZU1lbWJlciA9IHRvcG9sb2d5LndhaXRRdWV1ZS5zaGlmdCgpO1xuICAgICAgICBpZiAoIXdhaXRRdWV1ZU1lbWJlcikge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdhaXRRdWV1ZU1lbWJlci5jYW5jZWxsZWQpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzZWxlY3RlZERlc2NyaXB0aW9ucztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlclNlbGVjdG9yID0gd2FpdFF1ZXVlTWVtYmVyLnNlcnZlclNlbGVjdG9yO1xuICAgICAgICAgICAgY29uc3QgcHJldmlvdXNTZXJ2ZXIgPSB3YWl0UXVldWVNZW1iZXIucHJldmlvdXNTZXJ2ZXI7XG4gICAgICAgICAgICBzZWxlY3RlZERlc2NyaXB0aW9ucyA9IHNlcnZlclNlbGVjdG9yXG4gICAgICAgICAgICAgICAgPyBzZXJ2ZXJTZWxlY3Rvcih0b3BvbG9neS5kZXNjcmlwdGlvbiwgc2VydmVyRGVzY3JpcHRpb25zLCBwcmV2aW91c1NlcnZlciA/IFtwcmV2aW91c1NlcnZlcl0gOiBbXSlcbiAgICAgICAgICAgICAgICA6IHNlcnZlckRlc2NyaXB0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoc2VsZWN0b3JFcnJvcikge1xuICAgICAgICAgICAgaWYgKHRvcG9sb2d5LmNsaWVudC5tb25nb0xvZ2dlcj8ud2lsbExvZyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG1vbmdvX2xvZ2dlcl8xLlNldmVyaXR5TGV2ZWwuREVCVUcpKSB7XG4gICAgICAgICAgICAgICAgdG9wb2xvZ3kuY2xpZW50Lm1vbmdvTG9nZ2VyPy5kZWJ1Zyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG5ldyBzZXJ2ZXJfc2VsZWN0aW9uX2V2ZW50c18xLlNlcnZlclNlbGVjdGlvbkZhaWxlZEV2ZW50KHdhaXRRdWV1ZU1lbWJlci5zZXJ2ZXJTZWxlY3RvciwgdG9wb2xvZ3kuZGVzY3JpcHRpb24sIHNlbGVjdG9yRXJyb3IsIHdhaXRRdWV1ZU1lbWJlci5vcGVyYXRpb25OYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3YWl0UXVldWVNZW1iZXIucmVqZWN0KHNlbGVjdG9yRXJyb3IpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNlbGVjdGVkU2VydmVyO1xuICAgICAgICBpZiAoc2VsZWN0ZWREZXNjcmlwdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBpZiAoIXdhaXRRdWV1ZU1lbWJlci53YWl0aW5nTG9nZ2VkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRvcG9sb2d5LmNsaWVudC5tb25nb0xvZ2dlcj8ud2lsbExvZyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG1vbmdvX2xvZ2dlcl8xLlNldmVyaXR5TGV2ZWwuSU5GT1JNQVRJT05BTCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9wb2xvZ3kuY2xpZW50Lm1vbmdvTG9nZ2VyPy5pbmZvKG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuU0VSVkVSX1NFTEVDVElPTiwgbmV3IHNlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXzEuV2FpdGluZ0ZvclN1aXRhYmxlU2VydmVyRXZlbnQod2FpdFF1ZXVlTWVtYmVyLnNlcnZlclNlbGVjdG9yLCB0b3BvbG9neS5kZXNjcmlwdGlvbiwgdG9wb2xvZ3kucy5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMgIT09IDBcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdG9wb2xvZ3kucy5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMgLSAoKDAsIHV0aWxzXzEubm93KSgpIC0gd2FpdFF1ZXVlTWVtYmVyLnN0YXJ0VGltZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogLTEsIHdhaXRRdWV1ZU1lbWJlci5vcGVyYXRpb25OYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdhaXRRdWV1ZU1lbWJlci53YWl0aW5nTG9nZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRvcG9sb2d5LndhaXRRdWV1ZS5wdXNoKHdhaXRRdWV1ZU1lbWJlcik7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzZWxlY3RlZERlc2NyaXB0aW9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkU2VydmVyID0gdG9wb2xvZ3kucy5zZXJ2ZXJzLmdldChzZWxlY3RlZERlc2NyaXB0aW9uc1swXS5hZGRyZXNzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9ucyA9ICgwLCB1dGlsc18xLnNodWZmbGUpKHNlbGVjdGVkRGVzY3JpcHRpb25zLCAyKTtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlcjEgPSB0b3BvbG9neS5zLnNlcnZlcnMuZ2V0KGRlc2NyaXB0aW9uc1swXS5hZGRyZXNzKTtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlcjIgPSB0b3BvbG9neS5zLnNlcnZlcnMuZ2V0KGRlc2NyaXB0aW9uc1sxXS5hZGRyZXNzKTtcbiAgICAgICAgICAgIHNlbGVjdGVkU2VydmVyID1cbiAgICAgICAgICAgICAgICBzZXJ2ZXIxICYmIHNlcnZlcjIgJiYgc2VydmVyMS5zLm9wZXJhdGlvbkNvdW50IDwgc2VydmVyMi5zLm9wZXJhdGlvbkNvdW50XG4gICAgICAgICAgICAgICAgICAgID8gc2VydmVyMVxuICAgICAgICAgICAgICAgICAgICA6IHNlcnZlcjI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzZWxlY3RlZFNlcnZlcikge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyU2VsZWN0aW9uRXJyb3IgPSBuZXcgZXJyb3JfMS5Nb25nb1NlcnZlclNlbGVjdGlvbkVycm9yKCdzZXJ2ZXIgc2VsZWN0aW9uIHJldHVybmVkIGEgc2VydmVyIGRlc2NyaXB0aW9uIGJ1dCB0aGUgc2VydmVyIHdhcyBub3QgZm91bmQgaW4gdGhlIHRvcG9sb2d5JywgdG9wb2xvZ3kuZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgaWYgKHRvcG9sb2d5LmNsaWVudC5tb25nb0xvZ2dlcj8ud2lsbExvZyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG1vbmdvX2xvZ2dlcl8xLlNldmVyaXR5TGV2ZWwuREVCVUcpKSB7XG4gICAgICAgICAgICAgICAgdG9wb2xvZ3kuY2xpZW50Lm1vbmdvTG9nZ2VyPy5kZWJ1Zyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG5ldyBzZXJ2ZXJfc2VsZWN0aW9uX2V2ZW50c18xLlNlcnZlclNlbGVjdGlvbkZhaWxlZEV2ZW50KHdhaXRRdWV1ZU1lbWJlci5zZXJ2ZXJTZWxlY3RvciwgdG9wb2xvZ3kuZGVzY3JpcHRpb24sIHNlcnZlclNlbGVjdGlvbkVycm9yLCB3YWl0UXVldWVNZW1iZXIub3BlcmF0aW9uTmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2FpdFF1ZXVlTWVtYmVyLnJlamVjdChzZXJ2ZXJTZWxlY3Rpb25FcnJvcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB3YWl0UXVldWVNZW1iZXIudHJhbnNhY3Rpb247XG4gICAgICAgIGlmIChpc1NoYXJkZWQgJiYgdHJhbnNhY3Rpb24gJiYgdHJhbnNhY3Rpb24uaXNBY3RpdmUgJiYgc2VsZWN0ZWRTZXJ2ZXIpIHtcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uLnBpblNlcnZlcihzZWxlY3RlZFNlcnZlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvcG9sb2d5LmNsaWVudC5tb25nb0xvZ2dlcj8ud2lsbExvZyhtb25nb19sb2dnZXJfMS5Nb25nb0xvZ2dhYmxlQ29tcG9uZW50LlNFUlZFUl9TRUxFQ1RJT04sIG1vbmdvX2xvZ2dlcl8xLlNldmVyaXR5TGV2ZWwuREVCVUcpKSB7XG4gICAgICAgICAgICB0b3BvbG9neS5jbGllbnQubW9uZ29Mb2dnZXI/LmRlYnVnKG1vbmdvX2xvZ2dlcl8xLk1vbmdvTG9nZ2FibGVDb21wb25lbnQuU0VSVkVSX1NFTEVDVElPTiwgbmV3IHNlcnZlcl9zZWxlY3Rpb25fZXZlbnRzXzEuU2VydmVyU2VsZWN0aW9uU3VjY2VlZGVkRXZlbnQod2FpdFF1ZXVlTWVtYmVyLnNlcnZlclNlbGVjdG9yLCB3YWl0UXVldWVNZW1iZXIudG9wb2xvZ3lEZXNjcmlwdGlvbiwgc2VsZWN0ZWRTZXJ2ZXIucG9vbC5hZGRyZXNzLCB3YWl0UXVldWVNZW1iZXIub3BlcmF0aW9uTmFtZSkpO1xuICAgICAgICB9XG4gICAgICAgIHdhaXRRdWV1ZU1lbWJlci5yZXNvbHZlKHNlbGVjdGVkU2VydmVyKTtcbiAgICB9XG4gICAgaWYgKHRvcG9sb2d5LndhaXRRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIGVuc3VyZSBhbGwgc2VydmVyIG1vbml0b3JzIGF0dGVtcHQgbW9uaXRvcmluZyBzb29uXG4gICAgICAgIGZvciAoY29uc3QgWywgc2VydmVyXSBvZiB0b3BvbG9neS5zLnNlcnZlcnMpIHtcbiAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24gc2NoZWR1bGVTZXJ2ZXJDaGVjaygpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyLnJlcXVlc3RDaGVjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBpc1N0YWxlU2VydmVyRGVzY3JpcHRpb24odG9wb2xvZ3lEZXNjcmlwdGlvbiwgaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgIGNvbnN0IGN1cnJlbnRTZXJ2ZXJEZXNjcmlwdGlvbiA9IHRvcG9sb2d5RGVzY3JpcHRpb24uc2VydmVycy5nZXQoaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICBjb25zdCBjdXJyZW50VG9wb2xvZ3lWZXJzaW9uID0gY3VycmVudFNlcnZlckRlc2NyaXB0aW9uPy50b3BvbG9neVZlcnNpb247XG4gICAgcmV0dXJuICgoMCwgc2VydmVyX2Rlc2NyaXB0aW9uXzEuY29tcGFyZVRvcG9sb2d5VmVyc2lvbikoY3VycmVudFRvcG9sb2d5VmVyc2lvbiwgaW5jb21pbmdTZXJ2ZXJEZXNjcmlwdGlvbi50b3BvbG9neVZlcnNpb24pID4gMCk7XG59XG4vKiogQHB1YmxpYyAqL1xuY2xhc3MgU2VydmVyQ2FwYWJpbGl0aWVzIHtcbiAgICBjb25zdHJ1Y3RvcihoZWxsbykge1xuICAgICAgICB0aGlzLm1pbldpcmVWZXJzaW9uID0gaGVsbG8ubWluV2lyZVZlcnNpb24gfHwgMDtcbiAgICAgICAgdGhpcy5tYXhXaXJlVmVyc2lvbiA9IGhlbGxvLm1heFdpcmVWZXJzaW9uIHx8IDA7XG4gICAgfVxuICAgIGdldCBoYXNBZ2dyZWdhdGlvbkN1cnNvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMTtcbiAgICB9XG4gICAgZ2V0IGhhc1dyaXRlQ29tbWFuZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heFdpcmVWZXJzaW9uID49IDI7XG4gICAgfVxuICAgIGdldCBoYXNUZXh0U2VhcmNoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taW5XaXJlVmVyc2lvbiA+PSAwO1xuICAgIH1cbiAgICBnZXQgaGFzQXV0aENvbW1hbmRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXhXaXJlVmVyc2lvbiA+PSAxO1xuICAgIH1cbiAgICBnZXQgaGFzTGlzdENvbGxlY3Rpb25zQ29tbWFuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMztcbiAgICB9XG4gICAgZ2V0IGhhc0xpc3RJbmRleGVzQ29tbWFuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMztcbiAgICB9XG4gICAgZ2V0IHN1cHBvcnRzU25hcHNob3RSZWFkcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4V2lyZVZlcnNpb24gPj0gMTM7XG4gICAgfVxuICAgIGdldCBjb21tYW5kc1Rha2VXcml0ZUNvbmNlcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heFdpcmVWZXJzaW9uID49IDU7XG4gICAgfVxuICAgIGdldCBjb21tYW5kc1Rha2VDb2xsYXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heFdpcmVWZXJzaW9uID49IDU7XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJDYXBhYmlsaXRpZXMgPSBTZXJ2ZXJDYXBhYmlsaXRpZXM7XG4vLyMgc291cmNlTWFwcGluZ1VSTD10b3BvbG9neS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology_description.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology_description.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TopologyDescription = void 0;\nconst bson_1 = __webpack_require__(/*! ../bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst WIRE_CONSTANTS = __webpack_require__(/*! ../cmap/wire_protocol/constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst error_1 = __webpack_require__(/*! ../error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ../utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst common_1 = __webpack_require__(/*! ./common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst server_description_1 = __webpack_require__(/*! ./server_description */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/server_description.js\");\n// constants related to compatibility checks\nconst MIN_SUPPORTED_SERVER_VERSION = WIRE_CONSTANTS.MIN_SUPPORTED_SERVER_VERSION;\nconst MAX_SUPPORTED_SERVER_VERSION = WIRE_CONSTANTS.MAX_SUPPORTED_SERVER_VERSION;\nconst MIN_SUPPORTED_WIRE_VERSION = WIRE_CONSTANTS.MIN_SUPPORTED_WIRE_VERSION;\nconst MAX_SUPPORTED_WIRE_VERSION = WIRE_CONSTANTS.MAX_SUPPORTED_WIRE_VERSION;\nconst MONGOS_OR_UNKNOWN = new Set([common_1.ServerType.Mongos, common_1.ServerType.Unknown]);\nconst MONGOS_OR_STANDALONE = new Set([common_1.ServerType.Mongos, common_1.ServerType.Standalone]);\nconst NON_PRIMARY_RS_MEMBERS = new Set([\n    common_1.ServerType.RSSecondary,\n    common_1.ServerType.RSArbiter,\n    common_1.ServerType.RSOther\n]);\n/**\n * Representation of a deployment of servers\n * @public\n */\nclass TopologyDescription {\n    /**\n     * Create a TopologyDescription\n     */\n    constructor(topologyType, serverDescriptions = null, setName = null, maxSetVersion = null, maxElectionId = null, commonWireVersion = null, options = null) {\n        options = options ?? {};\n        this.type = topologyType ?? common_1.TopologyType.Unknown;\n        this.servers = serverDescriptions ?? new Map();\n        this.stale = false;\n        this.compatible = true;\n        this.heartbeatFrequencyMS = options.heartbeatFrequencyMS ?? 0;\n        this.localThresholdMS = options.localThresholdMS ?? 15;\n        this.setName = setName ?? null;\n        this.maxElectionId = maxElectionId ?? null;\n        this.maxSetVersion = maxSetVersion ?? null;\n        this.commonWireVersion = commonWireVersion ?? 0;\n        // determine server compatibility\n        for (const serverDescription of this.servers.values()) {\n            // Load balancer mode is always compatible.\n            if (serverDescription.type === common_1.ServerType.Unknown ||\n                serverDescription.type === common_1.ServerType.LoadBalancer) {\n                continue;\n            }\n            if (serverDescription.minWireVersion > MAX_SUPPORTED_WIRE_VERSION) {\n                this.compatible = false;\n                this.compatibilityError = `Server at ${serverDescription.address} requires wire version ${serverDescription.minWireVersion}, but this version of the driver only supports up to ${MAX_SUPPORTED_WIRE_VERSION} (MongoDB ${MAX_SUPPORTED_SERVER_VERSION})`;\n            }\n            if (serverDescription.maxWireVersion < MIN_SUPPORTED_WIRE_VERSION) {\n                this.compatible = false;\n                this.compatibilityError = `Server at ${serverDescription.address} reports wire version ${serverDescription.maxWireVersion}, but this version of the driver requires at least ${MIN_SUPPORTED_WIRE_VERSION} (MongoDB ${MIN_SUPPORTED_SERVER_VERSION}).`;\n                break;\n            }\n        }\n        // Whenever a client updates the TopologyDescription from a hello response, it MUST set\n        // TopologyDescription.logicalSessionTimeoutMinutes to the smallest logicalSessionTimeoutMinutes\n        // value among ServerDescriptions of all data-bearing server types. If any have a null\n        // logicalSessionTimeoutMinutes, then TopologyDescription.logicalSessionTimeoutMinutes MUST be\n        // set to null.\n        this.logicalSessionTimeoutMinutes = null;\n        for (const [, server] of this.servers) {\n            if (server.isReadable) {\n                if (server.logicalSessionTimeoutMinutes == null) {\n                    // If any of the servers have a null logicalSessionsTimeout, then the whole topology does\n                    this.logicalSessionTimeoutMinutes = null;\n                    break;\n                }\n                if (this.logicalSessionTimeoutMinutes == null) {\n                    // First server with a non null logicalSessionsTimeout\n                    this.logicalSessionTimeoutMinutes = server.logicalSessionTimeoutMinutes;\n                    continue;\n                }\n                // Always select the smaller of the:\n                // current server logicalSessionsTimeout and the topologies logicalSessionsTimeout\n                this.logicalSessionTimeoutMinutes = Math.min(this.logicalSessionTimeoutMinutes, server.logicalSessionTimeoutMinutes);\n            }\n        }\n    }\n    /**\n     * Returns a new TopologyDescription based on the SrvPollingEvent\n     * @internal\n     */\n    updateFromSrvPollingEvent(ev, srvMaxHosts = 0) {\n        /** The SRV addresses defines the set of addresses we should be using */\n        const incomingHostnames = ev.hostnames();\n        const currentHostnames = new Set(this.servers.keys());\n        const hostnamesToAdd = new Set(incomingHostnames);\n        const hostnamesToRemove = new Set();\n        for (const hostname of currentHostnames) {\n            // filter hostnamesToAdd (made from incomingHostnames) down to what is *not* present in currentHostnames\n            hostnamesToAdd.delete(hostname);\n            if (!incomingHostnames.has(hostname)) {\n                // If the SRV Records no longer include this hostname\n                // we have to stop using it\n                hostnamesToRemove.add(hostname);\n            }\n        }\n        if (hostnamesToAdd.size === 0 && hostnamesToRemove.size === 0) {\n            // No new hosts to add and none to remove\n            return this;\n        }\n        const serverDescriptions = new Map(this.servers);\n        for (const removedHost of hostnamesToRemove) {\n            serverDescriptions.delete(removedHost);\n        }\n        if (hostnamesToAdd.size > 0) {\n            if (srvMaxHosts === 0) {\n                // Add all!\n                for (const hostToAdd of hostnamesToAdd) {\n                    serverDescriptions.set(hostToAdd, new server_description_1.ServerDescription(hostToAdd));\n                }\n            }\n            else if (serverDescriptions.size < srvMaxHosts) {\n                // Add only the amount needed to get us back to srvMaxHosts\n                const selectedHosts = (0, utils_1.shuffle)(hostnamesToAdd, srvMaxHosts - serverDescriptions.size);\n                for (const selectedHostToAdd of selectedHosts) {\n                    serverDescriptions.set(selectedHostToAdd, new server_description_1.ServerDescription(selectedHostToAdd));\n                }\n            }\n        }\n        return new TopologyDescription(this.type, serverDescriptions, this.setName, this.maxSetVersion, this.maxElectionId, this.commonWireVersion, { heartbeatFrequencyMS: this.heartbeatFrequencyMS, localThresholdMS: this.localThresholdMS });\n    }\n    /**\n     * Returns a copy of this description updated with a given ServerDescription\n     * @internal\n     */\n    update(serverDescription) {\n        const address = serverDescription.address;\n        // potentially mutated values\n        let { type: topologyType, setName, maxSetVersion, maxElectionId, commonWireVersion } = this;\n        const serverType = serverDescription.type;\n        const serverDescriptions = new Map(this.servers);\n        // update common wire version\n        if (serverDescription.maxWireVersion !== 0) {\n            if (commonWireVersion == null) {\n                commonWireVersion = serverDescription.maxWireVersion;\n            }\n            else {\n                commonWireVersion = Math.min(commonWireVersion, serverDescription.maxWireVersion);\n            }\n        }\n        if (typeof serverDescription.setName === 'string' &&\n            typeof setName === 'string' &&\n            serverDescription.setName !== setName) {\n            if (topologyType === common_1.TopologyType.Single) {\n                // \"Single\" Topology with setName mismatch is direct connection usage, mark unknown do not remove\n                serverDescription = new server_description_1.ServerDescription(address);\n            }\n            else {\n                serverDescriptions.delete(address);\n            }\n        }\n        // update the actual server description\n        serverDescriptions.set(address, serverDescription);\n        if (topologyType === common_1.TopologyType.Single) {\n            // once we are defined as single, that never changes\n            return new TopologyDescription(common_1.TopologyType.Single, serverDescriptions, setName, maxSetVersion, maxElectionId, commonWireVersion, { heartbeatFrequencyMS: this.heartbeatFrequencyMS, localThresholdMS: this.localThresholdMS });\n        }\n        if (topologyType === common_1.TopologyType.Unknown) {\n            if (serverType === common_1.ServerType.Standalone && this.servers.size !== 1) {\n                serverDescriptions.delete(address);\n            }\n            else {\n                topologyType = topologyTypeForServerType(serverType);\n            }\n        }\n        if (topologyType === common_1.TopologyType.Sharded) {\n            if (!MONGOS_OR_UNKNOWN.has(serverType)) {\n                serverDescriptions.delete(address);\n            }\n        }\n        if (topologyType === common_1.TopologyType.ReplicaSetNoPrimary) {\n            if (MONGOS_OR_STANDALONE.has(serverType)) {\n                serverDescriptions.delete(address);\n            }\n            if (serverType === common_1.ServerType.RSPrimary) {\n                const result = updateRsFromPrimary(serverDescriptions, serverDescription, setName, maxSetVersion, maxElectionId);\n                topologyType = result[0];\n                setName = result[1];\n                maxSetVersion = result[2];\n                maxElectionId = result[3];\n            }\n            else if (NON_PRIMARY_RS_MEMBERS.has(serverType)) {\n                const result = updateRsNoPrimaryFromMember(serverDescriptions, serverDescription, setName);\n                topologyType = result[0];\n                setName = result[1];\n            }\n        }\n        if (topologyType === common_1.TopologyType.ReplicaSetWithPrimary) {\n            if (MONGOS_OR_STANDALONE.has(serverType)) {\n                serverDescriptions.delete(address);\n                topologyType = checkHasPrimary(serverDescriptions);\n            }\n            else if (serverType === common_1.ServerType.RSPrimary) {\n                const result = updateRsFromPrimary(serverDescriptions, serverDescription, setName, maxSetVersion, maxElectionId);\n                topologyType = result[0];\n                setName = result[1];\n                maxSetVersion = result[2];\n                maxElectionId = result[3];\n            }\n            else if (NON_PRIMARY_RS_MEMBERS.has(serverType)) {\n                topologyType = updateRsWithPrimaryFromMember(serverDescriptions, serverDescription, setName);\n            }\n            else {\n                topologyType = checkHasPrimary(serverDescriptions);\n            }\n        }\n        return new TopologyDescription(topologyType, serverDescriptions, setName, maxSetVersion, maxElectionId, commonWireVersion, { heartbeatFrequencyMS: this.heartbeatFrequencyMS, localThresholdMS: this.localThresholdMS });\n    }\n    get error() {\n        const descriptionsWithError = Array.from(this.servers.values()).filter((sd) => sd.error);\n        if (descriptionsWithError.length > 0) {\n            return descriptionsWithError[0].error;\n        }\n        return null;\n    }\n    /**\n     * Determines if the topology description has any known servers\n     */\n    get hasKnownServers() {\n        return Array.from(this.servers.values()).some((sd) => sd.type !== common_1.ServerType.Unknown);\n    }\n    /**\n     * Determines if this topology description has a data-bearing server available.\n     */\n    get hasDataBearingServers() {\n        return Array.from(this.servers.values()).some((sd) => sd.isDataBearing);\n    }\n    /**\n     * Determines if the topology has a definition for the provided address\n     * @internal\n     */\n    hasServer(address) {\n        return this.servers.has(address);\n    }\n    /**\n     * Returns a JSON-serializable representation of the TopologyDescription.  This is primarily\n     * intended for use with JSON.stringify().\n     *\n     * This method will not throw.\n     */\n    toJSON() {\n        return bson_1.EJSON.serialize(this);\n    }\n}\nexports.TopologyDescription = TopologyDescription;\nfunction topologyTypeForServerType(serverType) {\n    switch (serverType) {\n        case common_1.ServerType.Standalone:\n            return common_1.TopologyType.Single;\n        case common_1.ServerType.Mongos:\n            return common_1.TopologyType.Sharded;\n        case common_1.ServerType.RSPrimary:\n            return common_1.TopologyType.ReplicaSetWithPrimary;\n        case common_1.ServerType.RSOther:\n        case common_1.ServerType.RSSecondary:\n            return common_1.TopologyType.ReplicaSetNoPrimary;\n        default:\n            return common_1.TopologyType.Unknown;\n    }\n}\nfunction updateRsFromPrimary(serverDescriptions, serverDescription, setName = null, maxSetVersion = null, maxElectionId = null) {\n    const setVersionElectionIdMismatch = (serverDescription, maxSetVersion, maxElectionId) => {\n        return (`primary marked stale due to electionId/setVersion mismatch:` +\n            ` server setVersion: ${serverDescription.setVersion},` +\n            ` server electionId: ${serverDescription.electionId},` +\n            ` topology setVersion: ${maxSetVersion},` +\n            ` topology electionId: ${maxElectionId}`);\n    };\n    setName = setName || serverDescription.setName;\n    if (setName !== serverDescription.setName) {\n        serverDescriptions.delete(serverDescription.address);\n        return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n    }\n    if (serverDescription.maxWireVersion >= 17) {\n        const electionIdComparison = (0, utils_1.compareObjectId)(maxElectionId, serverDescription.electionId);\n        const maxElectionIdIsEqual = electionIdComparison === 0;\n        const maxElectionIdIsLess = electionIdComparison === -1;\n        const maxSetVersionIsLessOrEqual = (maxSetVersion ?? -1) <= (serverDescription.setVersion ?? -1);\n        if (maxElectionIdIsLess || (maxElectionIdIsEqual && maxSetVersionIsLessOrEqual)) {\n            // The reported electionId was greater\n            // or the electionId was equal and reported setVersion was greater\n            // Always update both values, they are a tuple\n            maxElectionId = serverDescription.electionId;\n            maxSetVersion = serverDescription.setVersion;\n        }\n        else {\n            // Stale primary\n            // replace serverDescription with a default ServerDescription of type \"Unknown\"\n            serverDescriptions.set(serverDescription.address, new server_description_1.ServerDescription(serverDescription.address, undefined, {\n                error: new error_1.MongoStalePrimaryError(setVersionElectionIdMismatch(serverDescription, maxSetVersion, maxElectionId))\n            }));\n            return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n        }\n    }\n    else {\n        const electionId = serverDescription.electionId ? serverDescription.electionId : null;\n        if (serverDescription.setVersion && electionId) {\n            if (maxSetVersion && maxElectionId) {\n                if (maxSetVersion > serverDescription.setVersion ||\n                    (0, utils_1.compareObjectId)(maxElectionId, electionId) > 0) {\n                    // this primary is stale, we must remove it\n                    serverDescriptions.set(serverDescription.address, new server_description_1.ServerDescription(serverDescription.address, undefined, {\n                        error: new error_1.MongoStalePrimaryError(setVersionElectionIdMismatch(serverDescription, maxSetVersion, maxElectionId))\n                    }));\n                    return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n                }\n            }\n            maxElectionId = serverDescription.electionId;\n        }\n        if (serverDescription.setVersion != null &&\n            (maxSetVersion == null || serverDescription.setVersion > maxSetVersion)) {\n            maxSetVersion = serverDescription.setVersion;\n        }\n    }\n    // We've heard from the primary. Is it the same primary as before?\n    for (const [address, server] of serverDescriptions) {\n        if (server.type === common_1.ServerType.RSPrimary && server.address !== serverDescription.address) {\n            // Reset old primary's type to Unknown.\n            serverDescriptions.set(address, new server_description_1.ServerDescription(server.address, undefined, {\n                error: new error_1.MongoStalePrimaryError('primary marked stale due to discovery of newer primary')\n            }));\n            // There can only be one primary\n            break;\n        }\n    }\n    // Discover new hosts from this primary's response.\n    serverDescription.allHosts.forEach((address) => {\n        if (!serverDescriptions.has(address)) {\n            serverDescriptions.set(address, new server_description_1.ServerDescription(address));\n        }\n    });\n    // Remove hosts not in the response.\n    const currentAddresses = Array.from(serverDescriptions.keys());\n    const responseAddresses = serverDescription.allHosts;\n    currentAddresses\n        .filter((addr) => responseAddresses.indexOf(addr) === -1)\n        .forEach((address) => {\n        serverDescriptions.delete(address);\n    });\n    return [checkHasPrimary(serverDescriptions), setName, maxSetVersion, maxElectionId];\n}\nfunction updateRsWithPrimaryFromMember(serverDescriptions, serverDescription, setName = null) {\n    if (setName == null) {\n        // TODO(NODE-3483): should be an appropriate runtime error\n        throw new error_1.MongoRuntimeError('Argument \"setName\" is required if connected to a replica set');\n    }\n    if (setName !== serverDescription.setName ||\n        (serverDescription.me && serverDescription.address !== serverDescription.me)) {\n        serverDescriptions.delete(serverDescription.address);\n    }\n    return checkHasPrimary(serverDescriptions);\n}\nfunction updateRsNoPrimaryFromMember(serverDescriptions, serverDescription, setName = null) {\n    const topologyType = common_1.TopologyType.ReplicaSetNoPrimary;\n    setName = setName ?? serverDescription.setName;\n    if (setName !== serverDescription.setName) {\n        serverDescriptions.delete(serverDescription.address);\n        return [topologyType, setName];\n    }\n    serverDescription.allHosts.forEach((address) => {\n        if (!serverDescriptions.has(address)) {\n            serverDescriptions.set(address, new server_description_1.ServerDescription(address));\n        }\n    });\n    if (serverDescription.me && serverDescription.address !== serverDescription.me) {\n        serverDescriptions.delete(serverDescription.address);\n    }\n    return [topologyType, setName];\n}\nfunction checkHasPrimary(serverDescriptions) {\n    for (const serverDescription of serverDescriptions.values()) {\n        if (serverDescription.type === common_1.ServerType.RSPrimary) {\n            return common_1.TopologyType.ReplicaSetWithPrimary;\n        }\n    }\n    return common_1.TopologyType.ReplicaSetNoPrimary;\n}\n//# sourceMappingURL=topology_description.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NkYW0vdG9wb2xvZ3lfZGVzY3JpcHRpb24uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsMkJBQTJCO0FBQzNCLGVBQWUsbUJBQU8sQ0FBQywyRkFBUztBQUNoQyx1QkFBdUIsbUJBQU8sQ0FBQywySUFBaUM7QUFDaEUsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsZ0JBQWdCLG1CQUFPLENBQUMsNkZBQVU7QUFDbEMsaUJBQWlCLG1CQUFPLENBQUMsbUdBQVU7QUFDbkMsNkJBQTZCLG1CQUFPLENBQUMsMkhBQXNCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsMkJBQTJCLHdCQUF3QixpQ0FBaUMsdURBQXVELDRCQUE0QixXQUFXLDZCQUE2QjtBQUN0UTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsMkJBQTJCLHVCQUF1QixpQ0FBaUMscURBQXFELDRCQUE0QixXQUFXLDZCQUE2QjtBQUNuUTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzSkFBc0osMEZBQTBGO0FBQ2hQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLCtFQUErRTtBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUpBQXlKLDBGQUEwRjtBQUNuUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUlBQXFJLDBGQUEwRjtBQUMvTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsNkJBQTZCO0FBQ2hFLG1DQUFtQyw2QkFBNkI7QUFDaEUscUNBQXFDLGNBQWM7QUFDbkQscUNBQXFDLGNBQWM7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvc2RhbS90b3BvbG9neV9kZXNjcmlwdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVG9wb2xvZ3lEZXNjcmlwdGlvbiA9IHZvaWQgMDtcbmNvbnN0IGJzb25fMSA9IHJlcXVpcmUoXCIuLi9ic29uXCIpO1xuY29uc3QgV0lSRV9DT05TVEFOVFMgPSByZXF1aXJlKFwiLi4vY21hcC93aXJlX3Byb3RvY29sL2NvbnN0YW50c1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JcIik7XG5jb25zdCB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG5jb25zdCBzZXJ2ZXJfZGVzY3JpcHRpb25fMSA9IHJlcXVpcmUoXCIuL3NlcnZlcl9kZXNjcmlwdGlvblwiKTtcbi8vIGNvbnN0YW50cyByZWxhdGVkIHRvIGNvbXBhdGliaWxpdHkgY2hlY2tzXG5jb25zdCBNSU5fU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OID0gV0lSRV9DT05TVEFOVFMuTUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTjtcbmNvbnN0IE1BWF9TVVBQT1JURURfU0VSVkVSX1ZFUlNJT04gPSBXSVJFX0NPTlNUQU5UUy5NQVhfU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OO1xuY29uc3QgTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04gPSBXSVJFX0NPTlNUQU5UUy5NSU5fU1VQUE9SVEVEX1dJUkVfVkVSU0lPTjtcbmNvbnN0IE1BWF9TVVBQT1JURURfV0lSRV9WRVJTSU9OID0gV0lSRV9DT05TVEFOVFMuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT047XG5jb25zdCBNT05HT1NfT1JfVU5LTk9XTiA9IG5ldyBTZXQoW2NvbW1vbl8xLlNlcnZlclR5cGUuTW9uZ29zLCBjb21tb25fMS5TZXJ2ZXJUeXBlLlVua25vd25dKTtcbmNvbnN0IE1PTkdPU19PUl9TVEFOREFMT05FID0gbmV3IFNldChbY29tbW9uXzEuU2VydmVyVHlwZS5Nb25nb3MsIGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZV0pO1xuY29uc3QgTk9OX1BSSU1BUllfUlNfTUVNQkVSUyA9IG5ldyBTZXQoW1xuICAgIGNvbW1vbl8xLlNlcnZlclR5cGUuUlNTZWNvbmRhcnksXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU0FyYml0ZXIsXG4gICAgY29tbW9uXzEuU2VydmVyVHlwZS5SU090aGVyXG5dKTtcbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYSBkZXBsb3ltZW50IG9mIHNlcnZlcnNcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgVG9wb2xvZ3lEZXNjcmlwdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgVG9wb2xvZ3lEZXNjcmlwdGlvblxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHRvcG9sb2d5VHlwZSwgc2VydmVyRGVzY3JpcHRpb25zID0gbnVsbCwgc2V0TmFtZSA9IG51bGwsIG1heFNldFZlcnNpb24gPSBudWxsLCBtYXhFbGVjdGlvbklkID0gbnVsbCwgY29tbW9uV2lyZVZlcnNpb24gPSBudWxsLCBvcHRpb25zID0gbnVsbCkge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy50eXBlID0gdG9wb2xvZ3lUeXBlID8/IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5Vbmtub3duO1xuICAgICAgICB0aGlzLnNlcnZlcnMgPSBzZXJ2ZXJEZXNjcmlwdGlvbnMgPz8gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLnN0YWxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29tcGF0aWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMgPSBvcHRpb25zLmhlYXJ0YmVhdEZyZXF1ZW5jeU1TID8/IDA7XG4gICAgICAgIHRoaXMubG9jYWxUaHJlc2hvbGRNUyA9IG9wdGlvbnMubG9jYWxUaHJlc2hvbGRNUyA/PyAxNTtcbiAgICAgICAgdGhpcy5zZXROYW1lID0gc2V0TmFtZSA/PyBudWxsO1xuICAgICAgICB0aGlzLm1heEVsZWN0aW9uSWQgPSBtYXhFbGVjdGlvbklkID8/IG51bGw7XG4gICAgICAgIHRoaXMubWF4U2V0VmVyc2lvbiA9IG1heFNldFZlcnNpb24gPz8gbnVsbDtcbiAgICAgICAgdGhpcy5jb21tb25XaXJlVmVyc2lvbiA9IGNvbW1vbldpcmVWZXJzaW9uID8/IDA7XG4gICAgICAgIC8vIGRldGVybWluZSBzZXJ2ZXIgY29tcGF0aWJpbGl0eVxuICAgICAgICBmb3IgKGNvbnN0IHNlcnZlckRlc2NyaXB0aW9uIG9mIHRoaXMuc2VydmVycy52YWx1ZXMoKSkge1xuICAgICAgICAgICAgLy8gTG9hZCBiYWxhbmNlciBtb2RlIGlzIGFsd2F5cyBjb21wYXRpYmxlLlxuICAgICAgICAgICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuVW5rbm93biB8fFxuICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9uLnR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuTG9hZEJhbGFuY2VyKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb24ubWluV2lyZVZlcnNpb24gPiBNQVhfU1VQUE9SVEVEX1dJUkVfVkVSU0lPTikge1xuICAgICAgICAgICAgICAgIHRoaXMuY29tcGF0aWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tcGF0aWJpbGl0eUVycm9yID0gYFNlcnZlciBhdCAke3NlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3N9IHJlcXVpcmVzIHdpcmUgdmVyc2lvbiAke3NlcnZlckRlc2NyaXB0aW9uLm1pbldpcmVWZXJzaW9ufSwgYnV0IHRoaXMgdmVyc2lvbiBvZiB0aGUgZHJpdmVyIG9ubHkgc3VwcG9ydHMgdXAgdG8gJHtNQVhfU1VQUE9SVEVEX1dJUkVfVkVSU0lPTn0gKE1vbmdvREIgJHtNQVhfU1VQUE9SVEVEX1NFUlZFUl9WRVJTSU9OfSlgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9uIDwgTUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT04pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBhdGlibGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBhdGliaWxpdHlFcnJvciA9IGBTZXJ2ZXIgYXQgJHtzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzfSByZXBvcnRzIHdpcmUgdmVyc2lvbiAke3NlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9ufSwgYnV0IHRoaXMgdmVyc2lvbiBvZiB0aGUgZHJpdmVyIHJlcXVpcmVzIGF0IGxlYXN0ICR7TUlOX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT059IChNb25nb0RCICR7TUlOX1NVUFBPUlRFRF9TRVJWRVJfVkVSU0lPTn0pLmA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2hlbmV2ZXIgYSBjbGllbnQgdXBkYXRlcyB0aGUgVG9wb2xvZ3lEZXNjcmlwdGlvbiBmcm9tIGEgaGVsbG8gcmVzcG9uc2UsIGl0IE1VU1Qgc2V0XG4gICAgICAgIC8vIFRvcG9sb2d5RGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyB0byB0aGUgc21hbGxlc3QgbG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlc1xuICAgICAgICAvLyB2YWx1ZSBhbW9uZyBTZXJ2ZXJEZXNjcmlwdGlvbnMgb2YgYWxsIGRhdGEtYmVhcmluZyBzZXJ2ZXIgdHlwZXMuIElmIGFueSBoYXZlIGEgbnVsbFxuICAgICAgICAvLyBsb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzLCB0aGVuIFRvcG9sb2d5RGVzY3JpcHRpb24ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyBNVVNUIGJlXG4gICAgICAgIC8vIHNldCB0byBudWxsLlxuICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBudWxsO1xuICAgICAgICBmb3IgKGNvbnN0IFssIHNlcnZlcl0gb2YgdGhpcy5zZXJ2ZXJzKSB7XG4gICAgICAgICAgICBpZiAoc2VydmVyLmlzUmVhZGFibGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VydmVyLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBhbnkgb2YgdGhlIHNlcnZlcnMgaGF2ZSBhIG51bGwgbG9naWNhbFNlc3Npb25zVGltZW91dCwgdGhlbiB0aGUgd2hvbGUgdG9wb2xvZ3kgZG9lc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IHNlcnZlciB3aXRoIGEgbm9uIG51bGwgbG9naWNhbFNlc3Npb25zVGltZW91dFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBzZXJ2ZXIubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcztcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBzZWxlY3QgdGhlIHNtYWxsZXIgb2YgdGhlOlxuICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgc2VydmVyIGxvZ2ljYWxTZXNzaW9uc1RpbWVvdXQgYW5kIHRoZSB0b3BvbG9naWVzIGxvZ2ljYWxTZXNzaW9uc1RpbWVvdXRcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMgPSBNYXRoLm1pbih0aGlzLmxvZ2ljYWxTZXNzaW9uVGltZW91dE1pbnV0ZXMsIHNlcnZlci5sb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgbmV3IFRvcG9sb2d5RGVzY3JpcHRpb24gYmFzZWQgb24gdGhlIFNydlBvbGxpbmdFdmVudFxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHVwZGF0ZUZyb21TcnZQb2xsaW5nRXZlbnQoZXYsIHNydk1heEhvc3RzID0gMCkge1xuICAgICAgICAvKiogVGhlIFNSViBhZGRyZXNzZXMgZGVmaW5lcyB0aGUgc2V0IG9mIGFkZHJlc3NlcyB3ZSBzaG91bGQgYmUgdXNpbmcgKi9cbiAgICAgICAgY29uc3QgaW5jb21pbmdIb3N0bmFtZXMgPSBldi5ob3N0bmFtZXMoKTtcbiAgICAgICAgY29uc3QgY3VycmVudEhvc3RuYW1lcyA9IG5ldyBTZXQodGhpcy5zZXJ2ZXJzLmtleXMoKSk7XG4gICAgICAgIGNvbnN0IGhvc3RuYW1lc1RvQWRkID0gbmV3IFNldChpbmNvbWluZ0hvc3RuYW1lcyk7XG4gICAgICAgIGNvbnN0IGhvc3RuYW1lc1RvUmVtb3ZlID0gbmV3IFNldCgpO1xuICAgICAgICBmb3IgKGNvbnN0IGhvc3RuYW1lIG9mIGN1cnJlbnRIb3N0bmFtZXMpIHtcbiAgICAgICAgICAgIC8vIGZpbHRlciBob3N0bmFtZXNUb0FkZCAobWFkZSBmcm9tIGluY29taW5nSG9zdG5hbWVzKSBkb3duIHRvIHdoYXQgaXMgKm5vdCogcHJlc2VudCBpbiBjdXJyZW50SG9zdG5hbWVzXG4gICAgICAgICAgICBob3N0bmFtZXNUb0FkZC5kZWxldGUoaG9zdG5hbWUpO1xuICAgICAgICAgICAgaWYgKCFpbmNvbWluZ0hvc3RuYW1lcy5oYXMoaG9zdG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIFNSViBSZWNvcmRzIG5vIGxvbmdlciBpbmNsdWRlIHRoaXMgaG9zdG5hbWVcbiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIHRvIHN0b3AgdXNpbmcgaXRcbiAgICAgICAgICAgICAgICBob3N0bmFtZXNUb1JlbW92ZS5hZGQoaG9zdG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChob3N0bmFtZXNUb0FkZC5zaXplID09PSAwICYmIGhvc3RuYW1lc1RvUmVtb3ZlLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIC8vIE5vIG5ldyBob3N0cyB0byBhZGQgYW5kIG5vbmUgdG8gcmVtb3ZlXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZXJ2ZXJEZXNjcmlwdGlvbnMgPSBuZXcgTWFwKHRoaXMuc2VydmVycyk7XG4gICAgICAgIGZvciAoY29uc3QgcmVtb3ZlZEhvc3Qgb2YgaG9zdG5hbWVzVG9SZW1vdmUpIHtcbiAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUocmVtb3ZlZEhvc3QpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChob3N0bmFtZXNUb0FkZC5zaXplID4gMCkge1xuICAgICAgICAgICAgaWYgKHNydk1heEhvc3RzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIGFsbCFcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGhvc3RUb0FkZCBvZiBob3N0bmFtZXNUb0FkZCkge1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KGhvc3RUb0FkZCwgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKGhvc3RUb0FkZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlckRlc2NyaXB0aW9ucy5zaXplIDwgc3J2TWF4SG9zdHMpIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgb25seSB0aGUgYW1vdW50IG5lZWRlZCB0byBnZXQgdXMgYmFjayB0byBzcnZNYXhIb3N0c1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkSG9zdHMgPSAoMCwgdXRpbHNfMS5zaHVmZmxlKShob3N0bmFtZXNUb0FkZCwgc3J2TWF4SG9zdHMgLSBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2l6ZSk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzZWxlY3RlZEhvc3RUb0FkZCBvZiBzZWxlY3RlZEhvc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5zZXQoc2VsZWN0ZWRIb3N0VG9BZGQsIG5ldyBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5TZXJ2ZXJEZXNjcmlwdGlvbihzZWxlY3RlZEhvc3RUb0FkZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFRvcG9sb2d5RGVzY3JpcHRpb24odGhpcy50eXBlLCBzZXJ2ZXJEZXNjcmlwdGlvbnMsIHRoaXMuc2V0TmFtZSwgdGhpcy5tYXhTZXRWZXJzaW9uLCB0aGlzLm1heEVsZWN0aW9uSWQsIHRoaXMuY29tbW9uV2lyZVZlcnNpb24sIHsgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMsIGxvY2FsVGhyZXNob2xkTVM6IHRoaXMubG9jYWxUaHJlc2hvbGRNUyB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBkZXNjcmlwdGlvbiB1cGRhdGVkIHdpdGggYSBnaXZlbiBTZXJ2ZXJEZXNjcmlwdGlvblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHVwZGF0ZShzZXJ2ZXJEZXNjcmlwdGlvbikge1xuICAgICAgICBjb25zdCBhZGRyZXNzID0gc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcztcbiAgICAgICAgLy8gcG90ZW50aWFsbHkgbXV0YXRlZCB2YWx1ZXNcbiAgICAgICAgbGV0IHsgdHlwZTogdG9wb2xvZ3lUeXBlLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkLCBjb21tb25XaXJlVmVyc2lvbiB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgc2VydmVyVHlwZSA9IHNlcnZlckRlc2NyaXB0aW9uLnR5cGU7XG4gICAgICAgIGNvbnN0IHNlcnZlckRlc2NyaXB0aW9ucyA9IG5ldyBNYXAodGhpcy5zZXJ2ZXJzKTtcbiAgICAgICAgLy8gdXBkYXRlIGNvbW1vbiB3aXJlIHZlcnNpb25cbiAgICAgICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9uICE9PSAwKSB7XG4gICAgICAgICAgICBpZiAoY29tbW9uV2lyZVZlcnNpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbW1vbldpcmVWZXJzaW9uID0gc2VydmVyRGVzY3JpcHRpb24ubWF4V2lyZVZlcnNpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb21tb25XaXJlVmVyc2lvbiA9IE1hdGgubWluKGNvbW1vbldpcmVWZXJzaW9uLCBzZXJ2ZXJEZXNjcmlwdGlvbi5tYXhXaXJlVmVyc2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBzZXJ2ZXJEZXNjcmlwdGlvbi5zZXROYW1lID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgdHlwZW9mIHNldE5hbWUgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbi5zZXROYW1lICE9PSBzZXROYW1lKSB7XG4gICAgICAgICAgICBpZiAodG9wb2xvZ3lUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuU2luZ2xlKSB7XG4gICAgICAgICAgICAgICAgLy8gXCJTaW5nbGVcIiBUb3BvbG9neSB3aXRoIHNldE5hbWUgbWlzbWF0Y2ggaXMgZGlyZWN0IGNvbm5lY3Rpb24gdXNhZ2UsIG1hcmsgdW5rbm93biBkbyBub3QgcmVtb3ZlXG4gICAgICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb24gPSBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oYWRkcmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuZGVsZXRlKGFkZHJlc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSB0aGUgYWN0dWFsIHNlcnZlciBkZXNjcmlwdGlvblxuICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KGFkZHJlc3MsIHNlcnZlckRlc2NyaXB0aW9uKTtcbiAgICAgICAgaWYgKHRvcG9sb2d5VHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNpbmdsZSkge1xuICAgICAgICAgICAgLy8gb25jZSB3ZSBhcmUgZGVmaW5lZCBhcyBzaW5nbGUsIHRoYXQgbmV2ZXIgY2hhbmdlc1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBUb3BvbG9neURlc2NyaXB0aW9uKGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGUsIHNlcnZlckRlc2NyaXB0aW9ucywgc2V0TmFtZSwgbWF4U2V0VmVyc2lvbiwgbWF4RWxlY3Rpb25JZCwgY29tbW9uV2lyZVZlcnNpb24sIHsgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IHRoaXMuaGVhcnRiZWF0RnJlcXVlbmN5TVMsIGxvY2FsVGhyZXNob2xkTVM6IHRoaXMubG9jYWxUaHJlc2hvbGRNUyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgaWYgKHNlcnZlclR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZSAmJiB0aGlzLnNlcnZlcnMuc2l6ZSAhPT0gMSkge1xuICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoYWRkcmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSB0b3BvbG9neVR5cGVGb3JTZXJ2ZXJUeXBlKHNlcnZlclR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0b3BvbG9neVR5cGUgPT09IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaGFyZGVkKSB7XG4gICAgICAgICAgICBpZiAoIU1PTkdPU19PUl9VTktOT1dOLmhhcyhzZXJ2ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoYWRkcmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvcG9sb2d5VHlwZSA9PT0gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlJlcGxpY2FTZXROb1ByaW1hcnkpIHtcbiAgICAgICAgICAgIGlmIChNT05HT1NfT1JfU1RBTkRBTE9ORS5oYXMoc2VydmVyVHlwZSkpIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuZGVsZXRlKGFkZHJlc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlcnZlclR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdXBkYXRlUnNGcm9tUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2V0TmFtZSA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgICAgICBtYXhTZXRWZXJzaW9uID0gcmVzdWx0WzJdO1xuICAgICAgICAgICAgICAgIG1heEVsZWN0aW9uSWQgPSByZXN1bHRbM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChOT05fUFJJTUFSWV9SU19NRU1CRVJTLmhhcyhzZXJ2ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHVwZGF0ZVJzTm9QcmltYXJ5RnJvbU1lbWJlcihzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2V0TmFtZSA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodG9wb2xvZ3lUeXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldFdpdGhQcmltYXJ5KSB7XG4gICAgICAgICAgICBpZiAoTU9OR09TX09SX1NUQU5EQUxPTkUuaGFzKHNlcnZlclR5cGUpKSB7XG4gICAgICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShhZGRyZXNzKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSBjaGVja0hhc1ByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlclR5cGUgPT09IGNvbW1vbl8xLlNlcnZlclR5cGUuUlNQcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdXBkYXRlUnNGcm9tUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgICB0b3BvbG9neVR5cGUgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2V0TmFtZSA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgICAgICBtYXhTZXRWZXJzaW9uID0gcmVzdWx0WzJdO1xuICAgICAgICAgICAgICAgIG1heEVsZWN0aW9uSWQgPSByZXN1bHRbM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChOT05fUFJJTUFSWV9SU19NRU1CRVJTLmhhcyhzZXJ2ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgIHRvcG9sb2d5VHlwZSA9IHVwZGF0ZVJzV2l0aFByaW1hcnlGcm9tTWVtYmVyKHNlcnZlckRlc2NyaXB0aW9ucywgc2VydmVyRGVzY3JpcHRpb24sIHNldE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9wb2xvZ3lUeXBlID0gY2hlY2tIYXNQcmltYXJ5KHNlcnZlckRlc2NyaXB0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBUb3BvbG9neURlc2NyaXB0aW9uKHRvcG9sb2d5VHlwZSwgc2VydmVyRGVzY3JpcHRpb25zLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkLCBjb21tb25XaXJlVmVyc2lvbiwgeyBoZWFydGJlYXRGcmVxdWVuY3lNUzogdGhpcy5oZWFydGJlYXRGcmVxdWVuY3lNUywgbG9jYWxUaHJlc2hvbGRNUzogdGhpcy5sb2NhbFRocmVzaG9sZE1TIH0pO1xuICAgIH1cbiAgICBnZXQgZXJyb3IoKSB7XG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uc1dpdGhFcnJvciA9IEFycmF5LmZyb20odGhpcy5zZXJ2ZXJzLnZhbHVlcygpKS5maWx0ZXIoKHNkKSA9PiBzZC5lcnJvcik7XG4gICAgICAgIGlmIChkZXNjcmlwdGlvbnNXaXRoRXJyb3IubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGRlc2NyaXB0aW9uc1dpdGhFcnJvclswXS5lcnJvcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgdG9wb2xvZ3kgZGVzY3JpcHRpb24gaGFzIGFueSBrbm93biBzZXJ2ZXJzXG4gICAgICovXG4gICAgZ2V0IGhhc0tub3duU2VydmVycygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5zZXJ2ZXJzLnZhbHVlcygpKS5zb21lKChzZCkgPT4gc2QudHlwZSAhPT0gY29tbW9uXzEuU2VydmVyVHlwZS5Vbmtub3duKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGlzIHRvcG9sb2d5IGRlc2NyaXB0aW9uIGhhcyBhIGRhdGEtYmVhcmluZyBzZXJ2ZXIgYXZhaWxhYmxlLlxuICAgICAqL1xuICAgIGdldCBoYXNEYXRhQmVhcmluZ1NlcnZlcnMoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuc2VydmVycy52YWx1ZXMoKSkuc29tZSgoc2QpID0+IHNkLmlzRGF0YUJlYXJpbmcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSB0b3BvbG9neSBoYXMgYSBkZWZpbml0aW9uIGZvciB0aGUgcHJvdmlkZWQgYWRkcmVzc1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGhhc1NlcnZlcihhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZlcnMuaGFzKGFkZHJlc3MpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIFRvcG9sb2d5RGVzY3JpcHRpb24uICBUaGlzIGlzIHByaW1hcmlseVxuICAgICAqIGludGVuZGVkIGZvciB1c2Ugd2l0aCBKU09OLnN0cmluZ2lmeSgpLlxuICAgICAqXG4gICAgICogVGhpcyBtZXRob2Qgd2lsbCBub3QgdGhyb3cuXG4gICAgICovXG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gYnNvbl8xLkVKU09OLnNlcmlhbGl6ZSh0aGlzKTtcbiAgICB9XG59XG5leHBvcnRzLlRvcG9sb2d5RGVzY3JpcHRpb24gPSBUb3BvbG9neURlc2NyaXB0aW9uO1xuZnVuY3Rpb24gdG9wb2xvZ3lUeXBlRm9yU2VydmVyVHlwZShzZXJ2ZXJUeXBlKSB7XG4gICAgc3dpdGNoIChzZXJ2ZXJUeXBlKSB7XG4gICAgICAgIGNhc2UgY29tbW9uXzEuU2VydmVyVHlwZS5TdGFuZGFsb25lOlxuICAgICAgICAgICAgcmV0dXJuIGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5TaW5nbGU7XG4gICAgICAgIGNhc2UgY29tbW9uXzEuU2VydmVyVHlwZS5Nb25nb3M6XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlNoYXJkZWQ7XG4gICAgICAgIGNhc2UgY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnk6XG4gICAgICAgICAgICByZXR1cm4gY29tbW9uXzEuVG9wb2xvZ3lUeXBlLlJlcGxpY2FTZXRXaXRoUHJpbWFyeTtcbiAgICAgICAgY2FzZSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTT3RoZXI6XG4gICAgICAgIGNhc2UgY29tbW9uXzEuU2VydmVyVHlwZS5SU1NlY29uZGFyeTpcbiAgICAgICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldE5vUHJpbWFyeTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuVW5rbm93bjtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVSc0Zyb21QcmltYXJ5KHNlcnZlckRlc2NyaXB0aW9ucywgc2VydmVyRGVzY3JpcHRpb24sIHNldE5hbWUgPSBudWxsLCBtYXhTZXRWZXJzaW9uID0gbnVsbCwgbWF4RWxlY3Rpb25JZCA9IG51bGwpIHtcbiAgICBjb25zdCBzZXRWZXJzaW9uRWxlY3Rpb25JZE1pc21hdGNoID0gKHNlcnZlckRlc2NyaXB0aW9uLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKSA9PiB7XG4gICAgICAgIHJldHVybiAoYHByaW1hcnkgbWFya2VkIHN0YWxlIGR1ZSB0byBlbGVjdGlvbklkL3NldFZlcnNpb24gbWlzbWF0Y2g6YCArXG4gICAgICAgICAgICBgIHNlcnZlciBzZXRWZXJzaW9uOiAke3NlcnZlckRlc2NyaXB0aW9uLnNldFZlcnNpb259LGAgK1xuICAgICAgICAgICAgYCBzZXJ2ZXIgZWxlY3Rpb25JZDogJHtzZXJ2ZXJEZXNjcmlwdGlvbi5lbGVjdGlvbklkfSxgICtcbiAgICAgICAgICAgIGAgdG9wb2xvZ3kgc2V0VmVyc2lvbjogJHttYXhTZXRWZXJzaW9ufSxgICtcbiAgICAgICAgICAgIGAgdG9wb2xvZ3kgZWxlY3Rpb25JZDogJHttYXhFbGVjdGlvbklkfWApO1xuICAgIH07XG4gICAgc2V0TmFtZSA9IHNldE5hbWUgfHwgc2VydmVyRGVzY3JpcHRpb24uc2V0TmFtZTtcbiAgICBpZiAoc2V0TmFtZSAhPT0gc2VydmVyRGVzY3JpcHRpb24uc2V0TmFtZSkge1xuICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuZGVsZXRlKHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MpO1xuICAgICAgICByZXR1cm4gW2NoZWNrSGFzUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMpLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkXTtcbiAgICB9XG4gICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1heFdpcmVWZXJzaW9uID49IDE3KSB7XG4gICAgICAgIGNvbnN0IGVsZWN0aW9uSWRDb21wYXJpc29uID0gKDAsIHV0aWxzXzEuY29tcGFyZU9iamVjdElkKShtYXhFbGVjdGlvbklkLCBzZXJ2ZXJEZXNjcmlwdGlvbi5lbGVjdGlvbklkKTtcbiAgICAgICAgY29uc3QgbWF4RWxlY3Rpb25JZElzRXF1YWwgPSBlbGVjdGlvbklkQ29tcGFyaXNvbiA9PT0gMDtcbiAgICAgICAgY29uc3QgbWF4RWxlY3Rpb25JZElzTGVzcyA9IGVsZWN0aW9uSWRDb21wYXJpc29uID09PSAtMTtcbiAgICAgICAgY29uc3QgbWF4U2V0VmVyc2lvbklzTGVzc09yRXF1YWwgPSAobWF4U2V0VmVyc2lvbiA/PyAtMSkgPD0gKHNlcnZlckRlc2NyaXB0aW9uLnNldFZlcnNpb24gPz8gLTEpO1xuICAgICAgICBpZiAobWF4RWxlY3Rpb25JZElzTGVzcyB8fCAobWF4RWxlY3Rpb25JZElzRXF1YWwgJiYgbWF4U2V0VmVyc2lvbklzTGVzc09yRXF1YWwpKSB7XG4gICAgICAgICAgICAvLyBUaGUgcmVwb3J0ZWQgZWxlY3Rpb25JZCB3YXMgZ3JlYXRlclxuICAgICAgICAgICAgLy8gb3IgdGhlIGVsZWN0aW9uSWQgd2FzIGVxdWFsIGFuZCByZXBvcnRlZCBzZXRWZXJzaW9uIHdhcyBncmVhdGVyXG4gICAgICAgICAgICAvLyBBbHdheXMgdXBkYXRlIGJvdGggdmFsdWVzLCB0aGV5IGFyZSBhIHR1cGxlXG4gICAgICAgICAgICBtYXhFbGVjdGlvbklkID0gc2VydmVyRGVzY3JpcHRpb24uZWxlY3Rpb25JZDtcbiAgICAgICAgICAgIG1heFNldFZlcnNpb24gPSBzZXJ2ZXJEZXNjcmlwdGlvbi5zZXRWZXJzaW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gU3RhbGUgcHJpbWFyeVxuICAgICAgICAgICAgLy8gcmVwbGFjZSBzZXJ2ZXJEZXNjcmlwdGlvbiB3aXRoIGEgZGVmYXVsdCBTZXJ2ZXJEZXNjcmlwdGlvbiBvZiB0eXBlIFwiVW5rbm93blwiXG4gICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MsIG5ldyBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5TZXJ2ZXJEZXNjcmlwdGlvbihzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzLCB1bmRlZmluZWQsIHtcbiAgICAgICAgICAgICAgICBlcnJvcjogbmV3IGVycm9yXzEuTW9uZ29TdGFsZVByaW1hcnlFcnJvcihzZXRWZXJzaW9uRWxlY3Rpb25JZE1pc21hdGNoKHNlcnZlckRlc2NyaXB0aW9uLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKSlcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJldHVybiBbY2hlY2tIYXNQcmltYXJ5KHNlcnZlckRlc2NyaXB0aW9ucyksIHNldE5hbWUsIG1heFNldFZlcnNpb24sIG1heEVsZWN0aW9uSWRdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBlbGVjdGlvbklkID0gc2VydmVyRGVzY3JpcHRpb24uZWxlY3Rpb25JZCA/IHNlcnZlckRlc2NyaXB0aW9uLmVsZWN0aW9uSWQgOiBudWxsO1xuICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb24uc2V0VmVyc2lvbiAmJiBlbGVjdGlvbklkKSB7XG4gICAgICAgICAgICBpZiAobWF4U2V0VmVyc2lvbiAmJiBtYXhFbGVjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1heFNldFZlcnNpb24gPiBzZXJ2ZXJEZXNjcmlwdGlvbi5zZXRWZXJzaW9uIHx8XG4gICAgICAgICAgICAgICAgICAgICgwLCB1dGlsc18xLmNvbXBhcmVPYmplY3RJZCkobWF4RWxlY3Rpb25JZCwgZWxlY3Rpb25JZCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgcHJpbWFyeSBpcyBzdGFsZSwgd2UgbXVzdCByZW1vdmUgaXRcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLnNldChzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzLCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcywgdW5kZWZpbmVkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogbmV3IGVycm9yXzEuTW9uZ29TdGFsZVByaW1hcnlFcnJvcihzZXRWZXJzaW9uRWxlY3Rpb25JZE1pc21hdGNoKHNlcnZlckRlc2NyaXB0aW9uLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkKSlcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2NoZWNrSGFzUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMpLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtYXhFbGVjdGlvbklkID0gc2VydmVyRGVzY3JpcHRpb24uZWxlY3Rpb25JZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb24uc2V0VmVyc2lvbiAhPSBudWxsICYmXG4gICAgICAgICAgICAobWF4U2V0VmVyc2lvbiA9PSBudWxsIHx8IHNlcnZlckRlc2NyaXB0aW9uLnNldFZlcnNpb24gPiBtYXhTZXRWZXJzaW9uKSkge1xuICAgICAgICAgICAgbWF4U2V0VmVyc2lvbiA9IHNlcnZlckRlc2NyaXB0aW9uLnNldFZlcnNpb247XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gV2UndmUgaGVhcmQgZnJvbSB0aGUgcHJpbWFyeS4gSXMgaXQgdGhlIHNhbWUgcHJpbWFyeSBhcyBiZWZvcmU/XG4gICAgZm9yIChjb25zdCBbYWRkcmVzcywgc2VydmVyXSBvZiBzZXJ2ZXJEZXNjcmlwdGlvbnMpIHtcbiAgICAgICAgaWYgKHNlcnZlci50eXBlID09PSBjb21tb25fMS5TZXJ2ZXJUeXBlLlJTUHJpbWFyeSAmJiBzZXJ2ZXIuYWRkcmVzcyAhPT0gc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcykge1xuICAgICAgICAgICAgLy8gUmVzZXQgb2xkIHByaW1hcnkncyB0eXBlIHRvIFVua25vd24uXG4gICAgICAgICAgICBzZXJ2ZXJEZXNjcmlwdGlvbnMuc2V0KGFkZHJlc3MsIG5ldyBzZXJ2ZXJfZGVzY3JpcHRpb25fMS5TZXJ2ZXJEZXNjcmlwdGlvbihzZXJ2ZXIuYWRkcmVzcywgdW5kZWZpbmVkLCB7XG4gICAgICAgICAgICAgICAgZXJyb3I6IG5ldyBlcnJvcl8xLk1vbmdvU3RhbGVQcmltYXJ5RXJyb3IoJ3ByaW1hcnkgbWFya2VkIHN0YWxlIGR1ZSB0byBkaXNjb3Zlcnkgb2YgbmV3ZXIgcHJpbWFyeScpXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAvLyBUaGVyZSBjYW4gb25seSBiZSBvbmUgcHJpbWFyeVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRGlzY292ZXIgbmV3IGhvc3RzIGZyb20gdGhpcyBwcmltYXJ5J3MgcmVzcG9uc2UuXG4gICAgc2VydmVyRGVzY3JpcHRpb24uYWxsSG9zdHMuZm9yRWFjaCgoYWRkcmVzcykgPT4ge1xuICAgICAgICBpZiAoIXNlcnZlckRlc2NyaXB0aW9ucy5oYXMoYWRkcmVzcykpIHtcbiAgICAgICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5zZXQoYWRkcmVzcywgbmV3IHNlcnZlcl9kZXNjcmlwdGlvbl8xLlNlcnZlckRlc2NyaXB0aW9uKGFkZHJlc3MpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFJlbW92ZSBob3N0cyBub3QgaW4gdGhlIHJlc3BvbnNlLlxuICAgIGNvbnN0IGN1cnJlbnRBZGRyZXNzZXMgPSBBcnJheS5mcm9tKHNlcnZlckRlc2NyaXB0aW9ucy5rZXlzKCkpO1xuICAgIGNvbnN0IHJlc3BvbnNlQWRkcmVzc2VzID0gc2VydmVyRGVzY3JpcHRpb24uYWxsSG9zdHM7XG4gICAgY3VycmVudEFkZHJlc3Nlc1xuICAgICAgICAuZmlsdGVyKChhZGRyKSA9PiByZXNwb25zZUFkZHJlc3Nlcy5pbmRleE9mKGFkZHIpID09PSAtMSlcbiAgICAgICAgLmZvckVhY2goKGFkZHJlc3MpID0+IHtcbiAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShhZGRyZXNzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gW2NoZWNrSGFzUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMpLCBzZXROYW1lLCBtYXhTZXRWZXJzaW9uLCBtYXhFbGVjdGlvbklkXTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVJzV2l0aFByaW1hcnlGcm9tTWVtYmVyKHNlcnZlckRlc2NyaXB0aW9ucywgc2VydmVyRGVzY3JpcHRpb24sIHNldE5hbWUgPSBudWxsKSB7XG4gICAgaWYgKHNldE5hbWUgPT0gbnVsbCkge1xuICAgICAgICAvLyBUT0RPKE5PREUtMzQ4Myk6IHNob3VsZCBiZSBhbiBhcHByb3ByaWF0ZSBydW50aW1lIGVycm9yXG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdBcmd1bWVudCBcInNldE5hbWVcIiBpcyByZXF1aXJlZCBpZiBjb25uZWN0ZWQgdG8gYSByZXBsaWNhIHNldCcpO1xuICAgIH1cbiAgICBpZiAoc2V0TmFtZSAhPT0gc2VydmVyRGVzY3JpcHRpb24uc2V0TmFtZSB8fFxuICAgICAgICAoc2VydmVyRGVzY3JpcHRpb24ubWUgJiYgc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyAhPT0gc2VydmVyRGVzY3JpcHRpb24ubWUpKSB7XG4gICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyk7XG4gICAgfVxuICAgIHJldHVybiBjaGVja0hhc1ByaW1hcnkoc2VydmVyRGVzY3JpcHRpb25zKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVJzTm9QcmltYXJ5RnJvbU1lbWJlcihzZXJ2ZXJEZXNjcmlwdGlvbnMsIHNlcnZlckRlc2NyaXB0aW9uLCBzZXROYW1lID0gbnVsbCkge1xuICAgIGNvbnN0IHRvcG9sb2d5VHlwZSA9IGNvbW1vbl8xLlRvcG9sb2d5VHlwZS5SZXBsaWNhU2V0Tm9QcmltYXJ5O1xuICAgIHNldE5hbWUgPSBzZXROYW1lID8/IHNlcnZlckRlc2NyaXB0aW9uLnNldE5hbWU7XG4gICAgaWYgKHNldE5hbWUgIT09IHNlcnZlckRlc2NyaXB0aW9uLnNldE5hbWUpIHtcbiAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLmRlbGV0ZShzZXJ2ZXJEZXNjcmlwdGlvbi5hZGRyZXNzKTtcbiAgICAgICAgcmV0dXJuIFt0b3BvbG9neVR5cGUsIHNldE5hbWVdO1xuICAgIH1cbiAgICBzZXJ2ZXJEZXNjcmlwdGlvbi5hbGxIb3N0cy5mb3JFYWNoKChhZGRyZXNzKSA9PiB7XG4gICAgICAgIGlmICghc2VydmVyRGVzY3JpcHRpb25zLmhhcyhhZGRyZXNzKSkge1xuICAgICAgICAgICAgc2VydmVyRGVzY3JpcHRpb25zLnNldChhZGRyZXNzLCBuZXcgc2VydmVyX2Rlc2NyaXB0aW9uXzEuU2VydmVyRGVzY3JpcHRpb24oYWRkcmVzcykpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHNlcnZlckRlc2NyaXB0aW9uLm1lICYmIHNlcnZlckRlc2NyaXB0aW9uLmFkZHJlc3MgIT09IHNlcnZlckRlc2NyaXB0aW9uLm1lKSB7XG4gICAgICAgIHNlcnZlckRlc2NyaXB0aW9ucy5kZWxldGUoc2VydmVyRGVzY3JpcHRpb24uYWRkcmVzcyk7XG4gICAgfVxuICAgIHJldHVybiBbdG9wb2xvZ3lUeXBlLCBzZXROYW1lXTtcbn1cbmZ1bmN0aW9uIGNoZWNrSGFzUHJpbWFyeShzZXJ2ZXJEZXNjcmlwdGlvbnMpIHtcbiAgICBmb3IgKGNvbnN0IHNlcnZlckRlc2NyaXB0aW9uIG9mIHNlcnZlckRlc2NyaXB0aW9ucy52YWx1ZXMoKSkge1xuICAgICAgICBpZiAoc2VydmVyRGVzY3JpcHRpb24udHlwZSA9PT0gY29tbW9uXzEuU2VydmVyVHlwZS5SU1ByaW1hcnkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldFdpdGhQcmltYXJ5O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb21tb25fMS5Ub3BvbG9neVR5cGUuUmVwbGljYVNldE5vUHJpbWFyeTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRvcG9sb2d5X2Rlc2NyaXB0aW9uLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/topology_description.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js":
/*!********************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.ServerSessionPool = exports.ServerSession = exports.ClientSession = void 0;\nexports.maybeClearPinnedConnection = maybeClearPinnedConnection;\nexports.applySession = applySession;\nexports.updateSessionFromResponse = updateSessionFromResponse;\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst metrics_1 = __webpack_require__(/*! ./cmap/metrics */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/metrics.js\");\nconst shared_1 = __webpack_require__(/*! ./cmap/wire_protocol/shared */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/shared.js\");\nconst constants_1 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst mongo_types_1 = __webpack_require__(/*! ./mongo_types */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/mongo_types.js\");\nconst execute_operation_1 = __webpack_require__(/*! ./operations/execute_operation */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/execute_operation.js\");\nconst run_command_1 = __webpack_require__(/*! ./operations/run_command */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/operations/run_command.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst resource_management_1 = __webpack_require__(/*! ./resource_management */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/resource_management.js\");\nconst common_1 = __webpack_require__(/*! ./sdam/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst timeout_1 = __webpack_require__(/*! ./timeout */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\");\nconst transactions_1 = __webpack_require__(/*! ./transactions */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/transactions.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nconst minWireVersionForShardedTransactions = 8;\n/**\n * A class representing a client session on the server\n *\n * NOTE: not meant to be instantiated directly.\n * @public\n */\nclass ClientSession extends mongo_types_1.TypedEventEmitter {\n    /**\n     * Create a client session.\n     * @internal\n     * @param client - The current client\n     * @param sessionPool - The server session pool (Internal Class)\n     * @param options - Optional settings\n     * @param clientOptions - Optional settings provided when creating a MongoClient\n     */\n    constructor(client, sessionPool, options, clientOptions) {\n        super();\n        /** @internal */\n        this.timeoutContext = null;\n        this.on('error', utils_1.noop);\n        if (client == null) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError('ClientSession requires a MongoClient');\n        }\n        if (sessionPool == null || !(sessionPool instanceof ServerSessionPool)) {\n            // TODO(NODE-3483)\n            throw new error_1.MongoRuntimeError('ClientSession requires a ServerSessionPool');\n        }\n        options = options ?? {};\n        this.snapshotEnabled = options.snapshot === true;\n        if (options.causalConsistency === true && this.snapshotEnabled) {\n            throw new error_1.MongoInvalidArgumentError('Properties \"causalConsistency\" and \"snapshot\" are mutually exclusive');\n        }\n        this.client = client;\n        this.sessionPool = sessionPool;\n        this.hasEnded = false;\n        this.clientOptions = clientOptions;\n        this.timeoutMS = options.defaultTimeoutMS ?? client.s.options?.timeoutMS;\n        this.explicit = !!options.explicit;\n        this._serverSession = this.explicit ? this.sessionPool.acquire() : null;\n        this.txnNumberIncrement = 0;\n        const defaultCausalConsistencyValue = this.explicit && options.snapshot !== true;\n        this.supports = {\n            // if we can enable causal consistency, do so by default\n            causalConsistency: options.causalConsistency ?? defaultCausalConsistencyValue\n        };\n        this.clusterTime = options.initialClusterTime;\n        this.operationTime = undefined;\n        this.owner = options.owner;\n        this.defaultTransactionOptions = { ...options.defaultTransactionOptions };\n        this.transaction = new transactions_1.Transaction();\n    }\n    /** The server id associated with this session */\n    get id() {\n        return this.serverSession?.id;\n    }\n    get serverSession() {\n        let serverSession = this._serverSession;\n        if (serverSession == null) {\n            if (this.explicit) {\n                throw new error_1.MongoRuntimeError('Unexpected null serverSession for an explicit session');\n            }\n            if (this.hasEnded) {\n                throw new error_1.MongoRuntimeError('Unexpected null serverSession for an ended implicit session');\n            }\n            serverSession = this.sessionPool.acquire();\n            this._serverSession = serverSession;\n        }\n        return serverSession;\n    }\n    get loadBalanced() {\n        return this.client.topology?.description.type === common_1.TopologyType.LoadBalanced;\n    }\n    /** @internal */\n    pin(conn) {\n        if (this.pinnedConnection) {\n            throw TypeError('Cannot pin multiple connections to the same session');\n        }\n        this.pinnedConnection = conn;\n        conn.emit(constants_1.PINNED, this.inTransaction() ? metrics_1.ConnectionPoolMetrics.TXN : metrics_1.ConnectionPoolMetrics.CURSOR);\n    }\n    /** @internal */\n    unpin(options) {\n        if (this.loadBalanced) {\n            return maybeClearPinnedConnection(this, options);\n        }\n        this.transaction.unpinServer();\n    }\n    get isPinned() {\n        return this.loadBalanced ? !!this.pinnedConnection : this.transaction.isPinned;\n    }\n    /**\n     * Frees any client-side resources held by the current session.  If a session is in a transaction,\n     * the transaction is aborted.\n     *\n     * Does not end the session on the server.\n     *\n     * @param options - Optional settings. Currently reserved for future use\n     */\n    async endSession(options) {\n        try {\n            if (this.inTransaction()) {\n                await this.abortTransaction({ ...options, throwTimeout: true });\n            }\n        }\n        catch (error) {\n            // spec indicates that we should ignore all errors for `endSessions`\n            if (error.name === 'MongoOperationTimeoutError')\n                throw error;\n            (0, utils_1.squashError)(error);\n        }\n        finally {\n            if (!this.hasEnded) {\n                const serverSession = this.serverSession;\n                if (serverSession != null) {\n                    // release the server session back to the pool\n                    this.sessionPool.release(serverSession);\n                    // Store a clone of the server session for reference (debugging)\n                    this._serverSession = new ServerSession(serverSession);\n                }\n                // mark the session as ended, and emit a signal\n                this.hasEnded = true;\n                this.emit('ended', this);\n            }\n            maybeClearPinnedConnection(this, { force: true, ...options });\n        }\n    }\n    /** @internal */\n    async asyncDispose() {\n        await this.endSession({ force: true });\n    }\n    /**\n     * Advances the operationTime for a ClientSession.\n     *\n     * @param operationTime - the `BSON.Timestamp` of the operation type it is desired to advance to\n     */\n    advanceOperationTime(operationTime) {\n        if (this.operationTime == null) {\n            this.operationTime = operationTime;\n            return;\n        }\n        if (operationTime.greaterThan(this.operationTime)) {\n            this.operationTime = operationTime;\n        }\n    }\n    /**\n     * Advances the clusterTime for a ClientSession to the provided clusterTime of another ClientSession\n     *\n     * @param clusterTime - the $clusterTime returned by the server from another session in the form of a document containing the `BSON.Timestamp` clusterTime and signature\n     */\n    advanceClusterTime(clusterTime) {\n        if (!clusterTime || typeof clusterTime !== 'object') {\n            throw new error_1.MongoInvalidArgumentError('input cluster time must be an object');\n        }\n        if (!clusterTime.clusterTime || clusterTime.clusterTime._bsontype !== 'Timestamp') {\n            throw new error_1.MongoInvalidArgumentError('input cluster time \"clusterTime\" property must be a valid BSON Timestamp');\n        }\n        if (!clusterTime.signature ||\n            clusterTime.signature.hash?._bsontype !== 'Binary' ||\n            (typeof clusterTime.signature.keyId !== 'bigint' &&\n                typeof clusterTime.signature.keyId !== 'number' &&\n                clusterTime.signature.keyId?._bsontype !== 'Long') // apparently we decode the key to number?\n        ) {\n            throw new error_1.MongoInvalidArgumentError('input cluster time must have a valid \"signature\" property with BSON Binary hash and BSON Long keyId');\n        }\n        (0, common_1._advanceClusterTime)(this, clusterTime);\n    }\n    /**\n     * Used to determine if this session equals another\n     *\n     * @param session - The session to compare to\n     */\n    equals(session) {\n        if (!(session instanceof ClientSession)) {\n            return false;\n        }\n        if (this.id == null || session.id == null) {\n            return false;\n        }\n        return utils_1.ByteUtils.equals(this.id.id.buffer, session.id.id.buffer);\n    }\n    /**\n     * Increment the transaction number on the internal ServerSession\n     *\n     * @privateRemarks\n     * This helper increments a value stored on the client session that will be\n     * added to the serverSession's txnNumber upon applying it to a command.\n     * This is because the serverSession is lazily acquired after a connection is obtained\n     */\n    incrementTransactionNumber() {\n        this.txnNumberIncrement += 1;\n    }\n    /** @returns whether this session is currently in a transaction or not */\n    inTransaction() {\n        return this.transaction.isActive;\n    }\n    /**\n     * Starts a new transaction with the given options.\n     *\n     * @remarks\n     * **IMPORTANT**: Running operations in parallel is not supported during a transaction. The use of `Promise.all`,\n     * `Promise.allSettled`, `Promise.race`, etc to parallelize operations inside a transaction is\n     * undefined behaviour.\n     *\n     * @param options - Options for the transaction\n     */\n    startTransaction(options) {\n        if (this.snapshotEnabled) {\n            throw new error_1.MongoCompatibilityError('Transactions are not supported in snapshot sessions');\n        }\n        if (this.inTransaction()) {\n            throw new error_1.MongoTransactionError('Transaction already in progress');\n        }\n        if (this.isPinned && this.transaction.isCommitted) {\n            this.unpin();\n        }\n        const topologyMaxWireVersion = (0, utils_1.maxWireVersion)(this.client.topology);\n        if ((0, shared_1.isSharded)(this.client.topology) &&\n            topologyMaxWireVersion != null &&\n            topologyMaxWireVersion < minWireVersionForShardedTransactions) {\n            throw new error_1.MongoCompatibilityError('Transactions are not supported on sharded clusters in MongoDB < 4.2.');\n        }\n        this.commitAttempted = false;\n        // increment txnNumber\n        this.incrementTransactionNumber();\n        // create transaction state\n        this.transaction = new transactions_1.Transaction({\n            readConcern: options?.readConcern ??\n                this.defaultTransactionOptions.readConcern ??\n                this.clientOptions?.readConcern,\n            writeConcern: options?.writeConcern ??\n                this.defaultTransactionOptions.writeConcern ??\n                this.clientOptions?.writeConcern,\n            readPreference: options?.readPreference ??\n                this.defaultTransactionOptions.readPreference ??\n                this.clientOptions?.readPreference,\n            maxCommitTimeMS: options?.maxCommitTimeMS ?? this.defaultTransactionOptions.maxCommitTimeMS\n        });\n        this.transaction.transition(transactions_1.TxnState.STARTING_TRANSACTION);\n    }\n    /**\n     * Commits the currently active transaction in this session.\n     *\n     * @param options - Optional options, can be used to override `defaultTimeoutMS`.\n     */\n    async commitTransaction(options) {\n        if (this.transaction.state === transactions_1.TxnState.NO_TRANSACTION) {\n            throw new error_1.MongoTransactionError('No transaction started');\n        }\n        if (this.transaction.state === transactions_1.TxnState.STARTING_TRANSACTION ||\n            this.transaction.state === transactions_1.TxnState.TRANSACTION_COMMITTED_EMPTY) {\n            // the transaction was never started, we can safely exit here\n            this.transaction.transition(transactions_1.TxnState.TRANSACTION_COMMITTED_EMPTY);\n            return;\n        }\n        if (this.transaction.state === transactions_1.TxnState.TRANSACTION_ABORTED) {\n            throw new error_1.MongoTransactionError('Cannot call commitTransaction after calling abortTransaction');\n        }\n        const command = { commitTransaction: 1 };\n        const timeoutMS = typeof options?.timeoutMS === 'number'\n            ? options.timeoutMS\n            : typeof this.timeoutMS === 'number'\n                ? this.timeoutMS\n                : null;\n        const wc = this.transaction.options.writeConcern ?? this.clientOptions?.writeConcern;\n        if (wc != null) {\n            if (timeoutMS == null && this.timeoutContext == null) {\n                write_concern_1.WriteConcern.apply(command, { wtimeoutMS: 10000, w: 'majority', ...wc });\n            }\n            else {\n                const wcKeys = Object.keys(wc);\n                if (wcKeys.length > 2 || (!wcKeys.includes('wtimeoutMS') && !wcKeys.includes('wTimeoutMS')))\n                    // if the write concern was specified with wTimeoutMS, then we set both wtimeoutMS and wTimeoutMS, guaranteeing at least two keys, so if we have more than two keys, then we can automatically assume that we should add the write concern to the command. If it has 2 or fewer keys, we need to check that those keys aren't the wtimeoutMS or wTimeoutMS options before we add the write concern to the command\n                    write_concern_1.WriteConcern.apply(command, { ...wc, wtimeoutMS: undefined });\n            }\n        }\n        if (this.transaction.state === transactions_1.TxnState.TRANSACTION_COMMITTED || this.commitAttempted) {\n            if (timeoutMS == null && this.timeoutContext == null) {\n                write_concern_1.WriteConcern.apply(command, { wtimeoutMS: 10000, ...wc, w: 'majority' });\n            }\n            else {\n                write_concern_1.WriteConcern.apply(command, { w: 'majority', ...wc, wtimeoutMS: undefined });\n            }\n        }\n        if (typeof this.transaction.options.maxTimeMS === 'number') {\n            command.maxTimeMS = this.transaction.options.maxTimeMS;\n        }\n        if (this.transaction.recoveryToken) {\n            command.recoveryToken = this.transaction.recoveryToken;\n        }\n        const operation = new run_command_1.RunAdminCommandOperation(command, {\n            session: this,\n            readPreference: read_preference_1.ReadPreference.primary,\n            bypassPinningCheck: true\n        });\n        const timeoutContext = this.timeoutContext ??\n            (typeof timeoutMS === 'number'\n                ? timeout_1.TimeoutContext.create({\n                    serverSelectionTimeoutMS: this.clientOptions.serverSelectionTimeoutMS,\n                    socketTimeoutMS: this.clientOptions.socketTimeoutMS,\n                    timeoutMS\n                })\n                : null);\n        try {\n            await (0, execute_operation_1.executeOperation)(this.client, operation, timeoutContext);\n            this.commitAttempted = undefined;\n            return;\n        }\n        catch (firstCommitError) {\n            this.commitAttempted = true;\n            if (firstCommitError instanceof error_1.MongoError && (0, error_1.isRetryableWriteError)(firstCommitError)) {\n                // SPEC-1185: apply majority write concern when retrying commitTransaction\n                write_concern_1.WriteConcern.apply(command, { wtimeoutMS: 10000, ...wc, w: 'majority' });\n                // per txns spec, must unpin session in this case\n                this.unpin({ force: true });\n                try {\n                    await (0, execute_operation_1.executeOperation)(this.client, new run_command_1.RunAdminCommandOperation(command, {\n                        session: this,\n                        readPreference: read_preference_1.ReadPreference.primary,\n                        bypassPinningCheck: true\n                    }), timeoutContext);\n                    return;\n                }\n                catch (retryCommitError) {\n                    // If the retry failed, we process that error instead of the original\n                    if (shouldAddUnknownTransactionCommitResultLabel(retryCommitError)) {\n                        retryCommitError.addErrorLabel(error_1.MongoErrorLabel.UnknownTransactionCommitResult);\n                    }\n                    if (shouldUnpinAfterCommitError(retryCommitError)) {\n                        this.unpin({ error: retryCommitError });\n                    }\n                    throw retryCommitError;\n                }\n            }\n            if (shouldAddUnknownTransactionCommitResultLabel(firstCommitError)) {\n                firstCommitError.addErrorLabel(error_1.MongoErrorLabel.UnknownTransactionCommitResult);\n            }\n            if (shouldUnpinAfterCommitError(firstCommitError)) {\n                this.unpin({ error: firstCommitError });\n            }\n            throw firstCommitError;\n        }\n        finally {\n            this.transaction.transition(transactions_1.TxnState.TRANSACTION_COMMITTED);\n        }\n    }\n    async abortTransaction(options) {\n        if (this.transaction.state === transactions_1.TxnState.NO_TRANSACTION) {\n            throw new error_1.MongoTransactionError('No transaction started');\n        }\n        if (this.transaction.state === transactions_1.TxnState.STARTING_TRANSACTION) {\n            // the transaction was never started, we can safely exit here\n            this.transaction.transition(transactions_1.TxnState.TRANSACTION_ABORTED);\n            return;\n        }\n        if (this.transaction.state === transactions_1.TxnState.TRANSACTION_ABORTED) {\n            throw new error_1.MongoTransactionError('Cannot call abortTransaction twice');\n        }\n        if (this.transaction.state === transactions_1.TxnState.TRANSACTION_COMMITTED ||\n            this.transaction.state === transactions_1.TxnState.TRANSACTION_COMMITTED_EMPTY) {\n            throw new error_1.MongoTransactionError('Cannot call abortTransaction after calling commitTransaction');\n        }\n        const command = { abortTransaction: 1 };\n        const timeoutMS = typeof options?.timeoutMS === 'number'\n            ? options.timeoutMS\n            : this.timeoutContext?.csotEnabled()\n                ? this.timeoutContext.timeoutMS // refresh timeoutMS for abort operation\n                : typeof this.timeoutMS === 'number'\n                    ? this.timeoutMS\n                    : null;\n        const timeoutContext = timeoutMS != null\n            ? timeout_1.TimeoutContext.create({\n                timeoutMS,\n                serverSelectionTimeoutMS: this.clientOptions.serverSelectionTimeoutMS,\n                socketTimeoutMS: this.clientOptions.socketTimeoutMS\n            })\n            : null;\n        const wc = this.transaction.options.writeConcern ?? this.clientOptions?.writeConcern;\n        if (wc != null && timeoutMS == null) {\n            write_concern_1.WriteConcern.apply(command, { wtimeoutMS: 10000, w: 'majority', ...wc });\n        }\n        if (this.transaction.recoveryToken) {\n            command.recoveryToken = this.transaction.recoveryToken;\n        }\n        const operation = new run_command_1.RunAdminCommandOperation(command, {\n            session: this,\n            readPreference: read_preference_1.ReadPreference.primary,\n            bypassPinningCheck: true\n        });\n        try {\n            await (0, execute_operation_1.executeOperation)(this.client, operation, timeoutContext);\n            this.unpin();\n            return;\n        }\n        catch (firstAbortError) {\n            this.unpin();\n            if (firstAbortError.name === 'MongoRuntimeError')\n                throw firstAbortError;\n            if (options?.throwTimeout && firstAbortError.name === 'MongoOperationTimeoutError') {\n                throw firstAbortError;\n            }\n            if (firstAbortError instanceof error_1.MongoError && (0, error_1.isRetryableWriteError)(firstAbortError)) {\n                try {\n                    await (0, execute_operation_1.executeOperation)(this.client, operation, timeoutContext);\n                    return;\n                }\n                catch (secondAbortError) {\n                    if (secondAbortError.name === 'MongoRuntimeError')\n                        throw secondAbortError;\n                    if (options?.throwTimeout && secondAbortError.name === 'MongoOperationTimeoutError') {\n                        throw secondAbortError;\n                    }\n                    // we do not retry the retry\n                }\n            }\n            // The spec indicates that if the operation times out or fails with a non-retryable error, we should ignore all errors on `abortTransaction`\n        }\n        finally {\n            this.transaction.transition(transactions_1.TxnState.TRANSACTION_ABORTED);\n            if (this.loadBalanced) {\n                maybeClearPinnedConnection(this, { force: false });\n            }\n        }\n    }\n    /**\n     * This is here to ensure that ClientSession is never serialized to BSON.\n     */\n    toBSON() {\n        throw new error_1.MongoRuntimeError('ClientSession cannot be serialized to BSON.');\n    }\n    /**\n     * Starts a transaction and runs a provided function, ensuring the commitTransaction is always attempted when all operations run in the function have completed.\n     *\n     * **IMPORTANT:** This method requires the function passed in to return a Promise. That promise must be made by `await`-ing all operations in such a way that rejections are propagated to the returned promise.\n     *\n     * **IMPORTANT:** Running operations in parallel is not supported during a transaction. The use of `Promise.all`,\n     * `Promise.allSettled`, `Promise.race`, etc to parallelize operations inside a transaction is\n     * undefined behaviour.\n     *\n     * **IMPORTANT:** When running an operation inside a `withTransaction` callback, if it is not\n     * provided the explicit session in its options, it will not be part of the transaction and it will not respect timeoutMS.\n     *\n     *\n     * @remarks\n     * - If all operations successfully complete and the `commitTransaction` operation is successful, then the provided function will return the result of the provided function.\n     * - If the transaction is unable to complete or an error is thrown from within the provided function, then the provided function will throw an error.\n     *   - If the transaction is manually aborted within the provided function it will not throw.\n     * - If the driver needs to attempt to retry the operations, the provided function may be called multiple times.\n     *\n     * Checkout a descriptive example here:\n     * @see https://www.mongodb.com/blog/post/quick-start-nodejs--mongodb--how-to-implement-transactions\n     *\n     * If a command inside withTransaction fails:\n     * - It may cause the transaction on the server to be aborted.\n     * - This situation is normally handled transparently by the driver.\n     * - However, if the application catches such an error and does not rethrow it, the driver will not be able to determine whether the transaction was aborted or not.\n     * - The driver will then retry the transaction indefinitely.\n     *\n     * To avoid this situation, the application must not silently handle errors within the provided function.\n     * If the application needs to handle errors within, it must await all operations such that if an operation is rejected it becomes the rejection of the callback function passed into withTransaction.\n     *\n     * @param fn - callback to run within a transaction\n     * @param options - optional settings for the transaction\n     * @returns A raw command response or undefined\n     */\n    async withTransaction(fn, options) {\n        const MAX_TIMEOUT = 120000;\n        const timeoutMS = options?.timeoutMS ?? this.timeoutMS ?? null;\n        this.timeoutContext =\n            timeoutMS != null\n                ? timeout_1.TimeoutContext.create({\n                    timeoutMS,\n                    serverSelectionTimeoutMS: this.clientOptions.serverSelectionTimeoutMS,\n                    socketTimeoutMS: this.clientOptions.socketTimeoutMS\n                })\n                : null;\n        const startTime = this.timeoutContext?.csotEnabled() ? this.timeoutContext.start : (0, utils_1.now)();\n        let committed = false;\n        let result;\n        try {\n            while (!committed) {\n                this.startTransaction(options); // may throw on error\n                try {\n                    const promise = fn(this);\n                    if (!(0, utils_1.isPromiseLike)(promise)) {\n                        throw new error_1.MongoInvalidArgumentError('Function provided to `withTransaction` must return a Promise');\n                    }\n                    result = await promise;\n                    if (this.transaction.state === transactions_1.TxnState.NO_TRANSACTION ||\n                        this.transaction.state === transactions_1.TxnState.TRANSACTION_COMMITTED ||\n                        this.transaction.state === transactions_1.TxnState.TRANSACTION_ABORTED) {\n                        // Assume callback intentionally ended the transaction\n                        return result;\n                    }\n                }\n                catch (fnError) {\n                    if (!(fnError instanceof error_1.MongoError) || fnError instanceof error_1.MongoInvalidArgumentError) {\n                        await this.abortTransaction();\n                        throw fnError;\n                    }\n                    if (this.transaction.state === transactions_1.TxnState.STARTING_TRANSACTION ||\n                        this.transaction.state === transactions_1.TxnState.TRANSACTION_IN_PROGRESS) {\n                        await this.abortTransaction();\n                    }\n                    if (fnError.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError) &&\n                        (this.timeoutContext != null || (0, utils_1.now)() - startTime < MAX_TIMEOUT)) {\n                        continue;\n                    }\n                    throw fnError;\n                }\n                while (!committed) {\n                    try {\n                        /*\n                         * We will rely on ClientSession.commitTransaction() to\n                         * apply a majority write concern if commitTransaction is\n                         * being retried (see: DRIVERS-601)\n                         */\n                        await this.commitTransaction();\n                        committed = true;\n                    }\n                    catch (commitError) {\n                        /*\n                         * Note: a maxTimeMS error will have the MaxTimeMSExpired\n                         * code (50) and can be reported as a top-level error or\n                         * inside writeConcernError, ex.\n                         * { ok:0, code: 50, codeName: 'MaxTimeMSExpired' }\n                         * { ok:1, writeConcernError: { code: 50, codeName: 'MaxTimeMSExpired' } }\n                         */\n                        if (!isMaxTimeMSExpiredError(commitError) &&\n                            commitError.hasErrorLabel(error_1.MongoErrorLabel.UnknownTransactionCommitResult) &&\n                            (this.timeoutContext != null || (0, utils_1.now)() - startTime < MAX_TIMEOUT)) {\n                            continue;\n                        }\n                        if (commitError.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError) &&\n                            (this.timeoutContext != null || (0, utils_1.now)() - startTime < MAX_TIMEOUT)) {\n                            break;\n                        }\n                        throw commitError;\n                    }\n                }\n            }\n            return result;\n        }\n        finally {\n            this.timeoutContext = null;\n        }\n    }\n}\nexports.ClientSession = ClientSession;\n(0, resource_management_1.configureResourceManagement)(ClientSession.prototype);\nconst NON_DETERMINISTIC_WRITE_CONCERN_ERRORS = new Set([\n    'CannotSatisfyWriteConcern',\n    'UnknownReplWriteConcern',\n    'UnsatisfiableWriteConcern'\n]);\nfunction shouldUnpinAfterCommitError(commitError) {\n    if (commitError instanceof error_1.MongoError) {\n        if ((0, error_1.isRetryableWriteError)(commitError) ||\n            commitError instanceof error_1.MongoWriteConcernError ||\n            isMaxTimeMSExpiredError(commitError)) {\n            if (isUnknownTransactionCommitResult(commitError)) {\n                // per txns spec, must unpin session in this case\n                return true;\n            }\n        }\n        else if (commitError.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction shouldAddUnknownTransactionCommitResultLabel(commitError) {\n    let ok = (0, error_1.isRetryableWriteError)(commitError);\n    ok ||= commitError instanceof error_1.MongoWriteConcernError;\n    ok ||= isMaxTimeMSExpiredError(commitError);\n    ok &&= isUnknownTransactionCommitResult(commitError);\n    return ok;\n}\nfunction isUnknownTransactionCommitResult(err) {\n    const isNonDeterministicWriteConcernError = err instanceof error_1.MongoServerError &&\n        err.codeName &&\n        NON_DETERMINISTIC_WRITE_CONCERN_ERRORS.has(err.codeName);\n    return (isMaxTimeMSExpiredError(err) ||\n        (!isNonDeterministicWriteConcernError &&\n            err.code !== error_1.MONGODB_ERROR_CODES.UnsatisfiableWriteConcern &&\n            err.code !== error_1.MONGODB_ERROR_CODES.UnknownReplWriteConcern));\n}\nfunction maybeClearPinnedConnection(session, options) {\n    // unpin a connection if it has been pinned\n    const conn = session.pinnedConnection;\n    const error = options?.error;\n    if (session.inTransaction() &&\n        error &&\n        error instanceof error_1.MongoError &&\n        error.hasErrorLabel(error_1.MongoErrorLabel.TransientTransactionError)) {\n        return;\n    }\n    const topology = session.client.topology;\n    // NOTE: the spec talks about what to do on a network error only, but the tests seem to\n    //       to validate that we don't unpin on _all_ errors?\n    if (conn && topology != null) {\n        const servers = Array.from(topology.s.servers.values());\n        const loadBalancer = servers[0];\n        if (options?.error == null || options?.force) {\n            loadBalancer.pool.checkIn(conn);\n            session.pinnedConnection = undefined;\n            conn.emit(constants_1.UNPINNED, session.transaction.state !== transactions_1.TxnState.NO_TRANSACTION\n                ? metrics_1.ConnectionPoolMetrics.TXN\n                : metrics_1.ConnectionPoolMetrics.CURSOR);\n            if (options?.forceClear) {\n                loadBalancer.pool.clear({ serviceId: conn.serviceId });\n            }\n        }\n    }\n}\nfunction isMaxTimeMSExpiredError(err) {\n    if (err == null || !(err instanceof error_1.MongoServerError)) {\n        return false;\n    }\n    return (err.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired ||\n        err.writeConcernError?.code === error_1.MONGODB_ERROR_CODES.MaxTimeMSExpired);\n}\n/**\n * Reflects the existence of a session on the server. Can be reused by the session pool.\n * WARNING: not meant to be instantiated directly. For internal use only.\n * @public\n */\nclass ServerSession {\n    /** @internal */\n    constructor(cloned) {\n        if (cloned != null) {\n            const idBytes = Buffer.allocUnsafe(16);\n            idBytes.set(cloned.id.id.buffer);\n            this.id = { id: new bson_1.Binary(idBytes, cloned.id.id.sub_type) };\n            this.lastUse = cloned.lastUse;\n            this.txnNumber = cloned.txnNumber;\n            this.isDirty = cloned.isDirty;\n            return;\n        }\n        this.id = { id: new bson_1.Binary((0, utils_1.uuidV4)(), bson_1.Binary.SUBTYPE_UUID) };\n        this.lastUse = (0, utils_1.now)();\n        this.txnNumber = 0;\n        this.isDirty = false;\n    }\n    /**\n     * Determines if the server session has timed out.\n     *\n     * @param sessionTimeoutMinutes - The server's \"logicalSessionTimeoutMinutes\"\n     */\n    hasTimedOut(sessionTimeoutMinutes) {\n        // Take the difference of the lastUse timestamp and now, which will result in a value in\n        // milliseconds, and then convert milliseconds to minutes to compare to `sessionTimeoutMinutes`\n        const idleTimeMinutes = Math.round((((0, utils_1.calculateDurationInMs)(this.lastUse) % 86400000) % 3600000) / 60000);\n        return idleTimeMinutes > sessionTimeoutMinutes - 1;\n    }\n}\nexports.ServerSession = ServerSession;\n/**\n * Maintains a pool of Server Sessions.\n * For internal use only\n * @internal\n */\nclass ServerSessionPool {\n    constructor(client) {\n        if (client == null) {\n            throw new error_1.MongoRuntimeError('ServerSessionPool requires a MongoClient');\n        }\n        this.client = client;\n        this.sessions = new utils_1.List();\n    }\n    /**\n     * Acquire a Server Session from the pool.\n     * Iterates through each session in the pool, removing any stale sessions\n     * along the way. The first non-stale session found is removed from the\n     * pool and returned. If no non-stale session is found, a new ServerSession is created.\n     */\n    acquire() {\n        const sessionTimeoutMinutes = this.client.topology?.logicalSessionTimeoutMinutes ?? 10;\n        let session = null;\n        // Try to obtain from session pool\n        while (this.sessions.length > 0) {\n            const potentialSession = this.sessions.shift();\n            if (potentialSession != null &&\n                (!!this.client.topology?.loadBalanced ||\n                    !potentialSession.hasTimedOut(sessionTimeoutMinutes))) {\n                session = potentialSession;\n                break;\n            }\n        }\n        // If nothing valid came from the pool make a new one\n        if (session == null) {\n            session = new ServerSession();\n        }\n        return session;\n    }\n    /**\n     * Release a session to the session pool\n     * Adds the session back to the session pool if the session has not timed out yet.\n     * This method also removes any stale sessions from the pool.\n     *\n     * @param session - The session to release to the pool\n     */\n    release(session) {\n        const sessionTimeoutMinutes = this.client.topology?.logicalSessionTimeoutMinutes ?? 10;\n        if (this.client.topology?.loadBalanced && !sessionTimeoutMinutes) {\n            this.sessions.unshift(session);\n        }\n        if (!sessionTimeoutMinutes) {\n            return;\n        }\n        this.sessions.prune(session => session.hasTimedOut(sessionTimeoutMinutes));\n        if (!session.hasTimedOut(sessionTimeoutMinutes)) {\n            if (session.isDirty) {\n                return;\n            }\n            // otherwise, readd this session to the session pool\n            this.sessions.unshift(session);\n        }\n    }\n}\nexports.ServerSessionPool = ServerSessionPool;\n/**\n * Optionally decorate a command with sessions specific keys\n *\n * @param session - the session tracking transaction state\n * @param command - the command to decorate\n * @param options - Optional settings passed to calling operation\n *\n * @internal\n */\nfunction applySession(session, command, options) {\n    if (session.hasEnded) {\n        return new error_1.MongoExpiredSessionError();\n    }\n    // May acquire serverSession here\n    const serverSession = session.serverSession;\n    if (serverSession == null) {\n        return new error_1.MongoRuntimeError('Unable to acquire server session');\n    }\n    if (options.writeConcern?.w === 0) {\n        if (session && session.explicit) {\n            // Error if user provided an explicit session to an unacknowledged write (SPEC-1019)\n            return new error_1.MongoAPIError('Cannot have explicit session with unacknowledged writes');\n        }\n        return;\n    }\n    // mark the last use of this session, and apply the `lsid`\n    serverSession.lastUse = (0, utils_1.now)();\n    command.lsid = serverSession.id;\n    const inTxnOrTxnCommand = session.inTransaction() || (0, transactions_1.isTransactionCommand)(command);\n    const isRetryableWrite = !!options.willRetryWrite;\n    if (isRetryableWrite || inTxnOrTxnCommand) {\n        serverSession.txnNumber += session.txnNumberIncrement;\n        session.txnNumberIncrement = 0;\n        // TODO(NODE-2674): Preserve int64 sent from MongoDB\n        command.txnNumber = bson_1.Long.fromNumber(serverSession.txnNumber);\n    }\n    if (!inTxnOrTxnCommand) {\n        if (session.transaction.state !== transactions_1.TxnState.NO_TRANSACTION) {\n            session.transaction.transition(transactions_1.TxnState.NO_TRANSACTION);\n        }\n        if (session.supports.causalConsistency &&\n            session.operationTime &&\n            (0, utils_1.commandSupportsReadConcern)(command)) {\n            command.readConcern = command.readConcern || {};\n            Object.assign(command.readConcern, { afterClusterTime: session.operationTime });\n        }\n        else if (session.snapshotEnabled) {\n            command.readConcern = command.readConcern || { level: read_concern_1.ReadConcernLevel.snapshot };\n            if (session.snapshotTime != null) {\n                Object.assign(command.readConcern, { atClusterTime: session.snapshotTime });\n            }\n        }\n        return;\n    }\n    // now attempt to apply transaction-specific sessions data\n    // `autocommit` must always be false to differentiate from retryable writes\n    command.autocommit = false;\n    if (session.transaction.state === transactions_1.TxnState.STARTING_TRANSACTION) {\n        session.transaction.transition(transactions_1.TxnState.TRANSACTION_IN_PROGRESS);\n        command.startTransaction = true;\n        const readConcern = session.transaction.options.readConcern || session?.clientOptions?.readConcern;\n        if (readConcern) {\n            command.readConcern = readConcern;\n        }\n        if (session.supports.causalConsistency && session.operationTime) {\n            command.readConcern = command.readConcern || {};\n            Object.assign(command.readConcern, { afterClusterTime: session.operationTime });\n        }\n    }\n    return;\n}\nfunction updateSessionFromResponse(session, document) {\n    if (document.$clusterTime) {\n        (0, common_1._advanceClusterTime)(session, document.$clusterTime);\n    }\n    if (document.operationTime && session && session.supports.causalConsistency) {\n        session.advanceOperationTime(document.operationTime);\n    }\n    if (document.recoveryToken && session && session.inTransaction()) {\n        session.transaction._recoveryToken = document.recoveryToken;\n    }\n    if (session?.snapshotEnabled && session.snapshotTime == null) {\n        // find and aggregate commands return atClusterTime on the cursor\n        // distinct includes it in the response body\n        const atClusterTime = document.atClusterTime;\n        if (atClusterTime) {\n            session.snapshotTime = atClusterTime;\n        }\n    }\n}\n//# sourceMappingURL=sessions.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3Nlc3Npb25zLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHlCQUF5QixHQUFHLHFCQUFxQixHQUFHLHFCQUFxQjtBQUN6RSxrQ0FBa0M7QUFDbEMsb0JBQW9CO0FBQ3BCLGlDQUFpQztBQUNqQyxlQUFlLG1CQUFPLENBQUMsMEZBQVE7QUFDL0Isa0JBQWtCLG1CQUFPLENBQUMsMEdBQWdCO0FBQzFDLGlCQUFpQixtQkFBTyxDQUFDLG9JQUE2QjtBQUN0RCxvQkFBb0IsbUJBQU8sQ0FBQyxvR0FBYTtBQUN6QyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQyxzQkFBc0IsbUJBQU8sQ0FBQyx3R0FBZTtBQUM3Qyw0QkFBNEIsbUJBQU8sQ0FBQywwSUFBZ0M7QUFDcEUsc0JBQXNCLG1CQUFPLENBQUMsOEhBQTBCO0FBQ3hELHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDckQsOEJBQThCLG1CQUFPLENBQUMsd0hBQXVCO0FBQzdELGlCQUFpQixtQkFBTyxDQUFDLHdHQUFlO0FBQ3hDLGtCQUFrQixtQkFBTyxDQUFDLGdHQUFXO0FBQ3JDLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQyx3QkFBd0IsbUJBQU8sQ0FBQyw0R0FBaUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxnQ0FBZ0M7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLHlCQUF5QjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxhQUFhO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOERBQThELHlDQUF5QztBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFLDhCQUE4QjtBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RCx5Q0FBeUM7QUFDdkc7QUFDQTtBQUNBLDhEQUE4RCw2Q0FBNkM7QUFDM0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RCx5Q0FBeUM7QUFDdkc7QUFDQSw2QkFBNkIsYUFBYTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMseUJBQXlCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIseUJBQXlCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCx5Q0FBeUM7QUFDbkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxjQUFjO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdEO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLDZCQUE2QiwyQkFBMkI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLDJCQUEyQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELHlDQUF5QztBQUMxRjtBQUNBO0FBQ0EsMkRBQTJEO0FBQzNEO0FBQ0EscURBQXFELHFDQUFxQztBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCx5Q0FBeUM7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvc2Vzc2lvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlNlcnZlclNlc3Npb25Qb29sID0gZXhwb3J0cy5TZXJ2ZXJTZXNzaW9uID0gZXhwb3J0cy5DbGllbnRTZXNzaW9uID0gdm9pZCAwO1xuZXhwb3J0cy5tYXliZUNsZWFyUGlubmVkQ29ubmVjdGlvbiA9IG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uO1xuZXhwb3J0cy5hcHBseVNlc3Npb24gPSBhcHBseVNlc3Npb247XG5leHBvcnRzLnVwZGF0ZVNlc3Npb25Gcm9tUmVzcG9uc2UgPSB1cGRhdGVTZXNzaW9uRnJvbVJlc3BvbnNlO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4vYnNvblwiKTtcbmNvbnN0IG1ldHJpY3NfMSA9IHJlcXVpcmUoXCIuL2NtYXAvbWV0cmljc1wiKTtcbmNvbnN0IHNoYXJlZF8xID0gcmVxdWlyZShcIi4vY21hcC93aXJlX3Byb3RvY29sL3NoYXJlZFwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgbW9uZ29fdHlwZXNfMSA9IHJlcXVpcmUoXCIuL21vbmdvX3R5cGVzXCIpO1xuY29uc3QgZXhlY3V0ZV9vcGVyYXRpb25fMSA9IHJlcXVpcmUoXCIuL29wZXJhdGlvbnMvZXhlY3V0ZV9vcGVyYXRpb25cIik7XG5jb25zdCBydW5fY29tbWFuZF8xID0gcmVxdWlyZShcIi4vb3BlcmF0aW9ucy9ydW5fY29tbWFuZFwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCByZXNvdXJjZV9tYW5hZ2VtZW50XzEgPSByZXF1aXJlKFwiLi9yZXNvdXJjZV9tYW5hZ2VtZW50XCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9zZGFtL2NvbW1vblwiKTtcbmNvbnN0IHRpbWVvdXRfMSA9IHJlcXVpcmUoXCIuL3RpbWVvdXRcIik7XG5jb25zdCB0cmFuc2FjdGlvbnNfMSA9IHJlcXVpcmUoXCIuL3RyYW5zYWN0aW9uc1wiKTtcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcbmNvbnN0IHdyaXRlX2NvbmNlcm5fMSA9IHJlcXVpcmUoXCIuL3dyaXRlX2NvbmNlcm5cIik7XG5jb25zdCBtaW5XaXJlVmVyc2lvbkZvclNoYXJkZWRUcmFuc2FjdGlvbnMgPSA4O1xuLyoqXG4gKiBBIGNsYXNzIHJlcHJlc2VudGluZyBhIGNsaWVudCBzZXNzaW9uIG9uIHRoZSBzZXJ2ZXJcbiAqXG4gKiBOT1RFOiBub3QgbWVhbnQgdG8gYmUgaW5zdGFudGlhdGVkIGRpcmVjdGx5LlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBDbGllbnRTZXNzaW9uIGV4dGVuZHMgbW9uZ29fdHlwZXNfMS5UeXBlZEV2ZW50RW1pdHRlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgY2xpZW50IHNlc3Npb24uXG4gICAgICogQGludGVybmFsXG4gICAgICogQHBhcmFtIGNsaWVudCAtIFRoZSBjdXJyZW50IGNsaWVudFxuICAgICAqIEBwYXJhbSBzZXNzaW9uUG9vbCAtIFRoZSBzZXJ2ZXIgc2Vzc2lvbiBwb29sIChJbnRlcm5hbCBDbGFzcylcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzXG4gICAgICogQHBhcmFtIGNsaWVudE9wdGlvbnMgLSBPcHRpb25hbCBzZXR0aW5ncyBwcm92aWRlZCB3aGVuIGNyZWF0aW5nIGEgTW9uZ29DbGllbnRcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIHNlc3Npb25Qb29sLCBvcHRpb25zLCBjbGllbnRPcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dCA9IG51bGw7XG4gICAgICAgIHRoaXMub24oJ2Vycm9yJywgdXRpbHNfMS5ub29wKTtcbiAgICAgICAgaWYgKGNsaWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDbGllbnRTZXNzaW9uIHJlcXVpcmVzIGEgTW9uZ29DbGllbnQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2Vzc2lvblBvb2wgPT0gbnVsbCB8fCAhKHNlc3Npb25Qb29sIGluc3RhbmNlb2YgU2VydmVyU2Vzc2lvblBvb2wpKSB7XG4gICAgICAgICAgICAvLyBUT0RPKE5PREUtMzQ4MylcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDbGllbnRTZXNzaW9uIHJlcXVpcmVzIGEgU2VydmVyU2Vzc2lvblBvb2wnKTtcbiAgICAgICAgfVxuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5zbmFwc2hvdEVuYWJsZWQgPSBvcHRpb25zLnNuYXBzaG90ID09PSB0cnVlO1xuICAgICAgICBpZiAob3B0aW9ucy5jYXVzYWxDb25zaXN0ZW5jeSA9PT0gdHJ1ZSAmJiB0aGlzLnNuYXBzaG90RW5hYmxlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignUHJvcGVydGllcyBcImNhdXNhbENvbnNpc3RlbmN5XCIgYW5kIFwic25hcHNob3RcIiBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIHRoaXMuc2Vzc2lvblBvb2wgPSBzZXNzaW9uUG9vbDtcbiAgICAgICAgdGhpcy5oYXNFbmRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNsaWVudE9wdGlvbnMgPSBjbGllbnRPcHRpb25zO1xuICAgICAgICB0aGlzLnRpbWVvdXRNUyA9IG9wdGlvbnMuZGVmYXVsdFRpbWVvdXRNUyA/PyBjbGllbnQucy5vcHRpb25zPy50aW1lb3V0TVM7XG4gICAgICAgIHRoaXMuZXhwbGljaXQgPSAhIW9wdGlvbnMuZXhwbGljaXQ7XG4gICAgICAgIHRoaXMuX3NlcnZlclNlc3Npb24gPSB0aGlzLmV4cGxpY2l0ID8gdGhpcy5zZXNzaW9uUG9vbC5hY3F1aXJlKCkgOiBudWxsO1xuICAgICAgICB0aGlzLnR4bk51bWJlckluY3JlbWVudCA9IDA7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRDYXVzYWxDb25zaXN0ZW5jeVZhbHVlID0gdGhpcy5leHBsaWNpdCAmJiBvcHRpb25zLnNuYXBzaG90ICE9PSB0cnVlO1xuICAgICAgICB0aGlzLnN1cHBvcnRzID0ge1xuICAgICAgICAgICAgLy8gaWYgd2UgY2FuIGVuYWJsZSBjYXVzYWwgY29uc2lzdGVuY3ksIGRvIHNvIGJ5IGRlZmF1bHRcbiAgICAgICAgICAgIGNhdXNhbENvbnNpc3RlbmN5OiBvcHRpb25zLmNhdXNhbENvbnNpc3RlbmN5ID8/IGRlZmF1bHRDYXVzYWxDb25zaXN0ZW5jeVZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2x1c3RlclRpbWUgPSBvcHRpb25zLmluaXRpYWxDbHVzdGVyVGltZTtcbiAgICAgICAgdGhpcy5vcGVyYXRpb25UaW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm93bmVyID0gb3B0aW9ucy5vd25lcjtcbiAgICAgICAgdGhpcy5kZWZhdWx0VHJhbnNhY3Rpb25PcHRpb25zID0geyAuLi5vcHRpb25zLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMgfTtcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyB0cmFuc2FjdGlvbnNfMS5UcmFuc2FjdGlvbigpO1xuICAgIH1cbiAgICAvKiogVGhlIHNlcnZlciBpZCBhc3NvY2lhdGVkIHdpdGggdGhpcyBzZXNzaW9uICovXG4gICAgZ2V0IGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2ZXJTZXNzaW9uPy5pZDtcbiAgICB9XG4gICAgZ2V0IHNlcnZlclNlc3Npb24oKSB7XG4gICAgICAgIGxldCBzZXJ2ZXJTZXNzaW9uID0gdGhpcy5fc2VydmVyU2Vzc2lvbjtcbiAgICAgICAgaWYgKHNlcnZlclNlc3Npb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZXhwbGljaXQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignVW5leHBlY3RlZCBudWxsIHNlcnZlclNlc3Npb24gZm9yIGFuIGV4cGxpY2l0IHNlc3Npb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0VuZGVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1VuZXhwZWN0ZWQgbnVsbCBzZXJ2ZXJTZXNzaW9uIGZvciBhbiBlbmRlZCBpbXBsaWNpdCBzZXNzaW9uJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXJ2ZXJTZXNzaW9uID0gdGhpcy5zZXNzaW9uUG9vbC5hY3F1aXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXJ2ZXJTZXNzaW9uID0gc2VydmVyU2Vzc2lvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VydmVyU2Vzc2lvbjtcbiAgICB9XG4gICAgZ2V0IGxvYWRCYWxhbmNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnRvcG9sb2d5Py5kZXNjcmlwdGlvbi50eXBlID09PSBjb21tb25fMS5Ub3BvbG9neVR5cGUuTG9hZEJhbGFuY2VkO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcGluKGNvbm4pIHtcbiAgICAgICAgaWYgKHRoaXMucGlubmVkQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdDYW5ub3QgcGluIG11bHRpcGxlIGNvbm5lY3Rpb25zIHRvIHRoZSBzYW1lIHNlc3Npb24nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBpbm5lZENvbm5lY3Rpb24gPSBjb25uO1xuICAgICAgICBjb25uLmVtaXQoY29uc3RhbnRzXzEuUElOTkVELCB0aGlzLmluVHJhbnNhY3Rpb24oKSA/IG1ldHJpY3NfMS5Db25uZWN0aW9uUG9vbE1ldHJpY3MuVFhOIDogbWV0cmljc18xLkNvbm5lY3Rpb25Qb29sTWV0cmljcy5DVVJTT1IpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgdW5waW4ob3B0aW9ucykge1xuICAgICAgICBpZiAodGhpcy5sb2FkQmFsYW5jZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXliZUNsZWFyUGlubmVkQ29ubmVjdGlvbih0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnVucGluU2VydmVyKCk7XG4gICAgfVxuICAgIGdldCBpc1Bpbm5lZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZEJhbGFuY2VkID8gISF0aGlzLnBpbm5lZENvbm5lY3Rpb24gOiB0aGlzLnRyYW5zYWN0aW9uLmlzUGlubmVkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGcmVlcyBhbnkgY2xpZW50LXNpZGUgcmVzb3VyY2VzIGhlbGQgYnkgdGhlIGN1cnJlbnQgc2Vzc2lvbi4gIElmIGEgc2Vzc2lvbiBpcyBpbiBhIHRyYW5zYWN0aW9uLFxuICAgICAqIHRoZSB0cmFuc2FjdGlvbiBpcyBhYm9ydGVkLlxuICAgICAqXG4gICAgICogRG9lcyBub3QgZW5kIHRoZSBzZXNzaW9uIG9uIHRoZSBzZXJ2ZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzLiBDdXJyZW50bHkgcmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2VcbiAgICAgKi9cbiAgICBhc3luYyBlbmRTZXNzaW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYWJvcnRUcmFuc2FjdGlvbih7IC4uLm9wdGlvbnMsIHRocm93VGltZW91dDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIHNwZWMgaW5kaWNhdGVzIHRoYXQgd2Ugc2hvdWxkIGlnbm9yZSBhbGwgZXJyb3JzIGZvciBgZW5kU2Vzc2lvbnNgXG4gICAgICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ01vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yJylcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICgwLCB1dGlsc18xLnNxdWFzaEVycm9yKShlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzRW5kZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJTZXNzaW9uID0gdGhpcy5zZXJ2ZXJTZXNzaW9uO1xuICAgICAgICAgICAgICAgIGlmIChzZXJ2ZXJTZXNzaW9uICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVsZWFzZSB0aGUgc2VydmVyIHNlc3Npb24gYmFjayB0byB0aGUgcG9vbFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25Qb29sLnJlbGVhc2Uoc2VydmVyU2Vzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIGEgY2xvbmUgb2YgdGhlIHNlcnZlciBzZXNzaW9uIGZvciByZWZlcmVuY2UgKGRlYnVnZ2luZylcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VydmVyU2Vzc2lvbiA9IG5ldyBTZXJ2ZXJTZXNzaW9uKHNlcnZlclNlc3Npb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBtYXJrIHRoZSBzZXNzaW9uIGFzIGVuZGVkLCBhbmQgZW1pdCBhIHNpZ25hbFxuICAgICAgICAgICAgICAgIHRoaXMuaGFzRW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZW5kZWQnLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKHRoaXMsIHsgZm9yY2U6IHRydWUsIC4uLm9wdGlvbnMgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIGFzeW5jRGlzcG9zZSgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbmRTZXNzaW9uKHsgZm9yY2U6IHRydWUgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkdmFuY2VzIHRoZSBvcGVyYXRpb25UaW1lIGZvciBhIENsaWVudFNlc3Npb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3BlcmF0aW9uVGltZSAtIHRoZSBgQlNPTi5UaW1lc3RhbXBgIG9mIHRoZSBvcGVyYXRpb24gdHlwZSBpdCBpcyBkZXNpcmVkIHRvIGFkdmFuY2UgdG9cbiAgICAgKi9cbiAgICBhZHZhbmNlT3BlcmF0aW9uVGltZShvcGVyYXRpb25UaW1lKSB7XG4gICAgICAgIGlmICh0aGlzLm9wZXJhdGlvblRpbWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5vcGVyYXRpb25UaW1lID0gb3BlcmF0aW9uVGltZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3BlcmF0aW9uVGltZS5ncmVhdGVyVGhhbih0aGlzLm9wZXJhdGlvblRpbWUpKSB7XG4gICAgICAgICAgICB0aGlzLm9wZXJhdGlvblRpbWUgPSBvcGVyYXRpb25UaW1lO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkdmFuY2VzIHRoZSBjbHVzdGVyVGltZSBmb3IgYSBDbGllbnRTZXNzaW9uIHRvIHRoZSBwcm92aWRlZCBjbHVzdGVyVGltZSBvZiBhbm90aGVyIENsaWVudFNlc3Npb25cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjbHVzdGVyVGltZSAtIHRoZSAkY2x1c3RlclRpbWUgcmV0dXJuZWQgYnkgdGhlIHNlcnZlciBmcm9tIGFub3RoZXIgc2Vzc2lvbiBpbiB0aGUgZm9ybSBvZiBhIGRvY3VtZW50IGNvbnRhaW5pbmcgdGhlIGBCU09OLlRpbWVzdGFtcGAgY2x1c3RlclRpbWUgYW5kIHNpZ25hdHVyZVxuICAgICAqL1xuICAgIGFkdmFuY2VDbHVzdGVyVGltZShjbHVzdGVyVGltZSkge1xuICAgICAgICBpZiAoIWNsdXN0ZXJUaW1lIHx8IHR5cGVvZiBjbHVzdGVyVGltZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoJ2lucHV0IGNsdXN0ZXIgdGltZSBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2x1c3RlclRpbWUuY2x1c3RlclRpbWUgfHwgY2x1c3RlclRpbWUuY2x1c3RlclRpbWUuX2Jzb250eXBlICE9PSAnVGltZXN0YW1wJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignaW5wdXQgY2x1c3RlciB0aW1lIFwiY2x1c3RlclRpbWVcIiBwcm9wZXJ0eSBtdXN0IGJlIGEgdmFsaWQgQlNPTiBUaW1lc3RhbXAnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNsdXN0ZXJUaW1lLnNpZ25hdHVyZSB8fFxuICAgICAgICAgICAgY2x1c3RlclRpbWUuc2lnbmF0dXJlLmhhc2g/Ll9ic29udHlwZSAhPT0gJ0JpbmFyeScgfHxcbiAgICAgICAgICAgICh0eXBlb2YgY2x1c3RlclRpbWUuc2lnbmF0dXJlLmtleUlkICE9PSAnYmlnaW50JyAmJlxuICAgICAgICAgICAgICAgIHR5cGVvZiBjbHVzdGVyVGltZS5zaWduYXR1cmUua2V5SWQgIT09ICdudW1iZXInICYmXG4gICAgICAgICAgICAgICAgY2x1c3RlclRpbWUuc2lnbmF0dXJlLmtleUlkPy5fYnNvbnR5cGUgIT09ICdMb25nJykgLy8gYXBwYXJlbnRseSB3ZSBkZWNvZGUgdGhlIGtleSB0byBudW1iZXI/XG4gICAgICAgICkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignaW5wdXQgY2x1c3RlciB0aW1lIG11c3QgaGF2ZSBhIHZhbGlkIFwic2lnbmF0dXJlXCIgcHJvcGVydHkgd2l0aCBCU09OIEJpbmFyeSBoYXNoIGFuZCBCU09OIExvbmcga2V5SWQnKTtcbiAgICAgICAgfVxuICAgICAgICAoMCwgY29tbW9uXzEuX2FkdmFuY2VDbHVzdGVyVGltZSkodGhpcywgY2x1c3RlclRpbWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVc2VkIHRvIGRldGVybWluZSBpZiB0aGlzIHNlc3Npb24gZXF1YWxzIGFub3RoZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXNzaW9uIC0gVGhlIHNlc3Npb24gdG8gY29tcGFyZSB0b1xuICAgICAqL1xuICAgIGVxdWFscyhzZXNzaW9uKSB7XG4gICAgICAgIGlmICghKHNlc3Npb24gaW5zdGFuY2VvZiBDbGllbnRTZXNzaW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlkID09IG51bGwgfHwgc2Vzc2lvbi5pZCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHV0aWxzXzEuQnl0ZVV0aWxzLmVxdWFscyh0aGlzLmlkLmlkLmJ1ZmZlciwgc2Vzc2lvbi5pZC5pZC5idWZmZXIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmNyZW1lbnQgdGhlIHRyYW5zYWN0aW9uIG51bWJlciBvbiB0aGUgaW50ZXJuYWwgU2VydmVyU2Vzc2lvblxuICAgICAqXG4gICAgICogQHByaXZhdGVSZW1hcmtzXG4gICAgICogVGhpcyBoZWxwZXIgaW5jcmVtZW50cyBhIHZhbHVlIHN0b3JlZCBvbiB0aGUgY2xpZW50IHNlc3Npb24gdGhhdCB3aWxsIGJlXG4gICAgICogYWRkZWQgdG8gdGhlIHNlcnZlclNlc3Npb24ncyB0eG5OdW1iZXIgdXBvbiBhcHBseWluZyBpdCB0byBhIGNvbW1hbmQuXG4gICAgICogVGhpcyBpcyBiZWNhdXNlIHRoZSBzZXJ2ZXJTZXNzaW9uIGlzIGxhemlseSBhY3F1aXJlZCBhZnRlciBhIGNvbm5lY3Rpb24gaXMgb2J0YWluZWRcbiAgICAgKi9cbiAgICBpbmNyZW1lbnRUcmFuc2FjdGlvbk51bWJlcigpIHtcbiAgICAgICAgdGhpcy50eG5OdW1iZXJJbmNyZW1lbnQgKz0gMTtcbiAgICB9XG4gICAgLyoqIEByZXR1cm5zIHdoZXRoZXIgdGhpcyBzZXNzaW9uIGlzIGN1cnJlbnRseSBpbiBhIHRyYW5zYWN0aW9uIG9yIG5vdCAqL1xuICAgIGluVHJhbnNhY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zYWN0aW9uLmlzQWN0aXZlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydHMgYSBuZXcgdHJhbnNhY3Rpb24gd2l0aCB0aGUgZ2l2ZW4gb3B0aW9ucy5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogKipJTVBPUlRBTlQqKjogUnVubmluZyBvcGVyYXRpb25zIGluIHBhcmFsbGVsIGlzIG5vdCBzdXBwb3J0ZWQgZHVyaW5nIGEgdHJhbnNhY3Rpb24uIFRoZSB1c2Ugb2YgYFByb21pc2UuYWxsYCxcbiAgICAgKiBgUHJvbWlzZS5hbGxTZXR0bGVkYCwgYFByb21pc2UucmFjZWAsIGV0YyB0byBwYXJhbGxlbGl6ZSBvcGVyYXRpb25zIGluc2lkZSBhIHRyYW5zYWN0aW9uIGlzXG4gICAgICogdW5kZWZpbmVkIGJlaGF2aW91ci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgdGhlIHRyYW5zYWN0aW9uXG4gICAgICovXG4gICAgc3RhcnRUcmFuc2FjdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGlmICh0aGlzLnNuYXBzaG90RW5hYmxlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Db21wYXRpYmlsaXR5RXJyb3IoJ1RyYW5zYWN0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCBpbiBzbmFwc2hvdCBzZXNzaW9ucycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKCdUcmFuc2FjdGlvbiBhbHJlYWR5IGluIHByb2dyZXNzJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNQaW5uZWQgJiYgdGhpcy50cmFuc2FjdGlvbi5pc0NvbW1pdHRlZCkge1xuICAgICAgICAgICAgdGhpcy51bnBpbigpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRvcG9sb2d5TWF4V2lyZVZlcnNpb24gPSAoMCwgdXRpbHNfMS5tYXhXaXJlVmVyc2lvbikodGhpcy5jbGllbnQudG9wb2xvZ3kpO1xuICAgICAgICBpZiAoKDAsIHNoYXJlZF8xLmlzU2hhcmRlZCkodGhpcy5jbGllbnQudG9wb2xvZ3kpICYmXG4gICAgICAgICAgICB0b3BvbG9neU1heFdpcmVWZXJzaW9uICE9IG51bGwgJiZcbiAgICAgICAgICAgIHRvcG9sb2d5TWF4V2lyZVZlcnNpb24gPCBtaW5XaXJlVmVyc2lvbkZvclNoYXJkZWRUcmFuc2FjdGlvbnMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQ29tcGF0aWJpbGl0eUVycm9yKCdUcmFuc2FjdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQgb24gc2hhcmRlZCBjbHVzdGVycyBpbiBNb25nb0RCIDwgNC4yLicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29tbWl0QXR0ZW1wdGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGluY3JlbWVudCB0eG5OdW1iZXJcbiAgICAgICAgdGhpcy5pbmNyZW1lbnRUcmFuc2FjdGlvbk51bWJlcigpO1xuICAgICAgICAvLyBjcmVhdGUgdHJhbnNhY3Rpb24gc3RhdGVcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyB0cmFuc2FjdGlvbnNfMS5UcmFuc2FjdGlvbih7XG4gICAgICAgICAgICByZWFkQ29uY2Vybjogb3B0aW9ucz8ucmVhZENvbmNlcm4gPz9cbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMucmVhZENvbmNlcm4gPz9cbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudE9wdGlvbnM/LnJlYWRDb25jZXJuLFxuICAgICAgICAgICAgd3JpdGVDb25jZXJuOiBvcHRpb25zPy53cml0ZUNvbmNlcm4gPz9cbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMud3JpdGVDb25jZXJuID8/XG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnRPcHRpb25zPy53cml0ZUNvbmNlcm4sXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogb3B0aW9ucz8ucmVhZFByZWZlcmVuY2UgPz9cbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUcmFuc2FjdGlvbk9wdGlvbnMucmVhZFByZWZlcmVuY2UgPz9cbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudE9wdGlvbnM/LnJlYWRQcmVmZXJlbmNlLFxuICAgICAgICAgICAgbWF4Q29tbWl0VGltZU1TOiBvcHRpb25zPy5tYXhDb21taXRUaW1lTVMgPz8gdGhpcy5kZWZhdWx0VHJhbnNhY3Rpb25PcHRpb25zLm1heENvbW1pdFRpbWVNU1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbi50cmFuc2l0aW9uKHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tbWl0cyB0aGUgY3VycmVudGx5IGFjdGl2ZSB0cmFuc2FjdGlvbiBpbiB0aGlzIHNlc3Npb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIG9wdGlvbnMsIGNhbiBiZSB1c2VkIHRvIG92ZXJyaWRlIGBkZWZhdWx0VGltZW91dE1TYC5cbiAgICAgKi9cbiAgICBhc3luYyBjb21taXRUcmFuc2FjdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uLnN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5OT19UUkFOU0FDVElPTikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKCdObyB0cmFuc2FjdGlvbiBzdGFydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb24uc3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OIHx8XG4gICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFkpIHtcbiAgICAgICAgICAgIC8vIHRoZSB0cmFuc2FjdGlvbiB3YXMgbmV2ZXIgc3RhcnRlZCwgd2UgY2FuIHNhZmVseSBleGl0IGhlcmVcbiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHJhbnNpdGlvbih0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRyYW5zYWN0aW9uLnN0YXRlID09PSB0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoJ0Nhbm5vdCBjYWxsIGNvbW1pdFRyYW5zYWN0aW9uIGFmdGVyIGNhbGxpbmcgYWJvcnRUcmFuc2FjdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7IGNvbW1pdFRyYW5zYWN0aW9uOiAxIH07XG4gICAgICAgIGNvbnN0IHRpbWVvdXRNUyA9IHR5cGVvZiBvcHRpb25zPy50aW1lb3V0TVMgPT09ICdudW1iZXInXG4gICAgICAgICAgICA/IG9wdGlvbnMudGltZW91dE1TXG4gICAgICAgICAgICA6IHR5cGVvZiB0aGlzLnRpbWVvdXRNUyA9PT0gJ251bWJlcidcbiAgICAgICAgICAgICAgICA/IHRoaXMudGltZW91dE1TXG4gICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICBjb25zdCB3YyA9IHRoaXMudHJhbnNhY3Rpb24ub3B0aW9ucy53cml0ZUNvbmNlcm4gPz8gdGhpcy5jbGllbnRPcHRpb25zPy53cml0ZUNvbmNlcm47XG4gICAgICAgIGlmICh3YyAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAodGltZW91dE1TID09IG51bGwgJiYgdGhpcy50aW1lb3V0Q29udGV4dCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5hcHBseShjb21tYW5kLCB7IHd0aW1lb3V0TVM6IDEwMDAwLCB3OiAnbWFqb3JpdHknLCAuLi53YyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHdjS2V5cyA9IE9iamVjdC5rZXlzKHdjKTtcbiAgICAgICAgICAgICAgICBpZiAod2NLZXlzLmxlbmd0aCA+IDIgfHwgKCF3Y0tleXMuaW5jbHVkZXMoJ3d0aW1lb3V0TVMnKSAmJiAhd2NLZXlzLmluY2x1ZGVzKCd3VGltZW91dE1TJykpKVxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgd3JpdGUgY29uY2VybiB3YXMgc3BlY2lmaWVkIHdpdGggd1RpbWVvdXRNUywgdGhlbiB3ZSBzZXQgYm90aCB3dGltZW91dE1TIGFuZCB3VGltZW91dE1TLCBndWFyYW50ZWVpbmcgYXQgbGVhc3QgdHdvIGtleXMsIHNvIGlmIHdlIGhhdmUgbW9yZSB0aGFuIHR3byBrZXlzLCB0aGVuIHdlIGNhbiBhdXRvbWF0aWNhbGx5IGFzc3VtZSB0aGF0IHdlIHNob3VsZCBhZGQgdGhlIHdyaXRlIGNvbmNlcm4gdG8gdGhlIGNvbW1hbmQuIElmIGl0IGhhcyAyIG9yIGZld2VyIGtleXMsIHdlIG5lZWQgdG8gY2hlY2sgdGhhdCB0aG9zZSBrZXlzIGFyZW4ndCB0aGUgd3RpbWVvdXRNUyBvciB3VGltZW91dE1TIG9wdGlvbnMgYmVmb3JlIHdlIGFkZCB0aGUgd3JpdGUgY29uY2VybiB0byB0aGUgY29tbWFuZFxuICAgICAgICAgICAgICAgICAgICB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmFwcGx5KGNvbW1hbmQsIHsgLi4ud2MsIHd0aW1lb3V0TVM6IHVuZGVmaW5lZCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEIHx8IHRoaXMuY29tbWl0QXR0ZW1wdGVkKSB7XG4gICAgICAgICAgICBpZiAodGltZW91dE1TID09IG51bGwgJiYgdGhpcy50aW1lb3V0Q29udGV4dCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5hcHBseShjb21tYW5kLCB7IHd0aW1lb3V0TVM6IDEwMDAwLCAuLi53YywgdzogJ21ham9yaXR5JyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uYXBwbHkoY29tbWFuZCwgeyB3OiAnbWFqb3JpdHknLCAuLi53Yywgd3RpbWVvdXRNUzogdW5kZWZpbmVkIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy50cmFuc2FjdGlvbi5vcHRpb25zLm1heFRpbWVNUyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNvbW1hbmQubWF4VGltZU1TID0gdGhpcy50cmFuc2FjdGlvbi5vcHRpb25zLm1heFRpbWVNUztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5yZWNvdmVyeVRva2VuKSB7XG4gICAgICAgICAgICBjb21tYW5kLnJlY292ZXJ5VG9rZW4gPSB0aGlzLnRyYW5zYWN0aW9uLnJlY292ZXJ5VG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gbmV3IHJ1bl9jb21tYW5kXzEuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uKGNvbW1hbmQsIHtcbiAgICAgICAgICAgIHNlc3Npb246IHRoaXMsXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSxcbiAgICAgICAgICAgIGJ5cGFzc1Bpbm5pbmdDaGVjazogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdGltZW91dENvbnRleHQgPSB0aGlzLnRpbWVvdXRDb250ZXh0ID8/XG4gICAgICAgICAgICAodHlwZW9mIHRpbWVvdXRNUyA9PT0gJ251bWJlcidcbiAgICAgICAgICAgICAgICA/IHRpbWVvdXRfMS5UaW1lb3V0Q29udGV4dC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IHRoaXMuY2xpZW50T3B0aW9ucy5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMsXG4gICAgICAgICAgICAgICAgICAgIHNvY2tldFRpbWVvdXRNUzogdGhpcy5jbGllbnRPcHRpb25zLnNvY2tldFRpbWVvdXRNUyxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dE1TXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6IG51bGwpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG9wZXJhdGlvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICAgICAgdGhpcy5jb21taXRBdHRlbXB0ZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGZpcnN0Q29tbWl0RXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY29tbWl0QXR0ZW1wdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChmaXJzdENvbW1pdEVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb0Vycm9yICYmICgwLCBlcnJvcl8xLmlzUmV0cnlhYmxlV3JpdGVFcnJvcikoZmlyc3RDb21taXRFcnJvcikpIHtcbiAgICAgICAgICAgICAgICAvLyBTUEVDLTExODU6IGFwcGx5IG1ham9yaXR5IHdyaXRlIGNvbmNlcm4gd2hlbiByZXRyeWluZyBjb21taXRUcmFuc2FjdGlvblxuICAgICAgICAgICAgICAgIHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uYXBwbHkoY29tbWFuZCwgeyB3dGltZW91dE1TOiAxMDAwMCwgLi4ud2MsIHc6ICdtYWpvcml0eScgfSk7XG4gICAgICAgICAgICAgICAgLy8gcGVyIHR4bnMgc3BlYywgbXVzdCB1bnBpbiBzZXNzaW9uIGluIHRoaXMgY2FzZVxuICAgICAgICAgICAgICAgIHRoaXMudW5waW4oeyBmb3JjZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCAoMCwgZXhlY3V0ZV9vcGVyYXRpb25fMS5leGVjdXRlT3BlcmF0aW9uKSh0aGlzLmNsaWVudCwgbmV3IHJ1bl9jb21tYW5kXzEuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uKGNvbW1hbmQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb246IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ5cGFzc1Bpbm5pbmdDaGVjazogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KSwgdGltZW91dENvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChyZXRyeUNvbW1pdEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSByZXRyeSBmYWlsZWQsIHdlIHByb2Nlc3MgdGhhdCBlcnJvciBpbnN0ZWFkIG9mIHRoZSBvcmlnaW5hbFxuICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkQWRkVW5rbm93blRyYW5zYWN0aW9uQ29tbWl0UmVzdWx0TGFiZWwocmV0cnlDb21taXRFcnJvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5Q29tbWl0RXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5Vbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRVbnBpbkFmdGVyQ29tbWl0RXJyb3IocmV0cnlDb21taXRFcnJvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5waW4oeyBlcnJvcjogcmV0cnlDb21taXRFcnJvciB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyByZXRyeUNvbW1pdEVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzaG91bGRBZGRVbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHRMYWJlbChmaXJzdENvbW1pdEVycm9yKSkge1xuICAgICAgICAgICAgICAgIGZpcnN0Q29tbWl0RXJyb3IuYWRkRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5Vbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNob3VsZFVucGluQWZ0ZXJDb21taXRFcnJvcihmaXJzdENvbW1pdEVycm9yKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5waW4oeyBlcnJvcjogZmlyc3RDb21taXRFcnJvciB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGZpcnN0Q29tbWl0RXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uLnRyYW5zaXRpb24odHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBhYm9ydFRyYW5zYWN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb24uc3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoJ05vIHRyYW5zYWN0aW9uIHN0YXJ0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04pIHtcbiAgICAgICAgICAgIC8vIHRoZSB0cmFuc2FjdGlvbiB3YXMgbmV2ZXIgc3RhcnRlZCwgd2UgY2FuIHNhZmVseSBleGl0IGhlcmVcbiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHJhbnNpdGlvbih0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29UcmFuc2FjdGlvbkVycm9yKCdDYW5ub3QgY2FsbCBhYm9ydFRyYW5zYWN0aW9uIHR3aWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHJhbnNhY3Rpb24uc3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRCB8fFxuICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoJ0Nhbm5vdCBjYWxsIGFib3J0VHJhbnNhY3Rpb24gYWZ0ZXIgY2FsbGluZyBjb21taXRUcmFuc2FjdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7IGFib3J0VHJhbnNhY3Rpb246IDEgfTtcbiAgICAgICAgY29uc3QgdGltZW91dE1TID0gdHlwZW9mIG9wdGlvbnM/LnRpbWVvdXRNUyA9PT0gJ251bWJlcidcbiAgICAgICAgICAgID8gb3B0aW9ucy50aW1lb3V0TVNcbiAgICAgICAgICAgIDogdGhpcy50aW1lb3V0Q29udGV4dD8uY3NvdEVuYWJsZWQoKVxuICAgICAgICAgICAgICAgID8gdGhpcy50aW1lb3V0Q29udGV4dC50aW1lb3V0TVMgLy8gcmVmcmVzaCB0aW1lb3V0TVMgZm9yIGFib3J0IG9wZXJhdGlvblxuICAgICAgICAgICAgICAgIDogdHlwZW9mIHRoaXMudGltZW91dE1TID09PSAnbnVtYmVyJ1xuICAgICAgICAgICAgICAgICAgICA/IHRoaXMudGltZW91dE1TXG4gICAgICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgY29uc3QgdGltZW91dENvbnRleHQgPSB0aW1lb3V0TVMgIT0gbnVsbFxuICAgICAgICAgICAgPyB0aW1lb3V0XzEuVGltZW91dENvbnRleHQuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0TVMsXG4gICAgICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiB0aGlzLmNsaWVudE9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TLFxuICAgICAgICAgICAgICAgIHNvY2tldFRpbWVvdXRNUzogdGhpcy5jbGllbnRPcHRpb25zLnNvY2tldFRpbWVvdXRNU1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgY29uc3Qgd2MgPSB0aGlzLnRyYW5zYWN0aW9uLm9wdGlvbnMud3JpdGVDb25jZXJuID8/IHRoaXMuY2xpZW50T3B0aW9ucz8ud3JpdGVDb25jZXJuO1xuICAgICAgICBpZiAod2MgIT0gbnVsbCAmJiB0aW1lb3V0TVMgPT0gbnVsbCkge1xuICAgICAgICAgICAgd3JpdGVfY29uY2Vybl8xLldyaXRlQ29uY2Vybi5hcHBseShjb21tYW5kLCB7IHd0aW1lb3V0TVM6IDEwMDAwLCB3OiAnbWFqb3JpdHknLCAuLi53YyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5yZWNvdmVyeVRva2VuKSB7XG4gICAgICAgICAgICBjb21tYW5kLnJlY292ZXJ5VG9rZW4gPSB0aGlzLnRyYW5zYWN0aW9uLnJlY292ZXJ5VG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gbmV3IHJ1bl9jb21tYW5kXzEuUnVuQWRtaW5Db21tYW5kT3BlcmF0aW9uKGNvbW1hbmQsIHtcbiAgICAgICAgICAgIHNlc3Npb246IHRoaXMsXG4gICAgICAgICAgICByZWFkUHJlZmVyZW5jZTogcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UucHJpbWFyeSxcbiAgICAgICAgICAgIGJ5cGFzc1Bpbm5pbmdDaGVjazogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0ICgwLCBleGVjdXRlX29wZXJhdGlvbl8xLmV4ZWN1dGVPcGVyYXRpb24pKHRoaXMuY2xpZW50LCBvcGVyYXRpb24sIHRpbWVvdXRDb250ZXh0KTtcbiAgICAgICAgICAgIHRoaXMudW5waW4oKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZmlyc3RBYm9ydEVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLnVucGluKCk7XG4gICAgICAgICAgICBpZiAoZmlyc3RBYm9ydEVycm9yLm5hbWUgPT09ICdNb25nb1J1bnRpbWVFcnJvcicpXG4gICAgICAgICAgICAgICAgdGhyb3cgZmlyc3RBYm9ydEVycm9yO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnM/LnRocm93VGltZW91dCAmJiBmaXJzdEFib3J0RXJyb3IubmFtZSA9PT0gJ01vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yJykge1xuICAgICAgICAgICAgICAgIHRocm93IGZpcnN0QWJvcnRFcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaXJzdEFib3J0RXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IgJiYgKDAsIGVycm9yXzEuaXNSZXRyeWFibGVXcml0ZUVycm9yKShmaXJzdEFib3J0RXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgKDAsIGV4ZWN1dGVfb3BlcmF0aW9uXzEuZXhlY3V0ZU9wZXJhdGlvbikodGhpcy5jbGllbnQsIG9wZXJhdGlvbiwgdGltZW91dENvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChzZWNvbmRBYm9ydEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRBYm9ydEVycm9yLm5hbWUgPT09ICdNb25nb1J1bnRpbWVFcnJvcicpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBzZWNvbmRBYm9ydEVycm9yO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucz8udGhyb3dUaW1lb3V0ICYmIHNlY29uZEFib3J0RXJyb3IubmFtZSA9PT0gJ01vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgc2Vjb25kQWJvcnRFcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBkbyBub3QgcmV0cnkgdGhlIHJldHJ5XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhlIHNwZWMgaW5kaWNhdGVzIHRoYXQgaWYgdGhlIG9wZXJhdGlvbiB0aW1lcyBvdXQgb3IgZmFpbHMgd2l0aCBhIG5vbi1yZXRyeWFibGUgZXJyb3IsIHdlIHNob3VsZCBpZ25vcmUgYWxsIGVycm9ycyBvbiBgYWJvcnRUcmFuc2FjdGlvbmBcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24udHJhbnNpdGlvbih0cmFuc2FjdGlvbnNfMS5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAgICAgICAgIG1heWJlQ2xlYXJQaW5uZWRDb25uZWN0aW9uKHRoaXMsIHsgZm9yY2U6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgaGVyZSB0byBlbnN1cmUgdGhhdCBDbGllbnRTZXNzaW9uIGlzIG5ldmVyIHNlcmlhbGl6ZWQgdG8gQlNPTi5cbiAgICAgKi9cbiAgICB0b0JTT04oKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdDbGllbnRTZXNzaW9uIGNhbm5vdCBiZSBzZXJpYWxpemVkIHRvIEJTT04uJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyBhIHRyYW5zYWN0aW9uIGFuZCBydW5zIGEgcHJvdmlkZWQgZnVuY3Rpb24sIGVuc3VyaW5nIHRoZSBjb21taXRUcmFuc2FjdGlvbiBpcyBhbHdheXMgYXR0ZW1wdGVkIHdoZW4gYWxsIG9wZXJhdGlvbnMgcnVuIGluIHRoZSBmdW5jdGlvbiBoYXZlIGNvbXBsZXRlZC5cbiAgICAgKlxuICAgICAqICoqSU1QT1JUQU5UOioqIFRoaXMgbWV0aG9kIHJlcXVpcmVzIHRoZSBmdW5jdGlvbiBwYXNzZWQgaW4gdG8gcmV0dXJuIGEgUHJvbWlzZS4gVGhhdCBwcm9taXNlIG11c3QgYmUgbWFkZSBieSBgYXdhaXRgLWluZyBhbGwgb3BlcmF0aW9ucyBpbiBzdWNoIGEgd2F5IHRoYXQgcmVqZWN0aW9ucyBhcmUgcHJvcGFnYXRlZCB0byB0aGUgcmV0dXJuZWQgcHJvbWlzZS5cbiAgICAgKlxuICAgICAqICoqSU1QT1JUQU5UOioqIFJ1bm5pbmcgb3BlcmF0aW9ucyBpbiBwYXJhbGxlbCBpcyBub3Qgc3VwcG9ydGVkIGR1cmluZyBhIHRyYW5zYWN0aW9uLiBUaGUgdXNlIG9mIGBQcm9taXNlLmFsbGAsXG4gICAgICogYFByb21pc2UuYWxsU2V0dGxlZGAsIGBQcm9taXNlLnJhY2VgLCBldGMgdG8gcGFyYWxsZWxpemUgb3BlcmF0aW9ucyBpbnNpZGUgYSB0cmFuc2FjdGlvbiBpc1xuICAgICAqIHVuZGVmaW5lZCBiZWhhdmlvdXIuXG4gICAgICpcbiAgICAgKiAqKklNUE9SVEFOVDoqKiBXaGVuIHJ1bm5pbmcgYW4gb3BlcmF0aW9uIGluc2lkZSBhIGB3aXRoVHJhbnNhY3Rpb25gIGNhbGxiYWNrLCBpZiBpdCBpcyBub3RcbiAgICAgKiBwcm92aWRlZCB0aGUgZXhwbGljaXQgc2Vzc2lvbiBpbiBpdHMgb3B0aW9ucywgaXQgd2lsbCBub3QgYmUgcGFydCBvZiB0aGUgdHJhbnNhY3Rpb24gYW5kIGl0IHdpbGwgbm90IHJlc3BlY3QgdGltZW91dE1TLlxuICAgICAqXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIC0gSWYgYWxsIG9wZXJhdGlvbnMgc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlIGFuZCB0aGUgYGNvbW1pdFRyYW5zYWN0aW9uYCBvcGVyYXRpb24gaXMgc3VjY2Vzc2Z1bCwgdGhlbiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gd2lsbCByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24uXG4gICAgICogLSBJZiB0aGUgdHJhbnNhY3Rpb24gaXMgdW5hYmxlIHRvIGNvbXBsZXRlIG9yIGFuIGVycm9yIGlzIHRocm93biBmcm9tIHdpdGhpbiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24sIHRoZW4gdGhlIHByb3ZpZGVkIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYW4gZXJyb3IuXG4gICAgICogICAtIElmIHRoZSB0cmFuc2FjdGlvbiBpcyBtYW51YWxseSBhYm9ydGVkIHdpdGhpbiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gaXQgd2lsbCBub3QgdGhyb3cuXG4gICAgICogLSBJZiB0aGUgZHJpdmVyIG5lZWRzIHRvIGF0dGVtcHQgdG8gcmV0cnkgdGhlIG9wZXJhdGlvbnMsIHRoZSBwcm92aWRlZCBmdW5jdGlvbiBtYXkgYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzLlxuICAgICAqXG4gICAgICogQ2hlY2tvdXQgYSBkZXNjcmlwdGl2ZSBleGFtcGxlIGhlcmU6XG4gICAgICogQHNlZSBodHRwczovL3d3dy5tb25nb2RiLmNvbS9ibG9nL3Bvc3QvcXVpY2stc3RhcnQtbm9kZWpzLS1tb25nb2RiLS1ob3ctdG8taW1wbGVtZW50LXRyYW5zYWN0aW9uc1xuICAgICAqXG4gICAgICogSWYgYSBjb21tYW5kIGluc2lkZSB3aXRoVHJhbnNhY3Rpb24gZmFpbHM6XG4gICAgICogLSBJdCBtYXkgY2F1c2UgdGhlIHRyYW5zYWN0aW9uIG9uIHRoZSBzZXJ2ZXIgdG8gYmUgYWJvcnRlZC5cbiAgICAgKiAtIFRoaXMgc2l0dWF0aW9uIGlzIG5vcm1hbGx5IGhhbmRsZWQgdHJhbnNwYXJlbnRseSBieSB0aGUgZHJpdmVyLlxuICAgICAqIC0gSG93ZXZlciwgaWYgdGhlIGFwcGxpY2F0aW9uIGNhdGNoZXMgc3VjaCBhbiBlcnJvciBhbmQgZG9lcyBub3QgcmV0aHJvdyBpdCwgdGhlIGRyaXZlciB3aWxsIG5vdCBiZSBhYmxlIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSB0cmFuc2FjdGlvbiB3YXMgYWJvcnRlZCBvciBub3QuXG4gICAgICogLSBUaGUgZHJpdmVyIHdpbGwgdGhlbiByZXRyeSB0aGUgdHJhbnNhY3Rpb24gaW5kZWZpbml0ZWx5LlxuICAgICAqXG4gICAgICogVG8gYXZvaWQgdGhpcyBzaXR1YXRpb24sIHRoZSBhcHBsaWNhdGlvbiBtdXN0IG5vdCBzaWxlbnRseSBoYW5kbGUgZXJyb3JzIHdpdGhpbiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24uXG4gICAgICogSWYgdGhlIGFwcGxpY2F0aW9uIG5lZWRzIHRvIGhhbmRsZSBlcnJvcnMgd2l0aGluLCBpdCBtdXN0IGF3YWl0IGFsbCBvcGVyYXRpb25zIHN1Y2ggdGhhdCBpZiBhbiBvcGVyYXRpb24gaXMgcmVqZWN0ZWQgaXQgYmVjb21lcyB0aGUgcmVqZWN0aW9uIG9mIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBwYXNzZWQgaW50byB3aXRoVHJhbnNhY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZm4gLSBjYWxsYmFjayB0byBydW4gd2l0aGluIGEgdHJhbnNhY3Rpb25cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIG9wdGlvbmFsIHNldHRpbmdzIGZvciB0aGUgdHJhbnNhY3Rpb25cbiAgICAgKiBAcmV0dXJucyBBIHJhdyBjb21tYW5kIHJlc3BvbnNlIG9yIHVuZGVmaW5lZFxuICAgICAqL1xuICAgIGFzeW5jIHdpdGhUcmFuc2FjdGlvbihmbiwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBNQVhfVElNRU9VVCA9IDEyMDAwMDtcbiAgICAgICAgY29uc3QgdGltZW91dE1TID0gb3B0aW9ucz8udGltZW91dE1TID8/IHRoaXMudGltZW91dE1TID8/IG51bGw7XG4gICAgICAgIHRoaXMudGltZW91dENvbnRleHQgPVxuICAgICAgICAgICAgdGltZW91dE1TICE9IG51bGxcbiAgICAgICAgICAgICAgICA/IHRpbWVvdXRfMS5UaW1lb3V0Q29udGV4dC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0TVMsXG4gICAgICAgICAgICAgICAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogdGhpcy5jbGllbnRPcHRpb25zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyxcbiAgICAgICAgICAgICAgICAgICAgc29ja2V0VGltZW91dE1TOiB0aGlzLmNsaWVudE9wdGlvbnMuc29ja2V0VGltZW91dE1TXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHRoaXMudGltZW91dENvbnRleHQ/LmNzb3RFbmFibGVkKCkgPyB0aGlzLnRpbWVvdXRDb250ZXh0LnN0YXJ0IDogKDAsIHV0aWxzXzEubm93KSgpO1xuICAgICAgICBsZXQgY29tbWl0dGVkID0gZmFsc2U7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB3aGlsZSAoIWNvbW1pdHRlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUcmFuc2FjdGlvbihvcHRpb25zKTsgLy8gbWF5IHRocm93IG9uIGVycm9yXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IGZuKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCB1dGlsc18xLmlzUHJvbWlzZUxpa2UpKHByb21pc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKCdGdW5jdGlvbiBwcm92aWRlZCB0byBgd2l0aFRyYW5zYWN0aW9uYCBtdXN0IHJldHVybiBhIFByb21pc2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBwcm9taXNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT04gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXNzdW1lIGNhbGxiYWNrIGludGVudGlvbmFsbHkgZW5kZWQgdGhlIHRyYW5zYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChmbkVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKGZuRXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IpIHx8IGZuRXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYWJvcnRUcmFuc2FjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZm5FcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNhY3Rpb24uc3RhdGUgPT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0lOX1BST0dSRVNTKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFib3J0VHJhbnNhY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZm5FcnJvci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlRyYW5zaWVudFRyYW5zYWN0aW9uRXJyb3IpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50aW1lb3V0Q29udGV4dCAhPSBudWxsIHx8ICgwLCB1dGlsc18xLm5vdykoKSAtIHN0YXJ0VGltZSA8IE1BWF9USU1FT1VUKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZm5FcnJvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd2hpbGUgKCFjb21taXR0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBXZSB3aWxsIHJlbHkgb24gQ2xpZW50U2Vzc2lvbi5jb21taXRUcmFuc2FjdGlvbigpIHRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBhcHBseSBhIG1ham9yaXR5IHdyaXRlIGNvbmNlcm4gaWYgY29tbWl0VHJhbnNhY3Rpb24gaXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIGJlaW5nIHJldHJpZWQgKHNlZTogRFJJVkVSUy02MDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY29tbWl0VHJhbnNhY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGNvbW1pdEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICogTm90ZTogYSBtYXhUaW1lTVMgZXJyb3Igd2lsbCBoYXZlIHRoZSBNYXhUaW1lTVNFeHBpcmVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBjb2RlICg1MCkgYW5kIGNhbiBiZSByZXBvcnRlZCBhcyBhIHRvcC1sZXZlbCBlcnJvciBvclxuICAgICAgICAgICAgICAgICAgICAgICAgICogaW5zaWRlIHdyaXRlQ29uY2VybkVycm9yLCBleC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAqIHsgb2s6MCwgY29kZTogNTAsIGNvZGVOYW1lOiAnTWF4VGltZU1TRXhwaXJlZCcgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICogeyBvazoxLCB3cml0ZUNvbmNlcm5FcnJvcjogeyBjb2RlOiA1MCwgY29kZU5hbWU6ICdNYXhUaW1lTVNFeHBpcmVkJyB9IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc01heFRpbWVNU0V4cGlyZWRFcnJvcihjb21taXRFcnJvcikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21taXRFcnJvci5oYXNFcnJvckxhYmVsKGVycm9yXzEuTW9uZ29FcnJvckxhYmVsLlVua25vd25UcmFuc2FjdGlvbkNvbW1pdFJlc3VsdCkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50aW1lb3V0Q29udGV4dCAhPSBudWxsIHx8ICgwLCB1dGlsc18xLm5vdykoKSAtIHN0YXJ0VGltZSA8IE1BWF9USU1FT1VUKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1pdEVycm9yLmhhc0Vycm9yTGFiZWwoZXJyb3JfMS5Nb25nb0Vycm9yTGFiZWwuVHJhbnNpZW50VHJhbnNhY3Rpb25FcnJvcikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50aW1lb3V0Q29udGV4dCAhPSBudWxsIHx8ICgwLCB1dGlsc18xLm5vdykoKSAtIHN0YXJ0VGltZSA8IE1BWF9USU1FT1VUKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgY29tbWl0RXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0Q29udGV4dCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkNsaWVudFNlc3Npb24gPSBDbGllbnRTZXNzaW9uO1xuKDAsIHJlc291cmNlX21hbmFnZW1lbnRfMS5jb25maWd1cmVSZXNvdXJjZU1hbmFnZW1lbnQpKENsaWVudFNlc3Npb24ucHJvdG90eXBlKTtcbmNvbnN0IE5PTl9ERVRFUk1JTklTVElDX1dSSVRFX0NPTkNFUk5fRVJST1JTID0gbmV3IFNldChbXG4gICAgJ0Nhbm5vdFNhdGlzZnlXcml0ZUNvbmNlcm4nLFxuICAgICdVbmtub3duUmVwbFdyaXRlQ29uY2VybicsXG4gICAgJ1Vuc2F0aXNmaWFibGVXcml0ZUNvbmNlcm4nXG5dKTtcbmZ1bmN0aW9uIHNob3VsZFVucGluQWZ0ZXJDb21taXRFcnJvcihjb21taXRFcnJvcikge1xuICAgIGlmIChjb21taXRFcnJvciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29FcnJvcikge1xuICAgICAgICBpZiAoKDAsIGVycm9yXzEuaXNSZXRyeWFibGVXcml0ZUVycm9yKShjb21taXRFcnJvcikgfHxcbiAgICAgICAgICAgIGNvbW1pdEVycm9yIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb1dyaXRlQ29uY2VybkVycm9yIHx8XG4gICAgICAgICAgICBpc01heFRpbWVNU0V4cGlyZWRFcnJvcihjb21taXRFcnJvcikpIHtcbiAgICAgICAgICAgIGlmIChpc1Vua25vd25UcmFuc2FjdGlvbkNvbW1pdFJlc3VsdChjb21taXRFcnJvcikpIHtcbiAgICAgICAgICAgICAgICAvLyBwZXIgdHhucyBzcGVjLCBtdXN0IHVucGluIHNlc3Npb24gaW4gdGhpcyBjYXNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tbWl0RXJyb3IuaGFzRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5UcmFuc2llbnRUcmFuc2FjdGlvbkVycm9yKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gc2hvdWxkQWRkVW5rbm93blRyYW5zYWN0aW9uQ29tbWl0UmVzdWx0TGFiZWwoY29tbWl0RXJyb3IpIHtcbiAgICBsZXQgb2sgPSAoMCwgZXJyb3JfMS5pc1JldHJ5YWJsZVdyaXRlRXJyb3IpKGNvbW1pdEVycm9yKTtcbiAgICBvayB8fD0gY29tbWl0RXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvV3JpdGVDb25jZXJuRXJyb3I7XG4gICAgb2sgfHw9IGlzTWF4VGltZU1TRXhwaXJlZEVycm9yKGNvbW1pdEVycm9yKTtcbiAgICBvayAmJj0gaXNVbmtub3duVHJhbnNhY3Rpb25Db21taXRSZXN1bHQoY29tbWl0RXJyb3IpO1xuICAgIHJldHVybiBvaztcbn1cbmZ1bmN0aW9uIGlzVW5rbm93blRyYW5zYWN0aW9uQ29tbWl0UmVzdWx0KGVycikge1xuICAgIGNvbnN0IGlzTm9uRGV0ZXJtaW5pc3RpY1dyaXRlQ29uY2VybkVycm9yID0gZXJyIGluc3RhbmNlb2YgZXJyb3JfMS5Nb25nb1NlcnZlckVycm9yICYmXG4gICAgICAgIGVyci5jb2RlTmFtZSAmJlxuICAgICAgICBOT05fREVURVJNSU5JU1RJQ19XUklURV9DT05DRVJOX0VSUk9SUy5oYXMoZXJyLmNvZGVOYW1lKTtcbiAgICByZXR1cm4gKGlzTWF4VGltZU1TRXhwaXJlZEVycm9yKGVycikgfHxcbiAgICAgICAgKCFpc05vbkRldGVybWluaXN0aWNXcml0ZUNvbmNlcm5FcnJvciAmJlxuICAgICAgICAgICAgZXJyLmNvZGUgIT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5VbnNhdGlzZmlhYmxlV3JpdGVDb25jZXJuICYmXG4gICAgICAgICAgICBlcnIuY29kZSAhPT0gZXJyb3JfMS5NT05HT0RCX0VSUk9SX0NPREVTLlVua25vd25SZXBsV3JpdGVDb25jZXJuKSk7XG59XG5mdW5jdGlvbiBtYXliZUNsZWFyUGlubmVkQ29ubmVjdGlvbihzZXNzaW9uLCBvcHRpb25zKSB7XG4gICAgLy8gdW5waW4gYSBjb25uZWN0aW9uIGlmIGl0IGhhcyBiZWVuIHBpbm5lZFxuICAgIGNvbnN0IGNvbm4gPSBzZXNzaW9uLnBpbm5lZENvbm5lY3Rpb247XG4gICAgY29uc3QgZXJyb3IgPSBvcHRpb25zPy5lcnJvcjtcbiAgICBpZiAoc2Vzc2lvbi5pblRyYW5zYWN0aW9uKCkgJiZcbiAgICAgICAgZXJyb3IgJiZcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBlcnJvcl8xLk1vbmdvRXJyb3IgJiZcbiAgICAgICAgZXJyb3IuaGFzRXJyb3JMYWJlbChlcnJvcl8xLk1vbmdvRXJyb3JMYWJlbC5UcmFuc2llbnRUcmFuc2FjdGlvbkVycm9yKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRvcG9sb2d5ID0gc2Vzc2lvbi5jbGllbnQudG9wb2xvZ3k7XG4gICAgLy8gTk9URTogdGhlIHNwZWMgdGFsa3MgYWJvdXQgd2hhdCB0byBkbyBvbiBhIG5ldHdvcmsgZXJyb3Igb25seSwgYnV0IHRoZSB0ZXN0cyBzZWVtIHRvXG4gICAgLy8gICAgICAgdG8gdmFsaWRhdGUgdGhhdCB3ZSBkb24ndCB1bnBpbiBvbiBfYWxsXyBlcnJvcnM/XG4gICAgaWYgKGNvbm4gJiYgdG9wb2xvZ3kgIT0gbnVsbCkge1xuICAgICAgICBjb25zdCBzZXJ2ZXJzID0gQXJyYXkuZnJvbSh0b3BvbG9neS5zLnNlcnZlcnMudmFsdWVzKCkpO1xuICAgICAgICBjb25zdCBsb2FkQmFsYW5jZXIgPSBzZXJ2ZXJzWzBdO1xuICAgICAgICBpZiAob3B0aW9ucz8uZXJyb3IgPT0gbnVsbCB8fCBvcHRpb25zPy5mb3JjZSkge1xuICAgICAgICAgICAgbG9hZEJhbGFuY2VyLnBvb2wuY2hlY2tJbihjb25uKTtcbiAgICAgICAgICAgIHNlc3Npb24ucGlubmVkQ29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGNvbm4uZW1pdChjb25zdGFudHNfMS5VTlBJTk5FRCwgc2Vzc2lvbi50cmFuc2FjdGlvbi5zdGF0ZSAhPT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT05cbiAgICAgICAgICAgICAgICA/IG1ldHJpY3NfMS5Db25uZWN0aW9uUG9vbE1ldHJpY3MuVFhOXG4gICAgICAgICAgICAgICAgOiBtZXRyaWNzXzEuQ29ubmVjdGlvblBvb2xNZXRyaWNzLkNVUlNPUik7XG4gICAgICAgICAgICBpZiAob3B0aW9ucz8uZm9yY2VDbGVhcikge1xuICAgICAgICAgICAgICAgIGxvYWRCYWxhbmNlci5wb29sLmNsZWFyKHsgc2VydmljZUlkOiBjb25uLnNlcnZpY2VJZCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGlzTWF4VGltZU1TRXhwaXJlZEVycm9yKGVycikge1xuICAgIGlmIChlcnIgPT0gbnVsbCB8fCAhKGVyciBpbnN0YW5jZW9mIGVycm9yXzEuTW9uZ29TZXJ2ZXJFcnJvcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gKGVyci5jb2RlID09PSBlcnJvcl8xLk1PTkdPREJfRVJST1JfQ09ERVMuTWF4VGltZU1TRXhwaXJlZCB8fFxuICAgICAgICBlcnIud3JpdGVDb25jZXJuRXJyb3I/LmNvZGUgPT09IGVycm9yXzEuTU9OR09EQl9FUlJPUl9DT0RFUy5NYXhUaW1lTVNFeHBpcmVkKTtcbn1cbi8qKlxuICogUmVmbGVjdHMgdGhlIGV4aXN0ZW5jZSBvZiBhIHNlc3Npb24gb24gdGhlIHNlcnZlci4gQ2FuIGJlIHJldXNlZCBieSB0aGUgc2Vzc2lvbiBwb29sLlxuICogV0FSTklORzogbm90IG1lYW50IHRvIGJlIGluc3RhbnRpYXRlZCBkaXJlY3RseS4gRm9yIGludGVybmFsIHVzZSBvbmx5LlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBTZXJ2ZXJTZXNzaW9uIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3IoY2xvbmVkKSB7XG4gICAgICAgIGlmIChjbG9uZWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgaWRCeXRlcyA9IEJ1ZmZlci5hbGxvY1Vuc2FmZSgxNik7XG4gICAgICAgICAgICBpZEJ5dGVzLnNldChjbG9uZWQuaWQuaWQuYnVmZmVyKTtcbiAgICAgICAgICAgIHRoaXMuaWQgPSB7IGlkOiBuZXcgYnNvbl8xLkJpbmFyeShpZEJ5dGVzLCBjbG9uZWQuaWQuaWQuc3ViX3R5cGUpIH07XG4gICAgICAgICAgICB0aGlzLmxhc3RVc2UgPSBjbG9uZWQubGFzdFVzZTtcbiAgICAgICAgICAgIHRoaXMudHhuTnVtYmVyID0gY2xvbmVkLnR4bk51bWJlcjtcbiAgICAgICAgICAgIHRoaXMuaXNEaXJ0eSA9IGNsb25lZC5pc0RpcnR5O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaWQgPSB7IGlkOiBuZXcgYnNvbl8xLkJpbmFyeSgoMCwgdXRpbHNfMS51dWlkVjQpKCksIGJzb25fMS5CaW5hcnkuU1VCVFlQRV9VVUlEKSB9O1xuICAgICAgICB0aGlzLmxhc3RVc2UgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgICAgIHRoaXMudHhuTnVtYmVyID0gMDtcbiAgICAgICAgdGhpcy5pc0RpcnR5ID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHNlcnZlciBzZXNzaW9uIGhhcyB0aW1lZCBvdXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2Vzc2lvblRpbWVvdXRNaW51dGVzIC0gVGhlIHNlcnZlcidzIFwibG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlc1wiXG4gICAgICovXG4gICAgaGFzVGltZWRPdXQoc2Vzc2lvblRpbWVvdXRNaW51dGVzKSB7XG4gICAgICAgIC8vIFRha2UgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlIGxhc3RVc2UgdGltZXN0YW1wIGFuZCBub3csIHdoaWNoIHdpbGwgcmVzdWx0IGluIGEgdmFsdWUgaW5cbiAgICAgICAgLy8gbWlsbGlzZWNvbmRzLCBhbmQgdGhlbiBjb252ZXJ0IG1pbGxpc2Vjb25kcyB0byBtaW51dGVzIHRvIGNvbXBhcmUgdG8gYHNlc3Npb25UaW1lb3V0TWludXRlc2BcbiAgICAgICAgY29uc3QgaWRsZVRpbWVNaW51dGVzID0gTWF0aC5yb3VuZCgoKCgwLCB1dGlsc18xLmNhbGN1bGF0ZUR1cmF0aW9uSW5NcykodGhpcy5sYXN0VXNlKSAlIDg2NDAwMDAwKSAlIDM2MDAwMDApIC8gNjAwMDApO1xuICAgICAgICByZXR1cm4gaWRsZVRpbWVNaW51dGVzID4gc2Vzc2lvblRpbWVvdXRNaW51dGVzIC0gMTtcbiAgICB9XG59XG5leHBvcnRzLlNlcnZlclNlc3Npb24gPSBTZXJ2ZXJTZXNzaW9uO1xuLyoqXG4gKiBNYWludGFpbnMgYSBwb29sIG9mIFNlcnZlciBTZXNzaW9ucy5cbiAqIEZvciBpbnRlcm5hbCB1c2Ugb25seVxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIFNlcnZlclNlc3Npb25Qb29sIHtcbiAgICBjb25zdHJ1Y3RvcihjbGllbnQpIHtcbiAgICAgICAgaWYgKGNsaWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignU2VydmVyU2Vzc2lvblBvb2wgcmVxdWlyZXMgYSBNb25nb0NsaWVudCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgICAgICB0aGlzLnNlc3Npb25zID0gbmV3IHV0aWxzXzEuTGlzdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBY3F1aXJlIGEgU2VydmVyIFNlc3Npb24gZnJvbSB0aGUgcG9vbC5cbiAgICAgKiBJdGVyYXRlcyB0aHJvdWdoIGVhY2ggc2Vzc2lvbiBpbiB0aGUgcG9vbCwgcmVtb3ZpbmcgYW55IHN0YWxlIHNlc3Npb25zXG4gICAgICogYWxvbmcgdGhlIHdheS4gVGhlIGZpcnN0IG5vbi1zdGFsZSBzZXNzaW9uIGZvdW5kIGlzIHJlbW92ZWQgZnJvbSB0aGVcbiAgICAgKiBwb29sIGFuZCByZXR1cm5lZC4gSWYgbm8gbm9uLXN0YWxlIHNlc3Npb24gaXMgZm91bmQsIGEgbmV3IFNlcnZlclNlc3Npb24gaXMgY3JlYXRlZC5cbiAgICAgKi9cbiAgICBhY3F1aXJlKCkge1xuICAgICAgICBjb25zdCBzZXNzaW9uVGltZW91dE1pbnV0ZXMgPSB0aGlzLmNsaWVudC50b3BvbG9neT8ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyA/PyAxMDtcbiAgICAgICAgbGV0IHNlc3Npb24gPSBudWxsO1xuICAgICAgICAvLyBUcnkgdG8gb2J0YWluIGZyb20gc2Vzc2lvbiBwb29sXG4gICAgICAgIHdoaWxlICh0aGlzLnNlc3Npb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHBvdGVudGlhbFNlc3Npb24gPSB0aGlzLnNlc3Npb25zLnNoaWZ0KCk7XG4gICAgICAgICAgICBpZiAocG90ZW50aWFsU2Vzc2lvbiAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgKCEhdGhpcy5jbGllbnQudG9wb2xvZ3k/LmxvYWRCYWxhbmNlZCB8fFxuICAgICAgICAgICAgICAgICAgICAhcG90ZW50aWFsU2Vzc2lvbi5oYXNUaW1lZE91dChzZXNzaW9uVGltZW91dE1pbnV0ZXMpKSkge1xuICAgICAgICAgICAgICAgIHNlc3Npb24gPSBwb3RlbnRpYWxTZXNzaW9uO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIG5vdGhpbmcgdmFsaWQgY2FtZSBmcm9tIHRoZSBwb29sIG1ha2UgYSBuZXcgb25lXG4gICAgICAgIGlmIChzZXNzaW9uID09IG51bGwpIHtcbiAgICAgICAgICAgIHNlc3Npb24gPSBuZXcgU2VydmVyU2Vzc2lvbigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWxlYXNlIGEgc2Vzc2lvbiB0byB0aGUgc2Vzc2lvbiBwb29sXG4gICAgICogQWRkcyB0aGUgc2Vzc2lvbiBiYWNrIHRvIHRoZSBzZXNzaW9uIHBvb2wgaWYgdGhlIHNlc3Npb24gaGFzIG5vdCB0aW1lZCBvdXQgeWV0LlxuICAgICAqIFRoaXMgbWV0aG9kIGFsc28gcmVtb3ZlcyBhbnkgc3RhbGUgc2Vzc2lvbnMgZnJvbSB0aGUgcG9vbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXNzaW9uIC0gVGhlIHNlc3Npb24gdG8gcmVsZWFzZSB0byB0aGUgcG9vbFxuICAgICAqL1xuICAgIHJlbGVhc2Uoc2Vzc2lvbikge1xuICAgICAgICBjb25zdCBzZXNzaW9uVGltZW91dE1pbnV0ZXMgPSB0aGlzLmNsaWVudC50b3BvbG9neT8ubG9naWNhbFNlc3Npb25UaW1lb3V0TWludXRlcyA/PyAxMDtcbiAgICAgICAgaWYgKHRoaXMuY2xpZW50LnRvcG9sb2d5Py5sb2FkQmFsYW5jZWQgJiYgIXNlc3Npb25UaW1lb3V0TWludXRlcykge1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9ucy51bnNoaWZ0KHNlc3Npb24pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc2Vzc2lvblRpbWVvdXRNaW51dGVzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXNzaW9ucy5wcnVuZShzZXNzaW9uID0+IHNlc3Npb24uaGFzVGltZWRPdXQoc2Vzc2lvblRpbWVvdXRNaW51dGVzKSk7XG4gICAgICAgIGlmICghc2Vzc2lvbi5oYXNUaW1lZE91dChzZXNzaW9uVGltZW91dE1pbnV0ZXMpKSB7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbi5pc0RpcnR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCByZWFkZCB0aGlzIHNlc3Npb24gdG8gdGhlIHNlc3Npb24gcG9vbFxuICAgICAgICAgICAgdGhpcy5zZXNzaW9ucy51bnNoaWZ0KHNlc3Npb24pO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5TZXJ2ZXJTZXNzaW9uUG9vbCA9IFNlcnZlclNlc3Npb25Qb29sO1xuLyoqXG4gKiBPcHRpb25hbGx5IGRlY29yYXRlIGEgY29tbWFuZCB3aXRoIHNlc3Npb25zIHNwZWNpZmljIGtleXNcbiAqXG4gKiBAcGFyYW0gc2Vzc2lvbiAtIHRoZSBzZXNzaW9uIHRyYWNraW5nIHRyYW5zYWN0aW9uIHN0YXRlXG4gKiBAcGFyYW0gY29tbWFuZCAtIHRoZSBjb21tYW5kIHRvIGRlY29yYXRlXG4gKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIHNldHRpbmdzIHBhc3NlZCB0byBjYWxsaW5nIG9wZXJhdGlvblxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBhcHBseVNlc3Npb24oc2Vzc2lvbiwgY29tbWFuZCwgb3B0aW9ucykge1xuICAgIGlmIChzZXNzaW9uLmhhc0VuZGVkKSB7XG4gICAgICAgIHJldHVybiBuZXcgZXJyb3JfMS5Nb25nb0V4cGlyZWRTZXNzaW9uRXJyb3IoKTtcbiAgICB9XG4gICAgLy8gTWF5IGFjcXVpcmUgc2VydmVyU2Vzc2lvbiBoZXJlXG4gICAgY29uc3Qgc2VydmVyU2Vzc2lvbiA9IHNlc3Npb24uc2VydmVyU2Vzc2lvbjtcbiAgICBpZiAoc2VydmVyU2Vzc2lvbiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignVW5hYmxlIHRvIGFjcXVpcmUgc2VydmVyIHNlc3Npb24nKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMud3JpdGVDb25jZXJuPy53ID09PSAwKSB7XG4gICAgICAgIGlmIChzZXNzaW9uICYmIHNlc3Npb24uZXhwbGljaXQpIHtcbiAgICAgICAgICAgIC8vIEVycm9yIGlmIHVzZXIgcHJvdmlkZWQgYW4gZXhwbGljaXQgc2Vzc2lvbiB0byBhbiB1bmFja25vd2xlZGdlZCB3cml0ZSAoU1BFQy0xMDE5KVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ0Nhbm5vdCBoYXZlIGV4cGxpY2l0IHNlc3Npb24gd2l0aCB1bmFja25vd2xlZGdlZCB3cml0ZXMnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIG1hcmsgdGhlIGxhc3QgdXNlIG9mIHRoaXMgc2Vzc2lvbiwgYW5kIGFwcGx5IHRoZSBgbHNpZGBcbiAgICBzZXJ2ZXJTZXNzaW9uLmxhc3RVc2UgPSAoMCwgdXRpbHNfMS5ub3cpKCk7XG4gICAgY29tbWFuZC5sc2lkID0gc2VydmVyU2Vzc2lvbi5pZDtcbiAgICBjb25zdCBpblR4bk9yVHhuQ29tbWFuZCA9IHNlc3Npb24uaW5UcmFuc2FjdGlvbigpIHx8ICgwLCB0cmFuc2FjdGlvbnNfMS5pc1RyYW5zYWN0aW9uQ29tbWFuZCkoY29tbWFuZCk7XG4gICAgY29uc3QgaXNSZXRyeWFibGVXcml0ZSA9ICEhb3B0aW9ucy53aWxsUmV0cnlXcml0ZTtcbiAgICBpZiAoaXNSZXRyeWFibGVXcml0ZSB8fCBpblR4bk9yVHhuQ29tbWFuZCkge1xuICAgICAgICBzZXJ2ZXJTZXNzaW9uLnR4bk51bWJlciArPSBzZXNzaW9uLnR4bk51bWJlckluY3JlbWVudDtcbiAgICAgICAgc2Vzc2lvbi50eG5OdW1iZXJJbmNyZW1lbnQgPSAwO1xuICAgICAgICAvLyBUT0RPKE5PREUtMjY3NCk6IFByZXNlcnZlIGludDY0IHNlbnQgZnJvbSBNb25nb0RCXG4gICAgICAgIGNvbW1hbmQudHhuTnVtYmVyID0gYnNvbl8xLkxvbmcuZnJvbU51bWJlcihzZXJ2ZXJTZXNzaW9uLnR4bk51bWJlcik7XG4gICAgfVxuICAgIGlmICghaW5UeG5PclR4bkNvbW1hbmQpIHtcbiAgICAgICAgaWYgKHNlc3Npb24udHJhbnNhY3Rpb24uc3RhdGUgIT09IHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnRyYW5zYWN0aW9uLnRyYW5zaXRpb24odHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT04pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXNzaW9uLnN1cHBvcnRzLmNhdXNhbENvbnNpc3RlbmN5ICYmXG4gICAgICAgICAgICBzZXNzaW9uLm9wZXJhdGlvblRpbWUgJiZcbiAgICAgICAgICAgICgwLCB1dGlsc18xLmNvbW1hbmRTdXBwb3J0c1JlYWRDb25jZXJuKShjb21tYW5kKSkge1xuICAgICAgICAgICAgY29tbWFuZC5yZWFkQ29uY2VybiA9IGNvbW1hbmQucmVhZENvbmNlcm4gfHwge307XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbW1hbmQucmVhZENvbmNlcm4sIHsgYWZ0ZXJDbHVzdGVyVGltZTogc2Vzc2lvbi5vcGVyYXRpb25UaW1lIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlc3Npb24uc25hcHNob3RFbmFibGVkKSB7XG4gICAgICAgICAgICBjb21tYW5kLnJlYWRDb25jZXJuID0gY29tbWFuZC5yZWFkQ29uY2VybiB8fCB7IGxldmVsOiByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2VybkxldmVsLnNuYXBzaG90IH07XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbi5zbmFwc2hvdFRpbWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29tbWFuZC5yZWFkQ29uY2VybiwgeyBhdENsdXN0ZXJUaW1lOiBzZXNzaW9uLnNuYXBzaG90VGltZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIG5vdyBhdHRlbXB0IHRvIGFwcGx5IHRyYW5zYWN0aW9uLXNwZWNpZmljIHNlc3Npb25zIGRhdGFcbiAgICAvLyBgYXV0b2NvbW1pdGAgbXVzdCBhbHdheXMgYmUgZmFsc2UgdG8gZGlmZmVyZW50aWF0ZSBmcm9tIHJldHJ5YWJsZSB3cml0ZXNcbiAgICBjb21tYW5kLmF1dG9jb21taXQgPSBmYWxzZTtcbiAgICBpZiAoc2Vzc2lvbi50cmFuc2FjdGlvbi5zdGF0ZSA9PT0gdHJhbnNhY3Rpb25zXzEuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04pIHtcbiAgICAgICAgc2Vzc2lvbi50cmFuc2FjdGlvbi50cmFuc2l0aW9uKHRyYW5zYWN0aW9uc18xLlR4blN0YXRlLlRSQU5TQUNUSU9OX0lOX1BST0dSRVNTKTtcbiAgICAgICAgY29tbWFuZC5zdGFydFRyYW5zYWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgcmVhZENvbmNlcm4gPSBzZXNzaW9uLnRyYW5zYWN0aW9uLm9wdGlvbnMucmVhZENvbmNlcm4gfHwgc2Vzc2lvbj8uY2xpZW50T3B0aW9ucz8ucmVhZENvbmNlcm47XG4gICAgICAgIGlmIChyZWFkQ29uY2Vybikge1xuICAgICAgICAgICAgY29tbWFuZC5yZWFkQ29uY2VybiA9IHJlYWRDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXNzaW9uLnN1cHBvcnRzLmNhdXNhbENvbnNpc3RlbmN5ICYmIHNlc3Npb24ub3BlcmF0aW9uVGltZSkge1xuICAgICAgICAgICAgY29tbWFuZC5yZWFkQ29uY2VybiA9IGNvbW1hbmQucmVhZENvbmNlcm4gfHwge307XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbW1hbmQucmVhZENvbmNlcm4sIHsgYWZ0ZXJDbHVzdGVyVGltZTogc2Vzc2lvbi5vcGVyYXRpb25UaW1lIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybjtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVNlc3Npb25Gcm9tUmVzcG9uc2Uoc2Vzc2lvbiwgZG9jdW1lbnQpIHtcbiAgICBpZiAoZG9jdW1lbnQuJGNsdXN0ZXJUaW1lKSB7XG4gICAgICAgICgwLCBjb21tb25fMS5fYWR2YW5jZUNsdXN0ZXJUaW1lKShzZXNzaW9uLCBkb2N1bWVudC4kY2x1c3RlclRpbWUpO1xuICAgIH1cbiAgICBpZiAoZG9jdW1lbnQub3BlcmF0aW9uVGltZSAmJiBzZXNzaW9uICYmIHNlc3Npb24uc3VwcG9ydHMuY2F1c2FsQ29uc2lzdGVuY3kpIHtcbiAgICAgICAgc2Vzc2lvbi5hZHZhbmNlT3BlcmF0aW9uVGltZShkb2N1bWVudC5vcGVyYXRpb25UaW1lKTtcbiAgICB9XG4gICAgaWYgKGRvY3VtZW50LnJlY292ZXJ5VG9rZW4gJiYgc2Vzc2lvbiAmJiBzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICBzZXNzaW9uLnRyYW5zYWN0aW9uLl9yZWNvdmVyeVRva2VuID0gZG9jdW1lbnQucmVjb3ZlcnlUb2tlbjtcbiAgICB9XG4gICAgaWYgKHNlc3Npb24/LnNuYXBzaG90RW5hYmxlZCAmJiBzZXNzaW9uLnNuYXBzaG90VGltZSA9PSBudWxsKSB7XG4gICAgICAgIC8vIGZpbmQgYW5kIGFnZ3JlZ2F0ZSBjb21tYW5kcyByZXR1cm4gYXRDbHVzdGVyVGltZSBvbiB0aGUgY3Vyc29yXG4gICAgICAgIC8vIGRpc3RpbmN0IGluY2x1ZGVzIGl0IGluIHRoZSByZXNwb25zZSBib2R5XG4gICAgICAgIGNvbnN0IGF0Q2x1c3RlclRpbWUgPSBkb2N1bWVudC5hdENsdXN0ZXJUaW1lO1xuICAgICAgICBpZiAoYXRDbHVzdGVyVGltZSkge1xuICAgICAgICAgICAgc2Vzc2lvbi5zbmFwc2hvdFRpbWUgPSBhdENsdXN0ZXJUaW1lO1xuICAgICAgICB9XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2Vzc2lvbnMuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sessions.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sort.js":
/*!****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sort.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.formatSort = formatSort;\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\n/** @internal */\nfunction prepareDirection(direction = 1) {\n    const value = `${direction}`.toLowerCase();\n    if (isMeta(direction))\n        return direction;\n    switch (value) {\n        case 'ascending':\n        case 'asc':\n        case '1':\n            return 1;\n        case 'descending':\n        case 'desc':\n        case '-1':\n            return -1;\n        default:\n            throw new error_1.MongoInvalidArgumentError(`Invalid sort direction: ${JSON.stringify(direction)}`);\n    }\n}\n/** @internal */\nfunction isMeta(t) {\n    return typeof t === 'object' && t != null && '$meta' in t && typeof t.$meta === 'string';\n}\n/** @internal */\nfunction isPair(t) {\n    if (Array.isArray(t) && t.length === 2) {\n        try {\n            prepareDirection(t[1]);\n            return true;\n        }\n        catch {\n            return false;\n        }\n    }\n    return false;\n}\nfunction isDeep(t) {\n    return Array.isArray(t) && Array.isArray(t[0]);\n}\nfunction isMap(t) {\n    return t instanceof Map && t.size > 0;\n}\n/** @internal */\nfunction pairToMap(v) {\n    return new Map([[`${v[0]}`, prepareDirection([v[1]])]]);\n}\n/** @internal */\nfunction deepToMap(t) {\n    const sortEntries = t.map(([k, v]) => [`${k}`, prepareDirection(v)]);\n    return new Map(sortEntries);\n}\n/** @internal */\nfunction stringsToMap(t) {\n    const sortEntries = t.map(key => [`${key}`, 1]);\n    return new Map(sortEntries);\n}\n/** @internal */\nfunction objectToMap(t) {\n    const sortEntries = Object.entries(t).map(([k, v]) => [\n        `${k}`,\n        prepareDirection(v)\n    ]);\n    return new Map(sortEntries);\n}\n/** @internal */\nfunction mapToMap(t) {\n    const sortEntries = Array.from(t).map(([k, v]) => [\n        `${k}`,\n        prepareDirection(v)\n    ]);\n    return new Map(sortEntries);\n}\n/** converts a Sort type into a type that is valid for the server (SortForCmd) */\nfunction formatSort(sort, direction) {\n    if (sort == null)\n        return undefined;\n    if (typeof sort === 'string')\n        return new Map([[sort, prepareDirection(direction)]]);\n    if (typeof sort !== 'object') {\n        throw new error_1.MongoInvalidArgumentError(`Invalid sort format: ${JSON.stringify(sort)} Sort must be a valid object`);\n    }\n    if (!Array.isArray(sort)) {\n        return isMap(sort) ? mapToMap(sort) : Object.keys(sort).length ? objectToMap(sort) : undefined;\n    }\n    if (!sort.length)\n        return undefined;\n    if (isDeep(sort))\n        return deepToMap(sort);\n    if (isPair(sort))\n        return pairToMap(sort);\n    return stringsToMap(sort);\n}\n//# sourceMappingURL=sort.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3NvcnQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0JBQWtCO0FBQ2xCLGdCQUFnQixtQkFBTyxDQUFDLDRGQUFTO0FBQ2pDO0FBQ0E7QUFDQSxxQkFBcUIsVUFBVTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRkFBbUYsMEJBQTBCO0FBQzdHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixLQUFLO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxFQUFFO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLElBQUk7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsRUFBRTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxFQUFFO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSxzQkFBc0I7QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi9zb3J0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5mb3JtYXRTb3J0ID0gZm9ybWF0U29ydDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIHByZXBhcmVEaXJlY3Rpb24oZGlyZWN0aW9uID0gMSkge1xuICAgIGNvbnN0IHZhbHVlID0gYCR7ZGlyZWN0aW9ufWAudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoaXNNZXRhKGRpcmVjdGlvbikpXG4gICAgICAgIHJldHVybiBkaXJlY3Rpb247XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICBjYXNlICdhc2NlbmRpbmcnOlxuICAgICAgICBjYXNlICdhc2MnOlxuICAgICAgICBjYXNlICcxJzpcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICBjYXNlICdkZXNjZW5kaW5nJzpcbiAgICAgICAgY2FzZSAnZGVzYyc6XG4gICAgICAgIGNhc2UgJy0xJzpcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvSW52YWxpZEFyZ3VtZW50RXJyb3IoYEludmFsaWQgc29ydCBkaXJlY3Rpb246ICR7SlNPTi5zdHJpbmdpZnkoZGlyZWN0aW9uKX1gKTtcbiAgICB9XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBpc01ldGEodCkge1xuICAgIHJldHVybiB0eXBlb2YgdCA9PT0gJ29iamVjdCcgJiYgdCAhPSBudWxsICYmICckbWV0YScgaW4gdCAmJiB0eXBlb2YgdC4kbWV0YSA9PT0gJ3N0cmluZyc7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBpc1BhaXIodCkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHQpICYmIHQubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBwcmVwYXJlRGlyZWN0aW9uKHRbMV0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGlzRGVlcCh0KSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodCkgJiYgQXJyYXkuaXNBcnJheSh0WzBdKTtcbn1cbmZ1bmN0aW9uIGlzTWFwKHQpIHtcbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIE1hcCAmJiB0LnNpemUgPiAwO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gcGFpclRvTWFwKHYpIHtcbiAgICByZXR1cm4gbmV3IE1hcChbW2Ake3ZbMF19YCwgcHJlcGFyZURpcmVjdGlvbihbdlsxXV0pXV0pO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gZGVlcFRvTWFwKHQpIHtcbiAgICBjb25zdCBzb3J0RW50cmllcyA9IHQubWFwKChbaywgdl0pID0+IFtgJHtrfWAsIHByZXBhcmVEaXJlY3Rpb24odildKTtcbiAgICByZXR1cm4gbmV3IE1hcChzb3J0RW50cmllcyk7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBzdHJpbmdzVG9NYXAodCkge1xuICAgIGNvbnN0IHNvcnRFbnRyaWVzID0gdC5tYXAoa2V5ID0+IFtgJHtrZXl9YCwgMV0pO1xuICAgIHJldHVybiBuZXcgTWFwKHNvcnRFbnRyaWVzKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG9iamVjdFRvTWFwKHQpIHtcbiAgICBjb25zdCBzb3J0RW50cmllcyA9IE9iamVjdC5lbnRyaWVzKHQpLm1hcCgoW2ssIHZdKSA9PiBbXG4gICAgICAgIGAke2t9YCxcbiAgICAgICAgcHJlcGFyZURpcmVjdGlvbih2KVxuICAgIF0pO1xuICAgIHJldHVybiBuZXcgTWFwKHNvcnRFbnRyaWVzKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG1hcFRvTWFwKHQpIHtcbiAgICBjb25zdCBzb3J0RW50cmllcyA9IEFycmF5LmZyb20odCkubWFwKChbaywgdl0pID0+IFtcbiAgICAgICAgYCR7a31gLFxuICAgICAgICBwcmVwYXJlRGlyZWN0aW9uKHYpXG4gICAgXSk7XG4gICAgcmV0dXJuIG5ldyBNYXAoc29ydEVudHJpZXMpO1xufVxuLyoqIGNvbnZlcnRzIGEgU29ydCB0eXBlIGludG8gYSB0eXBlIHRoYXQgaXMgdmFsaWQgZm9yIHRoZSBzZXJ2ZXIgKFNvcnRGb3JDbWQpICovXG5mdW5jdGlvbiBmb3JtYXRTb3J0KHNvcnQsIGRpcmVjdGlvbikge1xuICAgIGlmIChzb3J0ID09IG51bGwpXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgaWYgKHR5cGVvZiBzb3J0ID09PSAnc3RyaW5nJylcbiAgICAgICAgcmV0dXJuIG5ldyBNYXAoW1tzb3J0LCBwcmVwYXJlRGlyZWN0aW9uKGRpcmVjdGlvbildXSk7XG4gICAgaWYgKHR5cGVvZiBzb3J0ICE9PSAnb2JqZWN0Jykge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0ludmFsaWRBcmd1bWVudEVycm9yKGBJbnZhbGlkIHNvcnQgZm9ybWF0OiAke0pTT04uc3RyaW5naWZ5KHNvcnQpfSBTb3J0IG11c3QgYmUgYSB2YWxpZCBvYmplY3RgKTtcbiAgICB9XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHNvcnQpKSB7XG4gICAgICAgIHJldHVybiBpc01hcChzb3J0KSA/IG1hcFRvTWFwKHNvcnQpIDogT2JqZWN0LmtleXMoc29ydCkubGVuZ3RoID8gb2JqZWN0VG9NYXAoc29ydCkgOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGlmICghc29ydC5sZW5ndGgpXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgaWYgKGlzRGVlcChzb3J0KSlcbiAgICAgICAgcmV0dXJuIGRlZXBUb01hcChzb3J0KTtcbiAgICBpZiAoaXNQYWlyKHNvcnQpKVxuICAgICAgICByZXR1cm4gcGFpclRvTWFwKHNvcnQpO1xuICAgIHJldHVybiBzdHJpbmdzVG9NYXAoc29ydCk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zb3J0LmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sort.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.LegacyTimeoutContext = exports.CSOTTimeoutContext = exports.TimeoutContext = exports.Timeout = exports.TimeoutError = void 0;\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst utils_1 = __webpack_require__(/*! ./utils */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\");\n/** @internal */\nclass TimeoutError extends Error {\n    get name() {\n        return 'TimeoutError';\n    }\n    constructor(message, options) {\n        super(message, options);\n        this.duration = options.duration;\n    }\n    static is(error) {\n        return (error != null && typeof error === 'object' && 'name' in error && error.name === 'TimeoutError');\n    }\n}\nexports.TimeoutError = TimeoutError;\n/**\n * @internal\n * This class is an abstraction over timeouts\n * The Timeout class can only be in the pending or rejected states. It is guaranteed not to resolve\n * if interacted with exclusively through its public API\n * */\nclass Timeout extends Promise {\n    get remainingTime() {\n        if (this.timedOut)\n            return 0;\n        if (this.duration === 0)\n            return Infinity;\n        return this.start + this.duration - Math.trunc(performance.now());\n    }\n    get timeElapsed() {\n        return Math.trunc(performance.now()) - this.start;\n    }\n    /** Create a new timeout that expires in `duration` ms */\n    constructor(executor = () => null, options) {\n        const duration = options?.duration ?? 0;\n        const unref = !!options?.unref;\n        const rejection = options?.rejection;\n        if (duration < 0) {\n            throw new error_1.MongoInvalidArgumentError('Cannot create a Timeout with a negative duration');\n        }\n        let reject;\n        super((_, promiseReject) => {\n            reject = promiseReject;\n            executor(utils_1.noop, promiseReject);\n        });\n        this.ended = null;\n        this.timedOut = false;\n        this.cleared = false;\n        this.duration = duration;\n        this.start = Math.trunc(performance.now());\n        if (rejection == null && this.duration > 0) {\n            this.id = (0, timers_1.setTimeout)(() => {\n                this.ended = Math.trunc(performance.now());\n                this.timedOut = true;\n                reject(new TimeoutError(`Expired after ${duration}ms`, { duration }));\n            }, this.duration);\n            if (typeof this.id.unref === 'function' && unref) {\n                // Ensure we do not keep the Node.js event loop running\n                this.id.unref();\n            }\n        }\n        else if (rejection != null) {\n            this.ended = Math.trunc(performance.now());\n            this.timedOut = true;\n            reject(rejection);\n        }\n    }\n    /**\n     * Clears the underlying timeout. This method is idempotent\n     */\n    clear() {\n        (0, timers_1.clearTimeout)(this.id);\n        this.id = undefined;\n        this.timedOut = false;\n        this.cleared = true;\n    }\n    throwIfExpired() {\n        if (this.timedOut) {\n            // This method is invoked when someone wants to throw immediately instead of await the result of this promise\n            // Since they won't be handling the rejection from the promise (because we're about to throw here)\n            // attach handling to prevent this from bubbling up to Node.js\n            this.then(undefined, utils_1.squashError);\n            throw new TimeoutError('Timed out', { duration: this.duration });\n        }\n    }\n    static expires(duration, unref) {\n        return new Timeout(undefined, { duration, unref });\n    }\n    static reject(rejection) {\n        return new Timeout(undefined, { duration: 0, unref: true, rejection });\n    }\n}\nexports.Timeout = Timeout;\nfunction isLegacyTimeoutContextOptions(v) {\n    return (v != null &&\n        typeof v === 'object' &&\n        'serverSelectionTimeoutMS' in v &&\n        typeof v.serverSelectionTimeoutMS === 'number' &&\n        'waitQueueTimeoutMS' in v &&\n        typeof v.waitQueueTimeoutMS === 'number');\n}\nfunction isCSOTTimeoutContextOptions(v) {\n    return (v != null &&\n        typeof v === 'object' &&\n        'serverSelectionTimeoutMS' in v &&\n        typeof v.serverSelectionTimeoutMS === 'number' &&\n        'timeoutMS' in v &&\n        typeof v.timeoutMS === 'number');\n}\n/** @internal */\nclass TimeoutContext {\n    static create(options) {\n        if (options.session?.timeoutContext != null)\n            return options.session?.timeoutContext;\n        if (isCSOTTimeoutContextOptions(options))\n            return new CSOTTimeoutContext(options);\n        else if (isLegacyTimeoutContextOptions(options))\n            return new LegacyTimeoutContext(options);\n        else\n            throw new error_1.MongoRuntimeError('Unrecognized options');\n    }\n}\nexports.TimeoutContext = TimeoutContext;\n/** @internal */\nclass CSOTTimeoutContext extends TimeoutContext {\n    constructor(options) {\n        super();\n        this.minRoundTripTime = 0;\n        this.start = Math.trunc(performance.now());\n        this.timeoutMS = options.timeoutMS;\n        this.serverSelectionTimeoutMS = options.serverSelectionTimeoutMS;\n        this.socketTimeoutMS = options.socketTimeoutMS;\n        this.clearServerSelectionTimeout = false;\n    }\n    get maxTimeMS() {\n        return this.remainingTimeMS - this.minRoundTripTime;\n    }\n    get remainingTimeMS() {\n        const timePassed = Math.trunc(performance.now()) - this.start;\n        return this.timeoutMS <= 0 ? Infinity : this.timeoutMS - timePassed;\n    }\n    csotEnabled() {\n        return true;\n    }\n    get serverSelectionTimeout() {\n        // check for undefined\n        if (typeof this._serverSelectionTimeout !== 'object' || this._serverSelectionTimeout?.cleared) {\n            const { remainingTimeMS, serverSelectionTimeoutMS } = this;\n            if (remainingTimeMS <= 0)\n                return Timeout.reject(new error_1.MongoOperationTimeoutError(`Timed out in server selection after ${this.timeoutMS}ms`));\n            const usingServerSelectionTimeoutMS = serverSelectionTimeoutMS !== 0 &&\n                (0, utils_1.csotMin)(remainingTimeMS, serverSelectionTimeoutMS) === serverSelectionTimeoutMS;\n            if (usingServerSelectionTimeoutMS) {\n                this._serverSelectionTimeout = Timeout.expires(serverSelectionTimeoutMS);\n            }\n            else {\n                if (remainingTimeMS > 0 && Number.isFinite(remainingTimeMS)) {\n                    this._serverSelectionTimeout = Timeout.expires(remainingTimeMS);\n                }\n                else {\n                    this._serverSelectionTimeout = null;\n                }\n            }\n        }\n        return this._serverSelectionTimeout;\n    }\n    get connectionCheckoutTimeout() {\n        if (typeof this._connectionCheckoutTimeout !== 'object' ||\n            this._connectionCheckoutTimeout?.cleared) {\n            if (typeof this._serverSelectionTimeout === 'object') {\n                // null or Timeout\n                this._connectionCheckoutTimeout = this._serverSelectionTimeout;\n            }\n            else {\n                throw new error_1.MongoRuntimeError('Unreachable. If you are seeing this error, please file a ticket on the NODE driver project on Jira');\n            }\n        }\n        return this._connectionCheckoutTimeout;\n    }\n    get timeoutForSocketWrite() {\n        const { remainingTimeMS } = this;\n        if (!Number.isFinite(remainingTimeMS))\n            return null;\n        if (remainingTimeMS > 0)\n            return Timeout.expires(remainingTimeMS);\n        return Timeout.reject(new error_1.MongoOperationTimeoutError('Timed out before socket write'));\n    }\n    get timeoutForSocketRead() {\n        const { remainingTimeMS } = this;\n        if (!Number.isFinite(remainingTimeMS))\n            return null;\n        if (remainingTimeMS > 0)\n            return Timeout.expires(remainingTimeMS);\n        return Timeout.reject(new error_1.MongoOperationTimeoutError('Timed out before socket read'));\n    }\n    refresh() {\n        this.start = Math.trunc(performance.now());\n        this.minRoundTripTime = 0;\n        this._serverSelectionTimeout?.clear();\n        this._connectionCheckoutTimeout?.clear();\n    }\n    clear() {\n        this._serverSelectionTimeout?.clear();\n        this._connectionCheckoutTimeout?.clear();\n    }\n    /**\n     * @internal\n     * Throws a MongoOperationTimeoutError if the context has expired.\n     * If the context has not expired, returns the `remainingTimeMS`\n     **/\n    getRemainingTimeMSOrThrow(message) {\n        const { remainingTimeMS } = this;\n        if (remainingTimeMS <= 0)\n            throw new error_1.MongoOperationTimeoutError(message ?? `Expired after ${this.timeoutMS}ms`);\n        return remainingTimeMS;\n    }\n    /**\n     * @internal\n     * This method is intended to be used in situations where concurrent operation are on the same deadline, but cannot share a single `TimeoutContext` instance.\n     * Returns a new instance of `CSOTTimeoutContext` constructed with identical options, but setting the `start` property to `this.start`.\n     */\n    clone() {\n        const timeoutContext = new CSOTTimeoutContext({\n            timeoutMS: this.timeoutMS,\n            serverSelectionTimeoutMS: this.serverSelectionTimeoutMS\n        });\n        timeoutContext.start = this.start;\n        return timeoutContext;\n    }\n    refreshed() {\n        return new CSOTTimeoutContext(this);\n    }\n    addMaxTimeMSToCommand(command, options) {\n        if (options.omitMaxTimeMS)\n            return;\n        const maxTimeMS = this.remainingTimeMS - this.minRoundTripTime;\n        if (maxTimeMS > 0 && Number.isFinite(maxTimeMS))\n            command.maxTimeMS = maxTimeMS;\n    }\n    getSocketTimeoutMS() {\n        return 0;\n    }\n}\nexports.CSOTTimeoutContext = CSOTTimeoutContext;\n/** @internal */\nclass LegacyTimeoutContext extends TimeoutContext {\n    constructor(options) {\n        super();\n        this.options = options;\n        this.clearServerSelectionTimeout = true;\n    }\n    csotEnabled() {\n        return false;\n    }\n    get serverSelectionTimeout() {\n        if (this.options.serverSelectionTimeoutMS != null && this.options.serverSelectionTimeoutMS > 0)\n            return Timeout.expires(this.options.serverSelectionTimeoutMS);\n        return null;\n    }\n    get connectionCheckoutTimeout() {\n        if (this.options.waitQueueTimeoutMS != null && this.options.waitQueueTimeoutMS > 0)\n            return Timeout.expires(this.options.waitQueueTimeoutMS);\n        return null;\n    }\n    get timeoutForSocketWrite() {\n        return null;\n    }\n    get timeoutForSocketRead() {\n        return null;\n    }\n    refresh() {\n        return;\n    }\n    clear() {\n        return;\n    }\n    get maxTimeMS() {\n        return null;\n    }\n    refreshed() {\n        return new LegacyTimeoutContext(this.options);\n    }\n    addMaxTimeMSToCommand(_command, _options) {\n        // No max timeMS is added to commands in legacy timeout mode.\n    }\n    getSocketTimeoutMS() {\n        return this.options.socketTimeoutMS;\n    }\n}\nexports.LegacyTimeoutContext = LegacyTimeoutContext;\n//# sourceMappingURL=timeout.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3RpbWVvdXQuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsNEJBQTRCLEdBQUcsMEJBQTBCLEdBQUcsc0JBQXNCLEdBQUcsZUFBZSxHQUFHLG9CQUFvQjtBQUMzSCxpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQyxnQkFBZ0IsbUJBQU8sQ0FBQyw0RkFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxTQUFTLE9BQU8sVUFBVTtBQUNuRixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCx5QkFBeUI7QUFDM0U7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGlCQUFpQjtBQUN6RDtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDRDQUE0QztBQUNoRTtBQUNBLG9IQUFvSCxlQUFlO0FBQ25JO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixrQkFBa0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isa0JBQWtCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGtCQUFrQjtBQUNsQztBQUNBLHFGQUFxRixlQUFlO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi90aW1lb3V0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5MZWdhY3lUaW1lb3V0Q29udGV4dCA9IGV4cG9ydHMuQ1NPVFRpbWVvdXRDb250ZXh0ID0gZXhwb3J0cy5UaW1lb3V0Q29udGV4dCA9IGV4cG9ydHMuVGltZW91dCA9IGV4cG9ydHMuVGltZW91dEVycm9yID0gdm9pZCAwO1xuY29uc3QgdGltZXJzXzEgPSByZXF1aXJlKFwidGltZXJzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgdXRpbHNfMSA9IHJlcXVpcmUoXCIuL3V0aWxzXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgVGltZW91dEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gJ1RpbWVvdXRFcnJvcic7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uO1xuICAgIH1cbiAgICBzdGF0aWMgaXMoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIChlcnJvciAhPSBudWxsICYmIHR5cGVvZiBlcnJvciA9PT0gJ29iamVjdCcgJiYgJ25hbWUnIGluIGVycm9yICYmIGVycm9yLm5hbWUgPT09ICdUaW1lb3V0RXJyb3InKTtcbiAgICB9XG59XG5leHBvcnRzLlRpbWVvdXRFcnJvciA9IFRpbWVvdXRFcnJvcjtcbi8qKlxuICogQGludGVybmFsXG4gKiBUaGlzIGNsYXNzIGlzIGFuIGFic3RyYWN0aW9uIG92ZXIgdGltZW91dHNcbiAqIFRoZSBUaW1lb3V0IGNsYXNzIGNhbiBvbmx5IGJlIGluIHRoZSBwZW5kaW5nIG9yIHJlamVjdGVkIHN0YXRlcy4gSXQgaXMgZ3VhcmFudGVlZCBub3QgdG8gcmVzb2x2ZVxuICogaWYgaW50ZXJhY3RlZCB3aXRoIGV4Y2x1c2l2ZWx5IHRocm91Z2ggaXRzIHB1YmxpYyBBUElcbiAqICovXG5jbGFzcyBUaW1lb3V0IGV4dGVuZHMgUHJvbWlzZSB7XG4gICAgZ2V0IHJlbWFpbmluZ1RpbWUoKSB7XG4gICAgICAgIGlmICh0aGlzLnRpbWVkT3V0KVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIGlmICh0aGlzLmR1cmF0aW9uID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIEluZmluaXR5O1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydCArIHRoaXMuZHVyYXRpb24gLSBNYXRoLnRydW5jKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICB9XG4gICAgZ2V0IHRpbWVFbGFwc2VkKCkge1xuICAgICAgICByZXR1cm4gTWF0aC50cnVuYyhwZXJmb3JtYW5jZS5ub3coKSkgLSB0aGlzLnN0YXJ0O1xuICAgIH1cbiAgICAvKiogQ3JlYXRlIGEgbmV3IHRpbWVvdXQgdGhhdCBleHBpcmVzIGluIGBkdXJhdGlvbmAgbXMgKi9cbiAgICBjb25zdHJ1Y3RvcihleGVjdXRvciA9ICgpID0+IG51bGwsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBvcHRpb25zPy5kdXJhdGlvbiA/PyAwO1xuICAgICAgICBjb25zdCB1bnJlZiA9ICEhb3B0aW9ucz8udW5yZWY7XG4gICAgICAgIGNvbnN0IHJlamVjdGlvbiA9IG9wdGlvbnM/LnJlamVjdGlvbjtcbiAgICAgICAgaWYgKGR1cmF0aW9uIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQ2Fubm90IGNyZWF0ZSBhIFRpbWVvdXQgd2l0aCBhIG5lZ2F0aXZlIGR1cmF0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJlamVjdDtcbiAgICAgICAgc3VwZXIoKF8sIHByb21pc2VSZWplY3QpID0+IHtcbiAgICAgICAgICAgIHJlamVjdCA9IHByb21pc2VSZWplY3Q7XG4gICAgICAgICAgICBleGVjdXRvcih1dGlsc18xLm5vb3AsIHByb21pc2VSZWplY3QpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lbmRlZCA9IG51bGw7XG4gICAgICAgIHRoaXMudGltZWRPdXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jbGVhcmVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICAgICAgdGhpcy5zdGFydCA9IE1hdGgudHJ1bmMocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICBpZiAocmVqZWN0aW9uID09IG51bGwgJiYgdGhpcy5kdXJhdGlvbiA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBNYXRoLnRydW5jKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVkT3V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IFRpbWVvdXRFcnJvcihgRXhwaXJlZCBhZnRlciAke2R1cmF0aW9ufW1zYCwgeyBkdXJhdGlvbiB9KSk7XG4gICAgICAgICAgICB9LCB0aGlzLmR1cmF0aW9uKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5pZC51bnJlZiA9PT0gJ2Z1bmN0aW9uJyAmJiB1bnJlZikge1xuICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB3ZSBkbyBub3Qga2VlcCB0aGUgTm9kZS5qcyBldmVudCBsb29wIHJ1bm5pbmdcbiAgICAgICAgICAgICAgICB0aGlzLmlkLnVucmVmKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVqZWN0aW9uICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBNYXRoLnRydW5jKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICAgICAgICAgIHRoaXMudGltZWRPdXQgPSB0cnVlO1xuICAgICAgICAgICAgcmVqZWN0KHJlamVjdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSB1bmRlcmx5aW5nIHRpbWVvdXQuIFRoaXMgbWV0aG9kIGlzIGlkZW1wb3RlbnRcbiAgICAgKi9cbiAgICBjbGVhcigpIHtcbiAgICAgICAgKDAsIHRpbWVyc18xLmNsZWFyVGltZW91dCkodGhpcy5pZCk7XG4gICAgICAgIHRoaXMuaWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudGltZWRPdXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jbGVhcmVkID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhyb3dJZkV4cGlyZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLnRpbWVkT3V0KSB7XG4gICAgICAgICAgICAvLyBUaGlzIG1ldGhvZCBpcyBpbnZva2VkIHdoZW4gc29tZW9uZSB3YW50cyB0byB0aHJvdyBpbW1lZGlhdGVseSBpbnN0ZWFkIG9mIGF3YWl0IHRoZSByZXN1bHQgb2YgdGhpcyBwcm9taXNlXG4gICAgICAgICAgICAvLyBTaW5jZSB0aGV5IHdvbid0IGJlIGhhbmRsaW5nIHRoZSByZWplY3Rpb24gZnJvbSB0aGUgcHJvbWlzZSAoYmVjYXVzZSB3ZSdyZSBhYm91dCB0byB0aHJvdyBoZXJlKVxuICAgICAgICAgICAgLy8gYXR0YWNoIGhhbmRsaW5nIHRvIHByZXZlbnQgdGhpcyBmcm9tIGJ1YmJsaW5nIHVwIHRvIE5vZGUuanNcbiAgICAgICAgICAgIHRoaXMudGhlbih1bmRlZmluZWQsIHV0aWxzXzEuc3F1YXNoRXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IFRpbWVvdXRFcnJvcignVGltZWQgb3V0JywgeyBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbiB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgZXhwaXJlcyhkdXJhdGlvbiwgdW5yZWYpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUaW1lb3V0KHVuZGVmaW5lZCwgeyBkdXJhdGlvbiwgdW5yZWYgfSk7XG4gICAgfVxuICAgIHN0YXRpYyByZWplY3QocmVqZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBuZXcgVGltZW91dCh1bmRlZmluZWQsIHsgZHVyYXRpb246IDAsIHVucmVmOiB0cnVlLCByZWplY3Rpb24gfSk7XG4gICAgfVxufVxuZXhwb3J0cy5UaW1lb3V0ID0gVGltZW91dDtcbmZ1bmN0aW9uIGlzTGVnYWN5VGltZW91dENvbnRleHRPcHRpb25zKHYpIHtcbiAgICByZXR1cm4gKHYgIT0gbnVsbCAmJlxuICAgICAgICB0eXBlb2YgdiA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgJ3NlcnZlclNlbGVjdGlvblRpbWVvdXRNUycgaW4gdiAmJlxuICAgICAgICB0eXBlb2Ygdi5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMgPT09ICdudW1iZXInICYmXG4gICAgICAgICd3YWl0UXVldWVUaW1lb3V0TVMnIGluIHYgJiZcbiAgICAgICAgdHlwZW9mIHYud2FpdFF1ZXVlVGltZW91dE1TID09PSAnbnVtYmVyJyk7XG59XG5mdW5jdGlvbiBpc0NTT1RUaW1lb3V0Q29udGV4dE9wdGlvbnModikge1xuICAgIHJldHVybiAodiAhPSBudWxsICYmXG4gICAgICAgIHR5cGVvZiB2ID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAnc2VydmVyU2VsZWN0aW9uVGltZW91dE1TJyBpbiB2ICYmXG4gICAgICAgIHR5cGVvZiB2LnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgJ3RpbWVvdXRNUycgaW4gdiAmJlxuICAgICAgICB0eXBlb2Ygdi50aW1lb3V0TVMgPT09ICdudW1iZXInKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNsYXNzIFRpbWVvdXRDb250ZXh0IHtcbiAgICBzdGF0aWMgY3JlYXRlKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2Vzc2lvbj8udGltZW91dENvbnRleHQgIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLnNlc3Npb24/LnRpbWVvdXRDb250ZXh0O1xuICAgICAgICBpZiAoaXNDU09UVGltZW91dENvbnRleHRPcHRpb25zKG9wdGlvbnMpKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDU09UVGltZW91dENvbnRleHQob3B0aW9ucyk7XG4gICAgICAgIGVsc2UgaWYgKGlzTGVnYWN5VGltZW91dENvbnRleHRPcHRpb25zKG9wdGlvbnMpKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBMZWdhY3lUaW1lb3V0Q29udGV4dChvcHRpb25zKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoJ1VucmVjb2duaXplZCBvcHRpb25zJyk7XG4gICAgfVxufVxuZXhwb3J0cy5UaW1lb3V0Q29udGV4dCA9IFRpbWVvdXRDb250ZXh0O1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgQ1NPVFRpbWVvdXRDb250ZXh0IGV4dGVuZHMgVGltZW91dENvbnRleHQge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5taW5Sb3VuZFRyaXBUaW1lID0gMDtcbiAgICAgICAgdGhpcy5zdGFydCA9IE1hdGgudHJ1bmMocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICB0aGlzLnRpbWVvdXRNUyA9IG9wdGlvbnMudGltZW91dE1TO1xuICAgICAgICB0aGlzLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyA9IG9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TO1xuICAgICAgICB0aGlzLnNvY2tldFRpbWVvdXRNUyA9IG9wdGlvbnMuc29ja2V0VGltZW91dE1TO1xuICAgICAgICB0aGlzLmNsZWFyU2VydmVyU2VsZWN0aW9uVGltZW91dCA9IGZhbHNlO1xuICAgIH1cbiAgICBnZXQgbWF4VGltZU1TKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1haW5pbmdUaW1lTVMgLSB0aGlzLm1pblJvdW5kVHJpcFRpbWU7XG4gICAgfVxuICAgIGdldCByZW1haW5pbmdUaW1lTVMoKSB7XG4gICAgICAgIGNvbnN0IHRpbWVQYXNzZWQgPSBNYXRoLnRydW5jKHBlcmZvcm1hbmNlLm5vdygpKSAtIHRoaXMuc3RhcnQ7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVvdXRNUyA8PSAwID8gSW5maW5pdHkgOiB0aGlzLnRpbWVvdXRNUyAtIHRpbWVQYXNzZWQ7XG4gICAgfVxuICAgIGNzb3RFbmFibGVkKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IHNlcnZlclNlbGVjdGlvblRpbWVvdXQoKSB7XG4gICAgICAgIC8vIGNoZWNrIGZvciB1bmRlZmluZWRcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLl9zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0ICE9PSAnb2JqZWN0JyB8fCB0aGlzLl9zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0Py5jbGVhcmVkKSB7XG4gICAgICAgICAgICBjb25zdCB7IHJlbWFpbmluZ1RpbWVNUywgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWVNUyA8PSAwKVxuICAgICAgICAgICAgICAgIHJldHVybiBUaW1lb3V0LnJlamVjdChuZXcgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcihgVGltZWQgb3V0IGluIHNlcnZlciBzZWxlY3Rpb24gYWZ0ZXIgJHt0aGlzLnRpbWVvdXRNU31tc2ApKTtcbiAgICAgICAgICAgIGNvbnN0IHVzaW5nU2VydmVyU2VsZWN0aW9uVGltZW91dE1TID0gc2VydmVyU2VsZWN0aW9uVGltZW91dE1TICE9PSAwICYmXG4gICAgICAgICAgICAgICAgKDAsIHV0aWxzXzEuY3NvdE1pbikocmVtYWluaW5nVGltZU1TLCBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMpID09PSBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM7XG4gICAgICAgICAgICBpZiAodXNpbmdTZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0ID0gVGltZW91dC5leHBpcmVzKHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nVGltZU1TID4gMCAmJiBOdW1iZXIuaXNGaW5pdGUocmVtYWluaW5nVGltZU1TKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0ID0gVGltZW91dC5leHBpcmVzKHJlbWFpbmluZ1RpbWVNUyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlcnZlclNlbGVjdGlvblRpbWVvdXQ7XG4gICAgfVxuICAgIGdldCBjb25uZWN0aW9uQ2hlY2tvdXRUaW1lb3V0KCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuX2Nvbm5lY3Rpb25DaGVja291dFRpbWVvdXQgIT09ICdvYmplY3QnIHx8XG4gICAgICAgICAgICB0aGlzLl9jb25uZWN0aW9uQ2hlY2tvdXRUaW1lb3V0Py5jbGVhcmVkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuX3NlcnZlclNlbGVjdGlvblRpbWVvdXQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgLy8gbnVsbCBvciBUaW1lb3V0XG4gICAgICAgICAgICAgICAgdGhpcy5fY29ubmVjdGlvbkNoZWNrb3V0VGltZW91dCA9IHRoaXMuX3NlcnZlclNlbGVjdGlvblRpbWVvdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcignVW5yZWFjaGFibGUuIElmIHlvdSBhcmUgc2VlaW5nIHRoaXMgZXJyb3IsIHBsZWFzZSBmaWxlIGEgdGlja2V0IG9uIHRoZSBOT0RFIGRyaXZlciBwcm9qZWN0IG9uIEppcmEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbkNoZWNrb3V0VGltZW91dDtcbiAgICB9XG4gICAgZ2V0IHRpbWVvdXRGb3JTb2NrZXRXcml0ZSgpIHtcbiAgICAgICAgY29uc3QgeyByZW1haW5pbmdUaW1lTVMgfSA9IHRoaXM7XG4gICAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHJlbWFpbmluZ1RpbWVNUykpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWVNUyA+IDApXG4gICAgICAgICAgICByZXR1cm4gVGltZW91dC5leHBpcmVzKHJlbWFpbmluZ1RpbWVNUyk7XG4gICAgICAgIHJldHVybiBUaW1lb3V0LnJlamVjdChuZXcgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcignVGltZWQgb3V0IGJlZm9yZSBzb2NrZXQgd3JpdGUnKSk7XG4gICAgfVxuICAgIGdldCB0aW1lb3V0Rm9yU29ja2V0UmVhZCgpIHtcbiAgICAgICAgY29uc3QgeyByZW1haW5pbmdUaW1lTVMgfSA9IHRoaXM7XG4gICAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHJlbWFpbmluZ1RpbWVNUykpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWVNUyA+IDApXG4gICAgICAgICAgICByZXR1cm4gVGltZW91dC5leHBpcmVzKHJlbWFpbmluZ1RpbWVNUyk7XG4gICAgICAgIHJldHVybiBUaW1lb3V0LnJlamVjdChuZXcgZXJyb3JfMS5Nb25nb09wZXJhdGlvblRpbWVvdXRFcnJvcignVGltZWQgb3V0IGJlZm9yZSBzb2NrZXQgcmVhZCcpKTtcbiAgICB9XG4gICAgcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5zdGFydCA9IE1hdGgudHJ1bmMocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICB0aGlzLm1pblJvdW5kVHJpcFRpbWUgPSAwO1xuICAgICAgICB0aGlzLl9zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0Py5jbGVhcigpO1xuICAgICAgICB0aGlzLl9jb25uZWN0aW9uQ2hlY2tvdXRUaW1lb3V0Py5jbGVhcigpO1xuICAgIH1cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5fc2VydmVyU2VsZWN0aW9uVGltZW91dD8uY2xlYXIoKTtcbiAgICAgICAgdGhpcy5fY29ubmVjdGlvbkNoZWNrb3V0VGltZW91dD8uY2xlYXIoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICogVGhyb3dzIGEgTW9uZ29PcGVyYXRpb25UaW1lb3V0RXJyb3IgaWYgdGhlIGNvbnRleHQgaGFzIGV4cGlyZWQuXG4gICAgICogSWYgdGhlIGNvbnRleHQgaGFzIG5vdCBleHBpcmVkLCByZXR1cm5zIHRoZSBgcmVtYWluaW5nVGltZU1TYFxuICAgICAqKi9cbiAgICBnZXRSZW1haW5pbmdUaW1lTVNPclRocm93KG1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgeyByZW1haW5pbmdUaW1lTVMgfSA9IHRoaXM7XG4gICAgICAgIGlmIChyZW1haW5pbmdUaW1lTVMgPD0gMClcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvT3BlcmF0aW9uVGltZW91dEVycm9yKG1lc3NhZ2UgPz8gYEV4cGlyZWQgYWZ0ZXIgJHt0aGlzLnRpbWVvdXRNU31tc2ApO1xuICAgICAgICByZXR1cm4gcmVtYWluaW5nVGltZU1TO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGluIHNpdHVhdGlvbnMgd2hlcmUgY29uY3VycmVudCBvcGVyYXRpb24gYXJlIG9uIHRoZSBzYW1lIGRlYWRsaW5lLCBidXQgY2Fubm90IHNoYXJlIGEgc2luZ2xlIGBUaW1lb3V0Q29udGV4dGAgaW5zdGFuY2UuXG4gICAgICogUmV0dXJucyBhIG5ldyBpbnN0YW5jZSBvZiBgQ1NPVFRpbWVvdXRDb250ZXh0YCBjb25zdHJ1Y3RlZCB3aXRoIGlkZW50aWNhbCBvcHRpb25zLCBidXQgc2V0dGluZyB0aGUgYHN0YXJ0YCBwcm9wZXJ0eSB0byBgdGhpcy5zdGFydGAuXG4gICAgICovXG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IHRpbWVvdXRDb250ZXh0ID0gbmV3IENTT1RUaW1lb3V0Q29udGV4dCh7XG4gICAgICAgICAgICB0aW1lb3V0TVM6IHRoaXMudGltZW91dE1TLFxuICAgICAgICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiB0aGlzLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNU1xuICAgICAgICB9KTtcbiAgICAgICAgdGltZW91dENvbnRleHQuc3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgICAgICByZXR1cm4gdGltZW91dENvbnRleHQ7XG4gICAgfVxuICAgIHJlZnJlc2hlZCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDU09UVGltZW91dENvbnRleHQodGhpcyk7XG4gICAgfVxuICAgIGFkZE1heFRpbWVNU1RvQ29tbWFuZChjb21tYW5kLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zLm9taXRNYXhUaW1lTVMpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IG1heFRpbWVNUyA9IHRoaXMucmVtYWluaW5nVGltZU1TIC0gdGhpcy5taW5Sb3VuZFRyaXBUaW1lO1xuICAgICAgICBpZiAobWF4VGltZU1TID4gMCAmJiBOdW1iZXIuaXNGaW5pdGUobWF4VGltZU1TKSlcbiAgICAgICAgICAgIGNvbW1hbmQubWF4VGltZU1TID0gbWF4VGltZU1TO1xuICAgIH1cbiAgICBnZXRTb2NrZXRUaW1lb3V0TVMoKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMuQ1NPVFRpbWVvdXRDb250ZXh0ID0gQ1NPVFRpbWVvdXRDb250ZXh0O1xuLyoqIEBpbnRlcm5hbCAqL1xuY2xhc3MgTGVnYWN5VGltZW91dENvbnRleHQgZXh0ZW5kcyBUaW1lb3V0Q29udGV4dCB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNsZWFyU2VydmVyU2VsZWN0aW9uVGltZW91dCA9IHRydWU7XG4gICAgfVxuICAgIGNzb3RFbmFibGVkKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGdldCBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0KCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyAhPSBudWxsICYmIHRoaXMub3B0aW9ucy5zZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMgPiAwKVxuICAgICAgICAgICAgcmV0dXJuIFRpbWVvdXQuZXhwaXJlcyh0aGlzLm9wdGlvbnMuc2VydmVyU2VsZWN0aW9uVGltZW91dE1TKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdldCBjb25uZWN0aW9uQ2hlY2tvdXRUaW1lb3V0KCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLndhaXRRdWV1ZVRpbWVvdXRNUyAhPSBudWxsICYmIHRoaXMub3B0aW9ucy53YWl0UXVldWVUaW1lb3V0TVMgPiAwKVxuICAgICAgICAgICAgcmV0dXJuIFRpbWVvdXQuZXhwaXJlcyh0aGlzLm9wdGlvbnMud2FpdFF1ZXVlVGltZW91dE1TKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdldCB0aW1lb3V0Rm9yU29ja2V0V3JpdGUoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBnZXQgdGltZW91dEZvclNvY2tldFJlYWQoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZWZyZXNoKCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGdldCBtYXhUaW1lTVMoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZWZyZXNoZWQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTGVnYWN5VGltZW91dENvbnRleHQodGhpcy5vcHRpb25zKTtcbiAgICB9XG4gICAgYWRkTWF4VGltZU1TVG9Db21tYW5kKF9jb21tYW5kLCBfb3B0aW9ucykge1xuICAgICAgICAvLyBObyBtYXggdGltZU1TIGlzIGFkZGVkIHRvIGNvbW1hbmRzIGluIGxlZ2FjeSB0aW1lb3V0IG1vZGUuXG4gICAgfVxuICAgIGdldFNvY2tldFRpbWVvdXRNUygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zb2NrZXRUaW1lb3V0TVM7XG4gICAgfVxufVxuZXhwb3J0cy5MZWdhY3lUaW1lb3V0Q29udGV4dCA9IExlZ2FjeVRpbWVvdXRDb250ZXh0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGltZW91dC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/timeout.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/transactions.js":
/*!************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/transactions.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Transaction = exports.TxnState = void 0;\nexports.isTransactionCommand = isTransactionCommand;\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\n/** @internal */\nexports.TxnState = Object.freeze({\n    NO_TRANSACTION: 'NO_TRANSACTION',\n    STARTING_TRANSACTION: 'STARTING_TRANSACTION',\n    TRANSACTION_IN_PROGRESS: 'TRANSACTION_IN_PROGRESS',\n    TRANSACTION_COMMITTED: 'TRANSACTION_COMMITTED',\n    TRANSACTION_COMMITTED_EMPTY: 'TRANSACTION_COMMITTED_EMPTY',\n    TRANSACTION_ABORTED: 'TRANSACTION_ABORTED'\n});\nconst stateMachine = {\n    [exports.TxnState.NO_TRANSACTION]: [exports.TxnState.NO_TRANSACTION, exports.TxnState.STARTING_TRANSACTION],\n    [exports.TxnState.STARTING_TRANSACTION]: [\n        exports.TxnState.TRANSACTION_IN_PROGRESS,\n        exports.TxnState.TRANSACTION_COMMITTED,\n        exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n        exports.TxnState.TRANSACTION_ABORTED\n    ],\n    [exports.TxnState.TRANSACTION_IN_PROGRESS]: [\n        exports.TxnState.TRANSACTION_IN_PROGRESS,\n        exports.TxnState.TRANSACTION_COMMITTED,\n        exports.TxnState.TRANSACTION_ABORTED\n    ],\n    [exports.TxnState.TRANSACTION_COMMITTED]: [\n        exports.TxnState.TRANSACTION_COMMITTED,\n        exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n        exports.TxnState.STARTING_TRANSACTION,\n        exports.TxnState.NO_TRANSACTION\n    ],\n    [exports.TxnState.TRANSACTION_ABORTED]: [exports.TxnState.STARTING_TRANSACTION, exports.TxnState.NO_TRANSACTION],\n    [exports.TxnState.TRANSACTION_COMMITTED_EMPTY]: [\n        exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n        exports.TxnState.NO_TRANSACTION\n    ]\n};\nconst ACTIVE_STATES = new Set([\n    exports.TxnState.STARTING_TRANSACTION,\n    exports.TxnState.TRANSACTION_IN_PROGRESS\n]);\nconst COMMITTED_STATES = new Set([\n    exports.TxnState.TRANSACTION_COMMITTED,\n    exports.TxnState.TRANSACTION_COMMITTED_EMPTY,\n    exports.TxnState.TRANSACTION_ABORTED\n]);\n/**\n * @public\n * A class maintaining state related to a server transaction. Internal Only\n */\nclass Transaction {\n    /** Create a transaction @internal */\n    constructor(options) {\n        options = options ?? {};\n        this.state = exports.TxnState.NO_TRANSACTION;\n        this.options = {};\n        const writeConcern = write_concern_1.WriteConcern.fromOptions(options);\n        if (writeConcern) {\n            if (writeConcern.w === 0) {\n                throw new error_1.MongoTransactionError('Transactions do not support unacknowledged write concern');\n            }\n            this.options.writeConcern = writeConcern;\n        }\n        if (options.readConcern) {\n            this.options.readConcern = read_concern_1.ReadConcern.fromOptions(options);\n        }\n        if (options.readPreference) {\n            this.options.readPreference = read_preference_1.ReadPreference.fromOptions(options);\n        }\n        if (options.maxCommitTimeMS) {\n            this.options.maxTimeMS = options.maxCommitTimeMS;\n        }\n        // TODO: This isn't technically necessary\n        this._pinnedServer = undefined;\n        this._recoveryToken = undefined;\n    }\n    /** @internal */\n    get server() {\n        return this._pinnedServer;\n    }\n    get recoveryToken() {\n        return this._recoveryToken;\n    }\n    get isPinned() {\n        return !!this.server;\n    }\n    /** @returns Whether the transaction has started */\n    get isStarting() {\n        return this.state === exports.TxnState.STARTING_TRANSACTION;\n    }\n    /**\n     * @returns Whether this session is presently in a transaction\n     */\n    get isActive() {\n        return ACTIVE_STATES.has(this.state);\n    }\n    get isCommitted() {\n        return COMMITTED_STATES.has(this.state);\n    }\n    /**\n     * Transition the transaction in the state machine\n     * @internal\n     * @param nextState - The new state to transition to\n     */\n    transition(nextState) {\n        const nextStates = stateMachine[this.state];\n        if (nextStates && nextStates.includes(nextState)) {\n            this.state = nextState;\n            if (this.state === exports.TxnState.NO_TRANSACTION ||\n                this.state === exports.TxnState.STARTING_TRANSACTION ||\n                this.state === exports.TxnState.TRANSACTION_ABORTED) {\n                this.unpinServer();\n            }\n            return;\n        }\n        throw new error_1.MongoRuntimeError(`Attempted illegal state transition from [${this.state}] to [${nextState}]`);\n    }\n    /** @internal */\n    pinServer(server) {\n        if (this.isActive) {\n            this._pinnedServer = server;\n        }\n    }\n    /** @internal */\n    unpinServer() {\n        this._pinnedServer = undefined;\n    }\n}\nexports.Transaction = Transaction;\nfunction isTransactionCommand(command) {\n    return !!(command.commitTransaction || command.abortTransaction);\n}\n//# sourceMappingURL=transactions.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3RyYW5zYWN0aW9ucy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxtQkFBbUIsR0FBRyxnQkFBZ0I7QUFDdEMsNEJBQTRCO0FBQzVCLGdCQUFnQixtQkFBTyxDQUFDLDRGQUFTO0FBQ2pDLHVCQUF1QixtQkFBTyxDQUFDLDBHQUFnQjtBQUMvQywwQkFBMEIsbUJBQU8sQ0FBQyxnSEFBbUI7QUFDckQsd0JBQXdCLG1CQUFPLENBQUMsNEdBQWlCO0FBQ2pEO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdGQUF3RixXQUFXLFFBQVEsVUFBVTtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNrL0Rlc2t0b3AvQnVzaW5lc3MvUGF5bG9hZENNUy9wYXlsb2FkLXN0b3JhZ2UtY2xvdWRpbmFyeS9kZXYvbm9kZV9tb2R1bGVzLy5wbnBtL21vbmdvZGJANi4xNi4wL25vZGVfbW9kdWxlcy9tb25nb2RiL2xpYi90cmFuc2FjdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRyYW5zYWN0aW9uID0gZXhwb3J0cy5UeG5TdGF0ZSA9IHZvaWQgMDtcbmV4cG9ydHMuaXNUcmFuc2FjdGlvbkNvbW1hbmQgPSBpc1RyYW5zYWN0aW9uQ29tbWFuZDtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmNvbnN0IHJlYWRfY29uY2Vybl8xID0gcmVxdWlyZShcIi4vcmVhZF9jb25jZXJuXCIpO1xuY29uc3QgcmVhZF9wcmVmZXJlbmNlXzEgPSByZXF1aXJlKFwiLi9yZWFkX3ByZWZlcmVuY2VcIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5UeG5TdGF0ZSA9IE9iamVjdC5mcmVlemUoe1xuICAgIE5PX1RSQU5TQUNUSU9OOiAnTk9fVFJBTlNBQ1RJT04nLFxuICAgIFNUQVJUSU5HX1RSQU5TQUNUSU9OOiAnU1RBUlRJTkdfVFJBTlNBQ1RJT04nLFxuICAgIFRSQU5TQUNUSU9OX0lOX1BST0dSRVNTOiAnVFJBTlNBQ1RJT05fSU5fUFJPR1JFU1MnLFxuICAgIFRSQU5TQUNUSU9OX0NPTU1JVFRFRDogJ1RSQU5TQUNUSU9OX0NPTU1JVFRFRCcsXG4gICAgVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZOiAnVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZJyxcbiAgICBUUkFOU0FDVElPTl9BQk9SVEVEOiAnVFJBTlNBQ1RJT05fQUJPUlRFRCdcbn0pO1xuY29uc3Qgc3RhdGVNYWNoaW5lID0ge1xuICAgIFtleHBvcnRzLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OXTogW2V4cG9ydHMuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT04sIGV4cG9ydHMuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT05dLFxuICAgIFtleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OXTogW1xuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0lOX1BST0dSRVNTLFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRCxcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFksXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQUJPUlRFRFxuICAgIF0sXG4gICAgW2V4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fSU5fUFJPR1JFU1NdOiBbXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fSU5fUFJPR1JFU1MsXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVELFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0FCT1JURURcbiAgICBdLFxuICAgIFtleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRF06IFtcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURUQsXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuVFJBTlNBQ1RJT05fQ09NTUlUVEVEX0VNUFRZLFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLlNUQVJUSU5HX1RSQU5TQUNUSU9OLFxuICAgICAgICBleHBvcnRzLlR4blN0YXRlLk5PX1RSQU5TQUNUSU9OXG4gICAgXSxcbiAgICBbZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEXTogW2V4cG9ydHMuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04sIGV4cG9ydHMuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT05dLFxuICAgIFtleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0NPTU1JVFRFRF9FTVBUWV06IFtcbiAgICAgICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFksXG4gICAgICAgIGV4cG9ydHMuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT05cbiAgICBdXG59O1xuY29uc3QgQUNUSVZFX1NUQVRFUyA9IG5ldyBTZXQoW1xuICAgIGV4cG9ydHMuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04sXG4gICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9JTl9QUk9HUkVTU1xuXSk7XG5jb25zdCBDT01NSVRURURfU1RBVEVTID0gbmV3IFNldChbXG4gICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURUQsXG4gICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9DT01NSVRURURfRU1QVFksXG4gICAgZXhwb3J0cy5UeG5TdGF0ZS5UUkFOU0FDVElPTl9BQk9SVEVEXG5dKTtcbi8qKlxuICogQHB1YmxpY1xuICogQSBjbGFzcyBtYWludGFpbmluZyBzdGF0ZSByZWxhdGVkIHRvIGEgc2VydmVyIHRyYW5zYWN0aW9uLiBJbnRlcm5hbCBPbmx5XG4gKi9cbmNsYXNzIFRyYW5zYWN0aW9uIHtcbiAgICAvKiogQ3JlYXRlIGEgdHJhbnNhY3Rpb24gQGludGVybmFsICovXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyA/PyB7fTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IGV4cG9ydHMuVHhuU3RhdGUuTk9fVFJBTlNBQ1RJT047XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHt9O1xuICAgICAgICBjb25zdCB3cml0ZUNvbmNlcm4gPSB3cml0ZV9jb25jZXJuXzEuV3JpdGVDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICBpZiAod3JpdGVDb25jZXJuKSB7XG4gICAgICAgICAgICBpZiAod3JpdGVDb25jZXJuLncgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1RyYW5zYWN0aW9uRXJyb3IoJ1RyYW5zYWN0aW9ucyBkbyBub3Qgc3VwcG9ydCB1bmFja25vd2xlZGdlZCB3cml0ZSBjb25jZXJuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMud3JpdGVDb25jZXJuID0gd3JpdGVDb25jZXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnJlYWRDb25jZXJuKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVhZENvbmNlcm4gPSByZWFkX2NvbmNlcm5fMS5SZWFkQ29uY2Vybi5mcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5yZWFkUHJlZmVyZW5jZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlYWRQcmVmZXJlbmNlID0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMubWF4Q29tbWl0VGltZU1TKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWF4VGltZU1TID0gb3B0aW9ucy5tYXhDb21taXRUaW1lTVM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETzogVGhpcyBpc24ndCB0ZWNobmljYWxseSBuZWNlc3NhcnlcbiAgICAgICAgdGhpcy5fcGlubmVkU2VydmVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9yZWNvdmVyeVRva2VuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZ2V0IHNlcnZlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bpbm5lZFNlcnZlcjtcbiAgICB9XG4gICAgZ2V0IHJlY292ZXJ5VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZWNvdmVyeVRva2VuO1xuICAgIH1cbiAgICBnZXQgaXNQaW5uZWQoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuc2VydmVyO1xuICAgIH1cbiAgICAvKiogQHJldHVybnMgV2hldGhlciB0aGUgdHJhbnNhY3Rpb24gaGFzIHN0YXJ0ZWQgKi9cbiAgICBnZXQgaXNTdGFydGluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgPT09IGV4cG9ydHMuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT047XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBzZXNzaW9uIGlzIHByZXNlbnRseSBpbiBhIHRyYW5zYWN0aW9uXG4gICAgICovXG4gICAgZ2V0IGlzQWN0aXZlKCkge1xuICAgICAgICByZXR1cm4gQUNUSVZFX1NUQVRFUy5oYXModGhpcy5zdGF0ZSk7XG4gICAgfVxuICAgIGdldCBpc0NvbW1pdHRlZCgpIHtcbiAgICAgICAgcmV0dXJuIENPTU1JVFRFRF9TVEFURVMuaGFzKHRoaXMuc3RhdGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUcmFuc2l0aW9uIHRoZSB0cmFuc2FjdGlvbiBpbiB0aGUgc3RhdGUgbWFjaGluZVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBwYXJhbSBuZXh0U3RhdGUgLSBUaGUgbmV3IHN0YXRlIHRvIHRyYW5zaXRpb24gdG9cbiAgICAgKi9cbiAgICB0cmFuc2l0aW9uKG5leHRTdGF0ZSkge1xuICAgICAgICBjb25zdCBuZXh0U3RhdGVzID0gc3RhdGVNYWNoaW5lW3RoaXMuc3RhdGVdO1xuICAgICAgICBpZiAobmV4dFN0YXRlcyAmJiBuZXh0U3RhdGVzLmluY2x1ZGVzKG5leHRTdGF0ZSkpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBuZXh0U3RhdGU7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gZXhwb3J0cy5UeG5TdGF0ZS5OT19UUkFOU0FDVElPTiB8fFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPT09IGV4cG9ydHMuVHhuU3RhdGUuU1RBUlRJTkdfVFJBTlNBQ1RJT04gfHxcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID09PSBleHBvcnRzLlR4blN0YXRlLlRSQU5TQUNUSU9OX0FCT1JURUQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVucGluU2VydmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYEF0dGVtcHRlZCBpbGxlZ2FsIHN0YXRlIHRyYW5zaXRpb24gZnJvbSBbJHt0aGlzLnN0YXRlfV0gdG8gWyR7bmV4dFN0YXRlfV1gKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHBpblNlcnZlcihzZXJ2ZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMuX3Bpbm5lZFNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgdW5waW5TZXJ2ZXIoKSB7XG4gICAgICAgIHRoaXMuX3Bpbm5lZFNlcnZlciA9IHVuZGVmaW5lZDtcbiAgICB9XG59XG5leHBvcnRzLlRyYW5zYWN0aW9uID0gVHJhbnNhY3Rpb247XG5mdW5jdGlvbiBpc1RyYW5zYWN0aW9uQ29tbWFuZChjb21tYW5kKSB7XG4gICAgcmV0dXJuICEhKGNvbW1hbmQuY29tbWl0VHJhbnNhY3Rpb24gfHwgY29tbWFuZC5hYm9ydFRyYW5zYWN0aW9uKTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRyYW5zYWN0aW9ucy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/transactions.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.kDispose = exports.randomBytes = exports.COSMOS_DB_MSG = exports.DOCUMENT_DB_MSG = exports.COSMOS_DB_CHECK = exports.DOCUMENT_DB_CHECK = exports.MONGODB_WARNING_CODE = exports.DEFAULT_PK_FACTORY = exports.HostAddress = exports.BufferPool = exports.List = exports.MongoDBCollectionNamespace = exports.MongoDBNamespace = exports.ByteUtils = void 0;\nexports.isUint8Array = isUint8Array;\nexports.hostMatchesWildcards = hostMatchesWildcards;\nexports.normalizeHintField = normalizeHintField;\nexports.isObject = isObject;\nexports.mergeOptions = mergeOptions;\nexports.filterOptions = filterOptions;\nexports.applyRetryableWrites = applyRetryableWrites;\nexports.isPromiseLike = isPromiseLike;\nexports.decorateWithCollation = decorateWithCollation;\nexports.decorateWithReadConcern = decorateWithReadConcern;\nexports.getTopology = getTopology;\nexports.ns = ns;\nexports.makeCounter = makeCounter;\nexports.uuidV4 = uuidV4;\nexports.maxWireVersion = maxWireVersion;\nexports.arrayStrictEqual = arrayStrictEqual;\nexports.errorStrictEqual = errorStrictEqual;\nexports.makeStateMachine = makeStateMachine;\nexports.now = now;\nexports.calculateDurationInMs = calculateDurationInMs;\nexports.hasAtomicOperators = hasAtomicOperators;\nexports.resolveTimeoutOptions = resolveTimeoutOptions;\nexports.resolveOptions = resolveOptions;\nexports.isSuperset = isSuperset;\nexports.isHello = isHello;\nexports.setDifference = setDifference;\nexports.isRecord = isRecord;\nexports.emitWarning = emitWarning;\nexports.emitWarningOnce = emitWarningOnce;\nexports.enumToString = enumToString;\nexports.supportsRetryableWrites = supportsRetryableWrites;\nexports.shuffle = shuffle;\nexports.commandSupportsReadConcern = commandSupportsReadConcern;\nexports.compareObjectId = compareObjectId;\nexports.parseInteger = parseInteger;\nexports.parseUnsignedInteger = parseUnsignedInteger;\nexports.checkParentDomainMatch = checkParentDomainMatch;\nexports.get = get;\nexports.request = request;\nexports.isHostMatch = isHostMatch;\nexports.promiseWithResolvers = promiseWithResolvers;\nexports.squashError = squashError;\nexports.once = once;\nexports.maybeAddIdToDocuments = maybeAddIdToDocuments;\nexports.fileIsAccessible = fileIsAccessible;\nexports.csotMin = csotMin;\nexports.noop = noop;\nexports.decorateDecryptionResult = decorateDecryptionResult;\nexports.addAbortListener = addAbortListener;\nexports.abortable = abortable;\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst fs_1 = __webpack_require__(/*! fs */ \"fs\");\nconst http = __webpack_require__(/*! http */ \"http\");\nconst timers_1 = __webpack_require__(/*! timers */ \"timers\");\nconst url = __webpack_require__(/*! url */ \"url\");\nconst url_1 = __webpack_require__(/*! url */ \"url\");\nconst util_1 = __webpack_require__(/*! util */ \"util\");\nconst bson_1 = __webpack_require__(/*! ./bson */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/bson.js\");\nconst constants_1 = __webpack_require__(/*! ./cmap/wire_protocol/constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/constants.js\");\nconst constants_2 = __webpack_require__(/*! ./constants */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/constants.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nconst read_concern_1 = __webpack_require__(/*! ./read_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_concern.js\");\nconst read_preference_1 = __webpack_require__(/*! ./read_preference */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/read_preference.js\");\nconst common_1 = __webpack_require__(/*! ./sdam/common */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/sdam/common.js\");\nconst write_concern_1 = __webpack_require__(/*! ./write_concern */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\");\nexports.ByteUtils = {\n    toLocalBufferType(buffer) {\n        return Buffer.isBuffer(buffer)\n            ? buffer\n            : Buffer.from(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n    },\n    equals(seqA, seqB) {\n        return exports.ByteUtils.toLocalBufferType(seqA).equals(seqB);\n    },\n    compare(seqA, seqB) {\n        return exports.ByteUtils.toLocalBufferType(seqA).compare(seqB);\n    },\n    toBase64(uint8array) {\n        return exports.ByteUtils.toLocalBufferType(uint8array).toString('base64');\n    }\n};\n/**\n * Returns true if value is a Uint8Array or a Buffer\n * @param value - any value that may be a Uint8Array\n */\nfunction isUint8Array(value) {\n    return (value != null &&\n        typeof value === 'object' &&\n        Symbol.toStringTag in value &&\n        value[Symbol.toStringTag] === 'Uint8Array');\n}\n/**\n * Determines if a connection's address matches a user provided list\n * of domain wildcards.\n */\nfunction hostMatchesWildcards(host, wildcards) {\n    for (const wildcard of wildcards) {\n        if (host === wildcard ||\n            (wildcard.startsWith('*.') && host?.endsWith(wildcard.substring(2, wildcard.length))) ||\n            (wildcard.startsWith('*/') && host?.endsWith(wildcard.substring(2, wildcard.length)))) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Ensure Hint field is in a shape we expect:\n * - object of index names mapping to 1 or -1\n * - just an index name\n * @internal\n */\nfunction normalizeHintField(hint) {\n    let finalHint = undefined;\n    if (typeof hint === 'string') {\n        finalHint = hint;\n    }\n    else if (Array.isArray(hint)) {\n        finalHint = {};\n        hint.forEach(param => {\n            finalHint[param] = 1;\n        });\n    }\n    else if (hint != null && typeof hint === 'object') {\n        finalHint = {};\n        for (const name in hint) {\n            finalHint[name] = hint[name];\n        }\n    }\n    return finalHint;\n}\nconst TO_STRING = (object) => Object.prototype.toString.call(object);\n/**\n * Checks if arg is an Object:\n * - **NOTE**: the check is based on the `[Symbol.toStringTag]() === 'Object'`\n * @internal\n */\nfunction isObject(arg) {\n    return '[object Object]' === TO_STRING(arg);\n}\n/** @internal */\nfunction mergeOptions(target, source) {\n    return { ...target, ...source };\n}\n/** @internal */\nfunction filterOptions(options, names) {\n    const filterOptions = {};\n    for (const name in options) {\n        if (names.includes(name)) {\n            filterOptions[name] = options[name];\n        }\n    }\n    // Filtered options\n    return filterOptions;\n}\n/**\n * Applies retryWrites: true to a command if retryWrites is set on the command's database.\n * @internal\n *\n * @param target - The target command to which we will apply retryWrites.\n * @param db - The database from which we can inherit a retryWrites value.\n */\nfunction applyRetryableWrites(target, db) {\n    if (db && db.s.options?.retryWrites) {\n        target.retryWrites = true;\n    }\n    return target;\n}\n/**\n * Applies a write concern to a command based on well defined inheritance rules, optionally\n * detecting support for the write concern in the first place.\n * @internal\n *\n * @param target - the target command we will be applying the write concern to\n * @param sources - sources where we can inherit default write concerns from\n * @param options - optional settings passed into a command for write concern overrides\n */\n/**\n * Checks if a given value is a Promise\n *\n * @typeParam T - The resolution type of the possible promise\n * @param value - An object that could be a promise\n * @returns true if the provided value is a Promise\n */\nfunction isPromiseLike(value) {\n    return (value != null &&\n        typeof value === 'object' &&\n        'then' in value &&\n        typeof value.then === 'function');\n}\n/**\n * Applies collation to a given command.\n * @internal\n *\n * @param command - the command on which to apply collation\n * @param target - target of command\n * @param options - options containing collation settings\n */\nfunction decorateWithCollation(command, target, options) {\n    const capabilities = getTopology(target).capabilities;\n    if (options.collation && typeof options.collation === 'object') {\n        if (capabilities && capabilities.commandsTakeCollation) {\n            command.collation = options.collation;\n        }\n        else {\n            throw new error_1.MongoCompatibilityError(`Current topology does not support collation`);\n        }\n    }\n}\n/**\n * Applies a read concern to a given command.\n * @internal\n *\n * @param command - the command on which to apply the read concern\n * @param coll - the parent collection of the operation calling this method\n */\nfunction decorateWithReadConcern(command, coll, options) {\n    if (options && options.session && options.session.inTransaction()) {\n        return;\n    }\n    const readConcern = Object.assign({}, command.readConcern || {});\n    if (coll.s.readConcern) {\n        Object.assign(readConcern, coll.s.readConcern);\n    }\n    if (Object.keys(readConcern).length > 0) {\n        Object.assign(command, { readConcern: readConcern });\n    }\n}\n/**\n * A helper function to get the topology from a given provider. Throws\n * if the topology cannot be found.\n * @throws MongoNotConnectedError\n * @internal\n */\nfunction getTopology(provider) {\n    // MongoClient or ClientSession or AbstractCursor\n    if ('topology' in provider && provider.topology) {\n        return provider.topology;\n    }\n    else if ('client' in provider && provider.client.topology) {\n        return provider.client.topology;\n    }\n    throw new error_1.MongoNotConnectedError('MongoClient must be connected to perform this operation');\n}\n/** @internal */\nfunction ns(ns) {\n    return MongoDBNamespace.fromString(ns);\n}\n/** @public */\nclass MongoDBNamespace {\n    /**\n     * Create a namespace object\n     *\n     * @param db - database name\n     * @param collection - collection name\n     */\n    constructor(db, collection) {\n        this.db = db;\n        this.collection = collection;\n        this.collection = collection === '' ? undefined : collection;\n    }\n    toString() {\n        return this.collection ? `${this.db}.${this.collection}` : this.db;\n    }\n    withCollection(collection) {\n        return new MongoDBCollectionNamespace(this.db, collection);\n    }\n    static fromString(namespace) {\n        if (typeof namespace !== 'string' || namespace === '') {\n            // TODO(NODE-3483): Replace with MongoNamespaceError\n            throw new error_1.MongoRuntimeError(`Cannot parse namespace from \"${namespace}\"`);\n        }\n        const [db, ...collectionParts] = namespace.split('.');\n        const collection = collectionParts.join('.');\n        return new MongoDBNamespace(db, collection === '' ? undefined : collection);\n    }\n}\nexports.MongoDBNamespace = MongoDBNamespace;\n/**\n * @public\n *\n * A class representing a collection's namespace.  This class enforces (through Typescript) that\n * the `collection` portion of the namespace is defined and should only be\n * used in scenarios where this can be guaranteed.\n */\nclass MongoDBCollectionNamespace extends MongoDBNamespace {\n    constructor(db, collection) {\n        super(db, collection);\n        this.collection = collection;\n    }\n    static fromString(namespace) {\n        return super.fromString(namespace);\n    }\n}\nexports.MongoDBCollectionNamespace = MongoDBCollectionNamespace;\n/** @internal */\nfunction* makeCounter(seed = 0) {\n    let count = seed;\n    while (true) {\n        const newCount = count;\n        count += 1;\n        yield newCount;\n    }\n}\n/**\n * Synchronously Generate a UUIDv4\n * @internal\n */\nfunction uuidV4() {\n    const result = crypto.randomBytes(16);\n    result[6] = (result[6] & 0x0f) | 0x40;\n    result[8] = (result[8] & 0x3f) | 0x80;\n    return result;\n}\n/**\n * A helper function for determining `maxWireVersion` between legacy and new topology instances\n * @internal\n */\nfunction maxWireVersion(topologyOrServer) {\n    if (topologyOrServer) {\n        if (topologyOrServer.loadBalanced || topologyOrServer.serverApi?.version) {\n            // Since we do not have a monitor in the load balanced mode,\n            // we assume the load-balanced server is always pointed at the latest mongodb version.\n            // There is a risk that for on-prem deployments\n            // that don't upgrade immediately that this could alert to the\n            // application that a feature is available that is actually not.\n            // We also return the max supported wire version for serverAPI.\n            return constants_1.MAX_SUPPORTED_WIRE_VERSION;\n        }\n        if (topologyOrServer.hello) {\n            return topologyOrServer.hello.maxWireVersion;\n        }\n        if ('lastHello' in topologyOrServer && typeof topologyOrServer.lastHello === 'function') {\n            const lastHello = topologyOrServer.lastHello();\n            if (lastHello) {\n                return lastHello.maxWireVersion;\n            }\n        }\n        if (topologyOrServer.description &&\n            'maxWireVersion' in topologyOrServer.description &&\n            topologyOrServer.description.maxWireVersion != null) {\n            return topologyOrServer.description.maxWireVersion;\n        }\n    }\n    return 0;\n}\n/** @internal */\nfunction arrayStrictEqual(arr, arr2) {\n    if (!Array.isArray(arr) || !Array.isArray(arr2)) {\n        return false;\n    }\n    return arr.length === arr2.length && arr.every((elt, idx) => elt === arr2[idx]);\n}\n/** @internal */\nfunction errorStrictEqual(lhs, rhs) {\n    if (lhs === rhs) {\n        return true;\n    }\n    if (!lhs || !rhs) {\n        return lhs === rhs;\n    }\n    if ((lhs == null && rhs != null) || (lhs != null && rhs == null)) {\n        return false;\n    }\n    if (lhs.constructor.name !== rhs.constructor.name) {\n        return false;\n    }\n    if (lhs.message !== rhs.message) {\n        return false;\n    }\n    return true;\n}\n/** @internal */\nfunction makeStateMachine(stateTable) {\n    return function stateTransition(target, newState) {\n        const legalStates = stateTable[target.s.state];\n        if (legalStates && legalStates.indexOf(newState) < 0) {\n            throw new error_1.MongoRuntimeError(`illegal state transition from [${target.s.state}] => [${newState}], allowed: [${legalStates}]`);\n        }\n        target.emit('stateChanged', target.s.state, newState);\n        target.s.state = newState;\n    };\n}\n/** @internal */\nfunction now() {\n    const hrtime = process.hrtime();\n    return Math.floor(hrtime[0] * 1000 + hrtime[1] / 1000000);\n}\n/** @internal */\nfunction calculateDurationInMs(started) {\n    if (typeof started !== 'number') {\n        return -1;\n    }\n    const elapsed = now() - started;\n    return elapsed < 0 ? 0 : elapsed;\n}\n/** @internal */\nfunction hasAtomicOperators(doc) {\n    if (Array.isArray(doc)) {\n        for (const document of doc) {\n            if (hasAtomicOperators(document)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    const keys = Object.keys(doc);\n    return keys.length > 0 && keys[0][0] === '$';\n}\nfunction resolveTimeoutOptions(client, options) {\n    const { socketTimeoutMS, serverSelectionTimeoutMS, waitQueueTimeoutMS, timeoutMS } = client.s.options;\n    return { socketTimeoutMS, serverSelectionTimeoutMS, waitQueueTimeoutMS, timeoutMS, ...options };\n}\n/**\n * Merge inherited properties from parent into options, prioritizing values from options,\n * then values from parent.\n *\n * @param parent - An optional owning class of the operation being run. ex. Db/Collection/MongoClient.\n * @param options - The options passed to the operation method.\n *\n * @internal\n */\nfunction resolveOptions(parent, options) {\n    const result = Object.assign({}, options, (0, bson_1.resolveBSONOptions)(options, parent));\n    const timeoutMS = options?.timeoutMS ?? parent?.timeoutMS;\n    // Users cannot pass a readConcern/writeConcern to operations in a transaction\n    const session = options?.session;\n    if (!session?.inTransaction()) {\n        const readConcern = read_concern_1.ReadConcern.fromOptions(options) ?? parent?.readConcern;\n        if (readConcern) {\n            result.readConcern = readConcern;\n        }\n        let writeConcern = write_concern_1.WriteConcern.fromOptions(options) ?? parent?.writeConcern;\n        if (writeConcern) {\n            if (timeoutMS != null) {\n                writeConcern = write_concern_1.WriteConcern.fromOptions({\n                    writeConcern: {\n                        ...writeConcern,\n                        wtimeout: undefined,\n                        wtimeoutMS: undefined\n                    }\n                });\n            }\n            result.writeConcern = writeConcern;\n        }\n    }\n    result.timeoutMS = timeoutMS;\n    const readPreference = read_preference_1.ReadPreference.fromOptions(options) ?? parent?.readPreference;\n    if (readPreference) {\n        result.readPreference = readPreference;\n    }\n    const isConvenientTransaction = session?.explicit && session?.timeoutContext != null;\n    if (isConvenientTransaction && options?.timeoutMS != null) {\n        throw new error_1.MongoInvalidArgumentError('An operation cannot be given a timeoutMS setting when inside a withTransaction call that has a timeoutMS setting');\n    }\n    return result;\n}\nfunction isSuperset(set, subset) {\n    set = Array.isArray(set) ? new Set(set) : set;\n    subset = Array.isArray(subset) ? new Set(subset) : subset;\n    for (const elem of subset) {\n        if (!set.has(elem)) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Checks if the document is a Hello request\n * @internal\n */\nfunction isHello(doc) {\n    return doc[constants_2.LEGACY_HELLO_COMMAND] || doc.hello ? true : false;\n}\n/** Returns the items that are uniquely in setA */\nfunction setDifference(setA, setB) {\n    const difference = new Set(setA);\n    for (const elem of setB) {\n        difference.delete(elem);\n    }\n    return difference;\n}\nconst HAS_OWN = (object, prop) => Object.prototype.hasOwnProperty.call(object, prop);\nfunction isRecord(value, requiredKeys = undefined) {\n    if (!isObject(value)) {\n        return false;\n    }\n    const ctor = value.constructor;\n    if (ctor && ctor.prototype) {\n        if (!isObject(ctor.prototype)) {\n            return false;\n        }\n        // Check to see if some method exists from the Object exists\n        if (!HAS_OWN(ctor.prototype, 'isPrototypeOf')) {\n            return false;\n        }\n    }\n    if (requiredKeys) {\n        const keys = Object.keys(value);\n        return isSuperset(keys, requiredKeys);\n    }\n    return true;\n}\n/**\n * A sequential list of items in a circularly linked list\n * @remarks\n * The head node is special, it is always defined and has a value of null.\n * It is never \"included\" in the list, in that, it is not returned by pop/shift or yielded by the iterator.\n * The circular linkage and always defined head node are to reduce checks for null next/prev references to zero.\n * New nodes are declared as object literals with keys always in the same order: next, prev, value.\n * @internal\n */\nclass List {\n    get length() {\n        return this.count;\n    }\n    get [Symbol.toStringTag]() {\n        return 'List';\n    }\n    constructor() {\n        this.count = 0;\n        // this is carefully crafted:\n        // declaring a complete and consistently key ordered\n        // object is beneficial to the runtime optimizations\n        this.head = {\n            next: null,\n            prev: null,\n            value: null\n        };\n        this.head.next = this.head;\n        this.head.prev = this.head;\n    }\n    toArray() {\n        return Array.from(this);\n    }\n    toString() {\n        return `head <=> ${this.toArray().join(' <=> ')} <=> head`;\n    }\n    *[Symbol.iterator]() {\n        for (const node of this.nodes()) {\n            yield node.value;\n        }\n    }\n    *nodes() {\n        let ptr = this.head.next;\n        while (ptr !== this.head) {\n            // Save next before yielding so that we make removing within iteration safe\n            const { next } = ptr;\n            yield ptr;\n            ptr = next;\n        }\n    }\n    /** Insert at end of list */\n    push(value) {\n        this.count += 1;\n        const newNode = {\n            next: this.head,\n            prev: this.head.prev,\n            value\n        };\n        this.head.prev.next = newNode;\n        this.head.prev = newNode;\n    }\n    /** Inserts every item inside an iterable instead of the iterable itself */\n    pushMany(iterable) {\n        for (const value of iterable) {\n            this.push(value);\n        }\n    }\n    /** Insert at front of list */\n    unshift(value) {\n        this.count += 1;\n        const newNode = {\n            next: this.head.next,\n            prev: this.head,\n            value\n        };\n        this.head.next.prev = newNode;\n        this.head.next = newNode;\n    }\n    remove(node) {\n        if (node === this.head || this.length === 0) {\n            return null;\n        }\n        this.count -= 1;\n        const prevNode = node.prev;\n        const nextNode = node.next;\n        prevNode.next = nextNode;\n        nextNode.prev = prevNode;\n        return node.value;\n    }\n    /** Removes the first node at the front of the list */\n    shift() {\n        return this.remove(this.head.next);\n    }\n    /** Removes the last node at the end of the list */\n    pop() {\n        return this.remove(this.head.prev);\n    }\n    /** Iterates through the list and removes nodes where filter returns true */\n    prune(filter) {\n        for (const node of this.nodes()) {\n            if (filter(node.value)) {\n                this.remove(node);\n            }\n        }\n    }\n    clear() {\n        this.count = 0;\n        this.head.next = this.head;\n        this.head.prev = this.head;\n    }\n    /** Returns the first item in the list, does not remove */\n    first() {\n        // If the list is empty, value will be the head's null\n        return this.head.next.value;\n    }\n    /** Returns the last item in the list, does not remove */\n    last() {\n        // If the list is empty, value will be the head's null\n        return this.head.prev.value;\n    }\n}\nexports.List = List;\n/**\n * A pool of Buffers which allow you to read them as if they were one\n * @internal\n */\nclass BufferPool {\n    constructor() {\n        this.buffers = new List();\n        this.totalByteLength = 0;\n    }\n    get length() {\n        return this.totalByteLength;\n    }\n    /** Adds a buffer to the internal buffer pool list */\n    append(buffer) {\n        this.buffers.push(buffer);\n        this.totalByteLength += buffer.length;\n    }\n    /**\n     * If BufferPool contains 4 bytes or more construct an int32 from the leading bytes,\n     * otherwise return null. Size can be negative, caller should error check.\n     */\n    getInt32() {\n        if (this.totalByteLength < 4) {\n            return null;\n        }\n        const firstBuffer = this.buffers.first();\n        if (firstBuffer != null && firstBuffer.byteLength >= 4) {\n            return firstBuffer.readInt32LE(0);\n        }\n        // Unlikely case: an int32 is split across buffers.\n        // Use read and put the returned buffer back on top\n        const top4Bytes = this.read(4);\n        const value = top4Bytes.readInt32LE(0);\n        // Put it back.\n        this.totalByteLength += 4;\n        this.buffers.unshift(top4Bytes);\n        return value;\n    }\n    /** Reads the requested number of bytes, optionally consuming them */\n    read(size) {\n        if (typeof size !== 'number' || size < 0) {\n            throw new error_1.MongoInvalidArgumentError('Argument \"size\" must be a non-negative number');\n        }\n        // oversized request returns empty buffer\n        if (size > this.totalByteLength) {\n            return Buffer.alloc(0);\n        }\n        // We know we have enough, we just don't know how it is spread across chunks\n        // TODO(NODE-4732): alloc API should change based on raw option\n        const result = Buffer.allocUnsafe(size);\n        for (let bytesRead = 0; bytesRead < size;) {\n            const buffer = this.buffers.shift();\n            if (buffer == null) {\n                break;\n            }\n            const bytesRemaining = size - bytesRead;\n            const bytesReadable = Math.min(bytesRemaining, buffer.byteLength);\n            const bytes = buffer.subarray(0, bytesReadable);\n            result.set(bytes, bytesRead);\n            bytesRead += bytesReadable;\n            this.totalByteLength -= bytesReadable;\n            if (bytesReadable < buffer.byteLength) {\n                this.buffers.unshift(buffer.subarray(bytesReadable));\n            }\n        }\n        return result;\n    }\n}\nexports.BufferPool = BufferPool;\n/** @public */\nclass HostAddress {\n    constructor(hostString) {\n        this.host = undefined;\n        this.port = undefined;\n        this.socketPath = undefined;\n        this.isIPv6 = false;\n        const escapedHost = hostString.split(' ').join('%20'); // escape spaces, for socket path hosts\n        if (escapedHost.endsWith('.sock')) {\n            // heuristically determine if we're working with a domain socket\n            this.socketPath = decodeURIComponent(escapedHost);\n            return;\n        }\n        const urlString = `iLoveJS://${escapedHost}`;\n        let url;\n        try {\n            url = new url_1.URL(urlString);\n        }\n        catch (urlError) {\n            const runtimeError = new error_1.MongoRuntimeError(`Unable to parse ${escapedHost} with URL`);\n            runtimeError.cause = urlError;\n            throw runtimeError;\n        }\n        const hostname = url.hostname;\n        const port = url.port;\n        let normalized = decodeURIComponent(hostname).toLowerCase();\n        if (normalized.startsWith('[') && normalized.endsWith(']')) {\n            this.isIPv6 = true;\n            normalized = normalized.substring(1, hostname.length - 1);\n        }\n        this.host = normalized.toLowerCase();\n        if (typeof port === 'number') {\n            this.port = port;\n        }\n        else if (typeof port === 'string' && port !== '') {\n            this.port = Number.parseInt(port, 10);\n        }\n        else {\n            this.port = 27017;\n        }\n        if (this.port === 0) {\n            throw new error_1.MongoParseError('Invalid port (zero) with hostname');\n        }\n        Object.freeze(this);\n    }\n    [Symbol.for('nodejs.util.inspect.custom')]() {\n        return this.inspect();\n    }\n    inspect() {\n        return `new HostAddress('${this.toString()}')`;\n    }\n    toString() {\n        if (typeof this.host === 'string') {\n            if (this.isIPv6) {\n                return `[${this.host}]:${this.port}`;\n            }\n            return `${this.host}:${this.port}`;\n        }\n        return `${this.socketPath}`;\n    }\n    static fromString(s) {\n        return new HostAddress(s);\n    }\n    static fromHostPort(host, port) {\n        if (host.includes(':')) {\n            host = `[${host}]`; // IPv6 address\n        }\n        return HostAddress.fromString(`${host}:${port}`);\n    }\n    static fromSrvRecord({ name, port }) {\n        return HostAddress.fromHostPort(name, port);\n    }\n    toHostPort() {\n        if (this.socketPath) {\n            return { host: this.socketPath, port: 0 };\n        }\n        const host = this.host ?? '';\n        const port = this.port ?? 0;\n        return { host, port };\n    }\n}\nexports.HostAddress = HostAddress;\nexports.DEFAULT_PK_FACTORY = {\n    // We prefer not to rely on ObjectId having a createPk method\n    createPk() {\n        return new bson_1.ObjectId();\n    }\n};\n/**\n * When the driver used emitWarning the code will be equal to this.\n * @public\n *\n * @example\n * ```ts\n * process.on('warning', (warning) => {\n *  if (warning.code === MONGODB_WARNING_CODE) console.error('Ah an important warning! :)')\n * })\n * ```\n */\nexports.MONGODB_WARNING_CODE = 'MONGODB DRIVER';\n/** @internal */\nfunction emitWarning(message) {\n    return process.emitWarning(message, { code: exports.MONGODB_WARNING_CODE });\n}\nconst emittedWarnings = new Set();\n/**\n * Will emit a warning once for the duration of the application.\n * Uses the message to identify if it has already been emitted\n * so using string interpolation can cause multiple emits\n * @internal\n */\nfunction emitWarningOnce(message) {\n    if (!emittedWarnings.has(message)) {\n        emittedWarnings.add(message);\n        return emitWarning(message);\n    }\n}\n/**\n * Takes a JS object and joins the values into a string separated by ', '\n */\nfunction enumToString(en) {\n    return Object.values(en).join(', ');\n}\n/**\n * Determine if a server supports retryable writes.\n *\n * @internal\n */\nfunction supportsRetryableWrites(server) {\n    if (!server) {\n        return false;\n    }\n    if (server.loadBalanced) {\n        // Loadbalanced topologies will always support retry writes\n        return true;\n    }\n    if (server.description.logicalSessionTimeoutMinutes != null) {\n        // that supports sessions\n        if (server.description.type !== common_1.ServerType.Standalone) {\n            // and that is not a standalone\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Fisher–Yates Shuffle\n *\n * Reference: https://bost.ocks.org/mike/shuffle/\n * @param sequence - items to be shuffled\n * @param limit - Defaults to `0`. If nonzero shuffle will slice the randomized array e.g, `.slice(0, limit)` otherwise will return the entire randomized array.\n */\nfunction shuffle(sequence, limit = 0) {\n    const items = Array.from(sequence); // shallow copy in order to never shuffle the input\n    if (limit > items.length) {\n        throw new error_1.MongoRuntimeError('Limit must be less than the number of items');\n    }\n    let remainingItemsToShuffle = items.length;\n    const lowerBound = limit % items.length === 0 ? 1 : items.length - limit;\n    while (remainingItemsToShuffle > lowerBound) {\n        // Pick a remaining element\n        const randomIndex = Math.floor(Math.random() * remainingItemsToShuffle);\n        remainingItemsToShuffle -= 1;\n        // And swap it with the current element\n        const swapHold = items[remainingItemsToShuffle];\n        items[remainingItemsToShuffle] = items[randomIndex];\n        items[randomIndex] = swapHold;\n    }\n    return limit % items.length === 0 ? items : items.slice(lowerBound);\n}\n/**\n * TODO(NODE-4936): read concern eligibility for commands should be codified in command construction\n * @internal\n * @see https://github.com/mongodb/specifications/blob/master/source/read-write-concern/read-write-concern.md#read-concern\n */\nfunction commandSupportsReadConcern(command) {\n    if (command.aggregate || command.count || command.distinct || command.find || command.geoNear) {\n        return true;\n    }\n    return false;\n}\n/**\n * Compare objectIds. `null` is always less\n * - `+1 = oid1 is greater than oid2`\n * - `-1 = oid1 is less than oid2`\n * - `+0 = oid1 is equal oid2`\n */\nfunction compareObjectId(oid1, oid2) {\n    if (oid1 == null && oid2 == null) {\n        return 0;\n    }\n    if (oid1 == null) {\n        return -1;\n    }\n    if (oid2 == null) {\n        return 1;\n    }\n    return exports.ByteUtils.compare(oid1.id, oid2.id);\n}\nfunction parseInteger(value) {\n    if (typeof value === 'number')\n        return Math.trunc(value);\n    const parsedValue = Number.parseInt(String(value), 10);\n    return Number.isNaN(parsedValue) ? null : parsedValue;\n}\nfunction parseUnsignedInteger(value) {\n    const parsedInt = parseInteger(value);\n    return parsedInt != null && parsedInt >= 0 ? parsedInt : null;\n}\n/**\n * This function throws a MongoAPIError in the event that either of the following is true:\n * * If the provided address domain does not match the provided parent domain\n * * If the parent domain contains less than three `.` separated parts and the provided address does not contain at least one more domain level than its parent\n *\n * If a DNS server were to become compromised SRV records would still need to\n * advertise addresses that are under the same domain as the srvHost.\n *\n * @param address - The address to check against a domain\n * @param srvHost - The domain to check the provided address against\n * @returns void\n */\nfunction checkParentDomainMatch(address, srvHost) {\n    // Remove trailing dot if exists on either the resolved address or the srv hostname\n    const normalizedAddress = address.endsWith('.') ? address.slice(0, address.length - 1) : address;\n    const normalizedSrvHost = srvHost.endsWith('.') ? srvHost.slice(0, srvHost.length - 1) : srvHost;\n    const allCharacterBeforeFirstDot = /^.*?\\./;\n    const srvIsLessThanThreeParts = normalizedSrvHost.split('.').length < 3;\n    // Remove all characters before first dot\n    // Add leading dot back to string so\n    //   an srvHostDomain = '.trusted.site'\n    //   will not satisfy an addressDomain that endsWith '.fake-trusted.site'\n    const addressDomain = `.${normalizedAddress.replace(allCharacterBeforeFirstDot, '')}`;\n    let srvHostDomain = srvIsLessThanThreeParts\n        ? normalizedSrvHost\n        : `.${normalizedSrvHost.replace(allCharacterBeforeFirstDot, '')}`;\n    if (!srvHostDomain.startsWith('.')) {\n        srvHostDomain = '.' + srvHostDomain;\n    }\n    if (srvIsLessThanThreeParts &&\n        normalizedAddress.split('.').length <= normalizedSrvHost.split('.').length) {\n        throw new error_1.MongoAPIError('Server record does not have at least one more domain level than parent URI');\n    }\n    if (!addressDomain.endsWith(srvHostDomain)) {\n        throw new error_1.MongoAPIError('Server record does not share hostname with parent URI');\n    }\n}\n/**\n * Perform a get request that returns status and body.\n * @internal\n */\nfunction get(url, options = {}) {\n    return new Promise((resolve, reject) => {\n        /* eslint-disable prefer-const */\n        let timeoutId;\n        const request = http\n            .get(url, options, response => {\n            response.setEncoding('utf8');\n            let body = '';\n            response.on('data', chunk => (body += chunk));\n            response.on('end', () => {\n                (0, timers_1.clearTimeout)(timeoutId);\n                resolve({ status: response.statusCode, body });\n            });\n        })\n            .on('error', error => {\n            (0, timers_1.clearTimeout)(timeoutId);\n            reject(error);\n        })\n            .end();\n        timeoutId = (0, timers_1.setTimeout)(() => {\n            request.destroy(new error_1.MongoNetworkTimeoutError(`request timed out after 10 seconds`));\n        }, 10000);\n    });\n}\nasync function request(uri, options = {}) {\n    return await new Promise((resolve, reject) => {\n        const requestOptions = {\n            method: 'GET',\n            timeout: 10000,\n            json: true,\n            ...url.parse(uri),\n            ...options\n        };\n        const req = http.request(requestOptions, res => {\n            res.setEncoding('utf8');\n            let data = '';\n            res.on('data', d => {\n                data += d;\n            });\n            res.once('end', () => {\n                if (options.json === false) {\n                    resolve(data);\n                    return;\n                }\n                try {\n                    const parsed = JSON.parse(data);\n                    resolve(parsed);\n                }\n                catch {\n                    // TODO(NODE-3483)\n                    reject(new error_1.MongoRuntimeError(`Invalid JSON response: \"${data}\"`));\n                }\n            });\n        });\n        req.once('timeout', () => req.destroy(new error_1.MongoNetworkTimeoutError(`Network request to ${uri} timed out after ${options.timeout} ms`)));\n        req.once('error', error => reject(error));\n        req.end();\n    });\n}\n/** @internal */\nexports.DOCUMENT_DB_CHECK = /(\\.docdb\\.amazonaws\\.com$)|(\\.docdb-elastic\\.amazonaws\\.com$)/;\n/** @internal */\nexports.COSMOS_DB_CHECK = /\\.cosmos\\.azure\\.com$/;\n/** @internal */\nexports.DOCUMENT_DB_MSG = 'You appear to be connected to a DocumentDB cluster. For more information regarding feature compatibility and support please visit https://www.mongodb.com/supportability/documentdb';\n/** @internal */\nexports.COSMOS_DB_MSG = 'You appear to be connected to a CosmosDB cluster. For more information regarding feature compatibility and support please visit https://www.mongodb.com/supportability/cosmosdb';\n/** @internal */\nfunction isHostMatch(match, host) {\n    return host && match.test(host.toLowerCase()) ? true : false;\n}\nfunction promiseWithResolvers() {\n    let resolve;\n    let reject;\n    const promise = new Promise(function withResolversExecutor(promiseResolve, promiseReject) {\n        resolve = promiseResolve;\n        reject = promiseReject;\n    });\n    return { promise, resolve, reject };\n}\n/**\n * A noop function intended for use in preventing unhandled rejections.\n *\n * @example\n * ```js\n * const promise = myAsyncTask();\n * // eslint-disable-next-line github/no-then\n * promise.then(undefined, squashError);\n * ```\n */\nfunction squashError(_error) {\n    return;\n}\nexports.randomBytes = (0, util_1.promisify)(crypto.randomBytes);\n/**\n * Replicates the events.once helper.\n *\n * Removes unused signal logic and It **only** supports 0 or 1 argument events.\n *\n * @param ee - An event emitter that may emit `ev`\n * @param name - An event name to wait for\n */\nasync function once(ee, name, options) {\n    options?.signal?.throwIfAborted();\n    const { promise, resolve, reject } = promiseWithResolvers();\n    const onEvent = (data) => resolve(data);\n    const onError = (error) => reject(error);\n    const abortListener = addAbortListener(options?.signal, function () {\n        reject(this.reason);\n    });\n    ee.once(name, onEvent).once('error', onError);\n    try {\n        return await promise;\n    }\n    finally {\n        ee.off(name, onEvent);\n        ee.off('error', onError);\n        abortListener?.[exports.kDispose]();\n    }\n}\nfunction maybeAddIdToDocuments(coll, docOrDocs, options) {\n    const forceServerObjectId = typeof options.forceServerObjectId === 'boolean'\n        ? options.forceServerObjectId\n        : coll.s.db.options?.forceServerObjectId;\n    // no need to modify the docs if server sets the ObjectId\n    if (forceServerObjectId === true) {\n        return docOrDocs;\n    }\n    const transform = (doc) => {\n        if (doc._id == null) {\n            doc._id = coll.s.pkFactory.createPk();\n        }\n        return doc;\n    };\n    return Array.isArray(docOrDocs) ? docOrDocs.map(transform) : transform(docOrDocs);\n}\nasync function fileIsAccessible(fileName, mode) {\n    try {\n        await fs_1.promises.access(fileName, mode);\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nfunction csotMin(duration1, duration2) {\n    if (duration1 === 0)\n        return duration2;\n    if (duration2 === 0)\n        return duration1;\n    return Math.min(duration1, duration2);\n}\nfunction noop() {\n    return;\n}\n/**\n * Recurse through the (identically-shaped) `decrypted` and `original`\n * objects and attach a `decryptedKeys` property on each sub-object that\n * contained encrypted fields. Because we only call this on BSON responses,\n * we do not need to worry about circular references.\n *\n * @internal\n */\nfunction decorateDecryptionResult(decrypted, original, isTopLevelDecorateCall = true) {\n    if (isTopLevelDecorateCall) {\n        // The original value could have been either a JS object or a BSON buffer\n        if (Buffer.isBuffer(original)) {\n            original = (0, bson_1.deserialize)(original);\n        }\n        if (Buffer.isBuffer(decrypted)) {\n            throw new error_1.MongoRuntimeError('Expected result of decryption to be deserialized BSON object');\n        }\n    }\n    if (!decrypted || typeof decrypted !== 'object')\n        return;\n    for (const k of Object.keys(decrypted)) {\n        const originalValue = original[k];\n        // An object was decrypted by libmongocrypt if and only if it was\n        // a BSON Binary object with subtype 6.\n        if (originalValue && originalValue._bsontype === 'Binary' && originalValue.sub_type === 6) {\n            if (!decrypted[constants_2.kDecoratedKeys]) {\n                Object.defineProperty(decrypted, constants_2.kDecoratedKeys, {\n                    value: [],\n                    configurable: true,\n                    enumerable: false,\n                    writable: false\n                });\n            }\n            // this is defined in the preceding if-statement\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            decrypted[constants_2.kDecoratedKeys].push(k);\n            // Do not recurse into this decrypted value. It could be a sub-document/array,\n            // in which case there is no original value associated with its subfields.\n            continue;\n        }\n        decorateDecryptionResult(decrypted[k], originalValue, false);\n    }\n}\n/** @internal */\nexports.kDispose = Symbol.dispose ?? Symbol('dispose');\n/**\n * A utility that helps with writing listener code idiomatically\n *\n * @example\n * ```js\n * using listener = addAbortListener(signal, function () {\n *   console.log('aborted', this.reason);\n * });\n * ```\n *\n * @param signal - if exists adds an abort listener\n * @param listener - the listener to be added to signal\n * @returns A disposable that will remove the abort listener\n */\nfunction addAbortListener(signal, listener) {\n    if (signal == null)\n        return;\n    signal.addEventListener('abort', listener, { once: true });\n    return { [exports.kDispose]: () => signal.removeEventListener('abort', listener) };\n}\n/**\n * Takes a promise and races it with a promise wrapping the abort event of the optionally provided signal.\n * The given promise is _always_ ordered before the signal's abort promise.\n * When given an already rejected promise and an already aborted signal, the promise's rejection takes precedence.\n *\n * Any asynchronous processing in `promise` will continue even after the abort signal has fired,\n * but control will be returned to the caller\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race\n *\n * @param promise - A promise to discard if the signal aborts\n * @param options - An options object carrying an optional signal\n */\nasync function abortable(promise, { signal }) {\n    if (signal == null) {\n        return await promise;\n    }\n    const { promise: aborted, reject } = promiseWithResolvers();\n    const abortListener = signal.aborted\n        ? reject(signal.reason)\n        : addAbortListener(signal, function () {\n            reject(this.reason);\n        });\n    try {\n        return await Promise.race([promise, aborted]);\n    }\n    finally {\n        abortListener?.[exports.kDispose]();\n    }\n}\n//# sourceMappingURL=utils.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3V0aWxzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGdCQUFnQixHQUFHLG1CQUFtQixHQUFHLHFCQUFxQixHQUFHLHVCQUF1QixHQUFHLHVCQUF1QixHQUFHLHlCQUF5QixHQUFHLDRCQUE0QixHQUFHLDBCQUEwQixHQUFHLG1CQUFtQixHQUFHLGtCQUFrQixHQUFHLFlBQVksR0FBRyxrQ0FBa0MsR0FBRyx3QkFBd0IsR0FBRyxpQkFBaUI7QUFDeFYsb0JBQW9CO0FBQ3BCLDRCQUE0QjtBQUM1QiwwQkFBMEI7QUFDMUIsZ0JBQWdCO0FBQ2hCLG9CQUFvQjtBQUNwQixxQkFBcUI7QUFDckIsNEJBQTRCO0FBQzVCLHFCQUFxQjtBQUNyQiw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLG1CQUFtQjtBQUNuQixVQUFVO0FBQ1YsbUJBQW1CO0FBQ25CLGNBQWM7QUFDZCxzQkFBc0I7QUFDdEIsd0JBQXdCO0FBQ3hCLHdCQUF3QjtBQUN4Qix3QkFBd0I7QUFDeEIsV0FBVztBQUNYLDZCQUE2QjtBQUM3QiwwQkFBMEI7QUFDMUIsNkJBQTZCO0FBQzdCLHNCQUFzQjtBQUN0QixrQkFBa0I7QUFDbEIsZUFBZTtBQUNmLHFCQUFxQjtBQUNyQixnQkFBZ0I7QUFDaEIsbUJBQW1CO0FBQ25CLHVCQUF1QjtBQUN2QixvQkFBb0I7QUFDcEIsK0JBQStCO0FBQy9CLGVBQWU7QUFDZixrQ0FBa0M7QUFDbEMsdUJBQXVCO0FBQ3ZCLG9CQUFvQjtBQUNwQiw0QkFBNEI7QUFDNUIsOEJBQThCO0FBQzlCLFdBQVc7QUFDWCxlQUFlO0FBQ2YsbUJBQW1CO0FBQ25CLDRCQUE0QjtBQUM1QixtQkFBbUI7QUFDbkIsWUFBWTtBQUNaLDZCQUE2QjtBQUM3Qix3QkFBd0I7QUFDeEIsZUFBZTtBQUNmLFlBQVk7QUFDWixnQ0FBZ0M7QUFDaEMsd0JBQXdCO0FBQ3hCLGlCQUFpQjtBQUNqQixlQUFlLG1CQUFPLENBQUMsc0JBQVE7QUFDL0IsYUFBYSxtQkFBTyxDQUFDLGNBQUk7QUFDekIsYUFBYSxtQkFBTyxDQUFDLGtCQUFNO0FBQzNCLGlCQUFpQixtQkFBTyxDQUFDLHNCQUFRO0FBQ2pDLFlBQVksbUJBQU8sQ0FBQyxnQkFBSztBQUN6QixjQUFjLG1CQUFPLENBQUMsZ0JBQUs7QUFDM0IsZUFBZSxtQkFBTyxDQUFDLGtCQUFNO0FBQzdCLGVBQWUsbUJBQU8sQ0FBQywwRkFBUTtBQUMvQixvQkFBb0IsbUJBQU8sQ0FBQywwSUFBZ0M7QUFDNUQsb0JBQW9CLG1CQUFPLENBQUMsb0dBQWE7QUFDekMsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsdUJBQXVCLG1CQUFPLENBQUMsMEdBQWdCO0FBQy9DLDBCQUEwQixtQkFBTyxDQUFDLGdIQUFtQjtBQUNyRCxpQkFBaUIsbUJBQU8sQ0FBQyx3R0FBZTtBQUN4Qyx3QkFBd0IsbUJBQU8sQ0FBQyw0R0FBaUI7QUFDakQsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsMkJBQTJCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDBCQUEwQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsUUFBUSxHQUFHLGdCQUFnQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdGQUFnRixVQUFVO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRixlQUFlLFFBQVEsU0FBUyxlQUFlLFlBQVk7QUFDN0k7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMkVBQTJFO0FBQ3ZGLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsOEJBQThCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsaUJBQWlCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0Q7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxZQUFZO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRkFBa0YsYUFBYTtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGdCQUFnQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixVQUFVLElBQUksVUFBVTtBQUNuRDtBQUNBLHNCQUFzQixVQUFVLEdBQUcsVUFBVTtBQUM3QztBQUNBLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLEtBQUssSUFBSTtBQUNoQztBQUNBLHlDQUF5QyxLQUFLLEdBQUcsS0FBSztBQUN0RDtBQUNBLDJCQUEyQixZQUFZO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQSwwQ0FBMEMsb0NBQW9DO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QiwwREFBMEQ7QUFDeEY7QUFDQTtBQUNBLGNBQWMsMERBQTBEO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixtQ0FBbUM7QUFDN0QsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GLEtBQUs7QUFDekY7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULHlHQUF5RyxLQUFLLGtCQUFrQixpQkFBaUI7QUFDako7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwyQkFBMkI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxZQUFZO0FBQzdELGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFFBQVE7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsWUFBWSwyQkFBMkI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL25pY2svRGVza3RvcC9CdXNpbmVzcy9QYXlsb2FkQ01TL3BheWxvYWQtc3RvcmFnZS1jbG91ZGluYXJ5L2Rldi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3V0aWxzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5rRGlzcG9zZSA9IGV4cG9ydHMucmFuZG9tQnl0ZXMgPSBleHBvcnRzLkNPU01PU19EQl9NU0cgPSBleHBvcnRzLkRPQ1VNRU5UX0RCX01TRyA9IGV4cG9ydHMuQ09TTU9TX0RCX0NIRUNLID0gZXhwb3J0cy5ET0NVTUVOVF9EQl9DSEVDSyA9IGV4cG9ydHMuTU9OR09EQl9XQVJOSU5HX0NPREUgPSBleHBvcnRzLkRFRkFVTFRfUEtfRkFDVE9SWSA9IGV4cG9ydHMuSG9zdEFkZHJlc3MgPSBleHBvcnRzLkJ1ZmZlclBvb2wgPSBleHBvcnRzLkxpc3QgPSBleHBvcnRzLk1vbmdvREJDb2xsZWN0aW9uTmFtZXNwYWNlID0gZXhwb3J0cy5Nb25nb0RCTmFtZXNwYWNlID0gZXhwb3J0cy5CeXRlVXRpbHMgPSB2b2lkIDA7XG5leHBvcnRzLmlzVWludDhBcnJheSA9IGlzVWludDhBcnJheTtcbmV4cG9ydHMuaG9zdE1hdGNoZXNXaWxkY2FyZHMgPSBob3N0TWF0Y2hlc1dpbGRjYXJkcztcbmV4cG9ydHMubm9ybWFsaXplSGludEZpZWxkID0gbm9ybWFsaXplSGludEZpZWxkO1xuZXhwb3J0cy5pc09iamVjdCA9IGlzT2JqZWN0O1xuZXhwb3J0cy5tZXJnZU9wdGlvbnMgPSBtZXJnZU9wdGlvbnM7XG5leHBvcnRzLmZpbHRlck9wdGlvbnMgPSBmaWx0ZXJPcHRpb25zO1xuZXhwb3J0cy5hcHBseVJldHJ5YWJsZVdyaXRlcyA9IGFwcGx5UmV0cnlhYmxlV3JpdGVzO1xuZXhwb3J0cy5pc1Byb21pc2VMaWtlID0gaXNQcm9taXNlTGlrZTtcbmV4cG9ydHMuZGVjb3JhdGVXaXRoQ29sbGF0aW9uID0gZGVjb3JhdGVXaXRoQ29sbGF0aW9uO1xuZXhwb3J0cy5kZWNvcmF0ZVdpdGhSZWFkQ29uY2VybiA9IGRlY29yYXRlV2l0aFJlYWRDb25jZXJuO1xuZXhwb3J0cy5nZXRUb3BvbG9neSA9IGdldFRvcG9sb2d5O1xuZXhwb3J0cy5ucyA9IG5zO1xuZXhwb3J0cy5tYWtlQ291bnRlciA9IG1ha2VDb3VudGVyO1xuZXhwb3J0cy51dWlkVjQgPSB1dWlkVjQ7XG5leHBvcnRzLm1heFdpcmVWZXJzaW9uID0gbWF4V2lyZVZlcnNpb247XG5leHBvcnRzLmFycmF5U3RyaWN0RXF1YWwgPSBhcnJheVN0cmljdEVxdWFsO1xuZXhwb3J0cy5lcnJvclN0cmljdEVxdWFsID0gZXJyb3JTdHJpY3RFcXVhbDtcbmV4cG9ydHMubWFrZVN0YXRlTWFjaGluZSA9IG1ha2VTdGF0ZU1hY2hpbmU7XG5leHBvcnRzLm5vdyA9IG5vdztcbmV4cG9ydHMuY2FsY3VsYXRlRHVyYXRpb25Jbk1zID0gY2FsY3VsYXRlRHVyYXRpb25Jbk1zO1xuZXhwb3J0cy5oYXNBdG9taWNPcGVyYXRvcnMgPSBoYXNBdG9taWNPcGVyYXRvcnM7XG5leHBvcnRzLnJlc29sdmVUaW1lb3V0T3B0aW9ucyA9IHJlc29sdmVUaW1lb3V0T3B0aW9ucztcbmV4cG9ydHMucmVzb2x2ZU9wdGlvbnMgPSByZXNvbHZlT3B0aW9ucztcbmV4cG9ydHMuaXNTdXBlcnNldCA9IGlzU3VwZXJzZXQ7XG5leHBvcnRzLmlzSGVsbG8gPSBpc0hlbGxvO1xuZXhwb3J0cy5zZXREaWZmZXJlbmNlID0gc2V0RGlmZmVyZW5jZTtcbmV4cG9ydHMuaXNSZWNvcmQgPSBpc1JlY29yZDtcbmV4cG9ydHMuZW1pdFdhcm5pbmcgPSBlbWl0V2FybmluZztcbmV4cG9ydHMuZW1pdFdhcm5pbmdPbmNlID0gZW1pdFdhcm5pbmdPbmNlO1xuZXhwb3J0cy5lbnVtVG9TdHJpbmcgPSBlbnVtVG9TdHJpbmc7XG5leHBvcnRzLnN1cHBvcnRzUmV0cnlhYmxlV3JpdGVzID0gc3VwcG9ydHNSZXRyeWFibGVXcml0ZXM7XG5leHBvcnRzLnNodWZmbGUgPSBzaHVmZmxlO1xuZXhwb3J0cy5jb21tYW5kU3VwcG9ydHNSZWFkQ29uY2VybiA9IGNvbW1hbmRTdXBwb3J0c1JlYWRDb25jZXJuO1xuZXhwb3J0cy5jb21wYXJlT2JqZWN0SWQgPSBjb21wYXJlT2JqZWN0SWQ7XG5leHBvcnRzLnBhcnNlSW50ZWdlciA9IHBhcnNlSW50ZWdlcjtcbmV4cG9ydHMucGFyc2VVbnNpZ25lZEludGVnZXIgPSBwYXJzZVVuc2lnbmVkSW50ZWdlcjtcbmV4cG9ydHMuY2hlY2tQYXJlbnREb21haW5NYXRjaCA9IGNoZWNrUGFyZW50RG9tYWluTWF0Y2g7XG5leHBvcnRzLmdldCA9IGdldDtcbmV4cG9ydHMucmVxdWVzdCA9IHJlcXVlc3Q7XG5leHBvcnRzLmlzSG9zdE1hdGNoID0gaXNIb3N0TWF0Y2g7XG5leHBvcnRzLnByb21pc2VXaXRoUmVzb2x2ZXJzID0gcHJvbWlzZVdpdGhSZXNvbHZlcnM7XG5leHBvcnRzLnNxdWFzaEVycm9yID0gc3F1YXNoRXJyb3I7XG5leHBvcnRzLm9uY2UgPSBvbmNlO1xuZXhwb3J0cy5tYXliZUFkZElkVG9Eb2N1bWVudHMgPSBtYXliZUFkZElkVG9Eb2N1bWVudHM7XG5leHBvcnRzLmZpbGVJc0FjY2Vzc2libGUgPSBmaWxlSXNBY2Nlc3NpYmxlO1xuZXhwb3J0cy5jc290TWluID0gY3NvdE1pbjtcbmV4cG9ydHMubm9vcCA9IG5vb3A7XG5leHBvcnRzLmRlY29yYXRlRGVjcnlwdGlvblJlc3VsdCA9IGRlY29yYXRlRGVjcnlwdGlvblJlc3VsdDtcbmV4cG9ydHMuYWRkQWJvcnRMaXN0ZW5lciA9IGFkZEFib3J0TGlzdGVuZXI7XG5leHBvcnRzLmFib3J0YWJsZSA9IGFib3J0YWJsZTtcbmNvbnN0IGNyeXB0byA9IHJlcXVpcmUoXCJjcnlwdG9cIik7XG5jb25zdCBmc18xID0gcmVxdWlyZShcImZzXCIpO1xuY29uc3QgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xuY29uc3QgdGltZXJzXzEgPSByZXF1aXJlKFwidGltZXJzXCIpO1xuY29uc3QgdXJsID0gcmVxdWlyZShcInVybFwiKTtcbmNvbnN0IHVybF8xID0gcmVxdWlyZShcInVybFwiKTtcbmNvbnN0IHV0aWxfMSA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xuY29uc3QgYnNvbl8xID0gcmVxdWlyZShcIi4vYnNvblwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY21hcC93aXJlX3Byb3RvY29sL2NvbnN0YW50c1wiKTtcbmNvbnN0IGNvbnN0YW50c18yID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xuY29uc3QgZXJyb3JfMSA9IHJlcXVpcmUoXCIuL2Vycm9yXCIpO1xuY29uc3QgcmVhZF9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi9yZWFkX2NvbmNlcm5cIik7XG5jb25zdCByZWFkX3ByZWZlcmVuY2VfMSA9IHJlcXVpcmUoXCIuL3JlYWRfcHJlZmVyZW5jZVwiKTtcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4vc2RhbS9jb21tb25cIik7XG5jb25zdCB3cml0ZV9jb25jZXJuXzEgPSByZXF1aXJlKFwiLi93cml0ZV9jb25jZXJuXCIpO1xuZXhwb3J0cy5CeXRlVXRpbHMgPSB7XG4gICAgdG9Mb2NhbEJ1ZmZlclR5cGUoYnVmZmVyKSB7XG4gICAgICAgIHJldHVybiBCdWZmZXIuaXNCdWZmZXIoYnVmZmVyKVxuICAgICAgICAgICAgPyBidWZmZXJcbiAgICAgICAgICAgIDogQnVmZmVyLmZyb20oYnVmZmVyLmJ1ZmZlciwgYnVmZmVyLmJ5dGVPZmZzZXQsIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcbiAgICB9LFxuICAgIGVxdWFscyhzZXFBLCBzZXFCKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLkJ5dGVVdGlscy50b0xvY2FsQnVmZmVyVHlwZShzZXFBKS5lcXVhbHMoc2VxQik7XG4gICAgfSxcbiAgICBjb21wYXJlKHNlcUEsIHNlcUIpIHtcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuQnl0ZVV0aWxzLnRvTG9jYWxCdWZmZXJUeXBlKHNlcUEpLmNvbXBhcmUoc2VxQik7XG4gICAgfSxcbiAgICB0b0Jhc2U2NCh1aW50OGFycmF5KSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLkJ5dGVVdGlscy50b0xvY2FsQnVmZmVyVHlwZSh1aW50OGFycmF5KS50b1N0cmluZygnYmFzZTY0Jyk7XG4gICAgfVxufTtcbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHZhbHVlIGlzIGEgVWludDhBcnJheSBvciBhIEJ1ZmZlclxuICogQHBhcmFtIHZhbHVlIC0gYW55IHZhbHVlIHRoYXQgbWF5IGJlIGEgVWludDhBcnJheVxuICovXG5mdW5jdGlvbiBpc1VpbnQ4QXJyYXkodmFsdWUpIHtcbiAgICByZXR1cm4gKHZhbHVlICE9IG51bGwgJiZcbiAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxuICAgICAgICBTeW1ib2wudG9TdHJpbmdUYWcgaW4gdmFsdWUgJiZcbiAgICAgICAgdmFsdWVbU3ltYm9sLnRvU3RyaW5nVGFnXSA9PT0gJ1VpbnQ4QXJyYXknKTtcbn1cbi8qKlxuICogRGV0ZXJtaW5lcyBpZiBhIGNvbm5lY3Rpb24ncyBhZGRyZXNzIG1hdGNoZXMgYSB1c2VyIHByb3ZpZGVkIGxpc3RcbiAqIG9mIGRvbWFpbiB3aWxkY2FyZHMuXG4gKi9cbmZ1bmN0aW9uIGhvc3RNYXRjaGVzV2lsZGNhcmRzKGhvc3QsIHdpbGRjYXJkcykge1xuICAgIGZvciAoY29uc3Qgd2lsZGNhcmQgb2Ygd2lsZGNhcmRzKSB7XG4gICAgICAgIGlmIChob3N0ID09PSB3aWxkY2FyZCB8fFxuICAgICAgICAgICAgKHdpbGRjYXJkLnN0YXJ0c1dpdGgoJyouJykgJiYgaG9zdD8uZW5kc1dpdGgod2lsZGNhcmQuc3Vic3RyaW5nKDIsIHdpbGRjYXJkLmxlbmd0aCkpKSB8fFxuICAgICAgICAgICAgKHdpbGRjYXJkLnN0YXJ0c1dpdGgoJyovJykgJiYgaG9zdD8uZW5kc1dpdGgod2lsZGNhcmQuc3Vic3RyaW5nKDIsIHdpbGRjYXJkLmxlbmd0aCkpKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBFbnN1cmUgSGludCBmaWVsZCBpcyBpbiBhIHNoYXBlIHdlIGV4cGVjdDpcbiAqIC0gb2JqZWN0IG9mIGluZGV4IG5hbWVzIG1hcHBpbmcgdG8gMSBvciAtMVxuICogLSBqdXN0IGFuIGluZGV4IG5hbWVcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBub3JtYWxpemVIaW50RmllbGQoaGludCkge1xuICAgIGxldCBmaW5hbEhpbnQgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHR5cGVvZiBoaW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICBmaW5hbEhpbnQgPSBoaW50O1xuICAgIH1cbiAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGhpbnQpKSB7XG4gICAgICAgIGZpbmFsSGludCA9IHt9O1xuICAgICAgICBoaW50LmZvckVhY2gocGFyYW0gPT4ge1xuICAgICAgICAgICAgZmluYWxIaW50W3BhcmFtXSA9IDE7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChoaW50ICE9IG51bGwgJiYgdHlwZW9mIGhpbnQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIGZpbmFsSGludCA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gaGludCkge1xuICAgICAgICAgICAgZmluYWxIaW50W25hbWVdID0gaGludFtuYW1lXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmluYWxIaW50O1xufVxuY29uc3QgVE9fU1RSSU5HID0gKG9iamVjdCkgPT4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iamVjdCk7XG4vKipcbiAqIENoZWNrcyBpZiBhcmcgaXMgYW4gT2JqZWN0OlxuICogLSAqKk5PVEUqKjogdGhlIGNoZWNrIGlzIGJhc2VkIG9uIHRoZSBgW1N5bWJvbC50b1N0cmluZ1RhZ10oKSA9PT0gJ09iamVjdCdgXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gaXNPYmplY3QoYXJnKSB7XG4gICAgcmV0dXJuICdbb2JqZWN0IE9iamVjdF0nID09PSBUT19TVFJJTkcoYXJnKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG1lcmdlT3B0aW9ucyh0YXJnZXQsIHNvdXJjZSkge1xuICAgIHJldHVybiB7IC4uLnRhcmdldCwgLi4uc291cmNlIH07XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBmaWx0ZXJPcHRpb25zKG9wdGlvbnMsIG5hbWVzKSB7XG4gICAgY29uc3QgZmlsdGVyT3B0aW9ucyA9IHt9O1xuICAgIGZvciAoY29uc3QgbmFtZSBpbiBvcHRpb25zKSB7XG4gICAgICAgIGlmIChuYW1lcy5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICAgICAgZmlsdGVyT3B0aW9uc1tuYW1lXSA9IG9wdGlvbnNbbmFtZV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRmlsdGVyZWQgb3B0aW9uc1xuICAgIHJldHVybiBmaWx0ZXJPcHRpb25zO1xufVxuLyoqXG4gKiBBcHBsaWVzIHJldHJ5V3JpdGVzOiB0cnVlIHRvIGEgY29tbWFuZCBpZiByZXRyeVdyaXRlcyBpcyBzZXQgb24gdGhlIGNvbW1hbmQncyBkYXRhYmFzZS5cbiAqIEBpbnRlcm5hbFxuICpcbiAqIEBwYXJhbSB0YXJnZXQgLSBUaGUgdGFyZ2V0IGNvbW1hbmQgdG8gd2hpY2ggd2Ugd2lsbCBhcHBseSByZXRyeVdyaXRlcy5cbiAqIEBwYXJhbSBkYiAtIFRoZSBkYXRhYmFzZSBmcm9tIHdoaWNoIHdlIGNhbiBpbmhlcml0IGEgcmV0cnlXcml0ZXMgdmFsdWUuXG4gKi9cbmZ1bmN0aW9uIGFwcGx5UmV0cnlhYmxlV3JpdGVzKHRhcmdldCwgZGIpIHtcbiAgICBpZiAoZGIgJiYgZGIucy5vcHRpb25zPy5yZXRyeVdyaXRlcykge1xuICAgICAgICB0YXJnZXQucmV0cnlXcml0ZXMgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0O1xufVxuLyoqXG4gKiBBcHBsaWVzIGEgd3JpdGUgY29uY2VybiB0byBhIGNvbW1hbmQgYmFzZWQgb24gd2VsbCBkZWZpbmVkIGluaGVyaXRhbmNlIHJ1bGVzLCBvcHRpb25hbGx5XG4gKiBkZXRlY3Rpbmcgc3VwcG9ydCBmb3IgdGhlIHdyaXRlIGNvbmNlcm4gaW4gdGhlIGZpcnN0IHBsYWNlLlxuICogQGludGVybmFsXG4gKlxuICogQHBhcmFtIHRhcmdldCAtIHRoZSB0YXJnZXQgY29tbWFuZCB3ZSB3aWxsIGJlIGFwcGx5aW5nIHRoZSB3cml0ZSBjb25jZXJuIHRvXG4gKiBAcGFyYW0gc291cmNlcyAtIHNvdXJjZXMgd2hlcmUgd2UgY2FuIGluaGVyaXQgZGVmYXVsdCB3cml0ZSBjb25jZXJucyBmcm9tXG4gKiBAcGFyYW0gb3B0aW9ucyAtIG9wdGlvbmFsIHNldHRpbmdzIHBhc3NlZCBpbnRvIGEgY29tbWFuZCBmb3Igd3JpdGUgY29uY2VybiBvdmVycmlkZXNcbiAqL1xuLyoqXG4gKiBDaGVja3MgaWYgYSBnaXZlbiB2YWx1ZSBpcyBhIFByb21pc2VcbiAqXG4gKiBAdHlwZVBhcmFtIFQgLSBUaGUgcmVzb2x1dGlvbiB0eXBlIG9mIHRoZSBwb3NzaWJsZSBwcm9taXNlXG4gKiBAcGFyYW0gdmFsdWUgLSBBbiBvYmplY3QgdGhhdCBjb3VsZCBiZSBhIHByb21pc2VcbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZGVkIHZhbHVlIGlzIGEgUHJvbWlzZVxuICovXG5mdW5jdGlvbiBpc1Byb21pc2VMaWtlKHZhbHVlKSB7XG4gICAgcmV0dXJuICh2YWx1ZSAhPSBudWxsICYmXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgJ3RoZW4nIGluIHZhbHVlICYmXG4gICAgICAgIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKTtcbn1cbi8qKlxuICogQXBwbGllcyBjb2xsYXRpb24gdG8gYSBnaXZlbiBjb21tYW5kLlxuICogQGludGVybmFsXG4gKlxuICogQHBhcmFtIGNvbW1hbmQgLSB0aGUgY29tbWFuZCBvbiB3aGljaCB0byBhcHBseSBjb2xsYXRpb25cbiAqIEBwYXJhbSB0YXJnZXQgLSB0YXJnZXQgb2YgY29tbWFuZFxuICogQHBhcmFtIG9wdGlvbnMgLSBvcHRpb25zIGNvbnRhaW5pbmcgY29sbGF0aW9uIHNldHRpbmdzXG4gKi9cbmZ1bmN0aW9uIGRlY29yYXRlV2l0aENvbGxhdGlvbihjb21tYW5kLCB0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBjYXBhYmlsaXRpZXMgPSBnZXRUb3BvbG9neSh0YXJnZXQpLmNhcGFiaWxpdGllcztcbiAgICBpZiAob3B0aW9ucy5jb2xsYXRpb24gJiYgdHlwZW9mIG9wdGlvbnMuY29sbGF0aW9uID09PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoY2FwYWJpbGl0aWVzICYmIGNhcGFiaWxpdGllcy5jb21tYW5kc1Rha2VDb2xsYXRpb24pIHtcbiAgICAgICAgICAgIGNvbW1hbmQuY29sbGF0aW9uID0gb3B0aW9ucy5jb2xsYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0NvbXBhdGliaWxpdHlFcnJvcihgQ3VycmVudCB0b3BvbG9neSBkb2VzIG5vdCBzdXBwb3J0IGNvbGxhdGlvbmApO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBBcHBsaWVzIGEgcmVhZCBjb25jZXJuIHRvIGEgZ2l2ZW4gY29tbWFuZC5cbiAqIEBpbnRlcm5hbFxuICpcbiAqIEBwYXJhbSBjb21tYW5kIC0gdGhlIGNvbW1hbmQgb24gd2hpY2ggdG8gYXBwbHkgdGhlIHJlYWQgY29uY2VyblxuICogQHBhcmFtIGNvbGwgLSB0aGUgcGFyZW50IGNvbGxlY3Rpb24gb2YgdGhlIG9wZXJhdGlvbiBjYWxsaW5nIHRoaXMgbWV0aG9kXG4gKi9cbmZ1bmN0aW9uIGRlY29yYXRlV2l0aFJlYWRDb25jZXJuKGNvbW1hbmQsIGNvbGwsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNlc3Npb24gJiYgb3B0aW9ucy5zZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJlYWRDb25jZXJuID0gT2JqZWN0LmFzc2lnbih7fSwgY29tbWFuZC5yZWFkQ29uY2VybiB8fCB7fSk7XG4gICAgaWYgKGNvbGwucy5yZWFkQ29uY2Vybikge1xuICAgICAgICBPYmplY3QuYXNzaWduKHJlYWRDb25jZXJuLCBjb2xsLnMucmVhZENvbmNlcm4pO1xuICAgIH1cbiAgICBpZiAoT2JqZWN0LmtleXMocmVhZENvbmNlcm4pLmxlbmd0aCA+IDApIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihjb21tYW5kLCB7IHJlYWRDb25jZXJuOiByZWFkQ29uY2VybiB9KTtcbiAgICB9XG59XG4vKipcbiAqIEEgaGVscGVyIGZ1bmN0aW9uIHRvIGdldCB0aGUgdG9wb2xvZ3kgZnJvbSBhIGdpdmVuIHByb3ZpZGVyLiBUaHJvd3NcbiAqIGlmIHRoZSB0b3BvbG9neSBjYW5ub3QgYmUgZm91bmQuXG4gKiBAdGhyb3dzIE1vbmdvTm90Q29ubmVjdGVkRXJyb3JcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBnZXRUb3BvbG9neShwcm92aWRlcikge1xuICAgIC8vIE1vbmdvQ2xpZW50IG9yIENsaWVudFNlc3Npb24gb3IgQWJzdHJhY3RDdXJzb3JcbiAgICBpZiAoJ3RvcG9sb2d5JyBpbiBwcm92aWRlciAmJiBwcm92aWRlci50b3BvbG9neSkge1xuICAgICAgICByZXR1cm4gcHJvdmlkZXIudG9wb2xvZ3k7XG4gICAgfVxuICAgIGVsc2UgaWYgKCdjbGllbnQnIGluIHByb3ZpZGVyICYmIHByb3ZpZGVyLmNsaWVudC50b3BvbG9neSkge1xuICAgICAgICByZXR1cm4gcHJvdmlkZXIuY2xpZW50LnRvcG9sb2d5O1xuICAgIH1cbiAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb05vdENvbm5lY3RlZEVycm9yKCdNb25nb0NsaWVudCBtdXN0IGJlIGNvbm5lY3RlZCB0byBwZXJmb3JtIHRoaXMgb3BlcmF0aW9uJyk7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBucyhucykge1xuICAgIHJldHVybiBNb25nb0RCTmFtZXNwYWNlLmZyb21TdHJpbmcobnMpO1xufVxuLyoqIEBwdWJsaWMgKi9cbmNsYXNzIE1vbmdvREJOYW1lc3BhY2Uge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5hbWVzcGFjZSBvYmplY3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYiAtIGRhdGFiYXNlIG5hbWVcbiAgICAgKiBAcGFyYW0gY29sbGVjdGlvbiAtIGNvbGxlY3Rpb24gbmFtZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGRiLCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbiA9PT0gJycgPyB1bmRlZmluZWQgOiBjb2xsZWN0aW9uO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sbGVjdGlvbiA/IGAke3RoaXMuZGJ9LiR7dGhpcy5jb2xsZWN0aW9ufWAgOiB0aGlzLmRiO1xuICAgIH1cbiAgICB3aXRoQ29sbGVjdGlvbihjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBuZXcgTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2UodGhpcy5kYiwgY29sbGVjdGlvbik7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tU3RyaW5nKG5hbWVzcGFjZSkge1xuICAgICAgICBpZiAodHlwZW9mIG5hbWVzcGFjZSAhPT0gJ3N0cmluZycgfHwgbmFtZXNwYWNlID09PSAnJykge1xuICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpOiBSZXBsYWNlIHdpdGggTW9uZ29OYW1lc3BhY2VFcnJvclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29SdW50aW1lRXJyb3IoYENhbm5vdCBwYXJzZSBuYW1lc3BhY2UgZnJvbSBcIiR7bmFtZXNwYWNlfVwiYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgW2RiLCAuLi5jb2xsZWN0aW9uUGFydHNdID0gbmFtZXNwYWNlLnNwbGl0KCcuJyk7XG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uUGFydHMuam9pbignLicpO1xuICAgICAgICByZXR1cm4gbmV3IE1vbmdvREJOYW1lc3BhY2UoZGIsIGNvbGxlY3Rpb24gPT09ICcnID8gdW5kZWZpbmVkIDogY29sbGVjdGlvbik7XG4gICAgfVxufVxuZXhwb3J0cy5Nb25nb0RCTmFtZXNwYWNlID0gTW9uZ29EQk5hbWVzcGFjZTtcbi8qKlxuICogQHB1YmxpY1xuICpcbiAqIEEgY2xhc3MgcmVwcmVzZW50aW5nIGEgY29sbGVjdGlvbidzIG5hbWVzcGFjZS4gIFRoaXMgY2xhc3MgZW5mb3JjZXMgKHRocm91Z2ggVHlwZXNjcmlwdCkgdGhhdFxuICogdGhlIGBjb2xsZWN0aW9uYCBwb3J0aW9uIG9mIHRoZSBuYW1lc3BhY2UgaXMgZGVmaW5lZCBhbmQgc2hvdWxkIG9ubHkgYmVcbiAqIHVzZWQgaW4gc2NlbmFyaW9zIHdoZXJlIHRoaXMgY2FuIGJlIGd1YXJhbnRlZWQuXG4gKi9cbmNsYXNzIE1vbmdvREJDb2xsZWN0aW9uTmFtZXNwYWNlIGV4dGVuZHMgTW9uZ29EQk5hbWVzcGFjZSB7XG4gICAgY29uc3RydWN0b3IoZGIsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgc3VwZXIoZGIsIGNvbGxlY3Rpb24pO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVN0cmluZyhuYW1lc3BhY2UpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmZyb21TdHJpbmcobmFtZXNwYWNlKTtcbiAgICB9XG59XG5leHBvcnRzLk1vbmdvREJDb2xsZWN0aW9uTmFtZXNwYWNlID0gTW9uZ29EQkNvbGxlY3Rpb25OYW1lc3BhY2U7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiogbWFrZUNvdW50ZXIoc2VlZCA9IDApIHtcbiAgICBsZXQgY291bnQgPSBzZWVkO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvbnN0IG5ld0NvdW50ID0gY291bnQ7XG4gICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgIHlpZWxkIG5ld0NvdW50O1xuICAgIH1cbn1cbi8qKlxuICogU3luY2hyb25vdXNseSBHZW5lcmF0ZSBhIFVVSUR2NFxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIHV1aWRWNCgpIHtcbiAgICBjb25zdCByZXN1bHQgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpO1xuICAgIHJlc3VsdFs2XSA9IChyZXN1bHRbNl0gJiAweDBmKSB8IDB4NDA7XG4gICAgcmVzdWx0WzhdID0gKHJlc3VsdFs4XSAmIDB4M2YpIHwgMHg4MDtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuLyoqXG4gKiBBIGhlbHBlciBmdW5jdGlvbiBmb3IgZGV0ZXJtaW5pbmcgYG1heFdpcmVWZXJzaW9uYCBiZXR3ZWVuIGxlZ2FjeSBhbmQgbmV3IHRvcG9sb2d5IGluc3RhbmNlc1xuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIG1heFdpcmVWZXJzaW9uKHRvcG9sb2d5T3JTZXJ2ZXIpIHtcbiAgICBpZiAodG9wb2xvZ3lPclNlcnZlcikge1xuICAgICAgICBpZiAodG9wb2xvZ3lPclNlcnZlci5sb2FkQmFsYW5jZWQgfHwgdG9wb2xvZ3lPclNlcnZlci5zZXJ2ZXJBcGk/LnZlcnNpb24pIHtcbiAgICAgICAgICAgIC8vIFNpbmNlIHdlIGRvIG5vdCBoYXZlIGEgbW9uaXRvciBpbiB0aGUgbG9hZCBiYWxhbmNlZCBtb2RlLFxuICAgICAgICAgICAgLy8gd2UgYXNzdW1lIHRoZSBsb2FkLWJhbGFuY2VkIHNlcnZlciBpcyBhbHdheXMgcG9pbnRlZCBhdCB0aGUgbGF0ZXN0IG1vbmdvZGIgdmVyc2lvbi5cbiAgICAgICAgICAgIC8vIFRoZXJlIGlzIGEgcmlzayB0aGF0IGZvciBvbi1wcmVtIGRlcGxveW1lbnRzXG4gICAgICAgICAgICAvLyB0aGF0IGRvbid0IHVwZ3JhZGUgaW1tZWRpYXRlbHkgdGhhdCB0aGlzIGNvdWxkIGFsZXJ0IHRvIHRoZVxuICAgICAgICAgICAgLy8gYXBwbGljYXRpb24gdGhhdCBhIGZlYXR1cmUgaXMgYXZhaWxhYmxlIHRoYXQgaXMgYWN0dWFsbHkgbm90LlxuICAgICAgICAgICAgLy8gV2UgYWxzbyByZXR1cm4gdGhlIG1heCBzdXBwb3J0ZWQgd2lyZSB2ZXJzaW9uIGZvciBzZXJ2ZXJBUEkuXG4gICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuTUFYX1NVUFBPUlRFRF9XSVJFX1ZFUlNJT047XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvcG9sb2d5T3JTZXJ2ZXIuaGVsbG8pIHtcbiAgICAgICAgICAgIHJldHVybiB0b3BvbG9neU9yU2VydmVyLmhlbGxvLm1heFdpcmVWZXJzaW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmICgnbGFzdEhlbGxvJyBpbiB0b3BvbG9neU9yU2VydmVyICYmIHR5cGVvZiB0b3BvbG9neU9yU2VydmVyLmxhc3RIZWxsbyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3QgbGFzdEhlbGxvID0gdG9wb2xvZ3lPclNlcnZlci5sYXN0SGVsbG8oKTtcbiAgICAgICAgICAgIGlmIChsYXN0SGVsbG8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGFzdEhlbGxvLm1heFdpcmVWZXJzaW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0b3BvbG9neU9yU2VydmVyLmRlc2NyaXB0aW9uICYmXG4gICAgICAgICAgICAnbWF4V2lyZVZlcnNpb24nIGluIHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24gJiZcbiAgICAgICAgICAgIHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24ubWF4V2lyZVZlcnNpb24gIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRvcG9sb2d5T3JTZXJ2ZXIuZGVzY3JpcHRpb24ubWF4V2lyZVZlcnNpb247XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIDA7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBhcnJheVN0cmljdEVxdWFsKGFyciwgYXJyMikge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShhcnIpIHx8ICFBcnJheS5pc0FycmF5KGFycjIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGFyci5sZW5ndGggPT09IGFycjIubGVuZ3RoICYmIGFyci5ldmVyeSgoZWx0LCBpZHgpID0+IGVsdCA9PT0gYXJyMltpZHhdKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGVycm9yU3RyaWN0RXF1YWwobGhzLCByaHMpIHtcbiAgICBpZiAobGhzID09PSByaHMpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICghbGhzIHx8ICFyaHMpIHtcbiAgICAgICAgcmV0dXJuIGxocyA9PT0gcmhzO1xuICAgIH1cbiAgICBpZiAoKGxocyA9PSBudWxsICYmIHJocyAhPSBudWxsKSB8fCAobGhzICE9IG51bGwgJiYgcmhzID09IG51bGwpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGxocy5jb25zdHJ1Y3Rvci5uYW1lICE9PSByaHMuY29uc3RydWN0b3IubmFtZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChsaHMubWVzc2FnZSAhPT0gcmhzLm1lc3NhZ2UpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG1ha2VTdGF0ZU1hY2hpbmUoc3RhdGVUYWJsZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiBzdGF0ZVRyYW5zaXRpb24odGFyZ2V0LCBuZXdTdGF0ZSkge1xuICAgICAgICBjb25zdCBsZWdhbFN0YXRlcyA9IHN0YXRlVGFibGVbdGFyZ2V0LnMuc3RhdGVdO1xuICAgICAgICBpZiAobGVnYWxTdGF0ZXMgJiYgbGVnYWxTdGF0ZXMuaW5kZXhPZihuZXdTdGF0ZSkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgaWxsZWdhbCBzdGF0ZSB0cmFuc2l0aW9uIGZyb20gWyR7dGFyZ2V0LnMuc3RhdGV9XSA9PiBbJHtuZXdTdGF0ZX1dLCBhbGxvd2VkOiBbJHtsZWdhbFN0YXRlc31dYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LmVtaXQoJ3N0YXRlQ2hhbmdlZCcsIHRhcmdldC5zLnN0YXRlLCBuZXdTdGF0ZSk7XG4gICAgICAgIHRhcmdldC5zLnN0YXRlID0gbmV3U3RhdGU7XG4gICAgfTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIG5vdygpIHtcbiAgICBjb25zdCBocnRpbWUgPSBwcm9jZXNzLmhydGltZSgpO1xuICAgIHJldHVybiBNYXRoLmZsb29yKGhydGltZVswXSAqIDEwMDAgKyBocnRpbWVbMV0gLyAxMDAwMDAwKTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZUR1cmF0aW9uSW5NcyhzdGFydGVkKSB7XG4gICAgaWYgKHR5cGVvZiBzdGFydGVkICE9PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGNvbnN0IGVsYXBzZWQgPSBub3coKSAtIHN0YXJ0ZWQ7XG4gICAgcmV0dXJuIGVsYXBzZWQgPCAwID8gMCA6IGVsYXBzZWQ7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBoYXNBdG9taWNPcGVyYXRvcnMoZG9jKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZG9jKSkge1xuICAgICAgICBmb3IgKGNvbnN0IGRvY3VtZW50IG9mIGRvYykge1xuICAgICAgICAgICAgaWYgKGhhc0F0b21pY09wZXJhdG9ycyhkb2N1bWVudCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhkb2MpO1xuICAgIHJldHVybiBrZXlzLmxlbmd0aCA+IDAgJiYga2V5c1swXVswXSA9PT0gJyQnO1xufVxuZnVuY3Rpb24gcmVzb2x2ZVRpbWVvdXRPcHRpb25zKGNsaWVudCwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgc29ja2V0VGltZW91dE1TLCBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMsIHdhaXRRdWV1ZVRpbWVvdXRNUywgdGltZW91dE1TIH0gPSBjbGllbnQucy5vcHRpb25zO1xuICAgIHJldHVybiB7IHNvY2tldFRpbWVvdXRNUywgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TLCB3YWl0UXVldWVUaW1lb3V0TVMsIHRpbWVvdXRNUywgLi4ub3B0aW9ucyB9O1xufVxuLyoqXG4gKiBNZXJnZSBpbmhlcml0ZWQgcHJvcGVydGllcyBmcm9tIHBhcmVudCBpbnRvIG9wdGlvbnMsIHByaW9yaXRpemluZyB2YWx1ZXMgZnJvbSBvcHRpb25zLFxuICogdGhlbiB2YWx1ZXMgZnJvbSBwYXJlbnQuXG4gKlxuICogQHBhcmFtIHBhcmVudCAtIEFuIG9wdGlvbmFsIG93bmluZyBjbGFzcyBvZiB0aGUgb3BlcmF0aW9uIGJlaW5nIHJ1bi4gZXguIERiL0NvbGxlY3Rpb24vTW9uZ29DbGllbnQuXG4gKiBAcGFyYW0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIHBhc3NlZCB0byB0aGUgb3BlcmF0aW9uIG1ldGhvZC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gcmVzb2x2ZU9wdGlvbnMocGFyZW50LCBvcHRpb25zKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywgKDAsIGJzb25fMS5yZXNvbHZlQlNPTk9wdGlvbnMpKG9wdGlvbnMsIHBhcmVudCkpO1xuICAgIGNvbnN0IHRpbWVvdXRNUyA9IG9wdGlvbnM/LnRpbWVvdXRNUyA/PyBwYXJlbnQ/LnRpbWVvdXRNUztcbiAgICAvLyBVc2VycyBjYW5ub3QgcGFzcyBhIHJlYWRDb25jZXJuL3dyaXRlQ29uY2VybiB0byBvcGVyYXRpb25zIGluIGEgdHJhbnNhY3Rpb25cbiAgICBjb25zdCBzZXNzaW9uID0gb3B0aW9ucz8uc2Vzc2lvbjtcbiAgICBpZiAoIXNlc3Npb24/LmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICBjb25zdCByZWFkQ29uY2VybiA9IHJlYWRfY29uY2Vybl8xLlJlYWRDb25jZXJuLmZyb21PcHRpb25zKG9wdGlvbnMpID8/IHBhcmVudD8ucmVhZENvbmNlcm47XG4gICAgICAgIGlmIChyZWFkQ29uY2Vybikge1xuICAgICAgICAgICAgcmVzdWx0LnJlYWRDb25jZXJuID0gcmVhZENvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdyaXRlQ29uY2VybiA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMob3B0aW9ucykgPz8gcGFyZW50Py53cml0ZUNvbmNlcm47XG4gICAgICAgIGlmICh3cml0ZUNvbmNlcm4pIHtcbiAgICAgICAgICAgIGlmICh0aW1lb3V0TVMgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHdyaXRlQ29uY2VybiA9IHdyaXRlX2NvbmNlcm5fMS5Xcml0ZUNvbmNlcm4uZnJvbU9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICB3cml0ZUNvbmNlcm46IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLndyaXRlQ29uY2VybixcbiAgICAgICAgICAgICAgICAgICAgICAgIHd0aW1lb3V0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB3dGltZW91dE1TOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0LndyaXRlQ29uY2VybiA9IHdyaXRlQ29uY2VybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQudGltZW91dE1TID0gdGltZW91dE1TO1xuICAgIGNvbnN0IHJlYWRQcmVmZXJlbmNlID0gcmVhZF9wcmVmZXJlbmNlXzEuUmVhZFByZWZlcmVuY2UuZnJvbU9wdGlvbnMob3B0aW9ucykgPz8gcGFyZW50Py5yZWFkUHJlZmVyZW5jZTtcbiAgICBpZiAocmVhZFByZWZlcmVuY2UpIHtcbiAgICAgICAgcmVzdWx0LnJlYWRQcmVmZXJlbmNlID0gcmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGNvbnN0IGlzQ29udmVuaWVudFRyYW5zYWN0aW9uID0gc2Vzc2lvbj8uZXhwbGljaXQgJiYgc2Vzc2lvbj8udGltZW91dENvbnRleHQgIT0gbnVsbDtcbiAgICBpZiAoaXNDb252ZW5pZW50VHJhbnNhY3Rpb24gJiYgb3B0aW9ucz8udGltZW91dE1TICE9IG51bGwpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQW4gb3BlcmF0aW9uIGNhbm5vdCBiZSBnaXZlbiBhIHRpbWVvdXRNUyBzZXR0aW5nIHdoZW4gaW5zaWRlIGEgd2l0aFRyYW5zYWN0aW9uIGNhbGwgdGhhdCBoYXMgYSB0aW1lb3V0TVMgc2V0dGluZycpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gaXNTdXBlcnNldChzZXQsIHN1YnNldCkge1xuICAgIHNldCA9IEFycmF5LmlzQXJyYXkoc2V0KSA/IG5ldyBTZXQoc2V0KSA6IHNldDtcbiAgICBzdWJzZXQgPSBBcnJheS5pc0FycmF5KHN1YnNldCkgPyBuZXcgU2V0KHN1YnNldCkgOiBzdWJzZXQ7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIHN1YnNldCkge1xuICAgICAgICBpZiAoIXNldC5oYXMoZWxlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBkb2N1bWVudCBpcyBhIEhlbGxvIHJlcXVlc3RcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBpc0hlbGxvKGRvYykge1xuICAgIHJldHVybiBkb2NbY29uc3RhbnRzXzIuTEVHQUNZX0hFTExPX0NPTU1BTkRdIHx8IGRvYy5oZWxsbyA/IHRydWUgOiBmYWxzZTtcbn1cbi8qKiBSZXR1cm5zIHRoZSBpdGVtcyB0aGF0IGFyZSB1bmlxdWVseSBpbiBzZXRBICovXG5mdW5jdGlvbiBzZXREaWZmZXJlbmNlKHNldEEsIHNldEIpIHtcbiAgICBjb25zdCBkaWZmZXJlbmNlID0gbmV3IFNldChzZXRBKTtcbiAgICBmb3IgKGNvbnN0IGVsZW0gb2Ygc2V0Qikge1xuICAgICAgICBkaWZmZXJlbmNlLmRlbGV0ZShlbGVtKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpZmZlcmVuY2U7XG59XG5jb25zdCBIQVNfT1dOID0gKG9iamVjdCwgcHJvcCkgPT4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcCk7XG5mdW5jdGlvbiBpc1JlY29yZCh2YWx1ZSwgcmVxdWlyZWRLZXlzID0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBjdG9yID0gdmFsdWUuY29uc3RydWN0b3I7XG4gICAgaWYgKGN0b3IgJiYgY3Rvci5wcm90b3R5cGUpIHtcbiAgICAgICAgaWYgKCFpc09iamVjdChjdG9yLnByb3RvdHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgc29tZSBtZXRob2QgZXhpc3RzIGZyb20gdGhlIE9iamVjdCBleGlzdHNcbiAgICAgICAgaWYgKCFIQVNfT1dOKGN0b3IucHJvdG90eXBlLCAnaXNQcm90b3R5cGVPZicpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlcXVpcmVkS2V5cykge1xuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpO1xuICAgICAgICByZXR1cm4gaXNTdXBlcnNldChrZXlzLCByZXF1aXJlZEtleXMpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogQSBzZXF1ZW50aWFsIGxpc3Qgb2YgaXRlbXMgaW4gYSBjaXJjdWxhcmx5IGxpbmtlZCBsaXN0XG4gKiBAcmVtYXJrc1xuICogVGhlIGhlYWQgbm9kZSBpcyBzcGVjaWFsLCBpdCBpcyBhbHdheXMgZGVmaW5lZCBhbmQgaGFzIGEgdmFsdWUgb2YgbnVsbC5cbiAqIEl0IGlzIG5ldmVyIFwiaW5jbHVkZWRcIiBpbiB0aGUgbGlzdCwgaW4gdGhhdCwgaXQgaXMgbm90IHJldHVybmVkIGJ5IHBvcC9zaGlmdCBvciB5aWVsZGVkIGJ5IHRoZSBpdGVyYXRvci5cbiAqIFRoZSBjaXJjdWxhciBsaW5rYWdlIGFuZCBhbHdheXMgZGVmaW5lZCBoZWFkIG5vZGUgYXJlIHRvIHJlZHVjZSBjaGVja3MgZm9yIG51bGwgbmV4dC9wcmV2IHJlZmVyZW5jZXMgdG8gemVyby5cbiAqIE5ldyBub2RlcyBhcmUgZGVjbGFyZWQgYXMgb2JqZWN0IGxpdGVyYWxzIHdpdGgga2V5cyBhbHdheXMgaW4gdGhlIHNhbWUgb3JkZXI6IG5leHQsIHByZXYsIHZhbHVlLlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIExpc3Qge1xuICAgIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvdW50O1xuICAgIH1cbiAgICBnZXQgW1N5bWJvbC50b1N0cmluZ1RhZ10oKSB7XG4gICAgICAgIHJldHVybiAnTGlzdCc7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmNvdW50ID0gMDtcbiAgICAgICAgLy8gdGhpcyBpcyBjYXJlZnVsbHkgY3JhZnRlZDpcbiAgICAgICAgLy8gZGVjbGFyaW5nIGEgY29tcGxldGUgYW5kIGNvbnNpc3RlbnRseSBrZXkgb3JkZXJlZFxuICAgICAgICAvLyBvYmplY3QgaXMgYmVuZWZpY2lhbCB0byB0aGUgcnVudGltZSBvcHRpbWl6YXRpb25zXG4gICAgICAgIHRoaXMuaGVhZCA9IHtcbiAgICAgICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICAgICAgdmFsdWU6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oZWFkLm5leHQgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gdGhpcy5oZWFkO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBgaGVhZCA8PT4gJHt0aGlzLnRvQXJyYXkoKS5qb2luKCcgPD0+ICcpfSA8PT4gaGVhZGA7XG4gICAgfVxuICAgICpbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXMubm9kZXMoKSkge1xuICAgICAgICAgICAgeWllbGQgbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAqbm9kZXMoKSB7XG4gICAgICAgIGxldCBwdHIgPSB0aGlzLmhlYWQubmV4dDtcbiAgICAgICAgd2hpbGUgKHB0ciAhPT0gdGhpcy5oZWFkKSB7XG4gICAgICAgICAgICAvLyBTYXZlIG5leHQgYmVmb3JlIHlpZWxkaW5nIHNvIHRoYXQgd2UgbWFrZSByZW1vdmluZyB3aXRoaW4gaXRlcmF0aW9uIHNhZmVcbiAgICAgICAgICAgIGNvbnN0IHsgbmV4dCB9ID0gcHRyO1xuICAgICAgICAgICAgeWllbGQgcHRyO1xuICAgICAgICAgICAgcHRyID0gbmV4dDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogSW5zZXJ0IGF0IGVuZCBvZiBsaXN0ICovXG4gICAgcHVzaCh2YWx1ZSkge1xuICAgICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgICAgIGNvbnN0IG5ld05vZGUgPSB7XG4gICAgICAgICAgICBuZXh0OiB0aGlzLmhlYWQsXG4gICAgICAgICAgICBwcmV2OiB0aGlzLmhlYWQucHJldixcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGVhZC5wcmV2Lm5leHQgPSBuZXdOb2RlO1xuICAgICAgICB0aGlzLmhlYWQucHJldiA9IG5ld05vZGU7XG4gICAgfVxuICAgIC8qKiBJbnNlcnRzIGV2ZXJ5IGl0ZW0gaW5zaWRlIGFuIGl0ZXJhYmxlIGluc3RlYWQgb2YgdGhlIGl0ZXJhYmxlIGl0c2VsZiAqL1xuICAgIHB1c2hNYW55KGl0ZXJhYmxlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgaXRlcmFibGUpIHtcbiAgICAgICAgICAgIHRoaXMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEluc2VydCBhdCBmcm9udCBvZiBsaXN0ICovXG4gICAgdW5zaGlmdCh2YWx1ZSkge1xuICAgICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgICAgIGNvbnN0IG5ld05vZGUgPSB7XG4gICAgICAgICAgICBuZXh0OiB0aGlzLmhlYWQubmV4dCxcbiAgICAgICAgICAgIHByZXY6IHRoaXMuaGVhZCxcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGVhZC5uZXh0LnByZXYgPSBuZXdOb2RlO1xuICAgICAgICB0aGlzLmhlYWQubmV4dCA9IG5ld05vZGU7XG4gICAgfVxuICAgIHJlbW92ZShub2RlKSB7XG4gICAgICAgIGlmIChub2RlID09PSB0aGlzLmhlYWQgfHwgdGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY291bnQgLT0gMTtcbiAgICAgICAgY29uc3QgcHJldk5vZGUgPSBub2RlLnByZXY7XG4gICAgICAgIGNvbnN0IG5leHROb2RlID0gbm9kZS5uZXh0O1xuICAgICAgICBwcmV2Tm9kZS5uZXh0ID0gbmV4dE5vZGU7XG4gICAgICAgIG5leHROb2RlLnByZXYgPSBwcmV2Tm9kZTtcbiAgICAgICAgcmV0dXJuIG5vZGUudmFsdWU7XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoZSBmaXJzdCBub2RlIGF0IHRoZSBmcm9udCBvZiB0aGUgbGlzdCAqL1xuICAgIHNoaWZ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUodGhpcy5oZWFkLm5leHQpO1xuICAgIH1cbiAgICAvKiogUmVtb3ZlcyB0aGUgbGFzdCBub2RlIGF0IHRoZSBlbmQgb2YgdGhlIGxpc3QgKi9cbiAgICBwb3AoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW92ZSh0aGlzLmhlYWQucHJldik7XG4gICAgfVxuICAgIC8qKiBJdGVyYXRlcyB0aHJvdWdoIHRoZSBsaXN0IGFuZCByZW1vdmVzIG5vZGVzIHdoZXJlIGZpbHRlciByZXR1cm5zIHRydWUgKi9cbiAgICBwcnVuZShmaWx0ZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXMubm9kZXMoKSkge1xuICAgICAgICAgICAgaWYgKGZpbHRlcihub2RlLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5oZWFkLm5leHQgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gdGhpcy5oZWFkO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgbGlzdCwgZG9lcyBub3QgcmVtb3ZlICovXG4gICAgZmlyc3QoKSB7XG4gICAgICAgIC8vIElmIHRoZSBsaXN0IGlzIGVtcHR5LCB2YWx1ZSB3aWxsIGJlIHRoZSBoZWFkJ3MgbnVsbFxuICAgICAgICByZXR1cm4gdGhpcy5oZWFkLm5leHQudmFsdWU7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIGxpc3QsIGRvZXMgbm90IHJlbW92ZSAqL1xuICAgIGxhc3QoKSB7XG4gICAgICAgIC8vIElmIHRoZSBsaXN0IGlzIGVtcHR5LCB2YWx1ZSB3aWxsIGJlIHRoZSBoZWFkJ3MgbnVsbFxuICAgICAgICByZXR1cm4gdGhpcy5oZWFkLnByZXYudmFsdWU7XG4gICAgfVxufVxuZXhwb3J0cy5MaXN0ID0gTGlzdDtcbi8qKlxuICogQSBwb29sIG9mIEJ1ZmZlcnMgd2hpY2ggYWxsb3cgeW91IHRvIHJlYWQgdGhlbSBhcyBpZiB0aGV5IHdlcmUgb25lXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgQnVmZmVyUG9vbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYnVmZmVycyA9IG5ldyBMaXN0KCk7XG4gICAgICAgIHRoaXMudG90YWxCeXRlTGVuZ3RoID0gMDtcbiAgICB9XG4gICAgZ2V0IGxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG90YWxCeXRlTGVuZ3RoO1xuICAgIH1cbiAgICAvKiogQWRkcyBhIGJ1ZmZlciB0byB0aGUgaW50ZXJuYWwgYnVmZmVyIHBvb2wgbGlzdCAqL1xuICAgIGFwcGVuZChidWZmZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXJzLnB1c2goYnVmZmVyKTtcbiAgICAgICAgdGhpcy50b3RhbEJ5dGVMZW5ndGggKz0gYnVmZmVyLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgQnVmZmVyUG9vbCBjb250YWlucyA0IGJ5dGVzIG9yIG1vcmUgY29uc3RydWN0IGFuIGludDMyIGZyb20gdGhlIGxlYWRpbmcgYnl0ZXMsXG4gICAgICogb3RoZXJ3aXNlIHJldHVybiBudWxsLiBTaXplIGNhbiBiZSBuZWdhdGl2ZSwgY2FsbGVyIHNob3VsZCBlcnJvciBjaGVjay5cbiAgICAgKi9cbiAgICBnZXRJbnQzMigpIHtcbiAgICAgICAgaWYgKHRoaXMudG90YWxCeXRlTGVuZ3RoIDwgNCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlyc3RCdWZmZXIgPSB0aGlzLmJ1ZmZlcnMuZmlyc3QoKTtcbiAgICAgICAgaWYgKGZpcnN0QnVmZmVyICE9IG51bGwgJiYgZmlyc3RCdWZmZXIuYnl0ZUxlbmd0aCA+PSA0KSB7XG4gICAgICAgICAgICByZXR1cm4gZmlyc3RCdWZmZXIucmVhZEludDMyTEUoMCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVW5saWtlbHkgY2FzZTogYW4gaW50MzIgaXMgc3BsaXQgYWNyb3NzIGJ1ZmZlcnMuXG4gICAgICAgIC8vIFVzZSByZWFkIGFuZCBwdXQgdGhlIHJldHVybmVkIGJ1ZmZlciBiYWNrIG9uIHRvcFxuICAgICAgICBjb25zdCB0b3A0Qnl0ZXMgPSB0aGlzLnJlYWQoNCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdG9wNEJ5dGVzLnJlYWRJbnQzMkxFKDApO1xuICAgICAgICAvLyBQdXQgaXQgYmFjay5cbiAgICAgICAgdGhpcy50b3RhbEJ5dGVMZW5ndGggKz0gNDtcbiAgICAgICAgdGhpcy5idWZmZXJzLnVuc2hpZnQodG9wNEJ5dGVzKTtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICAvKiogUmVhZHMgdGhlIHJlcXVlc3RlZCBudW1iZXIgb2YgYnl0ZXMsIG9wdGlvbmFsbHkgY29uc3VtaW5nIHRoZW0gKi9cbiAgICByZWFkKHNpemUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzaXplICE9PSAnbnVtYmVyJyB8fCBzaXplIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29JbnZhbGlkQXJndW1lbnRFcnJvcignQXJndW1lbnQgXCJzaXplXCIgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBvdmVyc2l6ZWQgcmVxdWVzdCByZXR1cm5zIGVtcHR5IGJ1ZmZlclxuICAgICAgICBpZiAoc2l6ZSA+IHRoaXMudG90YWxCeXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gQnVmZmVyLmFsbG9jKDApO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGtub3cgd2UgaGF2ZSBlbm91Z2gsIHdlIGp1c3QgZG9uJ3Qga25vdyBob3cgaXQgaXMgc3ByZWFkIGFjcm9zcyBjaHVua3NcbiAgICAgICAgLy8gVE9ETyhOT0RFLTQ3MzIpOiBhbGxvYyBBUEkgc2hvdWxkIGNoYW5nZSBiYXNlZCBvbiByYXcgb3B0aW9uXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IEJ1ZmZlci5hbGxvY1Vuc2FmZShzaXplKTtcbiAgICAgICAgZm9yIChsZXQgYnl0ZXNSZWFkID0gMDsgYnl0ZXNSZWFkIDwgc2l6ZTspIHtcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVycy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKGJ1ZmZlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBieXRlc1JlbWFpbmluZyA9IHNpemUgLSBieXRlc1JlYWQ7XG4gICAgICAgICAgICBjb25zdCBieXRlc1JlYWRhYmxlID0gTWF0aC5taW4oYnl0ZXNSZW1haW5pbmcsIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gYnVmZmVyLnN1YmFycmF5KDAsIGJ5dGVzUmVhZGFibGUpO1xuICAgICAgICAgICAgcmVzdWx0LnNldChieXRlcywgYnl0ZXNSZWFkKTtcbiAgICAgICAgICAgIGJ5dGVzUmVhZCArPSBieXRlc1JlYWRhYmxlO1xuICAgICAgICAgICAgdGhpcy50b3RhbEJ5dGVMZW5ndGggLT0gYnl0ZXNSZWFkYWJsZTtcbiAgICAgICAgICAgIGlmIChieXRlc1JlYWRhYmxlIDwgYnVmZmVyLmJ5dGVMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcnMudW5zaGlmdChidWZmZXIuc3ViYXJyYXkoYnl0ZXNSZWFkYWJsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuZXhwb3J0cy5CdWZmZXJQb29sID0gQnVmZmVyUG9vbDtcbi8qKiBAcHVibGljICovXG5jbGFzcyBIb3N0QWRkcmVzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFN0cmluZykge1xuICAgICAgICB0aGlzLmhvc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zb2NrZXRQYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzSVB2NiA9IGZhbHNlO1xuICAgICAgICBjb25zdCBlc2NhcGVkSG9zdCA9IGhvc3RTdHJpbmcuc3BsaXQoJyAnKS5qb2luKCclMjAnKTsgLy8gZXNjYXBlIHNwYWNlcywgZm9yIHNvY2tldCBwYXRoIGhvc3RzXG4gICAgICAgIGlmIChlc2NhcGVkSG9zdC5lbmRzV2l0aCgnLnNvY2snKSkge1xuICAgICAgICAgICAgLy8gaGV1cmlzdGljYWxseSBkZXRlcm1pbmUgaWYgd2UncmUgd29ya2luZyB3aXRoIGEgZG9tYWluIHNvY2tldFxuICAgICAgICAgICAgdGhpcy5zb2NrZXRQYXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZWRIb3N0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmxTdHJpbmcgPSBgaUxvdmVKUzovLyR7ZXNjYXBlZEhvc3R9YDtcbiAgICAgICAgbGV0IHVybDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHVybCA9IG5ldyB1cmxfMS5VUkwodXJsU3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAodXJsRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWVFcnJvciA9IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKGBVbmFibGUgdG8gcGFyc2UgJHtlc2NhcGVkSG9zdH0gd2l0aCBVUkxgKTtcbiAgICAgICAgICAgIHJ1bnRpbWVFcnJvci5jYXVzZSA9IHVybEVycm9yO1xuICAgICAgICAgICAgdGhyb3cgcnVudGltZUVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhvc3RuYW1lID0gdXJsLmhvc3RuYW1lO1xuICAgICAgICBjb25zdCBwb3J0ID0gdXJsLnBvcnQ7XG4gICAgICAgIGxldCBub3JtYWxpemVkID0gZGVjb2RlVVJJQ29tcG9uZW50KGhvc3RuYW1lKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAobm9ybWFsaXplZC5zdGFydHNXaXRoKCdbJykgJiYgbm9ybWFsaXplZC5lbmRzV2l0aCgnXScpKSB7XG4gICAgICAgICAgICB0aGlzLmlzSVB2NiA9IHRydWU7XG4gICAgICAgICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5zdWJzdHJpbmcoMSwgaG9zdG5hbWUubGVuZ3RoIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ob3N0ID0gbm9ybWFsaXplZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAodHlwZW9mIHBvcnQgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBwb3J0ID09PSAnc3RyaW5nJyAmJiBwb3J0ICE9PSAnJykge1xuICAgICAgICAgICAgdGhpcy5wb3J0ID0gTnVtYmVyLnBhcnNlSW50KHBvcnQsIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IDI3MDE3O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcnQgPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUGFyc2VFcnJvcignSW52YWxpZCBwb3J0ICh6ZXJvKSB3aXRoIGhvc3RuYW1lJyk7XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmZyZWV6ZSh0aGlzKTtcbiAgICB9XG4gICAgW1N5bWJvbC5mb3IoJ25vZGVqcy51dGlsLmluc3BlY3QuY3VzdG9tJyldKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnNwZWN0KCk7XG4gICAgfVxuICAgIGluc3BlY3QoKSB7XG4gICAgICAgIHJldHVybiBgbmV3IEhvc3RBZGRyZXNzKCcke3RoaXMudG9TdHJpbmcoKX0nKWA7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuaG9zdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSVB2Nikge1xuICAgICAgICAgICAgICAgIHJldHVybiBgWyR7dGhpcy5ob3N0fV06JHt0aGlzLnBvcnR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLmhvc3R9OiR7dGhpcy5wb3J0fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3RoaXMuc29ja2V0UGF0aH1gO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVN0cmluZyhzKSB7XG4gICAgICAgIHJldHVybiBuZXcgSG9zdEFkZHJlc3Mocyk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tSG9zdFBvcnQoaG9zdCwgcG9ydCkge1xuICAgICAgICBpZiAoaG9zdC5pbmNsdWRlcygnOicpKSB7XG4gICAgICAgICAgICBob3N0ID0gYFske2hvc3R9XWA7IC8vIElQdjYgYWRkcmVzc1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBIb3N0QWRkcmVzcy5mcm9tU3RyaW5nKGAke2hvc3R9OiR7cG9ydH1gKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21TcnZSZWNvcmQoeyBuYW1lLCBwb3J0IH0pIHtcbiAgICAgICAgcmV0dXJuIEhvc3RBZGRyZXNzLmZyb21Ib3N0UG9ydChuYW1lLCBwb3J0KTtcbiAgICB9XG4gICAgdG9Ib3N0UG9ydCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc29ja2V0UGF0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgaG9zdDogdGhpcy5zb2NrZXRQYXRoLCBwb3J0OiAwIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaG9zdCA9IHRoaXMuaG9zdCA/PyAnJztcbiAgICAgICAgY29uc3QgcG9ydCA9IHRoaXMucG9ydCA/PyAwO1xuICAgICAgICByZXR1cm4geyBob3N0LCBwb3J0IH07XG4gICAgfVxufVxuZXhwb3J0cy5Ib3N0QWRkcmVzcyA9IEhvc3RBZGRyZXNzO1xuZXhwb3J0cy5ERUZBVUxUX1BLX0ZBQ1RPUlkgPSB7XG4gICAgLy8gV2UgcHJlZmVyIG5vdCB0byByZWx5IG9uIE9iamVjdElkIGhhdmluZyBhIGNyZWF0ZVBrIG1ldGhvZFxuICAgIGNyZWF0ZVBrKCkge1xuICAgICAgICByZXR1cm4gbmV3IGJzb25fMS5PYmplY3RJZCgpO1xuICAgIH1cbn07XG4vKipcbiAqIFdoZW4gdGhlIGRyaXZlciB1c2VkIGVtaXRXYXJuaW5nIHRoZSBjb2RlIHdpbGwgYmUgZXF1YWwgdG8gdGhpcy5cbiAqIEBwdWJsaWNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIHByb2Nlc3Mub24oJ3dhcm5pbmcnLCAod2FybmluZykgPT4ge1xuICogIGlmICh3YXJuaW5nLmNvZGUgPT09IE1PTkdPREJfV0FSTklOR19DT0RFKSBjb25zb2xlLmVycm9yKCdBaCBhbiBpbXBvcnRhbnQgd2FybmluZyEgOiknKVxuICogfSlcbiAqIGBgYFxuICovXG5leHBvcnRzLk1PTkdPREJfV0FSTklOR19DT0RFID0gJ01PTkdPREIgRFJJVkVSJztcbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGVtaXRXYXJuaW5nKG1lc3NhZ2UpIHtcbiAgICByZXR1cm4gcHJvY2Vzcy5lbWl0V2FybmluZyhtZXNzYWdlLCB7IGNvZGU6IGV4cG9ydHMuTU9OR09EQl9XQVJOSU5HX0NPREUgfSk7XG59XG5jb25zdCBlbWl0dGVkV2FybmluZ3MgPSBuZXcgU2V0KCk7XG4vKipcbiAqIFdpbGwgZW1pdCBhIHdhcm5pbmcgb25jZSBmb3IgdGhlIGR1cmF0aW9uIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAqIFVzZXMgdGhlIG1lc3NhZ2UgdG8gaWRlbnRpZnkgaWYgaXQgaGFzIGFscmVhZHkgYmVlbiBlbWl0dGVkXG4gKiBzbyB1c2luZyBzdHJpbmcgaW50ZXJwb2xhdGlvbiBjYW4gY2F1c2UgbXVsdGlwbGUgZW1pdHNcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBlbWl0V2FybmluZ09uY2UobWVzc2FnZSkge1xuICAgIGlmICghZW1pdHRlZFdhcm5pbmdzLmhhcyhtZXNzYWdlKSkge1xuICAgICAgICBlbWl0dGVkV2FybmluZ3MuYWRkKG1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gZW1pdFdhcm5pbmcobWVzc2FnZSk7XG4gICAgfVxufVxuLyoqXG4gKiBUYWtlcyBhIEpTIG9iamVjdCBhbmQgam9pbnMgdGhlIHZhbHVlcyBpbnRvIGEgc3RyaW5nIHNlcGFyYXRlZCBieSAnLCAnXG4gKi9cbmZ1bmN0aW9uIGVudW1Ub1N0cmluZyhlbikge1xuICAgIHJldHVybiBPYmplY3QudmFsdWVzKGVuKS5qb2luKCcsICcpO1xufVxuLyoqXG4gKiBEZXRlcm1pbmUgaWYgYSBzZXJ2ZXIgc3VwcG9ydHMgcmV0cnlhYmxlIHdyaXRlcy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gc3VwcG9ydHNSZXRyeWFibGVXcml0ZXMoc2VydmVyKSB7XG4gICAgaWYgKCFzZXJ2ZXIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoc2VydmVyLmxvYWRCYWxhbmNlZCkge1xuICAgICAgICAvLyBMb2FkYmFsYW5jZWQgdG9wb2xvZ2llcyB3aWxsIGFsd2F5cyBzdXBwb3J0IHJldHJ5IHdyaXRlc1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHNlcnZlci5kZXNjcmlwdGlvbi5sb2dpY2FsU2Vzc2lvblRpbWVvdXRNaW51dGVzICE9IG51bGwpIHtcbiAgICAgICAgLy8gdGhhdCBzdXBwb3J0cyBzZXNzaW9uc1xuICAgICAgICBpZiAoc2VydmVyLmRlc2NyaXB0aW9uLnR5cGUgIT09IGNvbW1vbl8xLlNlcnZlclR5cGUuU3RhbmRhbG9uZSkge1xuICAgICAgICAgICAgLy8gYW5kIHRoYXQgaXMgbm90IGEgc3RhbmRhbG9uZVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBGaXNoZXLigJNZYXRlcyBTaHVmZmxlXG4gKlxuICogUmVmZXJlbmNlOiBodHRwczovL2Jvc3Qub2Nrcy5vcmcvbWlrZS9zaHVmZmxlL1xuICogQHBhcmFtIHNlcXVlbmNlIC0gaXRlbXMgdG8gYmUgc2h1ZmZsZWRcbiAqIEBwYXJhbSBsaW1pdCAtIERlZmF1bHRzIHRvIGAwYC4gSWYgbm9uemVybyBzaHVmZmxlIHdpbGwgc2xpY2UgdGhlIHJhbmRvbWl6ZWQgYXJyYXkgZS5nLCBgLnNsaWNlKDAsIGxpbWl0KWAgb3RoZXJ3aXNlIHdpbGwgcmV0dXJuIHRoZSBlbnRpcmUgcmFuZG9taXplZCBhcnJheS5cbiAqL1xuZnVuY3Rpb24gc2h1ZmZsZShzZXF1ZW5jZSwgbGltaXQgPSAwKSB7XG4gICAgY29uc3QgaXRlbXMgPSBBcnJheS5mcm9tKHNlcXVlbmNlKTsgLy8gc2hhbGxvdyBjb3B5IGluIG9yZGVyIHRvIG5ldmVyIHNodWZmbGUgdGhlIGlucHV0XG4gICAgaWYgKGxpbWl0ID4gaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdMaW1pdCBtdXN0IGJlIGxlc3MgdGhhbiB0aGUgbnVtYmVyIG9mIGl0ZW1zJyk7XG4gICAgfVxuICAgIGxldCByZW1haW5pbmdJdGVtc1RvU2h1ZmZsZSA9IGl0ZW1zLmxlbmd0aDtcbiAgICBjb25zdCBsb3dlckJvdW5kID0gbGltaXQgJSBpdGVtcy5sZW5ndGggPT09IDAgPyAxIDogaXRlbXMubGVuZ3RoIC0gbGltaXQ7XG4gICAgd2hpbGUgKHJlbWFpbmluZ0l0ZW1zVG9TaHVmZmxlID4gbG93ZXJCb3VuZCkge1xuICAgICAgICAvLyBQaWNrIGEgcmVtYWluaW5nIGVsZW1lbnRcbiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZW1haW5pbmdJdGVtc1RvU2h1ZmZsZSk7XG4gICAgICAgIHJlbWFpbmluZ0l0ZW1zVG9TaHVmZmxlIC09IDE7XG4gICAgICAgIC8vIEFuZCBzd2FwIGl0IHdpdGggdGhlIGN1cnJlbnQgZWxlbWVudFxuICAgICAgICBjb25zdCBzd2FwSG9sZCA9IGl0ZW1zW3JlbWFpbmluZ0l0ZW1zVG9TaHVmZmxlXTtcbiAgICAgICAgaXRlbXNbcmVtYWluaW5nSXRlbXNUb1NodWZmbGVdID0gaXRlbXNbcmFuZG9tSW5kZXhdO1xuICAgICAgICBpdGVtc1tyYW5kb21JbmRleF0gPSBzd2FwSG9sZDtcbiAgICB9XG4gICAgcmV0dXJuIGxpbWl0ICUgaXRlbXMubGVuZ3RoID09PSAwID8gaXRlbXMgOiBpdGVtcy5zbGljZShsb3dlckJvdW5kKTtcbn1cbi8qKlxuICogVE9ETyhOT0RFLTQ5MzYpOiByZWFkIGNvbmNlcm4gZWxpZ2liaWxpdHkgZm9yIGNvbW1hbmRzIHNob3VsZCBiZSBjb2RpZmllZCBpbiBjb21tYW5kIGNvbnN0cnVjdGlvblxuICogQGludGVybmFsXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25nb2RiL3NwZWNpZmljYXRpb25zL2Jsb2IvbWFzdGVyL3NvdXJjZS9yZWFkLXdyaXRlLWNvbmNlcm4vcmVhZC13cml0ZS1jb25jZXJuLm1kI3JlYWQtY29uY2VyblxuICovXG5mdW5jdGlvbiBjb21tYW5kU3VwcG9ydHNSZWFkQ29uY2Vybihjb21tYW5kKSB7XG4gICAgaWYgKGNvbW1hbmQuYWdncmVnYXRlIHx8IGNvbW1hbmQuY291bnQgfHwgY29tbWFuZC5kaXN0aW5jdCB8fCBjb21tYW5kLmZpbmQgfHwgY29tbWFuZC5nZW9OZWFyKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIENvbXBhcmUgb2JqZWN0SWRzLiBgbnVsbGAgaXMgYWx3YXlzIGxlc3NcbiAqIC0gYCsxID0gb2lkMSBpcyBncmVhdGVyIHRoYW4gb2lkMmBcbiAqIC0gYC0xID0gb2lkMSBpcyBsZXNzIHRoYW4gb2lkMmBcbiAqIC0gYCswID0gb2lkMSBpcyBlcXVhbCBvaWQyYFxuICovXG5mdW5jdGlvbiBjb21wYXJlT2JqZWN0SWQob2lkMSwgb2lkMikge1xuICAgIGlmIChvaWQxID09IG51bGwgJiYgb2lkMiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBpZiAob2lkMSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaWYgKG9pZDIgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cG9ydHMuQnl0ZVV0aWxzLmNvbXBhcmUob2lkMS5pZCwgb2lkMi5pZCk7XG59XG5mdW5jdGlvbiBwYXJzZUludGVnZXIodmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJylcbiAgICAgICAgcmV0dXJuIE1hdGgudHJ1bmModmFsdWUpO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID0gTnVtYmVyLnBhcnNlSW50KFN0cmluZyh2YWx1ZSksIDEwKTtcbiAgICByZXR1cm4gTnVtYmVyLmlzTmFOKHBhcnNlZFZhbHVlKSA/IG51bGwgOiBwYXJzZWRWYWx1ZTtcbn1cbmZ1bmN0aW9uIHBhcnNlVW5zaWduZWRJbnRlZ2VyKHZhbHVlKSB7XG4gICAgY29uc3QgcGFyc2VkSW50ID0gcGFyc2VJbnRlZ2VyKHZhbHVlKTtcbiAgICByZXR1cm4gcGFyc2VkSW50ICE9IG51bGwgJiYgcGFyc2VkSW50ID49IDAgPyBwYXJzZWRJbnQgOiBudWxsO1xufVxuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIHRocm93cyBhIE1vbmdvQVBJRXJyb3IgaW4gdGhlIGV2ZW50IHRoYXQgZWl0aGVyIG9mIHRoZSBmb2xsb3dpbmcgaXMgdHJ1ZTpcbiAqICogSWYgdGhlIHByb3ZpZGVkIGFkZHJlc3MgZG9tYWluIGRvZXMgbm90IG1hdGNoIHRoZSBwcm92aWRlZCBwYXJlbnQgZG9tYWluXG4gKiAqIElmIHRoZSBwYXJlbnQgZG9tYWluIGNvbnRhaW5zIGxlc3MgdGhhbiB0aHJlZSBgLmAgc2VwYXJhdGVkIHBhcnRzIGFuZCB0aGUgcHJvdmlkZWQgYWRkcmVzcyBkb2VzIG5vdCBjb250YWluIGF0IGxlYXN0IG9uZSBtb3JlIGRvbWFpbiBsZXZlbCB0aGFuIGl0cyBwYXJlbnRcbiAqXG4gKiBJZiBhIEROUyBzZXJ2ZXIgd2VyZSB0byBiZWNvbWUgY29tcHJvbWlzZWQgU1JWIHJlY29yZHMgd291bGQgc3RpbGwgbmVlZCB0b1xuICogYWR2ZXJ0aXNlIGFkZHJlc3NlcyB0aGF0IGFyZSB1bmRlciB0aGUgc2FtZSBkb21haW4gYXMgdGhlIHNydkhvc3QuXG4gKlxuICogQHBhcmFtIGFkZHJlc3MgLSBUaGUgYWRkcmVzcyB0byBjaGVjayBhZ2FpbnN0IGEgZG9tYWluXG4gKiBAcGFyYW0gc3J2SG9zdCAtIFRoZSBkb21haW4gdG8gY2hlY2sgdGhlIHByb3ZpZGVkIGFkZHJlc3MgYWdhaW5zdFxuICogQHJldHVybnMgdm9pZFxuICovXG5mdW5jdGlvbiBjaGVja1BhcmVudERvbWFpbk1hdGNoKGFkZHJlc3MsIHNydkhvc3QpIHtcbiAgICAvLyBSZW1vdmUgdHJhaWxpbmcgZG90IGlmIGV4aXN0cyBvbiBlaXRoZXIgdGhlIHJlc29sdmVkIGFkZHJlc3Mgb3IgdGhlIHNydiBob3N0bmFtZVxuICAgIGNvbnN0IG5vcm1hbGl6ZWRBZGRyZXNzID0gYWRkcmVzcy5lbmRzV2l0aCgnLicpID8gYWRkcmVzcy5zbGljZSgwLCBhZGRyZXNzLmxlbmd0aCAtIDEpIDogYWRkcmVzcztcbiAgICBjb25zdCBub3JtYWxpemVkU3J2SG9zdCA9IHNydkhvc3QuZW5kc1dpdGgoJy4nKSA/IHNydkhvc3Quc2xpY2UoMCwgc3J2SG9zdC5sZW5ndGggLSAxKSA6IHNydkhvc3Q7XG4gICAgY29uc3QgYWxsQ2hhcmFjdGVyQmVmb3JlRmlyc3REb3QgPSAvXi4qP1xcLi87XG4gICAgY29uc3Qgc3J2SXNMZXNzVGhhblRocmVlUGFydHMgPSBub3JtYWxpemVkU3J2SG9zdC5zcGxpdCgnLicpLmxlbmd0aCA8IDM7XG4gICAgLy8gUmVtb3ZlIGFsbCBjaGFyYWN0ZXJzIGJlZm9yZSBmaXJzdCBkb3RcbiAgICAvLyBBZGQgbGVhZGluZyBkb3QgYmFjayB0byBzdHJpbmcgc29cbiAgICAvLyAgIGFuIHNydkhvc3REb21haW4gPSAnLnRydXN0ZWQuc2l0ZSdcbiAgICAvLyAgIHdpbGwgbm90IHNhdGlzZnkgYW4gYWRkcmVzc0RvbWFpbiB0aGF0IGVuZHNXaXRoICcuZmFrZS10cnVzdGVkLnNpdGUnXG4gICAgY29uc3QgYWRkcmVzc0RvbWFpbiA9IGAuJHtub3JtYWxpemVkQWRkcmVzcy5yZXBsYWNlKGFsbENoYXJhY3RlckJlZm9yZUZpcnN0RG90LCAnJyl9YDtcbiAgICBsZXQgc3J2SG9zdERvbWFpbiA9IHNydklzTGVzc1RoYW5UaHJlZVBhcnRzXG4gICAgICAgID8gbm9ybWFsaXplZFNydkhvc3RcbiAgICAgICAgOiBgLiR7bm9ybWFsaXplZFNydkhvc3QucmVwbGFjZShhbGxDaGFyYWN0ZXJCZWZvcmVGaXJzdERvdCwgJycpfWA7XG4gICAgaWYgKCFzcnZIb3N0RG9tYWluLnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgICBzcnZIb3N0RG9tYWluID0gJy4nICsgc3J2SG9zdERvbWFpbjtcbiAgICB9XG4gICAgaWYgKHNydklzTGVzc1RoYW5UaHJlZVBhcnRzICYmXG4gICAgICAgIG5vcm1hbGl6ZWRBZGRyZXNzLnNwbGl0KCcuJykubGVuZ3RoIDw9IG5vcm1hbGl6ZWRTcnZIb3N0LnNwbGl0KCcuJykubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvQVBJRXJyb3IoJ1NlcnZlciByZWNvcmQgZG9lcyBub3QgaGF2ZSBhdCBsZWFzdCBvbmUgbW9yZSBkb21haW4gbGV2ZWwgdGhhbiBwYXJlbnQgVVJJJyk7XG4gICAgfVxuICAgIGlmICghYWRkcmVzc0RvbWFpbi5lbmRzV2l0aChzcnZIb3N0RG9tYWluKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JfMS5Nb25nb0FQSUVycm9yKCdTZXJ2ZXIgcmVjb3JkIGRvZXMgbm90IHNoYXJlIGhvc3RuYW1lIHdpdGggcGFyZW50IFVSSScpO1xuICAgIH1cbn1cbi8qKlxuICogUGVyZm9ybSBhIGdldCByZXF1ZXN0IHRoYXQgcmV0dXJucyBzdGF0dXMgYW5kIGJvZHkuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gZ2V0KHVybCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgcHJlZmVyLWNvbnN0ICovXG4gICAgICAgIGxldCB0aW1lb3V0SWQ7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBodHRwXG4gICAgICAgICAgICAuZ2V0KHVybCwgb3B0aW9ucywgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc2V0RW5jb2RpbmcoJ3V0ZjgnKTtcbiAgICAgICAgICAgIGxldCBib2R5ID0gJyc7XG4gICAgICAgICAgICByZXNwb25zZS5vbignZGF0YScsIGNodW5rID0+IChib2R5ICs9IGNodW5rKSk7XG4gICAgICAgICAgICByZXNwb25zZS5vbignZW5kJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzQ29kZSwgYm9keSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdlcnJvcicsIGVycm9yID0+IHtcbiAgICAgICAgICAgICgwLCB0aW1lcnNfMS5jbGVhclRpbWVvdXQpKHRpbWVvdXRJZCk7XG4gICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmVuZCgpO1xuICAgICAgICB0aW1lb3V0SWQgPSAoMCwgdGltZXJzXzEuc2V0VGltZW91dCkoKCkgPT4ge1xuICAgICAgICAgICAgcmVxdWVzdC5kZXN0cm95KG5ldyBlcnJvcl8xLk1vbmdvTmV0d29ya1RpbWVvdXRFcnJvcihgcmVxdWVzdCB0aW1lZCBvdXQgYWZ0ZXIgMTAgc2Vjb25kc2ApKTtcbiAgICAgICAgfSwgMTAwMDApO1xuICAgIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gcmVxdWVzdCh1cmksIG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RPcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHRpbWVvdXQ6IDEwMDAwLFxuICAgICAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgICAgIC4uLnVybC5wYXJzZSh1cmkpLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXEgPSBodHRwLnJlcXVlc3QocmVxdWVzdE9wdGlvbnMsIHJlcyA9PiB7XG4gICAgICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTtcbiAgICAgICAgICAgIGxldCBkYXRhID0gJyc7XG4gICAgICAgICAgICByZXMub24oJ2RhdGEnLCBkID0+IHtcbiAgICAgICAgICAgICAgICBkYXRhICs9IGQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlcy5vbmNlKCdlbmQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuanNvbiA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHBhcnNlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyhOT0RFLTM0ODMpXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgZXJyb3JfMS5Nb25nb1J1bnRpbWVFcnJvcihgSW52YWxpZCBKU09OIHJlc3BvbnNlOiBcIiR7ZGF0YX1cImApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcS5vbmNlKCd0aW1lb3V0JywgKCkgPT4gcmVxLmRlc3Ryb3kobmV3IGVycm9yXzEuTW9uZ29OZXR3b3JrVGltZW91dEVycm9yKGBOZXR3b3JrIHJlcXVlc3QgdG8gJHt1cml9IHRpbWVkIG91dCBhZnRlciAke29wdGlvbnMudGltZW91dH0gbXNgKSkpO1xuICAgICAgICByZXEub25jZSgnZXJyb3InLCBlcnJvciA9PiByZWplY3QoZXJyb3IpKTtcbiAgICAgICAgcmVxLmVuZCgpO1xuICAgIH0pO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0cy5ET0NVTUVOVF9EQl9DSEVDSyA9IC8oXFwuZG9jZGJcXC5hbWF6b25hd3NcXC5jb20kKXwoXFwuZG9jZGItZWxhc3RpY1xcLmFtYXpvbmF3c1xcLmNvbSQpLztcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMuQ09TTU9TX0RCX0NIRUNLID0gL1xcLmNvc21vc1xcLmF6dXJlXFwuY29tJC87XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkRPQ1VNRU5UX0RCX01TRyA9ICdZb3UgYXBwZWFyIHRvIGJlIGNvbm5lY3RlZCB0byBhIERvY3VtZW50REIgY2x1c3Rlci4gRm9yIG1vcmUgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGZlYXR1cmUgY29tcGF0aWJpbGl0eSBhbmQgc3VwcG9ydCBwbGVhc2UgdmlzaXQgaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vc3VwcG9ydGFiaWxpdHkvZG9jdW1lbnRkYic7XG4vKiogQGludGVybmFsICovXG5leHBvcnRzLkNPU01PU19EQl9NU0cgPSAnWW91IGFwcGVhciB0byBiZSBjb25uZWN0ZWQgdG8gYSBDb3Ntb3NEQiBjbHVzdGVyLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiByZWdhcmRpbmcgZmVhdHVyZSBjb21wYXRpYmlsaXR5IGFuZCBzdXBwb3J0IHBsZWFzZSB2aXNpdCBodHRwczovL3d3dy5tb25nb2RiLmNvbS9zdXBwb3J0YWJpbGl0eS9jb3Ntb3NkYic7XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBpc0hvc3RNYXRjaChtYXRjaCwgaG9zdCkge1xuICAgIHJldHVybiBob3N0ICYmIG1hdGNoLnRlc3QoaG9zdC50b0xvd2VyQ2FzZSgpKSA/IHRydWUgOiBmYWxzZTtcbn1cbmZ1bmN0aW9uIHByb21pc2VXaXRoUmVzb2x2ZXJzKCkge1xuICAgIGxldCByZXNvbHZlO1xuICAgIGxldCByZWplY3Q7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIHdpdGhSZXNvbHZlcnNFeGVjdXRvcihwcm9taXNlUmVzb2x2ZSwgcHJvbWlzZVJlamVjdCkge1xuICAgICAgICByZXNvbHZlID0gcHJvbWlzZVJlc29sdmU7XG4gICAgICAgIHJlamVjdCA9IHByb21pc2VSZWplY3Q7XG4gICAgfSk7XG4gICAgcmV0dXJuIHsgcHJvbWlzZSwgcmVzb2x2ZSwgcmVqZWN0IH07XG59XG4vKipcbiAqIEEgbm9vcCBmdW5jdGlvbiBpbnRlbmRlZCBmb3IgdXNlIGluIHByZXZlbnRpbmcgdW5oYW5kbGVkIHJlamVjdGlvbnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBjb25zdCBwcm9taXNlID0gbXlBc3luY1Rhc2soKTtcbiAqIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnaXRodWIvbm8tdGhlblxuICogcHJvbWlzZS50aGVuKHVuZGVmaW5lZCwgc3F1YXNoRXJyb3IpO1xuICogYGBgXG4gKi9cbmZ1bmN0aW9uIHNxdWFzaEVycm9yKF9lcnJvcikge1xuICAgIHJldHVybjtcbn1cbmV4cG9ydHMucmFuZG9tQnl0ZXMgPSAoMCwgdXRpbF8xLnByb21pc2lmeSkoY3J5cHRvLnJhbmRvbUJ5dGVzKTtcbi8qKlxuICogUmVwbGljYXRlcyB0aGUgZXZlbnRzLm9uY2UgaGVscGVyLlxuICpcbiAqIFJlbW92ZXMgdW51c2VkIHNpZ25hbCBsb2dpYyBhbmQgSXQgKipvbmx5Kiogc3VwcG9ydHMgMCBvciAxIGFyZ3VtZW50IGV2ZW50cy5cbiAqXG4gKiBAcGFyYW0gZWUgLSBBbiBldmVudCBlbWl0dGVyIHRoYXQgbWF5IGVtaXQgYGV2YFxuICogQHBhcmFtIG5hbWUgLSBBbiBldmVudCBuYW1lIHRvIHdhaXQgZm9yXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG9uY2UoZWUsIG5hbWUsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zPy5zaWduYWw/LnRocm93SWZBYm9ydGVkKCk7XG4gICAgY29uc3QgeyBwcm9taXNlLCByZXNvbHZlLCByZWplY3QgfSA9IHByb21pc2VXaXRoUmVzb2x2ZXJzKCk7XG4gICAgY29uc3Qgb25FdmVudCA9IChkYXRhKSA9PiByZXNvbHZlKGRhdGEpO1xuICAgIGNvbnN0IG9uRXJyb3IgPSAoZXJyb3IpID0+IHJlamVjdChlcnJvcik7XG4gICAgY29uc3QgYWJvcnRMaXN0ZW5lciA9IGFkZEFib3J0TGlzdGVuZXIob3B0aW9ucz8uc2lnbmFsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdCh0aGlzLnJlYXNvbik7XG4gICAgfSk7XG4gICAgZWUub25jZShuYW1lLCBvbkV2ZW50KS5vbmNlKCdlcnJvcicsIG9uRXJyb3IpO1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBwcm9taXNlO1xuICAgIH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgZWUub2ZmKG5hbWUsIG9uRXZlbnQpO1xuICAgICAgICBlZS5vZmYoJ2Vycm9yJywgb25FcnJvcik7XG4gICAgICAgIGFib3J0TGlzdGVuZXI/LltleHBvcnRzLmtEaXNwb3NlXSgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG1heWJlQWRkSWRUb0RvY3VtZW50cyhjb2xsLCBkb2NPckRvY3MsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBmb3JjZVNlcnZlck9iamVjdElkID0gdHlwZW9mIG9wdGlvbnMuZm9yY2VTZXJ2ZXJPYmplY3RJZCA9PT0gJ2Jvb2xlYW4nXG4gICAgICAgID8gb3B0aW9ucy5mb3JjZVNlcnZlck9iamVjdElkXG4gICAgICAgIDogY29sbC5zLmRiLm9wdGlvbnM/LmZvcmNlU2VydmVyT2JqZWN0SWQ7XG4gICAgLy8gbm8gbmVlZCB0byBtb2RpZnkgdGhlIGRvY3MgaWYgc2VydmVyIHNldHMgdGhlIE9iamVjdElkXG4gICAgaWYgKGZvcmNlU2VydmVyT2JqZWN0SWQgPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIGRvY09yRG9jcztcbiAgICB9XG4gICAgY29uc3QgdHJhbnNmb3JtID0gKGRvYykgPT4ge1xuICAgICAgICBpZiAoZG9jLl9pZCA9PSBudWxsKSB7XG4gICAgICAgICAgICBkb2MuX2lkID0gY29sbC5zLnBrRmFjdG9yeS5jcmVhdGVQaygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkb2M7XG4gICAgfTtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShkb2NPckRvY3MpID8gZG9jT3JEb2NzLm1hcCh0cmFuc2Zvcm0pIDogdHJhbnNmb3JtKGRvY09yRG9jcyk7XG59XG5hc3luYyBmdW5jdGlvbiBmaWxlSXNBY2Nlc3NpYmxlKGZpbGVOYW1lLCBtb2RlKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnNfMS5wcm9taXNlcy5hY2Nlc3MoZmlsZU5hbWUsIG1vZGUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY2F0Y2gge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuZnVuY3Rpb24gY3NvdE1pbihkdXJhdGlvbjEsIGR1cmF0aW9uMikge1xuICAgIGlmIChkdXJhdGlvbjEgPT09IDApXG4gICAgICAgIHJldHVybiBkdXJhdGlvbjI7XG4gICAgaWYgKGR1cmF0aW9uMiA9PT0gMClcbiAgICAgICAgcmV0dXJuIGR1cmF0aW9uMTtcbiAgICByZXR1cm4gTWF0aC5taW4oZHVyYXRpb24xLCBkdXJhdGlvbjIpO1xufVxuZnVuY3Rpb24gbm9vcCgpIHtcbiAgICByZXR1cm47XG59XG4vKipcbiAqIFJlY3Vyc2UgdGhyb3VnaCB0aGUgKGlkZW50aWNhbGx5LXNoYXBlZCkgYGRlY3J5cHRlZGAgYW5kIGBvcmlnaW5hbGBcbiAqIG9iamVjdHMgYW5kIGF0dGFjaCBhIGBkZWNyeXB0ZWRLZXlzYCBwcm9wZXJ0eSBvbiBlYWNoIHN1Yi1vYmplY3QgdGhhdFxuICogY29udGFpbmVkIGVuY3J5cHRlZCBmaWVsZHMuIEJlY2F1c2Ugd2Ugb25seSBjYWxsIHRoaXMgb24gQlNPTiByZXNwb25zZXMsXG4gKiB3ZSBkbyBub3QgbmVlZCB0byB3b3JyeSBhYm91dCBjaXJjdWxhciByZWZlcmVuY2VzLlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBkZWNvcmF0ZURlY3J5cHRpb25SZXN1bHQoZGVjcnlwdGVkLCBvcmlnaW5hbCwgaXNUb3BMZXZlbERlY29yYXRlQ2FsbCA9IHRydWUpIHtcbiAgICBpZiAoaXNUb3BMZXZlbERlY29yYXRlQ2FsbCkge1xuICAgICAgICAvLyBUaGUgb3JpZ2luYWwgdmFsdWUgY291bGQgaGF2ZSBiZWVuIGVpdGhlciBhIEpTIG9iamVjdCBvciBhIEJTT04gYnVmZmVyXG4gICAgICAgIGlmIChCdWZmZXIuaXNCdWZmZXIob3JpZ2luYWwpKSB7XG4gICAgICAgICAgICBvcmlnaW5hbCA9ICgwLCBic29uXzEuZGVzZXJpYWxpemUpKG9yaWdpbmFsKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQnVmZmVyLmlzQnVmZmVyKGRlY3J5cHRlZCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcl8xLk1vbmdvUnVudGltZUVycm9yKCdFeHBlY3RlZCByZXN1bHQgb2YgZGVjcnlwdGlvbiB0byBiZSBkZXNlcmlhbGl6ZWQgQlNPTiBvYmplY3QnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWRlY3J5cHRlZCB8fCB0eXBlb2YgZGVjcnlwdGVkICE9PSAnb2JqZWN0JylcbiAgICAgICAgcmV0dXJuO1xuICAgIGZvciAoY29uc3QgayBvZiBPYmplY3Qua2V5cyhkZWNyeXB0ZWQpKSB7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsVmFsdWUgPSBvcmlnaW5hbFtrXTtcbiAgICAgICAgLy8gQW4gb2JqZWN0IHdhcyBkZWNyeXB0ZWQgYnkgbGlibW9uZ29jcnlwdCBpZiBhbmQgb25seSBpZiBpdCB3YXNcbiAgICAgICAgLy8gYSBCU09OIEJpbmFyeSBvYmplY3Qgd2l0aCBzdWJ0eXBlIDYuXG4gICAgICAgIGlmIChvcmlnaW5hbFZhbHVlICYmIG9yaWdpbmFsVmFsdWUuX2Jzb250eXBlID09PSAnQmluYXJ5JyAmJiBvcmlnaW5hbFZhbHVlLnN1Yl90eXBlID09PSA2KSB7XG4gICAgICAgICAgICBpZiAoIWRlY3J5cHRlZFtjb25zdGFudHNfMi5rRGVjb3JhdGVkS2V5c10pIHtcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGVjcnlwdGVkLCBjb25zdGFudHNfMi5rRGVjb3JhdGVkS2V5cywge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW10sXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdGhpcyBpcyBkZWZpbmVkIGluIHRoZSBwcmVjZWRpbmcgaWYtc3RhdGVtZW50XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICAgICAgZGVjcnlwdGVkW2NvbnN0YW50c18yLmtEZWNvcmF0ZWRLZXlzXS5wdXNoKGspO1xuICAgICAgICAgICAgLy8gRG8gbm90IHJlY3Vyc2UgaW50byB0aGlzIGRlY3J5cHRlZCB2YWx1ZS4gSXQgY291bGQgYmUgYSBzdWItZG9jdW1lbnQvYXJyYXksXG4gICAgICAgICAgICAvLyBpbiB3aGljaCBjYXNlIHRoZXJlIGlzIG5vIG9yaWdpbmFsIHZhbHVlIGFzc29jaWF0ZWQgd2l0aCBpdHMgc3ViZmllbGRzLlxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgZGVjb3JhdGVEZWNyeXB0aW9uUmVzdWx0KGRlY3J5cHRlZFtrXSwgb3JpZ2luYWxWYWx1ZSwgZmFsc2UpO1xuICAgIH1cbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydHMua0Rpc3Bvc2UgPSBTeW1ib2wuZGlzcG9zZSA/PyBTeW1ib2woJ2Rpc3Bvc2UnKTtcbi8qKlxuICogQSB1dGlsaXR5IHRoYXQgaGVscHMgd2l0aCB3cml0aW5nIGxpc3RlbmVyIGNvZGUgaWRpb21hdGljYWxseVxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogdXNpbmcgbGlzdGVuZXIgPSBhZGRBYm9ydExpc3RlbmVyKHNpZ25hbCwgZnVuY3Rpb24gKCkge1xuICogICBjb25zb2xlLmxvZygnYWJvcnRlZCcsIHRoaXMucmVhc29uKTtcbiAqIH0pO1xuICogYGBgXG4gKlxuICogQHBhcmFtIHNpZ25hbCAtIGlmIGV4aXN0cyBhZGRzIGFuIGFib3J0IGxpc3RlbmVyXG4gKiBAcGFyYW0gbGlzdGVuZXIgLSB0aGUgbGlzdGVuZXIgdG8gYmUgYWRkZWQgdG8gc2lnbmFsXG4gKiBAcmV0dXJucyBBIGRpc3Bvc2FibGUgdGhhdCB3aWxsIHJlbW92ZSB0aGUgYWJvcnQgbGlzdGVuZXJcbiAqL1xuZnVuY3Rpb24gYWRkQWJvcnRMaXN0ZW5lcihzaWduYWwsIGxpc3RlbmVyKSB7XG4gICAgaWYgKHNpZ25hbCA9PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgbGlzdGVuZXIsIHsgb25jZTogdHJ1ZSB9KTtcbiAgICByZXR1cm4geyBbZXhwb3J0cy5rRGlzcG9zZV06ICgpID0+IHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIGxpc3RlbmVyKSB9O1xufVxuLyoqXG4gKiBUYWtlcyBhIHByb21pc2UgYW5kIHJhY2VzIGl0IHdpdGggYSBwcm9taXNlIHdyYXBwaW5nIHRoZSBhYm9ydCBldmVudCBvZiB0aGUgb3B0aW9uYWxseSBwcm92aWRlZCBzaWduYWwuXG4gKiBUaGUgZ2l2ZW4gcHJvbWlzZSBpcyBfYWx3YXlzXyBvcmRlcmVkIGJlZm9yZSB0aGUgc2lnbmFsJ3MgYWJvcnQgcHJvbWlzZS5cbiAqIFdoZW4gZ2l2ZW4gYW4gYWxyZWFkeSByZWplY3RlZCBwcm9taXNlIGFuZCBhbiBhbHJlYWR5IGFib3J0ZWQgc2lnbmFsLCB0aGUgcHJvbWlzZSdzIHJlamVjdGlvbiB0YWtlcyBwcmVjZWRlbmNlLlxuICpcbiAqIEFueSBhc3luY2hyb25vdXMgcHJvY2Vzc2luZyBpbiBgcHJvbWlzZWAgd2lsbCBjb250aW51ZSBldmVuIGFmdGVyIHRoZSBhYm9ydCBzaWduYWwgaGFzIGZpcmVkLFxuICogYnV0IGNvbnRyb2wgd2lsbCBiZSByZXR1cm5lZCB0byB0aGUgY2FsbGVyXG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9Qcm9taXNlL3JhY2VcbiAqXG4gKiBAcGFyYW0gcHJvbWlzZSAtIEEgcHJvbWlzZSB0byBkaXNjYXJkIGlmIHRoZSBzaWduYWwgYWJvcnRzXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IGNhcnJ5aW5nIGFuIG9wdGlvbmFsIHNpZ25hbFxuICovXG5hc3luYyBmdW5jdGlvbiBhYm9ydGFibGUocHJvbWlzZSwgeyBzaWduYWwgfSkge1xuICAgIGlmIChzaWduYWwgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gYXdhaXQgcHJvbWlzZTtcbiAgICB9XG4gICAgY29uc3QgeyBwcm9taXNlOiBhYm9ydGVkLCByZWplY3QgfSA9IHByb21pc2VXaXRoUmVzb2x2ZXJzKCk7XG4gICAgY29uc3QgYWJvcnRMaXN0ZW5lciA9IHNpZ25hbC5hYm9ydGVkXG4gICAgICAgID8gcmVqZWN0KHNpZ25hbC5yZWFzb24pXG4gICAgICAgIDogYWRkQWJvcnRMaXN0ZW5lcihzaWduYWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlamVjdCh0aGlzLnJlYXNvbik7XG4gICAgICAgIH0pO1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBQcm9taXNlLnJhY2UoW3Byb21pc2UsIGFib3J0ZWRdKTtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIGFib3J0TGlzdGVuZXI/LltleHBvcnRzLmtEaXNwb3NlXSgpO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXV0aWxzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/utils.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.WriteConcern = exports.WRITE_CONCERN_KEYS = void 0;\nexports.throwIfWriteConcernError = throwIfWriteConcernError;\nconst responses_1 = __webpack_require__(/*! ./cmap/wire_protocol/responses */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/cmap/wire_protocol/responses.js\");\nconst error_1 = __webpack_require__(/*! ./error */ \"(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/error.js\");\nexports.WRITE_CONCERN_KEYS = ['w', 'wtimeout', 'j', 'journal', 'fsync'];\n/**\n * A MongoDB WriteConcern, which describes the level of acknowledgement\n * requested from MongoDB for write operations.\n * @public\n *\n * @see https://www.mongodb.com/docs/manual/reference/write-concern/\n */\nclass WriteConcern {\n    /**\n     * Constructs a WriteConcern from the write concern properties.\n     * @param w - request acknowledgment that the write operation has propagated to a specified number of mongod instances or to mongod instances with specified tags.\n     * @param wtimeoutMS - specify a time limit to prevent write operations from blocking indefinitely\n     * @param journal - request acknowledgment that the write operation has been written to the on-disk journal\n     * @param fsync - equivalent to the j option. Is deprecated and will be removed in the next major version.\n     */\n    constructor(w, wtimeoutMS, journal, fsync) {\n        if (w != null) {\n            if (!Number.isNaN(Number(w))) {\n                this.w = Number(w);\n            }\n            else {\n                this.w = w;\n            }\n        }\n        if (wtimeoutMS != null) {\n            this.wtimeoutMS = this.wtimeout = wtimeoutMS;\n        }\n        if (journal != null) {\n            this.journal = this.j = journal;\n        }\n        if (fsync != null) {\n            this.journal = this.j = fsync ? true : false;\n        }\n    }\n    /**\n     * Apply a write concern to a command document. Will modify and return the command.\n     */\n    static apply(command, writeConcern) {\n        const wc = {};\n        // The write concern document sent to the server has w/wtimeout/j fields.\n        if (writeConcern.w != null)\n            wc.w = writeConcern.w;\n        if (writeConcern.wtimeoutMS != null)\n            wc.wtimeout = writeConcern.wtimeoutMS;\n        if (writeConcern.journal != null)\n            wc.j = writeConcern.j;\n        command.writeConcern = wc;\n        return command;\n    }\n    /** Construct a WriteConcern given an options object. */\n    static fromOptions(options, inherit) {\n        if (options == null)\n            return undefined;\n        inherit = inherit ?? {};\n        let opts;\n        if (typeof options === 'string' || typeof options === 'number') {\n            opts = { w: options };\n        }\n        else if (options instanceof WriteConcern) {\n            opts = options;\n        }\n        else {\n            opts = options.writeConcern;\n        }\n        const parentOpts = inherit instanceof WriteConcern ? inherit : inherit.writeConcern;\n        const { w = undefined, wtimeout = undefined, j = undefined, fsync = undefined, journal = undefined, wtimeoutMS = undefined } = {\n            ...parentOpts,\n            ...opts\n        };\n        if (w != null ||\n            wtimeout != null ||\n            wtimeoutMS != null ||\n            j != null ||\n            journal != null ||\n            fsync != null) {\n            return new WriteConcern(w, wtimeout ?? wtimeoutMS, j ?? journal, fsync);\n        }\n        return undefined;\n    }\n}\nexports.WriteConcern = WriteConcern;\n/** Called with either a plain object or MongoDBResponse */\nfunction throwIfWriteConcernError(response) {\n    if (typeof response === 'object' && response != null) {\n        const writeConcernError = responses_1.MongoDBResponse.is(response) && response.has('writeConcernError')\n            ? response.toObject()\n            : !responses_1.MongoDBResponse.is(response) && 'writeConcernError' in response\n                ? response\n                : null;\n        if (writeConcernError != null) {\n            throw new error_1.MongoWriteConcernError(writeConcernError);\n        }\n    }\n}\n//# sourceMappingURL=write_concern.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbW9uZ29kYkA2LjE2LjAvbm9kZV9tb2R1bGVzL21vbmdvZGIvbGliL3dyaXRlX2NvbmNlcm4uanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsb0JBQW9CLEdBQUcsMEJBQTBCO0FBQ2pELGdDQUFnQztBQUNoQyxvQkFBb0IsbUJBQU8sQ0FBQywwSUFBZ0M7QUFDNUQsZ0JBQWdCLG1CQUFPLENBQUMsNEZBQVM7QUFDakMsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixxSEFBcUg7QUFDckk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvbmljay9EZXNrdG9wL0J1c2luZXNzL1BheWxvYWRDTVMvcGF5bG9hZC1zdG9yYWdlLWNsb3VkaW5hcnkvZGV2L25vZGVfbW9kdWxlcy8ucG5wbS9tb25nb2RiQDYuMTYuMC9ub2RlX21vZHVsZXMvbW9uZ29kYi9saWIvd3JpdGVfY29uY2Vybi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV3JpdGVDb25jZXJuID0gZXhwb3J0cy5XUklURV9DT05DRVJOX0tFWVMgPSB2b2lkIDA7XG5leHBvcnRzLnRocm93SWZXcml0ZUNvbmNlcm5FcnJvciA9IHRocm93SWZXcml0ZUNvbmNlcm5FcnJvcjtcbmNvbnN0IHJlc3BvbnNlc18xID0gcmVxdWlyZShcIi4vY21hcC93aXJlX3Byb3RvY29sL3Jlc3BvbnNlc1wiKTtcbmNvbnN0IGVycm9yXzEgPSByZXF1aXJlKFwiLi9lcnJvclwiKTtcbmV4cG9ydHMuV1JJVEVfQ09OQ0VSTl9LRVlTID0gWyd3JywgJ3d0aW1lb3V0JywgJ2onLCAnam91cm5hbCcsICdmc3luYyddO1xuLyoqXG4gKiBBIE1vbmdvREIgV3JpdGVDb25jZXJuLCB3aGljaCBkZXNjcmliZXMgdGhlIGxldmVsIG9mIGFja25vd2xlZGdlbWVudFxuICogcmVxdWVzdGVkIGZyb20gTW9uZ29EQiBmb3Igd3JpdGUgb3BlcmF0aW9ucy5cbiAqIEBwdWJsaWNcbiAqXG4gKiBAc2VlIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS93cml0ZS1jb25jZXJuL1xuICovXG5jbGFzcyBXcml0ZUNvbmNlcm4ge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgYSBXcml0ZUNvbmNlcm4gZnJvbSB0aGUgd3JpdGUgY29uY2VybiBwcm9wZXJ0aWVzLlxuICAgICAqIEBwYXJhbSB3IC0gcmVxdWVzdCBhY2tub3dsZWRnbWVudCB0aGF0IHRoZSB3cml0ZSBvcGVyYXRpb24gaGFzIHByb3BhZ2F0ZWQgdG8gYSBzcGVjaWZpZWQgbnVtYmVyIG9mIG1vbmdvZCBpbnN0YW5jZXMgb3IgdG8gbW9uZ29kIGluc3RhbmNlcyB3aXRoIHNwZWNpZmllZCB0YWdzLlxuICAgICAqIEBwYXJhbSB3dGltZW91dE1TIC0gc3BlY2lmeSBhIHRpbWUgbGltaXQgdG8gcHJldmVudCB3cml0ZSBvcGVyYXRpb25zIGZyb20gYmxvY2tpbmcgaW5kZWZpbml0ZWx5XG4gICAgICogQHBhcmFtIGpvdXJuYWwgLSByZXF1ZXN0IGFja25vd2xlZGdtZW50IHRoYXQgdGhlIHdyaXRlIG9wZXJhdGlvbiBoYXMgYmVlbiB3cml0dGVuIHRvIHRoZSBvbi1kaXNrIGpvdXJuYWxcbiAgICAgKiBAcGFyYW0gZnN5bmMgLSBlcXVpdmFsZW50IHRvIHRoZSBqIG9wdGlvbi4gSXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Iodywgd3RpbWVvdXRNUywgam91cm5hbCwgZnN5bmMpIHtcbiAgICAgICAgaWYgKHcgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4oTnVtYmVyKHcpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudyA9IE51bWJlcih3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudyA9IHc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHd0aW1lb3V0TVMgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy53dGltZW91dE1TID0gdGhpcy53dGltZW91dCA9IHd0aW1lb3V0TVM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGpvdXJuYWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gdGhpcy5qID0gam91cm5hbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnN5bmMgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5qb3VybmFsID0gdGhpcy5qID0gZnN5bmMgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbHkgYSB3cml0ZSBjb25jZXJuIHRvIGEgY29tbWFuZCBkb2N1bWVudC4gV2lsbCBtb2RpZnkgYW5kIHJldHVybiB0aGUgY29tbWFuZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgYXBwbHkoY29tbWFuZCwgd3JpdGVDb25jZXJuKSB7XG4gICAgICAgIGNvbnN0IHdjID0ge307XG4gICAgICAgIC8vIFRoZSB3cml0ZSBjb25jZXJuIGRvY3VtZW50IHNlbnQgdG8gdGhlIHNlcnZlciBoYXMgdy93dGltZW91dC9qIGZpZWxkcy5cbiAgICAgICAgaWYgKHdyaXRlQ29uY2Vybi53ICE9IG51bGwpXG4gICAgICAgICAgICB3Yy53ID0gd3JpdGVDb25jZXJuLnc7XG4gICAgICAgIGlmICh3cml0ZUNvbmNlcm4ud3RpbWVvdXRNUyAhPSBudWxsKVxuICAgICAgICAgICAgd2Mud3RpbWVvdXQgPSB3cml0ZUNvbmNlcm4ud3RpbWVvdXRNUztcbiAgICAgICAgaWYgKHdyaXRlQ29uY2Vybi5qb3VybmFsICE9IG51bGwpXG4gICAgICAgICAgICB3Yy5qID0gd3JpdGVDb25jZXJuLmo7XG4gICAgICAgIGNvbW1hbmQud3JpdGVDb25jZXJuID0gd2M7XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cbiAgICAvKiogQ29uc3RydWN0IGEgV3JpdGVDb25jZXJuIGdpdmVuIGFuIG9wdGlvbnMgb2JqZWN0LiAqL1xuICAgIHN0YXRpYyBmcm9tT3B0aW9ucyhvcHRpb25zLCBpbmhlcml0KSB7XG4gICAgICAgIGlmIChvcHRpb25zID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICBpbmhlcml0ID0gaW5oZXJpdCA/PyB7fTtcbiAgICAgICAgbGV0IG9wdHM7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIG9wdGlvbnMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBvcHRzID0geyB3OiBvcHRpb25zIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAob3B0aW9ucyBpbnN0YW5jZW9mIFdyaXRlQ29uY2Vybikge1xuICAgICAgICAgICAgb3B0cyA9IG9wdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvcHRzID0gb3B0aW9ucy53cml0ZUNvbmNlcm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyZW50T3B0cyA9IGluaGVyaXQgaW5zdGFuY2VvZiBXcml0ZUNvbmNlcm4gPyBpbmhlcml0IDogaW5oZXJpdC53cml0ZUNvbmNlcm47XG4gICAgICAgIGNvbnN0IHsgdyA9IHVuZGVmaW5lZCwgd3RpbWVvdXQgPSB1bmRlZmluZWQsIGogPSB1bmRlZmluZWQsIGZzeW5jID0gdW5kZWZpbmVkLCBqb3VybmFsID0gdW5kZWZpbmVkLCB3dGltZW91dE1TID0gdW5kZWZpbmVkIH0gPSB7XG4gICAgICAgICAgICAuLi5wYXJlbnRPcHRzLFxuICAgICAgICAgICAgLi4ub3B0c1xuICAgICAgICB9O1xuICAgICAgICBpZiAodyAhPSBudWxsIHx8XG4gICAgICAgICAgICB3dGltZW91dCAhPSBudWxsIHx8XG4gICAgICAgICAgICB3dGltZW91dE1TICE9IG51bGwgfHxcbiAgICAgICAgICAgIGogIT0gbnVsbCB8fFxuICAgICAgICAgICAgam91cm5hbCAhPSBudWxsIHx8XG4gICAgICAgICAgICBmc3luYyAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFdyaXRlQ29uY2Vybih3LCB3dGltZW91dCA/PyB3dGltZW91dE1TLCBqID8/IGpvdXJuYWwsIGZzeW5jKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn1cbmV4cG9ydHMuV3JpdGVDb25jZXJuID0gV3JpdGVDb25jZXJuO1xuLyoqIENhbGxlZCB3aXRoIGVpdGhlciBhIHBsYWluIG9iamVjdCBvciBNb25nb0RCUmVzcG9uc2UgKi9cbmZ1bmN0aW9uIHRocm93SWZXcml0ZUNvbmNlcm5FcnJvcihyZXNwb25zZSkge1xuICAgIGlmICh0eXBlb2YgcmVzcG9uc2UgPT09ICdvYmplY3QnICYmIHJlc3BvbnNlICE9IG51bGwpIHtcbiAgICAgICAgY29uc3Qgd3JpdGVDb25jZXJuRXJyb3IgPSByZXNwb25zZXNfMS5Nb25nb0RCUmVzcG9uc2UuaXMocmVzcG9uc2UpICYmIHJlc3BvbnNlLmhhcygnd3JpdGVDb25jZXJuRXJyb3InKVxuICAgICAgICAgICAgPyByZXNwb25zZS50b09iamVjdCgpXG4gICAgICAgICAgICA6ICFyZXNwb25zZXNfMS5Nb25nb0RCUmVzcG9uc2UuaXMocmVzcG9uc2UpICYmICd3cml0ZUNvbmNlcm5FcnJvcicgaW4gcmVzcG9uc2VcbiAgICAgICAgICAgICAgICA/IHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICBpZiAod3JpdGVDb25jZXJuRXJyb3IgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9yXzEuTW9uZ29Xcml0ZUNvbmNlcm5FcnJvcih3cml0ZUNvbmNlcm5FcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD13cml0ZV9jb25jZXJuLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/lib/write_concern.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/package.json":
/*!*****************************************************************************!*\
  !*** ./node_modules/.pnpm/mongodb@6.16.0/node_modules/mongodb/package.json ***!
  \*****************************************************************************/
/***/ ((module) => {

module.exports = /*#__PURE__*/JSON.parse('{"name":"mongodb","version":"6.16.0","description":"The official MongoDB driver for Node.js","main":"lib/index.js","files":["lib","src","etc/prepare.js","mongodb.d.ts","tsconfig.json"],"types":"mongodb.d.ts","repository":{"type":"git","url":"git@github.com:mongodb/node-mongodb-native.git"},"keywords":["mongodb","driver","official"],"author":{"name":"The MongoDB NodeJS Team","email":"dbx-node@mongodb.com"},"dependencies":{"@mongodb-js/saslprep":"^1.1.9","bson":"^6.10.3","mongodb-connection-string-url":"^3.0.0"},"peerDependencies":{"@aws-sdk/credential-providers":"^3.188.0","@mongodb-js/zstd":"^1.1.0 || ^2.0.0","gcp-metadata":"^5.2.0","kerberos":"^2.0.1","mongodb-client-encryption":">=6.0.0 <7","snappy":"^7.2.2","socks":"^2.7.1"},"peerDependenciesMeta":{"@aws-sdk/credential-providers":{"optional":true},"@mongodb-js/zstd":{"optional":true},"kerberos":{"optional":true},"snappy":{"optional":true},"mongodb-client-encryption":{"optional":true},"gcp-metadata":{"optional":true},"socks":{"optional":true}},"devDependencies":{"@aws-sdk/credential-providers":"^3.632.0","@iarna/toml":"^2.2.5","@istanbuljs/nyc-config-typescript":"^1.0.2","@microsoft/api-extractor":"^7.49.2","@microsoft/tsdoc-config":"^0.17.1","@mongodb-js/zstd":"^2.0.0","@types/chai":"^4.3.17","@types/chai-subset":"^1.3.5","@types/express":"^4.17.21","@types/kerberos":"^1.1.5","@types/mocha":"^10.0.9","@types/node":"^22.13.0","@types/saslprep":"^1.0.3","@types/semver":"^7.5.8","@types/sinon":"^17.0.3","@types/sinon-chai":"^3.2.12","@types/whatwg-url":"^11.0.5","@typescript-eslint/eslint-plugin":"8.4.0","@typescript-eslint/parser":"8.4.0","chai":"^4.4.1","chai-subset":"^1.6.0","chalk":"^4.1.2","eslint":"9.9.0","eslint-config-prettier":"^9.1.0","eslint-plugin-mocha":"^10.4.1","eslint-plugin-prettier":"^5.2.3","eslint-plugin-simple-import-sort":"^12.1.1","eslint-plugin-tsdoc":"^0.4.0","eslint-plugin-unused-imports":"^4.1.4","express":"^4.21.2","gcp-metadata":"^5.3.0","js-yaml":"^4.1.0","mocha":"^10.8.2","mocha-sinon":"^2.1.2","mongodb-client-encryption":"^6.3.0","mongodb-legacy":"^6.1.3","nyc":"^15.1.0","prettier":"^3.4.2","semver":"^7.7.0","sinon":"^18.0.0","sinon-chai":"^3.7.0","snappy":"^7.2.2","socks":"^2.8.1","source-map-support":"^0.5.21","ts-node":"^10.9.2","tsd":"^0.31.2","typescript":"5.5","typescript-cached-transpile":"^0.0.6","v8-heapsnapshot":"^1.3.1","yargs":"^17.7.2"},"license":"Apache-2.0","engines":{"node":">=16.20.1"},"bugs":{"url":"https://jira.mongodb.org/projects/NODE/issues/"},"homepage":"https://github.com/mongodb/node-mongodb-native","scripts":{"build:evergreen":"node .evergreen/generate_evergreen_tasks.js","build:ts":"node ./node_modules/typescript/bin/tsc","build:dts":"npm run build:ts && api-extractor run && node etc/clean_definition_files.cjs && ESLINT_USE_FLAT_CONFIG=false eslint --no-ignore --fix mongodb.d.ts lib/beta.d.ts","build:docs":"./etc/docs/build.ts","build:typedoc":"typedoc","build:nightly":"node ./.github/scripts/nightly.mjs","check:bench":"npm --prefix test/benchmarks/driver_bench start","check:coverage":"nyc npm run test:all","check:integration-coverage":"nyc npm run check:test","check:lambda":"nyc mocha --config test/mocha_lambda.js test/integration/node-specific/examples/handler.test.js","check:lambda:aws":"nyc mocha --config test/mocha_lambda.js test/integration/node-specific/examples/aws_handler.test.js","check:lint":"npm run build:dts && npm run check:dts && npm run check:eslint && npm run check:tsd","check:eslint":"npm run build:dts && ESLINT_USE_FLAT_CONFIG=false eslint -v && ESLINT_USE_FLAT_CONFIG=false eslint --max-warnings=0 --ext \'.js,.ts\' src test","check:tsd":"tsd --version && tsd","check:dependencies":"mocha test/action/dependency.test.ts","check:dts":"node ./node_modules/typescript/bin/tsc --noEmit mongodb.d.ts && tsd","check:search-indexes":"nyc mocha --config test/mocha_mongodb.js test/manual/search-index-management.prose.test.ts","check:test":"mocha --config test/mocha_mongodb.js test/integration","check:unit":"nyc mocha test/unit","check:ts":"node ./node_modules/typescript/bin/tsc -v && node ./node_modules/typescript/bin/tsc --noEmit","check:atlas":"nyc mocha --config test/manual/mocharc.js test/manual/atlas_connectivity.test.ts","check:resource-management":"nyc mocha --config test/manual/mocharc.js test/manual/resource_management.test.ts","check:drivers-atlas-testing":"nyc mocha --config test/mocha_mongodb.js test/atlas/drivers_atlas_testing.test.ts","check:adl":"nyc mocha --config test/mocha_mongodb.js test/manual/atlas-data-lake-testing","check:aws":"nyc mocha --config test/mocha_mongodb.js test/integration/auth/mongodb_aws.test.ts","check:oidc-auth":"nyc mocha --config test/mocha_mongodb.js test/integration/auth/auth.spec.test.ts","check:oidc-test":"nyc mocha --config test/mocha_mongodb.js test/integration/auth/mongodb_oidc.prose.test.ts","check:oidc-azure":"nyc mocha --config test/mocha_mongodb.js test/integration/auth/mongodb_oidc_azure.prose.05.test.ts","check:oidc-gcp":"nyc mocha --config test/mocha_mongodb.js test/integration/auth/mongodb_oidc_gcp.prose.06.test.ts","check:oidc-k8s":"nyc mocha --config test/mocha_mongodb.js test/integration/auth/mongodb_oidc_k8s.prose.07.test.ts","check:kerberos":"nyc mocha --config test/manual/mocharc.js test/manual/kerberos.test.ts","check:tls":"nyc mocha --config test/manual/mocharc.js test/manual/tls_support.test.ts","check:ldap":"nyc mocha --config test/manual/mocharc.js test/manual/ldap.test.ts","check:socks5":"nyc mocha --config test/manual/mocharc.js test/manual/socks5.test.ts","check:csfle":"nyc mocha --config test/mocha_mongodb.js test/integration/client-side-encryption","check:snappy":"nyc mocha test/unit/assorted/snappy.test.js","check:x509":"nyc mocha test/manual/x509_auth.test.ts","fix:eslint":"npm run check:eslint -- --fix","prepare":"node etc/prepare.js","preview:docs":"ts-node etc/docs/preview.ts","test":"npm run check:lint && npm run test:all","test:all":"npm run check:unit && npm run check:test","update:docs":"npm run build:docs -- --yes"},"tsd":{"directory":"test/types","compilerOptions":{"strict":true,"target":"esnext","module":"commonjs","moduleResolution":"node"}}}');

/***/ })

};
;